// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
define("require exports ../../config ../../core/lang ../../request ../support/KMLSublayer".split(" "),function(v,f,n,g,p,q){function l(c,a,d){d.forEach(function(d){c.set(d.attributes[a],d)})}function r(c,a){var d;a.some(function(a){return a.id===c?(d=a,!0):!1});return d}Object.defineProperty(f,"__esModule",{value:!0});var t={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};f.parseKML=function(c){var a=c.folders.slice(),d=new Map,m=new Map,h=new Map,f=new Map,
k=new Map,u={esriGeometryPoint:m,esriGeometryPolyline:h,esriGeometryPolygon:f};c.featureCollection.layers.forEach(function(b){var e=g.clone(b);e.featureSet.features=[];var a=b.featureSet.geometryType;d.set(a,e);e=b.layerDefinition.objectIdField;"esriGeometryPoint"===a?l(m,e,b.featureSet.features):"esriGeometryPolyline"===a?l(h,e,b.featureSet.features):"esriGeometryPolygon"===a&&l(f,e,b.featureSet.features)});c.groundOverlays&&c.groundOverlays.forEach(function(b){k.set(b.id,b)});c.folders.forEach(function(b){b.networkLinkIds.forEach(function(e){var d=
b.id;if(e=r(e,c.networkLinks))e.parentFolderId=d,e.networkLink=e;e&&a.push(e)})});a.forEach(function(b){b.featureInfos&&(b.points=g.clone(d.get("esriGeometryPoint")),b.polylines=g.clone(d.get("esriGeometryPolyline")),b.polygons=g.clone(d.get("esriGeometryPolygon")),b.mapImages=[],b.featureInfos.map(function(a){switch(a.type){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var d=u[a.type].get(a.id);d&&b[t[a.type]].featureSet.features.push(d);break;case "GroundOverlay":(a=
k.get(a.id))&&b.mapImages.push(a)}}))});return{folders:c.folders,sublayers:a}};f.fetchService=function(c,a,d){return p(n.kmlServiceUrl,{callbackParamName:"callback",query:{url:c,model:"simple",folders:"",refresh:0!==d?!0:void 0,outSR:JSON.stringify(a)},responseType:"json"})};f.sublayersFromJSON=function(c,a,d){void 0===a&&(a=null);void 0===d&&(d=[]);var f=[],h={},g=c.sublayers,k=c.folders.map(function(a){return a.id});g.forEach(function(c){var b=new q;a?b.read(c,a):b.read(c);d.length&&-1<k.indexOf(b.id)&&
(b.visible=-1!==d.indexOf(b.id));h[c.id]=b;null!=c.parentFolderId&&-1!==c.parentFolderId?(c=h[c.parentFolderId],c.sublayers||(c.sublayers=[]),c.sublayers.unshift(b)):f.unshift(b)});return f}});