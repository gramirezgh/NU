// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
define("require exports dojox/gfx/_base ../SimpleMarkerSymbol ../../core/promiseUtils ../../core/Error ../../core/screenUtils ./renderUtils ./previewUtils ./gfxUtils".split(" "),function(B,q,x,m,v,y,n,z,A,t){Object.defineProperty(q,"__esModule",{value:!0});q.previewSymbol2D=function(d,l){var f=l&&l.size?n.pt2px(l.size):null,k=l&&l.maxSize?n.pt2px(l.maxSize):null,b=t.getStroke(d),g={shape:null,fill:null,stroke:b};b&&b.width&&(b.width=Math.min(b.width,80));var e=0,c=0,h=b&&b.width||0,q=!1,w=null;switch(d.type){case "simple-marker":var a=
m.defaultProps,b=d.style,c=e=f=Math.min(f||n.pt2px(d.size||a.size),k||120);switch(b){case m.STYLE_CIRCLE:g.shape={type:"circle",cx:0,cy:0,r:.5*f};break;case m.STYLE_CROSS:g.shape={type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[e,.5*c]},{command:"M",values:[.5*e,0]},{command:"L",values:[.5*e,c]},{command:"E",values:[]}]};break;case m.STYLE_DIAMOND:g.shape={type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[.5*e,0]},{command:"L",values:[e,.5*c]},{command:"L",
values:[.5*e,c]},{command:"Z",values:[]}]};break;case m.STYLE_SQUARE:g.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,0]},{command:"L",values:[e,c]},{command:"L",values:[0,c]},{command:"Z",values:[]}]};break;case m.STYLE_X:g.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,c]},{command:"M",values:[e,0]},{command:"L",values:[0,c]},{command:"E",values:[]}]};break;case m.STYLE_PATH:q=!0,g.shape={type:"path",path:d.path||""}}break;case "simple-line":h=
Math.min(f||h,k||80);e=22<h?2*h:40;c=h;b.width=h;h=0;g.shape={type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[e,.5*c]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":g.shape=A.shapes.fill[0];break;case "picture-marker":k=k||120;b=n.pt2px(d.width);a=n.pt2px(d.height);f=Math.min(f||Math.max(b,a),k);a=b/a;b=1>=a?Math.ceil(f*a):f;a=1>=a?f:Math.ceil(f/a);e=b;c=a;w=l.opacity;g.shape={type:"image",x:-Math.round(b/2),y:-Math.round(a/2),width:b,height:a,src:d.url||
""};break;case "text":for(var b=d.text||"Aa",a=d.font,f=Math.min(f||n.pt2px(a.size),k||120),u=k=0;u<b.length;u++)var r=b.charAt(u),r=r===r.toUpperCase()?.7:.5,k=k+f*r;e=k;c=f;g.shape={type:"text",text:b,x:0,y:.25*x.normalizedLength((a?f:0).toString()),align:"middle",decoration:d.decoration||a&&a.decoration,rotated:d.rotated,kerning:d.kerning};g.font=a&&{size:f,style:a.style,variant:a.variant,decoration:a.decoration,weight:a.weight,family:a.family}}if(!g.shape)return v.reject(new y("symbolPreview: renderPreviewHTML2D",
"symbol not supported."));var e=(e||22)+2*h,c=(c||22)+2*h,p=t.getFill(d);d=d.color;h=null;p&&"pattern"===p.type&&d?h=t.getPatternUrlWithColor(p.src,d.toCss(!0)).then(function(a){p.src=a;g.fill=p;return g}):(g.fill=p,h=v.resolve(g));return h.then(function(a){return z.renderSymbol([[a]],[e,c],{node:l&&l.node,scale:q,opacity:w})})}});