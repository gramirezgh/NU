// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang dojo/Deferred dojox/gfx/matrix dojox/gfx ../../request ../../core/sniff ../../core/Error ../../core/promiseUtils ../../core/urlUtils ../../kernel".split(" "),function(G,m,x,y,z,A,B,r,C,t,D,u){function E(c){return c.map(function(d){return d.command+" "+d.values.join(",")}).join(" ").trim()}function F(c,d,f,k){var a=k&&k.node||document.createElement("div"),g=A.createSurface(a,d,f);null!=k.opacity&&(a.style.opacity=k.opacity.toString());try{c.forEach(function(a){var c=
g.createGroup(),v=0;a.forEach(function(a){var b=a.shape,e=a.fill,d=a.stroke;v+=d&&d.width||0;var f=null;b&&("path"===b.type&&"string"!==typeof b.path&&(b.path=E(b.path)),f=c.createShape(b).setFill(e).setStroke(d?d:{width:0}),"text"===b.type&&f.setFont(a.font))});var e=c.getBoundingBox();a=e.width;var n=e.height,b=-(e.x+a/2),h=-(e.y+n/2),l=g.getDimensions(),b={dx:b+l.width/2,dy:h+l.height/2},h=!1;if(k.scale&&0!==e.width&&0!==e.height){var h=e.width/e.height,p=(d>f?d:f)-2*v,m=1,q=1;isNaN(p)||(1<h?(m=
p/e.width,q=p/h/e.height):(q=p/e.height,m=p*h/e.width));c.applyTransform(z.scaleAt(m,q,l.width/2,l.height/2));h=!0}!h&&(a>d||n>f)&&(e=a/d>n/f,a=((e?d:f)-5)/(e?a:n),x.mixin(b,{xx:a,yy:a}));c.applyTransform(b)})}catch(l){return g.clear(),g.destroy(),null}return a}function w(c,d,f,k){if(!c)return t.reject(new C("renderUtils: imageDataSize","href not provided."));var a;if(D.isDataProtocol(c)){var g=new Image;g.src=c;if(g.complete)a=t.resolve({data:g});else{var l=new y;a=l.promise;g.onload=function(){l.resolve({data:g})};
g.onerror=l.reject}}else a=B(c,{responseType:"image",allowImageDataAccess:f});return a.then(function(a){a=a.data;var c=a.width,e=a.height,g=c/e,b=d;k&&(b=Math.min(b,Math.max(c,e)));return{image:f?a:null,width:1>=g?Math.ceil(b*g):b,height:1>=g?b:Math.ceil(b/g)}}).otherwise(function(a){if(f)return w(c,d,!1,k);throw a;})}Object.defineProperty(m,"__esModule",{value:!0});m.renderSymbol=function(c,d,f){var k=Math.ceil(d[0]);d=Math.ceil(d[1]);return c.some(function(a){return!!a.length})?F(c,k,d,f):null};
m.tintImageWithColor=function(c,d,f,k){return w(c,d,!!f,k).then(function(a){var g=a.width?a.width:d,l=a.height?a.height:d;if(a.image&&f){var k=a.image.width,m=a.image.height;(r("edge")||r("ie"))&&/\.svg$/i.test(c)&&(--k,--m);var e,n;e=Math.ceil(g);n=Math.ceil(l);var b=document.createElement("canvas");b.width=e;b.height=n;b.style.width=e+"px";b.style.height=n+"px";b=b.getContext("2d");b.clearRect(0,0,e,n);b.drawImage(a.image,0,0,k,m,0,0,g,l);a=b.getImageData(0,0,g,l);k=f.r/255;m=f.g/255;e=f.b/255;
n=f.a;for(var h=0;h<a.data.length;h+=4)a.data[h+0]*=k,a.data[h+1]*=m,a.data[h+2]*=e,a.data[h+3]*=n;b.putImageData(a,0,0);c=b.canvas.toDataURL("image/png")}else(b=u.id&&u.id.findCredential(c))&&b.token&&(a=-1===c.indexOf("?")?"?":"\x26",c=""+c+a+"token\x3d"+b.token);return{url:c,width:g,height:l}}).otherwise(function(){return{url:c,width:d,height:d}})}});