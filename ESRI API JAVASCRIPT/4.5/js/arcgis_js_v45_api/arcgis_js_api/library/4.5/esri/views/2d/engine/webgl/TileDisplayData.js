// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/ObjectPool ./WGLDisplayObject ./WGLDisplayRecord ./WGLDisplayList ./enums ./Utils".split(" "),function(w,x,u,v,t,l,m,k){return function(){function e(){this.displayList=new l;this.fillDisplayRecords=[];this.lineDisplayRecords=[];this.iconDisplayRecords=[];this.textDisplayRecords=[];this.displayObjectRegistry=new Map}e.prototype.release=function(){};e.serialize=function(c,f,d){var a=0,a=a+l.serialize(c.displayList,f,d+a),a=a+e._serializeRecords(c.fillDisplayRecords,
f,d+a),a=a+e._serializeRecords(c.lineDisplayRecords,f,d+a),a=a+e._serializeRecords(c.iconDisplayRecords,f,d+a),a=a+e._serializeRecords(c.textDisplayRecords,f,d+a);return a+=e._serializeRegistry(c.displayObjectRegistry,[c.fillDisplayRecords,c.lineDisplayRecords,c.iconDisplayRecords,c.textDisplayRecords],f,d+a)};e.deserialize=function(c,f,d){var a=0;c.tileDisplayData=new e;var b={displayList:null},a=a+l.deserialize(b,f,d+a);c.tileDisplayData.displayList=b.displayList;a+=e._deserializeRecords(c.tileDisplayData.fillDisplayRecords,
m.WGLGeometryType.FILL,f,d+a);a+=e._deserializeRecords(c.tileDisplayData.lineDisplayRecords,m.WGLGeometryType.LINE,f,d+a);a+=e._deserializeRecords(c.tileDisplayData.iconDisplayRecords,m.WGLGeometryType.MARKER,f,d+a);a+=e._deserializeRecords(c.tileDisplayData.textDisplayRecords,m.WGLGeometryType.TEXT,f,d+a);return a+=e._deserializeRegistry(c.tileDisplayData.displayObjectRegistry,[c.tileDisplayData.fillDisplayRecords,c.tileDisplayData.lineDisplayRecords,c.tileDisplayData.iconDisplayRecords,c.tileDisplayData.textDisplayRecords],
f,d+a)};e._findRecord=function(c,f){for(var d=c.length,a=0;a<d;++a)if(c[a]===f)return a;return-1};e._serializeRecords=function(c,f,d){for(var a=0,a=a+k.serializeInteger(c.length,f,d+a),b=0;b<c.length;b++)a+=t.serialize(c[b],f,d+a,!1);return a};e._serializeRegistry=function(c,f,d,a){var b=0,n=0;c.forEach(function(a,b){++n});b+=k.serializeInteger(n,d,a+b);c.forEach(function(h,g){g=c.get(g);b+=k.serializeInteger(g.id,d,a+b);b+=k.serializeInteger(g.displayRecords.length,d,a+b);h=0;for(g=g.displayRecords;h<
g.length;h++){var n=g[h],p=e._findRecord(f[n.geometryType],n);0<=p?(d&&(d[a+b]=n.geometryType),++b,b+=k.serializeInteger(p,d,a+b)):console.error("Record found in a display object but not in the flat record lists.")}});return b};e._deserializeRecords=function(c,f,d,a){var b=0,e={n:void 0},b=b+k.deserializeInteger(e,d,a+b);c.length=e.n;for(var h=0;h<e.n;++h){var g={displayRecord:null},b=b+t.deserialize(g,d,a+b,!1);c[h]=g.displayRecord;c[h].geometryType=f}return b};e._deserializeRegistry=function(c,
e,d,a){var b=0;c.clear();for(var f={n:void 0},b=b+k.deserializeInteger(f,d,a+b),h={n:void 0},g={n:void 0},m={n:void 0},p=0;p<f.n;++p){var b=b+k.deserializeInteger(h,d,a+b),b=b+k.deserializeInteger(g,d,a+b),q=v.pool.acquire();q.id=h.n;for(var l=0;l<g.n;++l){var r=void 0;b&&(r=d[a+b]);++b;b+=k.deserializeInteger(m,d,a+b);r=e[r][m.n];r.id=q.id;q.displayRecords[l]=r}c.set(q.id,q)}return b};e.pool=new u(e);return e}()});