// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/tiling/TileInfoViewPOT":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./TileKey ./TileInfoView".split(" "),function(m,f,a,b,c,e){return function(b){function d(){return null!==b&&b.apply(this,arguments)||this}a(d,b);d.prototype.getTileParentId=function(a){a=c.pool.acquire(a);var b=0===a.level?null:c.getId(a.level-1,a.row>>1,a.col>>1,a.world);c.pool.release(a);return b};d.prototype.getTileIdAtParent=function(a,
b){b=c.pool.acquire(b);var d=this._infoByLevel[b.level];if(a.resolution<d.resolution)throw c.pool.release(b),Error("Cannot calculate parent tile. destination LOD's resolution "+a.resolution+" is not a parent resolution of "+d.resolution);if(a.resolution===d.resolution)return a=b.id,c.pool.release(b),a;d=b.level-a.level;if(0>d)throw c.pool.release(b),Error("Wrong way...!");a=c.getId(a.level,b.row>>d,b.col>>d,b.world);c.pool.release(b);return a};return d}(e)})},"esri/views/vectorTiles/TileHandler":function(){define("require exports module dojo/Deferred dojo/promise/all dojo/has ../../core/workers ../../core/promiseUtils ../../core/requireUtils ../../core/LRUCache ../../request ../2d/tiling/TileKey ./TileIndex ./SpriteMosaic ./SpriteSource ./GlyphMosaic ./GlyphSource ./VectorTileDisplayObject ./GeometryUtils".split(" "),
function(m,f,a,b,c,e,g,d,q,h,p,k,l,n,t,r,w,v,u){var x=new h(10);return function(){function h(a,b,c,d,g){void 0===d&&(d=!1);this.devicePixelRatio=c;this.allowUpdates=d;this._tileIndex=this._connection=this._glyphMosaic=this._spriteMosaic=null;this._updateQueue=new Map;this._ongoingRequests=new Map;this._vectorTileLayer=a;this._styleRepository=a.styleRepository;this._requestUpdate=b;this._tileInfoView=g}h.prototype.destroy=function(){this.stop();this._vectorTileLayer=this._requestUpdate=this._styleRepository=
null;this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)};Object.defineProperty(h.prototype,"initialized",{get:function(){return this._broadcastPromise&&this._broadcastPromise.isFulfilled()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"spriteMosaic",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"ongoingRequestCount",{get:function(){return this._ongoingRequests.size},enumerable:!0,configurable:!0});h.prototype.start=function(){var d=this;this.stop();var k=this._styleRepository,h=new t(k.sprite,this.devicePixelRatio);h.devicePixelRatio=this.devicePixelRatio;var l=h.load().then(function(){d._spriteMosaic=new n(1024,1024,250);d._spriteMosaic.setSpriteSource(h);e("stable-symbol-rendering")&&d._spriteMosaic.preloadSpriteItems()}),
p=new w(k.glyphs);this._glyphMosaic=new r(1024,1024,p);var u=this._fetchTileMap(this._vectorTileLayer.tileIndexUrl),x=g.open(this,q.getAbsMid("./WorkerTileHandler",m,a)).then(function(a){d._connection=a}),f=new b(function(a){l.isFulfilled()||l.cancel();u.isFulfilled()||u.cancel();x.isFulfilled()||x.cancel()});c([l,u,x]).then(function(a){c(d._connection.broadcast("setLayers",k.styleJSON)).then(function(){f.resolve()})});return this._broadcastPromise=f.promise};h.prototype.stop=function(){this._broadcastPromise&&
!this._broadcastPromise.isFulfilled()&&this._broadcastPromise.cancel();this._updateQueue.forEach(function(a){return a.cancel()});this._ongoingRequests.forEach(function(a){return a.cancel()});this._connection&&(this._connection.close(),this._connection=null)};h.prototype.updateTile=function(a,b){var c=this;if(!this.allowUpdates)return d.resolve(null);if(!this._broadcastPromise.isFulfilled()||!this._connection)return d.reject(Error("no connection"));b=Math.round(u.degToByte(b.state.rotation));if(a.rotation===
b)return d.resolve(null);var g,k=a.key;this._updateQueue.has(k.id)&&(g=this._updateQueue.get(k.id),g.cancel("cancel"));a.rotation=b;g=this._connection.invoke("update",{key:a.id,rotation:b},[],{id:a.workerID}).then(function(b){a.updateSymbolData(b);return b}).always(function(){c._updateQueue["delete"](k.id)});this._updateQueue.set(a.id,g);return g};h.prototype.getVectorTileWithLRC=function(a,b,c,d){var g=this;void 0===d&&(d=0);a=new k(a,b,c,0);b=this.getRefKey(a);var h=new v(a,b,this._vectorTileLayer.tileInfo,
this._styleRepository,this._glyphMosaic,0);return this.getTileData(h.key,0).then(function(a){h.setData(a.tileData,a.workerId,g._connection);return h})};h.prototype.getTileData=function(a,b){var c=this;if(!this._broadcastPromise.isFulfilled()||!this._connection)return d.reject(Error("no connection"));var g=this._tileIndex?this._tileIndex.dataKey(a):a;if(!g)return d.reject(Error("no data"));b=Math.round(u.degToByte(b));return this._getTileData(this._connection,a,g,b).then(function(a){return a&&a.tileData?
{tileData:a.tileData,workerId:a.workerId,connection:c._connection}:d.reject("No data")})};h.prototype.getRefKey=function(a){return this._tileIndex?this._tileIndex.dataKey(a):a};h.prototype.fetchTileData=function(a){a=k.pool.acquire(a);var b=this._vectorTileLayer.getTileUrl(a.level,a.row,a.col);k.pool.release(a);return p(b,{callbackParamName:"callback",responseType:"array-buffer"}).then(function(a){return{data:{protobuff:a.data},buffers:[a.data]}})};h.prototype.getSprites=function(a){return d.resolve({data:{spriteItems:this._spriteMosaic.getSpriteItems(a.sprites)}})};
h.prototype.getGlyphs=function(a){return this._glyphMosaic.getGlyphItems(a.tileID,a.font,a.codePoints).then(function(a){return{data:{glyphItems:a}}})};h.prototype.getStyleRepository=function(){return this._styleRepository};h.prototype.getTileIndex=function(){return this._tileIndex};h.prototype._getTileData=function(a,b,c,g){var k=this,h={id:null};if(a=this._ongoingRequests.get(b.id))return a;a=this._connection.invoke("getTile",{key:b.id,refKey:c.id,rotation:g,cacheTile:this.allowUpdates},[],h).then(function(a){k._ongoingRequests["delete"](b.id);
return{tileData:a,workerId:h.id}}).otherwise(function(a){k._ongoingRequests["delete"](b.id);k._connection.invoke("destructTileData",{key:b.id},[],h);return d.reject(a)});this._ongoingRequests.set(b.id,a);return a};h.prototype._fetchTileMap=function(a){var b=this;return a?x.has(a)?(this._tileIndex=x.use(a),d.resolve()):p(a,{callbackParamName:"callback",responseType:"json"}).then(function(c){b._tileIndex=new l(c.data);x.insert(a,b._tileIndex)}):null};return h}()})},"esri/core/workers":function(){define(["require",
"exports","./workers/workers"],function(m,f,a){Object.defineProperty(f,"__esModule",{value:!0});for(var b in a)f.hasOwnProperty(b)||(f[b]=a[b])})},"esri/core/workers/workers":function(){define("require exports dojo/Deferred dojo/promise/all ../promiseUtils ./Connection ./JobProxy".split(" "),function(m,f,a,b,c,e,g){function d(a,c){for(var d=[],g=0;g<l.length;g++)d.push(l[g].openConnection(a,c));return b(d).then(function(a){})}function q(a){n[a]=!0;if(!k&&n.every(function(a){return a})){for(var b in v)(a=
w[b])&&v[b].resolve(a);v={};k=!0}}function h(b){var c=r++;b=new e(b,c);var d=new a;w[c]=b;k?d.resolve(b):v[c]=d;return d.promise}Object.defineProperty(f,"__esModule",{value:!0});var p=Math.max((navigator.hardwareConcurrency||2)-1,2),k=!1,l=[],n=[],t=0,r=0,w={},v={},u=!1;f.open=function(a,b){if(!1===u){for(var k=0;k<p;++k){var e=new g(w,k,q);l.push(e);n.push(!1)}u=!0}return h(a).then(function(a){return d(b,a.id).then(function(){return a}).otherwise(function(a){return c.reject(a)})})};f.terminate=function(){for(var a=
0;a<l.length;a++)l[a].terminate();l=[];n=[];k=!1};f.closeConnection=function(a){if(a)if(w[a.id]&&delete w[a.id],k)for(var b=0;b<l.length;b++)l[b].closeConnection(a.id);else if(b=v[a.id])b.promise.cancel(),delete v[a.id]};f.invoke=function(a,b,d,g,k){var h=null;g&&(h=g.id);if(null===h&&(h=t=(t+1)%l.length,!n[h]&&!l.some(function(a,b,c){h=(h+1)%c.length;return n[h]})))return c.reject(Error("No worker available"));a=l[h].invoke(a,b,d,k);g&&(g.id=h);return a};f.broadcast=function(a,b,c,d){for(var g=[],
h=0;h<l.length;h++)n[h]&&g.push(l[h].invoke(a,b,c,d));return g}})},"esri/core/workers/Connection":function(){define(["require","exports","./workers"],function(m,f,a){return function(){function b(a,b){this.client=a;this.id=b}b.prototype.invoke=function(b,e,g,d){return a.invoke(b,e,g,d,this.id)};b.prototype.broadcast=function(b,e,g){return a.broadcast(b,e,g,this.id)};b.prototype.close=function(){a.closeConnection(this)};return b}()})},"esri/core/workers/JobProxy":function(){define("require exports dojo/_base/kernel dojo/_base/lang dojo/Deferred ../../kernel ../../config ../../request ../sniff ../Logger ../urlUtils ./WorkerFallbackImpl".split(" "),
function(m,f,a,b,c,e,g,d,q,h,p,k){function l(){if(!q("esri-workers"))return n(new k);if(!u){var a=void 0;try{a=new Worker(r)}catch(C){t.warn("Failed to create Worker. Fallback to execute module in main thread",event),a=new k}return n(a)}x||(x=d(r,{responseType:"text"}));return x.then(function(a){return new Worker(URL.createObjectURL(new Blob([a.data],{type:"text/javascript"})))}).otherwise(function(a){t.warn("Failed to create Worker. Fallback to execute module in main thread",a);return new k}).then(function(a){return n(a)})}
function n(d){function h(c){if(c&&c.data&&c.data.type)if(c=c.data.type,"\x3cworker-loaded\x3e"===c){c=d;var k;null!=g["default"]?(k=b.mixin({},g),delete k["default"],k=JSON.parse(JSON.stringify(k))):k=JSON.parse(JSON.stringify(g));var n={async:!0,baseUrl:v,locale:a.locale,has:{},paths:{}};b.mixin(n,g.workers.loaderConfig);n.has=b.mixin({"esri-cors":1,"dojo-test-sniff":0,"config-deferredInstrumentation":0,"host-webworker":1},n.has);n.paths=b.mixin({esri:"../esri",dojo:"../dojo",dojox:"../dojox",dstore:"../dstore",
moment:"../moment"},n.paths);c.postMessage({type:"\x3cconfigure\x3e",configure:{esriConfig:k,dojoConfig:n,loaderUrl:w}})}else"\x3cworker-configured\x3e"===c&&(d.removeEventListener("message",h),d.removeEventListener("error",e),l.resolve(d))}function e(a){a.preventDefault();d.removeEventListener("message",h);d.removeEventListener("error",e);t.warn("Failed to create Worker. Fallback to execute module in main thread",a);d=new k;d.addEventListener("message",h);d.addEventListener("error",e)}var l=new c;
d.addEventListener("message",h);d.addEventListener("error",e);return l.promise}var t=h.getLogger("esri.core.workers.JobProxy"),r=p.normalize(m.toUrl("./worker.js")),w=p.makeAbsolute(m.toUrl("dojo/dojo.js")),v=p.makeAbsolute("../",w)+"/",u=!p.hasSameOrigin(r,location.href),x=null;return function(){function a(a,b,c){var d=this;this.connections=a;this.index=b;this.workerInitCallback=c;this.msgCount=0;this.outgoingJobs={};this.incomingJobs={};this.incomingStaticJobs={};l().then(function(a){d.worker=a;
d.worker.addEventListener("message",d.message.bind(d));d.worker.addEventListener("error",function(a){a.preventDefault();t.error(a)});d.workerInitCallback(d.index)})}a.prototype.terminate=function(){this.worker.terminate()};a.prototype.openConnection=function(a,b){return this.invoke("\x3copen-connection\x3e",{path:a},void 0,b)};a.prototype.closeConnection=function(a){this.invoke("\x3cclose-connection\x3e",void 0,void 0,a)};a.prototype.invoke=function(a,b,d,g){var h=this,k=++this.msgCount,e=new c(function(a){h.worker.postMessage({type:"\x3ccancel\x3e",
id:k,connection:g,data:{reason:a}});h.outgoingJobs[k]&&delete h.outgoingJobs[k]});this.outgoingJobs[k]=e;this.worker.postMessage({type:a,id:k,connection:g,data:b},d);return e.promise};a.prototype.message=function(a){var b=this;if(a&&a.data){var c=a.data.type;if(c){var d=a.data,g=a.data.id;if("\x3cresponse\x3e"===c&&g){if(a=this.outgoingJobs[g])delete this.outgoingJobs[g],d.error?a.reject(d.error):a.resolve(d.data)}else if("\x3ccancel\x3e"===c&&g)(a=this.incomingJobs[g])&&a.cancel(d.data.reason),d.staticMsg&&
(a=this.incomingStaticJobs[g])&&a.cancel(d.data.reason);else if("\x3cstatic-message\x3e"===c){var h=d.staticMsg;(a=e.workerMessages[h])&&"function"===typeof a?(d=a.call(this,d.data),this.incomingStaticJobs[g]=d,d.then(function(a){b.worker.postMessage({type:"\x3cstatic-message\x3e",staticMsg:h,id:g,data:a.data},a.buffers)}).otherwise(function(a){a||(a="Error encountered at method"+h);a.dojoType&&"cancel"===a.dojoType||b.worker.postMessage({type:"\x3cstatic-message\x3e",staticMsg:h,id:g,error:a})}).always(function(){delete b.incomingStaticJobs[g]})):
this.worker.postMessage({type:"\x3cstatic-message\x3e",staticMsg:h,id:g,error:h+" message type is not available on the kernel!"})}else{var k=d.connection;if(a=this.connections[k])if(a=a.client){var l=a[c];"function"===typeof l&&(d=l.call(a,d.data),this.incomingJobs[g]=d,d.then(function(a){b.worker.postMessage({type:"\x3cresponse\x3e",id:g,connection:k,error:a.error,data:a.data},a.buffers)}).otherwise(function(a){a||(a="Error encountered at method"+c);a.dojoType&&"cancel"===a.dojoType||b.worker.postMessage({type:"\x3cresponse\x3e",
id:g,connection:k,error:a.message})}).always(function(){delete b.incomingJobs[g]}))}}}}};return a}()})},"esri/core/workers/WorkerFallbackImpl":function(){define(["require","exports","../global"],function(m,f,a){var b=function(){return function(){var a=this,b=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(c){a[c]=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return b[c].apply(b,a)}})}}(),c=a.MutationObserver||a.WebKitMutationObserver,
e=function(){var b;if(a.process&&a.process.nextTick)b=function(b){a.process.nextTick(b)};else if(a.Promise)b=function(b){a.Promise.resolve().then(b)};else if(c){var d=[],e=document.createElement("div");(new c(function(){for(;0<d.length;)d.shift()()})).observe(e,{attributes:!0});b=function(a){d.push(a);e.setAttribute("queueStatus","1")}}return b}();return function(){function a(){this._dispatcher=new b;this._connections={};this._outgoingStaticMessages={};this._isInitialized=!1;this._workerPostMessage({type:"\x3cworker-loaded\x3e"})}
a.prototype.terminate=function(){this._connections={}};Object.defineProperty(a.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(a){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",
this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)},enumerable:!0,configurable:!0});a.prototype.postMessage=function(a,b){var c=this;e(function(){c._workerMessageHandler(new MessageEvent("message",{data:a}))})};a.prototype.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)};a.prototype.addEventListener=function(a,b,c){this._dispatcher.addEventListener(a,b,c)};a.prototype.removeEventListener=function(a,b,c){this._dispatcher.removeEventListener(a,b,c)};
a.prototype._workerPostMessage=function(a,b){var c=this;e(function(){c.dispatchEvent(new MessageEvent("message",{data:a}))})};a.prototype._workerMessageHandler=function(a){var b=this,c=a.data;if(c){var d=c.connection,k=c.type;if("\x3cconfigure\x3e"===k)this._isInitialized||this._workerPostMessage({type:"\x3cworker-configured\x3e"});else if("\x3copen-connection\x3e"===k){a=c.data.path;var g=c.id;this._connections[d]?this._workerPostMessage({type:"\x3cresponse\x3e",id:g,connection:d}):m(["./WorkerConnection",
a],function(a,c){b._connections[d]=new a(c,{postMessage:function(a,c){return b._workerPostMessage(a,c)}},d);b._workerPostMessage({type:"\x3cresponse\x3e",id:g,data:{connection:d},error:void 0})})}else"\x3cclose-connection\x3e"===k?this._connections[d]&&delete this._connections[d]:"\x3cstatic-message\x3e"===k?(a=c.id,this._outgoingStaticMessages[a]&&(k=this._outgoingStaticMessages[a],delete this._outgoingStaticMessages[a],c.error?k.reject(c.error):k.resolve(c.data))):k&&(c=this._connections[d])&&c.proxy.message(a)}};
return a}()})},"esri/core/LRUCache":function(){define(["require","exports"],function(m,f){return function(){function a(a){this._cache={};this._lruQueue=[];if(0>=a)throw Error("LRU cache size must be bigger than zero!");this._maxSize=a}a.prototype.has=function(a){return void 0!==this._cache[a]};a.prototype.insert=function(a,c){null!==this.use(a)?this._cache[a]=c:(this._collect(),this._cache[a]=c,this._lruQueue.unshift(a))};a.prototype.use=function(a){var b=this._cache[a];if(!b)return null;this._lruQueue.splice(this._lruQueue.indexOf(a),
1);this._lruQueue.unshift(a);return b};a.prototype.print=function(){for(var a=0,c=this._lruQueue;a<c.length;a++){var e=c[a];console.log("key: "+e+", value: "+this._cache[e])}};a.prototype._collect=function(){if(!(this._lruQueue.length<this._maxSize)){var a=this._lruQueue.pop(),c=this._cache[a];c&&c.release&&c.release();delete this._cache[a]}};return a}()})},"esri/views/vectorTiles/TileIndex":function(){define(["require","exports","../2d/tiling/TileKey"],function(m,f,a){return function(){function b(a){if(!("index"in
a))throw Error("The tilemap is missing the 'index' property.");this._tilemap=a.index}b.prototype.dataKey=function(b){var c=[b];if(0>b.level||0>b.row||0>b.col||0<b.row>>b.level||0<b.col>>b.level)return null;for(;0!==b.level;)b=new a(b.level-1,b.row>>1,b.col>>1,b.world),c.push(b);b=this._tilemap;var g=c.pop(),d,q;if(1===b)return g;for(;c.length;){d=c.pop();q=g.level+1;var h=2*g.row,p=2*g.col;q=[a.getId(q,h,p,d.world),a.getId(q,h,p+1,d.world),a.getId(q,h+1,p,d.world),a.getId(q,h+1,p+1,d.world)].indexOf(d.id);
if(b)if(0===b[q]){g=null;break}else if(1===b[q]){g=d;break}else g=d,b=b[q]}return g};b.prototype.forEach=function(a,b,g,d,q){this._callback=q;this._maxLevel=b+a;this._forEach(this._tilemap,b,g,d)};b.prototype._forEach=function(a,b,g,d){0!==a&&(this._callback(b,g,d),b!==this._maxLevel&&"object"===typeof a&&(this._forEach(a[0],b+1,2*g,2*d),this._forEach(a[1],b+1,2*g,2*d+1),this._forEach(a[2],b+1,2*g+1,2*d),this._forEach(a[3],b+1,2*g+1,2*d+1)))};return b}()})},"esri/views/vectorTiles/SpriteMosaic":function(){define("require exports ./Rect ./GeometryUtils ./RectangleBinPack ../webgl/Texture".split(" "),
function(m,f,a,b,c,e){return function(){function g(a,b,g){void 0===g&&(g=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=a||0>=b)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=b;0<g&&(this._maxItemSize=g);this._binPack=new c(a-4,b-4)}g.prototype.getWidth=function(a){return a>=this._size.length?
-1:this._size[a][0]};g.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};g.prototype.setSpriteSource=function(a){this.dispose();this.pixelRatio=a.devicePixelRatio;0===this._mosaicsData.length&&(this._binPack=new c(this._pageWidth-4,this._pageHeight-4),this._mosaicsData[0]=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0));this._sprites=a};g.prototype.getSpriteItem=
function(a,b){void 0===b&&(b=!1);var c=this._mosaicRects[a];if(c)return c;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var d=this._sprites.getSpritePosition(a);if(!d||!d.width||!d.height||0>d.width||0>d.height)return null;var c=this._allocateImage(d.width,d.height),g=c[0],e=c[1],n=c[2];if(0>=g.width)return null;c={rect:g,width:d.width,height:d.height,sdf:d.sdf,pixelRatio:d.pixelRatio,page:e};this._copy(g,d,e,n,b);return this._mosaicRects[a]=c};g.prototype.preloadSpriteItems=
function(){for(var a=0,b=this._sprites.spriteNames;a<b.length;a++)this.getSpriteItem(b[a],!0)};g.prototype.getSpriteItems=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d]=this.getSpriteItem(d)}return b};g.prototype.getMosaicItemPosition=function(a,b){b=(a=this.getSpriteItem(a,b))&&a.rect;if(!b)return null;b.width=a.width;b.height=a.height;return{size:[a.width,a.height],tl:[(b.x+2)/this._size[a.page][0],(b.y+2)/this._size[a.page][1]],br:[(b.x+2+a.width)/this._size[a.page][0],(b.y+2+a.height)/
this._size[a.page][1]],page:a.page}};g.prototype.bind=function(a,b,c,g){void 0===c&&(c=0);void 0===g&&(g=0);this._textures[c]||(this._textures[c]=new e(a,{pixelFormat:6408,dataType:5121,width:this._size[c][0],height:this._size[c][1]},new Uint8Array(this._mosaicsData[c].buffer)));var d=this._textures[c];d.setSamplingMode(b);this._dirties[c]&&d.setData(new Uint8Array(this._mosaicsData[c].buffer));a.bindTexture(d,g);this._dirties[c]=!1};g._copyBits=function(a,b,c,g,k,e,n,t,r,w,f){var d=g*b+c;n=t*e+n;
if(f)for(n-=e,f=-1;f<=w;f++,d=((f+w)%w+g)*b+c,n+=e)for(t=-1;t<=r;t++)k[n+t]=a[d+(t+r)%r];else for(f=0;f<w;f++){for(t=0;t<r;t++)k[n+t]=a[d+t];d+=b;n+=e}};g.prototype._copy=function(a,b,c,e,k){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(c>=this._mosaicsData.length)){var d=new Uint32Array(this._sprites.image.buffer),h=this._mosaicsData[c];h&&d||console.error("Source or target images are uninitialized!");g._copyBits(d,this._sprites.width,b.x,b.y,h,e[0],a.x+2,a.y+2,b.width,b.height,k);this._dirties[c]=
!0}};g.prototype._allocateImage=function(d,g){d+=2;g+=2;var e=Math.max(d,g);if(this._maxItemSize&&this._maxItemSize<e){var e=Math.pow(2,Math.ceil(b.log2(d))),p=Math.pow(2,Math.ceil(b.log2(g)));d=new a(0,0,d,g);this._mosaicsData.push(new Uint32Array(e*p));this._dirties.push(!0);this._size.push([e,p]);this._textures.push(void 0);return[d,this._mosaicsData.length-1,[e,p]]}e=d%4?4-d%4:4;p=g%4?4-g%4:4;1===e&&(e=5);1===p&&(p=5);e=this._binPack.allocate(d+e,g+p);return 0>=e.width?(this._dirties[this._currentPage]||
(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new c(this._pageWidth-4,this._pageHeight-4),this._allocateImage(d,g)):[e,this._currentPage,[this._pageWidth,this._pageHeight]]};g.prototype.dispose=function(){this._binPack=null;this._mosaicRects={};for(var a=0,b=this._textures;a<
b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0};return g}()})},"esri/views/vectorTiles/Rect":function(){define(["require","exports"],function(m,f){return function(){function a(a,c,e,g){void 0===a&&(a=0);void 0===c&&(c=0);void 0===e&&(e=0);void 0===g&&(g=0);this.x=a;this.y=c;this.width=e;this.height=g}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});return a}()})},"esri/views/vectorTiles/RectangleBinPack":function(){define(["require",
"exports","./Rect"],function(m,f,a){return function(){function b(b,e){this._height=this._width=0;this._free=[];this._width=b;this._height=e;this._free.push(new a(0,0,b,e))}b.prototype.allocate=function(b,e){for(var c=null,d=-1,q=0;q<this._free.length;++q){var h=this._free[q];b<=h.width&&e<=h.height&&(null===c||h.y<=c.y&&h.x<=c.x)&&(c=h,d=q)}if(null===c)return new a;this._free.splice(d,1);c.width<c.height?(c.width>b&&this._free.push(new a(c.x+b,c.y,c.width-b,e)),c.height>e&&this._free.push(new a(c.x,
c.y+e,c.width,c.height-e))):(c.width>b&&this._free.push(new a(c.x+b,c.y,c.width-b,c.height)),c.height>e&&this._free.push(new a(c.x,c.y+e,b,c.height-e)));return new a(c.x,c.y,b,e)};b.prototype.release=function(a){for(var b=0;b<this._free.length;++b){var c=this._free[b];if(c.y===a.y&&c.height===a.height&&c.x+c.width===a.x)c.width+=a.width;else if(c.x===a.x&&c.width===a.width&&c.y+c.height===a.y)c.height+=a.height;else if(a.y===c.y&&a.height===c.height&&a.x+a.width===c.x)c.x=a.x,c.width+=a.width;else if(a.x===
c.x&&a.width===c.width&&a.y+a.height===c.y)c.y=a.y,c.height+=a.height;else continue;this._free.splice(b,1);this.release(a)}this._free.push(a)};return b}()})},"esri/views/vectorTiles/SpriteSource":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper dojo/Deferred dojo/promise/all ../../request ../../kernel ../../core/promiseUtils".split(" "),function(m,f,a,b,c,e,g,d,q){return function(){function a(a,b){this.baseURL=a;this.devicePixelRatio=b;this._isRetina=
!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}Object.defineProperty(a.prototype,"spriteNames",{get:function(){var a=[],b;for(b in this._spritesData)a.push(b);a.sort();return a},enumerable:!0,configurable:!0});a.prototype.getSpritePosition=function(a){return this._spritesData[a]};a.prototype.load=function(){var a=this;this.loadStatus="loading";return this.baseURL?this._loadSprites().then(function(){a.loadStatus="loaded";return a}).otherwise(function(b){a.loadStatus=
"failed";return a}):q.resolve(this)};a.prototype._loadSprites=function(){var a=this;this._isRetina=1.15<this.devicePixelRatio?!0:!1;var b=this.baseURL,h=this._isRetina?"@2x":"",n=g(b+h+".json",{callbackParamName:"callback",responseType:"json"}).then(function(b){a._spritesData=b.data}),t=new c,q=new Image;q.crossOrigin="anonymous";q.onload=function(){q.onload=null;a.width=q.width;a.height=q.height;var b=document.createElement("canvas");b.width=q.width;b.height=q.height;b=b.getContext("2d");b.drawImage(q,
0,0,q.width,q.height);for(var b=b.getImageData(0,0,q.width,q.height),b=new Uint8Array(b.data),c,d=0;d<b.length;d+=4)c=b[d+3]/255,b[d]*=c,b[d+1]*=c,b[d+2]*=c;a.image=b;t.resolve()};b=""+b+h+".png";d.id&&(h=d.id.findCredential(b))&&h.token&&(b+="?token\x3d"+h.token);q.src=b;return e([n,t.promise])};return a}()})},"esri/views/vectorTiles/GlyphMosaic":function(){define("require exports dojo/has ../../core/promiseUtils ./Rect ../webgl/Texture ./RectangleBinPack".split(" "),function(m,f,a,b,c,e,g){var d;
a("stable-symbol-rendering")&&(d=new Set);return function(){function q(a,b,c){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;(0>=a||0>=b)&&console.error("Glyph mosaic width and height must be greater than zero!");this.width=a;this.height=b;this._glyphSource=c;this._binPack=new g(a-4,b-4);this._glyphData.push(new Uint8Array(a*b));this._dirties.push(!0);this._textures.push(void 0)}q.prototype.getGlyphItems=
function(e,p,k){var h=this,n=[],t=this._glyphSource,q=new Set;e=1/256;for(var f=0;f<k.length;f++)q.add(Math.floor(k[f]*e));var v=[];q.forEach(function(a){if(256>=a){var b=p+a;h._rangePromises.has(b)?v.push(h._rangePromises.get(b)):(a=t.getRange(p,a).always(function(){h._rangePromises["delete"](b)}),h._rangePromises.set(b,a),v.push(a))}});return b.all(v).then(function(b){b=h._glyphIndex[p];b||(b={},h._glyphIndex[p]=b);var e;if(a("stable-symbol-rendering")){d.clear();for(var l=0;l<k.length;l++)e=k[l],
d.add(e);var f=[];q.forEach(function(a){f.push(a)});f.sort();e=[];for(l=0;l<f.length;l++)for(var r=f[l],w=0;256>w;++w)e.push(256*r+w)}else e=k;l=0;for(r=e;l<r.length;l++)if(e=r[l],w=b[e]){if(!a("stable-symbol-rendering")||d.has(e))n[e]={rect:w.rect,metrics:w.metrics,page:w.page}}else{var u=t.getGlyph(p,e);if(u&&u.metrics){var w=u.metrics,v=void 0;if(0===w.width)v=new c(0,0,0,0);else{var m=w.width+6,A=w.height+6,H=m%4?4-m%4:4,G=A%4?4-A%4:4;1===H&&(H=5);1===G&&(G=5);v=h._binPack.allocate(m+H,A+G);v.isEmpty&&
(h._dirties[h._currentPage]||(h._glyphData[h._currentPage]=null),h._currentPage=h._glyphData.length,h._glyphData.push(new Uint8Array(h.width*h.height)),h._dirties.push(!0),h._textures.push(void 0),h._binPack=new g(h.width-4,h.height-4),v=h._binPack.allocate(m+H,A+G));var H=h._glyphData[h._currentPage],u=u.bitmap,K=G=void 0;if(u)for(var E=0;E<A;E++)for(var G=m*E,K=h.width*(v.y+E+1)+v.x,D=0;D<m;D++)H[K+D+1]=u[G+D]}b[e]={rect:v,metrics:w,tileIDs:null,page:h._currentPage};if(!a("stable-symbol-rendering")||
d.has(e))n[e]={rect:v,metrics:w,page:h._currentPage};h._dirties[h._currentPage]=!0}}return n})};q.prototype.removeGlyphs=function(a){for(var b in this._glyphIndex){var c=this._glyphIndex[b];if(c){var d=void 0,e;for(e in c)if(d=c[e],d.tileIDs["delete"](a),0===d.tileIDs.size){for(var g=this._glyphData[d.page],h=d.rect,q=void 0,f=void 0,u=0;u<h.height;u++)for(q=this.width*(h.y+u)+h.x,f=0;f<h.width;f++)g[q+f]=0;delete c[e];this._dirties[d.page]=!0}}}};q.prototype.bind=function(a,b,c,d){void 0===d&&(d=
0);this._textures[c]||(this._textures[c]=new e(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var g=this._textures[c];g.setSamplingMode(b);this._dirties[c]&&g.setData(this._glyphData[c]);a.bindTexture(g,d);this._dirties[c]=!1};q.prototype.dispose=function(){this._binPack=null;for(var a=0,b=this._textures;a<b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0};return q}()})},"esri/views/vectorTiles/GlyphSource":function(){define(["require",
"exports","../../core/promiseUtils","../../request","../../core/pbf"],function(m,f,a,b,c){var e=function(){function a(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var c=b.getMessage(),d=void 0,e=void 0,g=void 0,t=void 0,q=void 0,f=void 0,v=void 0;c.next();)switch(c.tag()){case 1:d=c.getUInt32();break;case 2:e=c.getBytes();break;case 3:g=c.getUInt32();break;case 4:t=c.getUInt32();break;case 5:q=c.getSInt32();
break;case 6:f=c.getSInt32();break;case 7:v=c.getUInt32();break;default:c.skip()}d&&(this._metrics[d]={width:g,height:t,left:q,top:f,advance:v},this._bitmaps[d]=e);break;default:b.skip()}break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),g=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=b};return a}();
return function(){function d(a){this._glyphInfo={};this._baseURL=a}d.prototype.getRange=function(d,g){var h=this._getFontStack(d);if(h.getRange(g))return a.resolve();var k=256*g,l=k+255;d=this._baseURL.replace("{fontstack}",d).replace("{range}",k+"-"+l);return b(d,{callbackParamName:"callback",responseType:"array-buffer"}).then(function(a){h.addRange(g,new e(new c(new Uint8Array(a.data),new DataView(a.data))))})};d.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);
if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};d.prototype._getFontStack=function(a){var b=this._glyphInfo[a];b||(b=this._glyphInfo[a]=new g);return b};return d}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix/vec2 ../../core/libs/gl-matrix/mat4 ../../core/ObjectPool ../../geometry/support/spatialReferenceUtils ../webgl/BufferObject ../2d/engine/DisplayObject ../2d/tiling/TileKey ./RenderBucket".split(" "),
function(m,f,a,b,c,e,g,d,q,h,p){return function(k){function l(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];d=k.call(this)||this;d._renderBuckets=[];d._vectorTileData=null;d._symbolUpdateData=null;d.status=5;d.coords=[0,0];d.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};d.stencilData={mask:0,reference:0};d.status=0;d.tileTransform.transform=c.create();d.tileTransform.displayCoord=b.create();0<a.length&&(e=d.acquire).call.apply(e,[d].concat(a));return d;var e}
a(l,k);l.prototype.reset=function(){h.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.height=this.width=this.coords[1]=0;this.resolution=null;this.rotation=0;this.id=this._connection=this.workerID=this._glyphsMosaic=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=null;this.status=0};l.prototype.acquire=
function(a,b,c,d,e,k){this.key=a;this.refKey=b;b=c.lodAt(a.level).resolution;var h=c.size[0]*b,n=c.origin,l=a.col*h,h=a.row*h,t=c.spatialReference,f=0;t&&(t._isWrappable?t._isWrappable():t.isWrappable)&&(f=g.getInfo(t),f=f.valid[1]-f.valid[0]);h=n.y-h;this.coords[0]=n.x+l+a.world*f;this.coords[1]=h;this.widthInPixels=c.size[1];this.coordRange=4096;this.resolution=b;this.rotation=k;this.styleLayers=d;this._glyphsMosaic=e;this.id=a.id;this.status=1};l.prototype.setData=function(a,b,c){this._vectorTileData=
a;this.workerID=b;this._connection=c;this.status=3};l.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};l.prototype.dispose=function(){this.polygonTrianglesVertexArrayObject&&(this.polygonTrianglesVertexArrayObject.dispose(),this.polygonTrianglesVertexArrayObject=null);this.polygonOutlineVertexArrayObject&&(this.polygonOutlineVertexArrayObject.dispose(),this.polygonOutlineVertexArrayObject=null);this.lineTrianglesVertexArrayObject&&(this.lineTrianglesVertexArrayObject.dispose(),
this.lineTrianglesVertexArrayObject=null);this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.polygonTrianglesVertexBuffer&&(this.polygonTrianglesVertexBuffer.dispose(),this.polygonTrianglesVertexBuffer=null);this.polygonTrianglesIndexBuffer&&(this.polygonTrianglesIndexBuffer.dispose(),this.polygonTrianglesIndexBuffer=null);this.polygonOutlinesVertexBuffer&&
(this.polygonOutlinesVertexBuffer.dispose(),this.polygonOutlinesVertexBuffer=null);this.polygonOutlinesIndexBuffer&&(this.polygonOutlinesIndexBuffer.dispose(),this.polygonOutlinesIndexBuffer=null);this.lineVertexBuffer&&(this.lineVertexBuffer.dispose(),this.lineVertexBuffer=null);this.lineTrianglesIndexBuffer&&(this.lineTrianglesIndexBuffer.dispose(),this.lineTrianglesIndexBuffer=null);this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),
this.iconIndexBuffer=null);this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);this._renderBuckets.length=0;this.status=7};l.prototype.attach=function(a){if(4===this.status)return!0;this.status=3;if(!this._vectorTileData)return!1;if(!this._vectorTileData.bufferDataInfo)return this.status=4,!0;if(0===this._renderBuckets.length)for(var b=
new Uint32Array(this._vectorTileData.bucketDataInfo),c=b.length,e=0;e<c;){var g=b[e],k=b[e+1];if(0===k)k=new p.BackgroundRenderBucket,k.layerID=g,this._renderBuckets.push(k),e+=2;else if(1===k)k=new p.FillRenderBucket,k.layerID=g,k.triangleElementStart=b[e+2],k.triangleElementCount=b[e+3],k.outlineElementStart=b[e+4],k.outlineElementCount=b[e+5],this._renderBuckets.push(k),e+=6;else if(2===k)k=new p.LineRenderBucket,k.layerID=g,k.triangleElementStart=b[e+2],k.triangleElementCount=b[e+3],this._renderBuckets.push(k),
e+=6;else if(3===k){k=new p.SymbolRenderBucket;k.layerID=g;k.isSDF=0!==b[e+2];var g=b[e+3],h=e+4;if(0<g)for(var h=e+4,l=void 0,n=void 0,f=void 0,q=0;q<g;q++)l=b[h],n=b[h+1],f=b[h+2],k.markerPerPageElementsMap.set(l,[n,f]),h+=3;var m=b[h];if(0<m)for(h++,f=n=l=void 0,q=0;q<m;q++)l=b[h],n=b[h+1],f=b[h+2],k.glyphPerPageElementsMap.set(l,[n,f]),h+=3;this._renderBuckets.push(k);e+=5+3*g+3*m}else console.error("Bad bucket type!")}a=a.context;b=new Uint32Array(this._vectorTileData.bufferDataInfo);c=b.length;
for(k=e=0;k<c;k+=2,e++)if(!(0>=b[k+1]||0===this._vectorTileData.bufferData[e].byteLength))switch(b[k]){case 2:this.polygonTrianglesVertexBuffer?this.polygonTrianglesVertexBuffer.setData(this._vectorTileData.bufferData[e]):this.polygonTrianglesVertexBuffer=d.createVertex(a,35044,this._vectorTileData.bufferData[e]);break;case 6:this.polygonTrianglesIndexBuffer?this.polygonTrianglesIndexBuffer.setData(this._vectorTileData.bufferData[e]):this.polygonTrianglesIndexBuffer=d.createIndex(a,35044,this._vectorTileData.bufferData[e]);
break;case 3:this.polygonOutlinesVertexBuffer?this.polygonOutlinesVertexBuffer.setData(this._vectorTileData.bufferData[e]):this.polygonOutlinesVertexBuffer=d.createVertex(a,35044,this._vectorTileData.bufferData[e]);break;case 7:this.polygonOutlinesIndexBuffer?this.polygonOutlinesIndexBuffer.setData(this._vectorTileData.bufferData[e]):this.polygonOutlinesIndexBuffer=d.createIndex(a,35044,this._vectorTileData.bufferData[e]);break;case 0:this.lineVertexBuffer?this.lineVertexBuffer.setData(this._vectorTileData.bufferData[e]):
this.lineVertexBuffer=d.createVertex(a,35044,this._vectorTileData.bufferData[e]);break;case 8:this.lineTrianglesIndexBuffer?this.lineTrianglesIndexBuffer.setData(this._vectorTileData.bufferData[e]):this.lineTrianglesIndexBuffer=d.createIndex(a,35044,this._vectorTileData.bufferData[e]);break;case 4:this.iconVertexBuffer?this.iconVertexBuffer.setData(this._vectorTileData.bufferData[e]):this.iconVertexBuffer=d.createVertex(a,35044,this._vectorTileData.bufferData[e]);break;case 9:this.iconIndexBuffer?
this.iconIndexBuffer.setData(this._vectorTileData.bufferData[e]):this.iconIndexBuffer=d.createIndex(a,35044,this._vectorTileData.bufferData[e]);break;case 5:this.textVertexBuffer?this.textVertexBuffer.setData(this._vectorTileData.bufferData[e]):this.textVertexBuffer=d.createVertex(a,35044,this._vectorTileData.bufferData[e]);break;case 10:this.textIndexBuffer?this.textIndexBuffer.setData(this._vectorTileData.bufferData[e]):this.textIndexBuffer=d.createIndex(a,35044,this._vectorTileData.bufferData[e])}this.status=
4;return!0};l.prototype.detach=function(a){-1!==this.workerID&&this._connection&&6!==this.status&&7!==this.status&&this._connection.broadcast("destructTileData",{key:this.id,worker:this.workerID},[]);this.dispose();k.prototype.detach.call(this,a)};l.prototype.doRender=function(a){if(this.visible&&4===this.status){var b=a.context,c=a.renderer;if(b&&c){var d=a.drawphase;this._symbolUpdateData&&this._updateSymbolData(a);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var e=
this.styleLayers,g=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==g){var k,h=this._renderBuckets.length,l=0;if(0===d)for(l=h-1;0<=l;l--)k=this._renderBuckets[l],3!==k.type&&k.hasData()&&c.renderBucket(b,k,a.displayLevel,a.requiredLevel,d,this,e.layers[k.layerID],g);else for(l=0;l<h;l++)k=this._renderBuckets[l],k.hasData()&&c.renderBucket(b,k,a.displayLevel,a.requiredLevel,d,this,e.layers[k.layerID],g)}}}};l.prototype._updateSymbolData=function(a){var b=new Uint32Array(this._symbolUpdateData.bucketDataInfo),
c=b.length;if(0===c)return this._symbolUpdateData=null,!0;if(1>a.budget.remaining||4!==this.status)return this.requestRender(),!1;a=a.context;for(var e=new Uint32Array(this._symbolUpdateData.bufferDataInfo),k=e.length,g=0,h=0;h<k;h+=2,g++)switch(e[h]){case 4:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=d.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 9:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=
null);this.iconIndexBuffer=d.createIndex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 5:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=d.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 10:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=d.createIndex(a,35044,this._symbolUpdateData.bufferData[g])}a=this._renderBuckets.length;for(e=0;e<a;e++)this._renderBuckets[e]instanceof
p.SymbolRenderBucket&&(k=this._renderBuckets[e],k.markerPerPageElementsMap.clear(),k.glyphPerPageElementsMap.clear());for(a=0;a<c;){k=b[a];g=-1;h=this._renderBuckets.length;for(e=0;e<h;e++)if(this._renderBuckets[e].layerID===k){g=e;break}e=this._renderBuckets[g];e||(e=new p.SymbolRenderBucket,e.layerID=k,e.isSDF=0!==b[a+2],this._renderBuckets.push(e));var k=b[a+3],l=a+4;if(0<k)for(var l=a+4,f=h=g=void 0,n=0;n<k;n++)g=b[l],h=b[l+1],f=b[l+2],e.markerPerPageElementsMap.set(g,[h,f]),l+=3;var q=b[l];if(0<
q)for(l++,f=h=g=void 0,n=0;n<q;n++)g=b[l],h=b[l+1],f=b[l+2],e.glyphPerPageElementsMap.set(g,[h,f]),l+=3;a+=5+3*k+3*q}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this._symbolUpdateData=null;return!0};l.pool=new e(l);return l}(q)})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(m){var f={create:function(){var a=new m.ARRAY_TYPE(2);
a[0]=0;a[1]=0;return a},clone:function(a){var b=new m.ARRAY_TYPE(2);b[0]=a[0];b[1]=a[1];return b},fromValues:function(a,b){var c=new m.ARRAY_TYPE(2);c[0]=a;c[1]=b;return c},copy:function(a,b){a[0]=b[0];a[1]=b[1];return a},set:function(a,b,c){a[0]=b;a[1]=c;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a},subtract:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a}};f.sub=f.subtract;f.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return a};f.mul=f.multiply;f.divide=
function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a};f.div=f.divide;f.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);return a};f.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);return a};f.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a};f.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);return a};f.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);return a};f.scale=function(a,b,c){a[0]=b[0]*c;a[1]=
b[1]*c;return a};f.scaleAndAdd=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;return a};f.distance=function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)};f.dist=f.distance;f.squaredDistance=function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a};f.sqrDist=f.squaredDistance;f.length=function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)};f.len=f.length;f.squaredLength=function(a){var b=a[0];a=a[1];return b*b+a*a};f.sqrLen=f.squaredLength;f.negate=function(a,b){a[0]=-b[0];a[1]=
-b[1];return a};f.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];return a};f.normalize=function(a,b){var c=b[0],e=b[1],c=c*c+e*e;0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c);return a};f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};f.cross=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a};f.lerp=function(a,b,c,e){var g=b[0];b=b[1];a[0]=g+e*(c[0]-g);a[1]=b+e*(c[1]-b);return a};f.random=function(a,b){b=b||1;var c=2*m.RANDOM()*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};
f.transformMat2=function(a,b,c){var e=b[0];b=b[1];a[0]=c[0]*e+c[2]*b;a[1]=c[1]*e+c[3]*b;return a};f.transformMat2d=function(a,b,c){var e=b[0];b=b[1];a[0]=c[0]*e+c[2]*b+c[4];a[1]=c[1]*e+c[3]*b+c[5];return a};f.transformMat3=function(a,b,c){var e=b[0];b=b[1];a[0]=c[0]*e+c[3]*b+c[6];a[1]=c[1]*e+c[4]*b+c[7];return a};f.transformMat4=function(a,b,c){var e=b[0];b=b[1];a[0]=c[0]*e+c[4]*b+c[12];a[1]=c[1]*e+c[5]*b+c[13];return a};f.forEach=function(){var a=f.create();return function(b,c,e,g,d,f){c||(c=2);
e||(e=0);for(g=g?Math.min(g*c+e,b.length):b.length;e<g;e+=c)a[0]=b[e],a[1]=b[e+1],d(a,a,f),b[e]=a[0],b[e+1]=a[1];return b}}();f.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};f.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};f.equals=function(a,b){var c=a[0];a=a[1];var e=b[0];b=b[1];return Math.abs(c-e)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(e))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};return f})},"esri/views/vectorTiles/RenderBucket":function(){define(["require",
"exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(m,f,a,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(){return function(a){this.type=a}}();f.RenderBucket=m;b=function(b){function c(){var a=b.call(this,2)||this;a.triangleElementStart=0;a.triangleElementCount=0;a.joinStart=0;a.joinCount=0;return a}a(c,b);c.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.joinCount};return c}(m);f.LineRenderBucket=b;b=function(b){function c(){var a=
b.call(this,1)||this;a.triangleElementStart=0;a.triangleElementCount=0;a.outlineElementStart=0;a.outlineElementCount=0;return a}a(c,b);c.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return c}(m);f.FillRenderBucket=b;b=function(b){function c(){var a=b.call(this,3)||this;a.markerPerPageElementsMap=new Map;a.glyphPerPageElementsMap=new Map;a.isSDF=!1;return a}a(c,b);c.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};
return c}(m);f.SymbolRenderBucket=b;m=function(b){function c(){return b.call(this,0)||this}a(c,b);c.prototype.hasData=function(){return!0};return c}(m);f.BackgroundRenderBucket=m})},"esri/views/vectorTiles/VectorTileContainer":function(){define("require exports ../../core/tsSupport/extendsHelper dojo/has ../../core/libs/gl-matrix/vec3 ../../core/libs/gl-matrix/mat4 ../2d/engine/Container ./renderers/Renderer ./GeometryUtils".split(" "),function(m,f,a,b,c,e,g,d,q){return function(g){function h(){var a=
g.call(this)||this;a.isInitialized=!1;a._displayWidth=0;a._displayHeight=0;a._tileCoordinateScale=c.create();a._orientationVec=c.create();a._displayScale=c.create();a._orientationVec.set([0,0,1]);a._defaultTransform=e.create();return a}a(h,g);h.prototype.initialize=function(a,b,c,e){this._renderer=new d;this._renderer.initialize(a,b);this._tileInfoView=e;this._tileInfo=c;this.isInitialized=!0};h.prototype.destroy=function(){this._renderer&&(this._renderer.dispose(),this._renderer=null)};h.prototype.prepareChildrenRenderParameters=
function(a){var b=a.state;if(!b||!this._tileInfo||!this.isInitialized)return a;a.displayLevel=this._tileInfo.scaleToZoom(b.scale);a.requiredLevel=this._tileInfoView.getClosestInfoForScale(b.scale).level;a.renderer=this._renderer;return a};h.prototype.renderChildren=function(a){if(0!==this.children.length&&this.isInitialized&&a&&a.state){this.sortChildren(function(a,b){return a.key.level-b.key.level});for(var c=this.children.length,d=1;d<=c;d++){var e=this.children[d-1];e.attached&&(e.stencilData.reference=
d,e.stencilData.mask=255)}this._updateTilesTransform(a.state,this._tileInfoView.getClosestInfoForScale(a.state.scale).level);c=a.context;c.setDepthWriteEnabled(!0);this._renderer.setStateParams(a.state,a.devicePixelRatio,a.displayLevel);this._renderer.drawClippingMasks(c,this.children);c.setStencilWriteMask(0);c.setBlendFunctionSeparate(1,771,1,771);c.setStencilOp(7680,7680,7681);c.setDepthFunction(515);c.setBlendingEnabled(!1);c.setStencilTestEnabled(!0);c.setDepthTestEnabled(!0);c.setDepthWriteEnabled(!0);
a.drawphase=0;g.prototype.renderChildren.call(this,a);c.setDepthWriteEnabled(!1);c.setBlendingEnabled(!0);a.drawphase=1;g.prototype.renderChildren.call(this,a);a.drawphase=2;g.prototype.renderChildren.call(this,a);c.setStencilTestEnabled(!1);c.setDepthTestEnabled(!1);if(b("esri-vector-tiles-debug"))for(a=0,d=this.children;a<d.length;a++)e=d[a],e.attached&&e.visible&&this._renderer.renderTileInfo(c,e);this._renderer.needsRedraw()&&this.requestRender()}};h.prototype.removeAllChildren=function(){for(var a=
0;a<this.children.length;a++)this.children[a].dispose();g.prototype.removeAllChildren.call(this)};h.prototype._updateTilesTransform=function(a,b){var c=1/a.width,d=1/a.height,e=[0,0];this._calculateRelativeViewProjMat(this._tileInfo.lodAt(b).resolution,a.resolution,a.rotation,this._tileInfo.size[1],4096,a.width,a.height,this._defaultTransform);for(var g=0,h=this.children;g<h.length;g++){var k=h[g];a.toScreen(e,k.coords);e[1]=a.height-e[1];k.tileTransform.displayCoord[0]=2*e[0]*c-1;k.tileTransform.displayCoord[1]=
2*e[1]*d-1;k.key.level===b&&4096===k.coordRange?k.tileTransform.transform.set(this._defaultTransform):this._calculateRelativeViewProjMat(this._tileInfo.lodAt(k.key.level).resolution,a.resolution,a.rotation,this._tileInfo.size[1],k.coordRange,a.width,a.height,k.tileTransform.transform)}};h.prototype._calculateRelativeViewProjMat=function(a,b,c,d,g,h,f,p){var k=.125;512!==d&&4096!==g&&(k=d/g);a=a/b*k;this._tileCoordinateScale.set([a,a,1]);if(h!==this._displayWidth||f!==this._displayHeight)this._displayScale.set([2/
h,-2/f,1]),this._displayWidth=h,this._displayHeight=f;e.identity(p);e.scale(p,p,this._tileCoordinateScale);e.rotate(p,p,-c*q.C_DEG_TO_RAD,this._orientationVec);e.scale(p,p,this._displayScale);e.transpose(p,p)};return h}(g)})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(m){var f={create:function(){var a=new m.ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var b=new m.ARRAY_TYPE(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},fromValues:function(a,b,c){var e=new m.ARRAY_TYPE(3);
e[0]=a;e[1]=b;e[2]=c;return e},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,c,e){a[0]=b;a[1]=c;a[2]=e;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a},subtract:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}};f.sub=f.subtract;f.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a};f.mul=f.multiply;f.divide=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a};f.div=
f.divide;f.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);return a};f.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);return a};f.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};f.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};f.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);
return a};f.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};f.scaleAndAdd=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;a[2]=b[2]+c[2]*e;return a};f.distance=function(a,b){var c=b[0]-a[0],e=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+e*e+a*a)};f.dist=f.distance;f.squaredDistance=function(a,b){var c=b[0]-a[0],e=b[1]-a[1];a=b[2]-a[2];return c*c+e*e+a*a};f.sqrDist=f.squaredDistance;f.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)};f.len=f.length;f.squaredLength=
function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a};f.sqrLen=f.squaredLength;f.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};f.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};f.normalize=function(a,b){var c=b[0],e=b[1],g=b[2],c=c*c+e*e+g*g;0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c);return a};f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};f.cross=function(a,b,c){var e=b[0],g=b[1];b=b[2];var d=c[0],f=c[1];c=c[2];a[0]=g*c-b*f;a[1]=
b*d-e*c;a[2]=e*f-g*d;return a};f.lerp=function(a,b,c,e){var g=b[0],d=b[1];b=b[2];a[0]=g+e*(c[0]-g);a[1]=d+e*(c[1]-d);a[2]=b+e*(c[2]-b);return a};f.hermite=function(a,b,c,e,g,d){var f=d*d,h=f*(2*d-3)+1,p=f*(d-2)+d,k=f*(d-1);d=f*(3-2*d);a[0]=b[0]*h+c[0]*p+e[0]*k+g[0]*d;a[1]=b[1]*h+c[1]*p+e[1]*k+g[1]*d;a[2]=b[2]*h+c[2]*p+e[2]*k+g[2]*d;return a};f.bezier=function(a,b,c,e,g,d){var f=1-d,h=f*f,p=d*d,k=h*f,h=3*d*h,f=3*p*f;d*=p;a[0]=b[0]*k+c[0]*h+e[0]*f+g[0]*d;a[1]=b[1]*k+c[1]*h+e[1]*f+g[1]*d;a[2]=b[2]*k+
c[2]*h+e[2]*f+g[2]*d;return a};f.random=function(a,b){b=b||1;var c=2*m.RANDOM()*Math.PI,e=2*m.RANDOM()-1,g=Math.sqrt(1-e*e)*b;a[0]=Math.cos(c)*g;a[1]=Math.sin(c)*g;a[2]=e*b;return a};f.transformMat4=function(a,b,c){var e=b[0],g=b[1];b=b[2];var d=c[3]*e+c[7]*g+c[11]*b+c[15],d=d||1;a[0]=(c[0]*e+c[4]*g+c[8]*b+c[12])/d;a[1]=(c[1]*e+c[5]*g+c[9]*b+c[13])/d;a[2]=(c[2]*e+c[6]*g+c[10]*b+c[14])/d;return a};f.transformMat3=function(a,b,c){var e=b[0],g=b[1];b=b[2];a[0]=e*c[0]+g*c[3]+b*c[6];a[1]=e*c[1]+g*c[4]+
b*c[7];a[2]=e*c[2]+g*c[5]+b*c[8];return a};f.transformQuat=function(a,b,c){var e=b[0],g=b[1],d=b[2];b=c[0];var f=c[1],h=c[2];c=c[3];var p=c*e+f*d-h*g,k=c*g+h*e-b*d,l=c*d+b*g-f*e,e=-b*e-f*g-h*d;a[0]=p*c+e*-b+k*-h-l*-f;a[1]=k*c+e*-f+l*-b-p*-h;a[2]=l*c+e*-h+p*-f-k*-b;return a};f.rotateX=function(a,b,c,e){var g=[],d=[];g[0]=b[0]-c[0];g[1]=b[1]-c[1];g[2]=b[2]-c[2];d[0]=g[0];d[1]=g[1]*Math.cos(e)-g[2]*Math.sin(e);d[2]=g[1]*Math.sin(e)+g[2]*Math.cos(e);a[0]=d[0]+c[0];a[1]=d[1]+c[1];a[2]=d[2]+c[2];return a};
f.rotateY=function(a,b,c,e){var g=[],d=[];g[0]=b[0]-c[0];g[1]=b[1]-c[1];g[2]=b[2]-c[2];d[0]=g[2]*Math.sin(e)+g[0]*Math.cos(e);d[1]=g[1];d[2]=g[2]*Math.cos(e)-g[0]*Math.sin(e);a[0]=d[0]+c[0];a[1]=d[1]+c[1];a[2]=d[2]+c[2];return a};f.rotateZ=function(a,b,c,e){var g=[],d=[];g[0]=b[0]-c[0];g[1]=b[1]-c[1];g[2]=b[2]-c[2];d[0]=g[0]*Math.cos(e)-g[1]*Math.sin(e);d[1]=g[0]*Math.sin(e)+g[1]*Math.cos(e);d[2]=g[2];a[0]=d[0]+c[0];a[1]=d[1]+c[1];a[2]=d[2]+c[2];return a};f.forEach=function(){var a=f.create();return function(b,
c,e,g,d,f){c||(c=3);e||(e=0);for(g=g?Math.min(g*c+e,b.length):b.length;e<g;e+=c)a[0]=b[e],a[1]=b[e+1],a[2]=b[e+2],d(a,a,f),b[e]=a[0],b[e+1]=a[1],b[e+2]=a[2];return b}}();f.angle=function(a,b){a=f.fromValues(a[0],a[1],a[2]);b=f.fromValues(b[0],b[1],b[2]);f.normalize(a,a);f.normalize(b,b);b=f.dot(a,b);return 1<b?0:Math.acos(b)};f.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};f.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};f.equals=function(a,b){var c=a[0],e=a[1];
a=a[2];var g=b[0],d=b[1];b=b[2];return Math.abs(c-g)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(e-d)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(d))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};return f})},"esri/views/vectorTiles/renderers/Renderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../GeometryUtils ./BackgroundRenderer ./LineRenderer ./FillRenderer ./SymbolRenderer ./TileInfoRenderer ./FadeRecorder".split(" "),function(m,f,a,b,c,e,
g,d,q,h){return function(){function f(){this._extrudeRotateVector=new Float32Array([0,0,1]);this._extrudeScaleVector=new Float32Array([1,1,1]);this._state={rotation:0,width:0,height:0};this._cachedRotation=this._cachedHeight=this._cachedWidth=0;this._pixelRatio=1}f.prototype.initialize=function(a,b,f){void 0===f&&(f=!0);this._SpriteMosaic=a;this._glyphMosaic=b;this._ignoreSpeed=!f;this._backgroundRenderer=new c;this._lineRenderer=new e;this._fillRenderer=new g;this._symbolRenderer=new d;this._tileInfoRenderer=
new q;this._fadeRecorder=new h.FadeRecorder(300);this._extrudeMatrix=new Float32Array(16);this._extrudeNoRotationMatrix=new Float32Array(16);this._backgroundColor=new Float32Array([1,0,0,1])};f.prototype.dispose=function(){this._backgroundRenderer&&(this._backgroundRenderer.dispose(),this._backgroundRenderer=null);this._lineRenderer&&(this._lineRenderer.dispose(),this._lineRenderer=null);this._fillRenderer&&(this._fillRenderer.dispose(),this._fillRenderer=null);this._symbolRenderer&&(this._symbolRenderer.dispose(),
this._symbolRenderer=null);this._tileInfoRenderer&&(this._tileInfoRenderer.dispose(),this._tileInfoRenderer=null)};f.prototype.setStateParams=function(c,d,e){this._pixelRatio=d;this._fadeRecorder.recordLevel(e);this._state=c;if(this._state.width!==this._cachedWidth||this._state.height!==this._cachedHeight||this._state.rotation!==this._cachedRotation)this._extrudeScaleVector[0]=2/c.width,this._extrudeScaleVector[1]=-2/c.height,a.identity(this._extrudeMatrix),a.rotate(this._extrudeMatrix,this._extrudeMatrix,
-c.rotation*b.C_DEG_TO_RAD,this._extrudeRotateVector),a.scale(this._extrudeMatrix,this._extrudeMatrix,this._extrudeScaleVector),a.transpose(this._extrudeMatrix,this._extrudeMatrix),a.identity(this._extrudeNoRotationMatrix),a.scale(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix,this._extrudeScaleVector),a.transpose(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix),this._cachedWidth=this._state.width,this._cachedHeight=this._state.height,this._cachedRotation=this._state.rotation};
f.prototype.drawClippingMasks=function(a,b){if(0!==b.length){a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);a.setClearStencil(0);a.clear(a.gl.STENCIL_BUFFER_BIT);for(var c=0;c<b.length;c++){var d=b[c];d.attached&&d.visible&&(a.setStencilFunctionSeparate(1032,519,d.stencilData.reference,d.stencilData.mask),this._backgroundRenderer.renderSolidColor(a,{u_matrix:d.tileTransform.transform,
u_normalized_origin:d.tileTransform.displayCoord,u_coord_range:d.coordRange,u_depth:0,u_color:this._backgroundColor}))}a.setColorMask(!0,!0,!0,!0);a.setBlendingEnabled(!0)}};f.prototype.renderDebug=function(a,b){var c=b.key;this._backgroundColor.set([c.col%2,c.row%2,0===c.col%2&&0===c.row%2?1:0,.5]);this._backgroundRenderer.renderSolidColor(a,{u_matrix:b.tileTransform.transform,u_normalized_origin:b.tileTransform.displayCoord,u_coord_range:b.coordRange,u_depth:0,u_color:this._backgroundColor})};f.prototype.renderBucket=
function(a,b,c,d,e,g,h,f){switch(b.type){case 0:2!==e&&this._renderBackground(a,c,e,g,h,f);break;case 1:2!==e&&this._renderFill(a,b,c,e,g,h,f);break;case 2:1===e&&this._renderLine(a,b,c,g,h,f);break;case 3:2===e&&this._renderSymbol(a,b,c,d,g,h,f)}};f.prototype.renderTileInfo=function(a,b){this._tileInfoRenderer.render(a,b)};f.prototype.needsRedraw=function(){return this._fadeRecorder.needsRedraw()};f.prototype._renderBackground=function(a,b,c,d,e,g){this._backgroundRenderer.render(a,b,c,d,e,this._SpriteMosaic,
this._SpriteMosaic.pixelRatio,g)};f.prototype._renderLine=function(a,b,c,d,e,g){this._lineRenderer.render(a,b,c,this._state,d,e,this._SpriteMosaic,this._extrudeMatrix,this._SpriteMosaic.pixelRatio,g)};f.prototype._renderFill=function(a,b,c,d,e,g,h){this._fillRenderer.render(a,b,c,this._state.rotation,d,e,g,this._SpriteMosaic,this._extrudeMatrix,this._SpriteMosaic.pixelRatio,h)};f.prototype._renderSymbol=function(a,b,c,d,e,g,h){var k=!0;d===e.key.level&&(k=!1);a.setStencilTestEnabled(k);this._symbolRenderer.render(a,
b,c,this._state.rotation,this._fadeRecorder.getFadeValues(this._ignoreSpeed),e,g,this._SpriteMosaic,this._glyphMosaic,this._extrudeMatrix,this._extrudeNoRotationMatrix,this._SpriteMosaic.pixelRatio,h)};return f}()})},"esri/views/vectorTiles/renderers/BackgroundRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat3 ../../../core/libs/gl-matrix/vec4 ../../webgl/Program ../../webgl/VertexArrayObject ../../webgl/BufferObject ./vtShaderSnippets".split(" "),function(m,f,a,b,c,e,
g,d){return function(){function f(){this._patternMatrix=a.create();this._color=b.create();this._initialized=!1}f.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._patternProgram&&(this._patternProgram.dispose(),this._patternProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null);this._patternVertexArrayObject&&(this._patternVertexArrayObject.dispose(),this._patternVertexArrayObject=
null)};f.prototype.renderSolidColor=function(a,b){this._initialized||this._initialize(a);a.bindVAO(this._solidVertexArrayObject);a.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix4fv("u_transformMatrix",b.u_matrix);this._solidProgram.setUniform2fv("u_normalized_origin",b.u_normalized_origin);this._solidProgram.setUniform1f("u_coord_range",b.u_coord_range||4096);this._solidProgram.setUniform1f("u_depth",b.u_depth||0);this._solidProgram.setUniform4fv("u_color",b.u_color||new Float32Array([1,
0,0,1]));a.drawArrays(5,0,4);a.bindVAO()};f.prototype.render=function(b,c,d,e,g,f,q,m){this._initialized||this._initialize(b);var h=g.getPaintValue("background-color",c);m*=g.getPaintValue("background-opacity",c);var k=g.getPaintValue("background-pattern",c),l=void 0!==k,n=h[3]*m,p=l||1>n;if(!p||0!==d)if(p||1!==d){if(l){b.bindVAO(this._patternVertexArrayObject);b.bindProgram(this._patternProgram);d=f.getMosaicItemPosition(k,!0);if(!d)return;c=e.coordRange/512/Math.pow(2,Math.floor(c)-e.key.level)/
q;a.identity(this._patternMatrix);q=1/(d.size[1]*c);this._patternMatrix[0]=1/(d.size[0]*c);this._patternMatrix[4]=q;f.bind(b,9729,0);this._patternProgram.setUniformMatrix4fv("u_transformMatrix",e.tileTransform.transform);this._patternProgram.setUniform2fv("u_normalized_origin",e.tileTransform.displayCoord);this._patternProgram.setUniform1f("u_depth",g.z);this._patternProgram.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix);this._patternProgram.setUniform1f("u_opacity",m);this._patternProgram.setUniform2f("u_pattern_tl",
d.tl[0],d.tl[1]);this._patternProgram.setUniform2f("u_pattern_br",d.br[0],d.br[1]);this._patternProgram.setUniform1i("u_texture",0)}else this._color[0]=n*h[0],this._color[1]=n*h[1],this._color[2]=n*h[2],this._color[3]=n,b.bindVAO(this._solidVertexArrayObject),b.bindProgram(this._solidProgram),this._solidProgram.setUniformMatrix4fv("u_transformMatrix",e.tileTransform.transform),this._solidProgram.setUniform2fv("u_normalized_origin",e.tileTransform.displayCoord),this._solidProgram.setUniform1f("u_coord_range",
e.coordRange),this._solidProgram.setUniform1f("u_depth",g.z||0),this._solidProgram.setUniform4fv("u_color",this._color);b.drawArrays(5,0,4);b.bindVAO()}};f.prototype._initialize=function(a){if(this._initialized)return!0;var b={a_pos:0},h=new c(a,d.backgroundVS,d.backgroundFS,b);if(!h)return!1;var f=new c(a,d.patternFillShaderVS,d.patternFillShaderFS,b);if(!f)return!1;var n={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},q=new Int8Array([0,0,1,0,0,1,1,1]),r=
g.createVertex(a,35044,q),r=new e(a,b,n,{geometry:r}),q=new Int16Array([0,0,4096,0,0,4096,4096,4096]),q=g.createVertex(a,35044,q);a=new e(a,b,{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:q});this._solidProgram=h;this._patternProgram=f;this._vertexAttributes=n;this._solidVertexArrayObject=r;this._patternVertexArrayObject=a;return this._initialized=!0};return f}()})},"esri/core/libs/gl-matrix/mat3":function(){define(["./common"],function(m){var f=
{create:function(){var a=new m.ARRAY_TYPE(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},fromMat4:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},clone:function(a){var b=new m.ARRAY_TYPE(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},
fromValues:function(a,b,c,e,g,d,f,h,p){var k=new m.ARRAY_TYPE(9);k[0]=a;k[1]=b;k[2]=c;k[3]=e;k[4]=g;k[5]=d;k[6]=f;k[7]=h;k[8]=p;return k},set:function(a,b,c,e,g,d,f,h,p,k){a[0]=b;a[1]=c;a[2]=e;a[3]=g;a[4]=d;a[5]=f;a[6]=h;a[7]=p;a[8]=k;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(a===b){var c=b[1],e=b[2],g=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=e;a[7]=g}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],
a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},invert:function(a,b){var c=b[0],e=b[1],g=b[2],d=b[3],f=b[4],h=b[5],p=b[6],k=b[7];b=b[8];var l=b*f-h*k,n=-b*d+h*p,t=k*d-f*p,r=c*l+e*n+g*t;if(!r)return null;r=1/r;a[0]=l*r;a[1]=(-b*e+g*k)*r;a[2]=(h*e-g*f)*r;a[3]=n*r;a[4]=(b*c-g*p)*r;a[5]=(-h*c+g*d)*r;a[6]=t*r;a[7]=(-k*c+e*p)*r;a[8]=(f*c-e*d)*r;return a},adjoint:function(a,b){var c=b[0],e=b[1],g=b[2],d=b[3],f=b[4],h=b[5],p=b[6],k=b[7];b=b[8];a[0]=f*b-h*k;a[1]=g*k-e*b;a[2]=e*h-g*f;a[3]=h*p-d*b;a[4]=c*
b-g*p;a[5]=g*d-c*h;a[6]=d*k-f*p;a[7]=e*p-c*k;a[8]=c*f-e*d;return a},determinant:function(a){var b=a[3],c=a[4],e=a[5],g=a[6],d=a[7],f=a[8];return a[0]*(f*c-e*d)+a[1]*(-f*b+e*g)+a[2]*(d*b-c*g)},multiply:function(a,b,c){var e=b[0],g=b[1],d=b[2],f=b[3],h=b[4],p=b[5],k=b[6],l=b[7];b=b[8];var n=c[0],t=c[1],r=c[2],m=c[3],v=c[4],u=c[5],x=c[6],B=c[7];c=c[8];a[0]=n*e+t*f+r*k;a[1]=n*g+t*h+r*l;a[2]=n*d+t*p+r*b;a[3]=m*e+v*f+u*k;a[4]=m*g+v*h+u*l;a[5]=m*d+v*p+u*b;a[6]=x*e+B*f+c*k;a[7]=x*g+B*h+c*l;a[8]=x*d+B*p+c*
b;return a}};f.mul=f.multiply;f.translate=function(a,b,c){var e=b[0],g=b[1],d=b[2],f=b[3],h=b[4],p=b[5],k=b[6],l=b[7];b=b[8];var n=c[0];c=c[1];a[0]=e;a[1]=g;a[2]=d;a[3]=f;a[4]=h;a[5]=p;a[6]=n*e+c*f+k;a[7]=n*g+c*h+l;a[8]=n*d+c*p+b;return a};f.rotate=function(a,b,c){var e=b[0],g=b[1],d=b[2],f=b[3],h=b[4],p=b[5],k=b[6],l=b[7];b=b[8];var n=Math.sin(c);c=Math.cos(c);a[0]=c*e+n*f;a[1]=c*g+n*h;a[2]=c*d+n*p;a[3]=c*f-n*e;a[4]=c*h-n*g;a[5]=c*p-n*d;a[6]=k;a[7]=l;a[8]=b;return a};f.scale=function(a,b,c){var e=
c[0];c=c[1];a[0]=e*b[0];a[1]=e*b[1];a[2]=e*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};f.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];a[7]=b[1];a[8]=1;return a};f.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=-c;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};f.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};f.fromMat2d=function(a,b){a[0]=
b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};f.fromQuat=function(a,b){var c=b[0],e=b[1],g=b[2];b=b[3];var d=c+c,f=e+e,h=g+g,c=c*d,p=e*d,e=e*f,k=g*d,l=g*f,g=g*h,d=b*d,f=b*f;b*=h;a[0]=1-e-g;a[3]=p-b;a[6]=k+f;a[1]=p+b;a[4]=1-c-g;a[7]=l-d;a[2]=k-f;a[5]=l+d;a[8]=1-c-e;return a};f.normalFromMat4=function(a,b){var c=b[0],e=b[1],g=b[2],d=b[3],f=b[4],h=b[5],p=b[6],k=b[7],l=b[8],n=b[9],t=b[10],r=b[11],m=b[12],v=b[13],u=b[14];b=b[15];var x=c*h-e*f,B=c*p-g*f,C=c*k-d*f,
z=e*p-g*h,F=e*k-d*h,I=g*k-d*p,J=l*v-n*m,y=l*u-t*m,l=l*b-r*m,A=n*u-t*v,n=n*b-r*v,t=t*b-r*u,r=x*t-B*n+C*A+z*l-F*y+I*J;if(!r)return null;r=1/r;a[0]=(h*t-p*n+k*A)*r;a[1]=(p*l-f*t-k*y)*r;a[2]=(f*n-h*l+k*J)*r;a[3]=(g*n-e*t-d*A)*r;a[4]=(c*t-g*l+d*y)*r;a[5]=(e*l-c*n-d*J)*r;a[6]=(v*I-u*F+b*z)*r;a[7]=(u*C-m*I-b*B)*r;a[8]=(m*F-v*C+b*x)*r;return a};f.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};f.frob=function(a){return Math.sqrt(Math.pow(a[0],
2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};f.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];return a};f.subtract=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];return a};f.sub=f.subtract;f.multiplyScalar=
function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;return a};f.multiplyScalarAndAdd=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;a[2]=b[2]+c[2]*e;a[3]=b[3]+c[3]*e;a[4]=b[4]+c[4]*e;a[5]=b[5]+c[5]*e;a[6]=b[6]+c[6]*e;a[7]=b[7]+c[7]*e;a[8]=b[8]+c[8]*e;return a};f.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};f.equals=function(a,
b){var c=a[0],e=a[1],g=a[2],d=a[3],f=a[4],h=a[5],p=a[6],k=a[7],l=a[8],n=b[0],t=b[1],r=b[2],w=b[3],v=b[4],u=b[5];a=a[6];var x=b[7];b=b[8];return Math.abs(c-n)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(n))&&Math.abs(e-t)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))&&Math.abs(g-r)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(r))&&Math.abs(d-w)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(f-v)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(h-u)<=m.EPSILON*Math.max(1,Math.abs(h),
Math.abs(u))&&Math.abs(p-a)<=m.EPSILON*Math.max(1,Math.abs(p),Math.abs(a))&&Math.abs(k-x)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(x))&&Math.abs(l-b)<=m.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))};return f})},"esri/views/vectorTiles/renderers/vtShaderSnippets":function(){define("require exports ../../webgl/ShaderSnippets dojo/text!./Shaders.xml dojo/text!./shaders/background.vs.glsl dojo/text!./shaders/background.fs.glsl dojo/text!./shaders/lineShader.vs.glsl dojo/text!./shaders/lineShader.fs.glsl dojo/text!./shaders/patternLineShader.vs.glsl dojo/text!./shaders/patternLineShader.fs.glsl dojo/text!./shaders/lineJoinShader.vs.glsl dojo/text!./shaders/lineJoinShader.fs.glsl dojo/text!./shaders/lineJoinQuadShader.vs.glsl dojo/text!./shaders/lineJoinQuadShader.fs.glsl dojo/text!./shaders/solidFillShader.vs.glsl dojo/text!./shaders/solidFillShader.fs.glsl dojo/text!./shaders/patternFillShader.vs.glsl dojo/text!./shaders/patternFillShader.fs.glsl dojo/text!./shaders/fillOutlineShader.vs.glsl dojo/text!./shaders/fillOutlineShader.fs.glsl dojo/text!./shaders/iconShader.vs.glsl dojo/text!./shaders/iconShader.fs.glsl dojo/text!./shaders/sdfShader.vs.glsl dojo/text!./shaders/sdfShader.fs.glsl dojo/text!./shaders/tileInfo.vs.glsl dojo/text!./shaders/tileInfo.fs.glsl".split(" "),
function(m,f,a,b,c,e,g,d,q,h,p,k,l,n,t,r,w,v,u,x,B,C,z,F,I,J){function y(a,b){A+='\x3csnippet name\x3d"'+a+'"\x3e\x3c![CDATA[';A+=b;A+="]]\x3e\x3c/snippet\x3e"}var A="",A=A+'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e',A=A+"\x3csnippets\x3e";y("backgroundVS",c);y("backgroundFS",e);y("lineShaderVS",g);y("lineShaderFS",d);y("patternLineShaderVS",q);y("patternLineShaderFS",h);y("lineJoinShaderVS",p);y("lineJoinShaderFS",k);y("lineJoinQuadShaderVS",l);y("lineJoinQuadShaderFS",n);y("solidFillShaderVS",
t);y("solidFillShaderFS",r);y("patternFillShaderVS",w);y("patternFillShaderFS",v);y("fillOutlineShaderVS",u);y("fillOutlineShaderFS",x);y("iconShaderVS",B);y("iconShaderFS",C);y("sdfShaderVS",z);y("sdfShaderFS",F);y("tileInfoVS",I);y("tileInfoFS",J);A+="\x3c/snippets\x3e";m=new a;a.parse(A,m);a.parse(b,m);return m})},"esri/views/vectorTiles/renderers/LineRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec4 ../../../core/libs/gl-matrix/vec3 ../../../core/libs/gl-matrix/vec2 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),
function(m,f,a,b,c,e,g,d,q,h){return function(){function f(){this._triangleAttributeLocations={a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2};this._initialized=!1;this._viewProjMat=a.create();this._offsetVector=c.create();this._screenSize=e.create();this._color=b.create();this._dashArray=e.create()}f.prototype.dispose=function(){this._triangleslProgram&&(this._triangleslProgram.dispose(),this._triangleslProgram=null);this._patternLineProgram&&(this._patternLineProgram.dispose(),this._patternLineProgram=
null)};f.prototype.render=function(b,c,d,e,g,f,h,p,m,B){if(0!==c.triangleElementCount){this._initialized||this._initialize(b);var k=g.tileTransform.transform,l=g.coordRange/512,n=f.getPaintValue("line-translate",d);if(0!==n[0]||0!==n[1]){a.copy(this._viewProjMat,g.tileTransform.transform);var k=n[0],n=n[1],t=0,r=0,r=(1<<g.key.level)/Math.pow(2,d)*l,t=e.rotation;if(1===f.getPaintValue("line-translate-anchor",d)){e=Math.sin(q.C_DEG_TO_RAD*-t);var u=Math.cos(q.C_DEG_TO_RAD*-t),t=r*(k*u-n*e),r=r*(k*e+
n*u)}else t=r*k,r*=n;this._offsetVector[0]=t;this._offsetVector[1]=r;this._offsetVector[2]=0;a.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);k=this._viewProjMat}e=f.getPaintValue("line-pattern",d);t=void 0!==e;n=1/m;m=f.getPaintValue("line-blur",d)+n;r=f.getPaintValue("line-width",d);n=.5*(r+n);B*=f.getPaintValue("line-opacity",d);var u=f.getPaintValue("line-color",d),x=u[3]*B;this._color[0]=x*u[0];this._color[1]=x*u[1];this._color[2]=x*u[2];this._color[3]=x;if(u=this._getTrianglesVAO(b,
g)){b.bindVAO(u);if(t){if(d=h.getMosaicItemPosition(e,!0))h.bind(b,9729,d.page,1),b.bindProgram(this._patternLineProgram),this._patternLineProgram.setUniformMatrix4fv("u_transformMatrix",k),this._patternLineProgram.setUniformMatrix4fv("u_extrudeMatrix",p),this._patternLineProgram.setUniform2fv("u_normalized_origin",g.tileTransform.displayCoord),this._patternLineProgram.setUniform1f("u_depth",f.z),this._patternLineProgram.setUniform1f("u_lineHalfWidth",n),this._patternLineProgram.setUniform1f("u_blur",
m),this._patternLineProgram.setUniform1f("u_opacity",B),this._patternLineProgram.setUniform2f("u_pattern_tl",d.tl[0],d.tl[1]),this._patternLineProgram.setUniform2f("u_pattern_br",d.br[0],d.br[1]),this._patternLineProgram.setUniform2f("u_spriteSize",l*d.size[0],d.size[1]),this._patternLineProgram.setUniform1i("u_texture",1)}else h=f.getPaintValue("line-dasharray",d),2>h.length&&(h=[1,-1]),l*=r,this._dashArray[0]=l*h[0],this._dashArray[1]=l*h[1],b.bindProgram(this._triangleslProgram),this._triangleslProgram.setUniformMatrix4fv("u_transformMatrix",
k),this._triangleslProgram.setUniformMatrix4fv("u_extrudeMatrix",p),this._triangleslProgram.setUniform2fv("u_normalized_origin",g.tileTransform.displayCoord),this._triangleslProgram.setUniform1f("u_depth",f.z),this._triangleslProgram.setUniform4fv("u_color",this._color),this._triangleslProgram.setUniform1f("u_lineHalfWidth",n),this._triangleslProgram.setUniform2fv("u_dasharray",this._dashArray),this._triangleslProgram.setUniform1f("u_blur",m);b.drawElements(4,c.triangleElementCount,5125,12*c.triangleElementStart);
b.bindVAO()}}};f.prototype._initialize=function(a){if(this._initialized)return!0;var b=new g(a,h.lineShaderVS,h.lineShaderFS,this._triangleAttributeLocations);a=new g(a,h.patternLineShaderVS,h.patternLineShaderFS,this._triangleAttributeLocations);this._triangleslProgram=b;this._patternLineProgram=a;this._trianglesVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},
{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};return this._initialized=!0};f.prototype._getTrianglesVAO=function(a,b){if(b.lineTrianglesVertexArrayObject)return b.lineTrianglesVertexArrayObject;var c=b.lineVertexBuffer,e=b.lineTrianglesIndexBuffer;if(!c||!e)return null;b.lineTrianglesVertexArrayObject=new d(a,this._triangleAttributeLocations,this._trianglesVertexAttributes,{geometry:c},e);return b.lineTrianglesVertexArrayObject};return f}()})},"esri/views/vectorTiles/renderers/FillRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/mat3 ../../../core/libs/gl-matrix/vec4 ../../../core/libs/gl-matrix/vec3 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),
function(m,f,a,b,c,e,g,d,q,h){var p=1/65536;return function(){function f(){this._outlineAttributeLocations={a_pos:0,a_offset:1,a_xnormal:2};this._fillAttributeLocations={a_pos:0};this._initialized=!1;this._viewProjMat=a.create();this._offsetVector=e.create();this._patternMatrix=b.create();this._color=c.create();this._outlineColor=c.create()}f.prototype.dispose=function(){this._solidFillProgram&&(this._solidFillProgram.dispose(),this._solidFillProgram=null);this._patternFillProgram&&(this._patternFillProgram.dispose(),
this._patternFillProgram=null);this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null)};f.prototype.render=function(c,d,e,g,f,h,k,m,B,C,z){if(0!==d.triangleElementCount){this._initialized||this._initialize(c);var l=k.getPaintValue("fill-pattern",e),n=void 0!==l;if(!n||0!==f){var t=k.getPaintValue("fill-antialias",e)&&!n;z*=k.getPaintValue("fill-opacity",e);var r=k.getPaintValue("fill-color",e),x=!1;if(!n){var u=r[3]*z;1===u&&0===f&&(x=!0);1>u&&1===f&&(x=!0)}if(x||0!==f){var v=
h.tileTransform.transform,u=h.coordRange/512,w=k.getPaintValue("fill-translate",e);if(0!==w[0]||0!==w[1]){a.copy(this._viewProjMat,h.tileTransform.transform);var v=w[0],w=w[1],E=0,D=0,u=(1<<h.key.level)/Math.pow(2,e)*u;1===k.getPaintValue("fill-translate-anchor",e)?(D=Math.sin(q.C_DEG_TO_RAD*-g),g=Math.cos(q.C_DEG_TO_RAD*-g),E=u*(v*g-w*D),D=u*(v*D+w*g)):(E=u*v,D=u*w);this._offsetVector[0]=E;this._offsetVector[1]=D;this._offsetVector[2]=0;a.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);
v=this._viewProjMat}if(g=this._getTrianglesVAO(c,h))if(n?1===f&&(l=m.getMosaicItemPosition(l,!0))&&(u=h.coordRange/512/Math.pow(2,Math.round(e)-h.key.level)/C,b.identity(this._patternMatrix),n=1/(l.size[1]*u),this._patternMatrix[0]=1/(l.size[0]*u),this._patternMatrix[4]=n,c.bindVAO(g),m.bind(c,9729,l.page,1),c.bindProgram(this._patternFillProgram),this._patternFillProgram.setUniformMatrix4fv("u_transformMatrix",v),this._patternFillProgram.setUniform2fv("u_normalized_origin",h.tileTransform.displayCoord),
this._patternFillProgram.setUniform1f("u_depth",k.z),this._patternFillProgram.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix),this._patternFillProgram.setUniform1f("u_opacity",z),this._patternFillProgram.setUniform2f("u_pattern_tl",l.tl[0],l.tl[1]),this._patternFillProgram.setUniform2f("u_pattern_br",l.br[0],l.br[1]),this._patternFillProgram.setUniform1i("u_texture",1),c.drawElements(4,d.triangleElementCount,5125,12*d.triangleElementStart),c.bindVAO()):x&&(u=r[3]*z,this._color[0]=u*r[0],
this._color[1]=u*r[1],this._color[2]=u*r[2],this._color[3]=u,c.bindVAO(g),c.bindProgram(this._solidFillProgram),this._solidFillProgram.setUniformMatrix4fv("u_transformMatrix",v),this._solidFillProgram.setUniform2fv("u_normalized_origin",h.tileTransform.displayCoord),this._solidFillProgram.setUniform1f("u_depth",k.z+p),this._solidFillProgram.setUniform4fv("u_color",this._color),c.drawElements(4,d.triangleElementCount,5125,12*d.triangleElementStart),c.bindVAO()),t&&0<d.outlineElementCount&&1===f){e=
k.getPaintValue("fill-outline-color",e);if(0===e[3]){if(1!==this._color[3])return;e=r}C=.75/C;z*=e[3];this._outlineColor[0]=z*e[0];this._outlineColor[1]=z*e[1];this._outlineColor[2]=z*e[2];this._outlineColor[3]=z;if(z=this._getOutlineVAO(c,h))c.bindVAO(z),c.bindProgram(this._outlineProgram),this._outlineProgram.setUniformMatrix4fv("u_transformMatrix",v),this._outlineProgram.setUniformMatrix4fv("u_extrudeMatrix",B),this._outlineProgram.setUniform2fv("u_normalized_origin",h.tileTransform.displayCoord),
this._outlineProgram.setUniform1f("u_depth",k.z),this._outlineProgram.setUniform1f("u_outline_width",C),this._outlineProgram.setUniform4fv("u_color",this._outlineColor),c.drawElements(4,d.outlineElementCount,5125,12*d.outlineElementStart),c.bindVAO()}}}}};f.prototype._initialize=function(a){if(this._initialized)return!0;var b=new g(a,h.solidFillShaderVS,h.solidFillShaderFS,{a_pos:0});if(!b)return!1;var c=new g(a,h.patternFillShaderVS,h.patternFillShaderFS,this._fillAttributeLocations);if(!c)return!1;
a=new g(a,h.fillOutlineShaderVS,h.fillOutlineShaderFS,this._outlineAttributeLocations);this._solidFillProgram=b;this._patternFillProgram=c;this._trianglesVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};this._outlineProgram=a;this._outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,
type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};return this._initialized=!0};f.prototype._getTrianglesVAO=function(a,b){if(b.polygonTrianglesVertexArrayObject)return b.polygonTrianglesVertexArrayObject;var c=b.polygonTrianglesVertexBuffer,e=b.polygonTrianglesIndexBuffer;if(!c||!e)return null;b.polygonTrianglesVertexArrayObject=new d(a,this._fillAttributeLocations,this._trianglesVertexAttributes,{geometry:c},e);return b.polygonTrianglesVertexArrayObject};f.prototype._getOutlineVAO=function(a,
b){if(b.polygonOutlineVertexArrayObject)return b.polygonOutlineVertexArrayObject;var c=b.polygonOutlinesVertexBuffer,e=b.polygonOutlinesIndexBuffer;if(!c||!e)return null;b.polygonOutlineVertexArrayObject=new d(a,this._outlineAttributeLocations,this._outlineVertexAttributes,{geometry:c},e);return b.polygonOutlineVertexArrayObject};return f}()})},"esri/views/vectorTiles/renderers/SymbolRenderer":function(){define(["require","exports","./IconRenderer","./SDFRenderer"],function(m,f,a,b){return function(){function c(){this._iconRenderer=
new a;this._sdfRenderer=new b}c.prototype.dispose=function(){this._iconRenderer&&(this._iconRenderer.dispose(),this._iconRenderer=null);this._sdfRenderer&&(this._sdfRenderer.dispose(),this._sdfRenderer=null)};c.prototype.render=function(a,b,c,f,h,p,k,l,n,m,r,w,v){b.hasData()&&(0<b.markerPerPageElementsMap.size&&!b.isSDF&&this._iconRenderer.render(a,b,c,f,h,p,k,l,m,r,v),0<b.glyphPerPageElementsMap.size&&this._sdfRenderer.render(a,b,c,f,h,p,k,n,m,r,w,v))};return c}()})},"esri/views/vectorTiles/renderers/IconRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec3 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),
function(m,f,a,b,c,e,g,d){return function(){function f(){this._attributeLocations={a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3};this._spritesTextureSize=new Float32Array(2);this._initialized=!1;this._extrudeMat=a.create();this._scaleVec=b.create()}f.prototype.dispose=function(){this._iconProgram&&(this._iconProgram.dispose(),this._iconProgram=null)};f.prototype.render=function(b,c,d,e,f,m,q,w,v,u,x){var h=this;this._initialized||this._initialize(b);x*=q.getPaintValue("icon-opacity",d);var k=q.getLayoutValue("icon-rotation-alignment",
d);2===k&&(k=1===q.getLayoutValue("symbol-placement",d)?0:1);var k=0===k,l=q.getLayoutValue("icon-size",d);e=g.degToByte(e);k?a.copy(this._extrudeMat,v):a.copy(this._extrudeMat,u);1!==l&&(this._scaleVec[0]=l,this._scaleVec[1]=l,this._scaleVec[2]=1,a.scale(this._extrudeMat,this._extrudeMat,this._scaleVec));b.bindProgram(this._iconProgram);if(v=this._getIconVAO(b,m))b.bindVAO(v),this._iconProgram.setUniformMatrix4fv("u_transformMatrix",m.tileTransform.transform),this._iconProgram.setUniformMatrix4fv("u_extrudeMatrix",
this._extrudeMat),this._iconProgram.setUniform2fv("u_normalized_origin",m.tileTransform.displayCoord),this._iconProgram.setUniform1f("u_depth",q.z),this._iconProgram.setUniform1f("u_mapRotation",e),this._iconProgram.setUniform1f("u_keepUpright",0),this._iconProgram.setUniform1f("u_level",10*d),this._iconProgram.setUniform1f("u_fadeSpeed",10*f.fadeSpeed),this._iconProgram.setUniform1f("u_minfadeLevel",10*f.minfadeLevel),this._iconProgram.setUniform1f("u_maxfadeLevel",10*f.maxfadeLevel),this._iconProgram.setUniform1f("u_fadeChange",
10*(d+f.fadeChange)),this._iconProgram.setUniform1f("u_opacity",x),this._iconProgram.setUniform1i("u_texture",1),c.markerPerPageElementsMap.forEach(function(a,c){h._spritesTextureSize[0]=w.getWidth(c)/4;h._spritesTextureSize[1]=w.getHeight(c)/4;h._iconProgram.setUniform2fv("u_mosaicSize",h._spritesTextureSize);w.bind(b,9729,c,1);b.drawElements(4,a[1],5125,12*a[0])}),b.bindVAO()};f.prototype._initialize=function(a){if(this._initialized)return!0;this._iconProgram=new c(a,d.iconShaderVS,d.iconShaderFS,
this._attributeLocations);this._iconVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return this._initialized=!0};f.prototype._getIconVAO=function(a,b){if(b.iconVertexArrayObject)return b.iconVertexArrayObject;
var c=b.iconVertexBuffer,d=b.iconIndexBuffer;if(!c||!d)return null;b.iconVertexArrayObject=new e(a,this._attributeLocations,this._iconVertexAttributes,{geometry:c},d);return b.iconVertexArrayObject};return f}()})},"esri/views/vectorTiles/renderers/SDFRenderer":function(){define("require exports dojo/has ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec4 ../../../core/libs/gl-matrix/vec3 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),
function(m,f,a,b,c,e,g,d,q,h){var p=1/65536;return function(){function f(){this._attributeLocations={a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3};this._initialized=!1;this._extrudeMat=b.create();this._haloColor=c.create();this._sdfColor=c.create();this._scaleVec=e.create()}f.prototype.dispose=function(){this._sdfProgram&&(this._sdfProgram.dispose(),this._sdfProgram=null)};f.prototype.render=function(c,d,e,g,f,h,k,m,B,C,z,F){var l=this;if(!a("esri-vector-tiles-avoid-text")){this._initialized||this._initialize(c);
var n=k.getLayoutValue("text-size",e),r=n/24;g=q.degToByte(g);var u=k.getLayoutValue("text-rotation-alignment",e);2===u&&(u=1===k.getLayoutValue("symbol-placement",e)?0:1);var x=0===u,u=k.getLayoutValue("text-keep-upright",e)&&x,t=.1*24/n/z,v=F*k.getPaintValue("text-opacity",e);this._glyphTextureSize||(this._glyphTextureSize=new Float32Array([m.width/4,m.height/4]));x?b.copy(this._extrudeMat,B):b.copy(this._extrudeMat,C);this._scaleVec[0]=r;this._scaleVec[1]=r;this._scaleVec[2]=1;b.scale(this._extrudeMat,
this._extrudeMat,this._scaleVec);c.bindProgram(this._sdfProgram);if(B=this._getSDFVAO(c,h))c.bindVAO(B),this._sdfProgram.setUniformMatrix4fv("u_transformMatrix",h.tileTransform.transform),this._sdfProgram.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat),this._sdfProgram.setUniform2fv("u_normalized_origin",h.tileTransform.displayCoord),this._sdfProgram.setUniform1f("u_depth",k.z+p),this._sdfProgram.setUniform2fv("u_mosaicSize",this._glyphTextureSize),this._sdfProgram.setUniform1f("u_mapRotation",
g),this._sdfProgram.setUniform1f("u_keepUpright",u?1:0),this._sdfProgram.setUniform1f("u_level",10*e),this._sdfProgram.setUniform1f("u_fadeSpeed",10*f.fadeSpeed),this._sdfProgram.setUniform1f("u_minfadeLevel",10*f.minfadeLevel),this._sdfProgram.setUniform1f("u_maxfadeLevel",10*f.maxfadeLevel),this._sdfProgram.setUniform1f("u_fadeChange",10*(e+f.fadeChange)),this._sdfProgram.setUniform1f("u_opacity",v),this._sdfProgram.setUniform1i("u_texture",0),d.glyphPerPageElementsMap.forEach(function(a,b){m.bind(c,
9729,b,0);b=k.getPaintValue("text-halo-color",e);if(0<b[3]){var d=b[3]*v;l._haloColor[0]=d*b[0];l._haloColor[1]=d*b[1];l._haloColor[2]=d*b[2];l._haloColor[3]=d;b=t+k.getPaintValue("text-halo-blur",e)/r/8;d=.75-k.getPaintValue("text-halo-width",e)/r/8;l._sdfProgram.setUniform4fv("u_color",l._haloColor);l._sdfProgram.setUniform1f("u_edgeDistance",d);l._sdfProgram.setUniform1f("u_edgeWidth",b);c.drawElements(4,a[1],5125,12*a[0])}b=k.getPaintValue("text-color",e);0<b[3]&&(d=b[3]*v,l._sdfColor[0]=d*b[0],
l._sdfColor[1]=d*b[1],l._sdfColor[2]=d*b[2],l._sdfColor[3]=d,l._sdfProgram.setUniform4fv("u_color",l._sdfColor),l._sdfProgram.setUniform1f("u_edgeDistance",.75),l._sdfProgram.setUniform1f("u_edgeWidth",t),c.drawElements(4,a[1],5125,12*a[0]))}),c.bindVAO()}};f.prototype._initialize=function(a){if(this._initialized)return!0;this._sdfProgram=new g(a,h.sdfShaderVS,h.sdfShaderFS,this._attributeLocations);this._sdfVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,
divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return this._initialized=!0};f.prototype._getSDFVAO=function(a,b){if(b.textVertexArrayObject)return b.textVertexArrayObject;var c=b.textVertexBuffer,e=b.textIndexBuffer;if(!c||!e)return null;b.textVertexArrayObject=new d(a,this._attributeLocations,
this._sdfVertexAttributes,{geometry:c},e);return b.textVertexArrayObject};return f}()})},"esri/views/vectorTiles/renderers/TileInfoRenderer":function(){define("require exports ../../webgl/Program ../../webgl/VertexArrayObject ../../webgl/BufferObject ../../webgl/Texture ../GeometryUtils ./vtShaderSnippets".split(" "),function(m,f,a,b,c,e,g,d){return function(){function f(){this._initialized=!1;this._maxWidth=0;this._color=new Float32Array([1,0,0,1])}f.prototype.dispose=function(){this._outlineProgram&&
(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null)};f.prototype.render=function(a,b){this._initialized||this._initialize(a);a.bindVAO(this._outlineVertexArrayObject);a.bindProgram(this._outlineProgram);
this._outlineProgram.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform);this._outlineProgram.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord);this._outlineProgram.setUniform1f("u_coord_range",b.coordRange);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);a.setLineWidth(2);a.drawArrays(3,0,4);a.bindVAO();var c=this._getTexture(a,b);c&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(this._tileInfoProgram),
a.bindTexture(c,0),this._tileInfoProgram.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform),this._tileInfoProgram.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform1f("u_coord_ratio",b.coordRange/512),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",c.descriptor.width,c.descriptor.height),a.drawArrays(5,0,4),a.bindVAO())};f.prototype._initialize=
function(e){if(this._initialized)return!0;var g={a_pos:0},f=new a(e,d.backgroundVS,d.backgroundFS,g),h=new a(e,d.tileInfoVS,d.tileInfoFS,g),n={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},m=new Int8Array([0,0,1,0,1,1,0,1]),m=c.createVertex(e,35044,m),m=new b(e,g,n,{geometry:m}),q=new Int8Array([0,0,1,0,0,1,1,1]),q=c.createVertex(e,35044,q);e=new b(e,g,n,{geometry:q});this._outlineProgram=f;this._tileInfoProgram=h;this._vertexAttributes=n;this._outlineVertexArrayObject=
m;this._tileInfoVertexArrayObject=e;return this._initialized=!0};f.prototype._getTexture=function(a,b){if(b.texture)return b.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var c=b.key.id,d=this._canvas.getContext("2d");d.font="24px sans-serif";d.textAlign="left";d.textBaseline="middle";var f=d.measureText(c),
f=Math.pow(2,Math.ceil(g.log2(f.width+2)));f>this._maxWidth&&(this._maxWidth=f);d.clearRect(0,0,this._maxWidth,32);d.fillStyle=b.key.level>b.refKey.level?"red":"blue";d.fillText(c,0,16);b.texture=new e(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return b.texture};return f}()})},"esri/views/vectorTiles/renderers/FadeRecorder":function(){define(["require","exports","../../../core/now"],function(m,f,a){Object.defineProperty(f,"__esModule",{value:!0});(function(){return function(a,
c){this.level=a;this.now=c}})();m=function(){return function(a,c,e,g){this.fadeSpeed=a;this.minfadeLevel=c;this.maxfadeLevel=e;this.fadeChange=g}}();f.FadeProperties=m;m=function(){function b(a){void 0===a&&(a=300);this._levelSnapshots=[];this._duration=a}b.prototype.recordLevel=function(b){var c=a(),g=this._levelSnapshots;0===g.length&&(g.push({level:b,now:0}),g.push({level:b,now:0}));2!==g.length&&g[0].level===b||g.push({level:b,now:c})};b.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;
for(var a=this._duration,b=this._levelSnapshots,g=b.length,d=b[g-1],f=-1;g>f+1&&b[f+1].now+a<d.now;)f++;for(0>f&&(f=0);f<g;f++)if(b[f].level!==d.level)return!0;return!1};b.prototype.getFadeValues=function(b){void 0===b&&(b=!1);for(var c=this._duration,f=a(),d=this._levelSnapshots;3<d.length&&d[1].now+c<f;)d.shift();d[1].now+c<f&&(d[0].level=d[1].level);var m=d[0].level,h=d[d.length-1],p=h.level,k=Math.min(m,p),m=Math.max(m,p),d=(h.level-d[1].level)/((h.now-d[1].now)/c);return b?{fadeSpeed:0,minfadeLevel:k,
maxfadeLevel:m,fadeChange:0}:{fadeSpeed:d,minfadeLevel:k,maxfadeLevel:m,fadeChange:(f-h.now)/c*d}};return b}();f.FadeRecorder=m})},"url:esri/views/vectorTiles/renderers/Shaders.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\x3c!--\r\n  Add your GLSL snippets to this file. You should start from\r\n  importing your old GLSL files. For instance, if you have a\r\n  file such as myShader.vs.glsl you should create a new \x3csnippet name\x3d"myShaderVS"\x3e\r\n  and then copy and paste the GLSL source as the content. You will then convert your\r\n  code to use the {@link module:esri/views/vectorTiles/renderers/vtShaderSnippets vtShaderSnippets}\r\n  instance to access the GLSL code, instead of importing it directly with require("dojo/text!...").\r\n--\x3e\r\n\x3csnippets\x3e\r\n\r\n  \x3csnippet name\x3d"foobarVS"\x3e\r\n  \x3c/snippet\x3e\r\n\r\n  \x3csnippet name\x3d"foobarFS"\x3e\r\n  \x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n\r\n',
"url:esri/views/vectorTiles/renderers/shaders/background.vs.glsl":"attribute vec2 a_pos;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform mediump vec2 u_normalized_origin;\r\nuniform mediump float u_coord_range;\r\nuniform mediump float u_depth;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(u_coord_range * a_pos, 0.0, 1.0);\r\n}\r\n","url:esri/views/vectorTiles/renderers/shaders/background.fs.glsl":"uniform lowp vec4 u_color;\r\nvoid main() {\r\n  gl_FragColor \x3d u_color;\r\n}",
"url:esri/views/vectorTiles/renderers/shaders/lineShader.vs.glsl":"/* The implementation of the renderer is based on the article and implementation of MB described here:\r\n* https://www.mapbox.com/blog/drawing-antialiased-lines/\r\n*/\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_offsetAndNormal;\r\nattribute vec2 a_accumulatedDistance;\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n// the z of the layer. Given by the order of the layers in the style\r\nuniform mediump float u_depth;\r\n// the inset and outset of the line\r\nuniform mediump float u_lineHalfWidth;\r\n// the interpolated normal to the line. the information is packed into the two LSBs of the vertex coordinate\r\nvarying mediump vec2 v_normal;\r\n// the accumulated distance along the line. We need this information in order to render the dashes.\r\nvarying highp float v_accumulatedDistance;\r\n\r\nconst float scale \x3d 1.0 / 31.0;\r\n\r\nvoid main()\r\n{\r\n  v_normal \x3d a_offsetAndNormal.zw * scale;\r\n\r\n  // calculate the relative distance from the centerline to the edge of the line. Since offset is given in integers (for the\r\n  // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\r\n  mediump vec2 dist \x3d u_lineHalfWidth * a_offsetAndNormal.xy * scale;\r\n\r\n  // transform the vertex\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\r\n\r\n  // the accumulated distance will be used to calculate the dashes (or the no-data...)\r\n  v_accumulatedDistance \x3d a_accumulatedDistance.x;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/lineShader.fs.glsl":"/* The implementation of the renderer is based on the article and implementation of MB described here:\r\n* https://www.mapbox.com/blog/drawing-antialiased-lines/\r\n*/\r\n\r\nuniform mediump float u_lineHalfWidth;\r\nuniform lowp vec4 u_color;\r\nuniform mediump vec2 u_dasharray;\r\nuniform lowp float u_blur;\r\n\r\nvarying mediump vec2 v_normal;\r\nvarying highp float v_accumulatedDistance;\r\n\r\nvoid main()\r\n{\r\n  // dist represent the distance of the fragment from the line. 1.0 or -1.0 will be the values on the edge of the line,\r\n  // and any value in between will be inside the line (the sign represent the direction - right or left).\r\n  // since u_linewidth.s (half line width) is represented in pixels, dist is also given in pixels\r\n  mediump float fragDist \x3d length(v_normal) * u_lineHalfWidth;\r\n\r\n  // calculate the alpha given the difference between the line-width and the distance of the fragment from the center-line.\r\n  // We need to count for both sides of the line.\r\n  lowp float alpha \x3d clamp( min(fragDist + u_blur + 1.0, u_lineHalfWidth - fragDist) / u_blur, 0.0, 1.0);\r\n\r\n  // now calculate the dashes given the accumulated distance of the line:\r\n  // start with calculating a normalized position along the line\r\n  lowp float dashPos \x3d  mod(v_accumulatedDistance, u_dasharray.x + u_dasharray.y);\r\n\r\n  // calculate the contribution to the alpha of the dash part. It is provided by the shortest portion of the position along the dash.\r\n  // we must clamp since the value might be bigger than 1 or smaller than zero (when over a dash).\r\n  //   | \x3c--- pos along the dash part\r\n  // -------_______-------_______\r\n  // when the dashPos is over the 'gap' part of the dash u_dasharray.x - dashPos is negative and therefore the alpha will\r\n  // get clamped to zero.\r\n  // when u_dasharray.x - dashPos is positive, or when dashPos is smaller than 1.0, it gives us a soft edge to each dash part.\r\n  // along the direction of the line.\r\n  lowp float dashAlpha \x3d clamp( min(dashPos, u_dasharray.x - dashPos), 0.0, 1.0);\r\n\r\n  // if we don't have a no-data part to the dash then it is a solid line\r\n  dashAlpha \x3d max(sign(-u_dasharray.y), dashAlpha); //sign(-u_dasharray.y) \x3e 0.0 ? 1.0 : dashAlpha;\r\n  // finally multiply the fragment's alpha by the calculated dash-alpha\r\n  alpha *\x3d dashAlpha;\r\n\r\n  // output the fragment color\r\n gl_FragColor \x3d alpha * u_color;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/patternLineShader.vs.glsl":"attribute vec2 a_pos;\r\nattribute vec4 a_offsetAndNormal;\r\nattribute vec2 a_accumulatedDistance;\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n// the z of the layer. Given by the order of the layers in the style\r\nuniform mediump float u_depth;\r\n// the inset and outset of the line\r\nuniform mediump float u_lineHalfWidth;\r\n// the interpolated normal to the line. the information is packed into the two LSBs of the vertex coordinate\r\nvarying mediump vec2 v_normal;\r\n// the accumulated distance along the line. We need this information in order to render the dashes.\r\nvarying highp float v_accumulatedDistance;\r\n\r\nconst float scale \x3d 1.0 / 31.0;\r\n\r\nvoid main()\r\n{\r\n  v_normal \x3d a_offsetAndNormal.zw * scale;\r\n\r\n  // calculate the relative distance from the centerline to the edge of the line. Since offset is given in integers (for the\r\n  // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\r\n  // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\r\n  mediump vec2 dist \x3d u_lineHalfWidth * a_offsetAndNormal.xy * scale;\r\n\r\n  // transform the vertex\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\r\n\r\n  // the accumulated distance will be used to calculate the dashes (or the no-data...)\r\n  v_accumulatedDistance \x3d a_accumulatedDistance.x;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/patternLineShader.fs.glsl":"uniform mediump float u_lineHalfWidth;\r\nuniform lowp float u_blur;\r\nuniform lowp float u_opacity;\r\nuniform mediump vec2 u_pattern_tl;\r\nuniform mediump vec2 u_pattern_br;\r\nuniform mediump vec2 u_spriteSize;\r\nuniform sampler2D u_texture;\r\n\r\nvarying mediump vec2 v_normal;\r\nvarying highp float v_accumulatedDistance;\r\n\r\n// Horizontal scale is used to scale the horizontal texture coordinate v_normal.x before adding it as an offset to the\r\n// accumulated distance. Most vertices will have v_normal.x \x3d\x3d 0, because the pattern must be sampled only depending on\r\n// the v_accumulatedDistance value. But tessellation at caps can have vertices with v_normal.x !\x3d 0, thus allowing to\r\n// \"keep moving\" for a few more pixel even when the line has ended or has not started yet.\r\nconst mediump float tileCoordRatio \x3d 8.0;\r\n\r\nvoid main()\r\n{\r\n  // dist represent the distance of the fragment from the line. 1.0 or -1.0 will be the values on the edge of the line,\r\n  // and any value in between will be inside the line (the sign represent the direction - right or left).\r\n  // since u_linewidth.s (half line width) is represented in pixels, dist is also given in pixels\r\n  mediump float fragDist \x3d length(v_normal) * u_lineHalfWidth;\r\n\r\n  // calculate the alpha given the difference between the line-width and the distance of the fragment from the center-line.\r\n  // We need to count for both sides of the line.\r\n  lowp float alpha \x3d clamp( min(fragDist + u_blur + 1.0, u_lineHalfWidth - fragDist) / u_blur, 0.0, 1.0);\r\n  // add the line's opacity to the alpha\r\n  alpha *\x3d u_opacity;\r\n\r\n  // we need to calculate the relative portion of the line texture along the line given the accumulated distance aliong the line\r\n  // The computed value should is anumber btween 0 and 1 which will later be used to interpolate btween the BR and TL values\r\n  mediump float relativeTexX \x3d mod((v_accumulatedDistance + v_normal.x * u_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\r\n\r\n  // in order to calculate the texture coordinates prependicular to the line (Y axis), we use the interpolated normal values\r\n  // which range from -1.0 to 1.0. On the line's centerline, the value of the interpolated normal is 0.0, however the relative\r\n  // texture value shpould be 0.5 (given that at the bottom of the line, the texture coordinate must be equal to 0.0)\r\n  // (TL) ---------------------------      --\x3e left edge of line. Interpolatedf normal is 1.0\r\n  //              | -\x3e linwe-width / 2\r\n  //      - - - - - - - - - - - - - -\r\n  //              | -\x3e linwe-width / 2\r\n  //      ---------------------------- (BR)--\x3e right edge of line. Interpolatedf normal is -1.0\r\n\r\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * u_lineHalfWidth / u_spriteSize.y);\r\n\r\n  // claculate the actual texture coordinates by interpolating between the TL/BR pattern coordinates\r\n  mediump vec2 texCoord \x3d mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\r\n\r\n  // get the color from the texture\r\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\r\n\r\n  // finally write the fragment value\r\n  gl_FragColor \x3d alpha * color;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/lineJoinShader.vs.glsl":"attribute vec2 a_pos;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform highp vec2 u_normalized_origin;\r\nuniform highp float u_depth;\r\nuniform highp vec2 u_screen;\r\nuniform mediump float u_size;\r\nuniform mediump float u_pixelRatio;\r\n\r\nvarying mediump vec2 v_vertexPosition;\r\n\r\nvoid main()\r\n{\r\n  gl_PointSize \x3d u_pixelRatio * u_size;\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0);\r\n\r\n  // calculate the vertex position in pixels (we need to add one in order to shift the origin from the center of the viewport)\r\n  v_vertexPosition \x3d (gl_Position.xy + 1.0) * u_screen;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/lineJoinShader.fs.glsl":"uniform lowp vec4 u_color;\r\nuniform mediump float u_lineHalfWidth;\r\nuniform mediump float u_oneOverPixelRatio;\r\n\r\nvarying mediump vec2 v_vertexPosition;\r\n\r\nvoid main()\r\n{\r\n  // get the distance of the current fragment from the actual vertex\r\n  mediump float fragDist \x3d length(v_vertexPosition - u_oneOverPixelRatio * gl_FragCoord.xy);\r\n\r\n  // rounding the quare: calculate the alpha given the difference between the line-width and the distance of the fragment\r\n  // from the center-line. We will end up with a nice round circle with a soft edge.\r\n  lowp float alpha \x3d clamp(u_lineHalfWidth - fragDist, 0.0, 1.0);\r\n\r\n  // finally output the fragment color\r\n  gl_FragColor \x3d alpha * u_color;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/lineJoinQuadShader.vs.glsl":"attribute vec2 a_pos;\r\nattribute vec2 a_vertexOffset;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform highp mat4 u_extrudeMatrix;\r\nuniform highp vec2 u_normalized_origin;\r\nuniform highp float u_depth;\r\n// The width/height of the screen\r\nuniform mediump vec2 u_screen;\r\n// u_size is the diameter of the join in tile units\r\nuniform mediump float u_size;\r\n\r\nvarying mediump vec2 v_fragmentOffset;\r\n\r\nvoid main()\r\n{\r\n  // calculate the offset in pixels from the join's center to the vertex\r\n  highp vec2 dist \x3d u_size * a_vertexOffset;\r\n\r\n  // calculate the position of the join's center in normalized coordinates\r\n  highp vec4 center_pos \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0);\r\n\r\n  // offset in normalized display units\r\n  highp vec4 vertex_offset \x3d u_extrudeMatrix * vec4(dist, 0.0, 0.0);\r\n\r\n  // calculate the vertex offset in windows coordinates\r\n  v_fragmentOffset \x3d u_screen * vertex_offset.xy;\r\n\r\n  // finally calculate the vertex position\r\n  gl_Position \x3d center_pos + vertex_offset;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/lineJoinQuadShader.fs.glsl":"uniform lowp vec4 u_color;\r\nuniform mediump float u_lineHalfWidth;\r\n\r\nvarying mediump vec2 v_fragmentOffset;\r\n\r\nvoid main()\r\n{\r\n  // Calculate the antialiasing fade factor\r\n  lowp float alpha \x3d clamp(u_lineHalfWidth * u_lineHalfWidth - dot(v_fragmentOffset, v_fragmentOffset), 0.0, 1.0);\r\n  //lowp float alpha  \x3d 1.0 - smoothstep(u_lineHalfWidth - 0.25, u_lineHalfWidth + 0.25, dist);\r\n  // YF: if needed w can also use a smoothstep around the edge of the circle and use a single pixel or so as the edge width\r\n\r\n  // finally output the fragment color\r\n  gl_FragColor \x3d alpha * u_color;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/solidFillShader.vs.glsl":"attribute vec2 a_pos;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform highp vec2 u_normalized_origin;\r\nuniform mediump float u_depth;\r\n\r\nvoid main()\r\n{\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0, 1.0);\r\n}\r\n","url:esri/views/vectorTiles/renderers/shaders/solidFillShader.fs.glsl":"uniform lowp vec4 u_color;\r\nvoid main()\r\n{\r\n  gl_FragColor \x3d u_color;\r\n}",
"url:esri/views/vectorTiles/renderers/shaders/patternFillShader.vs.glsl":"uniform highp mat4 u_transformMatrix;\r\nuniform highp vec2 u_normalized_origin;\r\nuniform mediump float u_depth;\r\nuniform mediump mat3 u_pattern_matrix; // can we use meduim precision??\r\n\r\nattribute vec2 a_pos;\r\n\r\nvarying mediump vec2 v_tileTextureCoord;\r\n\r\nvoid main()\r\n{\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0);\r\n  // calculate the texture coordinates of the current vertex. It will of course get interpolated.\r\n  // The pattern matrix is a 3x3 scale matrix which 'tiles' the texture inside the tile, translating from tile coordinates\r\n  // (-4k to 8k -1) to texture coordinates.\r\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/patternFillShader.fs.glsl":"uniform lowp float u_opacity;\r\nuniform mediump vec2 u_pattern_tl;\r\nuniform mediump vec2 u_pattern_br;\r\nuniform sampler2D u_texture;\r\n\r\nvarying mediump vec2 v_tileTextureCoord;\r\n\r\nvoid main()\r\n{\r\n  // normalize the calculated texture coordinate such that it fits in the range of 0 to 1.\r\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\r\n  // interpolate the image coordinate between the top-left and the bottom right to get the actual position to sample.\r\n  // after normalizing the position, we get a value ranging between 0 and 1 which refers to the entire texture, however\r\n  // we need to only sample from area that has our sprite in the mosaic.\r\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\r\n  // sample the sprite mosaic\r\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\r\n  gl_FragColor \x3d u_opacity * color;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/fillOutlineShader.vs.glsl":"attribute vec2 a_pos;\r\nattribute vec2 a_offset;\r\nattribute vec2 a_xnormal;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform highp mat4 u_extrudeMatrix;\r\nuniform highp vec2 u_normalized_origin;\r\nuniform mediump float u_depth;\r\nuniform mediump float u_outline_width;\r\n\r\nvarying lowp vec2 v_normal;\r\n\r\nconst float scale \x3d 1.0 / 15.0;\r\n\r\nvoid main()\r\n{\r\n  v_normal \x3d a_xnormal;\r\n\r\n   // calculate the relative distance from the centerline to the edge of the line. Since offset is given in integers (for the\r\n    // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\r\n  mediump vec4 dist \x3d vec4(u_outline_width * a_offset * scale, 0.0, 0.0);\r\n\r\n  // Remove the texture normal bit of the position before scaling it with the\r\n  // model/view matrix. Add the extrusion vector *after* the model/view matrix\r\n  // because we're extruding the line in pixel space, regardless of the current\r\n  // tile's zoom level.\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * dist;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/fillOutlineShader.fs.glsl":"uniform lowp vec4 u_color;\r\nvarying mediump vec2 v_normal;\r\n\r\nvoid main()\r\n{\r\n  // Calculate the distance of the pixel from the line in pixels.\r\n  lowp float dist \x3d abs(v_normal.y);\r\n\r\n  lowp float alpha \x3d smoothstep(1.0, 0.0, dist);\r\n  gl_FragColor \x3d alpha * u_color;\r\n}\r\n","url:esri/views/vectorTiles/renderers/shaders/iconShader.vs.glsl":"attribute vec2 a_pos;\r\nattribute vec2 a_vertexOffset;\r\nattribute vec4 a_tex;\r\nattribute vec4 a_levelInfo;\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n// the size of the mosaic given in pixels\r\nuniform vec2 u_mosaicSize;\r\n// the z of the layer. Given by the order of the layers in the style\r\nuniform mediump float u_depth;\r\n// the map's rotation from the north\r\nuniform mediump float u_mapRotation;\r\nuniform mediump float u_level;\r\n// indicate whether the current set of iconst should be kept upright when the map is rotated\r\nuniform lowp float u_keepUpright;\r\n// the rate of the change in the opacity (fade) of the icons\r\nuniform mediump float u_fadeSpeed;\r\n// the low level we transition (to/from)\r\nuniform mediump float u_minfadeLevel;\r\n// the high level we transition (to/from)\r\nuniform mediump float u_maxfadeLevel;\r\n// the amount of fade given teh current time past the last recorded level\r\nuniform mediump float u_fadeChange;\r\n// the opacity of the layer given by the painter\r\nuniform mediump float u_opacity;\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying lowp vec2 v_tex;\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n\r\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precission we multiply the values\r\n// by 16 and then at the shader devide by the same number\r\nconst float offsetPrecision \x3d 1.0 / 32.0;\r\n\r\nvoid main()\r\n{\r\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\r\n  mediump float a_angle        \x3d a_levelInfo[1];\r\n  mediump float a_minLevel    \x3d a_levelInfo[2];\r\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\r\n\r\n  // if the given vertex should not be visible simply clip it by adding it a value that will push it outside the clipping plane\r\n  mediump float delta_z \x3d 0.0;\r\n\r\n  // If the label rotates with the map, and if the rotated label is upside down, hide it\r\n  mediump float rotated \x3d mod(a_angle - u_mapRotation, 256.0);\r\n  delta_z +\x3d (1.0 - step(u_keepUpright,0.0)) * step(65.0,rotated) * (1.0 - step(193.0,rotated)); //ie. z +\x3d (flip \x3e 0) \x26\x26 (65 \x3c\x3d rotated) \x26\x26 (rotated \x3c 193)\r\n\r\n  // u_level is the current service level adjusted for the change in font size\r\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level); // Test if (level \x3c minLevel)\r\n  delta_z +\x3d step(a_maxLevel, u_level); // Test if (maxLevel \x3c\x3d level)\r\n\r\n  // calculate the alpha given the change in the fade and the fade-speed\r\n  lowp float alpha \x3d clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\r\n\r\n  // if the speed is positive we are zooming in and therefore we need to 'fade-in'. Else we need to 'fade-out'\r\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\r\n\r\n  // now deal with the min/max fade-levels. If we exceeded the level we simply snap to 0 or 1\r\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\r\n  {\r\n      v_transparency \x3d 0.0;\r\n  }\r\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\r\n  {\r\n      v_transparency \x3d 1.0;\r\n  }\r\n\r\n  // if label had been faded out, clip it\r\n  delta_z +\x3d step(v_transparency, 0.0);\r\n\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(offsetPrecision * a_vertexOffset, delta_z, 0.0);\r\n  v_tex \x3d a_tex.xy / u_mosaicSize;\r\n\r\n  v_transparency *\x3d u_opacity;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/iconShader.fs.glsl":"uniform lowp sampler2D u_texture;\r\nvarying lowp vec2 v_tex;\r\nvarying lowp float v_transparency;\r\n\r\nvoid main()\r\n{\r\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\r\n  gl_FragColor \x3d v_transparency * color;\r\n}\r\n","url:esri/views/vectorTiles/renderers/shaders/sdfShader.vs.glsl":"attribute vec2 a_pos;\r\nattribute vec2 a_vertexOffset;\r\nattribute vec4 a_tex;\r\nattribute vec4 a_levelInfo;\r\n\r\n// attribute bool a_visible; // --\x3e a one bit controlling the visibility of the vertex\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n// the size of the mosaic given in pixels\r\nuniform vec2 u_mosaicSize;\r\n// the z of the layer. Given by the order of the layers in the style\r\nuniform mediump float u_depth;\r\n// the map's rotation from the north\r\nuniform mediump float u_mapRotation;\r\nuniform mediump float u_level;\r\n// indicate whether the current set of iconst should be kept upright when the map is rotated\r\nuniform lowp float u_keepUpright;\r\n// the rate of the change in the opacity (fade) of the icons\r\nuniform mediump float u_fadeSpeed;\r\n// the low level we transition (to/from)\r\nuniform mediump float u_minfadeLevel;\r\n// the high level we transition (to/from)\r\nuniform mediump float u_maxfadeLevel;\r\n// the amount of fade given teh current time past the last recorded level\r\nuniform mediump float u_fadeChange;\r\n// the opacity of the layer given by the painter\r\nuniform mediump float u_opacity;\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying lowp vec2 v_tex;\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n\r\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precission we multiply the values\r\n// by 16 and then at the shader devide by the same number\r\nconst float offsetPrecision \x3d 1.0 / 32.0;\r\n\r\nvoid main()\r\n{\r\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\r\n  mediump float a_angle        \x3d a_levelInfo[1];\r\n  mediump float a_minLevel    \x3d a_levelInfo[2];\r\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\r\n\r\n  // if the given vertex should not be visible simply clip it by adding it a value that will push it outside the clipping plane\r\n  mediump float delta_z \x3d 0.0;\r\n\r\n  // TODO: force clipping the vertex in case that the vertex isn't visible\r\n  //delta_z +\x3d a_visible ? 0.0 : 1.0;\r\n\r\n  // If the label rotates with the map, and if the rotated label is upside down, hide it\r\n  mediump float rotated \x3d mod(a_angle - u_mapRotation, 256.0);\r\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(65.0, rotated) * (1.0 - step(193.0, rotated)); //ie. z +\x3d (flip \x3e 0) \x26\x26 (65 \x3c\x3d rotated) \x26\x26 (rotated \x3c 193)\r\n\r\n  // u_level is the current service level adjusted for the change in font size\r\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level); // Test if (level \x3c minLevel)\r\n  delta_z +\x3d step(a_maxLevel, u_level); // Test if (maxLevel \x3c\x3d level)\r\n\r\n  // calculate the alpha given the change in the fade and the fade-speed\r\n  lowp float alpha \x3d clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\r\n\r\n  // if the speed is positive we are zooming in and therefore we need to 'fade-in'. Else we need to 'fade-out'\r\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\r\n\r\n  // now deal with the min/max fade-levels. If we exceeded the level we simply snap to 0 or 1\r\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\r\n  {\r\n      v_transparency \x3d 0.0;\r\n  }\r\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\r\n  {\r\n      v_transparency \x3d 1.0;\r\n  }\r\n\r\n  // if label has been faded out, clip it\r\n  delta_z +\x3d step(v_transparency, 0.0);\r\n\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(offsetPrecision * a_vertexOffset, delta_z, 0.0);\r\n  v_tex \x3d a_tex.xy / u_mosaicSize;\r\n\r\n  v_transparency *\x3d u_opacity;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/sdfShader.fs.glsl":"uniform lowp sampler2D u_texture;\r\nuniform lowp vec4 u_color;\r\nuniform mediump float u_edgeDistance;\r\nuniform mediump float u_edgeWidth;\r\n\r\nvarying lowp vec2 v_tex;\r\nvarying lowp float v_transparency;\r\n\r\n// this is taken from http://www.valvesoftware.com/publications/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf\r\n// and https://www.mapbox.com/blog/text-signed-distance-fields/\r\n// http://metalbyexample.com/rendering-text-in-metal-with-signed-distance-fields/\r\n\r\nvoid main()\r\n{\r\n  // read the distance from the SDF texture\r\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\r\n  // use a smooth-step in order to calculate the geometry of the shape given by the distance field\r\n  mediump float alpha \x3d smoothstep(u_edgeDistance - u_edgeWidth, u_edgeDistance + u_edgeWidth, dist) * v_transparency;\r\n\r\n  gl_FragColor \x3d alpha * u_color;\r\n\r\n// YF: this code allow having both a fill and an outline colors combined in a single pass\r\n//  lowp float geometryAlpha \x3d smoothstep(0.75 - 0.21, 0.75 + 0.21, dist) * v_transparency;\r\n//  lowp vec4 geometryColor \x3d vec4(u_color.rgb, geometryAlpha * u_color.a);\r\n//\r\n//  if (true) {\r\n//    lowp float haloAlpha \x3d smoothstep(0.0 - 0.1, 0.0 + 0.1, dist) * v_transparency;\r\n//    lowp vec4 haloColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n//    haloColor \x3d vec4(haloColor.rgb, haloAlpha);\r\n//\r\n//    // calculate the composite color\r\n//    lowp float compositeAlpha \x3d geometryColor.a + haloColor.a * (1.0 - geometryColor.a);\r\n//    lowp vec3 compositeColor \x3d vec3(geometryColor) * geometryColor.a + vec3(haloColor) * haloColor.a * (1.0 - geometryColor.a);\r\n//    compositeColor /\x3d compositeAlpha;\r\n//    gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n//  }\r\n//  else {\r\n//    gl_FragColor \x3d geometryColor;\r\n//  }\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/tileInfo.vs.glsl":"attribute vec2 a_pos;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform mediump vec2 u_normalized_origin;\r\nuniform mediump float u_depth;\r\nuniform mediump float u_coord_ratio;\r\nuniform mediump vec2 u_delta; // in tile coordinates\r\nuniform mediump vec2 u_dimensions; // in tile coordinates\r\n\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main() {\r\n  mediump vec2 offests \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(offests, 0.0, 1.0);\r\n\r\n  v_tex \x3d a_pos;\r\n}\r\n",
"url:esri/views/vectorTiles/renderers/shaders/tileInfo.fs.glsl":"uniform mediump sampler2D u_texture;\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main(void) {\r\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\r\n  gl_FragColor \x3d 0.75 * color;\r\n}\r\n","*noref":1}});
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/HandleRegistry ../../../core/promiseUtils ./LayerView2D ../engine/StageGL ../tiling/TileInfoViewPOT ../tiling/TileStrategy ../tiling/TileKey ../tiling/TileQueue ../../../views/vectorTiles/TileHandler ../../../views/vectorTiles/VectorTileContainer ../../../views/vectorTiles/VectorTileDisplayObject ../../support/screenshotUtils".split(" "),function(m,
f,a,b,c,e,g,d,q,h,p,k,l,n,t,r,w){return function(d){function f(){var a=null!==d&&d.apply(this,arguments)||this;a._handles=new e;a._fetchQueue=null;a._tileRequests=new Map;a.container=new q;return a}a(f,d);f.prototype.hitTest=function(a,b){return null};f.prototype.update=function(a){if(this._vectorTileContainer&&this._vectorTileContainer.isInitialized)if(a.devicePixelRatio!==this._tileHandler.devicePixelRatio)this._start();else{this._fetchQueue.pause();this._fetchQueue.state=a.state;this._tileStrategy.update(a);
this._fetchQueue.resume();for(var b=0,c=this._vectorTileContainer.children;b<c.length;b++)this._tileHandler.updateTile(c[b],a);this.notifyChange("updating")}};f.prototype.attach=function(){this._start()};f.prototype.detach=function(){this._stop()};f.prototype.moveStart=function(){this.requestUpdate()};f.prototype.viewChange=function(){this.requestUpdate()};f.prototype.moveEnd=function(){this.requestUpdate()};f.prototype.destroy=function(){this.container.dispose();this._vectorTileContainer.destroy();
this._tileHandler.destroy()};f.prototype.takeScreenshot=function(a,b){if(!this.container)return g.reject("Could not find an object capable of capturing screenshot!");a=w.adjustScreenshotSettings(a,b);return this.container.takeScreenshot(a)};f.prototype.isUpdating=function(){var a=!0;this._tileRequests.forEach(function(b){a=a&&b.isFulfilled()});return!a};f.prototype.acquireTile=function(a){var b=this,c=k.pool.acquire();c.set(a.level,a.row,a.col,a.world);a=this._tileHandler.getRefKey(c);var d=this.updateParameters.state.rotation,
e=this._tileHandler.getStyleRepository(),f=r.pool.acquire(c,a,this.layer.tileInfo,e,this._tileHandler.glyphMosaic,d);a=this._fetchQueue.push(f.key).then(function(a){f.setData(a.tileData,a.workerId,a.connection);f.once("attach",function(){return b.requestUpdate()});b._vectorTileContainer.addChild(f);b.notifyChange("updating")});this._tileRequests.set(c.id,a);this.notifyChange("updating");return f};f.prototype.releaseTile=function(a){var b=a.key.id,c=this._tileRequests.get(b);c.isFulfilled()||c.cancel();
this._tileRequests.delete(b);this._vectorTileContainer.removeChild(a);this.requestUpdate();a.once("detach",function(){return r.pool.release(a)});this.notifyChange("updating")};f.prototype._stop=function(){this._handles.removeAll();this._tileStrategy&&this._tileStrategy.destroy();this._vectorTileContainer&&(this._vectorTileContainer.removeAllChildren(),this.container.removeChild(this._vectorTileContainer));this._tileHandler&&this._tileHandler.stop();r.pool.prune();this._vectorTileContainer=this._tileHandler=
this._tileStrategy=this._tileInfoView=null};f.prototype._start=function(){var a=this;this._stop();this._handles.add(this.watch("layer.currentStyleInfo",function(){return a.attach()}));this._vectorTileContainer=new t;this.container.addChild(this._vectorTileContainer);this._tileInfoView=new h(this.layer.tileInfo,this.layer.fullExtent);this._tileStrategy=new p({cachePolicy:"keep",acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},tileInfoView:this._tileInfoView});
this._fetchQueue=new l({tileInfoView:this._tileInfoView,process:function(b){return a._getTileData(b)}});this._tileHandler=new n(this.layer,function(){return a.requestUpdate()},window.devicePixelRatio||1,!0,this._tileInfoView);this._tileHandler.start().then(function(){a._vectorTileContainer.initialize(a._tileHandler.spriteMosaic,a._tileHandler.glyphMosaic,a.layer.tileInfo,a._tileInfoView);a.requestUpdate()})};f.prototype._getTileData=function(a){return this._tileHandler.getTileData(a,this.updateParameters.state.rotation)};
return f=b([c.subclass("esri.views.2d.layers.VectorTileLayerView2D")],f)}(c.declared(d))});