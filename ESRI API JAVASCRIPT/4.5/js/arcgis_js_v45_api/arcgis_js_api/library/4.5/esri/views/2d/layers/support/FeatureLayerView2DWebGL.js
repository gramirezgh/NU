// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/webgl/rendererInfoUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../support/arcadeUtils ../../../../arcade/Feature ./visualVariablesUtils".split(" "),function(C,l,a,b,d,g){function h(e,d){if(!e)return null;var p=0,k={};e=e.clone();var n=e.valueExpression,f=e.visualVariables,h=null;if(!e.field&&n){var q="$$fake"+p++,r=b.createFunction(n);k[q]=function(k,a){c.attributes=k.attributes;return b.executeFunction(r,{vars:{$feature:c,
$view:b.getViewInfo(a)},spatialReference:d})};e.field=q;e.valueExpression=null;h=function(c,a){a.attributes[q]=k[q](a);return c.getSymbol(a)}}f&&(e.visualVariables=f.map(function(f){if(f.normalizationField){var e=f.field,n=f.normalizationField,m="$$fake"+p++;k[m]=function(c,m){return c.attributes[e]/c.attributes[n]};f=a({},f);f.field=m;delete f.normalizationField;return f}if(f.valueExpression&&"$view.scale"!==f.valueExpression){var v=f.valueExpression,m="$$fake"+p++,q=b.createFunction(v);k[m]=function(m,
k){c.attributes=m.attributes;return b.executeFunction(q,{vars:{$feature:c,$view:b.getViewInfo(k)},spatialReference:d})};f=a({},f);f.field=m;delete f.valueExpression}return f}));return{renderer:e,normalizingFunctions:k,getSymbolFunction:h}}Object.defineProperty(l,"__esModule",{value:!0});var c=new d(null);l.createRendererInfo=function(c,a){var b=(a=h(c,a)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},a.normalizingFunctions),k=a&&a.getSymbolFunction;c=a&&a.renderer||c;a=null;if("heatmap"===
c.type){var n=c.offset;a=9*Math.round(c.blurRadius)+1;a={getIntensity:function(c){return"function"===typeof c?c:c?"abs"===n?function(a){return Math.abs(a.attributes[c])}:function(a){return a.attributes[c]+n}:function(c){return 1}}(c.field),kernelSize:a,radius:c.blurRadius}}var f=g.convertVisualVariables(c.visualVariables);return{renderer:c,vvFields:f.vvFields,vvRanges:f.vvRanges,heatmapInfo:a,getValue:function(c,a){var k=b[a];return k?k(c):c.attributes[a]},getSymbol:function(c){return k?k(this.renderer,
c):this.renderer.getSymbol?this.renderer.getSymbol(c):null}}};l.getSymbol=function(c,a){return c.getSymbol(a)}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/screenUtils ../../../3d/layers/support/FastSymbolUpdates ./Utils ./enums".split(" "),function(C,l,a,b,d,g){function h(c){return d.isNumber(c.minDataValue)&&d.isNumber(c.maxDataValue)&&null!=c.minSize&&null!=c.maxSize?g.WGLVVFlag.SIZE_MINMAX_VALUE:(c.expression&&"view.scale"===c.expression||
c.valueExpression&&"$view.scale"===c.valueExpression)&&Array.isArray(c.stops)?g.WGLVVFlag.SIZE_SCALE_STOPS:(null!=c.field||c.expression&&"view.scale"!==c.expression||c.valueExpression&&"$view.scale"!==c.valueExpression)&&Array.isArray(c.stops)?g.WGLVVFlag.SIZE_FIELD_STOPS:(null!=c.field||c.expression&&"view.scale"!==c.expression||c.valueExpression&&"$view.scale"!==c.valueExpression)&&null!=c.valueUnit?g.WGLVVFlag.SIZE_UNIT_VALUE:g.WGLVVFlag.NONE}function c(c){return{value:c.value,size:a.toPt(c.size)}}
function e(a){return a.map(function(a){return c(a)})}function r(c){return"string"===typeof c||"number"===typeof c?a.toPt(c):{type:"size",expression:c.expression,stops:e(c.stops)}}function p(c){var a={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(d.isString(c.field))if(c.stops){if(8<c.stops.length)return null;c=c.stops;for(var b=0;8>b;++b){var k=c[Math.min(b,c.length-1)];a.values[b]=k.value;a.opacities[b]=k.opacity}}else if(c.opacities){if(!d.isDefined(c.minDataValue)||!d.isDefined(c.maxDataValue)||
2!==c.opacities.length)return null;a.values[0]=c.minDataValue;a.opacities[0]=c.opacities[0];a.values[1]=c.maxDataValue;a.opacities[1]=c.opacities[1];for(b=2;8>b;++b)a.values[b]=c.maxDataValue,a.opacities[b]=c.opacities[1]}else return null;else if(c.stops&&0<=c.stops.length||c.opacities&&0<=c.opacities.length)for(c=c.stops&&0<=c.stops.length?c.stops[0].opacity:c.opacities[0],b=0;8>b;b++)a.values[b]=Infinity,a.opacities[b]=c;else return null;return a}Object.defineProperty(l,"__esModule",{value:!0});
l.getTypeOfSizeVisualVariable=h;l.getVisualVariableSizeValueRepresentationRatio=function(c,a){if(!c||!a)return c;switch(a){case "radius":case "distance":return 2*c;case "area":return Math.sqrt(c)}return c};l.stopToSizeStop=c;l.normalizeSizeStops=e;l.normalizeSizeElement=r;l.convertVisualVariables=function(c){var k=c&&0<c.length?{}:null,f=k?{}:null;k&&c.forEach(function(c){var n=c.type;c.field&&(k[n]=c.field);if("size"===n)switch(f.size||(f.size={}),h(c)){case g.WGLVVFlag.SIZE_MINMAX_VALUE:f.size.minMaxValue=
{minDataValue:c.minDataValue,maxDataValue:c.maxDataValue,minSize:r(c.minSize),maxSize:r(c.maxSize)};break;case g.WGLVVFlag.SIZE_SCALE_STOPS:f.size.scaleStops={stops:e(c.stops)};break;case g.WGLVVFlag.SIZE_FIELD_STOPS:var n=[],D=[];c=e(c.stops);for(var l=c.length,t=0;6>t;t++){var w=c[Math.min(t,l-1)];n.push(w.value);D.push(a.pt2px(w.size))}f.size.fieldStops={values:n,sizes:D};break;case g.WGLVVFlag.SIZE_UNIT_VALUE:f.size.unitValue={unit:c.valueUnit,valueRepresentation:c.valueRepresentation}}else if("color"===
n)for(n=b.convertVisualVariables([c],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null}),f.color=n.color,t=0;32>t;t+=4)d.premultiplyAlpha(f.color.colors,t,!0);else"opacity"===n?f.opacity=p(c):"rotation"===n&&(f.rotation={type:c.rotationType})});return{vvFields:k,vvRanges:f}}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../renderers/support/utils","../../lib/glMatrix","../graphics/graphicUtils"],function(C,l,a,b,d){function g(c){return null!==
c&&void 0!==c}function h(c){return"number"===typeof c}function c(c,a){c&&c.push(a)}function e(m,b,f,k,e){var v=m.minSize,d=m.maxSize;if(m.expression)return c(e,"Could not convert size info: expression not supported"),!1;if(m.useSymbolValue)return m=k.symbolSize[f],b.minSize[f]=m,b.maxSize[f]=m,b.offset[f]=b.minSize[f],b.factor[f]=0,b.type[f]=1,!0;if(g(m.field)){if(g(m.stops)){if(2===m.stops.length&&h(m.stops[0].size)&&h(m.stops[1].size))return r(m.stops[0].size,m.stops[1].size,m.stops[0].value,m.stops[1].value,
b,f),b.type[f]=1,!0;c(e,"Could not convert size info: stops only supported with 2 elements");return!1}if(h(v)&&h(d)&&g(m.minDataValue)&&g(m.maxDataValue))return r(v,d,m.minDataValue,m.maxDataValue,b,f),b.type[f]=1,!0;if(null!=a.meterIn[m.valueUnit])return b.minSize[f]=-Infinity,b.maxSize[f]=Infinity,b.offset[f]=0,b.factor[f]=1/a.meterIn[m.valueUnit],b.type[f]=1,!0;"unknown"===m.valueUnit?c(e,"Could not convert size info: proportional size not supported"):c(e,"Could not convert size info: scale-dependent size not supported");
return!1}if(!g(m.field)){if(m.stops&&m.stops[0]&&h(m.stops[0].size))return b.minSize[f]=m.stops[0].size,b.maxSize[f]=m.stops[0].size,b.offset[f]=b.minSize[f],b.factor[f]=0,b.type[f]=1,!0;if(h(v))return b.minSize[f]=v,b.maxSize[f]=v,b.offset[f]=v,b.factor[f]=0,b.type[f]=1,!0}c(e,"Could not convert size info: unsupported variant of sizeInfo");return!1}function r(c,a,b,f,k,e){f=0<Math.abs(f-b)?(a-c)/(f-b):0;k.minSize[e]=0<f?c:a;k.maxSize[e]=0<f?a:c;k.offset[e]=c-b*f;k.factor[e]=f}function p(a,b,f,k){if(a.normalizationField||
a.valueRepresentation)return c(k,"Could not convert size info: unsupported property"),null;var m=a.field;if(null!=m&&"string"!==typeof m)return c(k,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=a.field;else if(a.field!==b.size.field)return c(k,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(m=
e(a,b.size,0,f,k))?b:null;case "height":return(m=e(a,b.size,2,f,k))?b:null;case "depth":return(m=e(a,b.size,1,f,k))?b:null;case "width-and-depth":return(m=e(a,b.size,0,f,k))&&e(a,b.size,1,f,k),m?b:null;case null:case void 0:case "all":return(m=(m=(m=e(a,b.size,0,f,k))&&e(a,b.size,1,f,k))&&e(a,b.size,2,f,k))?b:null;default:return c(k,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function k(a,b,f){for(var k=0;3>k;++k){var m=b.unitInMeters;1===a.type[k]&&(m*=b.modelSize[k],a.type[k]=
2);a.minSize[k]/=m;a.maxSize[k]/=m;a.offset[k]/=m;a.factor[k]/=m}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return c(f,"No size axis contains a valid size or scale"),!1;for(k=0;3>k;++k)0===a.type[k]&&(a.minSize[k]=a.minSize[b],a.maxSize[k]=a.maxSize[b],a.offset[k]=a.offset[b],a.factor[k]=a.factor[b],a.type[k]=a.type[b]);return!0}function n(c,a,b){c[4*a+0]=b.r/255;c[4*a+1]=b.g/255;c[4*a+2]=b.b/255;c[4*a+3]=b.a}function f(a,b,f){if(a.normalizationField)return c(f,
"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return c(f,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(f=0;8>f;++f){var k=a[Math.min(f,a.length-1)];b.color.values[f]=k.value;n(b.color.colors,f,k.color)}}else if(a.colors){if(!g(a.minDataValue)||!g(a.maxDataValue))return c(f,"Could not convert color info: missing data values"),
null;if(2!==a.colors.length)return c(f,"Could not convert color info: invalid colors array"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};b.color.values[0]=a.minDataValue;n(b.color.colors,0,a.colors[0]);b.color.values[1]=a.maxDataValue;n(b.color.colors,1,a.colors[1]);for(f=2;8>f;++f)b.color.values[f]=a.maxDataValue,n(b.color.colors,f,a.colors[1])}else return c(f,"Could not convert color info: missing stops or colors"),
null;else if(a.stops&&0<=a.stops.length||a.colors&&0<=a.colors.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0],b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},f=0;8>f;f++)b.color.values[f]=Infinity,n(b.color.colors,f,a);else return c(f,"Could not convert color info: no field and no colors/stops"),null;return b}function D(c,a,b,f){c=2===b&&"arithmetic"===c.rotationType;a.offset[b]=c?90:0;a.factor[b]=c?-1:1;
a.type[b]=1}function q(a,b,f){if("string"!==typeof a.field)return c(f,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return c(f,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return D(a,b.rotation,0,f),b;case "roll":return D(a,b.rotation,1,f),b;case null:case void 0:case "heading":return D(a,
b.rotation,2,f),b;default:return c(f,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function E(a,b,e){if(!a)return null;var d=!b.supportedTypes||!!b.supportedTypes.size,n=!b.supportedTypes||!!b.supportedTypes.color,m=!b.supportedTypes||!!b.supportedTypes.rotation;return(a=a.reduce(function(a,k){if(!a)return a;if(k.valueExpression)return c(e,"Could not convert visual variables: arcade expressions not supported"),null;switch(k.type){case "size":return d?p(k,a,b,e):a;case "color":return n?
f(k,a,e):a;case "rotation":return m?q(k,a,e):a;default:return c(e,"Could not convert visual variables: unsupported type "+k.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!k(a.size,b,e)?null:a}function I(c,a,b){if(!!c!==!!a||c&&c.field!==a.field)return!1;if(c&&"rotation"===b)for(b=0;3>b;b++)if(c.type[b]!==a.type[b]||c.offset[b]!==a.offset[b]||c.factor[b]!==a.factor[b])return!1;return!0}function t(c,a){var b={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,
vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},f=c&&null!=c.size;c&&c.size?(b.vvSizeEnabled=!0,b.vvSizeMinSize=c.size.minSize,b.vvSizeMaxSize=c.size.maxSize,b.vvSizeOffset=c.size.offset,b.vvSizeFactor=c.size.factor):c&&f&&(b.vvSizeValue=a.transformation.scale);c&&f&&(b.vvSymbolAnchor=a.transformation.anchor,b.vvSymbolRotation=a.transformation.rotation);c&&c.color&&(b.vvColorEnabled=!0,b.vvColorValues=c.color.values,b.vvColorColors=
c.color.colors);return b}Object.defineProperty(l,"__esModule",{value:!0});l.convertVisualVariables=E;l.initFastSymbolUpdatesState=function(c,a,b){return a&&c&&!c.disableFastUpdates?(c=E(c.visualVariables,b))?{enabled:!0,visualVariables:c,materialParameters:t(c,b),customTransformation:c&&null!=c.size}:{enabled:!1}:{enabled:!1}};l.updateFastSymbolUpdatesState=function(c,a,b){if(!a||!c.enabled)return!1;var f=c.visualVariables;a=E(a.visualVariables,b);if(!(a&&I(f.size,a.size,"size")&&I(f.color,a.color,
"color")&&I(f.rotation,a.rotation,"rotation")))return!1;c.visualVariables=a;c.materialParameters=t(a,b);c.customTransformation=a&&null!=a.size;return!0};l.getMaterialParams=t;var w;(function(c){var a=b.mat4d,f=b.vec3,k=a.create(),e=f.create();c.evaluateModelTransform=function(c,b,f){if(!c.vvSizeEnabled)return f;a.identity(k);a.multiply(f,k,k);d.computeObjectRotation(c.vvSymbolRotation[2],c.vvSymbolRotation[0],c.vvSymbolRotation[1],k);if(c.vvSizeEnabled){for(f=0;3>f;++f){var n=c.vvSizeOffset[f]+b[0]*
c.vvSizeFactor[f],p=f;var q=c.vvSizeMinSize[f],h=c.vvSizeMaxSize[f],n=n<q?q:n>h?h:n;e[p]=n}a.scale(k,e,k)}else a.scale(k,c.vvSizeValue,k);a.translate(k,c.vvSymbolAnchor,k);return k}})(w||(w={}));l.evaluateModelTransform=w.evaluateModelTransform})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry/SpatialReference ../../../../geometry/Point ../../../../geometry/support/webMercatorUtils ../../lib/glMatrix".split(" "),function(C,l,a,b,d,g){function h(c,
b){var f=c.spatialReference;f.equals(b)||(f.isWebMercator&&b.wkid===a.WGS84.wkid?d.webMercatorToGeographic(c,!1,c):b.isWebMercator&&f.wkid===a.WGS84.wkid&&d.geographicToWebMercator(c,!1,c))}function c(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!c(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(l,"__esModule",{value:!0});var e=g.vec4d,r=g.mat4d,p=[1,1,1];l.computeCentroid=function(c,a){if("extent"===c.type)return c.center;if("polygon"===c.type)return c.centroid;for(var f=
0,k=0,e=0,d=c.hasZ,n=0,p=0,g=c.paths;p<g.length;p++){for(var m=g[p],r=0,B=m;r<B.length;r++){var A=B[r],f=f+A[0],k=k+A[1];d&&(e+=A[2])}n+=m.length}c=new b({x:f/n,y:k/n,z:d?e/n:void 0,spatialReference:c.spatialReference});a&&h(c,a);return c};l.convertToSR=h;l.enlargeExtent=function(c,a,b){if(c){a||(a=e.create());var f=.5*c.width*(b-1);b=.5*c.height*(b-1);c.width<1E-7*c.height?f+=b/20:c.height<1E-7*c.width&&(b+=f/20);e.set4(c.xmin-f,c.ymin-b,c.xmax+f,c.ymax+b,a);return a}return null};l.updateVertexAttributeAuxpos1w=
function(c,a){for(var b=0;b<c.geometries.length;++b){var k=c.geometries[b].data.vertexAttributes.auxpos1;k&&k.data[3]!==a&&(k.data[3]=a,c.geometryVertexAttrsUpdated(b))}};l.mixinColorAndOpacity=function(c,a){var b=[1,1,1,1];null!=c&&(b[0]=c[0],b[1]=c[1],b[2]=c[2]);null!==a&&void 0!==a?b[3]=a:null!=c&&3<c.length&&(b[3]=c[3]);return b};l.overrideColor=function(c,a,b,e,d){d=d.slice();for(var f=0;3>f;++f)c&&null!=c[f]?d[f]=c[f]:b&&null!=b[f]&&(d[f]=b[f]);null!=a?d[3]=a:null!=e&&(d[3]=e);return d};l.computeObjectScale=
function(c,a,b,e){void 0===c&&(c=p);void 0===e&&(e=1);var f=Array(3);if(null==a||null==b)f[0]=1,f[1]=1,f[2]=1;else{for(var k=void 0,d=0,n=2;0<=n;n--){var h=c[n],g=void 0,r=null!=h,D=0===n&&!k&&!r,A=b[n];"symbolValue"===h||D?g=0!==A?a[n]/A:1:r&&"proportional"!==h&&isFinite(h)&&(g=0!==A?h/A:1);null!=g&&(k=f[n]=g,d=Math.max(d,Math.abs(g)))}for(n=2;0<=n;n--)null==f[n]?f[n]=k:0===f[n]&&(f[n]=.001*d)}for(n=2;0<=n;n--)f[n]/=e;return f};l.computeSizeWithResourceSize=function(c,a){var b=a.width,e=a.depth,
k=a.height;a=a.isPrimitive?10:1;if(null==b&&null==k&&null==e)return[a*c[0],a*c[1],a*c[2]];for(var b=[b,e,k],d,e=0;3>e;e++)if(k=b[e],null!=k){d=k/c[e];break}for(e=0;3>e;e++)null==b[e]&&(b[e]=c[e]*d);return b};l.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return c(a)?null:"Symbol sizes may not be negative values"};l.computeObjectRotation=function(c,a,b,e){void 0===e&&(e=r.identity());c=c||0;a=a||0;b=b||0;0!==c&&r.rotateZ(e,-c/180*Math.PI,e);0!==a&&r.rotateX(e,
a/180*Math.PI,e);0!==b&&r.rotateY(e,b/180*Math.PI,e);return e}})},"esri/views/2d/engine/webgl/WGLTileHandler":function(){define("require exports ../../../../core/promiseUtils ../../../../core/promiseUtils ../../../../core/MapPool ./Utils ./WGLDisplayObject ./TileData ./displayObjectUtils ./enums ./MaterialInfo ./MaterialKeyInfo ./MaterialInfoUtils ./MeshUtils ./WGLDisplayRecord".split(" "),function(C,l,a,b,d,g,h,c,e,r,p,k,n,f,D){function q(c,a,b){a.has(c)||(b=b.rasterizeItem(c),a.set(c,b))}function E(c,
a,b){g.isMarkerSymbol(c)||g.isLineSymbol(c)?q(c,a,b):g.isFillSymbol(c)&&(q(c,a,b),c.outline&&"none"!==c.outline.style&&q(c.outline,a,b))}function I(c,a,b){b.has(c)||b.set(c,new Set);c=b.get(c);b=a.length;for(var f=0;f<b;f++){var e=a.charCodeAt(f);c.add(e)}}Object.defineProperty(l,"__esModule",{value:!0});var t=new Set;l.getTileData=function(q,m,v,B,A,l,H){if(0===m.features.length)return a.resolve(null);var w=[],V={};q=null!=B.heatmapInfo;var J=m.features.length,u;t.clear();if(q){V.icon=g.getStrides(r.WGLGeometryType.MARKER,
null!==B.vvFields,!0);var z=k.pool.acquire();z.geometryType=r.WGLGeometryType.MARKER;z.sdf=!1;z.pattern=!1;z.heatmap=!0;z.visibility=!1;B.vvFields?(z.vvOpacity=null!=B.vvFields.opacity,z.vvSizeMinMaxValue=null!=B.vvFields.size,z.vvColor=null!=B.vvFields.color,z.vvRotation=null!=B.vvFields.rotation):z.vvOpacity=z.vvSizeMinMaxValue=z.vvColor=z.vvRotation=!1;var y=p.pool.acquire();y.materialKey=n.getMaterialKey(z);y.materialKeyInfo=z;for(q=0;q<J;q++){u=m.features[q];var x=u.attributes[v];if(!t.has(x)){var F=
h.pool.acquire(x),G=f.createMesh(x,B,z,null,r.WGLGeometryType.MARKER,A,l,u,null),G=D.pool.acquire(x,r.WGLGeometryType.MARKER,G,y,0,0);t.add(x);F.displayRecords.push(G);w.push(F)}}return a.resolve(c.create(w,V))}var S=d.acquire(),L=d.acquire(),K;B.renderer.backgroundFillSymbol&&E(B.renderer.backgroundFillSymbol,S,H);for(q=0;q<J;q++)u=m.features[q],(z=B.getSymbol(u))&&(g.isTextSymbol(z)?I(z,z.text,L):E(z,S,H));0<L.size&&L.forEach(function(c,a){var b=[];c.forEach(function(c){return b.push(c)});c=H.rasterizeItem(a,
b);S.set(a,c)});if(0===S.size)return a.resolve(null);var P=[];S.forEach(function(c){return P.push(c)});return b.all(P).then(function(a){var b=d.acquire(),f=0,k;S.forEach(function(c,e){k=a[f++];if(k.glyphMosaicItems){K||(K=d.acquire());var p=d.acquire();k.glyphMosaicItems.forEach(function(c,a){var b=n.createTextMaterialInfo(B,c);p.set(a,{mosaicItem:c,materialInfo:b})});K.set(e,p)}else b.set(e,k)});for(var p=0;p<J;p++){u=m.features[p];var x=u.attributes[v];if(!t.has(x)){var h=e.getDisplayObject(u,v,
B,m.geometryType,A,l,b,K,V);w.push(h);t.add(x)}}K&&(K.forEach(function(c){d.release(c)}),d.release(K));d.release(b);d.release(L);d.release(S);return c.create(w,V)})}})},"esri/core/MapPool":function(){define(["require","exports","./ObjectPool"],function(C,l,a){C=function(){function d(b,d){void 0===b&&(b=50);void 0===d&&(d=50);this._pool=new a(Map,!1,function(c){return c.clear()},d,b)}d.prototype.acquire=function(){return this._pool.acquire()};d.prototype.release=function(a){this._pool.release(a)};
d.acquire=function(){return b.acquire()};d.release=function(a){return b.release(a)};return d}();var b=new C(100);return C})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","../../../../core/ObjectPool","./WGLDisplayRecord","./Utils"],function(C,l,a,b,d){return function(){function g(){this.displayRecords=[]}g.prototype.acquire=function(a){this.id=a};g.prototype.release=function(){this.id=void 0;this.displayRecords.length=0};g.serialize=function(a,c,e){var h=0,
h=h+d.serializeInteger(a.id,c,e+h),h=h+d.serializeInteger(a.displayRecords.length,c,e+h),p=0;for(a=a.displayRecords;p<a.length;p++)h+=b.serialize(a[p],c,e+h,!0);return h};g.deserialize=function(a,c,e){var h=0,p={n:0},h=h+d.deserializeInteger(p,c,e+h),k={n:0},h=h+d.deserializeInteger(k,c,e+h),n={displayRecord:void 0};a.displayObject=g.pool.acquire();a.displayObject.id=p.n;a.displayObject.displayRecords.length=k.n;for(var f=0;f<k.n;++f)h+=b.deserialize(n,c,e+h,!0),a.displayObject.displayRecords[f]=
n.displayRecord,a.displayObject.displayRecords[f].id=p.n;return h};g.pool=new a(g);return g}()})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define("require exports ../../../../core/ObjectPool ./MeshData ./MaterialInfo ./enums ./Utils".split(" "),function(C,l,a,b,d,g,h){return function(){function c(){this.id=-1;this.geometryType=g.WGLGeometryType.UNKNOWN;this.materialInfo=this.meshData=null;this.sortKey=this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=
0}c.prototype.acquire=function(c,a,b,k,d,f){this.setData(c,a,b,k,d,f)};c.prototype.release=function(){this.id=-1;this.geometryType=g.WGLGeometryType.UNKNOWN;this.materialInfo=this.meshData=null;this.sortKey=this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0};c.prototype.setData=function(c,a,b,k,d,f){this.id=c;this.geometryType=a;this.meshData=b;this.materialInfo=k;this.symbolLevel=d;this.zOrder=f;this._computeSortKey()};c.prototype.readMeshDataFromBuffers=
function(c,a){this.meshData?this.meshData.clear():this.meshData=b.pool.acquire();for(var e in c){for(var d=c[e].stride,n=c[e].data,f=[],h=0;h<d*this.vertexCount/4;++h)f[h]=n[h+d*this.vertexFrom/4];this.meshData.vertexData.set(e,f)}for(h=this.meshData.indexData.length=0;h<this.indexCount;++h)this.meshData.indexData[h]=a[h+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};c.prototype.writeMeshDataToBuffers=function(c,a,b,d){for(var e in a)for(var f=a[e].stride,k=this.meshData.vertexData.get(e),
h=a[e].data,p=0;p<f*this.meshData.vertexCount/4;++p)h[p+f*c/4]=k[p];for(p=0;p<this.meshData.indexData.length;++p)d[p+b]=this.meshData.indexData[p]+c;this.vertexFrom=c;this.vertexCount=this.meshData.vertexCount;this.indexFrom=b;this.indexCount=this.meshData.indexData.length};c.writeAllMeshDataToBuffers=function(c,a,b){for(var e=0,d=0,f=0;f<c.length;f++){var p=c[f];p.writeMeshDataToBuffers(e,a,d,b);e+=p.vertexCount;d+=p.indexCount}};c.prototype._computeSortKey=function(){this.sortKey=(this.symbolLevel&
31)<<12|(this.zOrder&127)<<4|this.geometryType&7};c.serialize=function(c,a,b,k){var e=0;k&&(a&&(a[b+e]=c.geometryType),++e);e+=d.serialize(c.materialInfo,a,b+e);a&&(a[b+e]=c.symbolLevel);++e;a&&(a[b+e]=c.zOrder);++e;e+=h.serializeInteger(c.vertexFrom,a,b+e);e+=h.serializeInteger(c.vertexCount,a,b+e);e+=h.serializeInteger(c.indexFrom,a,b+e);return e+=h.serializeInteger(c.indexCount,a,b+e)};c.deserialize=function(a,b,p,k){var e=0;a.displayRecord=c.pool.acquire();a.displayRecord.id=-1;k&&(a.displayRecord.geometryType=
b[p+e],++e);a.displayRecord.meshData=null;k={materialInfo:null};e+=d.deserialize(k,b,p+e);a.displayRecord.materialInfo=k.materialInfo;a.displayRecord.symbolLevel=b[p+e];++e;a.displayRecord.zOrder=b[p+e];++e;k={n:void 0};e+=h.deserializeInteger(k,b,p+e);a.displayRecord.vertexFrom=k.n;e+=h.deserializeInteger(k,b,p+e);a.displayRecord.vertexCount=k.n;e+=h.deserializeInteger(k,b,p+e);a.displayRecord.indexFrom=k.n;e+=h.deserializeInteger(k,b,p+e);a.displayRecord.indexCount=k.n;a.displayRecord._computeSortKey();
return e};c.pool=new a(c);return c}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports","../../../../core/ObjectPool"],function(C,l,a){return function(){function b(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}b.prototype.release=function(){this.clear()};b.prototype.clear=function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};b.prototype.update=function(a,b,h){for(var c in a)this.vertexData.set(c,a[c]);for(c in this.vertexData)null===
a[c]&&this.vertexData.delete(c);this.vertexCount=b;this.indexData=h};b.pool=new a(b);return b}()})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ../../../../core/ObjectPool ./TileDisplayData ./TileBufferData ./WGLDisplayRecord ./enums".split(" "),function(C,l,a,b,d,g,h){return function(){function c(){this.tileBufferData=this.tileDisplayData=null}c.prototype.release=function(){b.pool.release(this.tileDisplayData);this.tileDisplayData=null;d.pool.release(this.tileBufferData);
this.tileBufferData=null};c.prototype.serialize=function(){var c=this.tileBufferData.serialize(),a=this.tileBufferData.getBuffers(),d=b.serialize(this.tileDisplayData,null,0),d=new Uint8Array(d);b.serialize(this.tileDisplayData,d,0);a.push(d.buffer);return{data:{displayData:d.buffer,bufferData:c},buffers:a}};c.deserialize=function(a){var e={tileDisplayData:null};b.deserialize(e,new Uint8Array(a.displayData),0);e=e.tileDisplayData;a=d.deserialize(a.bufferData);var h=new c;h.tileDisplayData=e;h.tileBufferData=
a;return h};c.prototype.deserializeMeshData=function(){var c=this;this.tileDisplayData.displayObjectRegistry.forEach(function(a,b){a=0;for(b=c.tileDisplayData.displayObjectRegistry.get(b).displayRecords;a<b.length;a++){var e=b[a],d=e.geometryType;e.readMeshDataFromBuffers(c.tileBufferData.geometries[d].vertexBuffer,c.tileBufferData.geometries[d].indexBuffer)}})};c.bind=function(a,b){var e=new c;e.tileDisplayData=a;e.tileBufferData=b;return e};c.create=function(a,r){var e=new c;e.tileDisplayData=new b;
for(var k=[0,0,0,0],n=[0,0,0,0],f=0;f<a.length;f++){var D=a[f];e.tileDisplayData.displayObjectRegistry.set(D.id,D);for(var q=0,D=D.displayRecords;q<D.length;q++){var E=D[q];switch(E.geometryType){case h.WGLGeometryType.FILL:e.tileDisplayData.fillDisplayRecords.push(E);break;case h.WGLGeometryType.LINE:e.tileDisplayData.lineDisplayRecords.push(E);break;case h.WGLGeometryType.MARKER:e.tileDisplayData.iconDisplayRecords.push(E);break;case h.WGLGeometryType.TEXT:e.tileDisplayData.textDisplayRecords.push(E)}k[E.geometryType]+=
E.meshData.vertexCount;n[E.geometryType]+=E.meshData.indexData.length}}a=function(a,c){return a.sortKey-c.sortKey};e.tileDisplayData.fillDisplayRecords.sort(a);e.tileDisplayData.lineDisplayRecords.sort(a);e.tileDisplayData.iconDisplayRecords.sort(a);e.tileDisplayData.textDisplayRecords.sort(a);r=[r.fill||{},r.line||{},r.icon||{},r.text||{}];a=new d;for(q=0;4>q;q++){a.geometries[q].indexBuffer=new Uint32Array(n[q]);a.geometries[q].vertexBuffer={};var f=r[q],l;for(l in f)a.geometries[q].vertexBuffer[l]=
{data:new Uint32Array(k[q]*f[l]/4),stride:f[l]}}e.tileBufferData=a;(k=e.tileBufferData.geometries[h.WGLGeometryType.FILL])&&g.writeAllMeshDataToBuffers(e.tileDisplayData.fillDisplayRecords,k.vertexBuffer,k.indexBuffer);(k=e.tileBufferData.geometries[h.WGLGeometryType.LINE])&&g.writeAllMeshDataToBuffers(e.tileDisplayData.lineDisplayRecords,k.vertexBuffer,k.indexBuffer);(k=e.tileBufferData.geometries[h.WGLGeometryType.MARKER])&&g.writeAllMeshDataToBuffers(e.tileDisplayData.iconDisplayRecords,k.vertexBuffer,
k.indexBuffer);(k=e.tileBufferData.geometries[h.WGLGeometryType.TEXT])&&g.writeAllMeshDataToBuffers(e.tileDisplayData.textDisplayRecords,k.vertexBuffer,k.indexBuffer);e.tileDisplayData.displayList.addToList(e.tileDisplayData.fillDisplayRecords);e.tileDisplayData.displayList.addToList(e.tileDisplayData.lineDisplayRecords);e.tileDisplayData.displayList.addToList(e.tileDisplayData.iconDisplayRecords);e.tileDisplayData.displayList.addToList(e.tileDisplayData.textDisplayRecords);return e};c.pool=new a(c);
return c}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define("require exports ../../../../core/ObjectPool ./WGLDisplayObject ./WGLDisplayRecord ./WGLDisplayList ./enums ./Utils".split(" "),function(C,l,a,b,d,g,h,c){return function(){function e(){this.displayList=new g;this.fillDisplayRecords=[];this.lineDisplayRecords=[];this.iconDisplayRecords=[];this.textDisplayRecords=[];this.displayObjectRegistry=new Map}e.prototype.release=function(){};e.serialize=function(a,c,b){var d=0,d=d+
g.serialize(a.displayList,c,b+d),d=d+e._serializeRecords(a.fillDisplayRecords,c,b+d),d=d+e._serializeRecords(a.lineDisplayRecords,c,b+d),d=d+e._serializeRecords(a.iconDisplayRecords,c,b+d),d=d+e._serializeRecords(a.textDisplayRecords,c,b+d);return d+=e._serializeRegistry(a.displayObjectRegistry,[a.fillDisplayRecords,a.lineDisplayRecords,a.iconDisplayRecords,a.textDisplayRecords],c,b+d)};e.deserialize=function(a,c,b){var d=0;a.tileDisplayData=new e;var f={displayList:null},d=d+g.deserialize(f,c,b+
d);a.tileDisplayData.displayList=f.displayList;d+=e._deserializeRecords(a.tileDisplayData.fillDisplayRecords,h.WGLGeometryType.FILL,c,b+d);d+=e._deserializeRecords(a.tileDisplayData.lineDisplayRecords,h.WGLGeometryType.LINE,c,b+d);d+=e._deserializeRecords(a.tileDisplayData.iconDisplayRecords,h.WGLGeometryType.MARKER,c,b+d);d+=e._deserializeRecords(a.tileDisplayData.textDisplayRecords,h.WGLGeometryType.TEXT,c,b+d);return d+=e._deserializeRegistry(a.tileDisplayData.displayObjectRegistry,[a.tileDisplayData.fillDisplayRecords,
a.tileDisplayData.lineDisplayRecords,a.tileDisplayData.iconDisplayRecords,a.tileDisplayData.textDisplayRecords],c,b+d)};e._findRecord=function(a,c){for(var b=a.length,e=0;e<b;++e)if(a[e]===c)return e;return-1};e._serializeRecords=function(a,b,e){for(var k=0,k=k+c.serializeInteger(a.length,b,e+k),f=0;f<a.length;f++)k+=d.serialize(a[f],b,e+k,!1);return k};e._serializeRegistry=function(a,b,d,h){var f=0,k=0;a.forEach(function(a,c){++k});f+=c.serializeInteger(k,d,h+f);a.forEach(function(k,g){g=a.get(g);
f+=c.serializeInteger(g.id,d,h+f);f+=c.serializeInteger(g.displayRecords.length,d,h+f);k=0;for(g=g.displayRecords;k<g.length;k++){var q=g[k],p=e._findRecord(b[q.geometryType],q);0<=p?(d&&(d[h+f]=q.geometryType),++f,f+=c.serializeInteger(p,d,h+f)):console.error("Record found in a display object but not in the flat record lists.")}});return f};e._deserializeRecords=function(a,b,e,h){var f=0,k={n:void 0},f=f+c.deserializeInteger(k,e,h+f);a.length=k.n;for(var g=0;g<k.n;++g){var p={displayRecord:null},
f=f+d.deserialize(p,e,h+f,!1);a[g]=p.displayRecord;a[g].geometryType=b}return f};e._deserializeRegistry=function(a,e,d,h){var f=0;a.clear();for(var k={n:void 0},f=f+c.deserializeInteger(k,d,h+f),g={n:void 0},p={n:void 0},n={n:void 0},r=0;r<k.n;++r){var f=f+c.deserializeInteger(g,d,h+f),f=f+c.deserializeInteger(p,d,h+f),l=b.pool.acquire();l.id=g.n;for(var m=0;m<p.n;++m){var v=void 0;f&&(v=d[h+f]);++f;f+=c.deserializeInteger(n,d,h+f);v=e[v][n.n];v.id=l.id;l.displayRecords[m]=v}a.set(l.id,l)}return f};
e.pool=new a(e);return e}()})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define("require exports ../../../../core/ObjectPool ./enums ./MaterialInfo ./Utils".split(" "),function(C,l,a,b,d,g){C=function(){function p(){this.symbolLevels=[]}p.prototype.release=function(){this.symbolLevels.forEach(function(a){r.pool.release(a)});this.symbolLevels.length=0};Object.defineProperty(p.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});
p.prototype.addToList=function(a){var c=this;a.forEach(function(a){c._addToList(a)})};p.prototype.removeFromList=function(a){var c=this;a.forEach(function(a){c._removeFromList(a)})};p.prototype._addToList=function(a){var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),b=0<c.length?c[c.length-1]:null;null!==b&&g.isSameMaterialInfo(b.materialInfo,a.materialInfo)&&b.indexFrom+b.indexCount===a.indexFrom?b.indexCount+=a.indexCount:(b=h.pool.acquire(),b.indexFrom=a.indexFrom,b.indexCount=
a.indexCount,b.materialInfo=a.materialInfo,b.geometryType=a.geometryType,c.push(b))};p.prototype._removeFromList=function(a){for(var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),b=c.length,e=void 0,k=0;k<b;++k){var g=c[k];a.indexFrom+a.indexCount>g.indexFrom&&a.indexFrom<g.indexFrom+g.indexCount&&(e=k)}if(void 0!==e)if(g=c[e],a.indexFrom<g.indexFrom)g.indexCount-=a.indexCount,g.indexFrom+=a.indexCount;else if(a.indexFrom+a.indexCount>g.indexFrom+g.indexCount)g.indexCount-=a.indexCount;
else{var b=g.indexFrom,k=a.indexFrom-g.indexFrom,p=a.indexCount;a=g.indexFrom+g.indexCount-(a.indexFrom+a.indexCount);g.indexCount=k;var r=h.pool.acquire();r.geometryType=g.geometryType;r.materialInfo=d.pool.acquire();r.materialInfo.copy(g.materialInfo);r.indexFrom=b+k+p;r.indexCount=a;c.splice(e+1,0,r)}};p.prototype._getDisplayList=function(a,d,f){for(var h,g=this.symbolLevels.length,k=0;k<g;k++)if(this.symbolLevels[k].symbolLevel===a){h=this.symbolLevels[k];break}h||(h=r.pool.acquire(),h.symbolLevel=
a,this.symbolLevels.push(h));var p;a=h.zLevels.length;for(g=0;g<a;g++)if(h.zLevels[g].zLevel===d){p=h.zLevels[g];break}p||(p=e.pool.acquire(),p.geometryDPInfo=c.pool.acquire(),p.zLevel=d,h.zLevels.push(p));var n;switch(f){case b.WGLGeometryType.FILL:p.geometryDPInfo.fill||(p.geometryDPInfo.fill=[]);n=p.geometryDPInfo.fill;break;case b.WGLGeometryType.LINE:p.geometryDPInfo.line||(p.geometryDPInfo.line=[]);n=p.geometryDPInfo.line;break;case b.WGLGeometryType.MARKER:p.geometryDPInfo.marker||(p.geometryDPInfo.marker=
[]);n=p.geometryDPInfo.marker;break;case b.WGLGeometryType.TEXT:p.geometryDPInfo.text||(p.geometryDPInfo.text=[]);n=p.geometryDPInfo.text;break;default:console.error("Trying to add a record with geometry type '"+f+"'.")}return n};p.serialize=function(a,c,b){var e=0;c&&(c[b+e]=a.symbolLevels.length);++e;var d=0;for(a=a.symbolLevels;d<a.length;d++){var f=a[d];c&&(c[b+e]=f.symbolLevel);++e;c&&(c[b+e]=f.zLevels.length);++e;for(var h=0,f=f.zLevels;h<f.length;h++){var g=f[h];c&&(c[b+e]=g.zLevel);++e;g=
g.geometryDPInfo;e+=this._serializeDisplayListInfo(g.fill,c,b+e);e+=this._serializeDisplayListInfo(g.line,c,b+e);e+=this._serializeDisplayListInfo(g.marker,c,b+e);e+=this._serializeDisplayListInfo(g.text,c,b+e)}}return e};p.deserialize=function(a,c,d){a.displayList=p.pool.acquire();var f=0,h=c[d+f];++f;for(var g=0;g<h;++g){var k=r.pool.acquire();k.symbolLevel=c[d+f];++f;a.displayList.symbolLevels.push(k);var n=c[d+f];++f;for(var l=0;l<n;++l){var m=e.pool.acquire();m.zLevel=c[d+f];++f;k.zLevels.push(m);
var v=[],f=f+this._deserializeDisplayListInfo(v,b.WGLGeometryType.FILL,c,d+f);m.geometryDPInfo.fill=0<v.length?v:null;v=[];f+=this._deserializeDisplayListInfo(v,b.WGLGeometryType.LINE,c,d+f);m.geometryDPInfo.line=0<v.length?v:null;v=[];f+=this._deserializeDisplayListInfo(v,b.WGLGeometryType.MARKER,c,d+f);m.geometryDPInfo.marker=0<v.length?v:null;v=[];f+=this._deserializeDisplayListInfo(v,b.WGLGeometryType.TEXT,c,d+f);m.geometryDPInfo.text=0<v.length?v:null}}return f};p._serializeDisplayListInfo=function(a,
c,b){var e=0;if(a)for(var e=e+g.serializeInteger(a.length,c,b+e),f=0;f<a.length;f++)var h=a[f],e=e+d.serialize(h.materialInfo,c,b+e),e=e+g.serializeInteger(h.indexFrom,c,b+e),e=e+g.serializeInteger(h.indexCount,c,b+e);else c&&(c[b+e]=0),++e;return e};p._deserializeDisplayListInfo=function(a,c,b,e){var f={n:void 0},k=0,k=k+g.deserializeInteger(f,b,e+k),p=f.n;a.length=p;for(var r=0;r<p;++r){var n=h.pool.acquire();n.geometryType=c;var m={materialInfo:null},k=k+d.deserialize(m,b,e+k);n.materialInfo=m.materialInfo;
k+=g.deserializeInteger(f,b,e+k);n.indexFrom=f.n;k+=g.deserializeInteger(f,b,e+k);n.indexCount=f.n;a[r]=n}return k};p.pool=new a(p);return p}();var h=function(){function c(){this.materialInfo=null;this.indexCount=this.indexFrom=0}c.prototype.release=function(){this.geometryType=b.WGLGeometryType.UNKNOWN;this.materialInfo=null;this.indexCount=this.indexFrom=0};c.pool=new a(c);return c}(),c=function(){function c(){this.text=this.marker=this.line=this.fill=null}c.prototype.release=function(){this.fill&&
(this.fill.forEach(function(a){return h.pool.release(a)}),this.fill.length=0);this.line&&(this.line.forEach(function(a){return h.pool.release(a)}),this.line.length=0);this.marker&&(this.marker.forEach(function(a){return h.pool.release(a)}),this.marker.length=0);this.text&&(this.text.forEach(function(a){return h.pool.release(a)}),this.text.length=0)};c.pool=new a(c);return c}(),e=function(){function b(){}b.prototype.acquire=function(){this.geometryDPInfo=c.pool.acquire()};b.prototype.release=function(){this.zLevel=
null;c.pool.release(this.geometryDPInfo);this.geometryDPInfo=null};b.pool=new a(b);return b}(),r=function(){function c(){this.zLevels=[]}c.prototype.release=function(){this.symbolLevel=null;this.zLevels.forEach(function(a){return e.pool.release(a)});this.zLevels.length=0};c.pool=new a(c);return c}();return C})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports","../../../../core/ObjectPool"],function(C,l,a){return function(){function b(){this.geometries=[{indexBuffer:void 0,
vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}b.prototype.release=function(){};b.deserialize=function(a){for(var d=b.pool.acquire(),h=0;4>h;++h){d.geometries[h].indexBuffer=new Uint32Array(a.geometries[h].indexBuffer);d.geometries[h].vertexBuffer={};for(var c in a.geometries[h].vertexBuffer)d.geometries[h].vertexBuffer[c]={data:new Uint32Array(a.geometries[h].vertexBuffer[c].data),stride:a.geometries[h].vertexBuffer[c].stride}}return d};
b.prototype.serialize=function(){for(var a={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}}]},b=0;4>b;++b)for(var h in this.geometries[b].vertexBuffer)a.geometries[b].vertexBuffer[h]={data:this.geometries[b].vertexBuffer[h].data.buffer,stride:this.geometries[b].vertexBuffer[h].stride};
return a};b.prototype.getBuffers=function(){for(var a=[],b=0;4>b;++b){a.push(this.geometries[b].indexBuffer.buffer);for(var h in this.geometries[b].vertexBuffer)a.push(this.geometries[b].vertexBuffer[h].data.buffer)}return a};b.pool=new a(b);return b}()})},"esri/views/2d/engine/webgl/displayObjectUtils":function(){define("require exports ./enums ./Utils ./visualVariablesUtils ./MeshUtils ./MaterialInfoUtils ./enums ./WGLDisplayObject ./WGLDisplayRecord".split(" "),function(C,l,a,b,d,g,h,c,e,r){function p(c,
b){if(!c)return a.WGLVVFlag.NONE;var e=0;c.forEach(function(c){var f=c.type;"size"===f&&"outline"!==c.target?e|=d.getTypeOfSizeVisualVariable(c):"color"===f?e|=a.WGLVVFlag.COLOR:"opacity"===f?e|=a.WGLVVFlag.OPACITY:b&&"rotation"===f&&(e|=a.WGLVVFlag.ROTATION)});return e}Object.defineProperty(l,"__esModule",{value:!0});var k=[];l.getDisplayObject=function(n,f,l,q,E,I,t,w,m){f=n.attributes[f];w=e.pool.acquire(f);k.length=0;var v=l.renderer,B=l.getSymbol(n);if(B){var A=b.isMarkerSymbol(B);if("esriGeometryPoint"===
q||"esriGeometryLine"===q)k.push({symbol:B,vv:p(v.visualVariables,A)});else if(A){if(v.backgroundFillSymbol&&(q=v.backgroundFillSymbol,k.push({symbol:q,vv:a.WGLVVFlag.NONE}),q.outline&&"none"!==q.outline.style)){A=a.WGLVVFlag.NONE;if(v.visualVariables)for(var D=0,H=v.visualVariables;D<H.length;D++){var N=H[D];if("size"===N.type&&"outline"===N.target){A|=d.getTypeOfSizeVisualVariable(N);break}}k.push({symbol:q.outline,vv:A})}k.push({symbol:B,vv:p(v.visualVariables,!0)})}else if(b.isFillSymbol(B)){A=
a.WGLVVFlag.NONE;if(v.visualVariables)for(D=0,H=v.visualVariables;D<H.length;D++)q=H[D],q=q.type,"color"===q?A|=a.WGLVVFlag.COLOR:"opacity"===q&&(A|=a.WGLVVFlag.OPACITY);k.push({symbol:B,vv:A});if(B.outline&&"none"!==B.outline.style){A=a.WGLVVFlag.NONE;if(v.visualVariables)for(D=0,v=v.visualVariables;D<v.length;D++)if(q=v[D],"size"===q.type&&"outline"===q.target){A|=d.getTypeOfSizeVisualVariable(q);break}k.push({symbol:B.outline,vv:A})}}else b.isLineSymbol(B)&&k.push({symbol:B,vv:p(v.visualVariables,
A)})}for(B=0;B<k.length;B++){A=k[B];q=A.symbol;v=b.getSymbolGeometryType(q);D=0!==A.vv;switch(v){case c.WGLGeometryType.MARKER:m.icon||(m.icon=b.getStrides(c.WGLGeometryType.MARKER,D,!1));break;case c.WGLGeometryType.LINE:m.line||(m.line=b.getStrides(c.WGLGeometryType.LINE,D));break;case c.WGLGeometryType.FILL:m.fill||(m.fill=b.getStrides(c.WGLGeometryType.FILL,D));break;case c.WGLGeometryType.TEXT:m.text||(m.text=b.getStrides(c.WGLGeometryType.TEXT,D))}if(v===c.WGLGeometryType.TEXT)for(v=0,q=[];v<
q.length;v++)w.displayRecords.push(q[v]);else D=t.get(q),A=h.createMaterialInfo(l,D,v,A.vv),q=g.createMesh(f,l,A.materialKeyInfo,D,v,E,I,n,q),v=r.pool.acquire(f,v,q,A,0,0),w.displayRecords.push(v)}return w}})},"esri/views/2d/engine/webgl/MeshUtils":function(){define("require exports ../../../../core/ArrayPool ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ./Utils ./visualVariablesUtils ./MeshData ./enums ./lineMeshUtil".split(" "),function(C,l,a,b,d,g,h,c,e,r){Object.defineProperty(l,
"__esModule",{value:!0});var p=new Float32Array(1),k=new Uint32Array(p.buffer);l.createTextMesh=function(a,c,b,e,d,h,g,k){return null};l.createMesh=function(n,f,l,q,E,I,t,w,m){switch(E){case e.WGLGeometryType.MARKER:E=c.pool.acquire();var v,B,A,D=0,H=0,N,M,J,u,z;(I=f.heatmapInfo)?(m=Math.round(f.heatmapInfo.radius),v=q=0,A=B=m,N=[1,1,1,1],M=[0,0,0,0],u=J=m,z=0):(A=q.spriteMosaicItem,q=Math.round(A.rect.x/4),v=Math.round(A.rect.y/4),B=q+Math.round(A.rect.width/4),A=v+Math.round(A.rect.height/4),D=
m.xoffset|0,H=m.yoffset|0,N=g.isPictureSymbol(m)?[255,255,255,255]:g.copyAndPremultiply(m.color),J=Math.round(b.pt2px(m.width||m.size)),u=Math.round(b.pt2px(m.height||m.size)),m.outline?(M=null!=m.outline.color?g.copyAndPremultiply(m.outline.color):[255,255,255,255],z=null!=m.outline.width?Math.round(b.pt2px(m.outline.width)):0):(M=[0,0,0,0],z=0));var y=w.centroid||w.geometry;m=[];t=g.i1616to32(y.x+D*t,y.y+H*t);D=g.i8888to32(N[0],N[1],N[2],N[3]);M=g.i8888to32(M[0],M[1],M[2],M[3]);J=g.i8888to32(J,
u,z,0);n=g.numTo32(n);var x=z=0;u=N=y=0;if(H=l.vvColor||l.vvOpacity||l.vvRotation||l.vvSizeMinMaxValue||l.vvSizeScaleStops||l.vvSizeFieldStops||l.vvSizeUnitValue)z=f.vvFields,y=z.rotation?f.getValue(w,z.rotation):0,x=z.opacity?f.getValue(w,z.opacity):0,N=z.color?f.getValue(w,z.color):0,z=z.size&&!l.vvSizeScaleStops?f.getValue(w,z.size):0,l.vvSizeUnitValue&&(z=h.getVisualVariableSizeValueRepresentationRatio(z,f.vvRanges.size.unitValue.valueRepresentation)),isNaN(z)&&(z=1),isNaN(y)&&(y=1),isNaN(x)&&
(x=1),isNaN(N)&&(N=1),p[0]=z,z=k[0],p[0]=x,x=k[0],p[0]=y,y=k[0],p[0]=N,N=k[0];I&&(p[0]=f.heatmapInfo.getIntensity(w),u=k[0]);m.push(t);m.push(g.i8888to32(-32,-32,q,v));m.push(n);m.push(D);m.push(M);m.push(J);H?(m.push(z),m.push(N),m.push(x),m.push(y)):I&&m.push(u);m.push(t);m.push(g.i8888to32(32,-32,B,v));m.push(n);m.push(D);m.push(M);m.push(J);H?(m.push(z),m.push(N),m.push(x),m.push(y)):I&&m.push(u);m.push(t);m.push(g.i8888to32(-32,32,q,A));m.push(n);m.push(D);m.push(M);m.push(J);H?(m.push(z),m.push(N),
m.push(x),m.push(y)):I&&m.push(u);m.push(t);m.push(g.i8888to32(32,32,B,A));m.push(n);m.push(D);m.push(M);m.push(J);H?(m.push(z),m.push(N),m.push(x),m.push(y)):I&&m.push(u);E.update({geometry:m},4,[0,1,2,1,3,2]);return E;case e.WGLGeometryType.FILL:E=c.pool.acquire();M=null!=q?q.spriteMosaicItem:null;D=w.geometry;t=g.isPictureSymbol(m);A=!t&&m.color?g.copyAndPremultiply(m.color):[255,255,255,255];I=g.numTo32(n);l=l.vvColor||l.vvOpacity;v=q=0;l&&(v=f.vvFields,q=v.opacity?f.getValue(w,v.opacity):0,f=
v.color?f.getValue(w,v.color):0,isNaN(q)&&(q=1),isNaN(f)&&(f=1),p[0]=q,q=k[0],p[0]=f,v=k[0]);f=g.i8888to32(A[0],A[1],A[2],A[3]);w=[0,0];A=[0,0];M&&(n=M.rect.x,J=M.rect.y,u=M.width,M=M.height,w[0]=n+1,w[1]=J+1,A[0]=n+1+u,A[1]=J+1+M);m=t&&m.width&&m.height?[g.nextHighestPowerOfTwo(m.width),g.nextHighestPowerOfTwo(m.height),0,0]:[g.nextHighestPowerOfTwo(A[0]-w[0]),g.nextHighestPowerOfTwo(A[1]-w[1]),0,0];m=g.i8888to32(m[0],m[1],m[2],m[3]);n=0;for(t=D.rings;n<t.length;n++)M=t[n];n=a.acquire();t=[];u=J=
0;for(D=D.rings;u<D.length;u++){M=D[u];H=J;N=0;z=M.length;y=M[0][0];x=M[0][1];n.push(y);n.push(x);J++;J++;for(var F=1;F<z;++F){var G=M[F][0],S=M[F][1];N-=G*(x+x+S);y+=G;x+=S;n.push(y);n.push(x);J++;J++}0<N?(B&&t.push(B),B={holeIndices:[],offset:H,coordCount:2*z}):0>N?B&&(B.holeIndices.push((H-B.offset)/2),B.coordCount+=2*z):(J=H,n.splice(H))}B&&t.push(B);B=[];D=[];for(J=M=0;J<t.length;J++)if(u=t[J],z=n.slice(u.offset,u.offset+u.coordCount),H=d(z,u.holeIndices,2),N=H.length,0<N){for(y=0;y<u.coordCount;)B.push(g.i1616to32(z[y++],
z[y++])),B.push(I),B.push(f),B.push(g.i1616to32(w[0],w[1])),B.push(g.i1616to32(A[0],A[1])),B.push(m),l&&(B.push(v),B.push(q));for(z=0;z<N;)D.push(H[z++]+M),D.push(H[z++]+M),D.push(H[z++]+M);M+=u.coordCount/2}a.release(n);E.update({geometry:B},M,D);return E;case e.WGLGeometryType.LINE:return r.createLineMeshData(n,f,l,q,I,t,w,m)}return null}})},"esri/core/libs/earcut/earcut":function(){define([],function(){function C(c,d,f){f=f||2;w=c.length/f+(d?2*d.length:0);m=!1;var k=d&&d.length,p=k?d[0]*f:c.length,
q=l(c,0,p,f,!0),v=[];if(!q)return v;var r,n,B,y;if(k)a:{var x=f,k=[],F,G,A;y=0;for(F=d.length;y<F;y++)G=d[y]*x,A=y<F-1?d[y+1]*x:c.length,G=l(c,G,A,x,!1),G===G.next&&(G.steiner=!0),k.push(e(G));k.sort(g);for(y=0;y<k.length;y++){if(!q){q=null;break a}d=k[y];x=q;if(x=h(d,x))d=D(x,d),a(d,d.next);q=a(q,q.next)}}if(m)return v;if(c.length>80*f){r=B=c[0];n=k=c[1];for(x=f;x<p;x+=f)y=c[x],d=c[x+1],y<r&&(r=y),d<n&&(n=d),y>B&&(B=y),d>k&&(k=d);B=Math.max(B-r,k-n)}b(q,v,f,r,n,B);return v}function l(a,c,b,e,d){var f;
if(d===0<t(a,c,b,e))for(d=c;d<b;d+=e)f=q(d,a[d],a[d+1],f);else for(d=b-e;d>=c;d-=e)f=q(d,a[d],a[d+1],f);f&&k(f,f.next)&&(E(f),f=f.next);return f}function a(a,c){if(!a)return a;c||(c=a);var b,e=0,d=w*w/2;do{b=!1;if(a.steiner||!k(a,a.next)&&0!==p(a.prev,a,a.next))a=a.next;else{E(a);a=c=a.prev;if(a===a.next)return null;b=!0}if(e++>d)return m=!0,null}while(b||a!==c);return c}function b(e,h,g,q,l,w,t){if(e){if(!t&&w){var v=e,u=v;do null===u.z&&(u.z=c(u.x,u.y,q,l,w)),u.prevZ=u.prev,u=u.nextZ=u.next;while(u!==
v);u.prevZ.nextZ=null;u.prevZ=null;var v=u,B,y,x,F,G,A,L=1;do{u=v;x=v=null;for(F=0;u;){F++;y=u;for(B=G=0;B<L&&(G++,y=y.nextZ,y);B++);for(A=L;0<G||0<A&&y;)0===G?(B=y,y=y.nextZ,A--):0!==A&&y?u.z<=y.z?(B=u,u=u.nextZ,G--):(B=y,y=y.nextZ,A--):(B=u,u=u.nextZ,G--),x?x.nextZ=B:v=B,B.prevZ=x,x=B;u=y}x.nextZ=null;L*=2}while(1<F)}for(v=e;e.prev!==e.next;){u=e.prev;y=e.next;if(w)a:{x=e;A=q;var K=l,P=w;F=x.prev;G=x;L=x.next;if(0<=p(F,G,L))x=!1;else{var Q=F.x>G.x?F.x>L.x?F.x:L.x:G.x>L.x?G.x:L.x,H=F.y>G.y?F.y>L.y?
F.y:L.y:G.y>L.y?G.y:L.y;B=c(F.x<G.x?F.x<L.x?F.x:L.x:G.x<L.x?G.x:L.x,F.y<G.y?F.y<L.y?F.y:L.y:G.y<L.y?G.y:L.y,A,K,P);A=c(Q,H,A,K,P);for(K=x.nextZ;K&&K.z<=A;){if(K!==x.prev&&K!==x.next&&r(F.x,F.y,G.x,G.y,L.x,L.y,K.x,K.y)&&0<=p(K.prev,K,K.next)){x=!1;break a}K=K.nextZ}for(K=x.prevZ;K&&K.z>=B;){if(K!==x.prev&&K!==x.next&&r(F.x,F.y,G.x,G.y,L.x,L.y,K.x,K.y)&&0<=p(K.prev,K,K.next)){x=!1;break a}K=K.prevZ}x=!0}}else x=d(e);if(x)h.push(u.i/g),h.push(e.i/g),h.push(y.i/g),E(e),v=e=y.next;else{if(m)break;e=y;
if(e===v){if(!t)b(a(e),h,g,q,l,w,1);else if(1===t){t=h;v=g;u=e;do y=u.prev,x=u.next.next,!k(y,x)&&n(y,u,u.next,x)&&f(y,x)&&f(x,y)&&(t.push(y.i/v),t.push(u.i/v),t.push(x.i/v),E(u),E(u.next),u=e=x),u=u.next;while(u!==e);e=u;b(e,h,g,q,l,w,2)}else if(2===t)a:{t=e;do{for(v=t.next.next;v!==t.prev;){if(u=t.i!==v.i){u=t;y=v;x=void 0;if(x=u.next.i!==y.i&&u.prev.i!==y.i){x=void 0;b:{x=u;do{if(x.i!==u.i&&x.next.i!==u.i&&x.i!==y.i&&x.next.i!==y.i&&n(x,x.next,u,y)){x=!0;break b}x=x.next}while(x!==u);x=!1}x=!x}F=
void 0;if(F=x&&f(u,y)&&f(y,u)){x=u;F=!1;G=(u.x+y.x)/2;y=(u.y+y.y)/2;do x.y>y!==x.next.y>y&&G<(x.next.x-x.x)*(y-x.y)/(x.next.y-x.y)+x.x&&(F=!F),x=x.next;while(x!==u)}u=F}if(u){e=D(t,v);t=a(t,t.next);e=a(e,e.next);b(t,h,g,q,l,w);b(e,h,g,q,l,w);break a}v=v.next}t=t.next}while(t!==e)}break}}}}}function d(a){var c=a.prev,b=a.next;if(0<=p(c,a,b))return!1;for(var e=a.next.next,d=0;e!==a.prev;){if(r(c.x,c.y,a.x,a.y,b.x,b.y,e.x,e.y)&&0<=p(e.prev,e,e.next))return!1;e=e.next;if(d++>w)return m=!0,!1}return!0}
function g(a,c){return a.x-c.x}function h(a,c){var b=c,e=a.x,d=a.y,h=-Infinity,g;do{if(!b)return null;if(d<=b.y&&d>=b.next.y){var k=b.x+(d-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(k<=e&&k>h){h=k;if(k===e){if(d===b.y)return b;if(d===b.next.y)return b.next}g=b.x<b.next.x?b:b.next}}b=b.next}while(b!==c);if(!g)return null;if(e===h)return g.prev;c=g;for(var k=g.x,m=g.y,p=Infinity,q,b=g.next;b!==c;)e>=b.x&&b.x>=k&&r(d<m?e:h,d,k,m,d<m?h:e,d,b.x,b.y)&&(q=Math.abs(d-b.y)/(e-b.x),(q<p||q===p&&b.x>g.x)&&f(b,a)&&
(g=b,p=q)),b=b.next;return g}function c(a,c,b,e,d){a=32767*(a-b)/d;c=32767*(c-e)/d;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;return(a|a<<1)&1431655765|((c|c<<1)&1431655765)<<1}function e(a){var c=a,b=a;do c.x<b.x&&(b=c),c=c.next;while(c!==a);return b}function r(a,c,b,e,d,f,h,g){return 0<=(d-h)*(c-g)-(a-h)*(f-g)&&0<=(a-h)*(e-g)-(b-h)*(c-g)&&0<=(b-h)*(f-g)-(d-h)*(e-g)}function p(a,c,b){return(c.y-a.y)*(b.x-c.x)-(c.x-a.x)*
(b.y-c.y)}function k(a,c){return a.x===c.x&&a.y===c.y}function n(a,c,b,e){return k(a,c)&&k(b,e)||k(a,e)&&k(b,c)?!0:0<p(a,c,b)!==0<p(a,c,e)&&0<p(b,e,a)!==0<p(b,e,c)}function f(a,c){return 0>p(a.prev,a,a.next)?0<=p(a,c,a.next)&&0<=p(a,a.prev,c):0>p(a,c,a.prev)||0>p(a,a.next,c)}function D(a,c){var b=new I(a.i,a.x,a.y),e=new I(c.i,c.x,c.y),d=a.next,f=c.prev;a.next=c;c.prev=a;b.next=d;d.prev=b;e.next=b;b.prev=e;f.next=e;e.prev=f;return e}function q(a,c,b,e){a=new I(a,c,b);e?(a.next=e.next,a.prev=e,e.next.prev=
a,e.next=a):(a.prev=a,a.next=a);return a}function E(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function I(a,c,b){this.i=a;this.x=c;this.y=b;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function t(a,c,b,e){for(var d=0,f=b-e;c<b;c+=e)d+=(a[f]-a[c])*(a[c+1]+a[f+1]),f=c;return d}var w,m;C.deviation=function(a,c,b,e){var d=c&&c.length,f=Math.abs(t(a,0,d?c[0]*b:a.length,b));if(d)for(var d=0,h=c.length;d<h;d++)f-=Math.abs(t(a,
c[d]*b,d<h-1?c[d+1]*b:a.length,b));for(d=c=0;d<e.length;d+=3){var h=e[d]*b,g=e[d+1]*b,k=e[d+2]*b;c+=Math.abs((a[h]-a[k])*(a[g+1]-a[h+1])-(a[h]-a[g])*(a[k+1]-a[h+1]))}return 0===f&&0===c?0:Math.abs((c-f)/f)};C.flatten=function(a){for(var c=a[0][0].length,b={vertices:[],holes:[],dimensions:c},e=0,d=0;d<a.length;d++){for(var f=0;f<a[d].length;f++)for(var h=0;h<c;h++)b.vertices.push(a[d][f][h]);0<d&&(e+=a[d-1].length,b.holes.push(e))}return b};return C})},"esri/views/2d/engine/webgl/lineMeshUtil":function(){define("require exports ./Utils ./visualVariablesUtils ./LineTess ./MeshData ./TileClipper".split(" "),
function(C,l,a,b,d,g,h){function c(a,c,b,e,f){"butt"===f?p.buttCap(a,c,b):"round"===f?p.roundCap(a,c,b,e,d.getNumberOfSlices(Math.PI),e===d.CapPosition.START?-1:1):"square"===f?p.squareCap(a,c,b,e):(p.buttCap(a,c,b),console.error("Unknown cap type!"))}function e(c,b,e,d,f,h,g,k,p,q,r,n){var m=0,y;for(y=0;y<r.vectors.count;++y){var x=r.vectors.items[y].vector[0],F=r.vectors.items[y].vector[1],G=r.vectors.items[y].texCoords[0],l=r.vectors.items[y].texCoords[1],u=r.vectors.items[y].direction[0],D=r.vectors.items[y].direction[1],
P=p+m;++m;n.push(a.i1616to32(c,b));n.push(g);n.push(d);n.push(a.i8888to32(Math.round(31*x),Math.round(31*F),Math.round(31*G),Math.round(31*l)));n.push(a.i1616to32(e,31*k));n.push(a.i1616to32(f[0],f[1]));n.push(a.i1616to32(h[0],h[1]));n.push(a.i8888to32(Math.round(31*u),Math.round(31*D),0,0));q&&(n.push(q.size),n.push(q.color),n.push(q.opacity));r.vectors.items[y].base={index:P,point:[c,b]}}return m}function r(a,c,b){p.bridge(q,a,c);for(a=0;a<q.count;++a)c=q.items[a],b.push(c.v1.base.index,c.v2.base.index,
c.v3.base.index)}Object.defineProperty(l,"__esModule",{value:!0});var p=new d.Tessellator({distanceAlongCorrection:!0}),k=new Float32Array(1),n=new Uint32Array(k.buffer),f=[d.allocExtrudeVectors(),d.allocExtrudeVectors()],D=d.allocExtrudeVectors(),q=d.allocTriangles(20),E=d.allocTriangles(20),I=new h.TileClipper(0,0,0,1,8);I.setExtent(a.C_TILE_SIZE);l.createLineMeshData=function(h,l,m,v,B,A,C,H){var t=null!=v?v.spriteMosaicItem:null,w=C.geometry,J=!a.isPictureSymbol(H)&&H.color?a.copyAndPremultiply(H.color):
[255,255,255,1];v=a.numTo32(h);var u=window.devicePixelRatio||1;H=0<H.width?.5*(H.width+1/u):0;var u=null!=t,z=m.vvColor||m.vvOpacity||m.vvSizeMinMaxValue||m.vvSizeScaleStops||m.vvSizeFieldStops||m.vvSizeUnitValue,y=0,x=0,F=0;z&&(F=l.vvFields,y=F.opacity?l.getValue(C,F.opacity):0,x=F.color?l.getValue(C,F.color):0,F=F.size&&!m.vvSizeScaleStops?l.getValue(C,F.size):0,m.vvSizeUnitValue&&(F=b.getVisualVariableSizeValueRepresentationRatio(F,l.vvRanges.size.unitValue.valueRepresentation)),isNaN(F)&&(F=
1),isNaN(y)&&(y=1),isNaN(x)&&(x=1),k[0]=F,F=n[0],k[0]=y,y=n[0],k[0]=x,x=n[0]);l=a.i8888to32(J[0],J[1],J[2],J[3]);m=[0,0];C=[0,0];if(t){var J=t.rect.x,G=t.rect.y,S=t.width,t=t.height;m[0]=J+1;m[1]=G+1;C[0]=J+1+S;C[1]=G+1+t}w=w.rings||w.paths;A*=8;t=-A;J=B+A;B=[];for(var G=w.length,S=0,L=!1;S<G;){var K=w[S];A=[];I.reset(2);var P=K[0][0],Q=K[0][1];if(L)I.moveTo(P,Q);else{if(P<t||P>J||Q<t||Q>J){L=!0;continue}A.push({x:P,y:Q})}for(var ba=!1,Z=K.length,X=1;X<Z;++X)if(P+=K[X][0],Q+=K[X][1],L)I.lineTo(P,
Q);else{if(P<t||P>J||Q<t||Q>J){ba=!0;break}A.push({x:P,y:Q})}if(ba)L=!0;else{if(L){if(L=I.resultWithStarts())for(A=0;A<L.length;A++)B.push(L[A])}else B.push({line:A,start:0});S++;L=!1}}w=0;t=[];J=[];for(G=0;G<B.length;G++)if(K=B[G],A=K.line,!(2>A.length))for(S=A.length,P=A[0],Q=A[S-1],L=Q.x-P.x,P=Q.y-P.y,L=1E-6>L*L+P*P,K=K.start,Q=P=void 0,ba=z?{size:F,color:x,opacity:y}:null,Q=0;Q<S;++Q){X=A[Q];Z=P===f[Q%2]?f[(Q+1)%2]:f[Q%2];if(Q<S-1||!L||u){a:{var T=Z,U=Q,Y=A,W=S,V=L,aa=Y[U],O=[void 0,void 0],R=
[void 0,void 0];if(0<U&&U<W-1){var ca=Y[(U+W-1)%W],da=Y[(U+1)%W];d.normalize(O,[aa.x-ca.x,aa.y-ca.y]);d.normalize(R,[da.x-aa.x,da.y-aa.y])}else if(0===U)da=Y[(U+1)%W],d.normalize(R,[da.x-aa.x,da.y-aa.y]),V?(Y=Y[W-2],d.normalize(O,[aa.x-Y.x,aa.y-Y.y])):O=R;else if(U===W-1)ca=Y[(U+W-1)%W],d.normalize(O,[aa.x-ca.x,aa.y-ca.y]),V?(Y=Y[1],d.normalize(R,[Y.x-aa.x,Y.y-aa.y])):R=O;else{console.error("Vertex index 'i' out of range.");break a}V||0!==U?V||U!==W-1?(U=d.getRads(O,R),U>Math.PI-.05?p.rectJoin(T,
O,R):.1>U?.05>U?p.fastMiterJoin(T,O,R):U<d.MITER_SAFE_RADS?p.miterJoin(T,O,R):p.bevelJoin(T,O,R,d.SYSTEM_MAG_LIMIT):(W=d.getNumberOfSlices(U),2.3>U?2>W||.5>U?p.bevelJoin(T,O,R,1):p.roundJoin(T,O,R,W):p.unitRoundJoin(T,O,R,W))):c(T,O,R,d.CapPosition.END,"round"):c(T,O,R,d.CapPosition.START,"round")}w+=e(X.x,X.y,K,l,m,C,v,H,w,ba,Z,t);if(Z.capCenter&&(!L||Q!==S-1))for(R=J,p.pie(E,Z),O=void 0,O=0;O<E.count;++O)T=E.items[O],R.push(T.v1.base.index,T.v2.base.index,T.v3.base.index);L&&0===Q&&!u&&d.copyExtrudeVectors(D,
Z)}else d.copyExtrudeVectors(Z,D);P&&r(P,Z,J);Q<S-1&&(O=A[Q+1],R=[O.x-X.x,O.y-X.y],T=d.length(R),R=[R[0]/T,R[1]/T],T=K+T,65535<T?(W=(65535-K)/(T-K),U=X.x+(O.x-X.x)*W,X=X.y+(O.y-X.y)*W,O=P,p.buttCap(O,R,R),w+=e(U,X,65535,l,m,C,h,H,w,ba,O,t),p.bridge(q,Z,O),r(Z,O,J),p.buttCap(O,R,R),w+=e(U,X,0,l,m,C,h,H,w,ba,O,t),K=T-K):(K=T,P=Z))}h=new g;h.update({geometry:t},w,J);return h}})},"esri/views/2d/engine/webgl/LineTess":function(){define(["require","exports"],function(C,l){function a(a){var c={items:[],
count:0},b;for(b=0;b<a;++b)c.items.push(void 0);return c}function b(a,c){w.vector[0]=a.vector[0];w.vector[1]=a.vector[1];w.texCoords[0]=a.texCoords[0];w.texCoords[1]=a.texCoords[1];w.direction[0]=a.direction[0];w.direction[1]=a.direction[1];w.base=a.base;a.vector[0]=c.vector[0];a.vector[1]=c.vector[1];a.texCoords[0]=c.texCoords[0];a.texCoords[1]=c.texCoords[1];a.direction[0]=c.direction[0];a.direction[1]=c.direction[1];a.base=c.base;c.vector[0]=w.vector[0];c.vector[1]=w.vector[1];c.texCoords[0]=w.texCoords[0];
c.texCoords[1]=w.texCoords[1];c.direction[0]=w.direction[0];c.direction[1]=w.direction[1];c.base=w.base}function d(a,c){return a[0]*c[0]+a[1]*c[1]}function g(a){return Math.sqrt(d(a,a))}function h(a,c){var b=g(c);a[0]=c[0]/b;a[1]=c[1]/b;return a}function c(a,c){a[0]=-c[1];a[1]=c[0];return a}function e(a,c){return a[0]*c[1]-a[1]*c[0]}function r(a,c){a[0]=-c[0];a[1]=-c[1];return a}function p(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;return a}function k(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];return a}function n(a,
c){a=d(a,c);return.999<a?0:-.999>a?Math.PI:Math.acos(a)}function f(a,c,b,e,d){if(0===e)a.count=0;else{var f=g(c),h=p(m[0],c,1/f);b=p(m[1],b,1/f);h=n(h,b);h=(d?-1:1)*h/e;d=Math.cos(h);h=Math.sin(h);b=c[0];var k=c[1];for(c=0;c<e-1;++c)f=b,b=d*f-h*k,k=h*f+d*k,a.items[c][0]=b,a.items[c][1]=k;a.count=e-1}}function D(a){var c=a.count,b=Math.floor(c/2),e;for(e=0;e<b;++e){var d=a.items[e];a.items[e]=a.items[c-e-1];a.items[c-e-1]=d}}Object.defineProperty(l,"__esModule",{value:!0});var q;(function(a){a[a.ENTRY=
1]="ENTRY";a[a.EXIT=2]="EXIT";a[a.CAP=3]="CAP"})(q=l.VectorRole||(l.VectorRole={}));var E;(function(a){a[a.START=1]="START";a[a.END=2]="END"})(E=l.CapPosition||(l.CapPosition={}));l.SYSTEM_MAG_LIMIT=3.8;l.MITER_SAFE_RADS=2*Math.acos(1/l.SYSTEM_MAG_LIMIT);var I=l.SYSTEM_MAG_LIMIT*l.SYSTEM_MAG_LIMIT,t=16/(2*Math.PI);l.allocTriangles=function(a){var c={items:[],count:0},b;for(b=0;b<a;++b)c.items.push({v1:{vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]},v2:{vector:[void 0,
void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]},v3:{vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]}});return c};l.allocExtrudeVectors=function(){var c={items:[],count:0},b;for(b=0;30>b;++b)c.items.push({vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]});b={};b[q.ENTRY]=a(20);b[q.EXIT]=a(20);b[q.CAP]=a(20);return{vectors:c,lists:b}};l.copyExtrudeVectors=function(a,c){var b;for(b=0;b<c.vectors.count;++b)a.vectors.items[b].vector[0]=
c.vectors.items[b].vector[0],a.vectors.items[b].vector[1]=c.vectors.items[b].vector[1],a.vectors.items[b].texCoords[0]=c.vectors.items[b].texCoords[0],a.vectors.items[b].texCoords[1]=c.vectors.items[b].texCoords[1],a.vectors.items[b].direction[0]=c.vectors.items[b].direction[0],a.vectors.items[b].direction[1]=c.vectors.items[b].direction[1],a.vectors.items[b].base=c.vectors.items[b].base;a.vectors.count=c.vectors.count;var e=c.lists[q.ENTRY],d=a.lists[q.ENTRY],f=c.lists[q.EXIT],h=a.lists[q.EXIT],
g=c.lists[q.CAP],k=a.lists[q.CAP];for(b=0;b<e.count;++b)d.items[b]=e.items[b];d.count=e.count;for(b=0;b<f.count;++b)h.items[b]=f.items[b];h.count=f.count;for(b=0;b<g.count;++b)k.items[b]=g.items[b];k.count=g.count;a.capCenter=c.capCenter};var w={vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0],base:void 0};l.swapExtrudeVectors=b;var m=[];for(C=0;32>C;++C)m.push([void 0,void 0]);var v=function(a){var c={items:[],count:0},b;for(b=0;b<a;++b)c.items.push([void 0,void 0]);return c}(16);
l.length=g;l.normalize=h;l.getNumberOfSlices=function(a){return Math.max(Math.round(a*t),1)};l.getRads=n;l.reverse=D;var B=[void 0,void 0],A=[void 0,void 0],V=[0,0],H=[0,0],N=[0,0],M=[0,0],J=Math.cos(Math.PI/4),u=Math.sin(Math.PI/4),z=Math.sqrt(2);C=function(){function a(a){this._distanceAlongCorrection=a.distanceAlongCorrection}a.prototype.bridge=function(a,c,e){var d=c.vectors;c=c.lists[q.EXIT];var f=e.vectors,h=e.lists[q.ENTRY],g,k;if(c.count===h.count+1)e=c.items,g=d.items,k=h.items,f=f.items;
else if(h.count===c.count+1)e=h.items,g=f.items,k=c.items,f=d.items;else if(c.count===h.count)e=h.items,g=f.items,k=c.items,f=d.items;else{console.error("Cannot bridge "+c.count+" to "+h.count+".");a.count=0;return}d=c.count+h.count-2;a.count=d;B[0]=e;B[1]=k;A[0]=g;A[1]=f;for(c=0;c<d;++c)e=a.items[c],g=(c+0)%2,g=A[g][B[g][Math.floor((c+0)/2)]],e.v1.vector[0]=g.vector[0],e.v1.vector[1]=g.vector[1],e.v1.texCoords[0]=g.texCoords[0],e.v1.texCoords[1]=g.texCoords[1],e.v1.direction[0]=g.direction[0],e.v1.direction[1]=
g.direction[1],e.v1.base=g.base,g=(c+1)%2,g=A[g][B[g][Math.floor((c+1)/2)]],e.v2.vector[0]=g.vector[0],e.v2.vector[1]=g.vector[1],e.v2.texCoords[0]=g.texCoords[0],e.v2.texCoords[1]=g.texCoords[1],e.v2.direction[0]=g.direction[0],e.v2.direction[1]=g.direction[1],e.v2.base=g.base,g=(c+2)%2,g=A[g][B[g][Math.floor((c+2)/2)]],e.v3.vector[0]=g.vector[0],e.v3.vector[1]=g.vector[1],e.v3.texCoords[0]=g.texCoords[0],e.v3.texCoords[1]=g.texCoords[1],e.v3.direction[0]=g.direction[0],e.v3.direction[1]=g.direction[1],
e.v3.base=g.base,g=e.v1.base&&e.v1.base.point||V,k=e.v2.base&&e.v2.base.point||V,f=e.v3.base&&e.v3.base.point||V,H[0]=g[0]+e.v1.vector[0],H[1]=g[1]+e.v1.vector[1],N[0]=k[0]+e.v2.vector[0],N[1]=k[1]+e.v2.vector[1],M[0]=f[0]+e.v3.vector[0],M[1]=f[1]+e.v3.vector[1],0>(N[0]-H[0])*(M[1]-H[1])-(M[0]-H[0])*(N[1]-H[1])||b(e.v2,e.v3)};a.prototype.pie=function(a,c){if(0===c.lists[q.CAP].count)a.count=0;else if(1===c.lists[q.CAP].count)console.error("A single vector is not enough to define a pie."),a.count=
0;else{a.count=c.lists[q.CAP].count-1;var e;for(e=0;e<a.count;++e){var d=a.items[e],f=c.vectors.items[c.lists[q.CAP].items[e]];d.v1.vector[0]=f.vector[0];d.v1.vector[1]=f.vector[1];d.v1.texCoords[0]=f.texCoords[0];d.v1.texCoords[1]=f.texCoords[1];d.v1.direction[0]=f.direction[0];d.v1.direction[1]=f.direction[1];d.v1.base=f.base;f=c.vectors.items[c.lists[q.CAP].items[e+1]];d.v2.vector[0]=f.vector[0];d.v2.vector[1]=f.vector[1];d.v2.texCoords[0]=f.texCoords[0];d.v2.texCoords[1]=f.texCoords[1];d.v2.direction[0]=
f.direction[0];d.v2.direction[1]=f.direction[1];d.v2.base=f.base;f=c.vectors.items[c.capCenter];d.v3.vector[0]=f.vector[0];d.v3.vector[1]=f.vector[1];d.v3.texCoords[0]=f.texCoords[0];d.v3.texCoords[1]=f.texCoords[1];d.v3.direction[0]=f.direction[0];d.v3.direction[1]=f.direction[1];d.v3.base=f.base;var f=d.v1.base&&d.v1.base.point||V,h=d.v2.base&&d.v2.base.point||V,g=d.v3.base&&d.v3.base.point||V;H[0]=f[0]+d.v1.vector[0];H[1]=f[1]+d.v1.vector[1];N[0]=h[0]+d.v2.vector[0];N[1]=h[1]+d.v2.vector[1];M[0]=
g[0]+d.v3.vector[0];M[1]=g[1]+d.v3.vector[1];0>(N[0]-H[0])*(M[1]-H[1])-(M[0]-H[0])*(N[1]-H[1])||b(d.v2,d.v3)}}};a.prototype.buttCap=function(a,c,b){this.fastMiterJoin(a,c,b)};a.prototype.roundCap=function(a,c,b,e,d,h){void 0===h&&(h=0);this.fastMiterJoin(a,c,b);b=e===E.START?0:1;e=e===E.START?1:0;a.capCenter=a.vectors.count;c=a.vectors.items[a.capCenter];c.vector[0]=0;c.vector[1]=0;c.texCoords[0]=0;c.texCoords[1]=0;c.direction[0]=0;c.direction[1]=0;++a.vectors.count;f(v,a.vectors.items[b].vector,
a.vectors.items[e].vector,d,!1);d=a.vectors.count;c=a.lists[q.CAP];c.items[0]=b;b=a.vectors.items[b].texCoords[1];var g=a.vectors.items[e].texCoords[1],k;for(k=0;k<v.count;++k){var p=h*(1-Math.abs(v.count/2-k)/(v.count/2)),m=b+k/(v.count-1)*(g-b),r=v.items[k],x=a.vectors.items[d+k];x.vector[0]=r[0];x.vector[1]=r[1];x.texCoords[0]=p;x.texCoords[1]=m;x.direction[0]=0;x.direction[1]=0;c.items[k+1]=d+k}c.items[v.count+1]=e;c.count=v.count+2;a.vectors.count=d+v.count};a.prototype.squareCap=function(a,
c,b,e){this.fastMiterJoin(a,c,b);c=e===E.START?0:1;b=e===E.START?1:0;var d=m[0],f=m[1],h=m[2],g=m[3];e=m[4];var k=a.vectors.items[c].vector;d[0]=J*k[0]-u*k[1];d[1]=u*k[0]+J*k[1];p(g,d,z);f[0]=J*d[0]-u*d[1];f[1]=u*d[0]+J*d[1];h[0]=J*f[0]-u*f[1];h[1]=u*f[0]+J*f[1];p(e,h,z);c=a.vectors.items[c];c.vector[0]=g[0];c.vector[1]=g[1];a=a.vectors.items[b];a.vector[0]=e[0];a.vector[1]=e[1]};a.prototype.fastMiterJoin=function(a,b,e){e=c(m[0],e);b=r(m[1],e);var d=a.vectors.items[0];d.vector[0]=e[0];d.vector[1]=
e[1];d.texCoords[0]=0;d.texCoords[1]=-1;d.direction[0]=0;d.direction[1]=0;e=a.vectors.items[1];e.vector[0]=b[0];e.vector[1]=b[1];e.texCoords[0]=0;e.texCoords[1]=1;e.direction[0]=0;e.direction[1]=0;a.vectors.count=2;b=a.lists[q.ENTRY];b.items[0]=0;b.items[1]=1;b.count=2;b=a.lists[q.EXIT];b.items[0]=0;b.items[1]=1;b.count=2;a.lists[q.CAP].count=0;a.capCenter=void 0};a.prototype.miterJoin=function(a,b,e){var f=c(m[0],b),g=c(m[1],e),k=m[2];k[0]=f[0]+g[0];k[1]=f[1]+g[1];g=h(m[3],k);f=d(g,f);g=p(m[4],g,
1/f);f=r(m[5],g);this._distanceAlongCorrection?(k=a.vectors.items[0],k.vector[0]=g[0],k.vector[1]=g[1],k.texCoords[0]=0,k.texCoords[1]=-1,k.direction[0]=b[0],k.direction[1]=b[1],k=a.vectors.items[1],k.vector[0]=f[0],k.vector[1]=f[1],k.texCoords[0]=0,k.texCoords[1]=1,k.direction[0]=b[0],k.direction[1]=b[1],b=a.vectors.items[2],b.vector[0]=g[0],b.vector[1]=g[1],b.texCoords[0]=0,b.texCoords[1]=-1,b.direction[0]=e[0],b.direction[1]=e[1],b=a.vectors.items[3],b.vector[0]=f[0],b.vector[1]=f[1],b.texCoords[0]=
0,b.texCoords[1]=1,b.direction[0]=e[0],b.direction[1]=e[1],a.vectors.count=4,e=a.lists[q.ENTRY],e.items[0]=0,e.items[1]=1,e.count=2,e=a.lists[q.EXIT],e.items[0]=2,e.items[1]=3):(k=a.vectors.items[0],k.vector[0]=g[0],k.vector[1]=g[1],k.texCoords[0]=0,k.texCoords[1]=-1,k.direction[0]=0,k.direction[1]=0,k=a.vectors.items[1],k.vector[0]=f[0],k.vector[1]=f[1],k.texCoords[0]=0,k.texCoords[1]=1,k.direction[0]=0,k.direction[1]=0,a.vectors.count=2,e=a.lists[q.ENTRY],e.items[0]=0,e.items[1]=1,e.count=2,e=a.lists[q.EXIT],
e.items[0]=0,e.items[1]=1);e.count=2;a.lists[q.CAP].count=0;a.capCenter=void 0};a.prototype.bevelJoin=function(a,b,f,g){var n=g*g;g=e(b,f);var l=0<g?[-1,1]:[1,-1],u=l[0],l=l[1],x=0<g?r(m[0],c(m[1],b)):c(m[2],b),y=0<g?r(m[3],c(m[4],f)):c(m[5],f),E=m[6];E[0]=x[0]+y[0];E[1]=x[1]+y[1];var F=h(m[7],E),t=r(m[8],F),v=d(F,x),E=e(F,x),G=Math.abs(E/v),E=1+G*G,w=E<I?[G,this._distanceAlongCorrection]:[Math.sqrt(I-1),!0],z=w[0],w=w[1],A=E<n?[G,this._distanceAlongCorrection]:[Math.sqrt(n-1),!0],G=A[0];(A=A[1])&&
w?(w=a.vectors.items[0],k(w.vector,r(m[9],x),p(m[10],r(m[11],b),z)),w.texCoords[0]=0,w.texCoords[1]=u,w.direction[0]=this._distanceAlongCorrection?b[0]:0,w.direction[1]=this._distanceAlongCorrection?b[1]:0,t=a.vectors.items[1],k(t.vector,r(m[12],y),p(m[13],f,z)),t.texCoords[0]=0,t.texCoords[1]=u,t.direction[0]=this._distanceAlongCorrection?f[0]:0,t.direction[1]=this._distanceAlongCorrection?f[1]:0,u=a.vectors.items[2],u.vector[0]=0,u.vector[1]=0,u.texCoords[0]=0,u.texCoords[1]=0,u.direction[0]=0,
u.direction[1]=0,u=a.vectors.items[3],k(u.vector,x,p(m[14],b,G)),u.texCoords[0]=0,u.texCoords[1]=l,u.direction[0]=this._distanceAlongCorrection?b[0]:0,u.direction[1]=this._distanceAlongCorrection?b[1]:0,b=a.vectors.items[4],k(b.vector,y,p(m[15],r(m[16],f),G)),b.texCoords[0]=0,b.texCoords[1]=l,b.direction[0]=this._distanceAlongCorrection?f[0]:0,b.direction[1]=this._distanceAlongCorrection?f[1]:0,a.vectors.count=5,f=a.lists[q.ENTRY],f.items[0]=0,f.items[1]=2,f.items[2]=3,f.count=3,f=a.lists[q.EXIT],
f.items[0]=1,f.items[1]=2,f.items[2]=4,f.count=3,E<n?(n=a.lists[q.CAP],n.count=0,a.capCenter=void 0):(n=a.lists[q.CAP],n.items[0]=3,n.items[1]=4,n.count=2,a.capCenter=2)):!A&&w?(w=a.vectors.items[0],k(w.vector,r(m[9],x),p(m[10],r(m[11],b),z)),w.texCoords[0]=0,w.texCoords[1]=u,w.direction[0]=this._distanceAlongCorrection?b[0]:0,w.direction[1]=this._distanceAlongCorrection?b[1]:0,t=a.vectors.items[1],k(t.vector,r(m[12],y),p(m[13],f,z)),t.texCoords[0]=0,t.texCoords[1]=u,t.direction[0]=this._distanceAlongCorrection?
f[0]:0,t.direction[1]=this._distanceAlongCorrection?f[1]:0,u=a.vectors.items[2],u.vector[0]=0,u.vector[1]=0,u.texCoords[0]=0,u.texCoords[1]=0,u.direction[0]=0,u.direction[1]=0,u=a.vectors.items[3],p(u.vector,F,1/v),u.texCoords[0]=0,u.texCoords[1]=l,u.direction[0]=0,u.direction[1]=0,a.vectors.count=4,f=a.lists[q.ENTRY],f.items[0]=0,f.items[1]=2,f.items[2]=3,f.count=3,f=a.lists[q.EXIT],f.items[0]=1,f.items[1]=2,f.items[2]=3,f.count=3,a.lists[q.CAP].count=0,a.capCenter=void 0):A&&!w?(w=a.vectors.items[0],
p(w.vector,t,1/v),w.texCoords[0]=0,w.texCoords[1]=u,w.direction[0]=0,w.direction[1]=0,t=a.vectors.items[1],t.vector[0]=0,t.vector[1]=0,t.texCoords[0]=0,t.texCoords[1]=0,t.direction[0]=0,t.direction[1]=0,u=a.vectors.items[2],k(u.vector,x,p(m[9],b,G)),u.texCoords[0]=0,u.texCoords[1]=l,u.direction[0]=this._distanceAlongCorrection?b[0]:0,u.direction[1]=this._distanceAlongCorrection?b[1]:0,u=a.vectors.items[3],k(u.vector,y,p(m[10],r(m[11],f),G)),u.texCoords[0]=0,u.texCoords[1]=l,u.direction[0]=this._distanceAlongCorrection?
f[0]:0,u.direction[1]=this._distanceAlongCorrection?f[1]:0,a.vectors.count=4,f=a.lists[q.ENTRY],f.items[0]=0,f.items[1]=1,f.items[2]=2,f.count=3,f=a.lists[q.EXIT],f.items[0]=0,f.items[1]=1,f.items[2]=3,f.count=3,E<n?(n=a.lists[q.CAP],n.count=0,a.capCenter=void 0):(n=a.lists[q.CAP],n.items[0]=2,n.items[1]=3,n.count=2,a.capCenter=1)):A||w||(w=a.vectors.items[0],p(w.vector,t,1/v),w.texCoords[0]=0,w.texCoords[1]=u,w.direction[0]=0,w.direction[1]=0,t=a.vectors.items[1],p(t.vector,F,1/v),t.texCoords[0]=
0,t.texCoords[1]=l,t.direction[0]=0,t.direction[1]=0,a.vectors.count=2,f=a.lists[q.ENTRY],f.items[0]=0,f.items[1]=1,f.count=2,f=a.lists[q.EXIT],f.items[0]=0,f.items[1]=1,f.count=2,a.lists[q.CAP].count=0,a.capCenter=void 0);0>g&&(D(a.lists[q.ENTRY]),D(a.lists[q.EXIT]))};a.prototype.roundJoin=function(a,b,g,n){var l=e(b,g),u=0<l?[-1,1]:[1,-1],x=u[0],u=u[1],t=0<l?r(m[0],c(m[1],b)):c(m[2],b),y=0<l?r(m[3],c(m[4],g)):c(m[5],g),E=m[6];E[0]=t[0]+y[0];E[1]=t[1]+y[1];var w=h(m[7],E),E=r(m[8],w),F=d(w,t),w=
e(w,t),w=Math.abs(w/F),z=1+w*w<I?[w,this._distanceAlongCorrection]:[Math.sqrt(I-1),!0],w=z[0];z[1]?(z=a.vectors.items[0],z.vector[0]=t[0],z.vector[1]=t[1],z.texCoords[0]=0,z.texCoords[1]=u,z.direction[0]=0,z.direction[1]=0,z=a.vectors.items[1],z.vector[0]=y[0],z.vector[1]=y[1],z.texCoords[0]=0,z.texCoords[1]=u,z.direction[0]=0,z.direction[1]=0,z=a.vectors.items[2],k(z.vector,r(m[9],t),p(m[10],r(m[11],b),w)),z.texCoords[0]=0,z.texCoords[1]=x,z.direction[0]=this._distanceAlongCorrection?b[0]:0,z.direction[1]=
this._distanceAlongCorrection?b[1]:0,b=a.vectors.items[3],k(b.vector,r(m[12],y),p(m[13],g,w)),b.texCoords[0]=0,b.texCoords[1]=x,b.direction[0]=this._distanceAlongCorrection?g[0]:0,b.direction[1]=this._distanceAlongCorrection?g[1]:0,g=a.vectors.items[4],g.vector[0]=0,g.vector[1]=0,g.texCoords[0]=0,g.texCoords[1]=0,g.direction[0]=0,g.direction[1]=0,a.vectors.count=5,g=a.lists[q.ENTRY],g.items[0]=2,g.items[1]=4,g.items[2]=0,g.count=3,g=a.lists[q.EXIT],g.items[0]=3,g.items[1]=4,g.items[2]=1,g.count=3,
a.capCenter=4):(z=a.vectors.items[0],z.vector[0]=t[0],z.vector[1]=t[1],z.texCoords[0]=0,z.texCoords[1]=u,z.direction[0]=0,z.direction[1]=0,z=a.vectors.items[1],z.vector[0]=y[0],z.vector[1]=y[1],z.texCoords[0]=0,z.texCoords[1]=u,z.direction[0]=0,z.direction[1]=0,z=a.vectors.items[2],p(z.vector,E,1/F),z.texCoords[0]=0,z.texCoords[1]=x,z.direction[0]=0,z.direction[1]=0,b=a.vectors.items[3],b.vector[0]=0,b.vector[1]=0,b.texCoords[0]=0,b.texCoords[1]=0,b.direction[0]=0,b.direction[1]=0,a.vectors.count=
4,g=a.lists[q.ENTRY],g.items[0]=2,g.items[1]=3,g.items[2]=0,g.count=3,g=a.lists[q.EXIT],g.items[0]=2,g.items[1]=3,g.items[2]=1,g.count=3,a.capCenter=3);f(v,t,y,n,0>l);n=a.vectors.count;t=a.lists[q.CAP];for(y=t.items[0]=0;y<v.count;++y)g=v.items[y],x=a.vectors.items[n+y],x.vector[0]=g[0],x.vector[1]=g[1],x.texCoords[0]=0,x.texCoords[1]=u,x.direction[0]=0,x.direction[1]=0,t.items[y+1]=n+y;t.items[v.count+1]=1;t.count=v.count+2;a.vectors.count=n+v.count;0>l&&(D(a.lists[q.ENTRY]),D(a.lists[q.EXIT]))};
a.prototype.unitRoundJoin=function(a,b,d,g){var h=e(b,d),k=0<h?[-1,1]:[1,-1],p=k[0],k=k[1];b=0<h?r(m[0],c(m[1],b)):c(m[2],b);d=0<h?r(m[3],c(m[4],d)):c(m[5],d);var n=a.vectors.items[0];n.vector[0]=b[0];n.vector[1]=b[1];n.texCoords[0]=0;n.texCoords[1]=k;n.direction[0]=0;n.direction[1]=0;n=a.vectors.items[1];n.vector[0]=d[0];n.vector[1]=d[1];n.texCoords[0]=0;n.texCoords[1]=k;n.direction[0]=0;n.direction[1]=0;n=a.vectors.items[2];r(n.vector,b);n.texCoords[0]=0;n.texCoords[1]=p;n.direction[0]=0;n.direction[1]=
0;n=a.vectors.items[3];r(n.vector,d);n.texCoords[0]=0;n.texCoords[1]=p;n.direction[0]=0;n.direction[1]=0;p=a.vectors.items[4];p.vector[0]=0;p.vector[1]=0;p.texCoords[0]=0;p.texCoords[1]=0;p.direction[0]=0;p.direction[1]=0;a.vectors.count=5;p=a.lists[q.ENTRY];p.items[0]=2;p.items[1]=0;p.count=2;p=a.lists[q.EXIT];p.items[0]=3;p.items[1]=1;p.count=2;a.capCenter=4;f(v,b,d,g,0>h);g=a.vectors.count;b=a.lists[q.CAP];for(p=b.items[0]=0;p<v.count;++p)d=v.items[p],n=a.vectors.items[g+p],n.vector[0]=d[0],n.vector[1]=
d[1],n.texCoords[0]=0,n.texCoords[1]=k,n.direction[0]=0,n.direction[1]=0,b.items[p+1]=g+p;b.items[v.count+1]=1;b.count=v.count+2;a.vectors.count=g+v.count;0>h&&(D(a.lists[q.ENTRY]),D(a.lists[q.EXIT]))};a.prototype.rectJoin=function(a,b,e){b=c(m[0],b);e=c(m[1],e);var d=a.vectors.items[0];d.vector[0]=b[0];d.vector[1]=b[1];d.texCoords[0]=0;d.texCoords[1]=-1;d.direction[0]=0;d.direction[1]=0;d=a.vectors.items[1];d.vector[0]=e[0];d.vector[1]=e[1];d.texCoords[0]=0;d.texCoords[1]=-1;d.direction[0]=0;d.direction[1]=
0;d=a.vectors.items[2];r(d.vector,b);d.texCoords[0]=0;d.texCoords[1]=1;d.direction[0]=0;d.direction[1]=0;b=a.vectors.items[3];r(b.vector,e);b.texCoords[0]=0;b.texCoords[1]=1;b.direction[0]=0;b.direction[1]=0;a.vectors.count=4;b=a.lists[q.ENTRY];b.items[0]=0;b.items[1]=2;b.count=2;b=a.lists[q.EXIT];b.items[0]=1;b.items[1]=3;b.count=2;a.capCenter=void 0};return a}();l.Tessellator=C})},"esri/views/2d/engine/webgl/TileClipper":function(){define(["require","exports","./Geometry","./GeometryUtils"],function(C,
l,a,b){Object.defineProperty(l,"__esModule",{value:!0});var d=function(){return function(a,c,b){this.ratio=a;this.x=c;this.y=b}}();C=function(){function b(a,b,d,g,h){void 0===g&&(g=8);void 0===h&&(h=8);this.lines=[];this.starts=[];this.pixelRatio=g;this.pixelMargin=h;this.tileSize=512*g;this.dz=a;this.yPos=b;this.xPos=d}b.prototype.setExtent=function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var c=this.pixelRatio*this.pixelMargin,c=c/this.finalRatio;a>>=this.dz;c>a&&(c=a);this.margin=c;this.xmin=
a*this.xPos-c;this.ymin=a*this.yPos-c;this.xmax=this.xmin+a+2*c;this.ymax=this.ymin+a+2*c};b.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};b.prototype.moveTo=function(c,b){this._pushLine();this._prevIsIn=this._isIn(c,b);this._moveTo(c,b,this._prevIsIn);this._prevPt=new a.Point(c,b);this._firstPt=new a.Point(c,b);this._dist=0};b.prototype.lineTo=function(c,b){var e=this._isIn(c,b),g=new a.Point(c,b),h=a.Point.distance(this._prevPt,g),n,f,l;if(e)this._prevIsIn?
this._lineTo(c,b,!0):(n=this._prevPt,f=g,c=this._intersect(f,n),this.start=this._dist+h*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(f.x,f.y,!0));else if(this._prevIsIn)f=this._prevPt,n=g,c=this._intersect(f,n),this._lineTo(c.x,c.y,!0),this._lineTo(n.x,n.y,!1);else{var q=this._prevPt;if(!(q.x<=this.xmin&&g.x<=this.xmin||q.x>=this.xmax&&g.x>=this.xmax||q.y<=this.ymin&&g.y<=this.ymin||q.y>=this.ymax&&g.y>=this.ymax)){c=[];if(q.x<this.xmin&&g.x>this.xmin||q.x>this.xmin&&g.x<this.xmin)b=(this.xmin-
q.x)/(g.x-q.x),l=q.y+b*(g.y-q.y),l<=this.ymin?f=!1:l>=this.ymax?f=!0:c.push(new d(b,this.xmin,l));if(q.x<this.xmax&&g.x>this.xmax||q.x>this.xmax&&g.x<this.xmax)b=(this.xmax-q.x)/(g.x-q.x),l=q.y+b*(g.y-q.y),l<=this.ymin?f=!1:l>=this.ymax?f=!0:c.push(new d(b,this.xmax,l));if(q.y<this.ymin&&g.y>this.ymin||q.y>this.ymin&&g.y<this.ymin)b=(this.ymin-q.y)/(g.y-q.y),l=q.x+b*(g.x-q.x),l<=this.xmin?n=!1:l>=this.xmax?n=!0:c.push(new d(b,l,this.ymin));if(q.y<this.ymax&&g.y>this.ymax||q.y>this.ymax&&g.y<this.ymax)b=
(this.ymax-q.y)/(g.y-q.y),l=q.x+b*(g.x-q.x),l<=this.xmin?n=!1:l>=this.xmax?n=!0:c.push(new d(b,l,this.ymax));if(0===c.length)n?f?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):f?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<c.length&&c[0].ratio>c[1].ratio)this.start=this._dist+h*c[1].ratio,this._lineTo(c[1].x,c[1].y,!0),this._lineTo(c[0].x,c[0].y,!0);else for(this.start=this._dist+h*c[0].ratio,n=0;n<c.length;n++)this._lineTo(c[n].x,
c[n].y,!0)}this._lineTo(g.x,g.y,!1)}this._dist+=h;this._prevIsIn=e;this._prevPt=g};b.prototype.close=function(){var a,b;0<this.line.length&&(a=this._firstPt,b=this._prevPt,a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y),a=this.line,b=a.length,4<=b&&(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)&&(a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y))};b.prototype.result=function(){this._pushLine();if(0===this.lines.length)return null;3===this.type&&g.simplify(this.margin*this.finalRatio,this.lines);
return this.lines};b.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,b=a.length;if(0===b)return null;for(var d=[],g=0;g<b;g++)d.push({line:a[g],start:this.starts[g]||0});return d};b.prototype._isIn=function(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax};b.prototype._intersect=function(b,e){var c,d,g;if(e.x>=this.xmin&&e.x<=this.xmax)d=e.y<=this.ymin?this.ymin:this.ymax,g=(d-b.y)/(e.y-b.y),c=b.x+g*(e.x-
b.x);else if(e.y>=this.ymin&&e.y<=this.ymax)c=e.x<=this.xmin?this.xmin:this.xmax,g=(c-b.x)/(e.x-b.x),d=b.y+g*(e.y-b.y);else{d=e.y<=this.ymin?this.ymin:this.ymax;c=e.x<=this.xmin?this.xmin:this.xmax;var h=(c-b.x)/(e.x-b.x),f=(d-b.y)/(e.y-b.y);h<f?(g=h,d=b.y+h*(e.y-b.y)):(g=f,c=b.x+f*(e.x-b.x))}this._r=g;return new a.Point(c,d)};b.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?1<this.line.length&&(this.lines.push(this.line),
this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};b.prototype._moveTo=function(b,e,d){3!==this.type?d&&(b=Math.round((b-(this.xmin+this.margin))*this.finalRatio),e=Math.round((e-(this.ymin+this.margin))*this.finalRatio),this.line.push(new a.Point(b,e))):(d||(b<this.xmin&&(b=this.xmin),b>this.xmax&&(b=this.xmax),e<this.ymin&&(e=this.ymin),e>this.ymax&&(e=this.ymax)),b=Math.round((b-(this.xmin+this.margin))*
this.finalRatio),e=Math.round((e-(this.ymin+this.margin))*this.finalRatio),this.line.push(new a.Point(b,e)),this._is_v=this._is_h=!1)};b.prototype._lineTo=function(b,e,d){if(3!==this.type)if(d){b=Math.round((b-(this.xmin+this.margin))*this.finalRatio);e=Math.round((e-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(d=this.line[this.line.length-1],d.equals(b,e)))return;this.line.push(new a.Point(b,e))}else this.line&&0<this.line.length&&this._pushLine();else if(d||(b<this.xmin&&(b=
this.xmin),b>this.xmax&&(b=this.xmax),e<this.ymin&&(e=this.ymin),e>this.ymax&&(e=this.ymax)),b=Math.round((b-(this.xmin+this.margin))*this.finalRatio),e=Math.round((e-(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){d=this.line[this.line.length-1];var c=d.x===b,g=d.y===e;c&&g||(this._is_h&&c?(d.x=b,d.y=e,d=this.line[this.line.length-2],this._is_h=d.x===b,this._is_v=d.y===e):this._is_v&&g?(d.x=b,d.y=e,d=this.line[this.line.length-2],this._is_h=d.x===b,this._is_v=d.y===e):(this.line.push(new a.Point(b,
e)),this._is_h=c,this._is_v=g))}else this.line.push(new a.Point(b,e))};return b}();l.TileClipper=C;C=function(){function b(){}b.prototype.setExtent=function(a){this._ratio=4096===a?1:4096/a};b.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};b.prototype.moveTo=function(b,d){this.line&&this.lines.push(this.line);this.line=[];var c=this._ratio;this.line.push(new a.Point(Math.round(b*c),Math.round(d*c)))};b.prototype.lineTo=function(b,d){var c=this._ratio;this.line.push(new a.Point(Math.round(b*
c),Math.round(d*c)))};b.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};b.prototype.result=function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&g.simplify(64,this.lines);return this.lines};return b}();l.SimpleBuilder=C;var g=function(){function a(){}a.simplify=function(b,d){if(d){var c=-b,e=4096+b,g=-b,h=4096+b;b=[];for(var f=[],l=d.length,q=0;q<l;++q){var E=d[q];if(E&&!(2>E.length))for(var I=
E[0],t=void 0,w=E.length,m=1;m<w;++m)t=E[m],I.x===t.x&&(I.x<=c&&(I.y>t.y?(b.push(q),b.push(m),b.push(0),b.push(-1)):(f.push(q),f.push(m),f.push(0),f.push(-1))),I.x>=e&&(I.y<t.y?(b.push(q),b.push(m),b.push(1),b.push(-1)):(f.push(q),f.push(m),f.push(1),f.push(-1)))),I.y===t.y&&(I.y<=g&&(I.x<t.x?(b.push(q),b.push(m),b.push(2),b.push(-1)):(f.push(q),f.push(m),f.push(2),f.push(-1))),I.y>=h&&(I.x>t.x?(b.push(q),b.push(m),b.push(3),b.push(-1)):(f.push(q),f.push(m),f.push(3),f.push(-1)))),I=t}0!==b.length&&
0!==f.length&&(a.fillParent(d,f,b),a.fillParent(d,b,f),c=[],a.calcDeltas(c,f,b),a.calcDeltas(c,b,f),a.addDeltas(c,d))}};a.fillParent=function(a,d,g){for(var c=g.length,e=d.length,h=0;h<e;h+=4){for(var f=d[h],l=d[h+1],q=d[h+2],r=a[f][l-1],f=a[f][l],l=8092,I=-1,t=0;t<c;t+=4)if(g[t+2]===q){var w=g[t],m=g[t+1],v=a[w][m-1],w=a[w][m];switch(q){case 0:case 1:b.between(r.y,v.y,w.y)&&b.between(f.y,v.y,w.y)&&(v=Math.abs(w.y-v.y),v<l&&(l=v,I=t));break;case 2:case 3:b.between(r.x,v.x,w.x)&&b.between(f.x,v.x,
w.x)&&(v=Math.abs(w.x-v.x),v<l&&(l=v,I=t))}}d[h+3]=I}};a.calcDeltas=function(b,d,g){for(var c=d.length,e=0;e<c;e+=4){var h=a.calcDelta(e,d,g,[]);b.push(d[e]);b.push(d[e+1]);b.push(d[e+2]);b.push(h)}};a.calcDelta=function(b,d,g,h){b=d[b+3];if(-1===b)return 0;var c=h.length;if(1<c&&h[c-2]===b)return 0;h.push(b);return a.calcDelta(b,g,d,h)+1};a.addDeltas=function(a,b){for(var c=a.length,d=0,e=0;e<c;e+=4){var g=a[e+3];g>d&&(d=g)}for(e=0;e<c;e+=4){var f=b[a[e]],h=a[e+1],g=d-a[e+3];switch(a[e+2]){case 0:f[h-
1].x-=g;f[h].x-=g;break;case 1:f[h-1].x+=g;f[h].x+=g;break;case 2:f[h-1].y-=g;f[h].y-=g;break;case 3:f[h-1].y+=g,f[h].y+=g}}a=b.length;for(c=0;c<a;++c)f=b[c],!f||2>f.length||f[f.length-1].x!==f[0].x&&f[f.length-1].y!==f[0].y&&f.push(f[0])};return a}()})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/ObjectPool ../../../../core/libs/gl-matrix/vec2 ../../../../core/libs/gl-matrix/mat4 ../../tiling/TileKey ../DisplayObject ./WGLDisplayRecord ./WGLGeometry ./enums ./Utils ./WGLDisplayList".split(" "),
function(C,l,a,b,d,g,h,c,e,r,p,k,n){return function(c){function f(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=c.call(this)||this;b.displayList=null;b.hlDisplayList=null;b.displayObjectRegistry=new Map;b.iconDisplayRecords=null;b.textDisplayRecords=null;b.lineDisplayRecords=null;b.fillDisplayRecords=null;b.iconGeometry=null;b.textGeometry=null;b.lineGeometry=null;b.fillGeometry=null;b.coords=[0,0];b.bounds=[0,0,0,0];b.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};
b._hasVisualVariables=!1;0<a.length&&(e=b.acquire).call.apply(e,[b].concat(a));b.tileTransform.transform=g.create();b.tileTransform.displayCoord=d.create();return b;var e}a(f,c);f.prototype.acquire=function(a,b,c,d,e){this.key=h.pool.acquire(a);this.coords[0]=b[0];this.coords[1]=b[3];this.bounds=b;this.coordRange=c;this.width=d;this.height=e};f.prototype.release=function(){this.clear();h.pool.release(this.key);this.key=null};Object.defineProperty(f.prototype,"canDisplay",{get:function(){return!!this.attached&&
!!this.displayList},enumerable:!0,configurable:!0});f.prototype.setData=function(a,b,c){a&&(this._hasVisualVariables=b,this.displayList&&a.tileDisplayData.displayList!==this.displayList&&n.pool.release(this.displayList),this.displayList=a.tileDisplayData.displayList,this.fillDisplayRecords=a.tileDisplayData.fillDisplayRecords,this.lineDisplayRecords=a.tileDisplayData.lineDisplayRecords,this.iconDisplayRecords=a.tileDisplayData.iconDisplayRecords,this.textDisplayRecords=a.tileDisplayData.textDisplayRecords,
this.displayObjectRegistry=a.tileDisplayData.displayObjectRegistry,this.fillDisplayRecords&&0<this.fillDisplayRecords.length&&(this.fillGeometry=new r,this.fillGeometry.initializeWithBuffers(this._hasVisualVariables?k.C_FILL_VERTEX_DEF_VV:k.C_FILL_VERTEX_DEF,a.tileBufferData.geometries[p.WGLGeometryType.FILL],35044)),this.lineDisplayRecords&&0<this.lineDisplayRecords.length&&(this.lineGeometry=new r,this.lineGeometry.initializeWithBuffers(this._hasVisualVariables?k.C_LINE_VERTEX_DEF_VV:k.C_LINE_VERTEX_DEF,
a.tileBufferData.geometries[p.WGLGeometryType.LINE],35044)),this.iconDisplayRecords&&0<this.iconDisplayRecords.length&&(this.iconGeometry=new r,this.iconGeometry.initializeWithBuffers(this._hasVisualVariables?k.C_ICON_VERTEX_DEF_VV:k.C_ICON_VERTEX_DEF,a.tileBufferData.geometries[p.WGLGeometryType.MARKER],35044)),this.textDisplayRecords&&0<this.textDisplayRecords.length&&(this.textGeometry=new r,this.textGeometry.initializeWithBuffers(void 0,a.tileBufferData.geometries[p.WGLGeometryType.TEXT],35044)))};
f.prototype.appendData=function(a){};f.prototype.updateObjects=function(a){var b=(a.remove||[]).slice();a=a.update||[];for(var c=[],d=[],e=[],f=[],g=[],h=0;h<a.length;h++){var l=a[h];this.displayObjectRegistry.get(l.id)&&b.push(l.id)}for(var q=0;q<b.length;q++){var D=b[q];if(l=this.displayObjectRegistry.get(D)){for(var C=0,l=l.displayRecords;C<l.length;C++)switch(h=l[C],c.push(h),h.geometryType){case p.WGLGeometryType.FILL:d.push(h);break;case p.WGLGeometryType.LINE:e.push(h);break;case p.WGLGeometryType.MARKER:f.push(h);
break;case p.WGLGeometryType.TEXT:g.push(h)}this.displayObjectRegistry.delete(D)}}this.displayList||(this.displayList=n.pool.acquire());(l=this.displayList)&&l.removeFromList(c);this._removeRecords(this.fillGeometry,this.fillDisplayRecords,d);this._removeRecords(this.lineGeometry,this.lineDisplayRecords,e);this._removeRecords(this.iconGeometry,this.iconDisplayRecords,f);this._removeRecords(this.textGeometry,this.textDisplayRecords,g);b=[];for(c=0;c<a.length;c++){l=a[c];d=0;for(e=l.displayRecords;d<
e.length;d++)switch(h=e[d],b.push(h),h.geometryType){case p.WGLGeometryType.FILL:this.fillDisplayRecords=this.fillDisplayRecords||[];this.fillDisplayRecords.push(h);break;case p.WGLGeometryType.LINE:this.lineDisplayRecords=this.lineDisplayRecords||[];this.lineDisplayRecords.push(h);break;case p.WGLGeometryType.MARKER:this.iconDisplayRecords=this.iconDisplayRecords||[];this.iconDisplayRecords.push(h);break;case p.WGLGeometryType.TEXT:this.textDisplayRecords=this.textDisplayRecords||[],this.textDisplayRecords.push(h)}this.displayObjectRegistry.set(l.id,
l)}a=!1;this.fillGeometry||(this.fillGeometry=new r);this.lineGeometry||(this.lineGeometry=new r);this.iconGeometry||(this.iconGeometry=new r);a=a||this._updateRecords(this.iconGeometry,this.iconDisplayRecords,this._hasVisualVariables?k.C_ICON_VERTEX_DEF_VV:k.C_ICON_VERTEX_DEF);this.textGeometry||(this.textGeometry=new r);a?(this.displayList&&n.pool.release(this.displayList),a=n.pool.acquire(),a.addToList(this.fillDisplayRecords),a.addToList(this.lineDisplayRecords),a.addToList(this.iconDisplayRecords),
a.addToList(this.textDisplayRecords),this.displayList=a):(a=this.displayList)?a.addToList(b):(a=n.pool.acquire(),a.addToList(b),this.displayList=a)};f.prototype._updateRecords=function(a,b,c){if(a.update(b)===p.WGLGeometryTransactionStatus.FAILED_OUT_OF_MEMORY)return a.initializeWithRecords(c,b,35044),this.attached=!1,!0;a.invalidateIndexBuffer();a.invalidateVertexBuffers();return!1};f.prototype._removeRecords=function(a,b,c){if(a){this.iconGeometry.remove(c);for(var d=a=b.length,e=0;e<a;++e){for(var f=
void 0,f=0;f<d&&b[e]!==c[f];++f);f<c.length&&(b.splice(e,1),e--)}}};f.prototype.clear=function(){this.iconGeometry&&(this.iconGeometry.clear(),this.iconGeometry=null);this.textGeometry&&(this.textGeometry.clear(),this.textGeometry=null);this.lineGeometry&&(this.lineGeometry.clear(),this.lineGeometry=null);this.fillGeometry&&(this.fillGeometry.clear(),this.fillGeometry=null);this.displayObjectRegistry.clear();this.displayList&&(n.pool.release(this.displayList),this.displayList=null);this.hlDisplayList&&
(n.pool.release(this.hlDisplayList),this.hlDisplayList=null);this.iconDisplayRecords&&(this.iconDisplayRecords.length=0);this.textDisplayRecords&&(this.textDisplayRecords.length=0);this.lineDisplayRecords&&(this.lineDisplayRecords.length=0);this.fillDisplayRecords&&(this.fillDisplayRecords.length=0)};f.prototype.dispose=function(){this.release()};f.prototype.attach=function(a){var b=!0;this.fillGeometry&&(this.fillGeometry.attached||(b=b&&this.fillGeometry.attach(a)));this.lineGeometry&&(this.lineGeometry.attached||
(b=b&&this.lineGeometry.attach(a)));this.iconGeometry&&(this.iconGeometry.attached||(b=b&&this.iconGeometry.attach(a)));this.textGeometry&&(this.textGeometry.attached||(b=b&&this.textGeometry.attach(a)));return b};f.prototype.detach=function(a){};f.prototype.doRender=function(a){};f.prototype.buildHLList=function(a){var b=this;this.hlDisplayList&&n.pool.release(this.hlDisplayList);this.hlDisplayList=n.pool.acquire();a.forEach(function(a){if(a=b.displayObjectRegistry.get(a)){a=a.displayRecords.map(function(a){var b=
e.pool.acquire();b.id=a.id;b.geometryType=a.geometryType;b.vertexFrom=a.vertexFrom;b.vertexCount=a.vertexCount;b.indexFrom=a.indexFrom;b.indexCount=a.indexCount;b.materialInfo=a.materialInfo;b.meshData=null;b.sortKey=0;b.symbolLevel=0;b.zOrder=0;return b});a.sort(function(a,b){return a.sortKey-b.sortKey});b.hlDisplayList.addToList(a);for(var c=0;c<a.length;c++)e.pool.release(a[c])}})};f.pool=new b(f);return f}(c)})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(C){var l=
{create:function(){var a=new C.ARRAY_TYPE(2);a[0]=0;a[1]=0;return a},clone:function(a){var b=new C.ARRAY_TYPE(2);b[0]=a[0];b[1]=a[1];return b},fromValues:function(a,b){var d=new C.ARRAY_TYPE(2);d[0]=a;d[1]=b;return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];return a},set:function(a,b,d){a[0]=b;a[1]=d;return a},add:function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];return a},subtract:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];return a}};l.sub=l.subtract;l.multiply=function(a,b,d){a[0]=b[0]*d[0];a[1]=
b[1]*d[1];return a};l.mul=l.multiply;l.divide=function(a,b,d){a[0]=b[0]/d[0];a[1]=b[1]/d[1];return a};l.div=l.divide;l.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);return a};l.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);return a};l.min=function(a,b,d){a[0]=Math.min(b[0],d[0]);a[1]=Math.min(b[1],d[1]);return a};l.max=function(a,b,d){a[0]=Math.max(b[0],d[0]);a[1]=Math.max(b[1],d[1]);return a};l.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);return a};
l.scale=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;return a};l.scaleAndAdd=function(a,b,d,g){a[0]=b[0]+d[0]*g;a[1]=b[1]+d[1]*g;return a};l.distance=function(a,b){var d=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(d*d+a*a)};l.dist=l.distance;l.squaredDistance=function(a,b){var d=b[0]-a[0];a=b[1]-a[1];return d*d+a*a};l.sqrDist=l.squaredDistance;l.length=function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)};l.len=l.length;l.squaredLength=function(a){var b=a[0];a=a[1];return b*b+a*a};l.sqrLen=l.squaredLength;
l.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};l.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];return a};l.normalize=function(a,b){var d=b[0],g=b[1],d=d*d+g*g;0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d);return a};l.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};l.cross=function(a,b,d){b=b[0]*d[1]-b[1]*d[0];a[0]=a[1]=0;a[2]=b;return a};l.lerp=function(a,b,d,g){var h=b[0];b=b[1];a[0]=h+g*(d[0]-h);a[1]=b+g*(d[1]-b);return a};l.random=function(a,b){b=b||1;var d=2*C.RANDOM()*Math.PI;a[0]=Math.cos(d)*
b;a[1]=Math.sin(d)*b;return a};l.transformMat2=function(a,b,d){var g=b[0];b=b[1];a[0]=d[0]*g+d[2]*b;a[1]=d[1]*g+d[3]*b;return a};l.transformMat2d=function(a,b,d){var g=b[0];b=b[1];a[0]=d[0]*g+d[2]*b+d[4];a[1]=d[1]*g+d[3]*b+d[5];return a};l.transformMat3=function(a,b,d){var g=b[0];b=b[1];a[0]=d[0]*g+d[3]*b+d[6];a[1]=d[1]*g+d[4]*b+d[7];return a};l.transformMat4=function(a,b,d){var g=b[0];b=b[1];a[0]=d[0]*g+d[4]*b+d[12];a[1]=d[1]*g+d[5]*b+d[13];return a};l.forEach=function(){var a=l.create();return function(b,
d,g,h,c,e){d||(d=2);g||(g=0);for(h=h?Math.min(h*d+g,b.length):b.length;g<h;g+=d)a[0]=b[g],a[1]=b[g+1],c(a,a,e),b[g]=a[0],b[g+1]=a[1];return b}}();l.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};l.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};l.equals=function(a,b){var d=a[0];a=a[1];var g=b[0];b=b[1];return Math.abs(d-g)<=C.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(a-b)<=C.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};return l})},"esri/views/2d/engine/webgl/WGLGeometry":function(){define(["require",
"exports","../../../webgl/BufferObject","./FreeList","./enums"],function(C,l,a,b,d){return function(){function g(){this._bufferSpec={};this._ibFreeList=this._vbFreeList=null;this.vertexBufferMap={};this.vertexBufferMapCPU={};this.vao=this.indexBufferCPU=this.indexBuffer=null;this.usage=35044}Object.defineProperty(g.prototype,"attached",{get:function(){return null!==this.indexBuffer},enumerable:!0,configurable:!0});g.prototype.attach=function(b){for(var c in this._bufferSpec)this.vertexBufferMap[c]=
a.createVertex(b.context,this.usage,this.vertexBufferMapCPU[c].buffer);this.indexBufferCPU&&(this.indexBuffer=a.createIndex(b.context,this.usage,this.indexBufferCPU));return!0};g.prototype.initializeEmpty=function(a,c,d,g){void 0===g&&(g=35044);this.clear();this.usage=g;d&&(this.indexBufferCPU=new Uint32Array(d));var e;for(g=0;g<a.length;g++){var h=a[g];e=0!==h.divisor?Math.ceil(c/h.divisor):c;e*=h.strideInBytes;this._bufferSpec[h.name]=h;this.vertexBufferMapCPU[h.name]=new Uint32Array(e/4)}this._vbFreeList=
b.create(c);d&&(this._ibFreeList=b.create(d))};g.prototype.initializeWithRecords=function(a,b,d){void 0===d&&(d=35044);b.sort(function(a,b){return a.sortKey-b.sortKey});for(var c=0,e=0,g=0;g<b.length;g++){var h=b[g],c=c+h.meshData.vertexCount;h.meshData.indexData&&(e+=h.meshData.indexData.length);h.indexFrom=void 0;h.indexCount=0;h.vertexFrom=void 0;h.vertexCount=0}this.initializeEmpty(a,Math.floor(1.5*c),Math.floor(1.5*e),d);this.update(b)};g.prototype.initializeWithBuffers=function(a,c,d){void 0===
d&&(d=35044);this.clear();this.usage=d;this.indexBufferCPU=c.indexBuffer;d=this.indexBufferCPU.length;for(var e=void 0,g=0;g<a.length;g++){var h=a[g];this._bufferSpec[h.name]=h;this.vertexBufferMapCPU[h.name]=c.vertexBuffer[h.name].data;h=c.vertexBuffer[h.name].data.buffer.byteLength/h.strideInBytes;void 0!==e&&e!==h?console.error("Buffers with different vertex counts."):e=h}this._vbFreeList=b.create(e);this._vbFreeList.allocate(e);this._ibFreeList=b.create(d);this._ibFreeList.allocate(d)};g.prototype.clear=
function(){this.indexBuffer&&(this.indexBuffer.dispose(),this.indexBuffer=null);this.indexBufferCPU=null;for(var a in this.vertexBufferMap)this.vertexBufferMap[a].dispose(),delete this.vertexBufferMap[a];this.vertexBufferMap={};this.vertexBufferMapCPU={};this.vao&&(this.vao.dispose(),this.vao=null);this._bufferSpec={};this._ibFreeList=this._vbFreeList=null};g.prototype.update=function(a){for(var b=0;b<a.length;b++){var e=this._updateRecord(a[b]);if(e!==d.WGLGeometryTransactionStatus.SUCCEEDED)return e}return d.WGLGeometryTransactionStatus.SUCCEEDED};
g.prototype._updateRecord=function(a){var b;void 0===a.vertexFrom||a.vertexCount!==a.meshData.vertexCount?(void 0!==a.vertexFrom&&this._vbFreeList.free(a.vertexFrom,a.vertexCount),b=0<a.meshData.vertexCount?this._vbFreeList.allocate(a.meshData.vertexCount):-1):b=a.vertexFrom;-1!==b?(a.vertexFrom=b,a.vertexCount=a.meshData.vertexCount):(a.vertexFrom=void 0,a.vertexCount=0);var e=a.meshData.indexData?a.meshData.indexData.length:0;void 0===a.indexFrom||a.indexCount!==e?(void 0!==a.indexFrom&&this._ibFreeList.free(a.indexFrom,
a.indexCount),b=0<e?this._ibFreeList.allocate(e):-1):b=a.indexFrom;-1!==b?(a.indexFrom=b,a.indexCount=e):(a.indexFrom=void 0,a.indexCount=0);if(void 0!==a.vertexFrom&&void 0!==a.indexFrom){var g;g=e=b=b=void 0;for(var h in a.meshData.vertexData){b=this._bufferSpec[h].divisor;g=0!==b?a.vertexFrom/b:a.vertexFrom;b=this.vertexBufferMapCPU[h];var e=a.meshData.vertexData[h],k=e.length;g=g*this._bufferSpec[h].strideInBytes/4;for(var l=0;l<k;l++)b[g+l]=e[l]}h=a.vertexFrom;e=(b=a.meshData.indexData)?b.length:
0;for(k=0;k<e;++k)this.indexBufferCPU[a.indexFrom+k]=h+b[k];return d.WGLGeometryTransactionStatus.SUCCEEDED}return d.WGLGeometryTransactionStatus.FAILED_OUT_OF_MEMORY};g.prototype.remove=function(a){for(var b=0;b<a.length;b++)this._removeRecord(a[b])};g.prototype._removeRecord=function(a){this._vbFreeList.free(a.vertexFrom,a.vertexCount);a.vertexFrom=void 0;a.vertexCount=0;this._ibFreeList.free(a.indexFrom,a.indexCount);a.indexFrom=void 0;a.indexCount=0};g.prototype.invalidateIndexBuffer=function(){var a=
this.indexBuffer;a&&a.setData(this.indexBufferCPU)};g.prototype.invalidateVertexBuffers=function(a){if(!a){a=[];for(var b in this.vertexBufferMap)a.push(b)}for(var d=0;d<a.length;d++){b=a[d];var g=this.vertexBufferMap[b];g&&g.setData(this.vertexBufferMapCPU[b].buffer)}};return g}()})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require","exports"],function(C,l){Object.defineProperty(l,"__esModule",{value:!0});var a=function(){function a(a){this._parent=a}a.prototype.rangeCreated=function(a){};
a.prototype.rangeResized=function(a,b,c){};a.prototype.findBestRange=function(a){for(var b=this._parent._freeHead;null!==b&&a>b.count;)b=b.next;return b};a.prototype.findAdjacentRanges=function(a,b){for(var c=!0,d=!1,g=null,h=this._parent._freeHead;c&&!d;){var k=null!==h?h.from:this._parent._size;a>=(null!==g?g.from+g.count:0)&&a+b<=k?(c=!1,d=!0):null!==h?(g=h,h=h.next):c=!1}return[g,h]};return a}();C=function(){function a(){this._rangesSortedByFrom=[];this._rangesSortedByCount=[]}a.prototype.rangeCreated=
function(a){this._rangesSortedByFrom.push(a);this._rangesSortedByFrom.sort(function(a,b){return a.from-b.from});this._rangesSortedByCount.push(a);this._rangesSortedByCount.sort(function(a,b){return a.count-b.count})};a.prototype.rangeResized=function(a,b,c){0===a.count?(this._rangesSortedByFrom.splice(this._rangesSortedByFrom.indexOf(a),1),this._rangesSortedByCount.splice(this._rangesSortedByCount.indexOf(a),1)):this._rangesSortedByCount.sort(function(a,b){return a.count-b.count})};a.prototype.findBestRange=
function(a){if(0===this._rangesSortedByCount.length)return null;for(var b=0,c=this._rangesSortedByCount.length-1,d=void 0;b<=c;){var g=Math.floor((b+c)/2),l=this._rangesSortedByCount[g].count;if(l===a){d=g;break}else l<a?b=g+1:l>a&&(c=g-1,d=g)}return void 0===d?null:this._rangesSortedByCount[d]};a.prototype.findAdjacentRanges=function(a,b){if(0===this._rangesSortedByFrom.length)return[null,null];if(a+b<=this._rangesSortedByFrom[0].from)return[null,this._rangesSortedByFrom[0]];if(a>=this._rangesSortedByFrom[this._rangesSortedByFrom.length-
1].from+this._rangesSortedByFrom[this._rangesSortedByFrom.length-1].count)return[this._rangesSortedByFrom[this._rangesSortedByFrom.length-1],null];for(var c=0;c<this._rangesSortedByFrom.length-1;++c){var d=this._rangesSortedByFrom[c],g=this._rangesSortedByFrom[c+1];if(a>=d.from+d.count&&a+b<=g.from)return[d,g]}throw Error("Could not find adjacent ranges.");};return a}();l.SortingBookKeeper=C;var b=function(){function b(b,d){this._size=b;this._bookKeeper=d||new a(this);0<b?(this._freeHead={from:0,
count:b,prev:null,next:null},this._bookKeeper.rangeCreated(this._freeHead)):this._freeHead=null}b.prototype.allocate=function(a){var d=this._bookKeeper.findBestRange(a);if(null===d)return-1;var c=d.from,e=d.count;d.from+=a;d.count-=a;this._bookKeeper.rangeResized(d,c,e);0===d.count&&(a=null!==d.prev?this._freeHead:d.next,b._removeRange(d),this._freeHead=a);return c};b.prototype.free=function(a,d){var c=this._bookKeeper.findAdjacentRanges(a,d),e=c[0],c=c[1];a={from:a,count:d,prev:e,next:c};null!==
e&&(e.next=a);null!==c&&(c.prev=a);this._bookKeeper.rangeCreated(a);if(null!==c&&a.from+a.count===c.from){d=a.from;var g=a.count;b._fuse(a,c);b._removeRange(c);this._bookKeeper.rangeResized(a,d,g);this._bookKeeper.rangeResized(c,void 0,0)}null!==e&&e.from+e.count===a.from&&(d=e.from,g=e.count,b._fuse(e,a),b._removeRange(a),this._bookKeeper.rangeResized(e,d,g),this._bookKeeper.rangeResized(a,void 0,0));this._freeHead=null!==a.prev?this._freeHead:a};b._removeRange=function(a){null!==a.prev?null!==a.next?
(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null:null!==a.next&&(a.next.prev=null)};b._fuse=function(a,b){a.count+=b.count;a.next=b.next;b.from+=b.count;b.count=0;null!==b.next&&(b.next.prev=a)};return b}();l.DefaultFreeList=b;l.create=function(a){return new b(a)}})},"esri/views/2d/engine/webgl/WGLFeatureView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix/vec3 ../../../../core/libs/gl-matrix/mat4 ../../../../core/promiseUtils ../../../../geometry/Point ../Container ./GeometryUtils ./WGLRendererInfo ./Utils".split(" "),
function(C,l,a,b,d,g,h,c,e,r,p){return function(c){function k(a,e,g){var f=c.call(this)||this;f._displayWidth=0;f._displayHeight=0;f._pointToCallbacks=new Map;f._highlightIDs=new Set;f._highlightOptionsUpToDate=!1;f._tileSize=a;f._tileCoordRange=e;f._tileCoordRatio=e/a;f._parentLayerView=g;f._oneOverTileRatio=1/f._tileCoordRatio;f._tileCoordinateScale=b.create();f._orientationVec=b.create();f._displayScale=b.create();f._orientationVec.set([0,0,1]);f._defaultTransform=d.create();return f}a(k,c);Object.defineProperty(k.prototype,
"highlightOptions",{get:function(){return this._highlightOptions},set:function(a){this._highlightOptions=a;this._highlightOptionsUpToDate=!1},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"displayWidth",{get:function(){return this._displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0});k.prototype.initialize=function(a){this._tileInfoView=a;this.wglRendererInfo=
new r(this)};k.prototype.updateHeatmapParameters=function(a){this.wglRendererInfo.updateHeatmapParameters(a);this.requestRender()};k.prototype.hitTest=function(a,b){var c=this,d=[a,b];return g.create(function(a,b){c._pointToCallbacks.set(d,{resolve:a,reject:b});c.requestRender()},function(){c._pointToCallbacks.has(d)&&c._pointToCallbacks.delete(d)})};k.prototype.setHighlight=function(a){this._highlightIDs.clear();this.addHighlight(a)};k.prototype.addHighlight=function(a){var b=this;a.forEach(function(a){b._highlightIDs.add(a)});
this._buildHLList()};k.prototype.removeHighlight=function(a){var b=this;a.forEach(function(a){b._highlightIDs.delete(a)});this._buildHLList()};k.prototype.addChild=function(a){a=c.prototype.addChild.call(this,a);this._buildHLList();return a};k.prototype.removeChild=function(a){a=c.prototype.removeChild.call(this,a);this._buildHLList();return a};k.prototype.prepareChildrenRenderParameters=function(a){return a};k.prototype.renderChildren=function(a){var b=this;this.wglRendererInfo.updateVisualVariables(this._parentLayerView.rendererInfo.vvRanges,
a.state);var c=this.parent.glPainter;this.sortChildren(function(a,b){return a.key.level-b.key.level});var d=this._tileInfoView.getClosestInfoForScale(a.state.scale).level;this.wglRendererInfo.heatmapParameters?c.drawHeatmap(a.context,this,d,a.devicePixelRatio):c.draw(a.context,this,d,a.devicePixelRatio,a.stationary);0<this._highlightIDs.size&&c.highlight(a.context,this,d,a.devicePixelRatio);0!==this._pointToCallbacks.size&&(this._pointToCallbacks.forEach(function(c,d){c.resolve(b._hitTest(a,d[0],
d[1]))}),this._pointToCallbacks.clear())};k.prototype.attachChild=function(a,b){return a.attach(b)};k.prototype.detachChild=function(a,b){a.detach(b)};k.prototype.renderChild=function(a,b){a.doRender(b)};k.prototype.beforeRenderChildren=function(a,b){this._updateTilesTransform(a.state,this._tileInfoView.getClosestInfoForScale(a.state.scale).level);this._updateHighlightOptions()};k.prototype._hitTest=function(a,b,c){var d=this.parent.glPainter,e=this._tileInfoView.getClosestInfoForScale(a.state.scale).level,
f=[0,0];a.state.toMap(f,[b,c]);var g=a.state.clone(),k=g.viewpoint.clone();k.targetGeometry=new h(f[0],f[1],a.state.spatialReference);g.viewpoint=k;g.size=[p.C_HITTEST_SEARCH_SIZE,p.C_HITTEST_SEARCH_SIZE];this._updateTilesTransform(g,e);d.update(g,a.devicePixelRatio);return d.hitTest({context:a.context,budget:a.budget,state:g,devicePixelRatio:a.devicePixelRatio,stationary:a.stationary},b,c,this,e)};k.prototype._updateTilesTransform=function(a,b){var c=1/a.width,d=1/a.height,e=[0,0];this._calculateRelativeViewProjMat(this._tileInfoView.tileInfo.lods[b].resolution,
a.resolution,a.rotation,this._tileInfoView.tileInfo.size[0],this._tileCoordRange,a.width,a.height,this._defaultTransform);for(var f=0,g=this.children;f<g.length;f++){var h=g[f];a.toScreen(e,h.coords);e[1]=a.height-e[1];h.tileTransform.displayCoord[0]=2*e[0]*c-1;h.tileTransform.displayCoord[1]=2*e[1]*d-1;h.key.level===b?h.tileTransform.transform.set(this._defaultTransform):this._calculateRelativeViewProjMat(this._tileInfoView.tileInfo.lods[h.key.level].resolution,a.resolution,a.rotation,this._tileInfoView.tileInfo.size[0],
h.coordRange,a.width,a.height,h.tileTransform.transform)}};k.prototype._calculateRelativeViewProjMat=function(a,b,c,g,h,k,l,m){a=a/b*this._oneOverTileRatio;this._tileCoordinateScale.set([a,a,1]);if(k!==this._displayWidth||l!==this._displayHeight)this._displayScale.set([2/k,-2/l,1]),this._displayWidth=k,this._displayHeight=l;d.identity(m);d.scale(m,m,this._tileCoordinateScale);d.rotate(m,m,-c*e.C_DEG_TO_RAD,this._orientationVec);d.scale(m,m,this._displayScale);d.transpose(m,m)};k.prototype._updateHighlightOptions=
function(){!this._highlightOptionsUpToDate&&this._setHighlightOptions(this._highlightOptions)&&(this._highlightOptionsUpToDate=!0)};k.prototype._setHighlightOptions=function(a){if(!this.parent)return!1;var b=this.parent.glPainter;if(!b)return!1;var c=a.color.toRgba();c[0]/=255;c[1]/=255;c[2]/=255;var d=c.slice();c[3]*=a.fillOpacity;d[3]*=a.haloOpacity;b.setHighlightOptions({fillColor:c,outlineColor:d,outlineWidth:2,outerHaloWidth:.3,innerHaloWidth:.3,outlinePosition:0});return!0};k.prototype._buildHLList=
function(){var a=this;this.children.forEach(function(b){b.buildHLList(a._highlightIDs)});this.requestRender()};return k}(c)})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(C){var l={create:function(){var a=new C.ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var b=new C.ARRAY_TYPE(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},fromValues:function(a,b,d){var g=new C.ARRAY_TYPE(3);g[0]=a;g[1]=b;g[2]=d;return g},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];
return a},set:function(a,b,d,g){a[0]=b;a[1]=d;a[2]=g;return a},add:function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];return a},subtract:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];return a}};l.sub=l.subtract;l.multiply=function(a,b,d){a[0]=b[0]*d[0];a[1]=b[1]*d[1];a[2]=b[2]*d[2];return a};l.mul=l.multiply;l.divide=function(a,b,d){a[0]=b[0]/d[0];a[1]=b[1]/d[1];a[2]=b[2]/d[2];return a};l.div=l.divide;l.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);
return a};l.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);return a};l.min=function(a,b,d){a[0]=Math.min(b[0],d[0]);a[1]=Math.min(b[1],d[1]);a[2]=Math.min(b[2],d[2]);return a};l.max=function(a,b,d){a[0]=Math.max(b[0],d[0]);a[1]=Math.max(b[1],d[1]);a[2]=Math.max(b[2],d[2]);return a};l.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);return a};l.scale=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;return a};l.scaleAndAdd=
function(a,b,d,g){a[0]=b[0]+d[0]*g;a[1]=b[1]+d[1]*g;a[2]=b[2]+d[2]*g;return a};l.distance=function(a,b){var d=b[0]-a[0],g=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(d*d+g*g+a*a)};l.dist=l.distance;l.squaredDistance=function(a,b){var d=b[0]-a[0],g=b[1]-a[1];a=b[2]-a[2];return d*d+g*g+a*a};l.sqrDist=l.squaredDistance;l.length=function(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)};l.len=l.length;l.squaredLength=function(a){var b=a[0],d=a[1];a=a[2];return b*b+d*d+a*a};l.sqrLen=l.squaredLength;
l.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};l.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};l.normalize=function(a,b){var d=b[0],g=b[1],h=b[2],d=d*d+g*g+h*h;0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d);return a};l.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};l.cross=function(a,b,d){var g=b[0],h=b[1];b=b[2];var c=d[0],e=d[1];d=d[2];a[0]=h*d-b*e;a[1]=b*c-g*d;a[2]=g*e-h*c;return a};l.lerp=function(a,b,d,g){var h=b[0],c=b[1];b=b[2];
a[0]=h+g*(d[0]-h);a[1]=c+g*(d[1]-c);a[2]=b+g*(d[2]-b);return a};l.hermite=function(a,b,d,g,h,c){var e=c*c,l=e*(2*c-3)+1,p=e*(c-2)+c,k=e*(c-1);c=e*(3-2*c);a[0]=b[0]*l+d[0]*p+g[0]*k+h[0]*c;a[1]=b[1]*l+d[1]*p+g[1]*k+h[1]*c;a[2]=b[2]*l+d[2]*p+g[2]*k+h[2]*c;return a};l.bezier=function(a,b,d,g,h,c){var e=1-c,l=e*e,p=c*c,k=l*e,l=3*c*l,e=3*p*e;c*=p;a[0]=b[0]*k+d[0]*l+g[0]*e+h[0]*c;a[1]=b[1]*k+d[1]*l+g[1]*e+h[1]*c;a[2]=b[2]*k+d[2]*l+g[2]*e+h[2]*c;return a};l.random=function(a,b){b=b||1;var d=2*C.RANDOM()*
Math.PI,g=2*C.RANDOM()-1,h=Math.sqrt(1-g*g)*b;a[0]=Math.cos(d)*h;a[1]=Math.sin(d)*h;a[2]=g*b;return a};l.transformMat4=function(a,b,d){var g=b[0],h=b[1];b=b[2];var c=d[3]*g+d[7]*h+d[11]*b+d[15],c=c||1;a[0]=(d[0]*g+d[4]*h+d[8]*b+d[12])/c;a[1]=(d[1]*g+d[5]*h+d[9]*b+d[13])/c;a[2]=(d[2]*g+d[6]*h+d[10]*b+d[14])/c;return a};l.transformMat3=function(a,b,d){var g=b[0],h=b[1];b=b[2];a[0]=g*d[0]+h*d[3]+b*d[6];a[1]=g*d[1]+h*d[4]+b*d[7];a[2]=g*d[2]+h*d[5]+b*d[8];return a};l.transformQuat=function(a,b,d){var g=
b[0],h=b[1],c=b[2];b=d[0];var e=d[1],l=d[2];d=d[3];var p=d*g+e*c-l*h,k=d*h+l*g-b*c,n=d*c+b*h-e*g,g=-b*g-e*h-l*c;a[0]=p*d+g*-b+k*-l-n*-e;a[1]=k*d+g*-e+n*-b-p*-l;a[2]=n*d+g*-l+p*-e-k*-b;return a};l.rotateX=function(a,b,d,g){var h=[],c=[];h[0]=b[0]-d[0];h[1]=b[1]-d[1];h[2]=b[2]-d[2];c[0]=h[0];c[1]=h[1]*Math.cos(g)-h[2]*Math.sin(g);c[2]=h[1]*Math.sin(g)+h[2]*Math.cos(g);a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];return a};l.rotateY=function(a,b,d,g){var h=[],c=[];h[0]=b[0]-d[0];h[1]=b[1]-d[1];h[2]=
b[2]-d[2];c[0]=h[2]*Math.sin(g)+h[0]*Math.cos(g);c[1]=h[1];c[2]=h[2]*Math.cos(g)-h[0]*Math.sin(g);a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];return a};l.rotateZ=function(a,b,d,g){var h=[],c=[];h[0]=b[0]-d[0];h[1]=b[1]-d[1];h[2]=b[2]-d[2];c[0]=h[0]*Math.cos(g)-h[1]*Math.sin(g);c[1]=h[0]*Math.sin(g)+h[1]*Math.cos(g);c[2]=h[2];a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];return a};l.forEach=function(){var a=l.create();return function(b,d,g,h,c,e){d||(d=3);g||(g=0);for(h=h?Math.min(h*d+g,b.length):
b.length;g<h;g+=d)a[0]=b[g],a[1]=b[g+1],a[2]=b[g+2],c(a,a,e),b[g]=a[0],b[g+1]=a[1],b[g+2]=a[2];return b}}();l.angle=function(a,b){a=l.fromValues(a[0],a[1],a[2]);b=l.fromValues(b[0],b[1],b[2]);l.normalize(a,a);l.normalize(b,b);b=l.dot(a,b);return 1<b?0:Math.acos(b)};l.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};l.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};l.equals=function(a,b){var d=a[0],g=a[1];a=a[2];var h=b[0],c=b[1];b=b[2];return Math.abs(d-h)<=C.EPSILON*
Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(g-c)<=C.EPSILON*Math.max(1,Math.abs(g),Math.abs(c))&&Math.abs(a-b)<=C.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};return l})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../geometry/support/scaleUtils ../../../../core/screenUtils ../../../../renderers/support/utils ./Utils".split(" "),function(C,l,a,b,d,g){function h(a,b){var c=b.length;if(a<b[0].value||1===c)return b[0].size;for(var d=1;d<c;d++)if(a<b[d].value)return b[d-
1].size+(a-b[d-1].value)/(b[d].value-b[d-1].value)*(b[d].size-b[d-1].size);return b[c-1].size}return function(){function c(a){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,
vvRotationType:"geographic",vvOpacityEnabled:!1};this._parent=a;this.symbolLevels.push(0)}Object.defineProperty(c.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"heatmapParameters",{get:function(){return this._heatmapParameters},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"vvMaterialParams",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});c.prototype.updateHeatmapParameters=
function(a){var b=a.blurRadius,c=Math.round(4.5*a.blurRadius),d=2*c+1;this._heatmapParameters||(this._heatmapParameters={radius:b,blurRadius:c,kernelSize:d,refreshIntensityKernel:!0,intensityKernel:null,color:null,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity});for(var e=this._heatmapParameters,f=a.colorStops,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0],E,C=0;16>C;C++){var t=f[Math.min(C,f.length-1)];h[C]=t.ratio;E=4*C;l[E+0]=t.color[0]/255;l[E+1]=t.color[1]/255;l[E+2]=t.color[2]/255;l[E+3]=1<t.color[3]?t.color[3]/255:t.color[3];g.premultiplyAlpha(l,E,!0)}e.color={values:h,colors:l,refreshColorRamp:!0};1E-6<Math.abs(e.radius-a.radius)&&(e.radius=b,e.blurRadius=c,e.kernelSize=d,e.refreshIntensityKernel=!0);e.maxPixelIntensity=a.maxPixelIntensity;e.minPixelIntensity=a.minPixelIntensity};c.prototype.updateVisualVariables=function(c,l){var e=
this._vvMaterialParameters;e.vvOpacityEnabled=!1;e.vvSizeEnabled=!1;e.vvColorEnabled=!1;e.vvRotationEnabled=!1;if(c){var k=c.size;if(k){e.vvSizeEnabled=!0;if(k.minMaxValue){var n=k.minMaxValue,f=void 0,r=void 0;g.isDefined(n.minSize)&&g.isDefined(n.maxSize)&&(g.isNumber(n.minSize)&&g.isNumber(n.maxSize)?(f=b.pt2px(n.minSize),r=b.pt2px(n.maxSize)):(r=l.scale,f=b.pt2px(h(r,n.minSize.stops)),r=b.pt2px(h(r,n.maxSize.stops))));this.vvSizeMinMaxValue.set([n.minDataValue,n.maxDataValue,f,r])}k.scaleStops&&
(this.vvSizeScaleStopsValue=b.pt2px(h(l.scale,k.scaleStops.stops)));k.unitValue&&(this.vvSizeUnitValueToPixelsRatio=a.getMetersPerUnitForSR(l.spatialReference)/d.meterIn[k.unitValue.unit]/l.resolution);k.fieldStops&&(this.vvSizeFieldStopsValues.set(k.fieldStops.values),this.vvSizeFieldStopsSizes.set(k.fieldStops.sizes))}if(l=c.color)e.vvColorEnabled=!0,this.vvColorValues.set(l.values),this.vvColors.set(l.colors);if(l=c.opacity)e.vvOpacityEnabled=!0,this.vvOpacityValues.set(l.values),this.vvOpacities.set(l.opacities);
if(c=c.rotation)e.vvRotationEnabled=!0,e.vvRotationType=c.type}};return c}()})},"esri/views/2d/layers/support/GraphicsManager2":function(){define(["require","exports"],function(C,l){return function(){function a(a){this._graphics=a.graphics;this._objectIdField=a.objectIdField;this._graphicMap=new Map}a.prototype.destroy=function(){this.removeAll()};Object.defineProperty(a.prototype,"graphics",{get:function(){return this._graphics},enumerable:!0,configurable:!0});a.prototype.findGraphic=function(a){return(a=
this._graphicMap.get(a))?a.object:null};a.prototype.removeAll=function(){this._graphicMap.clear();this._graphics.removeAll()};a.prototype.add=function(a,d){for(var b in a){d=a[b];var h=this._graphicMap.get(d.attributes[this._objectIdField]);h?++h.references:(this._graphicMap.set(d.attributes[this._objectIdField],{object:d,references:1}),this._graphics.add(d))}};a.prototype.removeMany=function(a){var b,g;for(g in a){b=a[g];var h=this._graphicMap.get(b);h&&(--h.references,0===h.references&&(this._graphicMap.delete(b),
this._graphics.remove(h.object)))}};a.prototype.removeIntent=function(a){};a.prototype.createIntentToAdd=function(a){};return a}()})},"*noref":1}});
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper dojo/promise/all ../../../../core/accessorSupport/decorators ../../../../core/Error ../../../../core/HandleRegistry ../../../../core/Logger ../../../../core/promiseUtils ../../../../Graphic ../../../../geometry/Extent ../../../../tasks/QueryTask ../../../../layers/support/TileInfo ../../../../renderers/support/diffUtils ../../engine/StageGL ../../engine/webgl/rendererInfoUtils ../../engine/webgl/WGLTileHandler ../../engine/webgl/WGLTile ../../engine/webgl/WGLFeatureView ../../tiling/TileQueue ../../tiling/TileInfoView ../../tiling/TileStrategy ../LayerView2D ./GraphicsManager2".split(" "),function(C,
l,a,b,d,g,h,c,e,r,p,k,n,f,D,q,E,I,t,w,m,v,B,A,V,H){var N=r.getLogger("esri.views.2d.layers.FeatureLayerView2DWebGL");return function(l){function r(){var a=null!==l&&l.apply(this,arguments)||this;a._wglFeatureView=new m(512,512,a);a._tileRequests=new Map;a._hasVV=!1;a._handles=new e;a.container=new E;a._toAdd=[];a._toRemove=[];return a}a(r,l);Object.defineProperty(r.prototype,"numFeatures",{get:function(){var a=0;this.attached?this._tileStrategy.tiles.forEach(function(b){a+=b.iconDisplayRecords?b.iconDisplayRecords.length:
0}):0;return a},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"rendererInfo",{get:function(){return this._rendererInfo},enumerable:!0,configurable:!0});r.prototype.highlight=function(a){var b=this._wglFeatureView;b.addHighlight(a);return{remove:function(){b.removeHighlight(a)}}};r.prototype.hitTest=function(a,b){var c=this;return this.suspended?p.resolve(null):this._wglFeatureView.hitTest(a,b).then(function(a){if(0===a.length)return null;a=c._graphicsManager.findGraphic(a[0]);
return new k(d({layer:c.layer},a))})};r.prototype.update=function(a){if(this._fetchQueue){this._fetchQueue.pause();this._fetchQueue.state=a.state;this._tileStrategy.update(a);this._fetchQueue.resume();this.notifyChange("numFeatures");a=0;for(var b=this._toRemove;a<b.length;a++)this._graphicsManager.removeMany(b[a].featureIds);a=this._toRemove.length=0;for(b=this._toAdd;a<b.length;a++){var c=b[a];this._graphicsManager.add(c.features,c.intent);this._graphicsManager.removeIntent(c.intent)}this._toAdd.length=
0;this.notifyChange("updating")}};r.prototype.attach=function(){this._initialize()};r.prototype.detach=function(){this.container.removeChild(this._wglFeatureView);this._tileStrategy.destroy();this._tileStrategy=null;this._graphicsManager.destroy();this._graphicsManager=null;this._handles.removeAll()};r.prototype.moveStart=function(){this.requestUpdate()};r.prototype.viewChange=function(){this.requestUpdate()};r.prototype.moveEnd=function(){this.requestUpdate()};r.prototype.isUpdating=function(){return 0!==
this._fetchQueue.length};r.prototype.acquireTile=function(a){var b=this,d=this._tileInfoView.getTileBounds([0,0,0,0],a),e=w.pool.acquire(a,d,512,512,512),d=this._fetchQueue.push(e.key).then(function(c){var d=c.features.map(function(a){return{attributes:a.attributes}}),e=b._graphicsManager.createIntentToAdd();b._toAdd.push({features:d,intent:e});return t.getTileData(a,c,b.layer.objectIdField,b._rendererInfo,512,1,b.container.glPainter.textureManager).then(function(a){return{tileData:a,intent:e}})}).then(function(a){var c=
a.tileData;a=a.intent;c&&(e.setData(c,b._hasVV,!1),e.intent=a);b._wglFeatureView.addChild(e);e.once("attach",function(){b.notifyChange("updating");b.requestUpdate()});b.notifyChange("updating")}).otherwise(function(a){if(a&&"cancel"===a.dojoType)return p.reject(a);a=new c("featurelayerview2dwebgl:tile-request-failed","Failed to query for features",{error:a});N.error(a);return p.reject(a)});this._tileRequests.set(e.key.id,d);this.notifyChange("updating");return e};r.prototype.releaseTile=function(a){var b=
[];a.displayObjectRegistry.forEach(function(a,c){b.push(c)});this._toRemove.push({featureIds:b});var c=a.key.id,d=this._tileRequests.get(c);d&&(d.isFulfilled()||d.cancel(),this._tileRequests.delete(c),this._wglFeatureView.removeChild(a),this.requestUpdate(),a.once("detach",function(){return w.pool.release(a)}),this.notifyChange("updating"))};r.prototype._initialize=function(){var a=this,b=this._tileInfo=D.create({spatialReference:this.view.spatialReference,size:512});this._tileInfoView=new B(b);this._fetchQueue=
new v({tileInfoView:this._tileInfoView,process:function(b){return a._getFeatureSet(b)}});this._wglFeatureView.highlightOptions=this.view.highlightOptions;this._wglFeatureView.initialize(this._tileInfoView);this.container.addChild(this._wglFeatureView);this._tileStrategy=new A({cachePolicy:"purge",acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},tileInfoView:this._tileInfoView});this._rendererInfo=this._createRendererInfo(this.layer.renderer);this._returnCentroid=
this._getReturnCentroid(this.layer.renderer);this._handles.add(this.layer.watch("renderer",function(b){return a._rendererChange(b)}));this._graphics=new Set;this._graphicsManager=new H({graphics:{add:function(b){a._graphics.add(b)},remove:function(b){a._graphics.delete(b)},removeAll:function(){a._graphics.clear()}},objectIdField:this.layer.objectIdField});this.requestUpdate()};r.prototype._getFeatureSet=function(a){var b={hashes:new Set,drill:[],featureSet:{features:[],geometryType:""}},c=new f(this.layer.parsedUrl.path),
d=this._getResolutionParams(a);a=this._tileInfoView.getTileBounds([0,0,0,0],a);var e=("point"===this.layer.geometryType||this._returnCentroid?20:0)*d.tolerance;a[0]-=e;a[1]-=e;a[2]+=e;a[3]+=e;var g=null;this.layer.renderer.visualVariables&&this.layer.renderer.visualVariables.some(function(a){if("size"===a.type&&a.field&&!a.normalizationField)return g=[a.field+" DESC"],!0});return this._drillQuery(b,c,a,d).then(function(a){if(g){var b=g[0].split(" "),c=b[0];"DESC"===b[1]&&a.featureSet.features.sort(function(a,
b){return b.attributes[c]-a.attributes[c]})}return a.featureSet})};r.prototype._drillQuery=function(a,b,c,d,e,f){var h=this;void 0===e&&(e=null);void 0===f&&(f=0);var k=a.featureSet;a.drill.push(c);return this._query(b,c,d,e).then(function(l){if(!l.exceededTransferLimit)k.features=k.features.concat(l.features),k.geometryType=l.geometryType;else if(5>f&&l.exceededTransferLimit){f++;l=(c[2]-c[0])/2;var m=(c[3]-c[1])/2,n=[c[0]+l,c[1]+m,c[2],c[3]],p=[c[0],c[1],c[2]-l,c[3]-m],q=[c[0]+l,c[1],c[2],c[3]-
m];return g([h._drillQuery(a,b,[c[0],c[1]+m,c[2]-l,c[3]],d,e,f),h._drillQuery(a,b,n,d,e,f),h._drillQuery(a,b,p,d,e,f),h._drillQuery(a,b,q,d,e,f)]).then(function(b){return a})}return a})};r.prototype._query=function(a,b,c,d){var e=this.view.spatialReference,f=this.layer.createQuery();f.outFields=this.layer.outFields;f.geometry=new n(b[0],b[1],b[2],b[3],e);f.outSpatialReference=e;f.quantizationParameters=c;f.maxAllowableOffset="polyline"===this.layer.geometryType?c.tolerance:null;f.resultType="tile";
f.returnExceededLimitFeatures=!1;f.returnGeometry=!this._returnCentroid||this.layer.renderer.backgroundFillSymbol;f.returnJSON=!0;f.returnCentroid=this._returnCentroid;f.orderByFields=d;return a.execute(f)};r.prototype._getResolutionParams=function(a){this._tileInfo.updateTileInfo(a);return{mode:"view",originPosition:"upperLeft",tolerance:1*this._tileInfo.lodAt(a.level).resolution,extent:new n(a.extent[0],a.extent[1],a.extent[2],a.extent[3],this.view.spatialReference)}};r.prototype._recreateTiles=
function(a){this._fetchQueue.pause();this._rendererInfo=a;this._tileStrategy.clear();this._fetchQueue.resume();this._wglFeatureView.requestRender()};r.prototype._createRendererInfo=function(a){a=I.createRendererInfo(a,this.view.spatialReference);var b=a.vvFields;this._hasVV=null!=b&&(null!=b.size||null!=b.rotation||null!=b.color||null!=b.opacity);"heatmap"===a.renderer.type&&this._wglFeatureView.updateHeatmapParameters(a.renderer);return a};r.prototype._applyRendererDiff=function(a,b,c,d){var e;a:{for(e in a.diff)if(b=
a.diff[e],"collection"===b.type){if(0!==b.changed.length||0!==b.added.length||0!==b.removed.length){e=!0;break a}}else if("visualVariables"!==e&&"authoringInfo"!==e){e=!0;break a}e=!1}if(e)return!1;if(a.diff.visualVariables){a=q.diff(this._rendererInfo.vvFields,d.vvFields);this._rendererInfo.vvRanges=d.vvRanges;if(a)return!1;this._wglFeatureView.requestRender()}return!0};r.prototype._rendererChange=function(a){this._returnCentroid=this._getReturnCentroid(a);a=I.createRendererInfo(a,this.view.spatialReference);
var b=a.renderer,c=this._rendererInfo.renderer,d=q.diff(c,b);d&&("complete"===d.type?this._recreateTiles(a):"partial"===d.type&&(this._applyRendererDiff(d,b,c,a)||this._recreateTiles(a)))};r.prototype._getReturnCentroid=function(a){function b(a){if(!a)return!1;a=a.type;return"simple-marker"===a||"picture-marker"===a||"text"===a}if("polygon"!==this.layer.geometryType)return!1;switch(a.type){case "simple":return b(a.symbol);case "unique-value":return b(a.defaultSymbol)||a.uniqueValueInfos.some(function(a){return b(a.symbol)});
case "class-breaks":return b(a.defaultSymbol)||a.classBreakInfos.some(function(a){return b(a.symbol)});default:return!0}};b([h.property()],r.prototype,"numFeatures",null);return r=b([h.subclass("esri.views.2d.layers.FeatureLayerView2DWebGL")],r)}(h.declared(V))});