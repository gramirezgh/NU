// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Error ../../../core/HandleRegistry ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ./TiledLayerView3D".split(" "),function(t,u,l,f,e,m,n,p,h,q,r){var k=p.getLogger("esri.views.3d.layers.WMTSLayerView3d");return function(g){function a(){var b=null!==g&&g.apply(this,arguments)||this;b._handles=new n;return b}l(a,g);a.prototype.initialize=
function(){var b=this,a=q.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){var a=b.view.basemapTerrain.tilingScheme,c=b.layer.activeLayer,d=b.layer.findSublayerById(c.id).clone().tileMatrixSet;if(d){if(c=d.tileInfo,a=b._getTileInfoSupportError(c,d.fullExtent)||b._getTileInfoCompatibilityError(c,a))return h.reject(a)}else{d=b._getCompatibleTileMatrixSet();if(!d)return h.reject(new m("layerview:no-compatible-tiling-scheme","None of the tiling schemes supported by the service are compatible with the scene."));
c.tileMatrixSetId=d.id}b.tileInfo=d.tileInfo;b.fullExtent=d.fullExtent;b._updateMinMaxDataLevel()});this.addResolvingPromise(a);this.addResolvingPromise(this.getHeightModelInfoResolvingPromise());this.then(function(){return b._initialized()})};a.prototype.destroy=function(){this._handles.removeAll()};a.prototype.refresh=function(){this.emit("data-changed")};a.prototype.canResume=function(){if(!this.inherited(arguments))return!1;var b=this.layer.activeLayer.tileMatrixSet;return b&&!this._getTileInfoError(b.tileInfo,
b.fullExtent)};a.prototype._initialized=function(){var b=this;this._handles.add(this.layer.activeLayer.watch("styleId",function(a){b.refresh()}));this._handles.add(this.layer.watch("activeLayer",function(a){var c=a.tileMatrixSet;if(c){if(a=b._getTileInfoError(c.tileInfo,c.fullExtent))k.error("The selected tile matrix set is not compatible with the view",a),c=null}else(c=b._getCompatibleTileMatrixSet())?a.tileMatrixSetId=c.id:k.error("The layer does not provide a tiling scheme that is compatible with the view");
b.notifyChange("suspended");b.canResume()&&b.refresh()}))};a.prototype._getCompatibleTileMatrixSet=function(){var b=this;return this.layer.activeLayer.tileMatrixSets.find(function(a){return!b._getTileInfoError(a.tileInfo,a.fullExtent)})};a.prototype._getTileInfoError=function(b,a){return this._getTileInfoSupportError(b,a)||this._getTileInfoCompatibilityError(b,this.view.basemapTerrain.tilingScheme)};f([e.property({aliasOf:"layer.fullExtent"})],a.prototype,"fullExtent",void 0);f([e.property()],a.prototype,
"layer",void 0);f([e.property({aliasOf:"layer.tileInfo"})],a.prototype,"tileInfo",void 0);return a=f([e.subclass("esri.views.3d.layers.WMTSLayerView3D")],a)}(e.declared(r))});