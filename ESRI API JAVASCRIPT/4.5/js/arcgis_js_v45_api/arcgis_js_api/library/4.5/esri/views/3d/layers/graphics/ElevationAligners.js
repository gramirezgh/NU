// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
define("require exports ../../../../geometry/Point ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/lib/Util ./Graphics3DSymbolCommonCode ./graphicUtils".split(" "),function(f,m,E,F,G,H,w,I){Object.defineProperty(m,"__esModule",{value:!0});var J=H.VertexAttrConstants;f=F.vec3d;var r=new E,g=f.create(),c=f.create(),k=f.create(),q={verticalDistanceToGround:0,terrainElevation:0};m.perVertexElevationAligner=function(y,a,l,d){r.spatialReference=l.spatialReference;for(var n=y.getGeometryRecords(),
p=n.length,z="absolute-height"!==a.mode,A=0,t=0;t<p;t++){var b=n[t].geometry,h=n[t].getShaderTransformation();c[0]=h[12];c[1]=h[13];c[2]=h[14];b.invalidateBoundingInfo();for(var h=b.getData().getVertexAttr(),u=h[J.POSITION],b=u.data,h=h.mapPos.data,u=u.size,f=b.length/u,e=0,x=0,B=!1,C=0,D=0;D<f;D++){r.x=h[x++];r.y=h[x++];r.z=h[x++];k[0]=b[e];k[1]=b[e+1];k[2]=b[e+2];var v=w.computeElevation(l,r,a,d,z?q:null);z&&(C+=q.terrainElevation);g[0]=b[e]+c[0];g[1]=b[e+1]+c[1];g[2]=b[e+2]+c[2];d.setAltitude(v,
g,0);b[e]=g[0]-c[0];b[e+1]=g[1]-c[1];b[e+2]=g[2]-c[2];v=m.updateThresholdInMeters/d.unitInMeters;if(Math.abs(k[0]-b[e])>=v||Math.abs(k[1]-b[e+1])>=v||Math.abs(k[2]-b[e+2])>=v)B=!0;e+=u}A+=C/f;B&&y.geometryVertexAttrsUpdated(t)}return A/p};m.perObjectElevationAligner=function(c,a,l,d,n){var p=a.centerPointInElevationSR,f=0;n=0;if(c.metadata.usesVerticalDistanceToGround)f=w.computeElevation(l,p,a,d,q),I.updateVertexAttributeAuxpos1w(c,q.verticalDistanceToGround),n=q.terrainElevation;else{var k="absolute-height"!==
a.mode,f=w.computeElevation(l,p,a,d,k?q:null);k&&(n=q.terrainElevation)}a=c.getObjectTransformation();l=[a[12],a[13],a[14]];m.iterativeUpdatesEnabled?d.setAltitudeOfTransformation(f,a):(g[0]=p.x,g[1]=p.y,g[2]=f,G.computeLinearTransformation(p.spatialReference,g,a,d.spatialReference)&&c.setObjectTransformation(a));d=m.updateThresholdInMeters/d.unitInMeters;(Math.abs(a[12]-l[0])>=d||Math.abs(a[13]-l[1])>=d||Math.abs(a[14]-l[2])>=d)&&c.setObjectTransformation(a);return n};m.updateThresholdInMeters=.01;
m.iterativeUpdatesEnabled=!0});