// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/HandleRegistry ../../../../core/Scheduler ../../lib/glMatrix ../Evented ../aaBoundingRect".split(" "),function(g,h,m,n,k,p,c){Object.defineProperty(h,"__esModule",{value:!0});g=function(){function a(b){var a=this;this.handles=new m;this.tileGeometryUpdateExtent=c.create(c.NEGATIVE_INFINITY);this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new p.Evented;this.centerOnSurfaceInstances=b.centerOnSurfaceInstances;this.renderCoordsHelper=
b.renderCoordsHelper;this.viewState=b.viewState;this.handles.add(b.surface.on("tile-geometry-change",function(b){return a.tileGeometryChangeHandler(b)}))}a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};a.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",l),this.hasPendingTileGeometryChanges=!1)};a.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};
a.prototype.tileGeometryChangeHandler=function(b){var a=this;this.tileGeometryUpdateSpatialReference=b.spatialReference;c.expand(this.tileGeometryUpdateExtent,b.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(n.schedule(function(){return a.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};a.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&
(a.UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.events.emit("request-update",l):this.hasPendingTileGeometryChanges=!0);c.set(this.tileGeometryUpdateExtent,c.NEGATIVE_INFINITY)};a.prototype.furthestCenterOnSurface=function(){for(var b=this.centerOnSurfaceInstances[0],a=1;a<this.centerOnSurfaceInstances.length;a++){var c=this.centerOnSurfaceInstances[a];c.distance>b.distance&&(b=c)}return b};a.prototype.centerIntersectsExtent=function(a,g){var b=this.viewState.camera.eye,d=q,h=this.furthestCenterOnSurface();
this.renderCoordsHelper.fromRenderCoords(b,e,g);this.renderCoordsHelper.fromRenderCoords(h.renderLocation,f,g);e[0]<f[0]?(d[0]=e[0],d[2]=f[0]):(d[0]=f[0],d[2]=e[0]);e[1]<f[1]?(d[1]=e[1],d[3]=f[1]):(d[1]=f[1],d[3]=e[1]);return c.intersects(d,a)};a.UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!0;return a}();h.SurfaceGeometryUpdates=g;var l={},e=k.vec3d.create(),f=k.vec3d.create(),q=c.create(c.NEGATIVE_INFINITY);h.default=g});