// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.5/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/accessorSupport/decorators ../core/watchUtils ./DOMContainer ../core/Accessor ../core/ArrayPool ../core/HandleRegistry dojo/dom-class".split(" "),function(B,r,f,a,b,c,t,p,h,l,q,y){var z={widthBreakpoint:{getValue:function(a){var c=a.viewSize[0];a=a.breakpoints;var b=this.values;return c<=a.xsmall?b.xsmall:c<=
a.small?b.small:c<=a.medium?b.medium:c<=a.large?b.large:b.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",
large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(a){var c=a.viewSize[1];a=a.breakpoints;var b=this.values;return c<=a.xsmall?b.xsmall:c<=a.small?b.small:c<=a.medium?b.medium:
c<=a.large?b.large:b.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",
large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(a){a=a.viewSize;var c=this.values;return a[1]>=a[0]?c.portrait:c.landscape},values:{portrait:"portrait",landscape:"landscape"},
valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},w={xsmall:544,small:768,medium:992,large:1200};return function(h){function u(){var a=null!==h&&h.apply(this,arguments)||this;a._breakpointsHandles=new q;a.breakpoints=w;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}f(u,h);u.prototype.initialize=function(){this._breakpointsHandles.add([t.init(this,["breakpoints","size"],this._updateClassNames)])};u.prototype.destroy=
function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};u.prototype._updateClassNames=function(){if(this.container){var a=l.acquire(),c=l.acquire(),b=!1,h,q,u;for(h in z)q=this[h],u=z[h].getValue({viewSize:this.size,breakpoints:this.breakpoints}),q!==u&&(b=!0,this[h]=u,c.push(z[h].valueToClassName[q]),a.push(z[h].valueToClassName[u]));b&&(this._applyClassNameChanges(a,c),l.release(a),l.release(c))}};u.prototype._applyClassNameChanges=
function(a,c){var b=this.container;b&&(y.remove(b,c),y.add(b,a))};u.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var c in z)y.remove(a,z[c].valueToClassName[this[c]])};a([c.property({set:function(a){var c=this._get("breakpoints");if(a!==c){c=(c=a)&&c.xsmall<c.small&&c.small<c.medium&&c.medium<c.large;if(!c){var n=JSON.stringify(w,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}a=c?a:w;this._set("breakpoints",b({},a))}}})],u.prototype,"breakpoints",
void 0);a([c.property()],u.prototype,"orientation",void 0);a([c.property()],u.prototype,"widthBreakpoint",void 0);a([c.property()],u.prototype,"heightBreakpoint",void 0);return u=a([c.subclass("esri.views.BreakpointsOwner")],u)}(c.declared(h,p))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang dojo/on dojo/dom dojo/dom-construct ../core/Accessor ../core/Evented ../core/HandleRegistry ../core/Scheduler ../core/watchUtils ../widgets/Popup ./PopupManager ./ui/DefaultUI ../core/accessorSupport/decorators".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E){var G=[0,0];return function(n){function h(){var a=n.call(this)||this;a.height=0;a.position=null;a.resizing=!1;a.root=null;a.surface=null;a.suspended=!0;a.width=0;Object.defineProperty(a,"_measureInfo",{enumerable:!1,writable:!1,value:{task:null,freq:16,time:750}});a._domHandles=new q;a.watch("interacting",function(c){var b=a.surface;b&&b.setAttribute("data-interacting",c.toString())});return a}f(h,n);h.prototype.getDefaults=function(){return b.mixin(this.inherited(arguments),
{popup:{},ui:{}})};h.prototype.initialize=function(){var a=this,b=this._measureInfo,n=null;z.init(this,"container",function(h,l,q,u){if(null!=h||null!=l)n&&(n.remove(),n=null,b.freq=16,b.time=750),b.task&&(b.task.remove(),b.task=null),h?(n=c(window,"resize",function(){b.freq=16;b.time=750}),b.task=y.addFrameTask({prepare:function(c){var b=a._measureInfo;b.time+=c.deltaTime;b.time<b.freq||(b.time=0,a._measure()?(b.freq=16,a._set("resizing",!0)):(b.freq=Math.min(750,2*b.freq),512<=b.freq&&a._set("resizing",
!1)))}})):a._set("resizing",!1),a._measure(),h=a.root,l=a.surface,q=a.width,u=a.height,h&&l&&q&&u&&(h.style.width=l.style.width=q+"px",h.style.height=l.style.height=u+"px")})};h.prototype.destroy=function(){this.ui.destroy();this.popup&&this.popup.destroy();this.container=null};Object.defineProperty(h.prototype,"container",{set:function(a){var c=this._get("container");if(c!==a){c&&(c.classList.remove("esri-view"),this.popupManager.destroy(),this.popupManager=null,p.destroy(this.root),this._set("root",
null));if(a){a.classList.add("esri-view");c=document.createElement("div");c.className="esri-view-root";a.insertBefore(c,a.firstChild);this._set("root",c);var b=document.createElement("div");b.className="esri-view-surface";t.setSelectable(b,!1);c.appendChild(b);this._set("surface",b);this._forceReadyCycle();this.popupManager=new u({enabled:!0,view:this})}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null);this._set("container",
a)}},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"popup",{set:function(a){var c=this._get("popup");a!==c&&(a||(a=new w({container:document.createElement("div")})),this._domHandles.remove("view-popup"),c&&c.destroy(),a&&(a.viewModel.view=this,this._domHandles.add([z.init(this,"root",function(c,b){var n=a.container;n||(a.container=document.createElement("div"));var h=n&&n.parentNode;t.isDescendant(h,b)&&h.removeChild(n);c&&!h&&p.place(a.container,c)})],"view-popup")),this._set("popup",
a))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"ui",{set:function(a){var c=this._get("ui");a!==c&&(this._domHandles.remove("ui"),c&&c.destroy(),a&&(a.view=this,this._domHandles.add([z.init(this,"root",function(c){a.container=c?p.create("div",null,c):null})],"ui")),this._set("ui",a))},enumerable:!0,configurable:!0});h.prototype.focus=function(){this.surface&&
this.surface.focus()};h.prototype.pageToContainer=function(a,c,b){var n=this.position;a-=n[0];c-=n[1];b?(b[0]=a,b[1]=c):b=[a,c];return b};h.prototype.containerToPage=function(a,c,b){var n=this.position;a+=n[0];c+=n[1];b?(b[0]=a,b[1]=c):b=[a,c];return b};h.prototype._measure=function(){var a=this.container,c=a?a.clientWidth:0,b=a?a.clientHeight:0;if(0===c||0===b||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",!0),!1;var n=this.root,h=this.surface,l=this.width,
q=this.height,u=this.position;if(c===l&&b===q)return this.suspended&&this._set("suspended",!1),!1;n&&h&&(n.style.width=h.style.width=c+"px",n.style.height=h.style.height=b+"px");this._set("width",c);this._set("height",b);this._set("suspended",!1);n=(a.ownerDocument||window.document).defaultView;a=a.getBoundingClientRect();G[0]=a.left+n.pageXOffset;G[1]=a.top+n.pageYOffset;u&&G[0]===u[0]&&G[1]===u[1]||this._set("position",G.slice());this.emit("resize",{oldWidth:l,oldHeight:q,width:c,height:b});return!0};
a([E.property({value:null,cast:function(a){return t.byId(a)}})],h.prototype,"container",null);a([E.property({readOnly:!0})],h.prototype,"height",void 0);a([E.property({type:w})],h.prototype,"popup",null);a([E.property({readOnly:!0})],h.prototype,"position",void 0);a([E.property({readOnly:!0})],h.prototype,"resizing",void 0);a([E.property({readOnly:!0})],h.prototype,"root",void 0);a([E.property({value:null,dependsOn:["width","height"],readOnly:!0})],h.prototype,"size",null);a([E.property({readOnly:!0})],
h.prototype,"surface",void 0);a([E.property({readOnly:!0})],h.prototype,"suspended",void 0);a([E.property({type:C})],h.prototype,"ui",null);a([E.property({readOnly:!0})],h.prototype,"width",void 0);return h=a([E.subclass("esri.views.DOMContainer")],h)}(E.declared(h,l))})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ./support/widget ../core/accessorSupport/decorators ../core/lang ../core/HandleRegistry ../core/watchUtils ./Widget ../widgets/support/widgetUtils ./Popup/PopupRenderer ./Popup/PopupViewModel dojo/i18n!./Popup/nls/Popup ./Spinner dojo/dom-geometry".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E){function G(a,c){return void 0===c?"esri-popup__"+a:"esri-popup__"+a+"-"+c}var n=B.toUrl("./Popup/images/default-action.svg"),A={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};return function(x){function I(a){a=x.call(this)||this;a._containerNode=null;a._mainContainerNode=null;a._featureMenuButtonNode=null;a._featureMenuViewportNode=null;a._handleRegistry=new h;a._displayActionTextLimit=2;a._pointerOffsetInPx=16;a._spinner=null;a._closeFeatureMenuHandle=
null;a.actions=null;a.alignment="auto";a.autoCloseEnabled=null;a.content=null;a.collapsed=!1;a.collapseEnabled=!0;a.dockEnabled=!1;a.featureCount=null;a.featureMenuOpen=!1;a.features=null;a.featureNavigationEnabled=!0;a.highlightEnabled=null;a.location=null;a.popupRenderers=[];a.promises=null;a.selectedFeature=null;a.selectedFeatureIndex=null;a.selectedPopupRenderer=null;a.spinnerEnabled=!0;a.title=null;a.updateLocationEnabled=null;a.view=null;a.viewModel=new w;a.visible=null;return a}f(I,x);I.prototype.postInitialize=
function(){var a=this,c=l.pausable(this,"\n      viewModel.visible,\n      dockEnabled,\n      viewModel.selectedFeature\n    ",function(){return a._closeFeatureMenu()});this._closeFeatureMenuHandle=c;this.own(l.watch(this,"viewModel.screenLocation",function(){return a._positionContainer()}),l.watch(this,["viewModel.visible","dockEnabled"],function(){return a._toggleScreenLocationEnabled()}),l.watch(this,"viewModel.screenLocation",function(c,b){!!c!==!!b&&a.reposition()}),l.watch(this,"viewModel.features",
function(c){return a._createPopupRenderers(c)}),l.watch(this,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return a.reposition()}),c,l.watch(this,"spinnerEnabled",function(c){return a._spinnerEnabledChange(c)}),l.watch(this,["title","content"],function(){return a._hasFeatureUpdated()}),l.watch(this,"viewModel.view.size",function(c,b){return a._updateDockEnabledForViewSize(c,b)}),l.watch(this,"viewModel.view",
function(c,b){return a._viewChange(c,b)}),l.watch(this,"viewModel.view.ready",function(c,b){return a._viewReadyChange(c,b)}),l.watch(this,["viewModel.waitingForResult","viewModel.location"],function(){return a._displaySpinner()}),l.watch(this,["popupRenderers","viewModel.selectedFeatureIndex"],function(){return a._updatePopupRenderer()}),l.watch(this,"selectedPopupRenderer.viewModel.title",function(c){return a._setTitleFromPopupRenderer(c)}),l.watch(this,["selectedPopupRenderer.viewModel.content",
"selectedPopupRenderer.viewModel.waitingForContent"],function(){return a._setContentFromPopupRenderer()}),l.on(this,"viewModel","trigger-action",function(c){return a._zoomToAction(c)}))};I.prototype.destroy=function(){this._destroyPopupRenderers();this._destroySpinner();this._handleRegistry.destroy();this._handleRegistry=null};Object.defineProperty(I.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(I.prototype,"currentDockPosition",
{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(I.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||A},set:function(a){var c=b({},A),n=this.get("viewModel.view.breakpoints"),h={};n&&(h.width=n.xsmall,h.height=n.xsmall);a=b({},c,a);c=b({},c.breakpoint,h);h=a.breakpoint;!0===h?a.breakpoint=c:"object"===typeof h&&(a.breakpoint=b({},c,h));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,
configurable:!0});I.prototype.clear=function(){};I.prototype.close=function(){this.visible=!1};I.prototype.next=function(){return null};I.prototype.open=function(a){a=b({visible:!0},{featureMenuOpen:!1,updateLocationEnabled:!1,promises:[]},a);a.featureMenuOpen&&this._closeFeatureMenuHandle.pause();this.set(a)};I.prototype.previous=function(){return null};I.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};I.prototype.triggerAction=function(a){return null};
I.prototype.render=function(){var a=this.collapsed,b=this.collapseEnabled,n=this.dockEnabled,h=this.dockOptions,l=this.actions,q=this.featureMenuOpen,f=this.featureNavigationEnabled,A=this.popupRenderers,C=this.visible,x=this.viewModel,w=x.featureCount,k=x.promiseCount,t=x.pendingPromisesCount,V=x.selectedFeatureIndex,e=x.title,x=x.waitingForResult,f=1<w&&f,q=1<w&&q,d=b&&!q&&a,g=l&&l.length,m=f&&this._getPageText(w,V),v=this._renderContent(),D=y.isRtl(),L=this.get("selectedPopupRenderer")?this.get("selectedPopupRenderer.viewModel.waitingForContent")||
this.get("selectedPopupRenderer.viewModel.content"):v,R=n?u.undock:u.dock,l=this.currentAlignment,a=this.currentDockPosition,t=t?c.tsx("div",{key:G("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":u.loading,title:u.loading},c.tsx("span",{"aria-hidden":"true",class:c.join("esri-popup__icon","esri-rotating esri-icon-loading-indicator")})):null,Z=(ba={},ba["esri-icon-layer-list"]=!q,ba["esri-icon-close"]=q,ba),ba=c.tsx("span",{"aria-hidden":"true",class:"esri-popup__icon",
classes:Z}),Z=(z={},z["esri-icon-right-triangle-arrow"]=D,z["esri-popup__pagination-previous-icon--rtl"]=D,z["esri-icon-left-triangle-arrow"]=!D,z["esri-popup__pagination-previous-icon"]=!D,z),z=c.tsx("span",{"aria-hidden":"true",class:"esri-popup__icon",classes:Z}),z=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:c.join("esri-popup__button","esri-popup__pagination-previous"),"aria-label":u.previous,title:u.previous},z),D=(E={},E["esri-icon-left-triangle-arrow"]=
D,E["esri-popup__pagination-next-icon--rtl"]=D,E["esri-icon-right-triangle-arrow"]=!D,E["esri-popup__pagination-next-icon"]=!D,E),E=c.tsx("span",{"aria-hidden":"true",class:"esri-popup__icon",classes:D}),E=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:c.join("esri-popup__button","esri-popup__pagination-next"),"aria-label":u.next,title:u.next},E),ba=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,
afterCreate:this._storeFeatureMenuButtonNode,afterUpdate:this._storeFeatureMenuButtonNode,class:c.join("esri-popup__button","esri-popup__feature-menu-button"),"aria-label":u.menu,title:u.menu},ba),m=c.tsx("div",{class:"esri-popup__pagination-page-text"},m),E=f?c.tsx("div",{class:"esri-popup__navigation-buttons"},z,m,E,ba):null,m=this._wouldDockTo(),ba="top-left"===m||"bottom-left"===m,D="top-center"===m,z="bottom-center"===m,m="top-right"===m||"bottom-right"===m?c.tsx("span",{"aria-hidden":"true",
key:G("dock-right-icon"),class:c.join("esri-popup__icon","esri-popup__icon--dock-icon","esri-icon-dock-right")}):null,ba=ba?c.tsx("span",{"aria-hidden":"true",key:G("dock-left-icon"),class:c.join("esri-popup__icon","esri-popup__icon--dock-icon","esri-icon-dock-left")}):null,D=D?c.tsx("span",{"aria-hidden":"true",key:G("dock-top-icon"),class:c.join("esri-popup__icon","esri-popup__icon--dock-icon","esri-icon-maximize")}):null,z=z?c.tsx("span",{"aria-hidden":"true",key:G("dock-bottom-icon"),class:c.join("esri-popup__icon",
"esri-popup__icon--dock-icon","esri-icon-dock-bottom")}):null,Z=n?c.tsx("span",{"aria-hidden":"true",key:G("undocked-icon"),class:c.join("esri-popup__icon","esri-icon-minimize")}):null,h=h.buttonEnabled?c.tsx("div",{role:"button","aria-label":R,title:R,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,class:c.join("esri-popup__button","esri-popup__button--dock")},m,D,ba,z,Z):null,b=b&&(L||g||f),R=(I={},I["esri-popup__header-title--button"]=b,I),I=b?d?u.expand:
u.collapse:"",e=e?c.tsx("h1",{class:"esri-popup__header-title",role:b?"button":"heading","aria-label":I,title:I,classes:R,bind:this,tabIndex:b?0:-1,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed,innerHTML:e}):null,I=c.tsx("span",{"aria-hidden":"true",class:c.join("esri-popup__icon","esri-icon-close")}),I=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":u.close,title:u.close},I),e=c.tsx("header",{class:"esri-popup__header"},
e,c.tsx("div",{class:"esri-popup__header-buttons"},h,I)),v=L&&!d?c.tsx("article",{key:G("content-container"),class:"esri-popup__content"},v):null,L=!d&&("bottom-left"===l||"bottom-center"===l||"bottom-right"===l||"top-left"===a||"top-center"===a||"top-right"===a),d=!d&&("top-left"===l||"top-center"===l||"top-right"===l||"bottom-left"===a||"bottom-center"===a||"bottom-right"===a),I=q?null:c.tsx("div",{key:G("actions"),class:"esri-popup__actions"},this._renderActions()),t=c.tsx("section",{key:G("navigation"),
class:"esri-popup__navigation"},t,E),f=f||g?c.tsx("div",{key:G("feature-buttons"),class:"esri-popup__feature-buttons"},I,t):null;(V=this._renderFeatureMenuNode(A,V,q))&&this._closeFeatureMenuHandle.resume();A=p.substitute({total:A.length},u.selectedFeatures);V=c.tsx("section",{key:G("menu"),class:"esri-popup__feature-menu"},c.tsx("h2",{class:"esri-popup__feature-menu-header"},A),c.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._storeFeatureMenuViewportNode,afterUpdate:this._storeFeatureMenuViewportNode},
V));this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0);A=n?null:c.tsx("div",{key:G("pointer"),class:"esri-popup__pointer",role:"presentation"},c.tsx("div",{class:c.join("esri-popup__pointer-direction","esri-popup--shadow")}));q=(r={},r["esri-popup--aligned-top-center"]="top-center"===l,r["esri-popup--aligned-bottom-center"]="bottom-center"===l,r["esri-popup--aligned-top-left"]="top-left"===l,r["esri-popup--aligned-bottom-left"]="bottom-left"===l,r["esri-popup--aligned-top-right"]=
"top-right"===l,r["esri-popup--aligned-bottom-right"]="bottom-right"===l,r["esri-popup--is-docked"]=n,r["esri-popup--shadow"]=!n,r["esri-popup--feature-updated"]=C,r["esri-popup--is-docked-top-left"]="top-left"===a,r["esri-popup--is-docked-top-center"]="top-center"===a,r["esri-popup--is-docked-top-right"]="top-right"===a,r["esri-popup--is-docked-bottom-left"]="bottom-left"===a,r["esri-popup--is-docked-bottom-center"]="bottom-center"===a,r["esri-popup--is-docked-bottom-right"]="bottom-right"===a,r["esri-popup--feature-menu-open"]=
q,r);r=this.get("selectedFeature.layer.title");l=this.get("selectedFeature.layer.id");n=(ga={},ga["esri-popup--shadow"]=n,ga);ga=L?V:null;V=d?V:null;a=L?f:null;f=d?f:null;C=C&&!x&&(k?w:1)?c.tsx("div",{key:G("container"),class:"esri-popup__position-container",classes:q,"data-layer-title":r,"data-layer-id":l,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},c.tsx("div",{class:c.join("esri-popup__main-container","esri-widget"),classes:n,bind:this,afterCreate:this._storeMainContainerNode,
afterUpdate:this._storeMainContainerNode},a,ga,e,v,f,V),A):null;return c.tsx("div",{key:G("base"),class:"esri-popup",role:"presentation"},C);var ba,z,E,I,r,ga};I.prototype._setTitleFromPopupRenderer=function(a){this.viewModel.title=a||""};I.prototype._setContentFromPopupRenderer=function(){this.viewModel.content=this.selectedPopupRenderer||null;this.scheduleRender()};I.prototype._zoomToAction=function(a){a.action&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()};I.prototype._spinnerEnabledChange=
function(a){this._destroySpinner();a&&(a=this.get("viewModel.view"),this._createSpinner(a))};I.prototype._displaySpinner=function(){var a=this._spinner;if(a){var c=this.viewModel,b=c.location;c.waitingForResult?a.show({location:b}):a.hide()}};I.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};I.prototype._renderAction=function(a,b,h,q){var f=this,A=l.watch(a,["id","className","title","image","visible"],function(){return f.scheduleRender()});this._handleRegistry.add(A,
q);A=this.get("selectedFeature.attributes");"zoom-to"===a.id&&(a.title=u.zoom,a.className="esri-icon-zoom-in-magnifying-glass");q=a.title;var C=a.className,x=a.image||C?a.image:n;q=q&&A?p.substitute(A,q):q;C=C&&A?p.substitute(A,C):C;A=x&&A?p.substitute(A,x):x;x=(w={},w[C]=!!C,w["esri-popup__action-image"]=!!A,w);h=h<=this._displayActionTextLimit?c.tsx("span",{key:G("action-text-"+b+"-"+a.uid),class:"esri-popup__action-text"},q):null;return a.visible?c.tsx("div",{key:G("action-"+b+"-"+a.uid),role:"button",
tabIndex:0,title:q,"aria-label":q,class:c.join("esri-popup__button","esri-popup__action"),bind:this,"data-action-index":b,onclick:this._triggerAction,onkeydown:this._triggerAction},c.tsx("span",{key:G("action-icon-"+b+"-"+a.uid),"aria-hidden":"true",class:"esri-popup__icon",classes:x,styles:this._getIconStyles(A)}),h):null;var w};I.prototype._renderActions=function(){var a=this;this._handleRegistry.remove("actions");var b=this.actions;if(b){var n=b.length,b=b.toArray().map(function(c,b){return a._renderAction(c,
b,n,"actions")});return c.tsx("div",{key:G("actions"),class:"esri-popup__actions"},b)}};I.prototype._updatePopupRenderer=function(){var a=this.popupRenderers[this.viewModel.selectedFeatureIndex]||null;a&&!a.contentEnabled&&(a.contentEnabled=!0);this._set("selectedPopupRenderer",a)};I.prototype._destroyPopupRenderers=function(){this.popupRenderers.forEach(function(a){return a.destroy()});this._set("popupRenderers",[])};I.prototype._createPopupRenderers=function(a){var c=this;this._destroyPopupRenderers();
var b=[];a&&a.forEach(function(a){a=new z({contentEnabled:!1,graphic:a,view:c.get("viewModel.view")});b.push(a)});this._set("popupRenderers",b)};I.prototype._isScreenLocationWithinView=function(a,c){return-1<a.x&&-1<a.y&&a.x<=c.width&&a.y<=c.height};I.prototype._isOutsideView=function(a){var c=a.popupHeight,b=a.popupWidth,n=a.screenLocation,h=a.side;a=a.view;if(isNaN(b)||isNaN(c)||!a||!n)return!1;var l=a.padding;return"right"===h&&n.x+b/2>a.width-l.right||"left"===h&&n.x-b/2<l.left||"top"===h&&n.y-
c<l.top||"bottom"===h&&n.y+c>a.height-l.bottom?!0:!1};I.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,c=this._containerNode,b=this._mainContainerNode,n=this.viewModel,h=n.screenLocation,n=n.view;if(!h||!n||!c)return"top-center";if(!this._isScreenLocationWithinView(h,n))return this._get("currentAlignment")||"top-center";var l=b?window.getComputedStyle(b,null):null,b=l?parseInt(l.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,l=l?parseInt(l.getPropertyValue("height").replace(/[^-\d\.]/g,
""),10):0,q=E.getContentBox(c),c=q.w+a,q=Math.max(q.h,b,l)+a,a=this._isOutsideView({popupHeight:q,popupWidth:c,screenLocation:h,side:"right",view:n}),b=this._isOutsideView({popupHeight:q,popupWidth:c,screenLocation:h,side:"left",view:n}),l=this._isOutsideView({popupHeight:q,popupWidth:c,screenLocation:h,side:"top",view:n}),h=this._isOutsideView({popupHeight:q,popupWidth:c,screenLocation:h,side:"bottom",view:n});return b?l?"bottom-right":"top-right":a?l?"bottom-left":"top-left":l?h?"top-center":"bottom-center":
"top-center"};I.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};I.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};I.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};I.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?
this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};I.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};I.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};I.prototype._renderFeatureMenuItemNode=function(a,b,n,h){var l=b===n,q=(f={},f["esri-popup__feature-menu-item--selected"]=l,f);a=a.title||u.untitled;f=l?c.tsx("span",{key:G("feature-menu-selected-feature-"+n),title:u.selectedFeature,"aria-label":u.selectedFeature,
class:"esri-icon-check-mark"}):null;return c.tsx("li",{role:"menuitem",tabIndex:l||!h?-1:0,key:G("feature-menu-feature-"+n),classes:q,class:"esri-popup__feature-menu-item",title:a,"aria-label":a,bind:this,"data-feature-index":b,onclick:this._selectFeature,onkeydown:this._selectFeature},c.tsx("span",{class:"esri-popup__feature-menu-title"},a,f));var f};I.prototype._renderFeatureMenuNode=function(a,b,n){var h=this;return 1<a.length?c.tsx("ol",{class:"esri-popup__feature-menu-list",role:"menu"},a.map(function(a,
c){return h._renderFeatureMenuItemNode(a,c,b,n)})):null};I.prototype._determineCurrentDockPosition=function(){var a=this.get("viewModel.view"),c=y.isRtl()?"top-left":"top-right";if(!a)return c;var b=a.padding||{left:0,right:0,top:0,bottom:0},b=a.width-b.left-b.right;return(a=a.get("breakpoints"))&&b<=a.xsmall?"bottom-center":c};I.prototype._renderContent=function(){var a=this.get("viewModel.content");if("string"===typeof a)return c.tsx("div",{key:G("content-string"),innerHTML:a});if(a&&a.isInstanceOf&&
a.isInstanceOf(q))return c.tsx("div",{key:G("content-widget")},a.render());if(a instanceof HTMLElement)return c.tsx("div",{key:G("content-html-element"),bind:a,afterUpdate:this._attachToNode,afterCreate:this._attachToNode});if(a&&"function"===typeof a.postMixInProperties&&"function"===typeof a.buildRendering&&"function"===typeof a.postCreate&&"function"===typeof a.startup)return c.tsx("div",{key:G("content-dijit"),bind:a.domNode,afterUpdate:this._attachToNode,afterCreate:this._attachToNode})};I.prototype._attachToNode=
function(a){a.appendChild(this)};I.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var c=this.viewModel.screenLocation,b=E.getContentBox(a);if(c=this._calculatePositionStyle(c,b))a.style.top=c.top,a.style.left=c.left,a.style.bottom=c.bottom,a.style.right=c.right}};I.prototype._calculateFullWidth=function(a){var c=this.currentAlignment,b=this._pointerOffsetInPx;return"top-left"===c||"bottom-left"===c||"top-right"===c||"bottom-right"===c?
a+b:a};I.prototype._calculateAlignmentPosition=function(a,c,b,n){var h=this.currentAlignment,l=this._pointerOffsetInPx;n/=2;var q=b.height-c;b=b.width-a;if("bottom-center"===h)return{top:c+l,left:a-n};if("top-left"===h)return{bottom:q+l,right:b+l};if("bottom-left"===h)return{top:c+l,right:b+l};if("top-right"===h)return{bottom:q+l,left:a+l};if("bottom-right"===h)return{top:c+l,left:a+l};if("top-center"===h)return{bottom:q+l,left:a-n}};I.prototype._calculatePositionStyle=function(a,c){var b=this.view;
if(b){var n=b.padding;if(this.dockEnabled)return{left:n.left?n.left+"px":"",top:n.top?n.top+"px":"",right:n.right?n.right+"px":"",bottom:n.bottom?n.bottom+"px":""};if(a&&c&&(c=this._calculateFullWidth(c.w),a=this._calculateAlignmentPosition(a.x,a.y,b,c)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};I.prototype._viewChange=function(a,c){a&&c&&(this.close(),this.clear())};
I.prototype._viewReadyChange=function(a,c){a?(a=this.get("viewModel.view"),this._wireUpView(a)):c&&(this.close(),this.clear())};I.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};I.prototype._dockingThresholdCrossed=function(a,c,b){var n=a[0];a=a[1];var h=c[0];c=c[1];var l=b.width;b=b.height;return n<=l&&h>l||n>l&&h<=l||a<=b&&c>b||a>b&&c<=b};I.prototype._updateDockEnabledForViewSize=function(a,
c){if(a&&c){var b=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=b.left+b.right,h=b.top+b.bottom,b=[],l=[];b[0]=a[0]-n;b[1]=a[1]-h;l[0]=c[0]-n;l[1]=c[1]-h;a=this.dockOptions;this._dockingThresholdCrossed(b,l,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};I.prototype._hasFeatureUpdated=function(){var a=this._containerNode,c=this.viewModel.pendingPromisesCount,b=this.get("selectedPopupRenderer.viewModel.waitingForContent");!a||c||b||(a.classList.remove("esri-popup--feature-updated"),
a.offsetHeight,a.classList.add("esri-popup--feature-updated"))};I.prototype._storeMainContainerNode=function(a){this._mainContainerNode=a};I.prototype._storeFeatureMenuButtonNode=function(a){this._featureMenuButtonNode=a};I.prototype._storeFeatureMenuViewportNode=function(a){this._featureMenuViewportNode=a};I.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,c=this.viewModel;c&&(c.screenLocationEnabled=this.visible&&!a)};I.prototype._shouldDockAtCurrentViewSize=function(a){a=
a.breakpoint;var c=this.get("viewModel.view.ui"),b=c.width,c=c.height;if(isNaN(b)||isNaN(c))return!1;b=a.hasOwnProperty("width")&&b<=a.width;a=a.hasOwnProperty("height")&&c<=a.height;return b||a};I.prototype._setDockEnabledForViewSize=function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};I.prototype._getPageText=function(a,c){return p.substitute({index:c+1,total:a},u.pageText)};I.prototype._destroySpinner=function(){this._spinner&&(this._spinner.destroy(),this._spinner=
null)};I.prototype._createSpinner=function(a){a&&(this._spinner=new C({container:document.createElement("div"),view:a}),a.root.appendChild(this._spinner.container))};I.prototype._closeFeatureMenu=function(){this.featureMenuOpen=!1};I.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};I.prototype._close=function(){this.close()};I.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled};I.prototype._toggleFeatureMenu=function(){this.featureMenuOpen=!this.featureMenuOpen};
I.prototype._triggerAction=function(a){this.viewModel.triggerAction(a.currentTarget["data-action-index"])};I.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a);this._featureMenuButtonNode&&this._featureMenuButtonNode.focus()};I.prototype._next=function(){this.next()};I.prototype._previous=function(){this.previous()};a([t.aliasOf("viewModel.actions"),c.renderable()],I.prototype,"actions",void 0);a([t.property()],I.prototype,
"alignment",void 0);a([t.aliasOf("viewModel.autoCloseEnabled")],I.prototype,"autoCloseEnabled",void 0);a([t.aliasOf("viewModel.content"),c.renderable()],I.prototype,"content",void 0);a([t.property(),c.renderable()],I.prototype,"collapsed",void 0);a([t.property(),c.renderable()],I.prototype,"collapseEnabled",void 0);a([t.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),c.renderable()],I.prototype,"currentAlignment",null);a([t.property({readOnly:!0,dependsOn:["dockEnabled","dockOptions"]}),
c.renderable()],I.prototype,"currentDockPosition",null);a([t.property(),c.renderable()],I.prototype,"dockOptions",null);a([t.property(),c.renderable()],I.prototype,"dockEnabled",void 0);a([t.aliasOf("viewModel.featureCount"),c.renderable()],I.prototype,"featureCount",void 0);a([t.property(),c.renderable()],I.prototype,"featureMenuOpen",void 0);a([t.aliasOf("viewModel.features"),c.renderable()],I.prototype,"features",void 0);a([t.property(),c.renderable()],I.prototype,"featureNavigationEnabled",void 0);
a([t.aliasOf("viewModel.highlightEnabled")],I.prototype,"highlightEnabled",void 0);a([t.aliasOf("viewModel.location"),c.renderable()],I.prototype,"location",void 0);a([t.property({readOnly:!0}),c.renderable()],I.prototype,"popupRenderers",void 0);a([t.aliasOf("viewModel.promises")],I.prototype,"promises",void 0);a([t.aliasOf("viewModel.selectedFeature"),c.renderable()],I.prototype,"selectedFeature",void 0);a([t.aliasOf("viewModel.selectedFeatureIndex"),c.renderable()],I.prototype,"selectedFeatureIndex",
void 0);a([t.property({readOnly:!0}),c.renderable()],I.prototype,"selectedPopupRenderer",void 0);a([t.property()],I.prototype,"spinnerEnabled",void 0);a([t.aliasOf("viewModel.title"),c.renderable()],I.prototype,"title",void 0);a([t.aliasOf("viewModel.updateLocationEnabled")],I.prototype,"updateLocationEnabled",void 0);a([t.aliasOf("viewModel.view")],I.prototype,"view",void 0);a([t.property({type:w}),c.renderable("viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),
c.vmEvent(["triggerAction","trigger-action"])],I.prototype,"viewModel",void 0);a([t.aliasOf("viewModel.visible"),c.renderable()],I.prototype,"visible",void 0);a([t.aliasOf("viewModel.clear")],I.prototype,"clear",null);a([t.aliasOf("viewModel.next")],I.prototype,"next",null);a([t.aliasOf("viewModel.previous")],I.prototype,"previous",null);a([t.aliasOf("viewModel.triggerAction")],I.prototype,"triggerAction",null);a([c.accessibleHandler()],I.prototype,"_toggleCollapsed",null);a([c.accessibleHandler()],
I.prototype,"_close",null);a([c.accessibleHandler()],I.prototype,"_toggleDockEnabled",null);a([c.accessibleHandler()],I.prototype,"_toggleFeatureMenu",null);a([c.accessibleHandler()],I.prototype,"_triggerAction",null);a([c.accessibleHandler()],I.prototype,"_selectFeature",null);a([c.accessibleHandler()],I.prototype,"_next",null);a([c.accessibleHandler()],I.prototype,"_previous",null);return I=a([t.subclass("esri.widgets.Popup")],I)}(t.declared(q))})},"esri/widgets/support/widget":function(){define(["require",
"exports","./decorators","./jsxFactory","./widgetUtils"],function(B,r,f,a,b){function c(a){for(var c in a)r.hasOwnProperty(c)||(r[c]=a[c])}Object.defineProperty(r,"__esModule",{value:!0});c(f);c(a);c(b)})},"esri/widgets/support/decorators":function(){define(["require","exports","./decorators/accessibleHandler","./decorators/renderable","./decorators/vmEvent"],function(B,r,f,a,b){function c(a){for(var c in a)r.hasOwnProperty(c)||(r[c]=a[c])}Object.defineProperty(r,"__esModule",{value:!0});c(f);c(a);
c(b)})},"esri/widgets/support/decorators/accessibleHandler":function(){define(["require","exports","dojo/keys"],function(B,r,f){function a(a){return function(c){for(var b=[],p=1;p<arguments.length;p++)b[p-1]=arguments[p];p=c.type;if(c instanceof KeyboardEvent||"keyup"===p||"keydown"===p||"keypress"===p){if(c.keyCode===f.ENTER||c.keyCode===f.SPACE)c.preventDefault(),c.target.click()}else a.call.apply(a,[this,c].concat(b))}}Object.defineProperty(r,"__esModule",{value:!0});r.accessibleHandler=function(){return function(b,
c){return{value:a(b[c])}}}})},"esri/widgets/support/decorators/renderable":function(){define(["require","exports","./propUtils"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});r.renderable=function(a){var b="string"===typeof a?f.splitProps(a):a;return function(a,t){a._renderableProps||(a._renderableProps=[]);a=a._renderableProps;b?a.push.apply(a,f.normalizePropNames(b,t)):a.push(t)}}})},"esri/widgets/support/decorators/propUtils":function(){define(["require","exports"],function(B,
r){Object.defineProperty(r,"__esModule",{value:!0});r.splitProps=function(f){return f.split(",").map(function(a){return a.trim()})};r.normalizePropNames=function(f,a){return f.map(function(b){b=0===b.indexOf(a)?b:a+"."+b;return b})}})},"esri/widgets/support/decorators/vmEvent":function(){define(["require","exports","./propUtils"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});r.vmEvent=function(a){return function(b){b._delegatedEventNames||(b._delegatedEventNames=[]);var c=Array.isArray(a)?
a:f.splitProps(a);b._delegatedEventNames=b._delegatedEventNames.concat(c)}}})},"esri/widgets/support/jsxFactory":function(){define(["require","exports","../libs/maquette/maquette"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});r.tsx=f.h})},"esri/widgets/support/widgetUtils":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.join=function(){for(var f=[],a=0;a<arguments.length;a++)f[a]=arguments[a];return f.join(" ")};r.isRtl=
function(){return"rtl"===document.dir}})},"esri/widgets/Popup/PopupRenderer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../support/widget ../Widget ./PopupRendererViewModel ../../core/requireUtils ../support/uriUtils dojo/i18n!./nls/PopupRenderer ../../core/watchUtils".split(" "),function(B,r,f,a,b,c,t,p,h,l,q,y){function z(a,c){return void 0===c?"esri-popup-renderer__"+a:"esri-popup-renderer__"+
a+"-"+c}return function(w){function u(a){a=w.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._chartRequirePromise=null;a._refreshTimers=new Map;a._mediaInfo=new Map;a.contentEnabled=null;a.graphic=null;a.title=null;a.view=null;a.viewModel=new p;return a}f(u,w);u.prototype.postInitialize=function(){var a=this;this.own(y.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};u.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();
this._activeMediaMap=null;this._cancelChartModules();this._destroyCharts()};u.prototype.render=function(){var a=c.tsx("div",{key:z("loading-container"),class:"esri-popup-renderer__loading-container"},c.tsx("span",{class:c.join("esri-icon-loading-indicator esri-rotating","esri-popup-renderer__loading-spinner")})),a=this.viewModel.waitingForContent?a:this._renderContent();return c.tsx("div",{class:"esri-popup-renderer"},c.tsx("div",{class:"esri-popup-renderer__size-container"},c.tsx("div",{class:"esri-popup-renderer__main-container"},
a)))};u.prototype.goToMedia=function(a,c){this._setContentElementMedia(a,c)};u.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};u.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};u.prototype._cancelChartModules=function(){this._chartRequirePromise&&this._chartRequirePromise.cancel()};u.prototype._destroyChart=function(a){var c=this._chartMap.get(a);c&&(c.chart.destroy(),c.tooltip.destroy());this._chartMap.delete(a)};u.prototype._destroyCharts=
function(){this._chartMap.forEach(function(a){a.chart.destroy();a.tooltip.destroy()});this._chartMap.clear()};u.prototype._renderContent=function(){this._destroyCharts();var a=this.viewModel.content;if("string"===typeof a)return c.tsx("div",{key:z("content-string"),innerHTML:a});if(a&&a.isInstanceOf&&a.isInstanceOf(t))return c.tsx("div",{key:z("content-widget")},a.render());if(a instanceof HTMLElement)return c.tsx("div",{key:z("content-html-element"),bind:a,afterUpdate:this._attachToNode,afterCreate:this._attachToNode});
if(a&&"function"===typeof a.postMixInProperties&&"function"===typeof a.buildRendering&&"function"===typeof a.postCreate&&"function"===typeof a.startup)return c.tsx("div",{key:z("content-dijit"),bind:a.domNode,afterUpdate:this._attachToNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?c.tsx("div",{key:z("content-content-elements")},a.map(this._renderContentElement,this)):null};u.prototype._renderContentElement=function(a,c){var b=this.viewModel.contentTypes;switch(a.type){case b.attachments:return this._renderAttachments(a,
c);case b.fields:return this._renderFields(a,c);case b.media:return this._renderMedia(a,c);case b.text:return this._renderText(a,c);default:return null}};u.prototype._renderAttachmentInfo=function(a,b){return c.tsx("li",{class:"esri-popup-renderer__attachments-item",key:z("attachment",b)},c.tsx("a",{class:"esri-popup-renderer__attachments-item-link",href:a.url,target:"_blank"},c.tsx("span",{class:c.join("esri-icon-download","esri-popup-renderer__attachments-item-icon")}),c.tsx("span",{class:"esri-popup-renderer__attachments-item-title"},
a.name||q.noTitle)))};u.prototype._renderAttachments=function(a,b){return(a=a.attachmentInfos)&&a.length?c.tsx("div",{key:z("attachments-element"),class:c.join("esri-popup-renderer__attachments","esri-popup-renderer__content-element")},c.tsx("div",{class:"esri-popup-renderer__attachments-title"},q.attach),c.tsx("ul",{class:"esri-popup-renderer__attachments-items"},a.map(this._renderAttachmentInfo))):null};u.prototype._renderFieldInfo=function(a,b){var h=this.viewModel,n=h.formattedAttributes.content[b]||
h.formattedAttributes.global,q=a.fieldName,h=a.label||q;a=!(!a.format||!a.format.dateFormat);n=l.autoLink(null==n[q]?"":n[q]);a=(u={},u["esri-popup-renderer__field-data--date"]=a,u);return c.tsx("tr",{key:z("fields-element-info-row",b)},c.tsx("th",{key:z("fields-element-info-row-header",b),class:"esri-popup-renderer__field-header",innerHTML:h}),c.tsx("td",{key:z("fields-element-info-row-data",b),class:"esri-popup-renderer__field-data",classes:a,innerHTML:n}));var u};u.prototype._renderFields=function(a,
b){var h=this;return(a=a.fieldInfos)?c.tsx("div",{key:z("fields-element",b),class:c.join("esri-popup-renderer__fields","esri-popup-renderer__content-element")},c.tsx("table",{summary:q.fieldsSummary,key:z("fields-element-table",b)},c.tsx("tbody",{key:z("fields-element-table-body",b)},a.map(function(a){return h._renderFieldInfo(a,b)})))):null};u.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};u.prototype._clearMediaRefreshTimers=
function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};u.prototype._clearMediaRefreshTimer=function(a){var c=this._refreshTimers.get(a);c&&(clearTimeout(c),this._refreshTimers.delete(a))};u.prototype._getImageSource=function(a,c){var b=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var n=a[1],n=void 0===n?"":n;return""+a[0]+b+"timestamp\x3d"+c+(n?"#":"")+n};u.prototype._setupMediaRefreshTimer=function(a){var c=this.get("viewModel.content");if(Array.isArray(c)&&
(c=c[a])&&"media"===c.type){var b=this._activeMediaMap.get(a);isNaN(b)&&(b=0);(c=c.mediaInfos[b])&&"image"===c.type&&c.refreshInterval&&this._setRefreshTimeout(a,c)}};u.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var c=this.get("viewModel.content");Array.isArray(c)&&c.forEach(function(c,b){return a._setupMediaRefreshTimer(b)})};u.prototype._updateMediaInfoTimestamp=function(a,c){var b=Date.now();this._mediaInfo.set(c,{timestamp:b,sourceURL:this._getImageSource(a,
b)});this.scheduleRender()};u.prototype._setRefreshTimeout=function(a,c){var b=this,n=c.refreshInterval,h=c.value;n&&(c=6E4*n,this._updateMediaInfoTimestamp(h.sourceURL,a),c=setInterval(function(){b._updateMediaInfoTimestamp(h.sourceURL,a)},c),this._refreshTimers.set(a,c))};u.prototype._renderMediaInfoType=function(a,b){var h=a.value,n=a.title,n=void 0===n?"":n,l=a.type,q=a.refreshInterval,u=h.sourceURL,h=h.linkURL;if("image"===l)return a=this._shouldOpenInNewTab(h)?"_self":"_blank",u=(q=q?this._mediaInfo.get(b):
null)?q.sourceURL:u,b=c.tsx("img",{alt:n,key:z("media-image-"+(q?q.timestamp:0),b),src:u}),(n=h?c.tsx("a",{title:n,href:h,target:a},b):null)?n:b;if(-1!==l.indexOf("chart"))return c.tsx("div",{key:z("chart",b),bind:this,"data-media-info":a,"data-content-element-index":b,class:"esri-popup-renderer__media-chart",afterCreate:this._getChartDependencies,afterUpdate:this._getChartDependencies})};u.prototype._getChartDependencies=function(a){var c=this,b=a["data-media-info"],n=a["data-content-element-index"],
l=b.value,q=l.theme||"Claro",u=b.type,b=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],f=q;"string"===typeof q&&(f=q.replace(/\./g,"/"),-1===f.indexOf("/")&&(f="dojox/charting/themes/"+f));b.push(f);this._cancelChartModules();this._chartRequirePromise=h.when(B,b).then(function(b){c._renderChart(a,n,u,l,b[0],b[1],b[2]);c._chartRequirePromise=null})};u.prototype._renderChart=function(a,c,b,n,h,l,q){a=new h(a,{margins:{l:4,t:4,r:4,b:4}});q&&a.setTheme(q);switch(b){case "pie-chart":a.addPlot("default",
{type:"Pie",labels:!1});a.addSeries("Series A",n.fields);break;case "line-chart":a.addPlot("default",{type:"Markers"});a.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});n.fields.forEach(function(a,c){a.x=c+1});a.addSeries("Series A",n.fields);break;case "column-chart":a.addPlot("default",{type:"Columns",gap:3});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});a.addSeries("Series A",n.fields);break;
case "bar-chart":a.addPlot("default",{type:"Bars",gap:3}),a.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),a.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),a.addSeries("Series A",n.fields)}b=new l(a);a.render();this._chartMap.set(c,{chart:a,tooltip:b})};u.prototype._renderMediaInfo=function(a,b){this._destroyChart(b);var h=this._renderMediaInfoType(a,b),n=a.title?c.tsx("div",{key:z("media-title",b),class:"esri-popup-renderer__media-item-title",
innerHTML:a.title}):null;a=a.caption?c.tsx("div",{key:z("media-caption",b),class:"esri-popup-renderer__media-item-caption",innerHTML:a.caption}):null;return c.tsx("div",{key:z("media-container",b),class:"esri-popup-renderer__media-item-container"},c.tsx("div",{key:z("media-item-container",b),class:"esri-popup-renderer__media-item"},h),n,a)};u.prototype._renderMediaStatsItem=function(a,b,h){h="chart"===h?c.join("esri-popup-renderer__media-chart-icon","esri-icon-chart"):c.join("esri-popup-renderer__media-image-icon",
"esri-icon-media");return c.tsx("li",{class:"esri-popup-renderer__media-image-summary"},c.tsx("span",{class:"esri-popup-renderer__media-count","aria-label":a},"("+b+")"),c.tsx("span",{"aria-hidden":"true",class:h}))};u.prototype._renderMediaPageButton=function(a,b){var h=(a="previous"===a)?q.previous:q.next,n=a?c.join("esri-popup-renderer__button","esri-popup-renderer__media-previous"):c.join("esri-popup-renderer__button","esri-popup-renderer__media-next"),l=a?c.join("esri-popup-renderer__icon","esri-popup-renderer__media-previous-icon",
"esri-icon-left-triangle-arrow"):c.join("esri-popup-renderer__icon","esri-popup-renderer__media-next-icon","esri-icon-right-triangle-arrow"),u=a?c.join("esri-popup-renderer__icon","esri-popup-renderer__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):c.join("esri-popup-renderer__icon","esri-popup-renderer__media-next-icon--rtl","esri-icon-left-triangle-arrow"),f=a?this._previousClick:this._nextClick;return c.tsx("div",{key:z(a?"previous":"next",b),title:h,tabIndex:0,role:"button",class:n,
"data-content-element-index":b,bind:this,onkeydown:f,onclick:f},c.tsx("span",{"aria-hidden":"true",class:l}),c.tsx("span",{"aria-hidden":"true",class:u}),c.tsx("span",{class:"esri-icon-font-fallback-text"},h))};u.prototype._renderMedia=function(a,b){a=a.mediaInfos;var h=this._getMediaStats(a),n=h.total,l=(u={},u["esri-popup-renderer--media-pagination-visible"]=1<h.total,u),u=this._renderMediaStatsItem(q.numImages,h.images,"image"),h=this._renderMediaStatsItem(q.numCharts,h.charts,"chart"),f=this._renderMediaPageButton("previous",
b),p=this._renderMediaPageButton("next",b),w=this._activeMediaMap.get(b);isNaN(w)&&(this._activeMediaMap.set(b,0),w=0);return n?c.tsx("div",{key:z("media-element",b),class:c.join("esri-popup-renderer__media","esri-popup-renderer__content-element"),classes:l},c.tsx("ul",{class:"esri-popup-renderer__media-summary"},u,h),c.tsx("div",{key:z("media-element-container",b),class:"esri-popup-renderer__media-container"},f,this._renderMediaInfo(a[w],b),p)):null;var u};u.prototype._renderText=function(a,b){return a.text?
c.tsx("div",{key:z("text-element",b),innerHTML:a.text,class:c.join("esri-popup-renderer__text","esri-popup-renderer__content-element")}):null};u.prototype._attachToNode=function(a){a.appendChild(this)};u.prototype._getMediaStats=function(a){var c=0,b=0;a.forEach(function(a){a=a.type;"image"===a?c++:-1!==a.indexOf("chart")&&b++});return{total:b+c,images:c,charts:b}};u.prototype._setContentElementMedia=function(a,c){this._clearMediaRefreshTimer(a);var b=this.viewModel.content;(b=(b=b&&b[a])&&b.mediaInfos)&&
b.length&&(this._activeMediaMap.set(a,(c+b.length)%b.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};u.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};u.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};u.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};a([b.aliasOf("viewModel.contentEnabled")],
u.prototype,"contentEnabled",void 0);a([b.aliasOf("viewModel.graphic")],u.prototype,"graphic",void 0);a([b.aliasOf("viewModel.title")],u.prototype,"title",void 0);a([b.aliasOf("viewModel.view")],u.prototype,"view",void 0);a([b.property({type:p}),c.renderable(["viewModel.waitingForContent","viewModel.content"])],u.prototype,"viewModel",void 0);a([c.accessibleHandler()],u.prototype,"_previousClick",null);a([c.accessibleHandler()],u.prototype,"_nextClick",null);return u=a([b.subclass("esri.widgets.Popup.PopupRenderer")],
u)}(b.declared(t))})},"esri/widgets/support/uriUtils":function(){define(["require","exports","../../core/lang","dojo/i18n!./nls/uriUtils"],function(B,r,f,a){function b(a){var b=null;c.some(function(c){c.pattern.test(a)&&(b=c);return!!b});return b}Object.defineProperty(r,"__esModule",{value:!0});var c=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:a.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},
{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,
label:a.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:a.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,
label:a.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Microsoft Power Bi"}];r.autoLink=function(a){if("string"!==typeof a||!a)return a;var c=b(a);if(!c)return a;var h=a.match(c.pattern),h=f.substitute({appName:c.appName,hierPart:h&&h[2]},c.label);return a.replace(c.pattern,"\x3ca "+(c.target?'target\x3d"'+c.target+'"':"")+'" href\x3d"$1"\x3e'+h+"\x3c/a\x3e")}})},"esri/widgets/Popup/PopupViewModel":function(){define("../../core/Accessor ../../core/Collection ../../core/Error ../../core/Evented ../../core/HandleRegistry ../../core/promiseUtils ../../core/watchUtils ../../geometry/geometryEngine ../../geometry/support/webMercatorUtils ../../geometry/Point ../../support/Action ../support/AnchorElementViewModel dojo/fx/easing dojo/_base/lang".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w){function u(a,c){return c.allLayerViews.find(function(c){return c.layer===a})}var C={id:"zoom-to"};return B.createSubclass([a,y],{declaredClass:"esri.widgets.Popup.PopupViewModel",properties:{actions:{type:r.ofType(q)},animationOptions:{},autoCloseEnabled:{},clear:{},content:{},featureCount:{readOnly:!0},features:{},location:{type:l},next:{},pendingPromisesCount:{readOnly:!0},previous:{},promiseCount:{readOnly:!0,dependsOn:["promises"],get:function(){return this.promises?
this.promises.length:0}},promises:{},selectedFeature:{readOnly:!0},selectedFeatureIndex:{},state:{dependsOn:["view.ready"],readOnly:!0},title:{},triggerAction:{},updateLocationEnabled:{},view:{},visible:{},waitingForResult:{dependsOn:["pendingPromisesCount","featureCount"],readOnly:!0},zoomFactor:{}},_handles:null,constructor:function(){this._handles=new b},getDefaults:function(a){return w.mixin(this.inherited(arguments),{actions:[C],animationOptions:{duration:300,easing:z.quadInOut},promises:[]})},
initialize:function(){this._handles.add([this.on("view-change",this._autoClose),t.watch(this,"location",this._locationWatcher),t.whenFalse(this,"visible",this._visibleWatcher)])},destroy:function(){this._handles.destroy();this.view=this._handles=null},actions:[C],animationOptions:{duration:300,easing:z.quadInOut},autoCloseEnabled:!1,content:null,featureCount:0,features:null,_featuresSetter:function(a){this._set("features",a);this._updateFeatureCount(a);this.promiseCount||(this.selectedFeatureIndex=
-1,a&&a.length&&(this.selectedFeatureIndex=0))},highlightEnabled:!0,_highlightEnabledSetter:function(a){this._set("highlightEnabled",a);this._highlightFeature(this.selectedFeature,this.view)},location:null,_locationSetter:function(a){var c=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&c&&(a=h.geographicToWebMercator(a));this._set("location",a)},pendingPromisesCount:0,waitingForResult:!1,_waitingForResultGetter:function(){return 0<this.pendingPromisesCount&&
0===this.featureCount},promiseCount:0,promises:[],_promisesSetter:function(a){var b=this._get("promises");b&&b.forEach(function(a){a.cancel()});this.features=[];b=a&&a.length;this._set("selectedFeatureIndex",-1);this._set("selectedFeature",null);this._selectedFeatureChange(this.selectedFeature,this.updateLocationEnabled);this._set("pendingPromisesCount",0);this._set("promises",a);a&&a.length&&(this._set("pendingPromisesCount",b),a=a.slice(0),a.forEach(function(a){a.always(function(c){a.isCanceled()||
(this._set("pendingPromisesCount",this.pendingPromisesCount-1),this._updateFeatures(a,c))}.bind(this))},this),c.eachAlways(a).then(function(){this.featureCount||(this.visible=!1)}.bind(this)))},selectedFeature:null,selectedFeatureIndex:-1,_selectedFeatureIndexSetter:function(a){if(isNaN(a)||-1>a)a=-1;var c=null,b=this.features;b&&b.length&&(a=(a+b.length)%b.length,c=b[a]);this._set("selectedFeature",c);this._set("selectedFeatureIndex",a);this._selectedFeatureChange(c,this.updateLocationEnabled)},
state:"disabled",_stateGetter:function(){return this.get("view.ready")?"ready":"disabled"},title:null,updateLocationEnabled:!1,_updateLocationEnabledSetter:function(a){this._selectedFeatureChange(this.selectedFeature,a);this._set("updateLocationEnabled",a)},view:null,visible:!1,zoomFactor:4,centerAtLocation:function(){return this.location&&this.view?this.view.goTo({target:this.location,scale:this.view.scale},this.animationOptions):c.reject(new f(this.declaredClass+"::Cannot center at location without a location and view."))},
clear:function(){this.set({promises:[],features:[],content:null,title:null,location:null})},triggerAction:function(a){(a=this.actions.getItemAt(a))&&this.emit("trigger-action",{action:a})},next:function(){this.selectedFeatureIndex+=1;return this},previous:function(){--this.selectedFeatureIndex;return this},zoomToLocation:function(){var a=this.view,b=this.location;if(!b||!a)return c.reject(new f(this.declaredClass+"::Cannot zoom to location without a location and view."));var n=a.scale/this.zoomFactor,
h=this.selectedFeature,l=h&&h.geometry,q=h&&"3d"===a.type;l||q?(b={target:h},l&&"point"===l.type&&this._isScreenSize(h)&&(b.scale=n,this.location=l)):b={target:b,scale:n};return a.goTo(b,this.animationOptions)},_autoClose:function(){this.autoCloseEnabled&&(this.visible=!1)},_isScreenSize:function(a){if("3d"!==this.view.type||"esri.Graphic"!==a.declaredClass)return!0;var b=!0,c=this.view.getViewForGraphic(a);c&&c.whenGraphicBounds&&c.whenGraphicBounds(a).then(function(a){b=!a||a[0]===a[3]&&a[1]===
a[4]&&a[2]===a[5]});return b},_getSelectedFeatureActions:function(){this._originalActions&&(this.actions=this._originalActions,this._originalActions=null);var a=this.actions.filter(function(a){return!a.temporary},this),b=a,c=this.selectedFeature.popupTemplate;if(c&&c.actions){for(var b=c.actions,h=0;h<b.length;h++)b.getItemAt(h).temporary=!0;c.overwriteActions?this._originalActions=a:b=a.concat(b)}this.actions=b},_getPointFromGeometry:function(a){switch(a&&a.type){case "point":return a;case "extent":return a.center;
case "polygon":return a.centroid;case "multipoint":case "polyline":return a.extent.center;default:return null}},_locationWatcher:function(a,b){var c=this.get("view.extent");this.updateLocationEnabled&&c&&a&&a!==b&&!p.contains(c,a)&&this.centerAtLocation()},_visibleWatcher:function(a){this._handles.remove("highlight")},_highlightFeature:function(a,b){this._handles.remove("highlight");if(a&&b&&this.highlightEnabled){var c=a.layer;if(c&&(b=u(c,b))&&"function"===typeof b.highlight){var c=c.objectIdField,
h=a.attributes;a=b.highlight(h&&h[c]||a);this._handles.add(a,"highlight")}}},_selectedFeatureChange:function(a,b){this._highlightFeature(a,this.view);a&&(b&&(this.location=this._getPointFromGeometry(a.geometry)),this._getSelectedFeatureActions())},_updateFeatureCount:function(a){var b=0;a&&a.length&&(b=a.length);this._set("featureCount",b)},_updateFeatures:function(a,b){a&&this.promises&&!(!this._validatePromise(a)||b instanceof f||b instanceof Error)&&b&&b.length&&(a={},this.features&&this.features.length?
(b=b.filter(function(a){return-1===this.features.indexOf(a)},this),a.features=this.features.concat(b)):(a.features=b,a.selectedFeatureIndex=0),this.set(a))},_validatePromise:function(a){return-1<this.promises.indexOf(a)}})})},"esri/geometry/geometryEngine":function(){define("require exports ../kernel ./Geometry ./Polygon ./Polyline ./Point ./Extent ./Multipoint dojo/_base/lang".split(" "),function(B,r,f,a,b,c,t,p,h,l){function q(k){if(void 0===t.fromJson){if(void 0!==k.x&&void 0!==k.y)return new t(k);
if(void 0!==k.paths)return new c(k);if(void 0!==k.rings)return new b(k);if(void 0!==k.points)return new h(k);if(void 0!==k.xmin&&void 0!==k.ymin&&void 0!==k.xmax&&void 0!==k.ymax)return new p(k)}else{if(void 0!==k.x&&void 0!==k.y)return t.fromJson(k);if(void 0!==k.paths)return c.fromJson(k);if(void 0!==k.rings)return b.fromJson(k);if(void 0!==k.points)return h.fromJson(k);if(void 0!==k.xmin&&void 0!==k.ymin&&void 0!==k.xmax&&void 0!==k.ymax)return p.fromJson(k)}}function y(k){if(void 0===t.fromJson){if(void 0!==
k.x&&void 0!==k.y)return new t(k);if(void 0!==k.paths)return new c(k);if(void 0!==k.rings)return new b(k);if(void 0!==k.points)return new h(k);if(void 0!==k.xmin&&void 0!==k.ymin&&void 0!==k.xmax&&void 0!==k.ymax)return new p(k)}else{if(void 0!==k.x&&void 0!==k.y)return t.fromJSON(k);if(void 0!==k.paths)return c.fromJSON(k);if(void 0!==k.rings)return b.fromJSON(k);if(void 0!==k.points)return h.fromJSON(k);if(void 0!==k.xmin&&void 0!==k.ymin&&void 0!==k.xmax&&void 0!==k.ymax)return p.fromJSON(k)}}
function z(k,a){var b;if(null==k||void 0===k||"number"===typeof k)return k;var e=k.toString();if(""===e)return null;if(2==a){if(b=O[e],void 0!==b)return b}else if(0==a){b=P[e];if(void 0!==b)return b;b=T[k];if(void 0!==b)return b}else if(3==a&&(b=P[e],void 0!==b))return b;if(1==a&&(b=T[k],void 0!==b))return b;if(!0===/^\d+$/.test(e))return parseInt(e);throw Error("Unrecognised Unit Type");}function w(k){if(void 0!==k&&null!==k)switch(k){case "loxodrome":return 1;case "great-elliptic":return 2;case "normal-section":return 3;
case "shape-preserving":return 4}return 0}function u(k,a){if(null===k||void 0===k||k.s())return null;switch(k.D()){case x.Xn.Point:var n=new t(k.lk(),k.mk(),a);if(Q){var e=k.hasAttribute(x.xf.M);k.hasAttribute(x.xf.Z)&&n.set("z",k.lO());e&&n.set("m",k.NN())}return n;case x.Xn.Polygon:var n=k.hasAttribute(x.xf.Z),e=k.hasAttribute(x.xf.M),d=C(k,n,e),n=new b({rings:d,hasZ:n,hasM:e});Q?n.set("spatialReference",a):n.setSpatialReference(a);n.setCacheValue("_geVersion",k);return n;case x.Xn.Polyline:return n=
k.hasAttribute(x.xf.Z),e=k.hasAttribute(x.xf.M),d=C(k,n,e),n=new c({paths:d,hasZ:n,hasM:e}),Q?n.set("spatialReference",a):n.setSpatialReference(a),n.setCacheValue("_geVersion",k),n;case x.Xn.MultiPoint:var n=k.hasAttribute(x.xf.Z),e=k.hasAttribute(x.xf.M),g=d=null;n&&(d=k.mc(x.xf.Z));e&&(g=k.mc(x.xf.M));var m=new x.b,v=k.F();a=new h(a);Q&&(a.set("hasZ",n),a.set("hasM",e));for(var D=0;D<v;D++){k.w(D,m);var L=[m.x,m.y];n&&L.push(d.get(D));e&&L.push(g.get(D));a.addPoint(L)}a.setCacheValue("_geVersion",
k);return a;case x.Xn.Envelope:return d=k.hasAttribute(x.xf.Z),n=k.hasAttribute(x.xf.M),e=new p(k.R.v,k.R.C,k.R.B,k.R.G,a),Q&&(d&&(d=k.Ah(x.xf.Z,0),e.set("zmin",d.qa),e.set("zmax",d.va)),n&&(d=k.Ah(x.xf.M,0),e.set("mmin",d.qa),e.set("mmax",d.va))),e.setCacheValue("_geVersion",k),e}return null}function C(k,a,b){var e=[],d=k.ea(),g=null,m=null;a&&(g=k.mc(x.xf.Z));b&&(m=k.mc(x.xf.M));for(var v=new x.b,D=0;D<d;D++){for(var L=k.Ea(D),c=k.Ha(D),Z=0,n=0,h=NaN,l=NaN,q=NaN,u=NaN,f=k.vc(D),A=[],p=L;p<L+c;p++){k.w(p,
v);var u=q=NaN,w=[v.x,v.y];a&&(q=g.get(p),w.push(q));b&&(u=m.get(p),w.push(u));p==L&&f&&(Z=v.x,n=v.y,h=q,l=u);A.push(w)}!f||Z==v.x&&n==v.y&&(!a||isNaN(h)&&isNaN(q)||h==q)&&(!b||isNaN(l)&&isNaN(u)||l==u)||A.push(A[0].slice(0));e.push(A)}return e}function E(k){var a=k._geVersion;if(null==a||void 0==a){if(Object.freeze&&Object.isFrozen(k))return 102100===k.wkid?W:4326===k.wkid?U:a=x.Nf.create(k.wkid);-1!=k.wkid&&null!==k.wkid&&void 0!==k.wkid?(a=x.Nf.create(k.wkid),k._geVersion=a):""!==k.wkt&&void 0!==
k.wkt&&null!==k.wkt&&(a=x.Nf.NL(k.wkt),k._geVersion=a)}return a}function G(k){if(null==k)return null;var a=k.getCacheValue("_geVersion");if(null==a||void 0==a)a=x.Pb.IL(k),k.setCacheValue("_geVersion",a);return a}function n(k){return null===k.spatialReference?null:E(k.spatialReference)}var A=this&&this.__extends||function(k,a){function b(){this.constructor=k}for(var e in a)a.hasOwnProperty(e)&&(k[e]=a[e]);k.prototype=null===a?Object.create(a):(b.prototype=a.prototype,new b)},x;(function(k){var a=
function(){function e(){}e.Sk=!1;e.it=!1;e.$v="";return e}();k.ah=a;if("undefined"!==typeof window)k.ah.$v="browser","Float64Array"in window&&(k.ah.it=!0),"ArrayBuffer"in window&&(k.ah.Sk=!0);else if("undefined"!==typeof process)a.$v="node",k.ah.Sk=!0,k.ah.it=!0;else{a.$v="browser";try{var b=new ArrayBuffer(0);new Uint8Array(b);k.ah.Sk=!0;k.ah.it=!0}catch(e){k.ah.Sk=!1}}})(x||(x={}));(function(k){(function(k){k[k.Unknown=0]="Unknown";k[k.Point=33]="Point";k[k.Line=322]="Line";k[k.Envelope=197]="Envelope";
k[k.MultiPoint=550]="MultiPoint";k[k.Polyline=1607]="Polyline";k[k.Polygon=1736]="Polygon"})(k.Xn||(k.Xn={}));(function(k){k[k.enumMild=0]="enumMild";k[k.enumMedium=1]="enumMedium";k[k.enumHot=2]="enumHot"})(k.rH||(k.rH={}));var a=function(){function a(){this.description=null;this.Ux=0}a.prototype.D=function(){return 0};a.prototype.fb=function(){return-1};a.prototype.Qf=function(e){this.qc();e!=this.description&&this.nm(e)};a.prototype.nm=function(){};a.prototype.Ik=function(e){this.qc();e!=this.description&&
(e=k.Od.QN(this.description,e),e!=this.description&&this.nm(e))};a.prototype.hasAttribute=function(e){return this.description.hasAttribute(e)};a.prototype.Ne=function(e){this.qc();this.description.hasAttribute(e)||(e=k.Od.PN(this.description,e),this.nm(e))};a.prototype.Ah=function(){return null};a.prototype.Fp=function(){};a.prototype.o=function(){};a.prototype.Cn=function(){};a.prototype.dd=function(e){this.o(e)};a.prototype.s=function(){return!0};a.prototype.Ja=function(){};a.prototype.Oe=function(){};
a.prototype.Pa=function(){return null};a.prototype.copyTo=function(){};a.prototype.Mh=function(){return 0};a.prototype.$b=function(){return 0};a.prototype.WC=function(){return this.hasAttribute(1)};a.ve=function(e){return((e&192)>>6)+1>>1};a.Km=function(e){return 0!=(e&32)};a.qT=function(e){return 0!=(e&64)};a.SO=function(e){return 0!=(e&128)};a.Lc=function(e){return 0!=(e&256)};a.Th=function(e){return 0!=(e&512)};a.Kc=function(e){return 0!=(e&1024)};a.prototype.vm=function(){var e=this.Pa();this.copyTo(e);
return e};a.prototype.Rf=function(){return null};a.Yj=function(e){var d=e.Pa();e.copyTo(d);return d};a.prototype.qc=function(){0<=this.Ux&&(this.Ux+=2147483649)};a.Vu=function(e){var d=e.D();if(a.Th(d))return e.F();if(e.s())return 0;if(197==d)return 4;if(33==d)return 1;if(a.Lc(d))return 2;throw k.g.ra("missing type");};return a}();k.T=a})(x||(x={}));(function(k){var a=function(){function a(){this.y=this.x=0}a.Oa=function(e,d){var g=new a;g.x=e;g.y=d;return g};a.prototype.ma=function(e,d){this.x=e;
this.y=d};a.prototype.J=function(e){this.x=e.x;this.y=e.y};a.prototype.Cq=function(e,d){return this.x===e&&this.y===d};a.prototype.Ww=function(e){return 2.220446049250313E-16>=Math.abs(this.x-e.x)&&2.220446049250313E-16>=Math.abs(this.y-e.y)};a.prototype.ub=function(e){return this.x===e.x&&this.y===e.y};a.prototype.lc=function(e){return e==this?!0:e instanceof a?this.x==e.x&&this.y==e.y:!1};a.prototype.sub=function(e){this.x-=e.x;this.y-=e.y};a.prototype.pc=function(e,d){this.x=e.x-d.x;this.y=e.y-
d.y};a.prototype.add=function(e,d){void 0!==d?(this.x=e.x+d.x,this.y=e.y+d.y):(this.x+=e.x,this.y+=e.y)};a.prototype.Bp=function(){this.x=-this.x;this.y=-this.y};a.prototype.qr=function(e){this.x=-e.x;this.y=-e.y};a.prototype.OO=function(e,d,g){this.x=e.x*(1-g)+d.x*g;this.y=e.y*(1-g)+d.y*g};a.prototype.Fr=function(e,d){this.x=this.x*e+d.x;this.y=this.y*e+d.y};a.prototype.DR=function(e,d,g){this.x=d.x*e+g.x;this.y=d.y*e+g.y};a.prototype.scale=function(e){this.x*=e;this.y*=e};a.prototype.compare=function(e){return this.y<
e.y?-1:this.y>e.y?1:this.x<e.x?-1:this.x>e.x?1:0};a.prototype.normalize=function(){var e=this.length();0==e&&(this.x=1,this.y=0);this.x/=e;this.y/=e};a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.prototype.Up=function(){return this.x*this.x+this.y*this.y};a.Fb=function(e,d){return Math.sqrt(this.Zb(e,d))};a.Yv=function(e,d,g,m){e-=g;d-=m;return Math.sqrt(e*e+d*d)};a.prototype.ml=function(e){return this.x*e.x+this.y*e.y};a.prototype.uA=function(e){return Math.abs(this.x*
e.x)+Math.abs(this.y*e.y)};a.prototype.Ai=function(e){return this.x*e.y-this.y*e.x};a.prototype.Er=function(e,d){var g=-this.x*d+this.y*e;this.x=this.x*e+this.y*d;this.y=g};a.prototype.tt=function(){var e=this.x;this.x=-this.y;this.y=e};a.prototype.zD=function(e){this.x=-e.y;this.y=e.x};a.prototype.Kp=function(){var e=this.x;this.x=this.y;this.y=-e};a.prototype.FA=function(){this.y=this.x=NaN};a.prototype.pv=function(){return isNaN(this.x)};a.prototype.ps=function(){return 0<this.x?0<=this.y?1:4:
0<this.y?2:0==this.x?4:3};a.cq=function(e,d){var g=e.ps(),m=d.ps();return m==g?(g=e.Ai(d),0>g?1:0<g?-1:0):g<m?-1:1};a.HT=function(e,d){return a.cq(e,d)};a.Zb=function(e,d){var g=e.x-d.x;e=e.y-d.y;return g*g+e*e};a.prototype.toString=function(){return"("+this.x+" , "+this.y+")"};a.prototype.Eh=function(){this.y=this.x=NaN};a.prototype.yJ=function(){return this.pv()?NaN:Math.abs(this.x)>=Math.abs(this.y)?Math.abs(this.x):Math.abs(this.y)};a.prototype.offset=function(e,d){var g=a.Fb(e,d),m=a.Oa(this.x,
this.y);if(0==g)return a.Fb(m,e);var v=new a;v.J(d);v.sub(e);m.sub(e);return m.Ai(v)/g};a.yn=function(e,d,g){var m=new k.$k;m.set(d.x);m.sub(e.x);var v=new k.$k;v.set(g.y);v.sub(e.y);var D=new k.$k;D.set(d.y);D.sub(e.y);var L=new k.$k;L.set(g.x);L.sub(e.x);m.Ap(v);D.Ap(L);m.sub(D);if(!m.Dq())return g=m.value(),0>g?-1:0<g?1:0;m=new k.Tn(d.x);v=new k.Tn(e.x);D=new k.Tn(e.y);m=m.nr(v);e=new k.Tn(g.y);e=e.nr(D);d=new k.Tn(d.y);d=d.nr(D);g=new k.Tn(g.x);g=g.nr(v);m=m.Wp(e);d=d.Wp(g);m=m.Wp(d);return m.vP()?
-1:m.nO()?1:0};a.prototype.hc=function(){return k.I.Rh(k.I.Rh())};return a}();k.b=a})(x||(x={}));(function(k){var a=function(){function k(e){this.Ov=this.Or=0;this.ES=e}k.prototype.reset=function(){this.Ov=this.Or=0};k.prototype.add=function(e){e-=this.Ov;var d=this.Or+e;this.Ov=d-this.Or-e;this.Or=d};k.prototype.sub=function(e){this.add(-e)};k.prototype.rl=function(){return this.ES+this.Or};return k}();k.av=a;a=function(){function k(){}k.LT=function(e,d){return 0<=d?Math.abs(e):-Math.abs(e)};k.sign=
function(e){return 0>e?-1:0<e?1:0};k.gH=function(e){return e-360*Math.floor(e/360)};k.round=function(e){return Math.floor(e+.5)};k.Ty=function(e){return e*e};k.ut=function(e,d,g){var m;.5>=g?m=e+(d-e)*g:m=d-(d-e)*(1-g);return m};k.BD=function(e,d,g,m){.5>=g?(m.x=e.x+(d.x-e.x)*g,m.y=e.y+(d.y-e.y)*g):(m.x=d.x-(d.x-e.x)*(1-g),m.y=d.y-(d.y-e.y)*(1-g))};k.tP=function(e,d,g,m,v,D){.5>=v?(D.x=e+(g-e)*v,D.y=d+(m-d)*v):(D.x=g-(g-e)*(1-v),D.y=m-(m-d)*(1-v))};return k}();k.vi=a})(x||(x={}));(function(k){var a=
function(a){function e(){a.call(this);this.ha=this.la=this.ja=this.na=0;this.fa=null}A(e,a);e.prototype.Mb=function(){return k.b.Oa(this.na,this.ja)};e.prototype.ht=function(d){d.x=this.na;d.y=this.ja};e.prototype.ed=function(d){this.gl(0,d)};e.prototype.Ny=function(d,g){this.gl(0,k.b.Oa(d,g))};e.prototype.En=function(d){this.wA(0,d)};e.prototype.setStart=function(d){this.CA(0,d)};e.prototype.gt=function(d,g){return this.yd(0,d,g)};e.prototype.My=function(d,g,e){this.om(0,d,g,e)};e.prototype.oc=function(){return k.b.Oa(this.la,
this.ha)};e.prototype.uw=function(d){d.x=this.la;d.y=this.ha};e.prototype.vd=function(d){this.gl(1,d)};e.prototype.Ok=function(d,g){this.gl(1,k.b.Oa(d,g))};e.prototype.Bn=function(d){this.wA(1,d)};e.prototype.setEnd=function(d){this.CA(1,d)};e.prototype.Ws=function(d,g){return this.yd(1,d,g)};e.prototype.Cy=function(d,g,e){this.om(1,d,g,e)};e.prototype.fb=function(){return 1};e.prototype.s=function(){return this.sc()};e.prototype.Ja=function(){};e.prototype.Mh=function(){return 0};e.prototype.Ga=
function(d,g,e,v,D){return this.wJ(d,g,e,v,D)};e.prototype.jc=function(d,g){return 0!=this.fq(d,g,!1)};e.prototype.Eq=function(d,g){return this.qs(d,g,!1)};e.prototype.qs=function(){return null};e.prototype.sc=function(){return!1};e.prototype.rv=function(d){this.qc();if(null==this.fa&&0<d)this.fa=k.I.Lh(2*d);else if(null!=this.fa&&this.fa.length<2*d){for(var g=this.fa.slice(0),e=this.fa.length;e<2*d;e++)g[e]=0;this.fa=g}};e.KI=function(d,g,e){if(0<e)var m=0;for(var D=0;D<e;D++)g[0+m]=d[0],m++};e.prototype.gl=
function(d,g){0!=d?(this.la=g.x,this.ha=g.y):(this.na=g.x,this.ja=g.y)};e.prototype.nm=function(d){if(null!=this.fa){for(var g=k.Od.iu(d,this.description),m=[],v=e.Xk(this.description,0),D=e.Xk(this.description,1),L=e.Xk(d,0),a=e.Xk(d,1),b=0,c=1,n=d.Aa;c<n;c++){var h=d.Hd(c),l=k.pa.Wa(h);if(-1==g[c])for(var q=k.pa.ue(h),h=0;h<l;h++)m[L+b]=q,m[a+b]=q,b++;else for(q=this.description.fj(g[c])-2,h=0;h<l;h++)m[L+b]=this.fa[v+q],m[a+b]=this.fa[D+q],b++,q++}this.fa=m}this.description=d};e.prototype.wA=function(d,
g){if(this.sc())throw k.g.ra("empty geometry");g.Qf(this.description);g.sc()&&g.ko();for(var e=0;e<this.description.Aa;e++)for(var v=this.description.Fd(e),D=0,L=k.pa.Wa(v);D<L;D++){var a=this.yd(d,v,D);g.setAttribute(v,D,a)}};e.prototype.CA=function(d,g){this.qc();if(g.sc())throw k.g.ra("empty geometry");for(var e=g.description,v=0,D=e.Aa;v<D;v++)for(var L=e.Fd(v),a=k.pa.Wa(L),b=0;b<a;b++){var c=g.ld(L,b);this.om(d,L,b,c)}};e.prototype.yd=function(d,g,m){if(this.sc())throw k.g.ra("This operation was performed on an Empty Geometry.");
if(0==g)return 0!=d?0!=m?this.ha:this.la:0!=m?this.ja:this.na;if(m>=k.pa.Wa(g))throw k.g.Uc();var v=this.description.zf(g);return 0<=v?(null!=this.fa&&this.rv(this.description.le.length-2),this.fa[e.Xk(this.description,d)+this.description.fj(v)-2+m]):k.pa.ue(g)};e.prototype.om=function(d,g,m,v){this.qc();if(m>=k.pa.Wa(g))throw k.g.Uc();var D=this.description.zf(g);0>D&&(this.Ne(g),D=this.description.zf(g));0==g?0!=d?0!=m?this.ha=v:this.la=v:0!=m?this.ja=v:this.na=v:(null==this.fa&&this.rv(this.description.le.length-
2),this.fa[e.Xk(this.description,d)+this.description.fj(D)-2+m]=v)};e.prototype.copyTo=function(d){if(d.D()!=this.D())throw k.g.N();d.description=this.description;d.rv(this.description.le.length-2);e.KI(this.fa,d.fa,2*(this.description.le.length-2));d.na=this.na;d.ja=this.ja;d.la=this.la;d.ha=this.ha;d.qc();this.eo(d)};e.prototype.Ah=function(d,g){var e=new k.Nd;if(this.sc())return e.Ja(),e;e.qa=this.yd(0,d,g);e.va=e.qa;e.Oj(this.yd(1,d,g));return e};e.prototype.XE=function(d){this.sc()?d.Ja():(d.qa=
this.yd(0,0,0),d.va=d.qa,d.Oj(this.yd(1,0,0)))};e.prototype.uu=function(d,g){g.Qf(this.description);g.ic(this.Kb(d));for(var e=1,v=this.description.Aa;e<v;e++)for(var D=this.description.Fd(e),L=k.pa.Wa(D),a=0;a<L;a++){var b=this.ld(d,D,a);g.setAttribute(D,a,b)}};e.prototype.sJ=function(d){if(this.description!=d.description||this.na!=d.na||this.la!=d.la||this.ja!=d.ja||this.ha!=d.ha)return!1;for(var g=0;g<2*(this.description.le.length-2);g++)if(this.fa[g]!=d.fa[g])return!1;return!0};e.prototype.kD=
function(){return this.na==this.la&&this.ja==this.ha};e.prototype.reverse=function(){var d=this.na;this.na=this.la;this.la=d;d=this.ja;this.ja=this.ha;this.ha=d;for(var d=1,g=this.description.Aa;d<g;d++)for(var e=this.description.Hd(d),v=0,D=k.pa.Wa(e);v<D;v++){var L=this.yd(0,e,v),a=this.yd(1,e,v);this.om(0,e,v,a);this.om(1,e,v,L)}};e.prototype.fq=function(d,g,e){var m=d.D();switch(this.D()){case 322:if(322==m)return k.yb.xJ(this,d,g,e);throw k.g.wa();default:throw k.g.wa();}};e.prototype.wJ=function(d,
g,e,v,D){var m=d.D();switch(this.D()){case 322:if(322==m)return k.yb.ov(this,d,g,e,v,D);throw k.g.wa();default:throw k.g.wa();}};e.prototype.kv=function(){return null};e.Xk=function(d,g){return g*(d.le.length-2)};e.prototype.Kb=function(d,g){if(void 0===g)return g=new k.b,this.Kb(d,g),g;k.vi.tP(this.na,this.ja,this.la,this.ha,d,g)};e.prototype.Gd=function(){return null};e.prototype.TC=function(){return null};e.prototype.nt=function(){return null};e.prototype.mg=function(){return null};e.prototype.mD=
function(){return null};e.prototype.Pf=function(){return null};e.prototype.rA=function(d,g){return void 0!==g?this.Ru(g)-this.Ru(d):this.Ru(d)};e.prototype.eo=function(){};e.prototype.xm=function(){return null};e.prototype.Bi=function(){};e.prototype.ld=function(){return null};e.prototype.xe=function(){return null};e.prototype.Ru=function(){return null};e.prototype.AD=function(){return null};e.prototype.Fb=function(d,g){if(!g&&0!=this.fq(d,0,!1))return 0;g=1.7976931348623157E308;var e,v;e=this.Mb();
v=d.Gd(e,!1);e.sub(d.Kb(v));e=e.length();e<g&&(g=e);e=this.oc();v=d.Gd(e,!1);e.sub(d.Kb(v));e=e.length();e<g&&(g=e);e=d.Mb();v=this.Gd(e,!1);e.sub(this.Kb(v));e=e.length();e<g&&(g=e);e=d.oc();v=this.Gd(e,!1);e.sub(this.Kb(v));e=e.length();e<g&&(g=e);return g};e.prototype.Rf=function(){return k.Hh.il(this,null)};return e}(k.T);k.fA=a})(x||(x={}));new x.b;(function(k){(function(k){k[k.Unknown=-1]="Unknown";k[k.Not=0]="Not";k[k.Weak=1]="Weak";k[k.Strong=2]="Strong"})(k.tH||(k.tH={}));(function(k){k[k.DirtyIsKnownSimple=
1]="DirtyIsKnownSimple";k[k.IsWeakSimple=2]="IsWeakSimple";k[k.IsStrongSimple=4]="IsStrongSimple";k[k.DirtyOGCFlags=8]="DirtyOGCFlags";k[k.DirtyVerifiedStreams=32]="DirtyVerifiedStreams";k[k.DirtyExactIntervals=64]="DirtyExactIntervals";k[k.DirtyLooseIntervals=128]="DirtyLooseIntervals";k[k.DirtyIntervals=192]="DirtyIntervals";k[k.DirtyIsEnvelope=256]="DirtyIsEnvelope";k[k.DirtyLength2D=512]="DirtyLength2D";k[k.DirtyRingAreas2D=1024]="DirtyRingAreas2D";k[k.DirtyCoordinates=1993]="DirtyCoordinates";
k[k.DirtyAllInternal=65535]="DirtyAllInternal";k[k.DirtyAll=16777215]="DirtyAll"})(k.cH||(k.cH={}));var a=function(a){function e(){a.call(this);this.El=65535;this.ta=0;this.rg=-1;this.pb=null}A(e,a);e.prototype.eo=function(){};e.prototype.qv=function(){};e.prototype.xv=function(){};e.prototype.F=function(){return this.ta};e.prototype.s=function(){return this.sc()};e.prototype.sc=function(){return 0==this.ta};e.prototype.gj=function(d){return 0!=(this.El&d)};e.prototype.yf=function(d,g){this.El=g?
this.El|d:this.El&~d};e.prototype.kc=function(){this.gj(32)&&this.FJ()};e.prototype.Su=function(){if(this.sc())throw k.g.ra("This operation was performed on an Empty Geometry.");};e.prototype.Sd=function(d,g){if(0>d||d>=this.ta)throw k.g.ra("index out of bounds");this.kc();g.Qf(this.description);g.s()&&g.ko();for(var e=0;e<this.description.Aa;e++)for(var v=this.description.Fd(e),D=0,L=k.pa.Wa(v);D<L;D++){var a=this.Ba[e].Bh(L*d+D);g.setAttribute(v,D,a)}};e.prototype.Iu=function(d,g){this.kc();for(var e=
g.description,v=0;v<e.Aa;v++)for(var D=e.Fd(v),L=k.pa.Wa(D),a=0;a<L;a++){var b=g.ld(D,a);this.setAttribute(D,d,a,b)}};e.prototype.w=function(d,g){if(0>d||d>=this.F())throw k.g.Uc();this.kc();this.Ba[0].ec(2*d,g)};e.prototype.Fa=function(d){var g=new k.b;this.w(d,g);return g};e.prototype.uc=function(d,g){this.Ba[0].ec(2*d,g)};e.prototype.ic=function(d,g,e){if(0>d||d>=this.ta)throw k.g.Uc();this.kc();var m=this.Ba[0];void 0!==e?(m.write(2*d,g),m.write(2*d+1,e)):m.Rn(2*d,g);this.ce(1993)};e.prototype.Lw=
function(d){if(0>d||d>=this.F())throw k.g.Uc();this.kc();var g=this.Ba[0],e=new k.ee;e.x=g.read(2*d);e.y=g.read(2*d+1);e.z=this.hasAttribute(1)?this.Ba[1].Bh(d):k.pa.ue(1);return e};e.prototype.Py=function(d,g){if(0>d||d>=this.F())throw k.g.Uc();this.Ne(1);this.kc();this.ce(1993);var e=this.Ba[0];e.write(2*d,g.x);e.write(2*d+1,g.y);this.Ba[1].Uk(d,g.z)};e.prototype.ld=function(d,g,e){if(0>g||g>=this.ta)throw k.g.Uc();var m=k.pa.Wa(d);if(e>=m)throw k.g.Uc();this.kc();var D=this.description.zf(d);return 0<=
D?this.Ba[D].Bh(g*m+e):k.pa.ue(d)};e.prototype.nC=function(d,g,e){return this.ld(d,g,e)};e.prototype.setAttribute=function(d,g,e,v){if(0>g||g>=this.ta)throw k.g.Uc();var m=k.pa.Wa(d);if(e>=m)throw k.g.Uc();this.Ne(d);this.kc();d=this.description.zf(d);this.ce(1993);this.Ba[d].Uk(g*m+e,v)};e.prototype.mc=function(d){this.Su();this.Ne(d);this.kc();return this.Ba[this.description.zf(d)]};e.prototype.bm=function(d,g){if(null!=g&&k.pa.Qh(d)!=g.Qh())throw k.g.N();this.Ne(d);d=this.description.zf(d);null==
this.Ba&&(this.Ba=k.Ac.ay(this.description.Aa));this.Ba[d]=g;this.ce(16777215)};e.prototype.nm=function(d){var g=null;if(null!=this.Ba)for(var e=k.Od.iu(d,this.description),g=[],v=0,D=d.Aa;v<D;v++)-1!=e[v]&&(g[v]=this.Ba[e[v]]);this.description=d;this.Ba=g;this.rg=-1;this.ce(16777215)};e.prototype.IA=function(d){this.ss(!0);d instanceof k.i?this.R.o(d):this.R.Cn(d)};e.prototype.EJ=function(d){this.ss(!1);d instanceof k.i?this.R.o(d):this.R.Cn(d)};e.prototype.Fp=function(d){this.ss(!0);this.R.copyTo(d)};
e.prototype.o=function(d){this.IA(d)};e.prototype.Cn=function(d){this.IA(d)};e.prototype.dd=function(d){this.EJ(d)};e.prototype.Ah=function(d,g){var e=new k.Nd;if(this.sc())return e.Ja(),e;this.ss(!0);return this.R.Ah(d,g)};e.prototype.hc=function(){var d=this.description.hc();if(!this.sc())for(var g=this.F(),e=0,v=this.description.Aa;e<v;e++)d=this.Ba[e].jj(d,0,g*k.pa.Wa(this.description.Fd(e)));return d};e.prototype.lc=function(d){if(d==this)return!0;if(!(d instanceof e&&this.description.lc(d.description))||
this.sc()!=d.sc())return!1;if(this.sc())return!0;var g=this.F();if(g!=d.F())return!1;for(var m=0;m<this.description.Aa;m++){var v=this.description.Hd(m),D=this.mc(v),L=d.mc(v);if(!D.lc(L,0,g*k.pa.Wa(v)))return!1}return!0};e.prototype.copyTo=function(d){if(d.D()!=this.D())throw k.g.N();this.tA(d)};e.prototype.tA=function(d){this.kc();d.description=this.description;d.Ba=null;var g=this.description.Aa,e=null;if(null!=this.Ba)for(var e=[],v=0;v<g;v++)null!=this.Ba[v]&&(e[v]=this.Ba[v].Ip(this.F()*k.pa.Wa(this.description.Fd(v))));
null!=this.R?(d.R=this.R.Pa(),this.R.copyTo(d.R)):d.R=null;d.ta=this.ta;d.El=this.El;d.Ba=e;try{this.eo(d)}catch(D){throw d.Ja(),k.g.BI();}};e.prototype.EA=function(){this.ta=0;this.rg=-1;this.Ba=null;this.ce(16777215)};e.prototype.ce=function(d){16777215==d&&(this.rg=-1,this.qv());this.El|=d;this.kJ();this.qc()};e.prototype.ss=function(d){this.kc();if(this.gj(192))if(null==this.R?this.R=new k.Vj(this.description):this.R.Qf(this.description),this.s())this.R.Ja();else{this.wv(d);for(var g=1;g<this.description.Aa;g++)for(var e=
this.description.Fd(g),v=k.pa.Wa(e),D=this.Ba[g],L=0;L<v;L++){var a=new k.Nd;a.Ja();for(var b=0;b<this.ta;b++){var c=D.Bh(b*v+L);a.Db(c)}this.R.setInterval(e,L,a)}d&&this.yf(192,!1)}};e.prototype.wv=function(){this.R.Ja();for(var d=this.Ba[0],g=new k.b,e=0;e<this.ta;e++)d.ec(2*e,g),this.R.Db(g)};e.prototype.tm=function(d){d.Ja();for(var g=this.Ba[0],e=new k.b,v=0;v<this.ta;v++)g.ec(2*v,e),d.Db(e)};e.prototype.FJ=function(){if(this.rg<this.ta){null==this.Ba&&(this.Ba=k.Ac.ay(this.description.Aa));
this.rg=2147483647;for(var d=0;d<this.description.Aa;d++){var g=this.description.Fd(d);if(null!=this.Ba[d]){var e=k.pa.Wa(g),v=k.I.truncate(this.Ba[d].size/e);v<this.ta&&(v=k.I.truncate(this.rg>this.ta+5?(5*this.ta+3)/4:this.ta),this.Ba[d].resize(v*e,k.pa.ue(g)));v<this.rg&&(this.rg=v)}else this.Ba[d]=k.Ac.Tv(g,this.ta),this.rg=this.ta}}this.xv();this.yf(32,!1)};e.prototype.jo=function(d){if(0>d)throw k.g.N();d!=this.ta&&(this.ta=d,this.ce(65535))};e.prototype.rj=function(d){if(!this.gj(1)){if(!this.gj(2))return 0;
if(this.TP>=d)return this.gj(8)?1:2}return-1};e.prototype.hg=function(d,g){this.TP=g;if(-1==d)this.yf(1,!0),this.yf(8,!0);else if(this.yf(1,!1),this.yf(8,!0),0==d)this.yf(2,!1),this.yf(4,!1);else if(1==d)this.yf(2,!0),this.yf(4,!1);else if(2==d)this.yf(2,!0),this.yf(4,!0);else throw k.g.ra("internal error.");};e.prototype.kJ=function(){null!=this.pb&&(this.pb=null)};e.prototype.vJ=function(d,g,e,v){if(0>d||d>=this.ta)throw k.g.ra("index out of bounds");if(0>g||g>=this.ta)throw k.g.ra("index out of bounds");
this.kc();v.Qf(this.description);v.s()&&v.ko();for(var m=0;m<this.description.Aa;m++)for(var L=this.description.Fd(m),a=0,b=k.pa.Wa(L);a<b;a++){var c=this.Ba[m].Bh(b*d+a),n=this.Ba[m].Bh(b*g+a);v.setAttribute(L,a,k.vi.ut(c,n,e))}};e.prototype.mv=function(d,g){var e=this.Ba[0].f,v=e[2*d]-e[2*g],e=e[2*d+1]-e[2*g+1];return Math.sqrt(v*v+e*e)};e.prototype.bh=function(d,g){if(0>d||d>=this.ta)throw k.g.Uc();if(g.s())throw k.g.N();this.kc();for(var e=g.description,v=0;v<e.Aa;v++)for(var D=e.Hd(v),L=k.pa.Wa(D),
a=0;a<L;a++){var b=g.ld(D,a);this.setAttribute(D,d,a,b)}};e.prototype.jv=function(){return null};e.prototype.dj=function(){return null};return e}(k.T);k.Wr=a})(x||(x={}));(function(k){var a=function(){function a(){this.cb=this.Qm=null;this.Ol=124234251;this.Ct=!0;this.Ae=-1;this.cb=new k.Fc(7);this.Qm=null}a.prototype.Hn=function(e){this.Qm=e};a.prototype.lM=function(){this.Ct=!1};a.prototype.de=function(e){this.cb.de(e)};a.prototype.nq=function(e){var d=this.cb.be();this.mS(d);this.oS(e,d);return d};
a.prototype.fM=function(e){this.cb.Jc(e)};a.prototype.addElement=function(e,d){var g;-1==d?(-1==this.Ae&&(this.Ae=this.nq(-1)),g=this.Ae):g=d;return this.MA(e,0,g)};a.prototype.PA=function(e){-1==this.Ae&&(this.Ae=this.nq(-1));return this.MA(e,1,this.Ae)};a.prototype.qm=function(e){var d;-1==this.Ae&&(this.Ae=this.nq(-1));d=this.Ae;var g=this.cb.f;if(-1==d||-1==g[7*d])return e=this.cb.Pj([-1,-1,-1,e,this.ck(),-1,-1]),g=this.cb.f,g[7*d]=e,this.mo(-1,e,d,g),e;var m=-1==d?-1:g[7*d+2];e=this.cb.Pj([-1,
-1,m,e,this.ck(),-1,-1]);g=this.cb.f;g[7*m+1]=e;this.Fv(e,g);-1===g[7*e+2]&&(g[7*d]=e);this.mo(-1,e,d,g);return e};a.prototype.vs=function(e,d,g,m){var v=-1;-1==v&&(-1==this.Ae&&(this.Ae=this.nq(-1)),v=this.Ae);var D=this.cb.f;if(-1==v||-1==D[7*v])return g=this.cb.Pj([-1,-1,-1,g,this.ck(),-1,-1]),D=this.cb.f,D[7*v]=g,this.mo(-1,g,v,D),g;var a;m?(m=-1!=d?this.Qm.compare(this,g,d):-1,a=-1!=e?this.Qm.compare(this,g,e):1):(m=-1,a=1);if(0==m||0==a)return D[7*v+3]=0==m?d:e,-1;(-1!=d&&-1!=e?this.Ol>k.I.$x(this.Ol)>>
1:-1!=d)?e=d:m=a;for(d=!0;;){if(0>m)if(a=D[7*e],-1!=a)e=a;else{m=e;g=this.cb.Pj([-1,-1,e,g,this.ck(),-1,-1]);D=this.cb.f;D[7*e]=g;break}else if(a=D[7*e+1],-1!=a)e=a;else{m=D[7*e+6];g=this.cb.Pj([-1,-1,e,g,this.ck(),-1,-1]);D=this.cb.f;D[7*e+1]=g;break}d&&(m*=-1,d=!1)}this.Fv(g,D);-1===D[7*g+2]&&(D[7*v]=g);this.mo(m,g,v,D);return g};a.prototype.tC=function(){return this.xN(this.Ae)};a.prototype.kd=function(e,d){d=-1==d?this.Ae:d;this.Ct?this.eM(e,d):this.$S(e,d)};a.prototype.search=function(e,d){for(d=
this.dt(d);-1!=d;){var g=this.Qm.compare(this,e,d);if(0==g)return d;d=0>g?this.ik(d):this.Jo(d)}return-1};a.prototype.GR=function(e){for(var d=this.dt(-1),g=-1;-1!=d;){var m=e.compare(this,d);if(0==m)return d;0>m?d=this.ik(d):(g=d,d=this.Jo(d))}return g};a.prototype.sF=function(e){for(var d=this.dt(-1),g=-1;-1!=d;){var m=e.compare(this,d);if(0==m)return d;0>m?(g=d,d=this.ik(d)):d=this.Jo(d)}return g};a.prototype.da=function(e){return this.cb.O(e,3)};a.prototype.ik=function(e){return this.cb.O(e,0)};
a.prototype.Jo=function(e){return this.cb.O(e,1)};a.prototype.getParent=function(e){return this.cb.O(e,2)};a.prototype.bb=function(e){return this.cb.O(e,6)};a.prototype.ge=function(e){return this.cb.O(e,5)};a.prototype.gc=function(e){return-1==e?this.gk(this.Ae):this.gk(e)};a.prototype.tc=function(e){return-1==e?this.uq(this.Ae):this.uq(e)};a.prototype.hO=function(e){return-1==e?this.QC(this.Ae):this.QC(e)};a.prototype.Vi=function(e,d){this.By(e,d)};a.prototype.dt=function(e){return-1==e?this.MC(this.Ae):
this.MC(e)};a.prototype.clear=function(){this.cb.Nh(!1);this.Ae=-1};a.prototype.size=function(e){return-1==e?this.OC(this.Ae):this.OC(e)};a.prototype.pK=function(e,d){for(var g=d[7*e],m=d[7*e+1],v=d[7*e+4];-1!=g||-1!=m;){var D=-1!=g?d[7*g+4]:2147483647,m=-1!=m?d[7*m+4]:2147483647;if(v<=Math.min(D,m))break;D<=m?this.oF(g,d):this.nF(e,d);g=d[7*e];m=d[7*e+1]}};a.prototype.Fv=function(e,d){if(this.Ct)for(var g=d[7*e+4],m=d[7*e+2];-1!=m&&d[7*m+4]>g;)d[7*m]==e?this.oF(e,d):this.nF(m,d),m=d[7*e+2]};a.prototype.nF=
function(e,d){var g=d[7*e+1],m;d[7*g+2]=d[7*e+2];d[7*e+2]=g;m=d[7*g];d[7*e+1]=m;-1!=m&&(d[7*m+2]=e);d[7*g]=e;m=d[7*g+2];-1!=m&&(d[7*m]==e?d[7*m]=g:d[7*m+1]=g)};a.prototype.oF=function(e,d){var g=d[7*e+2],m;d[7*e+2]=d[7*g+2];d[7*g+2]=e;m=d[7*e+1];d[7*g]=m;-1!=m&&(d[7*m+2]=g);d[7*e+1]=g;m=d[7*e+2];-1!=m&&(d[7*m]===g?d[7*m]=e:d[7*m+1]=e)};a.prototype.Tj=function(e,d){this.cb.L(e,2,d)};a.prototype.Gy=function(e,d){this.cb.L(e,0,d)};a.prototype.Ky=function(e,d){this.cb.L(e,1,d)};a.prototype.Jy=function(e,
d){this.cb.L(e,5,d)};a.prototype.Gu=function(e,d){this.cb.L(e,6,d)};a.prototype.VF=function(e,d){this.cb.L(d,0,e)};a.prototype.mS=function(e){this.cb.L(e,4,0)};a.prototype.oS=function(e,d){this.cb.L(d,5,e)};a.prototype.MC=function(e){return-1==e?-1:this.cb.O(e,0)};a.prototype.gk=function(e){return-1==e?-1:this.cb.O(e,1)};a.prototype.uq=function(e){return-1==e?-1:this.cb.O(e,2)};a.prototype.xN=function(e){return-1==e?-1:this.cb.O(e,3)};a.prototype.OC=function(e){return-1==e?0:this.cb.O(e,4)};a.prototype.QC=
function(e){return this.cb.O(e,5)};a.prototype.ou=function(e){return this.cb.Pj([-1,-1,-1,e,this.ck(),-1,-1])};a.prototype.bk=function(e){-1!=e&&this.cb.Jc(e)};a.prototype.ck=function(){this.Ol=k.I.$x(this.Ol);return this.Ol&1073741823};a.prototype.MA=function(e,d,g){var m=this.cb.f;if(-1==g||-1==m[7*g])return e=this.cb.Pj([-1,-1,-1,e,this.ck(),-1,-1]),m=this.cb.f,m[7*g]=e,this.mo(-1,e,g,m),e;for(var v=-1==g?-1:m[7*g];;){var D=-1==d?1:this.Qm.compare(this,e,v);if(0>D)if(D=this.ik(v),-1!=D)v=D;else{d=
v;e=this.cb.Pj([-1,-1,v,e,this.ck(),-1,-1]);m=this.cb.f;m[7*v]=e;break}else{if(1==d&&0==D)return m[7*g+3]=v,-1;D=m[7*v+1];if(-1!=D)v=D;else{d=m[7*v+6];e=this.cb.Pj([-1,-1,v,e,this.ck(),-1,-1]);m=this.cb.f;m[7*v+1]=e;break}}}this.Fv(e,m);-1===m[7*e+2]&&(m[7*g]=e);this.mo(d,e,g,m);return e};a.prototype.mo=function(e,d,g,m){var v;-1!=e?(v=m[7*e+5],m[7*e+5]=d):v=-1==g?-1:m[7*g+2];m[7*d+5]=v;-1!=v&&(m[7*v+6]=d);m[7*d+6]=e;e==(-1==g?-1:m[7*g+1])&&(m[7*g+1]=d);-1==e&&(m[7*g+2]=d);m[7*g+4]=(-1==g?0:m[7*g+
4])+1};a.prototype.ry=function(e,d){var g=this.cb.f,m=g[7*e+5];e=g[7*e+6];-1!=m?g[7*m+6]=e:g[7*d+1]=e;-1!=e?g[7*e+5]=m:g[7*d+2]=m;g[7*d+4]=-1===d?-1:g[7*d+4]-1};a.prototype.$S=function(e,d){this.ry(e,d);var g=this.ik(e),m=this.Jo(e),v=this.getParent(e),D=e;if(-1!=g&&-1!=m){this.Ol=k.I.$x(this.Ol);var a;a=1073741823<this.Ol?this.bb(e):this.ge(e);var b=this.getParent(a)==e;this.cb.Pu(e,a,0);this.cb.Pu(e,a,1);this.cb.Pu(e,a,2);-1!=v?this.ik(v)==e?this.Gy(v,a):this.Ky(v,a):this.VF(a,d);b?(g==a?(this.Gy(a,
e),this.Tj(m,a)):m==a&&(this.Ky(a,e),this.Tj(g,a)),this.Tj(e,a),v=a):(this.Tj(g,a),this.Tj(m,a),v=this.getParent(e),D=a);g=this.ik(e);m=this.Jo(e);-1!=g&&this.Tj(g,e);-1!=m&&this.Tj(m,e)}g=-1!=g?g:m;-1==v?this.VF(g,d):this.ik(v)==D?this.Gy(v,g):this.Ky(v,g);-1!=g&&this.Tj(g,v);this.bk(e,d)};a.prototype.eM=function(e,d){var g=this.cb.f;g[7*e+4]=2147483647;var m=-1,v=-1,D=-1===d?-1:g[7*d],k=D==e;k&&(m=g[7*D],v=g[7*D+1],-1==m&&-1==v)?(this.ry(D,d),this.bk(D,d),g[7*d]=-1):(this.pK(e,g),D=g[7*e+2],-1!=
D&&(g[7*D]==e?g[7*D]=-1:g[7*D+1]=-1),this.ry(e,d),this.bk(e,d),k&&(g[7*d]=-1==m||-1!=g[7*m+2]?v:m))};a.prototype.By=function(e,d){this.cb.L(e,3,d)};return a}();k.bj=a})(x||(x={}));(function(k){var a=function(){function a(e,d){void 0!==e&&this.K(e,d)}a.prototype.K=function(e,d){this.qa=e;this.va=d;this.normalize()};a.prototype.normalize=function(){if(!isNaN(this.qa)){if(this.qa>this.va){var e=this.qa;this.qa=this.va;this.va=e}isNaN(this.va)&&this.Ja()}};a.prototype.Ja=function(){this.va=this.qa=NaN};
a.prototype.s=function(){return isNaN(this.qa)};a.prototype.Db=function(e){"number"===typeof e?this.s()?this.va=this.qa=e:this.Oj(e):e.s()||(this.s()?(this.qa=e.qa,this.va=e.va):(this.qa>e.qa&&(this.qa=e.qa),this.va<e.va&&(this.va=e.va),this.qa>this.va&&this.Ja()))};a.prototype.Oj=function(e){e<this.qa?this.qa=e:e>this.va&&(this.va=e)};a.prototype.contains=function(e){return"number"===typeof e?e>=this.qa&&e<=this.va:e.qa>=this.qa&&e.va<=this.va};a.prototype.Ga=function(e){this.s()||e.s()?this.Ja():
(this.qa<e.qa&&(this.qa=e.qa),this.va>e.va&&(this.va=e.va),this.qa>this.va&&this.Ja())};a.prototype.P=function(e){this.s()||(this.qa-=e,this.va+=e,this.va<this.qa&&this.Ja())};a.prototype.lv=function(){return this.s()?2.220446049250313E-14:2.220446049250313E-14*(Math.abs(this.qa)+Math.abs(this.va)+1)};a.prototype.yy=function(e,d){e>d?(this.qa=d,this.va=e):(this.qa=e,this.va=d)};a.prototype.Sy=function(e){return k.I.Kr(e,this.qa,this.va)};a.prototype.aa=function(){return this.va-this.qa};a.prototype.Af=
function(){return.5*(this.qa+this.va)};a.prototype.lc=function(e){return e==this?!0:e instanceof a?this.s()&&e.s()?!0:this.qa!=e.qa||this.va!=e.va?!1:!0:!1};a.prototype.hc=function(){return k.I.Rh(k.I.Rh())};return a}();k.Nd=a})(x||(x={}));(function(k){var a=new k.Nd,b=new k.Nd,e=function(){return function(){this.Zd=null;this.Lf=-1;this.ib=new k.yb;this.ux=55555555;this.Et=this.Ft=!1;this.$h=new k.Nd;this.$h.yy(0,0)}}();k.XT=e;var d=function(){function d(d,g,D){this.a=d;this.Mj=NaN;this.mE=this.sp=
0;this.nE=NaN;this.ka=g;this.tp=10*g;this.oE=this.pE=NaN;this.Zf=!1;this.Cl=this.mr=this.un=this.gr=this.fr=-1;this.lx=D;this.Rx=new e;this.vE=new e;k.I.truncate(3*d.pd/2)}d.prototype.$C=function(d,g,e,k){d.Zd=null===k?null:k[e[5*g]];d.Et=null!=d.Zd;d.Et||(k=e[5*g+2],-1!==k&&this.a.gR(e[5*g],e[5*k],d.ib),d.Zd=d.ib,d.$h.yy(d.ib.na,d.ib.la),d.$h.va+=this.ka,d.ib.KE(),d.Ft=d.ib.ha==d.ib.ja,d.Ft||(d.ux=(d.ib.la-d.ib.na)/(d.ib.ha-d.ib.ja)))};d.prototype.tL=function(d,g){var e=d.fq(g,this.ka,!0);if(0!=
e)return 2==e?this.aw():this.Oh();d.ht(K);d.uw(J);g.ht(N);g.uw(M);I.ma(this.sp,this.Mj);K.ub(N)&&this.Mj==K.y?0>J.compare(M)?I.J(J):I.J(M):K.ub(M)&&this.Mj==K.y?0>J.compare(N)?I.J(J):I.J(N):N.ub(J)&&this.Mj==N.y?0>K.compare(M)?I.J(K):I.J(M):J.ub(M)&&this.Mj==J.y&&(0>K.compare(N)?I.J(K):I.J(N));return d.xe(I.y,I.x)<g.xe(I.y,I.x)?-1:1};d.prototype.rL=function(d,g){if(d.ib.ja==g.ib.ja&&d.ib.na==g.ib.na)return d.ib.ha==g.ib.ha&&d.ib.la==g.ib.la?this.lx?this.aw():0:this.HB(d,g);if(d.ib.ha==g.ib.ha&&d.ib.la==
g.ib.la)return this.GB(d,g);var e=this.GB(d,g);d=this.HB(d,g);return 0>e&&0>d?-1:0<e&&0<d?1:this.Oh()};d.prototype.mL=function(d,g){if(d.la>g.la){if(g.la>g.na&&g.ha-g.ja<2*this.ka&&d.Kh(g.la,g.ha,this.ka))return this.Oh()}else if((g.ha-g.ja)/(g.la-g.na)*(d.la-d.na)<this.tp&&g.Kh(d.la,d.ha,this.ka))return this.Oh();return 1};d.prototype.nL=function(d,g){if(d.na<g.na){if(g.la>g.na&&g.ha-g.ja<2*this.ka&&d.Kh(g.la,g.ha,this.ka))return this.Oh()}else if((g.ha-g.ja)/(g.la-g.na)*(d.na-d.la)<this.tp&&g.Kh(d.na,
d.ja,this.ka))return this.Oh();return-1};d.prototype.oL=function(d,g){var e=new k.b;e.pc(g.oc(),g.Mb());e.Kp();e.normalize();var m=new k.b;m.pc(d.Mb(),g.Mb());var v=new k.b;v.pc(d.oc(),g.Mb());var m=m.ml(e),e=v.ml(e),v=Math.abs(m),a=Math.abs(e);if(v<a){if(v<this.tp&&g.Kh(d.na,d.ja,this.ka))return this.Oh()}else if(a<this.tp&&g.Kh(d.la,d.ha,this.ka))return this.Oh();return 0>m&&0>e?-1:0<m&&0<e?1:this.Oh()};d.prototype.FB=function(d,g){return d.ja==g.ja&&d.na==g.na?this.mL(d,g):d.ha==g.ha&&d.la==g.la?
this.nL(d,g):this.oL(d,g)};d.prototype.qL=function(d,g){return d.ha==g.ha&&d.la==g.la&&d.ja==g.ja&&d.na==g.na?this.lx?this.aw():0:this.Oh()};d.prototype.GB=function(d,g){var e=1;if(d.ib.ja<g.ib.ja){var e=-1,m=d;d=g;g=m}m=d.ib;d=g.ib;var v=m.na-d.na;g=g.ux*(m.ja-d.ja);var k=this.tp;return v<g-k?-e:v>g+k?e:d.Kh(m.na,m.ja,this.ka)?this.Oh():v<g?-e:e};d.prototype.HB=function(d,g){var e=1;if(g.ib.ha<d.ib.ha){var e=-1,m=d;d=g;g=m}m=d.ib;d=g.ib;var v=m.la-d.na;g=g.ux*(m.ha-d.ja);var k=this.tp;return v<g-
k?-e:v>g+k?e:d.Kh(m.la,m.ha,this.ka)?this.Oh():v<g?-e:e};d.prototype.aw=function(){this.Zf=!0;this.ei=new k.wd(5,this.un,this.mr);return-1};d.prototype.Oh=function(){this.Zf=!0;this.lx?this.ei=new k.wd(4,this.un,this.mr):this.mr=this.un=this.gr=this.fr=-1;return-1};d.prototype.sL=function(d,g,e,k){if(this.Zf)return-1;var m=this.nE==this.Mj&&this.mE==this.sp,v;m&&d==this.fr?v=this.oE:(v=NaN,this.fr=-1);m&&g==this.gr?m=this.pE:(m=NaN,this.gr=-1);e.Zd.XE(a);k.Zd.XE(b);if(a.va<b.qa)return-1;if(b.va<a.qa)return 1;
this.nE=this.Mj;this.mE=this.sp;isNaN(v)&&(this.fr=d,this.oE=v=d=e.Zd.xe(this.Mj,this.sp));isNaN(m)&&(this.gr=g,this.pE=m=d=k.Zd.xe(this.Mj,this.sp));return Math.abs(v-m)<=this.ka?this.tL(e.Zd,k.Zd):v<m?-1:v>m?1:0};d.prototype.lq=function(){this.Zf=!1};d.prototype.rl=function(){return this.ei};d.prototype.XF=function(d,g){this.Mj=d;this.sp=g;this.mr=this.un=this.gr=this.fr=-1};d.prototype.compare=function(d,g,e){if(this.Zf)return-1;d=d.da(e);this.Cl=e;return this.JB(g,g,d,d)};d.prototype.JB=function(d,
g,e,k){var m;this.un==g?m=this.Rx:(this.un=g,m=this.Rx,this.Rx.Lf=d,this.$C(m,g,this.a.cd.f,this.a.Ge));var v;null==v&&(this.mr=k,v=this.vE,this.vE.Lf=e,this.$C(v,k,this.a.cd.f,this.a.Ge));if(m.Et||v.Et)return this.sL(g,k,m,v);if(m.$h.va<v.$h.qa)return-1;if(v.$h.va<m.$h.qa)return 1;d=m.Ft?1:0;d|=v.Ft?2:0;return 0==d?this.rL(m,v):1==d?this.FB(m.ib,v.ib):2==d?-1*this.FB(v.ib,m.ib):this.qL(m.ib,v.ib)};return d}();k.hA=d})(x||(x={}));(function(k){var a=function(){function a(e,d){this.a=e;this.ka=d;this.Zf=
!1;this.un=-1;this.$h=new k.Nd;this.pp=new k.b;this.pp.Eh();this.Vd=new k.yb;this.Cl=-1;this.Cx=1.7976931348623157E308}a.prototype.lq=function(){this.Zf=!1;this.Cx=1.7976931348623157E308};a.prototype.bh=function(e){this.pp.J(e)};a.prototype.compare=function(e,d){return this.KB(d,e.da(d))};a.prototype.KB=function(e,d){var g=null!=this.a.cc(d);g||(this.a.Oc(d,this.Vd),this.$h.yy(this.Vd.na,this.Vd.la));if(g)throw k.g.ra("not implemented");if(this.pp.x+this.ka<this.$h.qa)return-1;if(this.pp.x-this.ka>
this.$h.va)return 1;if(this.Vd.ja==this.Vd.ha)return this.Cl=e,this.Zf=!0,0;this.Vd.KE();d=this.Vd.Mb();g=new k.b;g.pc(this.Vd.oc(),d);g.Kp();var m=new k.b;m.pc(this.pp,d);d=g.ml(m);d/=g.length();return d<10*-this.ka?-1:d>10*this.ka?1:this.Vd.Eq(this.pp,this.ka)&&(g=Math.abs(d),g<this.Cx&&(this.Cl=e,this.Cx=g),this.Zf=!0,g<.25*this.ka)?0:0>d?-1:1};return a}();k.JI=a})(x||(x={}));(function(k){function a(e,d,g,m){g=new Float64Array(e.subarray(g,m));e.set(g,d)}var b=function(){function e(d){this.Sa=
this.Xf=!1;this.f=[];var g=d;2>g&&(g=2);this.f=k.I.Lh(g,e.ob);this.size=d}e.Yc=function(d,g){e.ob=g;d=new e(d);e.ob=0;return d};e.lj=function(d){var g=new e(0);g.f=d.f.slice(0);g.size=d.size;return g};e.V=function(d,g){var m=new e(0);m.size=d.size;m.size>g&&(m.size=g);m.f=d.f.slice(0,m.size);return m};e.prototype.xb=function(){};e.prototype.read=function(d){return this.f[d]};e.prototype.ec=function(d,g){g.x=this.f[d];g.y=this.f[d+1]};e.prototype.get=function(d){return this.f[d]};e.prototype.write=
function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.set=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.Rn=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.add=function(d){this.resize(this.size+1);this.f[this.size-1]=d};e.prototype.Ip=function(d){return e.V(this,d)};e.prototype.Bh=function(d){return this.read(d)};e.prototype.resize=function(d,g){void 0===g&&(g=0);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");
if(d<=this.size){if(k.I.truncate(5*d/4)<this.f.length){var e=this.f.slice(0,d);this.f=e}}else if(d>this.f.length){k.I.truncate(64>d?Math.max(2*d,4):5*d/4);for(var e=this.f.slice(0),v=this.f.length;v<d;v++)e[v]=g;this.f=e}this.size=d};e.prototype.cf=function(d){(null==this.f||d>this.f.length)&&this.resize(d);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=d};e.prototype.Uk=function(d,g){this.write(d,g)};e.prototype.jj=function(d,g,e){for(var m=this.size;g<
m&&g<e;g++)d=k.I.Rh(this.read(g));return d};e.prototype.lc=function(d,g,m){if(null==d||!(d instanceof e))return!1;var v=this.size,D=d.size;if(m>v||m>D&&v!=D)return!1;for(m>v&&(m=v);g<m;g++)if(this.read(g)!=d.read(g))return!1;return!0};e.prototype.nk=function(d,g,e,v,D,a,b){if(this.Sa)throw k.g.xa();if(!D&&(1>a||0!=v%a))throw k.g.N();var m=this.size-b;m<v&&this.resize(this.size+v-m);for(m=0;m<b-d;m++)this.f[d+v+m]=this.f[d+m];this.f==g.f&&d<e&&(e+=v);if(D)for(m=0;m<v;m++)this.f[m+d]=g.f[e+m];else for(D=
v,b=0;b<v;b+=a)for(D-=a,m=0;m<a;m++)this.f[d+b+m]=g.f[e+D+m]};e.prototype.ul=function(d,g,e,v){if(this.Sa)throw k.g.xa();v-=d;for(var m=this.f.slice(d,d+v),a=0;a<v;a++)this.f[d+e+a]=m[a];for(v=0;v<e;v++)this.f[d+v]=g};e.prototype.lg=function(d,g,e){if(this.Sa)throw k.g.xa();for(var m=this.f.slice(d,d+(e-d)),D=0;D<e-d;D++)this.f[D+d+2]=m[D];this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.km=function(d,g,e,v,D,a){if(0>d||0>g||0>v)throw k.g.N();if(!D&&(0>=a||0!=g%a))throw k.g.N();if(e.size<v+g)throw k.g.N();
if(0!=g)if(this.size<g+d&&this.resize(g+d),e==this)this.xi(d,g,v,D,a);else if(D)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v++;else if(v=v+g-a,1==a)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v--;else for(D=0,g=k.I.truncate(g/a);D<g;D++){for(var m=0;m<a;m++)this.f[d+m]=e.f[v+m];d+=a;v-=a}};e.prototype.oj=function(d,g,e){if(this.Sa)throw k.g.xa();if(d+g>this.size)throw k.g.xa();if(0<e-(d+g)){e-=d+g;for(var m=this.f.slice(d+g,d+e+g),D=0;D<e;D++)this.f[d+D]=m[D]}this.size-=g};e.prototype.Jp=function(d,g,e){if(this.Sa)throw k.g.xa();
if(1>e||0!=g%e)throw k.g.xa();for(var m=g>>1,D=0;D<m;D+=e){g-=e;for(var a=0;a<e;a++){var b=this.f[d+D+a];this.f[d+D+a]=this.f[d+g+a];this.f[d+g+a]=b}}};e.prototype.dh=function(d,g,e){if(0>g||0>e||0>g||e+g>this.size)throw k.g.N();for(var m=g;m<g+e;m++)this.f[m]=d};e.prototype.xi=function(d,g,e,v,D){if(!v||d!=e){for(var m=0;m<g;m++)this.f[d+m]=this.f[e+m];if(!v)for(e=d,d=d+g-D,v=0,g=k.I.truncate(g/2);v<g;v++){for(m=0;m<D;m++){var a=this.f[e+m];this.f[e+m]=this.f[d+m];this.f[d+m]=a}e+=D;d-=D}}};e.prototype.$p=
function(d,g,e,v,D){if(0>d||0>g||0>v)throw k.g.N();if(0!=g)for(this.size<(g<<1)+d&&this.resize((g<<1)+d),D||(d+=g-1<<1),D=D?2:-2,g+=v;v<g;v++)this.f[d]=e[v].x,this.f[d+1]=e[v].y,d+=D};e.prototype.Hp=function(d,g,e,v,D){if(0>d||0>g||0>v||this.size<g+d)throw k.g.N();if(D)for(D=0;D<g;D++)e[v+D]=this.f[d+D];else for(v=v+g-1;d<g;d++)e[v]=this.f[d],v--};e.prototype.clear=function(d){d?this.resize(0):this.cf(0)};e.prototype.xd=function(d,g,e){var m=this.f.slice(0,d),D=this.f.slice(g);d=this.f.slice(d,g).sort(e);
this.f.length=0;this.f.push.apply(this.f,m.concat(d).concat(D))};e.prototype.Qh=function(){return 1};e.ob=0;return e}();k.qd=b;b=function(){function e(d){this.Sa=this.Xf=!1;this.f=null;var g=d;2>g&&(g=2);this.f=new Float64Array(g);this.size=d}e.Yc=function(d,g){var m=new e(d),v=m.f;2>d&&(d=2);if(0!==g)for(var D=0;D<d;D++)v[D]=g;return m};e.lj=function(d){var g=new e(0);g.f=new Float64Array(d.f);g.size=d.size;return g};e.V=function(d,g){var m=new e(0);m.size=d.size;m.size>g&&(m.size=g);g=m.size;2>
g&&(g=2);m.f=new Float64Array(g);m.f.set(d.f.length<=g?d.f:d.f.subarray(0,g),0);return m};e.prototype.xb=function(d){0>=d||(null==this.f?this.f=new Float64Array(d):d<=this.f.length||(0<this.f.length?(d=new Float64Array(d),d.set(this.f),this.f=d):this.f=new Float64Array(d)))};e.prototype.read=function(d){return this.f[d]};e.prototype.ec=function(d,g){g.x=this.f[d];g.y=this.f[d+1]};e.prototype.get=function(d){return this.f[d]};e.prototype.write=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.set=
function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.Rn=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.add=function(d){this.resize(this.size+1);this.f[this.size-1]=d};e.prototype.Ip=function(d){return e.V(this,d)};e.prototype.Bh=function(d){return this.read(d)};e.prototype.resize=function(d,g){void 0===g&&(g=0);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(d<=this.size){if(30<this.f.length&&5*d/4<this.f.length){var e=
new Float64Array(this.f,0,d);this.f=e}}else{d>this.f.length&&(e=k.I.truncate(64>d?Math.max(2*d,4):5*d/4),e=new Float64Array(e),e.set(this.f),this.f=e);for(var e=this.f,v=this.size;v<d;v++)e[v]=g}this.size=d};e.prototype.cf=function(d){(null==this.f||d>this.f.length)&&this.resize(d);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=d};e.prototype.Uk=function(d,g){this.write(d,g)};e.prototype.jj=function(d,g,e){for(var m=this.size;g<m&&g<e;g++)d=k.I.Rh(this.read(g));
return d};e.prototype.lc=function(d,g,m){if(null==d||!(d instanceof e))return!1;var v=this.size,D=d.size;if(m>v||m>D&&v!=D)return!1;for(m>v&&(m=v);g<m;g++)if(this.read(g)!=d.read(g))return!1;return!0};e.prototype.nk=function(d,g,e,v,D,L,b){if(this.Sa)throw k.g.xa();if(!D&&(1>L||0!=v%L))throw k.g.N();var m=this.size-b;m<v&&this.resize(this.size+v-m);a(this.f,d+v,d,d+(b-d));this.f==g.f&&d<e&&(e+=v);if(D)this.f.set(g.f.subarray(e,e+v),d);else for(D=v,b=0;b<v;b+=L)for(D-=L,m=0;m<L;m++)this.f[d+b+m]=g.f[e+
D+m]};e.prototype.ul=function(d,g,e,v){if(this.Sa)throw k.g.xa();v-=d;a(this.f,d+v,d,d+v);for(v=0;v<e;v++)this.f[d+v]=g};e.prototype.lg=function(d,g,e){if(this.Sa)throw k.g.xa();a(this.f,d+2,d,d+(e-d));this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.km=function(d,g,e,v,D,a){if(0>d||0>g||0>v)throw k.g.N();if(!D&&(0>=a||0!=g%a))throw k.g.N();if(e.size<v+g)throw k.g.N();if(0!=g)if(this.size<g+d&&this.resize(g+d),e==this)this.xi(d,g,v,D,a);else if(D)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v++;else if(v=v+g-a,
1==a)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v--;else for(D=0,g=k.I.truncate(g/a);D<g;D++){for(var m=0;m<a;m++)this.f[d+m]=e.f[v+m];d+=a;v-=a}};e.prototype.oj=function(d,g,e){if(this.Sa)throw k.g.xa();if(d+g>this.size)throw k.g.xa();0<e-(d+g)&&a(this.f,d,d+g,d+(e-(d+g))+g);this.size-=g};e.prototype.Jp=function(d,g,e){if(this.Sa)throw k.g.xa();if(1>e||0!=g%e)throw k.g.xa();for(var m=g>>1,D=0;D<m;D+=e){g-=e;for(var a=0;a<e;a++){var b=this.f[d+D+a];this.f[d+D+a]=this.f[d+g+a];this.f[d+g+a]=b}}};e.prototype.dh=
function(d,g,e){if(0>g||0>e||0>g||e+g>this.size)throw k.g.N();for(var m=g;m<g+e;m++)this.f[m]=d};e.prototype.xi=function(d,g,e,v,D){if(!v||d!=e)if(this.f.set(this.f.subarray(e,e+g),d),!v)for(e=d,d=d+g-D,v=0,g=k.I.truncate(g/2);v<g;v++){for(var m=0;m<D;m++){var a=this.f[e+m];this.f[e+m]=this.f[d+m];this.f[d+m]=a}e+=D;d-=D}};e.prototype.$p=function(d,g,e,v,D){if(0>d||0>g||0>v)throw k.g.N();if(0!=g)for(this.size<(g<<1)+d&&this.resize((g<<1)+d),D||(d+=g-1<<1),D=D?2:-2,g+=v;v<g;v++)this.f[d]=e[v].x,this.f[d+
1]=e[v].y,d+=D};e.prototype.Hp=function(d,g,e,v,D){if(0>d||0>g||0>v||this.size<g+d)throw k.g.N();if(D)for(D=0;D<g;D++)e[v+D]=this.f[d+D];else for(v=v+g-1;d<g;d++)e[v]=this.f[d],v--};e.prototype.clear=function(d){d?this.resize(0):this.cf(0)};e.prototype.xd=function(d,g,e){Array.prototype.sort.call(this.f.subarray(d,g),e)};e.prototype.Qh=function(){return 1};return e}();k.QG=b})(x||(x={}));!0===x.ah.Sk&&!0===x.ah.it&&(x.qd=x.QG);(function(k){function a(e,d,g,m){g=new Int32Array(e.subarray(g,m));e.set(g,
d)}k.tT=function(){return function(){this.random=1973}}();var b=function(){function e(d){this.Sa=this.Xf=!1;this.f=[];var g=d;2>g&&(g=2);this.f=this.f=k.I.Lh(g,e.ob);this.size=d}e.Yc=function(d,g){e.ob=g;d=new e(d);e.ob=0;return d};e.lj=function(d){var g=new e(0);g.f=d.f.slice(0);g.size=d.size;return g};e.V=function(d,g){var m=new e(0);m.size=d.size;m.size>g&&(m.size=g);m.f=d.f.slice(0,m.size);return m};e.prototype.xb=function(){};e.prototype.read=function(d){return this.f[d]};e.prototype.ec=function(d,
g){g.x=this.f[d];g.y=this.f[d+1]};e.prototype.get=function(d){return this.f[d]};e.prototype.write=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.set=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.Rn=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.add=function(d){this.resize(this.size+1);this.f[this.size-1]=d};e.prototype.Ip=function(d){return e.V(this,d)};e.prototype.Bh=function(d){return this.read(d)};e.prototype.resize=function(d,
g){void 0===g&&(g=0);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(d<=this.size){if(k.I.truncate(5*d/4)<this.f.length){var e=this.f.slice(0,d);this.f=e}}else if(d>this.f.length){k.I.truncate(64>d?Math.max(2*d,4):5*d/4);for(var e=this.f.slice(0),v=this.f.length;v<d;v++)e[v]=g;this.f=e}this.size=d};e.prototype.cf=function(d){(null==this.f||d>this.f.length)&&this.resize(d);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");
this.size=d};e.prototype.Uk=function(d,g){this.write(d,g)};e.prototype.jj=function(d,g,e){for(var m=this.size;g<m&&g<e;g++)d=k.I.kg(this.read(g),d);return d};e.prototype.lc=function(d,g,m){if(null==d||!(d instanceof e))return!1;var v=this.size,D=d.size;if(m>v||m>D&&v!=D)return!1;for(m>v&&(m=v);g<m;g++)if(this.read(g)!=d.read(g))return!1;return!0};e.prototype.nk=function(d,g,e,v,D,a,b){if(this.Sa)throw k.g.xa();if(!D&&(1>a||0!=v%a))throw k.g.N();for(var m=0;m<b-d;m++)this.f[d+v+m]=this.f[d+m];this.f==
g.f&&d<e&&(e+=v);if(D)for(m=0;m<v;m++)this.f[m+d]=g.f[e+m];else for(D=v,b=0;b<v;b+=a)for(D-=a,m=0;m<a;m++)this.f[d+b+m]=g.f[e+D+m]};e.prototype.ul=function(d,g,e,v){if(this.Sa)throw k.g.xa();v-=d;for(var m=this.f.slice(d,d+v),a=0;a<v;a++)this.f[d+e+a]=m[a];for(v=0;v<e;v++)this.f[d+v]=g};e.prototype.lg=function(d,g,e){if(this.Sa)throw k.g.xa();for(var m=this.f.slice(d,d+(e-d)),D=0;D<e-d;D++)this.f[D+d+2]=m[D];this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.km=function(d,g,e,v,D,a){if(0>d||0>g||0>v)throw k.g.N();
if(!D&&(0>=a||0!=g%a))throw k.g.N();if(e.size<v+g)throw k.g.N();if(0!=g)if(this.size<g+d&&this.resize(g+d),e==this)this.xi(d,g,v,D,a);else if(D)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v++;else if(v=v+g-a,1==a)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v--;else for(D=0,g=k.I.truncate(g/a);D<g;D++){for(var m=0;m<a;m++)this.f[d+m]=e.f[v+m];d+=a;v-=a}};e.prototype.oj=function(d,g,e){if(this.Sa)throw k.g.xa();if(d+g>this.size)throw k.g.xa();if(0<e-(d+g)){e-=d+g;for(var m=this.f.slice(d+g,d+e+g),D=0;D<e;D++)this.f[d+
D]=m[D]}this.size-=g};e.prototype.Jp=function(d,g,e){if(this.Sa)throw k.g.xa();if(1>e||0!=g%e)throw k.g.xa();for(var m=g>>1,D=0;D<m;D+=e){g-=e;for(var a=0;a<e;a++){var b=this.f[d+D+a];this.f[d+D+a]=this.f[d+g+a];this.f[d+g+a]=b}}};e.prototype.dh=function(d,g,e){if(0>g||0>e||0>g||e+g>this.size)throw k.g.N();for(var m=g;m<g+e;m++)this.f[m]=d};e.prototype.xi=function(d,g,e,v,D){if(!v||d!=e){for(var m=0;m<g;m++)this.f[d+m]=this.f[e+m];if(!v)for(e=d,d=d+g-D,v=0,g=k.I.truncate(g/2);v<g;v++){for(m=0;m<D;m++){var a=
this.f[e+m];this.f[e+m]=this.f[d+m];this.f[d+m]=a}e+=D;d-=D}}};e.prototype.$p=function(d,g,e,v,D){if(0>d||0>g||0>v)throw k.g.N();if(0!=g)for(this.size<(g<<1)+d&&this.resize((g<<1)+d),D||(d+=g-1<<1),D=D?2:-2,g+=v;v<g;v++)this.f[d]=e[v].x,this.f[d+1]=e[v].y,d+=D};e.prototype.Hp=function(d,g,e,v,D){if(0>d||0>g||0>v||this.size<g+d)throw k.g.N();if(D)for(D=0;D<g;D++)e[v+D]=this.f[d+D];else for(v=v+g-1;d<g;d++)e[v]=this.f[d],v--};e.prototype.clear=function(d){d?this.resize(0):this.cf(0)};e.prototype.xd=
function(d,g,e){var m=this.f.slice(0,d),D=this.f.slice(g);d=this.f.slice(d,g).sort(e);this.f.length=0;this.f.push.apply(this.f,m.concat(d).concat(D))};e.prototype.Qh=function(){return 2};e.prototype.tc=function(){return this.f[this.size-1]};e.prototype.af=function(){this.resize(this.size-1)};e.prototype.JF=function(d){this.f[this.size-1]=d};e.prototype.QE=function(d){d<this.size-1&&(this.f[d]=this.f[this.size-1]);this.resize(this.size-1)};e.prototype.Qs=function(d){for(var g=0,e=this.size;g<e;g++)if(this.f[g]==
d)return g;return-1};e.prototype.Nw=function(d){return 0<=this.Qs(d)};e.ob=0;return e}();k.ga=b;b=function(){function e(d){this.Sa=this.Xf=!1;this.f=null;var g=d;2>g&&(g=2);this.f=new Int32Array(g);this.size=d}e.Yc=function(d,g){var m=new e(d),v=m.f;2>d&&(d=2);if(0!==g)for(var D=0;D<d;D++)v[D]=g;return m};e.lj=function(d){var g=new e(0);g.f=new Int32Array(d.f);g.size=d.size;return g};e.V=function(d,g){var m=new e(0);m.size=d.size;m.size>g&&(m.size=g);g=m.size;2>g&&(g=2);m.f=new Int32Array(g);m.f.set(d.f.length<=
g?d.f:d.f.subarray(0,g),0);return m};e.prototype.xb=function(d){0>=d||(null==this.f?this.f=new Int32Array(d):d<=this.f.length||(0<this.f.length?(d=new Int32Array(d),d.set(this.f),this.f=d):this.f=new Int32Array(d)))};e.prototype.read=function(d){return this.f[d]};e.prototype.ec=function(d,g){g.x=this.f[d];g.y=this.f[d+1]};e.prototype.get=function(d){return this.f[d]};e.prototype.write=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.set=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=
g};e.prototype.Rn=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.add=function(d){this.resize(this.size+1);this.f[this.size-1]=d};e.prototype.Ip=function(d){return e.V(this,d)};e.prototype.Bh=function(d){return this.read(d)};e.prototype.resize=function(d,g){void 0===g&&(g=0);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(d<=this.size){if(30<this.f.length&&5*d/4<this.f.length){var e=new Int32Array(this.f,0,d);this.f=
e}}else{d>this.f.length&&(e=k.I.truncate(64>d?Math.max(2*d,4):5*d/4),e=new Int32Array(e),e.set(this.f),this.f=e);for(var e=this.f,v=this.size;v<d;v++)e[v]=g}this.size=d};e.prototype.cf=function(d){(null==this.f||d>this.f.length)&&this.resize(d);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=d};e.prototype.Uk=function(d,g){this.write(d,g)};e.prototype.jj=function(d,g,e){for(var m=this.size;g<m&&g<e;g++)d=k.I.kg(this.read(g),d);return d};e.prototype.lc=
function(d,g,m){if(null==d||!(d instanceof e))return!1;var v=this.size,D=d.size;if(m>v||m>D&&v!=D)return!1;for(m>v&&(m=v);g<m;g++)if(this.read(g)!=d.read(g))return!1;return!0};e.prototype.nk=function(d,g,e,v,D,L,b){if(this.Sa)throw k.g.xa();if(!D&&(1>L||0!=v%L))throw k.g.N();a(this.f,d+v,d,d+(b-d));this.f==g.f&&d<e&&(e+=v);if(D)this.f.set(g.f.subarray(e,e+v),d);else for(D=v,b=0;b<v;b+=L){D-=L;for(var m=0;m<L;m++)this.f[d+b+m]=g.f[e+D+m]}};e.prototype.ul=function(d,g,e,v){if(this.Sa)throw k.g.xa();
v-=d;a(this.f,d+v,d,d+v);for(v=0;v<e;v++)this.f[d+v]=g};e.prototype.lg=function(d,g,e){if(this.Sa)throw k.g.xa();a(this.f,d+2,d,d+(e-d));this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.km=function(d,g,e,v,D,a){if(0>d||0>g||0>v)throw k.g.N();if(!D&&(0>=a||0!=g%a))throw k.g.N();if(e.size<v+g)throw k.g.N();if(0!=g)if(this.size<g+d&&this.resize(g+d),e==this)this.xi(d,g,v,D,a);else if(D)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v++;else if(v=v+g-a,1==a)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v--;else for(D=0,g=k.I.truncate(g/
a);D<g;D++){for(var m=0;m<a;m++)this.f[d+m]=e.f[v+m];d+=a;v-=a}};e.prototype.oj=function(d,g,e){if(this.Sa)throw k.g.xa();if(d+g>this.size)throw k.g.xa();0<e-(d+g)&&a(this.f,d,d+g,d+(e-(d+g))+g);this.size-=g};e.prototype.Jp=function(d,g,e){if(this.Sa)throw k.g.xa();if(1>e||0!=g%e)throw k.g.xa();for(var m=g>>1,D=0;D<m;D+=e){g-=e;for(var a=0;a<e;a++){var b=this.f[d+D+a];this.f[d+D+a]=this.f[d+g+a];this.f[d+g+a]=b}}};e.prototype.dh=function(d,g,e){if(0>g||0>e||0>g||e+g>this.size)throw k.g.N();for(var m=
g;m<g+e;m++)this.f[m]=d};e.prototype.xi=function(d,g,e,v,D){if(!v||d!=e)if(this.f.set(this.f.subarray(e,e+g),d),!v)for(e=d,d=d+g-D,v=0,g=k.I.truncate(g/2);v<g;v++){for(var m=0;m<D;m++){var a=this.f[e+m];this.f[e+m]=this.f[d+m];this.f[d+m]=a}e+=D;d-=D}};e.prototype.$p=function(d,g,e,v,D){if(0>d||0>g||0>v)throw k.g.N();if(0!=g)for(this.size<(g<<1)+d&&this.resize((g<<1)+d),D||(d+=g-1<<1),D=D?2:-2,g+=v;v<g;v++)this.f[d]=e[v].x,this.f[d+1]=e[v].y,d+=D};e.prototype.Hp=function(d,g,e,v,D){if(0>d||0>g||0>
v||this.size<g+d)throw k.g.N();if(D)for(D=0;D<g;D++)e[v+D]=this.f[d+D];else for(v=v+g-1;d<g;d++)e[v]=this.f[d],v--};e.prototype.clear=function(d){d?this.resize(0):this.cf(0)};e.prototype.xd=function(d,g,m){10>g-d?e.$i(this.f,d,g,m):e.$g(this.f,d,g-1,m)};e.prototype.Qh=function(){return 2};e.prototype.tc=function(){return this.f[this.size-1]};e.prototype.af=function(){this.resize(this.size-1)};e.prototype.JF=function(d){this.f[this.size-1]=d};e.prototype.QE=function(d){d<this.size-1&&(this.f[d]=this.f[this.size-
1]);this.resize(this.size-1)};e.prototype.Qs=function(d){for(var g=0,e=this.size;g<e;g++)if(this.f[g]==d)return g;return-1};e.prototype.Nw=function(d){return 0<=this.Qs(d)};e.$i=function(d,g,e,v){for(var m=g;m<e;m++){for(var k=d[m],a=m-1;a>=g&&0<v(d[a],k);)d[a+1]=d[a],a--;d[a+1]=k}};e.Wf=function(d,g,e){var m=d[e];d[e]=d[g];d[g]=m};e.$g=function(d,g,m,v){if(!(g>=m))for(;;){if(9>m-g){e.$i(d,g,m+1,v);break}var D=d[g];e.Wf(d,g,m);for(var k=g,a=g;a<m;a++)0>=v(d[a],D)&&(e.Wf(d,k,a),k+=1);e.Wf(d,k,m);k-
g<m-k?(e.$g(d,g,k-1,v),g=k+1):(e.$g(d,k+1,m,v),m=k-1)}};return e}();k.Xu=b})(x||(x={}));!0===x.ah.Sk&&(x.ga=x.Xu);(function(k){function a(e,d,g,m){g=new Int8Array(e.subarray(g,m));e.set(g,d)}var b=function(){function e(d){this.Sa=this.Xf=!1;this.f=[];var g=d;2>g&&(g=2);this.f=k.I.Lh(g,e.ob);this.size=d}e.Yc=function(d,g){e.ob=g;d=new e(d);e.ob=0;return d};e.lj=function(d){var g=new e(0);g.f=d.f.slice(0);g.size=d.size;return g};e.V=function(d,g){var m=new e(0);m.size=d.size;m.size>g&&(m.size=g);m.f=
d.f.slice(0,m.size);return m};e.prototype.xb=function(){};e.prototype.read=function(d){return this.f[d]};e.prototype.ec=function(d,g){g.x=this.f[d];g.y=this.f[d+1]};e.prototype.get=function(d){return this.f[d]};e.prototype.write=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.set=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.Rn=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.add=function(d){this.resize(this.size+1);this.f[this.size-
1]=d};e.prototype.Ip=function(d){return e.V(this,d)};e.prototype.Bh=function(d){return this.read(d)};e.prototype.resize=function(d,g){void 0===g&&(g=0);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(d<=this.size){if(k.I.truncate(5*d/4)<this.f.length){var e=this.f.slice(0,d);this.f=e}}else if(d>this.f.length){k.I.truncate(64>d?Math.max(2*d,4):5*d/4);for(var e=this.f.slice(0),v=this.f.length;v<d;v++)e[v]=g;this.f=e}this.size=d};e.prototype.cf=function(d){(null==
this.f||d>this.f.length)&&this.resize(d);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=d};e.prototype.Uk=function(d,g){this.write(d,g)};e.prototype.jj=function(d,g,e){for(var m=this.size;g<m&&g<e;g++)d=k.I.kg(this.read(g),d);return d};e.prototype.lc=function(d,g,m){if(null==d||!(d instanceof e))return!1;var v=this.size,D=d.size;if(m>v||m>D&&v!=D)return!1;for(m>v&&(m=v);g<m;g++)if(this.read(g)!=d.read(g))return!1;return!0};e.prototype.nk=function(d,
g,e,v,D,a,b){if(this.Sa)throw k.g.xa();if(!D&&(1>a||0!=v%a))throw k.g.N();for(var m=0;m<b-d;m++)this.f[d+v+m]=this.f[d+m];this.f==g.f&&d<e&&(e+=v);if(D)for(m=0;m<v;m++)this.f[m+d]=g.f[e+m];else for(D=v,b=0;b<v;b+=a)for(D-=a,m=0;m<a;m++)this.f[d+b+m]=g.f[e+D+m]};e.prototype.ul=function(d,g,e,v){if(this.Sa)throw k.g.xa();v-=d;for(var m=this.f.slice(d,d+v),a=0;a<v;a++)this.f[d+e+a]=m[a];for(v=0;v<e;v++)this.f[d+v]=g};e.prototype.lg=function(d,g,e){if(this.Sa)throw k.g.xa();for(var m=this.f.slice(d,d+
(e-d)),D=0;D<e-d;D++)this.f[D+d+2]=m[D];this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.km=function(d,g,e,v,D,a){if(0>d||0>g||0>v)throw k.g.N();if(!D&&(0>=a||0!=g%a))throw k.g.N();if(e.size<v+g)throw k.g.N();if(0!=g)if(this.size<g+d&&this.resize(g+d),e==this)this.xi(d,g,v,D,a);else if(D)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v++;else if(v=v+g-a,1==a)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v--;else for(D=0,g=k.I.truncate(g/a);D<g;D++){for(var m=0;m<a;m++)this.f[d+m]=e.f[v+m];d+=a;v-=a}};e.prototype.oj=function(d,
g,e){if(this.Sa)throw k.g.xa();if(d+g>this.size)throw k.g.xa();if(0<e-(d+g)){e-=d+g;for(var m=this.f.slice(d+g,d+e+g),D=0;D<e;D++)this.f[d+D]=m[D]}this.size-=g};e.prototype.Jp=function(d,g,e){if(this.Sa)throw k.g.xa();if(1>e||0!=g%e)throw k.g.xa();for(var m=g>>1,D=0;D<m;D+=e){g-=e;for(var a=0;a<e;a++){var b=this.f[d+D+a];this.f[d+D+a]=this.f[d+g+a];this.f[d+g+a]=b}}};e.prototype.dh=function(d,g,e){if(0>g||0>e||0>g||e+g>this.size)throw k.g.N();for(var m=g;m<g+e;m++)this.f[m]=d};e.prototype.xi=function(d,
g,e,v,D){if(!v||d!=e){for(var m=0;m<g;m++)this.f[d+m]=this.f[e+m];if(!v)for(e=d,d=d+g-D,v=0,g=k.I.truncate(g/2);v<g;v++){for(m=0;m<D;m++){var a=this.f[e+m];this.f[e+m]=this.f[d+m];this.f[d+m]=a}e+=D;d-=D}}};e.prototype.$p=function(d,g,e,v,D){if(0>d||0>g||0>v)throw k.g.N();if(0!=g)for(this.size<(g<<1)+d&&this.resize((g<<1)+d),D||(d+=g-1<<1),D=D?2:-2,g+=v;v<g;v++)this.f[d]=e[v].x,this.f[d+1]=e[v].y,d+=D};e.prototype.Hp=function(d,g,e,v,D){if(0>d||0>g||0>v||this.size<g+d)throw k.g.N();if(D)for(D=0;D<
g;D++)e[v+D]=this.f[d+D];else for(v=v+g-1;d<g;d++)e[v]=this.f[d],v--};e.prototype.clear=function(d){d?this.resize(0):this.cf(0)};e.prototype.xd=function(d,g,e){var m=this.f.slice(0,d),D=this.f.slice(g);d=this.f.slice(d,g).sort(e);this.f.length=0;this.f.push.apply(this.f,m.concat(d).concat(D))};e.prototype.Qh=function(){return 1};e.prototype.xy=function(d,g){if(this.Sa)throw k.g.ra("invalid call. Attribute Stream is read only.");this.f[d]|=g};e.prototype.BB=function(d,g){if(this.Sa)throw k.g.ra("invalid call. Attribute Stream is read only.");
this.f[d]&=~g};e.ob=0;return e}();k.Wk=b;b=function(){function e(d){this.f=null;var g=d;2>g&&(g=2);this.f=new Int8Array(g);this.size=d}e.Yc=function(d,g){var m=new e(d),v=m.f;2>d&&(d=2);if(0!==g)for(var D=0;D<d;D++)v[D]=g;return m};e.lj=function(d){var g=new e(0);g.f=new Int8Array(d.f);g.size=d.size;return g};e.V=function(d,g){var m=new e(0);m.size=d.size;m.size>g&&(m.size=g);g=m.size;2>g&&(g=2);m.f=new Int8Array(g);m.f.set(d.f.length<=g?d.f:d.f.subarray(0,g),0);return m};e.prototype.xb=function(d){0>=
d||(null==this.f?this.f=new Int8Array(d):d<=this.f.length||(0<this.f.length?(d=new Int8Array(d),d.set(this.f),this.f=d):this.f=new Int8Array(d)))};e.prototype.read=function(d){return this.f[d]};e.prototype.ec=function(d,g){g.x=this.f[d];g.y=this.f[d+1]};e.prototype.get=function(d){return this.f[d]};e.prototype.write=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.set=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=g};e.prototype.Rn=function(d,g){if(this.Sa)throw k.g.xa();this.f[d]=
g.x;this.f[d+1]=g.y};e.prototype.add=function(d){this.resize(this.size+1);this.f[this.size-1]=d};e.prototype.Ip=function(d){return e.V(this,d)};e.prototype.Bh=function(d){return this.read(d)};e.prototype.resize=function(d,g){void 0===g&&(g=0);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(d<=this.size){if(30<this.f.length&&5*d/4<this.f.length){var e=new Int8Array(this.f,0,d);this.f=e}}else{d>this.f.length&&(e=k.I.truncate(64>d?Math.max(2*d,4):5*d/4),
e=new Int8Array(e),e.set(this.f),this.f=e);for(var e=this.f,v=this.size;v<d;v++)e[v]=g}this.size=d};e.prototype.cf=function(d){(null==this.f||d>this.f.length)&&this.resize(d);if(this.Xf)throw k.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=d};e.prototype.Uk=function(d,g){this.write(d,g)};e.prototype.jj=function(d,g,e){for(var m=this.size;g<m&&g<e;g++)d=k.I.kg(this.read(g),d);return d};e.prototype.lc=function(d,g,m){if(null==d||!(d instanceof e))return!1;var v=this.size,
D=d.size;if(m>v||m>D&&v!=D)return!1;for(m>v&&(m=v);g<m;g++)if(this.read(g)!=d.read(g))return!1;return!0};e.prototype.nk=function(d,g,e,v,D,L,b){if(this.Sa)throw k.g.xa();if(!D&&(1>L||0!=v%L))throw k.g.N();a(this.f,d+v,d,d+(b-d));this.f==g.f&&d<e&&(e+=v);if(D)this.f.set(g.f.subarray(e,e+v),d);else for(D=v,b=0;b<v;b+=L){D-=L;for(var m=0;m<L;m++)this.f[d+b+m]=g.f[e+D+m]}};e.prototype.ul=function(d,g,e,v){if(this.Sa)throw k.g.xa();v-=d;a(this.f,d+v,d,d+v);for(v=0;v<e;v++)this.f[d+v]=g};e.prototype.lg=
function(d,g,e){if(this.Sa)throw k.g.xa();a(this.f,d+2,d,d+(e-d));this.f[d]=g.x;this.f[d+1]=g.y};e.prototype.km=function(d,g,e,v,D,a){if(0>d||0>g||0>v)throw k.g.N();if(!D&&(0>=a||0!=g%a))throw k.g.N();if(e.size<v+g)throw k.g.N();if(0!=g)if(this.size<g+d&&this.resize(g+d),e==this)this.xi(d,g,v,D,a);else if(D)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v++;else if(v=v+g-a,1==a)for(D=0;D<g;D++)this.f[d]=e.f[v],d++,v--;else for(D=0,g=k.I.truncate(g/a);D<g;D++){for(var m=0;m<a;m++)this.f[d+m]=e.f[v+m];d+=a;v-=
a}};e.prototype.oj=function(d,g,e){if(this.Sa)throw k.g.xa();if(d+g>this.size)throw k.g.xa();0<e-(d+g)&&a(this.f,d,d+g,d+(e-(d+g))+g);this.size-=g};e.prototype.Jp=function(d,g,e){if(this.Sa)throw k.g.xa();if(1>e||0!=g%e)throw k.g.xa();for(var m=g>>1,D=0;D<m;D+=e){g-=e;for(var a=0;a<e;a++){var b=this.f[d+D+a];this.f[d+D+a]=this.f[d+g+a];this.f[d+g+a]=b}}};e.prototype.dh=function(d,g,e){if(0>g||0>e||0>g||e+g>this.size)throw k.g.N();for(var m=g;m<g+e;m++)this.f[m]=d};e.prototype.xi=function(d,g,e,v,
D){if(!v||d!=e)if(this.f.set(this.f.subarray(e,e+g),d),!v)for(e=d,d=d+g-D,v=0,g=k.I.truncate(g/2);v<g;v++){for(var m=0;m<D;m++){var a=this.f[e+m];this.f[e+m]=this.f[d+m];this.f[d+m]=a}e+=D;d-=D}};e.prototype.$p=function(d,g,e,v,D){if(0>d||0>g||0>v)throw k.g.N();if(0!=g)for(this.size<(g<<1)+d&&this.resize((g<<1)+d),D||(d+=g-1<<1),D=D?2:-2,g+=v;v<g;v++)this.f[d]=e[v].x,this.f[d+1]=e[v].y,d+=D};e.prototype.Hp=function(d,g,e,v,D){if(0>d||0>g||0>v||this.size<g+d)throw k.g.N();if(D)for(D=0;D<g;D++)e[v+
D]=this.f[d+D];else for(v=v+g-1;d<g;d++)e[v]=this.f[d],v--};e.prototype.clear=function(d){d?this.resize(0):this.cf(0)};e.prototype.xd=function(d,g,e){g=this.f.subarray(d,g);Array.prototype.sort.call(g,e);this.f.set(g,d)};e.prototype.xy=function(d,g){if(this.Sa)throw k.g.ra("invalid call. Attribute Stream is read only.");this.f[d]|=g};e.prototype.BB=function(d,g){if(this.Sa)throw k.g.ra("invalid call. Attribute Stream is read only.");this.f[d]&=~g};e.prototype.Qh=function(){return 1};return e}();k.Yu=
b})(x||(x={}));!0===x.ah.Sk&&(x.Wk=x.Yu);(function(k){var a=function(){function a(){}a.to=function(e,d){return k.Wk.Yc(e,d)};a.kl=function(e,d){return k.qd.Yc(e,d)};a.Sv=function(e,d,g){switch(e){case 1:e=k.qd.Yc(d,g);break;case 2:e=k.ga.Yc(d,g);break;case 4:e=k.Wk.Yc(d,g);break;default:throw k.g.wa();}return e};a.Tv=function(e,d){return a.Sv(k.pa.Qh(e),d*k.pa.Wa(e),k.pa.ue(e))};a.Dg=function(e,d){return k.ga.Yc(e,d)};a.ay=function(e){var d,g=[];for(d=0;d<e;d++)g.push(null);return g};return a}();
k.Ac=a})(x||(x={}));(function(k){var a=function(){function a(){}a.to=function(e,d){return k.Yu.Yc(e,d)};a.kl=function(e,d){return k.qd.Yc(e,d)};a.Sv=function(e,d,g){switch(e){case 1:e=k.qd.Yc(d,g);break;case 2:e=k.Xu.Yc(d,g);break;case 4:e=k.Yu.Yc(d,g);break;default:throw k.g.wa();}return e};a.Tv=function(e,d){return k.Ac.Sv(k.pa.Qh(e),d*k.pa.Wa(e),k.pa.ue(e))};a.Dg=function(e,d){return k.Xu.Yc(e,d)};a.ay=function(e){var d,g=[];for(d=0;d<e;d++)g.push(null);return g};return a}();k.RG=a})(x||(x={}));
!0===x.ah.Sk&&(x.Ac=x.RG);(function(k){k.ca=function(){return function(k){void 0===k&&(k=0);this.l=k}}()})(x||(x={}));(function(k){var a=function(){function e(){}e.nb=function(d,g){return 0<=g?e.H(d):-e.H(d)};e.H=function(d){return 0>d?-d:d};e.Ih=function(d){return 3.552713678800501E-15>d};e.Xz=function(d,g,m){return e.H(d-g)<=m*(1+(e.H(d)+e.H(g))/2)};e.S=function(d,g){return e.Xz(d,g,3.552713678800501E-15)};e.wI=function(d){return 3.552713678800501E-15>=e.H(d)};e.Vc=function(d){return e.wI(d)};return e}();
k.j=a;var b=function(){function e(){}e.Sn=function(d,g){d=a.H(d);g=a.H(g);var e=0;0!=d+g&&(d>g?(e=g/d,e=d*Math.sqrt(1+e*e)):(e=d/g,e=g*Math.sqrt(1+e*e)));return e};e.Ep=function(d,g,m,v,D){for(var k=[0,0,0],b=[0,0,0],c=0;2>=c;c++)g[c]-=d[c],m[c]-=g[c];m=k[1]*b[2]-k[2]*b[1];g=k[2]*b[0]-k[0]*b[2];k=k[0]*b[1]-k[1]*b[0];d=-1*(m*d[0]+g*d[1]+k*d[2]);v[0]=m;v[1]=g;v[2]=k;v[3]=d;b=e.jm(v);v[0]/=b;v[1]/=b;v[2]/=b;v[3]/=b;0!=D&&(b=a.Vc(k)?a.Vc(d)?a.nb(1,g):-a.nb(1,d):a.nb(1,k),b*=a.nb(1,D),v[0]*=b,v[1]*=b,
v[2]*=b,v[3]*=b)};e.Uu=function(d,g,e){e[0]=d[1]*g[2]-g[1]*d[2];e[1]=d[2]*g[0]-g[2]*d[0];e[2]=d[0]*g[1]-g[0]*d[1]};e.Qr=function(d,g){return d[0]*g[0]+d[1]*g[1]+d[2]*g[2]};e.jm=function(d){return e.Sn(e.Sn(d[0],d[1]),d[2])};e.wm=function(d,g,m,v,D,k){var a=e.n(1,d,g),L=Math.cos(g);v.l=(a+0)*L*Math.cos(m);D.l=(a+0)*L*Math.sin(m);k.l=(a*(1-d)+0)*Math.sin(g)};e.JK=function(d,g,m,v,D,k,b){var L=e.Sn(g,m),c=1*Math.sqrt(1-d),n=c/1;if(a.S(L,0))k.l=0,D.l=a.nb(1.570796326794897,v),b.l=a.H(v)-c;else{k.l=Math.atan2(m,
g);m=Math.atan2(1*v,c*L);k=Math.cos(m);var R=Math.sin(m);g=c*d/(1-d);d*=1;m=Math.atan2(v+g*R*R*R,L-d*k*k*k);3.141592653589793<a.H(m)&&(m=a.nb(3.141592653589793,m)-m);m=Math.atan(n*Math.tan(m));R=Math.sin(m);k=Math.cos(m);D.l=Math.atan2(v+g*R*R*R,L-d*k*k*k);1.570796326794897<a.H(D.l)&&(D.l=a.nb(3.141592653589793,D.l)-D.l);m=Math.atan(n*Math.tan(D.l));R=Math.sin(m);k=Math.cos(m);b.l=(v-c*R)*Math.sin(D.l)+(L-1*k)*Math.cos(D.l)}};e.n=function(d,g,e){e=Math.sin(e);return d/Math.sqrt(1-g*e*e)};e.sr=function(d,
g){return Math.atan2(Math.sin(g)*(1-d),Math.cos(g))};e.Si=function(d,g){return Math.atan2(Math.sin(g),Math.cos(g)*(1-d))};e.xn=function(d,g){if(a.Ih(d)||0==g||a.S(a.H(g),1.570796326794897))return g;var m,v,D,k,b,c,n,h,l;if(.006884661117170036>d){k=Math.sqrt(1-d);b=(1-k)/(1+k);c=b*b;n=b*c;h=b*n;m=b*h;l=b*m;v=b*l;D=1.572916666666667*n-3.2578125*m+4.295068359375*v;k=2.142578125*h-6.071484375*l;d=3.129296875*m-11.249837239583334*v;var q=4.775276692708333*l,u=7.958636765252976*v,f=Math.cos(2*g);return g+
Math.sin(2*g)*(1.5*b-.84375*n+.525390625*m-.2688395182291667*v-D+d-u+f*(2*(1.3125*c-1.71875*h+1.650146484375*l)-4*k+6*q+f*(4*D-12*d+24*u+f*(8*k-32*q+f*(16*d-80*u+f*(32*q+64*f*u))))))}k=1-d;b=d/2;c=a.H(g);n=c*e.Yr(d)/(1.570796326794897*k);h=9999;l=c;for(c=0;1E-16<h&&50>c;c++)v=e.Tk(d,l),m=(e.Lz(l,d)-b*Math.sin(2*l)/v)/k-n,v=1/(v*v*v),D=m/v,m=l-D,h=a.H(D),l=m;return 0<=g?l:-l};e.nR=function(d,g){return a.Ih(g)?d:d*e.Yr(g)/1.570796326794897};e.W=function(d){d=e.Hz(d,6.283185307179586);return 0>d?d+6.283185307179586:
3.141592653589793>a.H(d)||a.S(a.H(d),3.141592653589793)?d:d-6.283185307179586};e.Hz=function(d,g){return d-Math.floor(d/g)*g};e.gg=function(d,g){if(.006884661117170036>g){g=Math.sqrt(1-g);g=(1-g)/(1+g);var m=g*g,v=m*m;return d/(1+g)*(1+.25*m+.015625*v+.00390625*m*v)*1.570796326794897}return d*e.Yr(g)};e.Dp=function(d,g){var m=a.nb(1,Math.sin(g));g=a.H(e.Hz(g,3.141592653589793));g=1.570796326794897>=g?g:3.141592653589793-g;var v;a.S(g,1.570796326794897)?v=g:v=Math.atan(Math.sqrt(1-d)*Math.tan(g));
return v*m};e.q=function(d,g,m){if(.006884661117170036>g){g=Math.sqrt(1-g);g=(1-g)/(1+g);var v=g*g,k=g*v,a=g*k,b=g*a,c=g*b,n=g*c,h=-.7291666666666666*k+.2278645833333333*b+.03987630208333334*n,l=.615234375*a-.21533203125*c,q=-.54140625*b+.20302734375*n,u=.48876953125*c,f=-.4488699776785715*n,A=Math.cos(2*m);return d/(1+g)*((1+.25*v+.015625*a+.00390625*c)*m+Math.sin(2*m)*(-1.5*g+.1875*k+.0234375*b+.00732421875*n-h+q-f+A*(2*(.9375*v-.234375*a-.03662109375*c)-4*l+6*u+A*(4*h-12*q+24*f+A*(8*l-32*u+A*(16*
q-80*f+A*(32*u+64*A*f)))))))}return d*(e.Lz(m,g)-.5*g*Math.sin(2*m)/e.Tk(g,m))};e.Tk=function(d,g){g=Math.sin(g);return Math.sqrt(1-d*g*g)};e.Yr=function(d){return a.Xz(d,1,2.220446049250313E-16)?1:1>d?e.js(0,1-d)-d/3*e.hs(0,1-d):NaN};e.Lz=function(d,g){var m=a.nb(1,d);d=a.H(d);var v=Math.floor(d/1.570796326794897),D;if(1<g)D=0==d?0:NaN;else if(a.Vc(v))D=e.sin(d),D=D*e.js(1-D*D,1-g*D*D)-g/3*D*D*D*e.hs(1-D*D,1-g*D*D);else{D=k.I.truncate(v%2);var L=e.Yr(g);0<D?(D=Math.sin(1.570796326794897*(v+1)-d),
D=D*e.js(1-D*D,1-g*D*D)-g/3*D*D*D*e.hs(1-D*D,1-g*D*D),D=L*(v+1)-D):(D=Math.sin(d-1.570796326794897*v),D=D*e.js(1-D*D,1-g*D*D)-g/3*D*D*D*e.hs(1-D*D,1-g*D*D),D=L*v+D)}return D*m};e.sin=function(d){d=e.W(d);var g=a.nb(1,d);d=a.H(d);return a.S(d,3.141592653589793)?0:a.S(d,1.570796326794897)?1*g:Math.sin(d)*g};e.hs=function(d,g){for(var e=1,v=0,k=1,L,b,c,n;;){L=.2*(d+g+3*e);b=(L-d)/L;c=(L-g)/L;n=(L-e)/L;if(1E-4>a.H(b)&&1E-4>a.H(c)&&1E-4>a.H(n))break;n=Math.sqrt(g);L=Math.sqrt(e);n=Math.sqrt(d)*(n+L)+n*
L;v+=k/(L*(e+n));k*=.25;d=.25*(d+n);g=.25*(g+n);e=.25*(e+n)}d=b*c;e=n*n;g=d-e;e=d-6*e;b=e+g+g;return 3*v+k*(1+e*(-.2142857142857143+.10227272727272728*e-.1730769230769231*n*b)+n*(.1666666666666667*b+n*(-.4090909090909091*g+.1153846153846154*n*d)))/(L*Math.sqrt(L))};e.js=function(d,g){for(var e,v,k,L,b=1;;b=.25*(b+e)){e=(d+g+b)/3;v=2-(e+d)/e;k=2-(e+g)/e;L=2-(e+b)/e;if(1E-4>a.H(v)&&1E-4>a.H(k)&&1E-4>a.H(L))break;e=Math.sqrt(g);v=Math.sqrt(b);e=Math.sqrt(d)*(e+v)+e*v;d=.25*(d+e);g=.25*(g+e)}d=v*k-L*
L;g=v*k*L;return(1+(.04166666666666666*d-.1-.06818181818181818*g)*d+.07142857142857142*g)/Math.sqrt(e)};e.qu=function(d,g){if(a.Ih(d)||0==g||a.S(a.H(g),1.570796326794897))return g;var e,v,k;if(.006884661117170036>d){e=d*d;v=d*e;k=d*v;var L=d*k,b=d*L,c=d*b,n=-(.02708333333333333*v+.03430059523809524*k+.03149181547619048*L+.02634359154541446*b+.02156896735835538*c),h=.007669890873015873*k+.01299603174603175*L+.0148051353064374*b+.01454454953803912*c,l=-(.002275545634920635*L+.004830845032667949*b+.006558395368616723*
c),q=6.957236677288761E-4*b+.001775193002406544*c,u=-(2.17324089394402E-4*c),f=Math.cos(2*g);return g+Math.sin(2*g)*(-(.5*d+.2083333333333333*e+.09375*v+.04878472222222222*k+.02916666666666667*L+.01938905423280423*b+.01388255931712963*c)-n+l-u+f*(2*(.1041666666666667*e+.0875*v+.06050347222222222*k+.04151785714285714*L+.02958958540013228*b+.02203667534722222*c)-4*h+6*q+f*(4*n-12*l+24*u+f*(8*h-32*q+f*(16*l-80*u+f*(32*q+64*f*u))))))}0==g||a.S(a.H(g),1.570796326794897)?e=g:(v=Math.sqrt(d),k=v*Math.sin(g),
e=Math.tan(.7853981633974483+g/2)*Math.pow((1-k)/(1+k),v/2),e=2*Math.atan(e)-1.570796326794897);return e};e.$K=function(d,g){if(a.Ih(d)||0==g||a.S(a.H(g),1.570796326794897))return g;var e,v;if(.006884661117170036>d){f=d*d;l=d*f;q=d*l;e=d*q;u=d*e;v=d*u;var k=.05833333333333333*l+.07232142857142858*q+.05634300595238095*e+.0355325796406526*u+.020235546186067*v,L=.02653149801587302*q+.04379960317460317*e+.0429211791776896*u+.03255384637546096*v,b=.01294022817460318*e+.02668104344536636*u+.03155651254609588*
v,c=.00659454790965208*u+.0163075268674227*v,n=.003463473736911237*v,h=Math.cos(2*g);return g+Math.sin(2*g)*(.5*d+.2083333333333333*f+.08333333333333333*l+.03611111111111111*q+.01875*e+.01195601851851852*u+.008863673941798942*v-k+b-n+h*(2*(.1458333333333333*f+.1208333333333333*l+.07039930555555556*q+.03616071428571429*e+.01839451058201058*u+.01017113095238095*v)-4*L+6*c+h*(4*k-12*b+24*n+h*(8*L-32*c+h*(16*b-80*n+h*(32*c+64*h*n))))))}for(var l=Math.sqrt(d),q=l/2,u=Math.tan(.7853981633974483+g/2),k=
0,L=1,f=g;0!=L;f=v)if(e=l*Math.sin(f),v=u*Math.pow((1+e)/(1-e),q),v=2*Math.atan(v)-1.570796326794897,k++,a.S(v,f)||3E4<k)L=0;return f};return e}();k.u=b})(x||(x={}));(function(k){var a=function(){function a(){}a.Fb=function(e,d,g,m,v,D,a,b){if(null!=D||null!=a||null!=b){m=k.u.W(m);d=k.u.W(d);g=k.u.W(g);v=k.u.W(v);1.570796326794897<k.j.H(g)&&(g=k.j.nb(3.141592653589793,g)-g,d=k.u.W(d+3.141592653589793));1.570796326794897<k.j.H(v)&&(v=k.j.nb(3.141592653589793,v)-v,m=k.u.W(m+3.141592653589793));var L=
k.u.W(m-d);if(k.j.S(g,v)&&(k.j.S(d,m)||k.j.S(k.j.H(g),1.570796326794897)))null!=D&&(D.l=0),null!=a&&(a.l=0),null!=b&&(b.l=0);else{if(k.j.S(g,-v)){if(k.j.S(k.j.H(g),1.570796326794897)){null!=D&&(D.l=3.141592653589793*e);null!=a&&(a.l=0<g?k.u.W(3.141592653589793-k.u.W(m)):k.u.W(m));null!=b&&(b.l=0<g?k.u.W(m):k.u.W(3.141592653589793-k.u.W(m)));return}if(k.j.S(k.j.H(L),3.141592653589793)){null!=D&&(D.l=3.141592653589793*e);null!=a&&(a.l=0);null!=b&&(b.l=0);return}}var c=1.570796326794897==k.j.H(g)?0:
Math.cos(g),n=Math.sin(g),h=1.570796326794897==k.j.H(v)?0:Math.cos(v),R=Math.sin(v),l=1.570796326794897==k.j.H(L)?0:Math.cos(L),q=3.141592653589793==k.j.H(L)?0:Math.sin(L);if(null!=D){var u=Math.sin((v-g)/2),L=Math.sin(L/2);D.l=2*Math.asin(Math.sqrt(u*u+c*h*L*L))*e}null!=a&&(k.j.S(k.j.H(g),1.570796326794897)?a.l=0>g?m:k.u.W(3.141592653589793-m):a.l=Math.atan2(h*q,c*R-n*h*l));null!=b&&(k.j.S(k.j.H(v),1.570796326794897)?b.l=0>v?d:k.u.W(3.141592653589793-d):(b.l=Math.atan2(c*q,R*c*l-h*n),b.l=k.u.W(b.l+
3.141592653589793)))}}};a.gf=function(e,d,g,m,v,D,a){if(null!=D||null!=a){d=k.u.W(d);g=k.u.W(g);1.570796326794897<k.j.H(g)&&(g=k.j.nb(3.141592653589793,g)-g,d=k.u.W(d+3.141592653589793));k.j.S(k.j.H(g),1.570796326794897)&&(d=0);v=k.u.W(v);var L=k.j.S(k.j.H(v),1.570796326794897)?0:Math.cos(v),b=k.j.S(k.j.H(v),3.141592653589793)?0:Math.sin(v),c=k.j.S(k.j.H(g),1.570796326794897)?0:Math.cos(g),n=Math.sin(g);e=m/e;m=k.j.S(k.j.H(e),1.570796326794897)?0:Math.cos(e);var h=k.j.S(k.j.H(e),3.141592653589793)?
0:Math.sin(e),l=Math.asin(n*m+c*h*L);null!=a&&(a.l=l);null!=D&&(D.l=k.j.S(k.j.H(l),1.570796326794897)?k.j.S(g,-l)?0>l?v:k.u.W(3.141592653589793-v):d:k.j.S(k.j.H(g),1.570796326794897)&&k.j.S(e,3.141592653589793)?0>g?v:k.u.W(3.141592653589793-v):k.u.W(d+Math.atan2(h*b,c*m-n*h*L)))}};return a}();k.zg=a})(x||(x={}));(function(k){var a=function(){function a(){}a.Fb=function(e,d,g,m,v,D,a,b,c){var L=new k.ca(0),n=new k.ca(0),Z=[0,0,0],h=[0,0,0],R=[0,0,0],l=new k.ca(0),q=new k.ca(0),u=new k.ca(0),f=new k.ca(0),
A=new k.ca(0);if(null!=a||null!=b||null!=c)if(k.j.Ih(d))k.zg.Fb(e,g,m,v,D,a,b,c);else{v=k.u.W(v);g=k.u.W(g);var x=k.u.W(v-g);if(k.j.S(m,D)&&(k.j.S(g,v)||k.j.S(k.j.H(m),1.570796326794897)))null!=a&&(a.l=0),null!=b&&(b.l=0),null!=c&&(c.l=0);else{if(k.j.S(m,-D)){if(k.j.S(k.j.H(m),1.570796326794897)){null!=a&&(a.l=2*k.u.gg(e,d));null!=b&&(b.l=0<m?k.u.W(3.141592653589793-k.u.W(v)):k.u.W(v));null!=c&&(c.l=0<m?k.u.W(v):k.u.W(3.141592653589793-k.u.W(v)));return}k.j.S(k.j.H(x),3.141592653589793)&&(null!=a&&
(a.l=2*k.u.gg(e,d)),null!=b&&(b.l=0),null!=c&&(c.l=0))}else if(k.j.S(k.j.H(m),1.570796326794897)||k.j.S(k.j.H(D),1.570796326794897))k.j.S(k.j.H(m),1.570796326794897)?g=v:v=g;var p=0,w;0>x&&(p=1,w=g,g=v,v=w,w=m,m=D,D=w);var x=k.u.sr(d,m),C=k.u.sr(d,D);if(null!=b||null!=c)k.zg.Fb(e,g,x,v,C,null,L,n),L=Math.atan2(Math.sin(L.l)*Math.cos(m-x),Math.cos(L.l)),n=Math.atan2(Math.sin(n.l)*Math.cos(D-C),Math.cos(n.l)),0!=p&&(w=L,L=n,n=w),null!=b&&(b.l=L),null!=c&&(c.l=n);null!=a&&(k.u.wm(d,m,g,u,f,A),Z[0]=u.l,
Z[1]=f.l,Z[2]=A.l,k.u.wm(d,D,v,u,f,A),h[0]=u.l,h[1]=f.l,h[2]=A.l,R[0]=Z[1]*h[2]-h[1]*Z[2],R[1]=-(Z[0]*h[2]-h[0]*Z[2]),R[2]=Z[0]*h[1]-h[0]*Z[1],d=1-k.u.Tk(d,k.u.Dp(d,k.u.Si(d,Math.acos(R[2]/Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]))))),d*=2-d,b=Math.atan2(-R[1],-R[0]),R=k.u.W(b-1.570796326794897),b=k.u.W(b+1.570796326794897),R=k.j.H(k.u.W(g-R))<=k.j.H(k.u.W(g-b))?R:b,k.zg.Fb(1,R,0,g,x,l,null,null),k.zg.Fb(1,R,0,v,C,q,null,null),3.141592653589793<l.l+q.l&&(R=k.u.W(R+3.141592653589793),k.zg.Fb(1,R,0,
g,x,l,null,null),k.zg.Fb(1,R,0,v,C,q,null,null)),l.l*=k.j.nb(1,m),q.l*=k.j.nb(1,D),l.l=k.u.Si(d,l.l),q.l=k.u.Si(d,q.l),g=k.u.q(e,d,l.l),e=k.u.q(e,d,q.l),a.l=k.j.H(e-g))}}};a.gf=function(e,d,g,m,v,D,a,b){var L=0,c=new k.ca(0),n=new k.ca(0),h=[0,0,0],R=[0,0,0],l=new k.ca(0),q=new k.ca(0),u=new k.ca(0);if(null!=a||null!=b)if(k.j.Ih(d))k.zg.gf(e,g,m,v,D,a,b);else if(k.j.Vc(v))null!=a&&(a.l=g),null!=b&&(b.l=m);else{D=k.u.W(D);0>v&&(v=k.j.H(v),D=k.u.W(D+3.141592653589793));g=k.u.W(g);m=k.u.W(m);1.570796326794897<
k.j.H(m)&&(g=k.u.W(g+3.141592653589793),m=k.j.nb(3.141592653589793,m)-m);k.j.S(k.j.H(m),1.570796326794897)&&(g=0);var f;if(k.j.Vc(m))f=k.j.H(1.570796326794897-k.j.H(D)),f=k.u.Si(d,f),f=1-k.u.Tk(d,k.u.Dp(d,f)),f*=2-f,e=v/k.u.gg(e,f)*1.570796326794897,e=k.u.xn(f,e),e=k.u.sr(f,e),k.zg.gf(1,g,m,e,D,a,c),null!=b&&(L=c.l),null!=b&&(b.l=k.u.Si(d,L));else if(k.j.S(k.j.H(m),1.570796326794897))L=k.u.gg(e,d),c=2*L,e=k.j.nb(1.570796326794897,m),D=0<e?k.u.W(3.141592653589793-D):D,m=L-v,k.j.H(m)<=L?null!=a&&(a.l=
D):(m=Math.floor(v/c),0==k.I.truncate(m%2)?(null!=a&&(a.l=D),m=L-(v-m*c)):(null!=a&&(a.l=k.u.W(D+3.141592653589793)),m=L-((m+1)*c-v))),null!=b&&(b.l=k.u.xn(d,m/L*e));else{f=k.u.sr(d,m);D=Math.atan2(Math.sin(D),Math.cos(D)*Math.cos(m-f));var A=k.I.truncate(k.j.nb(1,f))*(1.570796326794897>=k.j.H(D)?1:-1);D=k.u.W(g+Math.atan(Math.tan(D)*-Math.sin(f)));k.zg.Fb(e,D,0,g,f,null,n,null);f=k.j.H(1.570796326794897-k.j.H(n.l));f=k.u.Si(d,f);f=1-k.u.Tk(d,k.u.Dp(d,f));f*=2-f;k.u.wm(d,0,D,l,q,u);h[0]=l.l;h[1]=
q.l;h[2]=u.l;k.u.wm(d,m,g,l,q,u);R[0]=l.l;R[1]=q.l;R[2]=u.l;m=Math.acos((h[0]*R[0]+h[1]*R[1]+h[2]*R[2])/Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]));m=k.u.Si(f,m);m=k.u.q(e,f,m)+v*A;v=0<m?n.l:k.u.W(n.l+3.141592653589793);e=k.j.H(m)/k.u.gg(e,f)*1.570796326794897;e=k.u.xn(f,e);e=k.u.sr(f,e);k.zg.gf(1,D,0,e,v,a,c);null!=b&&(L=c.l);null!=b&&(b.l=k.u.Si(d,L))}}};return a}();k.Xj=a})(x||(x={}));(function(k){var a=function(){function a(){}a.Fb=function(e,d,g,m,v,D,a,b,c){var L=0,n=0,h=0;if(null!=a||null!=b||
null!=c)if(k.j.Ih(d))k.zg.Fb(e,g,m,v,D,a,b,c);else{var Z=k.u.W(v-g);if(k.j.S(m,D)&&(k.j.Vc(Z)||k.j.S(k.j.H(m),1.570796326794897)))null!=a&&(a.l=0),null!=b&&(b.l=0),null!=c&&(c.l=0);else{if(k.j.S(m,-D)){if(k.j.S(k.j.H(m),1.570796326794897)){null!=a&&(a.l=2*k.u.gg(e,d));null!=b&&(b.l=0<m?k.u.W(3.141592653589793-k.u.W(v)):k.u.W(v));null!=c&&(c.l=0<m?k.u.W(v):k.u.W(3.141592653589793-k.u.W(v)));return}k.j.S(k.j.H(Z),3.141592653589793)&&(null!=a&&(a.l=2*k.u.gg(e,d)),null!=b&&(b.l=0),null!=c&&(c.l=0))}else{if(k.j.S(k.j.H(m),
1.570796326794897)||k.j.S(k.j.H(D),1.570796326794897)){k.Xj.Fb(e,d,g,m,v,D,a,b,c);return}if(k.j.Vc(Z)||k.j.S(k.j.H(Z),3.141592653589793)){k.Xj.Fb(e,d,g,m,v,D,a,b,c);return}}var R=1-Math.sqrt(1-d),l=d/(1-d),q=e*(1-R);e=k.u.Dp(d,m);var u=k.u.Dp(d,D);d=1.570796326794897==k.j.H(e)?0:Math.cos(e);var f=Math.sin(e),A=1.570796326794897==k.j.H(u)?0:Math.cos(u),x=Math.sin(u),p=Z,w=Math.cos(p),C=Math.sin(p),t=1,y=0,z,V,E,I,J;do{z=p;V=Math.sqrt(Math.pow(A*C,2)+Math.pow(d*x-f*A*w,2));E=f*x+d*A*w;I=Math.atan2(V,
E);if(0==V){t=0;break}J=d*A*C/V;L=Math.cos(Math.asin(J));L*=L;n=E-2*f*x/L;1<k.j.H(n)&&(n=k.j.nb(1,n));h=n*n;p=R/16*L*(4+R*(4-3*L));p=Z+(1-p)*R*J*(I+p*V*(n+p*E*(2*h-1)));w=Math.cos(p);C=Math.sin(p);y++;if(3.141592653589793<k.j.H(p)&&30<y){t=0;break}}while(5E3>=y&&!k.j.S(z,p));if(0!=t)l*=L,R=l*(256+l*(-128+l*(74-47*l)))/1024,null!=a&&(a.l=q*(1+l*(4096+l*(-768+l*(320-175*l)))/16384)*(I-R*V*(n+R/4*(E*(2*h-1)-R/6*n*(4*V*V-3)*(4*h-3))))),null!=b&&(k.j.S(k.j.H(m),1.570796326794897)?b.l=0>m?v:k.u.W(3.141592653589793-
v):b.l=Math.atan2(A*C,d*x-f*A*w)),null!=c&&(k.j.S(k.j.H(D),1.570796326794897)?c.l=0>D?g:k.u.W(3.141592653589793-g):(c.l=Math.atan2(d*C,d*x*w-f*A),c.l=k.u.W(c.l+3.141592653589793)));else{p=k.j.nb(3.141592653589793,Z);E=f*x-d*A;I=Math.acos(E);V=Math.sin(I);L=1;y=J=0;do h=J,L*=L,w=L*L,J=R*L*(1+R+R*R),n=R*R*w*(1+2.25*R),t=R*R*R*w*L,w=1-.25*J+.1875*n-.1953125*t,J=.25*J-.25*n+.29296875*t,C=.03125*n-.05859375*t,t*=.00651041666666667,n=E-2*f*x/L,1<k.j.H(n)&&(n=k.j.nb(1,n)),L=Math.acos(n),E=Math.cos(2*L),
z=Math.cos(3*L),J=k.j.S(m,-D)?k.u.W(3.141592653589793-Z)/(3.141592653589793*R*w):k.u.W(p-Z)/(R*(w*I+J*V*n+C*Math.sin(2*I)*E+t*Math.sin(3*I)*z)),C=J*V/(d*A),p=1.570796326794897<k.j.H(Z)?k.j.nb(3.141592653589793,C)-Math.asin(C):Math.asin(C),w=Math.cos(p),V=Math.sqrt(Math.pow(A*C,2)+Math.pow(d*x-f*A*w,2)),I=3.141592653589793-Math.asin(k.j.H(V)),E=Math.cos(I),L=Math.cos(Math.asin(J)),y++;while(70>=y&&!k.j.S(h,J));null!=a&&(L*=L,l*=L,w=1+l*(4096+l*(-768+l*(320-175*l)))/16384,k.j.S(m,-D)?a.l=3.141592653589793*
q*w:(n=E-2*f*x/L,L=Math.acos(n),E=Math.cos(2*L),z=Math.cos(3*L),a.l=q*(w*I+l*(-512+l*(128+l*(-60+35*l)))/2048*V*n+l*(-4+5*l)/6144*l*l*Math.sin(2*I)*E+t*Math.sin(3*I)*z+-7.62939453125E-5*l*l*l*l*Math.sin(4*I)*Math.cos(4*L))));null!=b&&(k.j.Vc(m)&&k.j.Vc(D)?(L=Math.sqrt(1-J*J),b.l=Math.acos(L),0>Z&&(b.l*=-1)):k.j.S(k.j.H(m),1.570796326794897)?b.l=0>m?v:k.u.W(3.141592653589793-v):(a=J/d,q=Math.sqrt(1-a*a),0>d*x-f*A*Math.cos(p)&&(q*=-1),b.l=Math.atan2(a,q),k.j.S(m,-D)&&k.j.H(k.u.W(g-v))>3.141592653589793*
(1-R*Math.cos(m))&&(0<m&&1.570796326794897>k.j.H(b.l)||0>m&&1.570796326794897<k.j.H(b.l))&&(b.l=k.j.nb(3.141592653589793,b.l)-b.l)));if(null!=c)if(k.j.Vc(m)&&k.j.Vc(D))L=Math.sqrt(1-J*J),c.l=Math.acos(L),0<=Z&&(c.l*=-1);else if(k.j.S(k.j.H(D),1.570796326794897))c.l=0>D?g:k.u.W(3.141592653589793-g);else if(Z=J/A,a=Math.sqrt(1-Z*Z),q=Math.sin(p/2),0>Math.sin(u-e)-2*d*x*q*q&&(a*=-1),c.l=Math.atan2(Z,a),c.l=k.u.W(c.l+3.141592653589793),k.j.S(m,-D)&&!k.j.Vc(m)&&!k.j.S(k.j.H(m),1.570796326794897)&&k.j.H(k.u.W(g-
v))>3.141592653589793*(1-R*Math.cos(m))&&(null!=b?q=b.l:(a=J/d,q=Math.sqrt(1-a*a),0>d*x-f*A*Math.cos(p)&&(q*=-1),q=Math.atan2(a,q),k.j.S(m,-D)&&k.j.H(k.u.W(g-v))>3.141592653589793*(1-R*Math.cos(m))&&(0<m&&1.570796326794897>k.j.H(q)||0>m&&1.570796326794897<k.j.H(q))&&(q=k.j.nb(3.141592653589793,q)-q)),1.570796326794897>=k.j.H(q)&&1.570796326794897<k.j.H(c.l)||1.570796326794897<=k.j.H(q)&&1.570796326794897>k.j.H(c.l)))c.l=-1*k.u.W(c.l+3.141592653589793)}}}};a.gf=function(e,d,g,m,v,D,a,b){if(null!=a||
null!=b)if(k.j.Ih(d))k.zg.gf(e,g,m,v,D,a,b);else if(D=k.u.W(D),k.j.S(k.j.H(m),1.570796326794897)||k.j.Vc(D)||k.j.S(k.j.H(D),3.141592653589793))k.Xj.gf(e,d,g,m,v,D,a,b);else{var L=1.570796326794897==k.j.H(D)?0:Math.cos(D),c=3.141592653589793==k.j.H(D)?0:Math.sin(D);k.j.S(k.j.H(m),1.570796326794897)&&(g=0);D=1-Math.sqrt(1-d);var n=k.u.Dp(d,m);m=1.570796326794897==k.j.H(n)?0:Math.cos(n);var h=Math.sin(n),n=Math.atan2(Math.tan(n),L),R=m*c,l=R*R,q=1-l,u=d/(1-d)*q;d=u*(256+u*(-128+u*(74-47*u)))/1024;var f=
d/4,A=d/6,x=v/(e*(1-D)*(1+u*(4096+u*(-768+u*(320-175*u)))/16384)),p=x,w;do{w=p;v=1.570796326794897==k.j.H(p)?0:Math.cos(p);var u=3.141592653589793==k.j.H(p)?0:Math.sin(p),C=u*u;e=Math.cos(2*n+p);p=e*e;p=d*u*(e+f*(v*(2*p-1)-A*e*(4*C-3)*(4*p-3)))+x}while(!k.j.S(w,p));v=1.570796326794897==k.j.H(p)?0:Math.cos(p);u=3.141592653589793==k.j.H(p)?0:Math.sin(p);null!=a&&(c=Math.atan2(u*c,m*v-h*u*L),q=D/16*q*(4+D*(4-3*q)),e=Math.cos(2*n+p),a.l=k.u.W(g+(c-(1-q)*D*R*(p+q*u*(e+q*v*(2*e*e-1))))));null!=b&&(q=h*
u-m*v*L,q=(1-D)*Math.sqrt(l+q*q),b.l=Math.atan2(h*v+m*u*L,q))}};return a}();k.cs=a})(x||(x={}));(function(k){var a=function(){function a(){}a.Fb=function(e,d,g,m,v,D,a,b,c){var L=k.u.W(v-g),n=k.j.S(k.j.H(m),1.570796326794897),h=k.j.S(k.j.H(D),1.570796326794897);if(k.j.S(m,D)&&(k.j.Vc(L)||n))null!=a&&(a.l=0),null!=b&&(b.l=0),null!=c&&(c.l=0);else{var Z,R;k.j.Ih(d)?(Z=Math.sin(m),R=Math.sin(D),Z=Math.sqrt((1+Z)/(1-Z)),R=Math.sqrt((1+R)/(1-R)),Z=Math.log(R)-Math.log(Z),Z=Math.atan2(L,Z),null!=a&&(a.l=
k.j.S(m,D)?k.j.H(e*Math.cos(m)*L):k.j.H((e*D-e*m)/Math.cos(Z)))):(R=k.u.qu(d,D),Z=Math.sin(k.u.qu(d,m)),R=Math.sin(R),Z=Math.sqrt((1+Z)/(1-Z)),R=Math.sqrt((1+R)/(1-R)),Z=Math.log(R)-Math.log(Z),Z=Math.atan2(L,Z),null!=a&&(k.j.S(m,D)?a.l=k.j.H(e*L*Math.cos(m)/k.u.Tk(d,m)):(L=k.u.q(e,d,m),e=k.u.q(e,d,D),a.l=k.j.H((e-L)/Math.cos(Z)))));if(null!=b||null!=c)a=k.u.W(Z+3.141592653589793),n&&h||!n&&!h||(n?Z=0>m?v:k.u.W(3.141592653589793-v):h&&(a=0>D?g:k.u.W(3.141592653589793-g))),null!=b&&(b.l=Z),null!=c&&
(c.l=a)}};a.gf=function(e,d,g,m,v,D,a,b){D=k.u.W(D);0>v&&(v=k.j.H(v),D=k.u.W(D+3.141592653589793));k.j.Ih(d)?k.j.S(k.j.H(m),1.570796326794897)?(g=0>m?D:k.u.W(3.141592653589793-D),D=v/e%6.283185307179586,3.141592653589793>=D?e=m-k.j.nb(D,m):(g=k.u.W(g+3.141592653589793),e=-m+k.j.nb(D-3.141592653589793,m))):k.j.S(k.j.H(D),1.570796326794897)?(g=k.u.W(g+k.j.nb(v,D)/(e*Math.cos(m))),e=m):(e=m+v*Math.cos(D)/e,1.570796326794897<k.j.H(e)&&(e=1.570796326794897),k.j.S(k.j.H(e),1.570796326794897)&&(k.j.Vc(D)||
k.j.S(k.j.H(D),3.141592653589793))||(1.570796316258184<k.j.H(e)&&(e=k.j.nb(1.570796316258184,e)),d=Math.sin(m),m=Math.sin(e),d=Math.sqrt((1+d)/(1-d)),m=Math.sqrt((1+m)/(1-m)),d=Math.log(m)-Math.log(d),g=k.u.W(g+Math.tan(D)*d))):k.j.S(k.j.H(m),1.570796326794897)?(g=0>m?D:k.u.W(3.141592653589793-D),D=v/k.u.nR(e,d),D%=6.283185307179586,3.141592653589793>=D?(e=m-k.j.nb(D,m),e=k.u.xn(d,e)):(g=k.u.W(g+3.141592653589793),e=-m+k.j.nb(D-3.141592653589793,m),e=k.u.xn(d,e))):k.j.S(k.j.H(D),1.570796326794897)?
(g=k.u.W(g+k.j.nb(v,D)*k.u.Tk(d,m)/(e*Math.cos(m))),e=m):(e=1.570796326794897*(v*Math.cos(D)+k.u.q(e,d,m))/k.u.gg(e,d),1.570796326794897<k.j.H(e)&&(e=k.j.nb(1.570796326794897,e)),e=k.u.xn(d,e),k.j.S(k.j.H(e),1.570796326794897)&&(k.j.Vc(D)||k.j.S(k.j.H(D),3.141592653589793))||(v=k.u.qu(d,m),m=k.u.qu(d,e),1.570796316258184<k.j.H(m)&&(m=k.j.nb(1.570796316258184,e),e=k.u.$K(d,m)),d=Math.sin(v),m=Math.sin(m),d=Math.sqrt((1+d)/(1-d)),m=Math.sqrt((1+m)/(1-m)),d=Math.log(m)-Math.log(d),g=k.u.W(g+Math.tan(D)*
d)));null!=a&&(a.l=g);null!=b&&(b.l=e)};return a}();k.Zz=a})(x||(x={}));(function(k){var a=function(){function a(){}a.gw=function(e,d,g,m,v,D,a){k.cs.Fb(e,d,g,m,v,D,null,a,null)};a.Ph=function(e,d,g,m,v,D,a,b){k.cs.gf(e,d,g,m,v,D,a,b)};a.Rd=function(e,d,g,m,v,D,a,b,c,n){switch(n){case 2:k.Xj.Fb(e,d,g,m,v,D,a,b,c);break;case 3:k.$z.Fb(e,d,g,m,v,D,a,b,c);break;case 1:k.Zz.Fb(e,d,g,m,v,D,a,b,c);break;default:k.cs.Fb(e,d,g,m,v,D,a,b,c)}};a.dk=function(e,d,g,m,v,D,a,b,c){switch(c){case 2:k.Xj.gf(e,d,g,
m,v,D,a,b);break;case 3:k.$z.gf(e,d,g,m,v,D,a,b);break;case 1:k.Zz.gf(e,d,g,m,v,D,a,b);break;default:k.cs.gf(e,d,g,m,v,D,a,b)}};return a}();k.zb=a})(x||(x={}));(function(k){var a=function(){function a(){}a.QS=function(e,d){var g=8;0>g&&(g=8);var m=[0,0,0,0],v=new k.b;v.J(d);v.scale(9102==k.Ya.Em(e).Se().Qc()?1:k.Ya.Em(e).Se().Dj/3.141592653589793*180);-180>v.x?(v.x-=v.x%360,-180>v.x&&(v.x+=360)):180<v.x&&(v.x-=v.x%360,180<v.x&&(v.x-=360));90<v.y&&(v.y=90);-90>v.y&&(v.y=-90);e=5*g;d=(e+31)/32;for(var D=
-180,L=180,b=e-1,c=d-1;0<=c;c--)for(var n=b-32*c,h=Math.min(32,e-32*c),l=1;l<h;l+=2){var q=.5*(L+D);v.x>=q?(m[c]|=1<<n,D=q):L=q;n-=2;b-=2}D=-90;L=90;b=e-2;for(c=d-1;0<=c;c--)for(n=b-32*c,h=Math.min(32,e-32*c),l=0;l<h;l+=2)q=.5*(L+D),v.y>=q?(m[c]|=1<<n,D=q):L=q,n-=2,b-=2;return a.XS(m,g,g)};a.XS=function(e,d,g){for(var m=[],v=0;v<d;v++)m[v]="";for(var k=v=0,a=0;a<d;a++){var b=e[v]>>k&31,k=k+5;if(31<k){var c=37-k,b=b&(1<<c)-1,k=k-32;v++;b|=(e[v]&(1<<k)-1)<<c}m[d-1-a]="0123456789bcdefghjkmnpqrstuvwxyz".split("")[b]}if(g>
d)for(a=0;a<g-d;a++)m.push("0");else g<d&&(m.length=g);return m.join("")};return a}();k.qH=a})(x||(x={}));(function(k){var a={gcstol:[0,1E-8,1,1.11111E-8,2,1.68845E-8,3,2.17661E-8,4,2.22508E-8,5,2.34848E-8,6,2.37811E-8,7,2.88455E-8,8,3.1456E-8,9,3.29779E-8,10,3.66789E-8,11,4.23597E-8,12,4.79463E-8,13,6.45223E-8,14,7.26274E-8,15,7.49945E-8,16,7.52506E-8,17,7.97991E-8,18,9.66202E-8,19,9.79918E-8,20,9.89735E-8,21,1.02314E-7,22,1.08146E-7,23,2.29734E-7,24,2.42985E-7,25,2.7546E-7,26,3.37034E-7,27,4.30795E-7,
28,5.20871E-7,29,5.50921E-7,30,6.74068E-7,31,6.86177E-7,32,7.25263E-7,33,7.44101E-7,34,7.74267E-7,35,9.62954E-7,36,1.06103E-6,37,1.14363E-6,38,1.16219E-6,39,1.36419E-6,40,1.36744E-6,41,1.43239E-6,42,1.73624E-6,43,1.84825E-6,44,1.90986E-6,45,1.97572E-6,46,2.12207E-6,47,2.72837E-6,48,3.1831E-6,49,3.58099E-6,50,3.81972E-6,51,4.09256E-6,52,4.40737E-6,53,4.77465E-6,54,5.16178E-6,55,5.20871E-6,56,5.72958E-6,57,6.03113E-6,58,6.98729E-6,59,9.24125E-6,60,1.14592E-5],pcstol:[0,6.66667E-9,1,2E-8,2,4.97098E-5,
3,.001,4,.00109362,5,.00328087,6,.00497101],newtoold:[2154,102110,2195,102200,2204,32036,2205,26979,2225,102641,2226,102642,2227,102643,2228,102644,2229,102645,2230,102646,2231,102653,2232,102654,2233,102655,2234,102656,2235,102657,2236,102658,2237,102659,2238,102660,2239,102666,2240,102667,2241,102668,2242,102669,2243,102670,2246,102679,2247,102680,2248,102685,2249,102686,2250,102687,2254,102694,2255,102695,2257,102712,2258,102713,2259,102714,2260,102715,2261,102716,2262,102717,2263,102718,2264,
102719,2267,102724,2268,102725,2271,102728,2272,102729,2274,102736,2275,102737,2276,102738,2277,102739,2278,102740,2279,102741,2283,102746,2284,102747,2285,102748,2286,102749,2287,102752,2288,102753,2289,102754,2312,23433,2326,102140,2395,2091,2396,2092,2397,2166,2398,2167,2399,2168,2759,102229,2760,102230,2761,102248,2762,102249,2763,102250,2764,102251,2765,102252,2766,102241,2767,102242,2768,102243,2769,102244,2770,102245,2771,102246,2772,102253,2773,102254,2774,102255,2775,102256,2776,102257,2777,
102258,2778,102259,2779,102260,2780,102266,2781,102267,2782,102261,2783,102262,2784,102263,2785,102264,2786,102265,2787,102268,2788,102269,2789,102270,2790,102271,2791,102272,2792,102273,2793,102274,2794,102275,2795,102276,2796,102277,2797,102278,2798,102279,2799,102280,2800,102281,2801,102282,2802,102283,2803,102284,2804,102285,2805,102286,2806,102287,2807,102288,2808,102289,2809,102290,2810,102291,2811,102292,2812,102293,2813,102294,2814,102295,2815,102296,2816,102297,2817,102298,2818,102300,2819,
102304,2820,102307,2821,102308,2822,102309,2823,102310,2824,102311,2825,102312,2826,102313,2827,102314,2828,102315,2829,102316,2830,102317,2831,102318,2832,102320,2833,102321,2834,102322,2835,102323,2836,102324,2837,102325,2838,102326,2839,102327,2840,102330,2841,102334,2842,102335,2843,102336,2844,102337,2845,102338,2846,102339,2847,102340,2848,102341,2849,102342,2850,102343,2851,102344,2852,102345,2853,102346,2854,102347,2855,102348,2856,102349,2857,102350,2858,102351,2859,102352,2860,102353,2861,
102354,2862,102355,2863,102356,2864,102357,2865,102358,2866,102361,2942,102167,2943,102169,2944,2139,2945,2140,2946,2141,2947,2142,2948,2143,2949,2144,2950,2145,2951,2146,2952,2147,2953,2036,2954,2291,2955,2153,2956,2152,2957,2151,2958,2150,2959,2149,2960,2037,2961,2038,2962,2148,2965,2244,2966,2245,3003,102091,3004,102092,3005,102190,3060,2982,3067,102139,3072,102606,3074,102608,3075,102208,3077,102210,3078,102123,3080,102119,3081,102603,3082,102602,3083,102601,3088,65163,3089,102763,3090,102363,
3092,102151,3093,102152,3094,102153,3095,102154,3096,102155,3097,102145,3098,102146,3099,102147,3100,102148,3101,102149,3102,2155,3107,102172,3110,102170,3111,102171,3119,2214,3158,102234,3159,102235,3160,102236,3336,2979,3338,102006,3346,2600,3370,102126,3371,102127,3372,102130,3373,102131,3400,102184,3401,102185,3404,3359,3407,3366,3417,102675,3418,102676,3419,102677,3420,102678,3421,102707,3422,102708,3423,102709,3424,102711,3433,102651,3434,102652,3435,102671,3436,102672,3437,102710,3438,102730,
3448,102095,3451,102681,3452,102682,3455,102735,3461,2063,3462,2064,3463,3073,3464,3076,3560,102742,3566,102743,3567,102744,3734,102722,3735,102723,3736,102755,3737,102756,3738,102757,3739,102758,3741,102205,3742,102206,3743,102207,3748,102211,3750,102202,3751,102203,3759,102663,3760,102463,3764,102112,3770,102090,3771,102180,3772,102181,3773,102182,3775,102186,3776,102187,3777,102188,3800,102183,3801,102189,3812,102199,3814,102609,3815,102469,3819,104990,3821,104136,3824,104137,3825,102444,3826,
102443,3827,102442,3828,102441,3857,102100,3889,104991,3906,104992,4048,103201,4049,103202,4050,103203,4051,103204,4056,103205,4057,103206,4058,103207,4059,103208,4060,103209,4061,103210,4062,103211,4063,103212,4071,103213,4082,103214,4083,103215,4093,103216,4094,103217,4095,103218,4096,103219,4167,104108,4169,37252,4171,104107,4189,104110,4197,4234,4223,37223,4304,104304,4414,102201,4415,102762,4417,102764,4434,102765,4437,102647,4455,32029,4456,32018,4457,3454,4462,102439,4463,4466,4470,4469,4484,
103794,4485,103795,4486,103796,4487,103797,4488,103798,4489,103799,4611,104104,4612,104111,4613,37255,4615,37247,4616,37250,4617,4140,4618,4291,4620,37211,4626,37235,4647,102362,4658,37204,4668,37201,4669,4126,4672,37217,4673,104125,4675,37220,4684,37232,4698,4631,4707,37213,4708,37231,4709,37212,4710,37238,4711,37214,4712,37237,4713,37208,4714,37215,4715,37253,4716,37216,4717,37239,4719,37219,4722,37242,4724,37233,4725,37222,4727,37224,4728,37246,4729,37226,4730,37227,4731,37228,4732,37229,4733,
37230,4734,37251,4735,37259,4736,37254,4739,37205,4758,104133,4760,37001,4762,104114,4826,102214,5013,104142,5014,102331,5015,102332,5016,102333,5173,102085,5174,102086,5175,102087,5176,102088,5177,102089,5178,102040,5179,102080,5185,102081,5186,102082,5187,102083,5188,102084,5221,102066,5246,104100,5247,102490,5324,104144,5325,102420,5329,2934,5365,104143,5367,102305,5451,104132,5513,102065,5514,102067,5519,102111,5520,31461,5646,102745,5839,5388,5858,5532,5879,4474,21896,21891,21897,21892,21898,
21893,21899,21894,26701,102124,26702,102125,26799,26747,26847,102683,26848,102684,26849,102691,26850,102692,26851,102693,26852,102704,26853,102750,26854,102751,26857,102466,26858,102467,26859,102468,26901,102128,26902,102129,27493,27492,29101,29100,29168,29118,29169,29119,29170,29120,29171,29121,29172,29122,29187,29177,29188,29178,29189,29179,29190,29180,29191,29181,29192,29182,29193,29183,29194,29184,29195,29185,29902,29900,31279,31278,31281,31291,31282,31292,31283,31293,31284,31294,31285,31295,
31286,31296,31287,31297,31466,31462,31467,31463,31468,31464,31469,31465,31986,31917,31987,31918,31988,31919,31989,31920,31990,31921,31991,31922,32064,32074,32065,32075,32066,32076,32067,32077],pcsid:[2066,6,2136,5,2155,5,2157,3,2158,3,2159,5,2160,5,2219,3,2220,3,2244,5,2245,5,2256,5,2265,5,2266,5,2269,5,2270,5,2273,5,2290,3,2291,3,2294,3,2295,3,2313,3,2314,5,2964,5,2967,5,2968,5,2991,3,2992,5,2993,3,2994,5,3073,3,3076,3,3079,3,3091,5,3106,3,3108,3,3109,3,3141,3,3142,3,3167,2,3337,3,3347,3,3348,3,
3359,5,3360,3,3361,5,3362,3,3363,5,3364,3,3365,5,3366,5,3402,3,3403,3,3405,3,3406,3,3439,3,3440,3,3447,3,3449,3,3450,3,3453,5,3454,5,3460,3,3479,5,3480,3,3481,5,3482,3,3483,5,3484,3,3485,5,3486,3,3487,5,3488,3,3489,3,3490,5,3491,3,3492,5,3493,3,3494,5,3495,3,3496,5,3497,3,3498,5,3499,3,3500,5,3501,3,3502,5,3503,3,3504,5,3505,3,3506,5,3507,3,3508,5,3509,3,3510,5,3511,3,3512,5,3513,3,3514,3,3515,5,3516,3,3517,5,3518,3,3519,5,3520,3,3521,5,3522,3,3523,5,3524,3,3525,5,3526,3,3527,5,3528,3,3529,5,3530,
3,3531,5,3532,3,3533,5,3534,3,3535,5,3536,3,3537,5,3538,3,3539,5,3540,3,3541,5,3542,3,3543,5,3544,3,3545,5,3546,3,3547,5,3548,3,3549,5,3550,3,3551,5,3552,3,3553,5,3582,5,3583,3,3584,5,3585,3,3586,5,3587,3,3588,5,3589,3,3590,5,3591,3,3592,3,3593,5,3598,5,3599,3,3600,5,3605,5,3606,3,3607,3,3608,5,3609,3,3610,5,3611,3,3612,5,3613,3,3614,5,3615,3,3616,5,3617,3,3618,5,3619,3,3620,5,3621,3,3622,5,3623,3,3624,5,3625,3,3626,5,3627,3,3628,5,3629,3,3630,5,3631,3,3632,5,3633,3,3634,5,3635,3,3636,5,3640,5,3641,
3,3642,5,3643,3,3644,5,3645,3,3646,5,3647,3,3648,5,3649,3,3650,5,3651,3,3652,5,3653,3,3654,5,3655,3,3656,5,3657,3,3658,5,3659,3,3660,5,3661,3,3662,5,3663,3,3664,5,3668,5,3669,3,3670,5,3671,3,3672,5,3673,3,3674,5,3675,3,3676,5,3677,5,3678,3,3679,5,3680,5,3681,3,3682,5,3683,5,3684,3,3685,3,3686,5,3687,3,3688,5,3689,3,3690,5,3691,3,3692,5,3696,5,3697,3,3698,5,3699,3,3700,5,3740,3,3749,3,3783,3,3784,3,3793,3,3794,3,3802,3,3816,3,3829,3,3854,3,3920,3,3978,3,3979,3,3991,5,3992,5,4026,3,4037,3,4038,3,4217,
5,4438,5,4439,5,4467,3,4471,3,4474,3,4559,3,4839,3,5018,3,5048,3,5167,3,5168,3,5223,3,5234,3,5235,3,5243,3,5266,3,5316,3,5320,3,5321,3,5330,3,5331,3,5337,3,5361,3,5362,3,5382,3,5383,3,5396,3,5456,3,5457,3,5469,3,5472,4,5490,3,5518,3,5523,3,5559,3,5588,5,5589,5,5596,3,5627,3,5629,3,5641,3,5643,3,5644,3,5654,5,5655,5,5659,3,5700,3,5825,3,5836,3,5837,3,5842,3,5844,3,5880,3,5887,3,5890,3,20499,3,20538,3,20539,3,20790,3,20791,3,21291,3,21292,3,21500,3,21817,3,21818,3,22032,3,22033,3,22091,3,22092,3,22332,
3,22391,3,22392,3,22700,3,22770,3,22780,3,22832,3,23090,3,23095,3,23239,3,23240,3,23433,3,23700,3,24047,3,24048,3,24100,5,24200,3,24305,3,24306,3,24382,4,24383,3,24500,3,24547,3,24548,3,24571,2,24600,3,25E3,3,25231,3,25884,3,25932,3,26237,3,26331,3,26332,3,26591,3,26592,3,26632,3,26692,3,26855,5,26856,5,27120,3,27200,3,27291,4,27292,4,27429,3,27492,3,27500,3,27700,3,28232,3,28600,3,28991,3,28992,3,29100,3,29220,3,29221,3,29333,3,29635,3,29636,3,29701,3,29738,3,29739,3,29849,3,29850,3,29871,2,29872,
5,29873,3,29900,3,29901,3,29903,3,30200,6,30339,3,30340,3,30591,3,30592,3,30791,3,30792,3,31028,3,31121,3,31154,3,31170,3,31171,3,31370,3,31528,3,31529,3,31600,3,31700,3,31838,3,31839,3,31901,3,32061,3,32062,3,32098,3,32099,5,32100,3,32104,3,32161,3,32766,3,53034,3,53048,3,53049,3,54034,3,65061,5,65062,5,65161,3,65163,3,102041,5,102064,4,102068,1,102069,0,102217,5,102218,3,102219,5,102220,5,102378,5,102379,5,102380,3,102381,5,102589,5,102599,5,102600,5,102604,5,102605,3,102606,3,102647,3,102704,5,
102705,5,102733,5,102761,5,102762,3,102763,5,102764,3,102765,3,102766,5,102970,5,102974,5,102993,3,102994,3,102995,5,102996,5,103015,3,103016,5,103017,3,103018,5,103025,3,103026,3,103027,5,103028,5,103035,3,103036,3,103037,5,103038,5,103039,3,103040,3,103041,5,103042,5,103043,3,103044,3,103045,5,103046,5,103047,3,103048,3,103049,5,103050,5,103051,3,103052,5,103053,3,103054,5,103055,3,103056,5,103057,3,103058,3,103059,5,103060,5,103061,3,103062,3,103063,5,103064,5,103069,5,103070,3,103071,3,103072,
5,103073,5,103086,3,103087,3,103088,5,103089,5,103094,5,103095,3,103096,5,103103,3,103104,5,103105,3,103106,5,103121,3,103122,5,103123,3,103124,3,103125,5,103126,5,103127,3,103128,3,103129,5,103130,5,103131,3,103132,3,103133,5,103134,5,103135,3,103136,3,103137,5,103138,5,103139,3,103140,5,103141,3,103142,5,103143,3,103144,5,103145,3,103146,5,103147,3,103148,3,103149,5,103150,5,103151,3,103152,5,103172,3,103173,5,103174,3,103175,3,103176,5,103177,5,103178,3,103179,3,103180,5,103181,5,103182,3,103183,
3,103184,5,103185,5,103228,3,103229,3,103230,5,103231,5,103250,3,103251,5,103252,3,103253,5,103260,3,103261,3,103262,5,103263,5,103270,3,103271,3,103272,5,103273,5,103274,3,103275,3,103276,5,103277,5,103278,3,103279,3,103280,5,103281,5,103282,3,103283,3,103284,5,103285,5,103286,3,103287,5,103288,3,103289,5,103290,3,103291,5,103292,3,103293,3,103294,5,103295,5,103296,3,103297,3,103298,5,103299,5,103376,5,103377,3,103378,3,103379,5,103380,5,103393,3,103394,3,103395,5,103396,5,103472,3,103473,5,103474,
3,103475,5,103482,3,103483,5,103484,3,103485,5,103500,3,103501,5,103502,3,103503,3,103504,5,103505,5,103506,3,103507,3,103508,5,103509,5,103510,3,103511,3,103512,5,103513,5,103514,3,103515,5,103516,3,103517,5,103518,3,103519,5,103520,3,103521,5,103522,3,103523,3,103524,5,103525,5,103526,3,103527,5,103561,5,103562,5,103563,3,103564,3,103565,5,103566,5,103567,3,103568,3,103569,5,103570,5,103585,5,103695,5],pcsidc:[[2E3,2045,3],[2056,2065,3],[2067,2135,3],[2137,2153,3],[2161,2170,3],[2172,2193,3],[2196,
2198,3],[2200,2203,3],[2206,2217,3],[2222,2224,5],[2251,2253,5],[2280,2282,5],[2308,2311,3],[2315,2325,3],[2327,2394,3],[2400,2462,3],[2523,2576,3],[2578,2693,3],[2695,2758,3],[2867,2888,5],[2891,2930,5],[2931,2941,3],[2969,2973,3],[2975,2982,3],[2984,2988,3],[2995,3002,3],[3006,3051,3],[3054,3059,3],[3061,3066,3],[3068,3071,3],[3084,3087,3],[3112,3118,3],[3120,3138,3],[3146,3151,3],[3153,3157,3],[3161,3166,3],[3168,3172,3],[3174,3203,3],[3294,3313,3],[3315,3335,3],[3339,3345,3],[3350,3358,3],[3367,
3369,3],[3374,3399,3],[3408,3416,3],[3425,3432,5],[3441,3446,5],[3456,3459,5],[3465,3478,3],[3554,3559,3],[3561,3565,5],[3568,3570,5],[3571,3581,3],[3594,3597,3],[3601,3604,3],[3637,3639,3],[3665,3667,3],[3693,3695,3],[3701,3727,3],[3728,3733,5],[3744,3747,3],[3753,3758,5],[3761,3763,3],[3765,3769,3],[3779,3781,3],[3788,3791,3],[3797,3799,3],[3832,3841,3],[3844,3852,3],[3873,3885,3],[3890,3893,3],[3907,3912,3],[3942,3950,3],[3968,3970,3],[3973,3976,3],[3986,3989,3],[3994,3997,3],[4399,4413,5],[4418,
4433,5],[4491,4554,3],[5069,5072,3],[5105,5130,3],[5180,5184,3],[5253,5259,3],[5269,5275,3],[5292,5311,3],[5343,5349,3],[5355,5357,3],[5387,5389,3],[5459,5463,3],[5479,5482,3],[5530,5539,3],[5550,5552,3],[5562,5583,3],[5623,5625,5],[5631,5639,3],[5649,5653,3],[5663,5680,3],[5682,5685,3],[5875,5877,3],[20002,20032,3],[20062,20092,3],[20135,20138,3],[20248,20258,3],[20348,20358,3],[20436,20440,3],[20822,20824,3],[20934,20936,3],[21035,21037,3],[21095,21097,3],[21148,21150,3],[21413,21423,3],[21473,
21483,3],[21780,21782,3],[21891,21894,3],[22171,22177,3],[22181,22187,3],[22191,22197,3],[22234,22236,3],[22521,22525,3],[22991,22994,3],[23028,23038,3],[23830,23853,3],[23866,23872,3],[23877,23884,3],[23886,23894,3],[23946,23948,3],[24311,24313,3],[24342,24347,3],[24370,24374,4],[24375,24381,3],[24718,24721,3],[24817,24821,3],[24877,24882,3],[24891,24893,3],[25391,25395,3],[25828,25838,3],[26191,26195,3],[26391,26393,3],[26703,26722,3],[26729,26760,5],[26766,26798,5],[26860,26870,5],[26891,26899,
3],[26903,26923,3],[26929,26946,3],[26948,26998,3],[27037,27040,3],[27205,27232,3],[27258,27260,3],[27391,27398,3],[27561,27564,3],[27571,27574,3],[27581,27584,3],[27591,27594,3],[28191,28193,3],[28348,28358,3],[28402,28432,3],[28462,28492,3],[29118,29122,3],[29177,29185,3],[30161,30179,3],[30491,30494,3],[30729,30732,3],[31251,31259,3],[31265,31268,3],[31275,31278,3],[31288,31297,3],[31461,31465,3],[31491,31495,3],[31917,31922,3],[31965,31985,3],[31992,32E3,3],[32001,32003,5],[32005,32031,5],[32033,
32060,5],[32074,32077,5],[32081,32086,3],[32107,32130,3],[32133,32158,3],[32164,32167,5],[32180,32199,3],[32201,32260,3],[32301,32360,3],[32601,32662,3],[32664,32667,5],[32701,32761,3],[53001,53004,3],[53008,53019,3],[53021,53032,3],[53042,53046,3],[54001,54004,3],[54008,54019,3],[54021,54032,3],[54042,54046,3],[54048,54053,3],[102001,102040,3],[102042,102063,3],[102065,102067,3],[102070,102112,3],[102114,102117,3],[102118,102121,5],[102122,102208,3],[102210,102216,3],[102221,102300,3],[102304,102377,
3],[102382,102388,3],[102389,102391,5],[102401,102444,3],[102450,102452,3],[102461,102468,5],[102469,102492,3],[102500,102519,5],[102530,102549,3],[102570,102588,3],[102590,102598,3],[102601,102603,3],[102608,102628,3],[102629,102646,5],[102648,102672,5],[102675,102700,5],[102701,102703,3],[102707,102730,5],[102735,102758,5],[102767,102798,3],[102962,102969,3],[102971,102973,3],[102975,102989,3],[102990,102992,5],[102997,103002,3],[103003,103008,5],[103009,103011,3],[103012,103014,5],[103019,103021,
3],[103022,103024,5],[103029,103031,3],[103032,103034,5],[103065,103068,3],[103074,103076,3],[103077,103079,5],[103080,103082,3],[103083,103085,5],[103090,103093,3],[103097,103099,3],[103100,103102,5],[103107,103109,3],[103110,103112,5],[103113,103116,3],[103117,103120,5],[103153,103157,3],[103158,103162,5],[103163,103165,3],[103166,103171,5],[103186,103188,3],[103189,103191,5],[103192,103195,3],[103196,103199,5],[103200,103224,3],[103225,103227,5],[103232,103237,3],[103238,103243,5],[103244,103246,
3],[103247,103249,5],[103254,103256,3],[103257,103259,5],[103264,103266,3],[103267,103269,5],[103300,103375,3],[103381,103383,3],[103384,103386,5],[103387,103389,3],[103390,103392,5],[103397,103399,3],[103400,103471,5],[103476,103478,3],[103479,103481,5],[103486,103488,3],[103489,103491,5],[103492,103495,3],[103496,103499,5],[103539,103543,3],[103544,103548,5],[103549,103551,3],[103552,103557,5],[103558,103560,3],[103571,103573,3],[103574,103576,5],[103577,103580,3],[103581,103583,5],[103600,103694,
3],[103700,103793,5],[103794,103799,3]],gcsid:[4042,0,4075,0,4081,0,4168,0,4170,0,4188,0,4261,1,4262,0,4263,0,4288,0,4289,0,4305,1,4322,0,4324,0,4326,0,4466,0,4469,0,4475,0,4483,0,4490,0,4555,0,4558,0,4614,0,4619,0,4657,0,4670,0,4671,0,4674,0,4682,0,4683,0,4718,0,4720,0,4721,0,4723,0,4726,0,4737,0,4738,0,4759,0,4761,0,4807,1,4808,0,4809,0,4816,1,4817,0,4818,0,4819,1,4820,0,4821,1,4823,0,4824,0,4901,1,4902,1,4903,0,4904,0,5228,0,5229,0,5233,0,5252,0,5264,0,5340,0,5354,0,5360,0,5371,0,5373,0,5381,0,
5393,0,5464,0,5467,0,5489,0,5524,0,5527,0,5546,0,5561,0,5593,0,5681,0,5886,0,37225,1,37235,0,37257,0,37259,0,37260,0,104020,0,104139,1,104140,1,104223,0,104286,0,104287,0,104304,0,104305,0,104896,0,104900,5,104901,0,104902,0,104903,9,104904,2,104905,2,104906,59,104907,54,104908,0,104909,58,104910,31,104911,56,104912,6,104913,50,104914,41,104915,10,104916,3,104917,30,104918,8,104919,60,104920,53,104921,44,104922,48,104923,51,104924,38,104925,0,104926,49,104927,57,104928,21,104929,23,104930,35,104931,
49,104932,27,104933,17,104934,13,104935,7,104936,56,104937,40,104938,28,104939,37,104940,15,104941,55,104942,22,104943,4,104944,0,104945,20,104946,42,104947,47,104948,52,104949,43,104950,46,104951,39,104952,24,104953,16,104954,50,104955,36,104956,33,104957,46,104958,14,104959,19,104960,0,104961,34,104962,32,104963,29,104964,45,104965,26,104966,25,104967,41,104968,11,104969,12,104970,18],gcsidc:[[4001,4016,0],[4018,4025,0],[4027,4029,0],[4031,4036,0],[4044,4047,0],[4052,4054,0],[4120,4166,0],[4172,
4176,0],[4178,4185,0],[4190,4196,0],[4198,4216,0],[4218,4222,0],[4224,4232,0],[4234,4260,0],[4265,4267,0],[4269,4286,0],[4291,4303,0],[4306,4319,0],[4600,4610,0],[4621,4625,0],[4627,4633,0],[4636,4639,0],[4641,4646,0],[4659,4667,0],[4676,4680,0],[4686,4697,0],[4699,4706,0],[4740,4757,0],[4763,4765,0],[4801,4806,0],[4810,4812,1],[4813,4815,0],[37001,37008,0],[37201,37208,0],[37211,37224,0],[37226,37233,0],[37237,37243,0],[37245,37247,0],[37249,37255,0],[104100,104138,0],[104141,104145,0],[104256,104261,
0],[104700,104786,0],[104990,104992,0]]},b={c:[[2E3,2045,9001],[2056,2065,9001],[2067,2135,9001],[2137,2153,9001],[2161,2170,9001],[2172,2193,9001],[2196,2198,9001],[2200,2203,9001],[2206,2217,9001],[2222,2224,9002],[2251,2253,9002],[2280,2282,9002],[2308,2311,9001],[2315,2325,9001],[2327,2394,9001],[2400,2462,9001],[2523,2576,9001],[2578,2693,9001],[2695,2758,9001],[2867,2869,9002],[2870,2888,9003],[2891,2895,9003],[2896,2898,9002],[2902,2908,9003],[2915,2920,9003],[2921,2923,9002],[2924,2930,9003],
[2931,2941,9001],[2969,2973,9001],[2975,2982,9001],[2984,2988,9001],[2995,3002,9001],[3006,3051,9001],[3054,3059,9001],[3061,3066,9001],[3068,3071,9001],[3084,3087,9001],[3112,3118,9001],[3120,3138,9001],[3146,3151,9001],[3153,3157,9001],[3161,3166,9001],[3168,3172,9001],[3174,3203,9001],[3294,3313,9001],[3315,3335,9001],[3339,3345,9001],[3350,3358,9001],[3367,3369,9001],[3374,3399,9001],[3408,3416,9001],[3425,3432,9003],[3441,3446,9003],[3456,3459,9003],[3465,3478,9001],[3554,3559,9001],[3561,3565,
9003],[3568,3570,9003],[3571,3581,9001],[3594,3597,9001],[3601,3604,9001],[3637,3639,9001],[3665,3667,9001],[3693,3695,9001],[3701,3727,9001],[3728,3733,9003],[3744,3747,9001],[3753,3758,9003],[3761,3763,9001],[3765,3769,9001],[3779,3781,9001],[3788,3791,9001],[3797,3799,9001],[3832,3841,9001],[3844,3852,9001],[3873,3885,9001],[3890,3893,9001],[3907,3912,9001],[3942,3950,9001],[3968,3970,9001],[3973,3976,9001],[3986,3989,9001],[3994,3997,9001],[4001,4016,9102],[4018,4025,9102],[4027,4029,9102],[4031,
4036,9102],[4044,4047,9102],[4052,4054,9102],[4120,4166,9102],[4172,4176,9102],[4178,4185,9102],[4190,4196,9102],[4198,4216,9102],[4218,4222,9102],[4224,4232,9102],[4234,4260,9102],[4265,4267,9102],[4269,4286,9102],[4291,4303,9102],[4306,4319,9102],[4399,4413,9003],[4418,4433,9003],[4491,4554,9001],[4600,4610,9102],[4621,4625,9102],[4627,4633,9102],[4636,4639,9102],[4641,4646,9102],[4659,4667,9102],[4676,4680,9102],[4686,4697,9102],[4699,4706,9102],[4740,4757,9102],[4763,4765,9102],[4801,4806,9102],
[4810,4812,9105],[4813,4815,9102],[5069,5072,9001],[5105,5130,9001],[5180,5184,9001],[5253,5259,9001],[5269,5275,9001],[5292,5311,9001],[5343,5349,9001],[5355,5357,9001],[5387,5389,9001],[5459,5463,9001],[5479,5482,9001],[5530,5539,9001],[5550,5552,9001],[5562,5583,9001],[5623,5625,9003],[5631,5639,9001],[5649,5653,9001],[5663,5680,9001],[5682,5685,9001],[5875,5877,9001],[20002,20032,9001],[20062,20092,9001],[20135,20138,9001],[20248,20258,9001],[20348,20358,9001],[20436,20440,9001],[20822,20824,
9001],[20934,20936,9001],[21035,21037,9001],[21095,21097,9001],[21148,21150,9001],[21413,21423,9001],[21473,21483,9001],[21780,21782,9001],[21891,21894,9001],[22171,22177,9001],[22181,22187,9001],[22191,22197,9001],[22234,22236,9001],[22521,22525,9001],[22991,22994,9001],[23028,23038,9001],[23830,23853,9001],[23866,23872,9001],[23877,23884,9001],[23886,23894,9001],[23946,23948,9001],[24311,24313,9001],[24342,24347,9001],[24370,24374,9084],[24375,24381,9001],[24718,24721,9001],[24817,24821,9001],[24877,
24882,9001],[24891,24893,9001],[25391,25395,9001],[25828,25838,9001],[26191,26195,9001],[26391,26393,9001],[26703,26722,9001],[26729,26760,9003],[26766,26798,9003],[26860,26870,9003],[26891,26899,9001],[26903,26923,9001],[26929,26946,9001],[26948,26998,9001],[27037,27040,9001],[27205,27232,9001],[27258,27260,9001],[27391,27398,9001],[27561,27564,9001],[27571,27574,9001],[27581,27584,9001],[27591,27594,9001],[28191,28193,9001],[28348,28358,9001],[28402,28432,9001],[28462,28492,9001],[29118,29122,9001],
[29177,29185,9001],[30161,30179,9001],[30491,30494,9001],[30729,30732,9001],[31251,31259,9001],[31265,31268,9001],[31275,31278,9001],[31288,31297,9001],[31461,31465,9001],[31491,31495,9001],[31917,31922,9001],[31965,31985,9001],[31992,32E3,9001],[32001,32003,9003],[32005,32031,9003],[32033,32060,9003],[32074,32077,9003],[32081,32086,9001],[32107,32130,9001],[32133,32158,9001],[32164,32167,9003],[32180,32199,9001],[32201,32260,9001],[32301,32360,9001],[32601,32662,9001],[32664,32667,9003],[32701,32761,
9001],[37001,37008,9102],[37201,37208,9102],[37211,37224,9102],[37226,37233,9102],[37237,37243,9102],[37245,37247,9102],[37249,37255,9102],[53001,53004,9001],[53008,53019,9001],[53021,53032,9001],[53042,53046,9001],[54001,54004,9001],[54008,54019,9001],[54021,54032,9001],[54042,54046,9001],[54048,54053,9001],[102001,102040,9001],[102042,102063,9001],[102065,102067,9001],[102070,102112,9001],[102114,102117,9001],[102122,102208,9001],[102210,102216,9001],[102221,102300,9001],[102304,102377,9001],[102382,
102388,9001],[102389,102391,9003],[102401,102444,9001],[102450,102452,9001],[102461,102468,9003],[102469,102492,9001],[102500,102519,9002],[102530,102549,9001],[102570,102588,9001],[102590,102598,9001],[102601,102603,9001],[102608,102628,9001],[102629,102646,9003],[102648,102672,9003],[102675,102700,9003],[102701,102703,9001],[102707,102730,9003],[102735,102758,9003],[102767,102798,9001],[102962,102969,9001],[102971,102973,9001],[102975,102989,9001],[102990,102992,9002],[102997,103002,9001],[103003,
103008,9003],[103009,103011,9001],[103012,103014,9003],[103019,103021,9001],[103022,103024,9003],[103029,103031,9001],[103032,103034,9003],[103065,103068,9001],[103074,103076,9001],[103077,103079,9002],[103080,103082,9001],[103083,103085,9003],[103090,103093,9001],[103097,103099,9001],[103100,103102,9003],[103107,103109,9001],[103110,103112,9003],[103113,103116,9001],[103117,103120,9003],[103153,103157,9001],[103158,103162,9003],[103163,103165,9001],[103166,103168,9002],[103169,103171,9003],[103186,
103188,9001],[103189,103191,9003],[103192,103195,9001],[103196,103199,9003],[103200,103224,9001],[103225,103227,9002],[103232,103237,9001],[103238,103243,9003],[103244,103246,9001],[103247,103249,9003],[103254,103256,9001],[103257,103259,9003],[103264,103266,9001],[103267,103269,9003],[103300,103375,9001],[103381,103383,9001],[103384,103386,9002],[103387,103389,9001],[103390,103392,9003],[103397,103399,9001],[103400,103471,9003],[103476,103478,9001],[103479,103481,9003],[103486,103488,9001],[103489,
103491,9003],[103492,103495,9001],[103496,103499,9003],[103539,103543,9001],[103544,103548,9003],[103549,103551,9001],[103552,103554,9002],[103555,103557,9003],[103558,103560,9001],[103571,103573,9001],[103574,103576,9003],[103577,103580,9001],[103581,103583,9003],[103600,103694,9001],[103700,103793,9003],[103794,103799,9001],[104100,104138,9102],[104141,104145,9102],[104256,104261,9102],[104700,104786,9102],[104900,104970,9102],[104990,104992,9102]],nc:[2066,9039,2136,9094,2155,9003,2157,9001,2158,
9001,2159,9094,2160,9094,2219,9001,2220,9001,2244,9003,2245,9003,2256,9002,2265,9002,2266,9002,2269,9002,2270,9002,2273,9002,2290,9001,2291,9001,2294,9001,2295,9001,2313,9001,2314,9005,2899,9003,2900,9003,2901,9002,2909,9002,2910,9002,2911,9003,2912,9003,2913,9002,2914,9002,2964,9003,2967,9003,2968,9003,2991,9001,2992,9002,2993,9001,2994,9002,3073,9001,3076,9001,3079,9001,3091,9003,3106,9001,3108,9001,3109,9001,3141,9001,3142,9001,3167,9301,3337,9001,3347,9001,3348,9001,3359,9003,3360,9001,3361,9002,
3362,9001,3363,9003,3364,9001,3365,9003,3366,9005,3402,9001,3403,9001,3405,9001,3406,9001,3439,9001,3440,9001,3447,9001,3449,9001,3450,9001,3453,9003,3454,9003,3460,9001,3479,9002,3480,9001,3481,9002,3482,9001,3483,9002,3484,9001,3485,9003,3486,9001,3487,9003,3488,9001,3489,9001,3490,9003,3491,9001,3492,9003,3493,9001,3494,9003,3495,9001,3496,9003,3497,9001,3498,9003,3499,9001,3500,9003,3501,9001,3502,9003,3503,9001,3504,9003,3505,9001,3506,9003,3507,9001,3508,9003,3509,9001,3510,9003,3511,9001,3512,
9003,3513,9001,3514,9001,3515,9003,3516,9001,3517,9003,3518,9001,3519,9003,3520,9001,3521,9003,3522,9001,3523,9003,3524,9001,3525,9003,3526,9001,3527,9003,3528,9001,3529,9003,3530,9001,3531,9003,3532,9001,3533,9003,3534,9001,3535,9003,3536,9001,3537,9003,3538,9001,3539,9003,3540,9001,3541,9003,3542,9001,3543,9003,3544,9001,3545,9003,3546,9001,3547,9003,3548,9001,3549,9003,3550,9001,3551,9003,3552,9001,3553,9003,3582,9003,3583,9001,3584,9003,3585,9001,3586,9003,3587,9001,3588,9002,3589,9001,3590,9002,
3591,9001,3592,9001,3593,9002,3598,9003,3599,9001,3600,9003,3605,9002,3606,9001,3607,9001,3608,9003,3609,9001,3610,9003,3611,9001,3612,9003,3613,9001,3614,9003,3615,9001,3616,9003,3617,9001,3618,9003,3619,9001,3620,9003,3621,9001,3622,9003,3623,9001,3624,9003,3625,9001,3626,9003,3627,9001,3628,9003,3629,9001,3630,9003,3631,9001,3632,9003,3633,9001,3634,9002,3635,9001,3636,9002,3640,9003,3641,9001,3642,9003,3643,9001,3644,9002,3645,9001,3646,9002,3647,9001,3648,9002,3649,9001,3650,9003,3651,9001,3652,
9003,3653,9001,3654,9003,3655,9001,3656,9002,3657,9001,3658,9003,3659,9001,3660,9003,3661,9001,3662,9003,3663,9001,3664,9003,3668,9003,3669,9001,3670,9003,3671,9001,3672,9003,3673,9001,3674,9003,3675,9001,3676,9002,3677,9003,3678,9001,3679,9002,3680,9003,3681,9001,3682,9002,3683,9003,3684,9001,3685,9001,3686,9003,3687,9001,3688,9003,3689,9001,3690,9003,3691,9001,3692,9003,3696,9003,3697,9001,3698,9003,3699,9001,3700,9003,3740,9001,3749,9001,3783,9001,3784,9001,3793,9001,3794,9001,3802,9001,3816,9001,
3829,9001,3854,9001,3920,9001,3978,9001,3979,9001,3991,9003,3992,9003,4026,9001,4037,9001,4038,9001,4042,9102,4075,9102,4081,9102,4168,9102,4170,9102,4188,9102,4217,9003,4261,9105,4262,9102,4263,9102,4288,9102,4289,9102,4305,9105,4322,9102,4324,9102,4326,9102,4438,9003,4439,9003,4466,9102,4467,9001,4469,9102,4471,9001,4474,9001,4475,9102,4483,9102,4490,9102,4555,9102,4558,9102,4559,9001,4614,9102,4619,9102,4657,9102,4670,9102,4671,9102,4674,9102,4682,9102,4683,9102,4718,9102,4720,9102,4721,9102,4723,
9102,4726,9102,4737,9102,4738,9102,4759,9102,4761,9102,4807,9105,4808,9102,4809,9102,4816,9105,4817,9102,4818,9102,4819,9105,4820,9102,4821,9105,4823,9102,4824,9102,4839,9001,4901,9105,4902,9105,4903,9102,4904,9102,5018,9001,5048,9001,5167,9001,5168,9001,5223,9001,5228,9102,5229,9102,5233,9102,5234,9001,5235,9001,5243,9001,5252,9102,5264,9102,5266,9001,5316,9001,5320,9001,5321,9001,5330,9001,5331,9001,5337,9001,5340,9102,5354,9102,5360,9102,5361,9001,5362,9001,5371,9102,5373,9102,5381,9102,5382,9001,
5383,9001,5393,9102,5396,9001,5456,9001,5457,9001,5464,9102,5467,9102,5469,9001,5472,9037,5489,9102,5490,9001,5518,9001,5523,9001,5524,9102,5527,9102,5546,9102,5559,9001,5561,9102,5588,9002,5589,9005,5593,9102,5596,9001,5627,9001,5629,9001,5641,9001,5643,9001,5644,9001,5654,9003,5655,9003,5659,9001,5681,9102,5700,9001,5825,9001,5836,9001,5837,9001,5842,9001,5844,9001,5880,9001,5886,9102,5887,9001,5890,9001,20499,9001,20538,9001,20539,9001,20790,9001,20791,9001,21291,9001,21292,9001,21500,9001,21817,
9001,21818,9001,22032,9001,22033,9001,22091,9001,22092,9001,22332,9001,22391,9001,22392,9001,22700,9001,22770,9001,22780,9001,22832,9001,23090,9001,23095,9001,23239,9001,23240,9001,23433,9001,23700,9001,24047,9001,24048,9001,24100,9005,24200,9001,24305,9001,24306,9001,24382,9084,24383,9001,24500,9001,24547,9001,24548,9001,24571,9062,24600,9001,25E3,9001,25231,9001,25884,9001,25932,9001,26237,9001,26331,9001,26332,9001,26591,9001,26592,9001,26632,9001,26692,9001,26855,9003,26856,9003,27120,9001,27200,
9001,27291,9040,27292,9040,27429,9001,27492,9001,27500,9001,27700,9001,28232,9001,28600,9001,28991,9001,28992,9001,29100,9001,29220,9001,29221,9001,29333,9001,29635,9001,29636,9001,29701,9001,29738,9001,29739,9001,29849,9001,29850,9001,29871,9042,29872,9041,29873,9001,29900,9001,29901,9001,29903,9001,30200,9039,30339,9001,30340,9001,30591,9001,30592,9001,30791,9001,30792,9001,31028,9001,31121,9001,31154,9001,31170,9001,31171,9001,31370,9001,31528,9001,31529,9001,31600,9001,31700,9001,31838,9001,31839,
9001,31901,9001,32061,9001,32062,9001,32098,9001,32099,9003,32100,9001,32104,9001,32161,9001,32766,9001,37225,9105,37235,9102,37257,9102,37259,9102,37260,9102,53034,9001,53048,9001,53049,9001,54034,9001,65061,9003,65062,9003,65161,9001,65163,9001,102041,9003,102064,9085,102068,109030,102069,109031,102118,9003,102119,9002,102120,9003,102121,9003,102217,9003,102218,9001,102219,9003,102220,9003,102378,9002,102379,9002,102380,9001,102381,9002,102589,9003,102599,9003,102600,9003,102604,9003,102605,9001,
102606,9001,102647,9001,102704,9003,102705,9003,102733,9003,102761,9003,102762,9001,102763,9003,102764,9001,102765,9001,102766,9003,102970,9002,102974,9003,102993,9001,102994,9001,102995,9003,102996,9003,103015,9001,103016,9003,103017,9001,103018,9003,103025,9001,103026,9001,103027,9003,103028,9003,103035,9001,103036,9001,103037,9003,103038,9003,103039,9001,103040,9001,103041,9003,103042,9003,103043,9001,103044,9001,103045,9003,103046,9003,103047,9001,103048,9001,103049,9003,103050,9003,103051,9001,
103052,9003,103053,9001,103054,9003,103055,9001,103056,9003,103057,9001,103058,9001,103059,9003,103060,9003,103061,9001,103062,9001,103063,9003,103064,9003,103069,9003,103070,9001,103071,9001,103072,9003,103073,9003,103086,9001,103087,9001,103088,9003,103089,9003,103094,9002,103095,9001,103096,9003,103103,9001,103104,9003,103105,9001,103106,9003,103121,9001,103122,9003,103123,9001,103124,9001,103125,9002,103126,9002,103127,9001,103128,9001,103129,9003,103130,9003,103131,9001,103132,9001,103133,9003,
103134,9003,103135,9001,103136,9001,103137,9002,103138,9002,103139,9001,103140,9003,103141,9001,103142,9003,103143,9001,103144,9003,103145,9001,103146,9002,103147,9001,103148,9001,103149,9003,103150,9003,103151,9001,103152,9003,103172,9001,103173,9003,103174,9001,103175,9001,103176,9003,103177,9003,103178,9001,103179,9001,103180,9003,103181,9003,103182,9001,103183,9001,103184,9003,103185,9003,103228,9001,103229,9001,103230,9003,103231,9003,103250,9001,103251,9003,103252,9001,103253,9003,103260,9001,
103261,9001,103262,9003,103263,9003,103270,9001,103271,9001,103272,9003,103273,9003,103274,9001,103275,9001,103276,9003,103277,9003,103278,9001,103279,9001,103280,9003,103281,9003,103282,9001,103283,9001,103284,9003,103285,9003,103286,9001,103287,9003,103288,9001,103289,9003,103290,9001,103291,9003,103292,9001,103293,9001,103294,9003,103295,9003,103296,9001,103297,9001,103298,9003,103299,9003,103376,9003,103377,9001,103378,9001,103379,9003,103380,9003,103393,9001,103394,9001,103395,9003,103396,9003,
103472,9001,103473,9002,103474,9001,103475,9003,103482,9001,103483,9003,103484,9001,103485,9003,103500,9001,103501,9003,103502,9001,103503,9001,103504,9002,103505,9002,103506,9001,103507,9001,103508,9003,103509,9003,103510,9001,103511,9001,103512,9003,103513,9003,103514,9001,103515,9003,103516,9001,103517,9003,103518,9001,103519,9003,103520,9001,103521,9002,103522,9001,103523,9001,103524,9003,103525,9003,103526,9001,103527,9003,103561,9003,103562,9003,103563,9001,103564,9001,103565,9003,103566,9003,
103567,9001,103568,9001,103569,9003,103570,9003,103585,9003,103695,9003,104020,9102,104139,9105,104140,9105,104223,9102,104286,9102,104287,9102,104304,9102,104305,9102,104896,9102]},e=function(){function d(){}d.cC=function(g){!1===d.ti&&d.bo();var e=d.NG(g);if(-1==e){var v=d.ks(g);v!=g&&(e=d.cC(v))}return e};d.NG=function(g){return void 0!==d.ds[g]?d.ds[g]:-1};d.SM=function(g){!1===d.ti&&d.bo();var e=d.Fz(g);if(1E38==e){var v=d.ks(g);v!=g&&(e=d.Fz(v));if(1E38==e)return 1E-10}return e};d.WO=function(g){if(void 0!==
d.Un[g])return!0;var e=d.ks(g);return e!=g&&void 0!==d.Un[e]?!0:!1};d.ZO=function(g){if(void 0!==d.Gh[g])return!0;var e=d.ks(g);return e!=g&&void 0!==d.Gh[e]?!0:!1};d.Fz=function(g){!1===d.ti&&d.bo();return void 0!==d.Un[g]?d.Un[g]:void 0!==d.Gh[g]?d.Gh[g]:1E38};d.oU=function(g){!1===d.ti&&d.bo();return void 0!==d.ew[g]?d.ew[g]:g};d.ks=function(g){!1===d.ti&&d.bo();return void 0!==d.Mw[g]?d.Mw[g]:g};d.bo=function(){for(var g=a,e,v=0;v<g.pcsid.length;v+=2)d.Gh[g.pcsid[v]]=g.pcstol[2*g.pcsid[v+1]+1];
for(v=0;v<g.pcsidc.length;v+=1){e=g.pcsidc[v];for(var k=e[0];k<=e[1];k++)d.Gh[k]=g.pcstol[2*e[2]+1]}for(v=0;v<g.gcsid.length;v+=2)d.Un[g.gcsid[v]]=g.gcstol[2*g.gcsid[v+1]+1];for(v=0;v<g.gcsidc.length;v+=1)for(e=g.gcsidc[v],k=e[0];k<=e[1];k++)d.Gh[k]=g.gcstol[2*e[2]+1];for(v=0;v<b.c.length;v+=1)for(e=b.c[v],k=e[0];k<=e[1];k++)d.ds[k]=e[2];for(v=0;v<b.nc.length;v+=2)d.ds[b.nc[v]]=b.nc[v+1];b=null;for(v=0;v<g.newtoold.length;v+=2)d.ew[g.newtoold[v+1]]=g.newtoold[v],d.Mw[g.newtoold[v]]=g.newtoold[v+1];
a=null;d.ti=!0};d.ti=!1;d.Un=[];d.Gh=[];d.ew=[];d.Mw=[];d.ds=[];return d}();k.ls=e})(x||(x={}));(function(k){function a(d){return 0===d.length?'""':'"'==d[0]||"."==d[0]||"0"<=d[0]&&"9">=d[0]?d:'"'+d.trim()+'"'}var b=[],e=function(){function d(){}d.UM=function(g){try{for(var e=0;e<b.length;e++)if(b[e].wkttext===g)return b[e].unit;for(var v,D=e="",L=!1,c=0;c<g.length;c++){var n=g[c];!0===L?'"'==n?'"'==g[c+1]?e+=n:L=!1:e+=n:/[\s]/.test(n)||(","==n?(D=""!==e?D+(a(e)+","):D+",",e=""):")"==n||"]"==n?(D=
""!==e?D+(a(e)+"]}"):D+"]}",e=""):"("==n||"["==n?(D+='{ "entity": "'+e.toUpperCase().trim()+'", "values":[',e=""):'"'==n?(L=!0,e=""):e+=n)}v=JSON.parse(D);var h=d.Dz(v);if(null===h)return null;v=null;for(n=0;n<h.values.length;n++)if("object"===typeof h.values[n]&&"UNIT"===h.values[n].entity){v=h.values[n];break}if(null===v)return null;var l=k.Tb.EL("GEOGCS"===h.entity?1:0,v.values[1],v.values[2]);b.push({wkttext:g,unit:l});10<b.length&&b.shift();return l}catch(aa){return null}};d.Dz=function(g){if(null===
g)return null;if("GEOGCS"===g.entity||"PROJCS"===g.entity)return g;for(var e=[],v=0;v<g.values.length;v++)if("object"===typeof g.values[v]&&void 0!==g.values[v].entity){if("GEOGCS"===g.values[v].entity||"PROJCS"==g.values[v].entity)return g.values[v];e.push(g.values[v])}for(g=0;g<e.length;g++)if(v=d.Dz(e[g]),null!==v)return v;return null};d.TM=function(d){var g=-1;if(null!=d&&0<d.length){var e,k;e=d.indexOf("PROJCS");if(0<=e){var a=0;e=d.lastIndexOf("UNIT");if(0<=e&&(e=d.indexOf(",",e+4),0<e&&(e++,
k=d.indexOf("]",e+1),0<k)))try{a=parseFloat(d.substring(e,k))}catch(Z){a=0}0<a&&(g=.001/a)}else if(e=d.indexOf("GEOGCS"),0<=e){var b=0,a=0;e=d.indexOf("SPHEROID",e+6);if(0<e&&(e=d.indexOf(",",e+8),0<e)){e++;k=d.indexOf(",",e+1);if(0<k)try{b=parseFloat(d.substring(e,k))}catch(Z){b=0}if(0<b&&(e=d.indexOf("UNIT",k+1),0<=e&&(e=d.indexOf(",",e+4),0<e&&(e++,k=d.indexOf("]",e+1),0<k))))try{a=parseFloat(d.substring(e,k))}catch(Z){a=0}}0<b&&0<a&&(g=.001/(b*a))}}return g};return d}();k.mA=e})(x||(x={}));(function(k){(function(k){k[k.NONE=
0]="NONE";k[k.LINEAR=1]="LINEAR";k[k.ANGULAR=2]="ANGULAR"})(k.BH||(k.BH={}));(function(k){k[k.enumFloat=0]="enumFloat";k[k.enumDouble=1]="enumDouble";k[k.enumInt32=2]="enumInt32";k[k.enumInt64=3]="enumInt64";k[k.enumInt8=4]="enumInt8";k[k.enumInt16=5]="enumInt16"})(k.oI||(k.oI={}));(function(k){k[k.POSITION=0]="POSITION";k[k.Z=1]="Z";k[k.M=2]="M";k[k.ID=3]="ID";k[k.NORMAL=4]="NORMAL";k[k.TEXTURE1D=5]="TEXTURE1D";k[k.TEXTURE2D=6]="TEXTURE2D";k[k.TEXTURE3D=7]="TEXTURE3D";k[k.ID2=8]="ID2";k[k.MAXSEMANTICS=
10]="MAXSEMANTICS"})(k.xf||(k.xf={}));var a=function(){function a(e,d){this.er=this.le=null;this.up=this.Aa=0;this.Wg=this.Jf=null;this.tk=0;if(void 0!==d){this.Aa=d.Aa;this.up=d.up;this.Jf=d.Jf.slice(0);this.Wg=d.Wg.slice(0);this.tk=d.tk;this.er=[];for(d=e=0;d<this.Aa;d++)this.er[d]=e,e+=a.Wa(this.Jf[d]);this.up=e;this.le=[];for(d=0;d<this.Aa;d++){e=a.Wa(this.Hd(d));for(var g=a.ue(this.Hd(d)),m=0;m<e;m++)this.le[this.er[d]+m]=g}}else this.up=this.Aa=0}a.prototype.Hd=function(e){if(0>e||e>this.Aa)throw k.g.N();
return this.Jf[e]};a.prototype.zf=function(e){return this.Wg[e]};a.JN=function(e){return a.ac[e]};a.Qh=function(e){return a.Cc[e]};a.ye=function(e){return a.Bd[e]};a.Gh=function(e){return a.ye(a.Qh(e))*a.Wa(e)};a.Wa=function(e){return a.ob[e]};a.Wf=function(e){return 2>e};a.ti=function(e){return a.Wf(a.Qh(e))};a.prototype.hasAttribute=function(e){return 0<=this.Wg[e]};a.prototype.WC=function(){return this.hasAttribute(1)};a.ue=function(e){return a.V[e]};a.prototype.XN=function(e){return this.er[e]};
a.nD=function(e,d){return a.V[e]===d};a.$g=function(e){if(4==e)return 2;if(8==e)return 3;throw k.g.N();};a.prototype.lc=function(e){return this===e};a.prototype.jj=function(){for(var e=k.I.kg(this.Jf[0]),d=1;d<this.Aa;d++)e=k.I.kg(this.Jf[d],e);return e};a.prototype.fj=function(e){return this.er[e]};a.prototype.hc=function(){return this.tk};a.prototype.Fd=function(e){return this.Jf[e]};a.V=[0,0,NaN,0,0,0,0,0,0];a.ac=[1,1,1,0,2,1,1,1,0];a.Cc=[1,1,1,2,0,0,0,0,2];a.Bd=[4,8,4,8,1,2];a.ob=[2,1,1,1,3,1,
2,3,2];return a}();k.pa=a})(x||(x={}));(function(k){function a(d,e,v,k){var g=d.jd,m=d.e+e+1;1===v?k=5<=g[m]:2===v?k=5<g[m]||5==g[m]&&(k||0>m||void 0!==g[m+1]||g[m-1]&1):3===v?k=k||void 0!==g[m]||0>m:(k=!1,0!==v&&b("!Big.RM!"));if(1>m||!g[0])k?(d.e=-e,d.jd=[1]):d.jd=[d.e=0];else{g.length=m--;if(k)for(;9<++g[m];)g[m]=0,m--||(++d.e,g.unshift(1));for(m=g.length;!g[--m];g.pop());}}function b(d){d=Error(d);d.name="BigError";throw d;}var e=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,d=function(){function d(g){if(g instanceof
d)this.Dd=g.Dd,this.e=g.e,this.jd=g.jd.slice();else{var m,k,a;0===g&&0>1/g?g="-0":e.test(g+="")||b(NaN);this.Dd="-"==g.charAt(0)?(g=g.slice(1),-1):1;-1<(m=g.indexOf("."))&&(g=g.replace(".",""));0<(k=g.search(/e/i))?(0>m&&(m=k),m+=+g.slice(k+1),g=g.substring(0,k)):0>m&&(m=g.length);for(k=0;"0"==g.charAt(k);k++);if(k==(a=g.length))this.jd=[this.e=0];else{for(;"0"==g.charAt(--a););this.e=m-k-1;this.jd=[];for(m=0;k<=a;this.jd[m++]=+g.charAt(k++));}}}d.prototype.abs=function(){var g=new d(this);g.Dd=1;
return g};d.prototype.DB=function(){var g=0,e=this.jd,k=(g=new d(g)).jd,a=this.Dd,b=g.Dd,c=this.e,n=g.e;if(!e[0]||!k[0])return e[0]?a:k[0]?-b:0;if(a!=b)return a;g=0>a;if(c!=n)return c>(n^g)?1:-1;a=-1;for(b=(c=e.length)<(n=k.length)?c:n;++a<b;)if(e[a]!=k[a])return e[a]>(k[a]^g)?1:-1;return c==n?0:c>(n^g)?1:-1};d.prototype.VB=function(g){var e=this.jd,m=(g=new d(g)).jd,k=this.Dd==g.Dd?1:-1,c=d.Cc;(c!==~~c||0>c||1E6<c)&&b("!Big.DP!");if(!e[0]||!m[0])return e[0]==m[0]&&b(NaN),m[0]||b(k/0),new d(0*k);
var n,h,l,q,u=m.slice(),f=n=m.length,A=e.length,p=e.slice(0,n),x=p.length,w=g,C=w.jd=[],t=0,y=c+(w.e=this.e-g.e)+1;w.Dd=k;k=0>y?0:y;for(u.unshift(0);x++<n;p.push(0));do{for(h=0;10>h;h++){if(n!=(x=p.length))l=n>x?1:-1;else for(q=-1,l=0;++q<n;)if(m[q]!=p[q]){l=m[q]>p[q]?1:-1;break}if(0>l){for(g=x==n?m:u;x;){if(p[--x]<g[x]){for(q=x;q&&!p[--q];p[q]=9);--p[q];p[x]+=10}p[x]-=g[x]}for(;!p[0];p.shift());}else break}C[t++]=l?h:++h;p[0]&&l?p[x]=e[f]||0:p=[e[f]]}while((f++<A||void 0!==p[0])&&k--);C[0]||1==t||
(C.shift(),w.e--);t>y&&a(w,c,d.ye,void 0!==p[0]);return w};d.prototype.nO=function(){return 0<this.DB()};d.prototype.vP=function(){return 0>this.DB()};d.prototype.nr=function(g){var e,m,k=this.Dd,a=(g=new d(g)).Dd;if(k!=a)return g.Dd=-a,this.NE(g);var b=this.jd.slice();m=this.e;var c=g.jd,n=g.e;if(!b[0]||!c[0])return c[0]?(g.Dd=-a,g):new d(b[0]?this:0);if(k=m-n){(e=0>k)?(k=-k,m=b):(n=m,m=c);m.reverse();for(a=k;a--;m.push(0));m.reverse()}else for(m=((e=b.length<c.length)?b:c).length,k=a=0;a<m;a++)if(b[a]!=
c[a]){e=b[a]<c[a];break}e&&(m=b,b=c,c=m,g.Dd=-g.Dd);if(0<(a=(m=c.length)-(e=b.length)))for(;a--;b[e++]=0);for(a=e;m>k;){if(b[--m]<c[m]){for(e=m;e&&!b[--e];b[e]=9);--b[e];b[m]+=10}b[m]-=c[m]}for(;0==b[--a];b.pop());for(;0==b[0];)b.shift(),--n;b[0]||(g.Dd=1,b=[n=0]);g.jd=b;g.e=n;return g};d.prototype.NE=function(g){var e,m=this.Dd;e=(g=new d(g)).Dd;if(m!=e)return g.Dd=-e,this.nr(g);e=this.e;var k=this.jd,a=g.e,b=g.jd;if(!k[0]||!b[0])return b[0]?g:new d(k[0]?this:0*m);k=k.slice();if(m=e-a){0<m?(a=e,
e=b):(m=-m,e=k);for(e.reverse();m--;e.push(0));e.reverse()}0>k.length-b.length&&(e=b,b=k,k=e);m=b.length;for(e=0;m;)e=(k[--m]=k[m]+b[m]+e)/10|0,k[m]%=10;e&&(k.unshift(e),++a);for(m=k.length;0==k[--m];k.pop());g.jd=k;g.e=a;return g};d.prototype.pow=function(g){var e=this,m=new d(1),k=m,a=0>g;(g!==~~g||-1E6>g||1E6<g)&&b("!pow!");for(g=a?-g:g;;){g&1&&(k=k.Wp(e));g>>=1;if(!g)break;e=e.Wp(e)}return a?m.VB(k):k};d.prototype.round=function(g,e){var m=this;null==g?g=0:(g!==~~g||0>g||1E6<g)&&b("!round!");
a(m=new d(m),g,null==e?d.ye:e);return m};d.prototype.sqrt=function(){var g,e,k;e=this.jd;g=this.Dd;k=this.e;var L=new d("0.5");if(!e[0])return new d(this);0>g&&b(NaN);g=Math.sqrt(this.toString());0==g||g==1/0?(g=e.join(""),g.length+k&1||(g+="0"),e=new d(Math.sqrt(g).toString()),e.e=((k+1)/2|0)-(0>k||k&1)):e=new d(g.toString());g=e.e+(d.Cc+=4);do k=e,e=L.Wp(k.NE(this.VB(k)));while(k.jd.slice(0,g).join("")!==e.jd.slice(0,g).join(""));a(e,d.Cc-=4,d.ye);return e};d.prototype.Wp=function(g){var e,m=this.jd,
k=(g=new d(g)).jd,a=m.length,b=k.length,c=this.e,n=g.e;g.Dd=this.Dd==g.Dd?1:-1;if(!m[0]||!k[0])return new d(0*g.Dd);g.e=c+n;a<b&&(e=m,m=k,k=e,n=a,a=b,b=n);for(e=Array(n=a+b);n--;e[n]=0);for(c=b;c--;){b=0;for(n=a+c;n>c;)b=e[n]+k[c]*m[n-c-1]+b,e[n--]=b%10,b=b/10|0;e[n]=(e[n]+b)%10}b&&++g.e;e[0]||e.shift();for(c=e.length;!e[--c];e.pop());g.jd=e;return g};d.prototype.toString=function(){var d=this.e,g=this.jd.join(""),e=g.length;if(-7>=d||21<=d)g=g.charAt(0)+(1<e?"."+g.slice(1):"")+(0>d?"e":"e+")+d;else if(0>
d){for(;++d;g="0"+g);g="0."+g}else if(0<d)if(++d>e)for(d-=e;d--;g+="0");else d<e&&(g=g.slice(0,d)+"."+g.slice(d));else 1<e&&(g=g.charAt(0)+"."+g.slice(1));return 0>this.Dd&&this.jd[0]?"-"+g:g};d.Cc=20;d.ye=1;return d}();k.Tn=d})(x||(x={}));(function(k){var a=function(){function e(d){this.$e=d}e.prototype.Zp=function(d,g,e){var m=new k.b,a=new k.b,b=this.$e;e.xd(d,g,function(d,g){b.ec(2*d,m);b.ec(2*g,a);return m.compare(a)})};e.prototype.Mo=function(d){return this.$e.read(2*d+1)};return e}(),b=function(){function e(){}
e.No=function(d){if(d.s())return!1;var g=d.D();return 1736==g?0==d.Mh()?!1:!0:1607==g?(g=[!1],e.qz(d,!0,g),g[0]):197==g||k.T.Lc(g)&&!d.kD()?!0:!1};e.il=function(d){var g=d.D();if(1736==g)return g=new k.Xa(d.description),d.s()||d.tA(g),g;if(1607==g)return e.qz(d,!1,null);if(197==g)return g=new k.Xa(d.description),d.s()||g.Wc(d,!1),g;if(k.T.Lc(g)){g=new k.pe(d.description);if(!d.s()&&!d.kD()){var m=new k.Va;d.En(m);g.add(m);d.Bn(m);g.add(m)}return g}if(k.T.Km(g))return null;throw k.g.N();};e.qz=function(d,
g,e){null!=e&&(e[0]=!1);var m=null;g||(m=new k.pe(d.description));if(!d.s()){var D=new k.ga(0);D.xb(2*d.ea());for(var b=0,c=d.ea();b<c;b++)if(0<d.Ha(b)&&!d.Oo(b)){var n=d.Ea(b);D.add(n);n=d.Dc(b)-1;D.add(n)}if(0<D.size){c=new k.Rr;b=d.mc(0);c.sort(D,0,D.size,new a(b));c=new k.b;b.ec(2*D.get(0),c);for(var n=0,h=1,l=new k.Va,q=new k.b,u=1,f=D.size;u<f;u++)if(b.ec(2*D.get(u),q),q.ub(c))D.get(n)>D.get(u)?(D.set(n,2147483647),n=u):D.set(u,2147483647),h++;else{if(0==(h&1))D.set(n,2147483647);else if(g)return null!=
e&&(e[0]=!0),null;c.J(q);n=u;h=1}if(0==(h&1))D.set(n,2147483647);else if(g)return null!=e&&(e[0]=!0),null;if(!g)for(D.xd(0,D.size,function(d,g){return d-g}),u=0,f=D.size;u<f&&2147483647!=D.get(u);u++)d.Sd(D.get(u),l),m.add(l)}}return g?null:m};return e}();k.Hh=b})(x||(x={}));(function(k){var a=function(){function a(){this.lf=new k.ga(0);this.Lq=new k.ga(0);this.gE=1;this.Qq=NaN}a.prototype.sort=function(e,d,g,m){if(32>g-d)m.Zp(d,g,e);else{var v=!0;try{for(var k=Infinity,a=-Infinity,b=d;b<g;b++){var c=
m.Mo(e.get(b));c<k&&(k=c);c>a&&(a=c)}if(this.reset(g-d,k,a,g-d)){for(b=d;b<g;b++){var n=e.get(b),c=m.Mo(n),h=this.oC(c);this.lf.set(h,this.lf.get(h)+1);this.Lq.write(b-d,n)}var l=this.lf.get(0);this.lf.set(0,0);for(var b=1,q=this.lf.size;b<q;b++){var u=this.lf.get(b);this.lf.set(b,l);l+=u}for(b=d;b<g;b++){var n=this.Lq.read(b-d),c=m.Mo(n),h=this.oC(c),f=this.lf.get(h);e.set(f+d,n);this.lf.set(h,f+1)}v=!1}}catch(ma){this.lf.resize(0),this.Lq.resize(0)}if(v)m.Zp(d,g,e);else{b=g=0;for(q=this.lf.size;b<
q;b++)v=g,g=this.lf.get(b),g>v&&m.Zp(d+v,d+g,e);100<this.lf.size&&(this.lf.resize(0),this.Lq.resize(0))}}};a.prototype.reset=function(e,d,g,m){if(2>e||g==d)return!1;e=Math.min(a.tI,e);this.lf.xb(e);this.lf.resize(e);this.lf.dh(0,0,this.lf.size);this.gE=d;this.Lq.resize(m);this.Qq=(g-d)/(e-1);return!0};a.prototype.oC=function(e){return k.I.truncate((e-this.gE)/this.Qq)};a.tI=65536;return a}();k.Rr=a})(x||(x={}));(function(k){var a;(function(d){d[d.enum_line=1]="enum_line";d[d.enum_arc=2]="enum_arc";
d[d.enum_dummy=4]="enum_dummy";d[d.enum_concave_dip=8]="enum_concave_dip";d[d.enum_connection=3]="enum_connection"})(a||(a={}));var b=function(){function d(){}d.Ks=function(g,e,m,v,a,b){var D=new d;D.Fl=new k.b;D.Ql=new k.b;D.Lt=new k.b;D.Fl.J(g);D.Ql.J(e);D.Lt.J(m);D.qn=v;D.Rg=a;D.Ug=b;return D};d.Oa=function(g,e,m,v){var a=new d;a.Fl=new k.b;a.Ql=new k.b;a.Lt=new k.b;a.Fl.J(g);a.Ql.J(e);a.Lt.Eh();a.qn=4;a.Rg=m;a.Ug=v;return a};return d}(),e=function(){function d(d,g,e,m,v,k){this.It=null;this.ua=
0;this.Ex=d;this.yE=this.wE=0;this.Da=g;this.Pi=e;this.Cj=m;this.mp=v;this.Yb=k}d.prototype.next=function(){for(var d=new k.Va;;){if(this.ua==this.Ex.F())return null;this.Ex.Sd(this.ua,d);this.ua++;if(!d.s())break}var g=!1;null==this.It&&(this.wE=d.lk(),this.yE=d.mk(),this.It=m.buffer(d,this.Da,this.Pi,this.Cj,this.mp,this.Yb),g=!0);var e;this.ua<this.Ex.F()?(e=new k.Ka,this.It.copyTo(e)):e=this.It;if(!g){var g=new k.Bg,v=d.lk()-this.wE,d=d.mk()-this.yE;g.Nn(v,d);e.Oe(g)}return e};d.prototype.ya=
function(){return 0};return d}(),d=function(){function d(d,g){this.Ma=d;this.ua=0;this.Yo=g}d.prototype.next=function(){var d=this.Ma.U;if(this.ua<d.ea()){var g=this.ua;this.ua++;if(!d.Oo(g))for(var e=d.Fa(d.Dc(g)-1);this.ua<d.ea();){var m=d.Fa(d.Ea(this.ua));if(d.Oo(this.ua))break;if(m!=e)break;e=d.Fa(d.Dc(this.ua)-1);this.ua++}if(1==this.ua-g)return this.Ma.kB(this.Ma.U,g,this.Yo);e=new k.Xa(this.Ma.U.description);e.Zj(this.Ma.U,g,!0);for(g+=1;g<this.ua;g++)e.ys(this.Ma.U,g,0,d.ct(g),!1);return this.Ma.kB(e,
0,this.Yo)}return null};d.prototype.ya=function(){return 0};return d}(),g=function(){function d(d){this.Ma=d;this.ua=0}d.prototype.next=function(){var d=this.Ma.U;if(this.ua<d.ea()){var g=this.ua;d.oo(this.ua);for(this.ua++;this.ua<d.ea()&&!(0<d.oo(this.ua));)this.ua++;return 0==g&&this.ua==d.ea()?this.Ma.Gv(d,0,d.ea()):this.Ma.Gv(d,g,this.ua)}return null};d.prototype.ya=function(){return 0};return d}(),m=function(){function m(d){this.Vq=this.Tt=this.Wq=this.sd=null;this.Jd=[];this.Yb=d;this.hb=this.wt=
this.OP=this.Da=this.vx=this.jr=this.ka=0;this.sx=this.Cj=-1;this.Yo=!0}m.buffer=function(d,g,e,v,a,b){if(null==d)throw k.g.N();if(0>v)throw k.g.N();if(d.s())return new k.Ka(d.description);var D=new k.i;d.dd(D);0<g&&D.P(g,g);b=new m(b);b.Pi=e;b.U=d;b.ka=k.Ia.zd(e,D,!0);b.jr=k.Ia.zd(null,D,!0);b.Da=g;b.OP=d.D();0>=a&&(a=96);b.hb=Math.abs(b.Da);b.wt=0!=b.hb?1/b.hb:0;isNaN(v)||0==v?v=1E-5*b.hb:v>.5*b.hb&&(v=.5*b.hb);12>a&&(a=12);d=Math.abs(g)*(1-Math.cos(Math.PI/a));d>v?v=d:(d=Math.PI/Math.acos(1-v/
Math.abs(g)),d<a-1&&(a=k.I.truncate(d),12>a&&(a=12,v=Math.abs(g)*(1-Math.cos(Math.PI/a)))));b.Cj=v;b.mp=a;b.vx=Math.min(b.jr,.25*v);return b.lB()};m.prototype.Ss=function(){if(null==this.sd)this.sd=[];else if(0!==this.sd.length)return;var d=this.pB(),d=k.I.truncate((d+3)/4),g=.5*Math.PI/d;this.sx=g;for(var e=0;e<4*d;e++)this.sd.push(null);for(var m=Math.cos(g),g=Math.sin(g),v=k.b.Oa(0,1),e=0;e<d;e++)this.sd[e+0*d]=k.b.Oa(v.y,-v.x),this.sd[e+1*d]=k.b.Oa(-v.x,-v.y),this.sd[e+2*d]=k.b.Oa(-v.y,v.x),this.sd[e+
3*d]=v,v=k.b.Oa(v.x,v.y),v.Er(m,g)};m.prototype.lB=function(){var d=this.U.D();if(k.T.Lc(d))return d=new k.Xa(this.U.description),d.Bc(this.U,!0),this.U=d,this.lB();if(this.Da<=this.ka)if(k.T.SO(d)){if(0>=this.Da&&(d=new k.i,this.U.o(d),d.aa()<=2*-this.Da||d.ba()<=2*this.Da))return new k.Ka(this.U.description)}else return new k.Ka(this.U.description);switch(this.U.D()){case 33:return this.tK();case 550:return this.sK();case 1607:return this.vK();case 1736:return this.uK();case 197:return this.qK();
default:throw k.g.wa();}};m.prototype.vK=function(){if(this.oD(this.U)){var g=new k.Va;this.U.Sd(0,g);var e=new k.i;this.U.o(e);g.ic(e.Af());return this.Es(g)}this.U=this.SQ(this.U);g=new d(this,this.Yo);return k.wi.local().$(g,this.Pi,this.Yb).next()};m.prototype.uK=function(){if(0==this.Da)return this.U;var d=k.as.local();this.Ss();this.U=d.$(this.U,null,!1,this.Yb);if(0>this.Da){var e=this.U,e=this.Gv(e,0,e.ea());return d.$(e,this.Pi,!1,this.Yb)}if(this.oD(this.U))return d=new k.Va,this.U.Sd(0,
d),e=new k.i,this.U.o(e),d.ic(e.Af()),this.Es(d);d=new g(this);return k.wi.local().$(d,this.Pi,this.Yb).next()};m.prototype.Gv=function(d,g,e){for(var v=new k.Ka(d.description);g<e;g++)if(!(1>d.Ha(g))){var a=d.oo(g),D=new k.i;d.Ti(g,D);if(0<this.Da)if(0<a)if(this.pD(d,g))a=new k.Va,d.Sd(d.Ea(g),a),a.ic(D.Af()),this.us(v,a);else{var b=a=new k.Xa(d.description),b=k.Tr.sD(this.U,g)||2==this.sm(this.U,g,b,!0,1)?this.jB(d,g):this.rm(a);v.add(b,!1)}else{if(!(D.aa()+this.ka<=2*this.hb||D.ba()+this.ka<=2*
this.hb||(b=a=new k.Xa(d.description),this.sm(this.U,g,b,!0,1),a.s()))){var L=new k.i;L.K(D);L.P(this.hb,this.hb);b.ws(L);b=this.rm(a);D=1;for(a=b.ea();D<a;D++)v.Zj(b,D,!0)}}else if(0<a){if(!(D.aa()+this.ka<=2*this.hb||D.ba()+this.ka<=2*this.hb||(b=a=new k.Xa(d.description),this.sm(this.U,g,b,!0,-1),a.s())))for(L=new k.i,b.dd(L),L.P(this.hb,this.hb),b.ws(L),b=this.rm(a),D=1,a=b.ea();D<a;D++)v.Zj(b,D,!0)}else for(b=a=new k.Xa(d.description),this.sm(this.U,g,b,!0,-1),b=this.rm(a),D=0,a=b.ea();D<a;D++)v.Zj(b,
D,!0)}if(0<this.Da)return 1<v.ea()?v=this.rm(v):m.Id(v);d=new k.i;v.dd(d);if(v.s())return m.Id(v);d.P(this.hb,this.hb);v.ws(d);v=this.rm(v);d=new k.Ka(v.description);D=1;for(a=v.ea();D<a;D++)d.Zj(v,D,!1);return m.Id(d)};m.prototype.tK=function(){return this.Es(this.U)};m.prototype.Es=function(d){var g=new k.Ka(this.U.description);this.us(g,d);return this.nS(g)};m.prototype.sK=function(){var d=new e(this.U,this.Da,this.Pi,this.Cj,this.mp,this.Yb);return k.wi.local().$(d,this.Pi,this.Yb).next()};m.prototype.qK=
function(){var d=new k.Ka(this.U.description);if(0>=this.Da){if(0==this.Da)d.Wc(this.U,!1);else{var g=new k.Vj;this.U.Fp(g);g.P(this.Da,this.Da);d.Wc(g,!1)}return d}d.Wc(this.U,!1);this.U=d;return this.jB(d,0)};m.prototype.jB=function(d,g){this.Ss();var e=new k.Ka(d.description),v=new k.b,a=new k.b,D=new k.b,b=new k.b,L=new k.b,c=new k.b,n=new k.b,h=new k.b,l=d.Ha(g),q=d.Ea(g),u=0;for(g=d.Ha(g);u<g;u++){d.w(q+u,a);d.w(q+(u+1)%l,b);d.w(q+(u+2)%l,c);n.pc(b,a);if(0==n.length())throw k.g.wa();n.tt();
n.normalize();n.scale(this.hb);v.add(n,a);D.add(n,b);0==u?e.Nr(v):e.Lm(v);e.Lm(D);h.pc(c,b);if(0==h.length())throw k.g.wa();h.tt();h.normalize();h.scale(this.hb);L.add(h,b);this.NA(e,b,D,L,!1)}return m.Id(e)};m.prototype.kB=function(d,g,e){this.Ss();if(1>d.Ha(g))return null;if(this.pD(d,g)&&0<this.Da){e=new k.Va;d.Sd(d.Ea(g),e);var m=new k.i;d.Ti(g,m);e.ic(m.Af());return this.Es(e)}m=new k.Xa(d.description);if(d.Oo(g))this.sm(d,g,m,e,1),this.sm(d,g,m,e,-1);else{var v=new k.Xa(d.description);v.Zj(d,
g,!1);v.ys(d,g,0,d.ct(g),!1);this.sm(v,0,m,e,1)}return this.rm(m)};m.prototype.rm=function(d){return k.Of.Qj(d,this.jr,!0,!0,this.Yb)};m.prototype.pB=function(){if(0==this.Cj)return this.mp;var d=1-this.Cj*Math.abs(this.wt),g;-1>d?g=4:g=2*Math.PI/Math.acos(d)+.5;4>g?g=4:g>this.mp&&(g=this.mp);return k.I.truncate(g)};m.prototype.NA=function(d,g,e,m,v){this.Ss();var a=new k.b;a.pc(e,g);a.scale(this.wt);var D=new k.b;D.pc(m,g);D.scale(this.wt);a=Math.atan2(a.y,a.x)/this.sx;0>a&&(a=this.sd.length+a);
a=this.sd.length-a;D=Math.atan2(D.y,D.x)/this.sx;0>D&&(D=this.sd.length+D);D=this.sd.length-D;D<a&&(D+=this.sd.length);var b=k.I.truncate(D),D=k.I.truncate(Math.ceil(a)),a=new k.b;a.J(this.sd[D%this.sd.length]);a.Fr(this.hb,g);var c=10*this.ka;a.sub(e);a.length()<c&&(D+=1);a.J(this.sd[b%this.sd.length]);a.Fr(this.hb,g);a.sub(m);a.length()<c&&--b;e=b-D;e++;b=0;for(D%=this.sd.length;b<e;b++,D=(D+1)%this.sd.length)a.J(this.sd[D]),a.Fr(this.hb,g),d.Lm(a);v&&d.Lm(m)};m.prototype.sm=function(d,g,e,m,v){var a=
new k.fd,D=a.QJ(d,g);a.xo(this.vx,!1,!1);if(2>a.F(D)){if(0>v)return 1;v=d;a=new k.Va;v.Sd(v.Ea(g),a);this.us(e,a);return 1}var c=a.Fa(a.Cb(a.Vb(D))),L=new k.Bg;L.Nn(-c.x,-c.y);a.Oe(L);if(m&&(this.MM(a,D,v),2>a.F(D))){if(0>v)return 1;v=d;a=new k.Va;v.Sd(v.Ea(g),a);this.us(e,a);return 1}this.Jd.length=0;var n=a.Vb(D);g=a.Cb(n);var h=1==v?a.Ua(g):a.X(g);d=1==v?a.X(g):a.Ua(g);var l=!0;m=new k.b;for(var D=new k.b,q=new k.b,Z=new k.b,R=new k.b,u=new k.b,f=new k.b,A=new k.b,p=new k.b,x=new k.b,w=this.hb,
n=a.Ha(n),C=0;C<n;C++)a.w(d,D),l&&(a.w(g,m),a.w(h,q),A.pc(m,q),A.normalize(),x.zD(A),x.scale(w),Z.add(x,m)),f.pc(D,m),f.normalize(),p.zD(f),p.scale(w),R.add(m,p),h=A.Ai(f),l=A.ml(f),0>h||0>l&&0==h?this.Jd.push(b.Ks(Z,R,m,2,this.Jd.length+1,this.Jd.length-1)):Z.ub(R)||(this.Jd.push(b.Oa(Z,m,this.Jd.length+1,this.Jd.length-1,"dummy")),this.Jd.push(b.Oa(m,R,this.Jd.length+1,this.Jd.length-1,"dummy"))),u.add(D,p),this.Jd.push(b.Ks(R,u,m,1,this.Jd.length+1,this.Jd.length-1)),Z.J(u),x.J(p),q.J(m),m.J(D),
A.J(f),h=g,g=d,l=!1,d=1==v?a.X(g):a.Ua(g);this.Jd[this.Jd.length-1].Rg=0;this.Jd[0].Ug=this.Jd.length-1;this.UQ(e);L.Nn(c.x,c.y);e.ZA(L,e.ea()-1);return 1};m.prototype.UQ=function(d){for(var g=this.aL(),e=!0,m=g+1,v=g;m!=g;v=m){var k=this.Jd[v],m=-1!=k.Rg?k.Rg:(v+1)%this.Jd.length;0!=k.qn&&(e&&d.Nr(k.Fl),2==k.qn?this.NA(d,k.Lt,k.Fl,k.Ql,!0):d.Lm(k.Ql),e=!1)}};m.prototype.aL=function(){null==this.Vq&&(this.Vq=[null,null,null,null,null,null,null,null,null]);for(var d=0,g=0,e=this.Jd.length;g<e;){var m=
this.Jd[g];if(0!=(m.qn&3)){d=g;break}g=m.Rg}e=d+1;for(g=d;e!=d;g=e){for(var m=this.Jd[g],e=m.Rg,v=1,a=null;e!=g;){a=this.Jd[e];if(0!=(a.qn&3))break;e=a.Rg;v++}1!=v&&1==(m.qn&a.qn)&&(null==this.Wq&&(this.Wq=new k.yb,this.Tt=new k.yb),this.Wq.ed(m.Fl),this.Wq.vd(m.Ql),this.Tt.ed(a.Fl),this.Tt.vd(a.Ql),1==this.Wq.Ga(this.Tt,this.Vq,null,null,this.jr)&&(m.Ql.J(this.Vq[0]),a.Fl.J(this.Vq[0]),m.Rg=e,a.Ug=g))}return d};m.prototype.rt=function(d,g,e){var m=new k.b;m.pc(e,d);e=m.length();e=this.hb*this.hb-
e*e*.25;if(0<e){e=Math.sqrt(e);m.normalize();m.Kp();var v=new k.b;v.pc(g,d);if(v.ml(m)+e>=this.hb)return!0}return!1};m.prototype.MM=function(d,g,e){for(var m=0;1>m;m++){var v=!1,a=d.Vb(g),D=d.Ha(a);if(0==D)break;var b=D;if(3>D)break;!d.vc(a)&&(b=D-1);for(var a=d.Cb(a),D=0<e?d.Ua(a):d.X(a),c=0<e?d.X(a):d.Ua(a),L=D,n=!0,h=new k.b,l=new k.b,q=new k.b,u=new k.b,R=new k.b,f=k.b.Oa(0,0),A=new k.b,p=new k.b,x=new k.b,w=new k.b,C=this.hb,t=0,y=0;y<b;){d.w(c,l);n&&(d.w(a,h),d.w(D,q),L=D);p.pc(h,q);p.normalize();
A.pc(l,h);A.normalize();if(L==c)break;var z=p.Ai(A),V=p.ml(A),E=!0;0>z||0>V&&0==z||!this.rt(q,h,l)||(f.J(l),E=!1,++t,v=!0);if(E){if(0<t)for(;;){z=0<e?d.Ua(L):d.X(L);if(z==a)break;d.w(z,u);if(this.rt(u,q,f))q.J(u),L=z,E=!1,++t;else{z!=c&&this.rt(u,q,l)&&this.rt(u,h,l)&&(q.J(u),L=z,E=!1,++t);break}}if(!E)continue;if(0<t){L=0<e?d.Ua(D):d.X(D);for(n=1;n<t;n++)E=0<e?d.Ua(L):d.X(L),d.vf(L,!0),L=E;x.pc(h,q);t=x.length();t=C*C-t*t*.25;t=Math.sqrt(t);C-t>.5*this.Cj?(R.add(q,h),R.scale(.5),x.normalize(),x.Kp(),
w.J(x),w.scale(C-t),R.add(w),d.Yi(D,R)):d.vf(D,!0);t=0}q.J(h);L=a}h.J(l);D=a;a=c;c=0<e?d.X(a):d.Ua(a);y++;n=!1}if(0<t){L=0<e?d.Ua(D):d.X(D);for(n=1;n<t;n++)E=0<e?d.Ua(L):d.X(L),d.vf(L,!0),L=E;R.add(q,h);R.scale(.5);x.pc(h,q);t=x.length();t=C*C-t*t*.25;t=Math.sqrt(t);x.normalize();x.Kp();w.J(x);w.scale(C-t);R.add(w);d.Yi(D,R)}d.xo(this.vx,!1,!1);if(!v)break}};m.prototype.pD=function(d,g){if(1==d.Ha(g))return!0;var e=new k.i;d.Ti(g,e);return Math.max(e.aa(),e.ba())<.5*this.Cj?!0:!1};m.prototype.oD=
function(d){var g=new k.i;d.o(g);return Math.max(g.aa(),g.ba())<.5*this.Cj?!0:!1};m.prototype.SQ=function(d){d=k.Sz.local().$(d,.25*this.Cj,!1,this.Yb);for(var g=0,e=0,m=d.ea();e<m;e++)g=Math.max(d.Ha(e),g);if(32>g)return this.Yo=!1,d;this.Yo=!0;return k.Of.Qj(d,this.jr,!1,!0,this.Yb)};m.prototype.us=function(d,g){g=g.w();if(null!=this.sd&&0!==this.sd.length){var e=new k.b;e.J(this.sd[0]);e.Fr(this.hb,g);d.Nr(e);for(var m=1,v=this.sd.length;m<v;m++)e.J(this.sd[m]),e.Fr(this.hb,g),d.Lm(e)}else for(var m=
this.pB(),e=k.I.truncate((m+3)/4),m=.5*Math.PI/e,v=Math.cos(m),a=Math.sin(m),D=new k.b,b=3;0<=b;b--)switch(D.ma(0,this.hb),b){case 0:for(m=0;m<e;m++)d.wj(D.x+g.x,D.y+g.y),D.Er(v,a);break;case 1:for(m=0;m<e;m++)d.wj(-D.y+g.x,D.x+g.y),D.Er(v,a);break;case 2:for(m=0;m<e;m++)d.wj(-D.x+g.x,-D.y+g.y),D.Er(v,a);break;default:for(d.Uy(D.y+g.x,-D.x+g.y),m=1;m<e;m++)D.Er(v,a),d.wj(D.y+g.x,-D.x+g.y)}};m.Id=function(d){d.hg(1,0);return d};m.prototype.nS=function(d){d.hg(2,this.ka);d.hl();return d};return m}();
k.UG=m})(x||(x={}));(function(k){var a=function(){function a(e){this.Qb=e;this.a=new k.fd;this.vg=new k.ga(0)}a.prototype.po=function(e,d,g){switch(d){case 0:if(e.v<g&&e.B<=g)break;else return e.v>=g?1:-1;case 1:if(e.C<g&&e.G<=g)break;else return e.C>=g?1:-1;case 2:if(e.v>=g&&e.B>g)break;else return e.B<=g?1:-1;case 3:if(!(e.C>=g&&e.G>g))return e.G<=g?1:-1}return 0};a.prototype.cL=function(e,d){return 1736==e.D()?this.dL(e,d):this.eL(e)};a.prototype.dL=function(e,d){if(0==this.Qb.aa()||0==this.Qb.ba())return e.Pa();
var g=new k.i;e.dd(g);this.U=this.a.Eb(e);var m=new k.i,v=new k.i,a=new k.b,b=new k.b,c=[0,0,0,0,0,0,0,0,0],n=[0,0,0,0,0,0,0,0,0];new k.Ag;var h=new k.yb,l=new k.ga(0);l.xb(Math.min(100,e.F()));for(var q=!1,u=0;!q&&4>u;u++){var f=!1,A=0!=(u&1),p=0;switch(u){case 0:p=this.Qb.v;f=g.v<=p&&g.B>=p;break;case 1:p=this.Qb.C;f=g.C<=p&&g.G>=p;break;case 2:p=this.Qb.B;f=g.v<=p&&g.B>=p;break;case 3:p=this.Qb.G,f=g.C<=p&&g.G>=p}if(f)for(q=!0,f=this.a.Vb(this.U);-1!=f;){var x=-1,w=-1,C=this.a.Cb(f),t=C;do{var y=
this.a.cc(t);null==y&&(y=h,this.a.w(t,a),y.ed(a),this.a.w(this.a.X(t),b),y.vd(b));y.o(m);var z=this.po(m,u,p),V=0,E=-1;if(-1==z){y=y.nt(A,p,c,n);0<y?V=this.a.Mr(t,n,y):V=0;for(var V=V+1,I=t,J=this.a.X(I),y=0;y<V;y++){this.a.w(I,a);this.a.w(J,b);E=this.a.cc(I);null==E&&(E=h,E.ed(a),E.vd(b));E.o(v);E=this.po(v,u,p);if(-1==E){if(A)E=Math.abs(a.y-p),K=Math.abs(b.y-p),E<K?(a.y=p,this.a.Yi(I,a)):(b.y=p,this.a.Yi(J,b));else{var E=Math.abs(a.x-p),K=Math.abs(b.x-p);E<K?(a.x=p,this.a.Yi(I,a)):(b.x=p,this.a.Yi(J,
b))}E=this.a.cc(I);null==E&&(E=h,E.ed(a),E.vd(b));E.o(v);E=this.po(v,u,p)}K=x;x=E;-1==w&&(w=x);if(0!=K||1!=x)1==K&&0==x||0!=K||0!=x||l.add(I);1==x&&(q=!1);E=I=J;J=this.a.X(J)}}if(0==V){K=x;x=z;-1==w&&(w=x);if(0!=K||1!=x)1==K&&0==x||0!=K||0!=x||l.add(t);1==x&&(q=!1);E=this.a.X(t)}t=E}while(t!=C);0==w&&0==x&&l.add(C);y=0;for(x=l.size;y<x;y++)w=l.get(y),this.a.vf(w,!1);l.clear(!1);f=3>this.a.Ha(f)?this.a.Cr(f):this.a.bc(f)}}if(q)return e.Pa();this.AR();0<d&&this.gM(d);return this.a.hf(this.U)};a.prototype.eL=
function(e){var d=new k.i,g=new k.i,m=[0,0,0,0,0,0,0,0,0],v=[0,0,0,0,0,0,0,0,0],a=new k.Ag,b=e,c=new k.i;e.dd(c);for(var n=0;4>n;n++){var h=!1,l=0!=(n&1),q=0;switch(n){case 0:q=this.Qb.v;h=c.v<=q&&c.B>=q;break;case 1:q=this.Qb.C;h=c.C<=q&&c.G>=q;break;case 2:q=this.Qb.B;h=c.v<=q&&c.B>=q;break;case 3:q=this.Qb.G,h=c.C<=q&&c.G>=q}if(h){h=b;b=e.Pa();h=h.Ca();h.Lk();for(var u,f=new k.b;h.kb();)for(var A,p=!0;h.La();){var x=h.ia();x.o(d);var w=this.po(d,n,q);if(-1==w){if(w=x.nt(l,q,m,v),0<w){var C=0;u=
x.Mb();for(var t=0;t<=w;t++)if(A=t<w?v[t]:1,C!=A){x.Bi(C,A,a);var y=a.get();y.ed(u);t<w&&(l?(f.x=m[t],f.y=q):(f.x=q,f.y=m[t]),y.vd(f));y.o(g);var z=this.po(g,n,q);if(-1==z){u=y.Mb();C=y.oc();if(l)z=Math.abs(u.y-q),E=Math.abs(C.y-q),z<E?(u.y=q,y.ed(u)):(C.y=q,y.vd(C));else{var z=Math.abs(u.x-q),E=Math.abs(C.x-q);z<E?(u.x=q,y.ed(u)):(C.x=q,y.vd(C))}y.o(g);z=this.po(g,n,q)}u=y.oc();C=A;A=z;1==A?(b.Bc(y,p),p=!1):p=!0}}}else A=w,1==A?(b.Bc(x,p),p=!1):p=!0}}}return b};a.prototype.AR=function(){this.vn=
-1;this.Nu(!1,this.Qb.v);this.Nu(!1,this.Qb.B);this.Nu(!0,this.Qb.C);this.Nu(!0,this.Qb.G);this.vg.resize(0);this.vg.xb(100);this.vn=this.a.re();for(var e=new k.b,d=this.a.Vb(this.U);-1!=d;d=this.a.bc(d))for(var g=this.a.Cb(d),m=0,v=this.a.Ha(d);m<v;m++,g=this.a.X(g))if(this.a.w(g,e),this.Qb.v==e.x||this.Qb.B==e.x||this.Qb.C==e.y||this.Qb.G==e.y)this.a.lb(g,this.vn,this.vg.size),this.vg.add(g);this.zu(!1,this.Qb.v);this.zu(!1,this.Qb.B);this.zu(!0,this.Qb.C);this.zu(!0,this.Qb.G);this.WM()};a.prototype.gM=
function(e){for(var d=new k.b,g=new k.b,m=k.I.Lh(2048,0),v=this.a.Vb(this.U);-1!=v;v=this.a.bc(v)){var a=this.a.Cb(v),b=a;do{var c=this.a.X(b);this.a.w(b,d);var n=-1;d.x==this.Qb.v?(this.a.w(c,g),g.x==this.Qb.v&&(n=1)):d.x==this.Qb.B&&(this.a.w(c,g),g.x==this.Qb.B&&(n=1));d.y==this.Qb.C?(this.a.w(c,g),g.y==this.Qb.C&&(n=0)):d.y==this.Qb.G&&(this.a.w(c,g),g.y==this.Qb.G&&(n=0));if(-1!=n&&(n=k.b.Fb(d,g),n=k.I.truncate(Math.min(Math.ceil(n/e),2048)),!(1>=n))){for(var h=1;h<n;h++)m[h-1]=1*h/n;this.a.Mr(b,
m,n-1)}b=c}while(b!=a)}};a.prototype.Nu=function(e,d){var g=this.a.re(),m=new k.b,v=new k.ga(0);v.xb(100);for(var a=this.a.Vb(this.U);-1!=a;a=this.a.bc(a))for(var b=this.a.Cb(a),c=0,n=this.a.Ha(a);c<n;c++){var h=this.a.X(b);this.a.w(b,m);if(e?m.y==d:m.x==d)if(this.a.w(h,m),e?m.y==d:m.x==d)1!=this.a.Ra(b,g)&&(v.add(b),this.a.lb(b,g,1)),1!=this.a.Ra(h,g)&&(v.add(h),this.a.lb(h,g,1));b=h}this.a.bf(g);if(!(3>v.size)){var l=this;v.xd(0,v.size,function(d,g){return l.kj(d,g)});g=new k.b;a=new k.b;b=new k.b;
a.Eh();for(var q=-1,c=new k.ga(0),n=new k.ga(0),h=this.a.re(),u=this.a.re(),f=0,A=v.size;f<A;f++){var p=v.get(f);this.a.w(p,m);if(!m.ub(a)){if(-1!=q){for(var x=q;x<f;x++){var q=v.get(x),w=this.a.X(q),p=this.a.Ua(q),C=!1;0>this.kj(q,w)&&(this.a.w(w,g),e?g.y==d:g.x==d)&&(c.add(q),C=!0,this.a.lb(q,u,1));0>this.kj(q,p)&&(this.a.w(p,g),e?g.y==d:g.x==d)&&(C||c.add(q),this.a.lb(q,h,1))}x=0;for(C=c.size;x<C;x++){q=c.get(x);p=this.a.Ra(q,h);w=this.a.Ra(q,u);if(1==p){p=this.a.Ua(q);this.a.w(p,b);var t=[0];
t[0]=0;if(!b.ub(m)){var y=k.b.Fb(a,b);t[0]=k.b.Fb(b,m)/y;0==t[0]?t[0]=2.220446049250313E-16:1==t[0]&&(t[0]=.9999999999999998);this.a.Mr(p,t,1);p=this.a.Ua(q);this.a.Yi(p,m);n.add(p);this.a.lb(p,h,1);this.a.lb(p,u,-1)}}1==w&&(w=this.a.X(q),this.a.w(w,b),t=[0],t[0]=0,b.ub(m)||(y=k.b.Fb(a,b),t[0]=k.b.Fb(a,m)/y,0==t[0]?t[0]=2.220446049250313E-16:1==t[0]&&(t[0]=.9999999999999998),this.a.Mr(q,t,1),p=this.a.X(q),this.a.Yi(p,m),n.add(p),this.a.lb(p,h,-1),this.a.lb(p,u,1)))}q=c;c=n;n=q;n.clear(!1)}q=f;a.J(m)}}this.a.bf(h);
this.a.bf(u)}};a.prototype.zu=function(e,d){var g=new k.b,m=new k.ga(0);m.xb(100);for(var v=this.a.re(),a=0,b=this.vg.size;a<b;a++){var c=this.vg.get(a);if(-1!=c){var n=this.a.X(c);this.a.w(c,g);if(e?g.y==d:g.x==d)if(this.a.w(n,g),e?g.y==d:g.x==d)-2!=this.a.Ra(c,v)&&(m.add(c),this.a.lb(c,v,-2)),-2!=this.a.Ra(n,v)&&(m.add(n),this.a.lb(n,v,-2))}}if(0!=m.size){var h=this;m.xd(0,m.size,function(d,g){return h.kj(d,g)});a=0;for(b=m.size;a<b;a++){var l=m.get(a);this.a.lb(l,v,a)}c=new k.b;n=new k.b;n.Eh();
for(var q=-1,a=0,b=m.size;a<b;a++)if(l=m.get(a),-1!=l&&(this.a.w(l,g),!g.ub(n))){if(-1!=q)for(;;){for(var l=!1,u=1<a-q?a-1:a,f=q;f<u;f++){var A=m.get(f);if(-1!=A){var p=-1,x=this.a.X(A);0>this.kj(A,x)&&(this.a.w(x,c),e?c.y==d:c.x==d)&&(p=x);var x=-1,w=this.a.Ua(A);0>this.kj(A,w)&&(this.a.w(w,c),e?c.y==d:c.x==d)&&(x=w);if(-1!=p&&-1!=x)this.no(A,m,v),this.a.vf(A,!1),this.no(p,m,v),this.a.vf(p,!1),l=!0;else if(-1!=p||-1!=x){for(w=f+1;w<a;w++){var C=m.get(w);if(-1!=C){var t=this.a.X(C),y=-1;0>this.kj(C,
t)&&(this.a.w(t,c),e?c.y==d:c.x==d)&&(y=t);var t=this.a.Ua(C),z=-1;0>this.kj(C,t)&&(this.a.w(t,c),e?c.y==d:c.x==d)&&(z=t);if(-1!=y&&-1!=z){this.no(C,m,v);this.a.vf(C,!1);this.no(y,m,v);this.a.vf(y,!1);l=!0;break}if(-1!=p&&-1!=z){this.dF(m,A,p,C,z,v);l=!0;break}else if(-1!=x&&-1!=y){this.dF(m,C,y,A,x,v);l=!0;break}}}if(l)break}}}if(!l)break}q=a;n.J(g)}}this.a.bf(v)};a.prototype.no=function(e,d,g){g=this.a.Ra(e,g);d.set(g,-1);g=this.a.Ra(e,this.vn);this.vg.set(g,-1);d=this.a.rd(e);-1!=d&&this.a.Cb(d)==
e&&(this.a.Dh(d,-1),this.a.Wi(d,-1))};a.prototype.dF=function(e,d,g,m,v,k){this.a.Sc(d,m);this.a.Tc(m,d);this.a.Tc(g,v);this.a.Sc(v,g);this.no(m,e,k);this.a.Ui(m,!1);this.no(v,e,k);this.a.Ui(v,!0)};a.prototype.WM=function(){for(var e=0,d=this.vg.size;e<d;e++){var g=this.vg.get(e);-1!=g&&this.a.im(g,-1)}for(var m=0,v=0,k=this.a.Vb(this.U);-1!=k;){var a=this.a.Cb(k);if(-1==a||k!=this.a.rd(a)){var b=k,k=this.a.bc(k);this.a.Dh(b,-1);this.a.yu(b)}else{g=a;b=0;do this.a.im(g,k),b++,g=this.a.X(g);while(g!=
a);2>=b?(g=this.a.Ra(a,this.vn),this.vg.set(g,-1),a=this.a.vf(a,!1),2==b&&(g=this.a.Ra(a,this.vn),this.vg.set(g,-1),this.a.vf(a,!1)),b=k,k=this.a.bc(k),this.a.Dh(b,-1),this.a.yu(b)):(this.a.Jr(k,!1),this.a.Wi(k,this.a.Ua(a)),this.a.hm(k,b),v+=b,m++,k=this.a.bc(k))}}e=0;for(d=this.vg.size;e<d;e++)if(g=this.vg.get(e),-1!=g&&(k=this.a.rd(g),-1==k)){k=this.a.Cf(this.U,-1);b=0;a=g;do this.a.im(g,k),b++,g=this.a.X(g);while(g!=a);2>=b?(g=this.a.Ra(a,this.vn),this.vg.set(g,-1),a=this.a.vf(a,!1),2==b&&(g=
this.a.Ra(a,this.vn),0<=g&&this.vg.set(g,-1),this.a.vf(a,!1)),b=k,this.a.Dh(b,-1),this.a.yu(b)):(this.a.Gn(k,!0),this.a.hm(k,b),this.a.Dh(k,a),this.a.Wi(k,this.a.Ua(a)),this.a.Jr(k,!1),v+=b,m++)}this.a.gm(this.U,m);this.a.Pk(this.U,v);e=0;for(d=this.a.$c;-1!=d;d=this.a.we(d))e+=this.a.F(d);this.a.ZF(e)};a.Xk=function(e,d,g){return(new a(d)).cL(e,g)};a.clip=function(e,d,g,m){if(e.s())return e;if(d.s())return e.Pa();g=e.D();if(33==g)return m=e.w(),d.contains(m)?e:e.Pa();if(197==g)return m=new k.i,e.o(m),
m.Ga(d)?(d=new k.Vj,e.copyTo(d),d.Cu(m),d):e.Pa();var v=new k.i;e.dd(v);if(d.contains(v))return e;if(!d.jc(v))return e.Pa();v=e.pb;if(null!=v&&(v=v.hi,null!=v)){v=v.Dn(d);if(1==v){if(1736!=g)throw k.g.wa();e=new k.Ka(e.description);e.ws(d);return e}if(0==v)return e.Pa()}switch(g){case 550:g=null;for(var v=e.F(),D=e.mc(0),b=0,c=0;c<v;c++)m=new k.b,D.ec(2*c,m),d.contains(m)||(0==b&&(g=e.Pa()),b<c&&g.Pd(e,b,c),b=c+1);0<b&&g.Pd(e,b,v);return 0==b?e:g;case 1736:case 1607:return a.Xk(e,d,m);default:throw k.g.wa();
}};a.prototype.kj=function(e,d){var g=new k.b;this.a.w(e,g);e=new k.b;this.a.w(d,e);return g.compare(e)};return a}();k.Ed=a})(x||(x={}));(function(k){var a=new k.b,b=function(){function d(d,e,v,a,b){this.Ml=new k.b;this.ln=new k.b;this.Ck=new k.b;this.a=d;this.Px=v;this.bn=a;this.Ml=e;this.vk=b;this.ln.Eh();this.Ck.Eh()}d.prototype.sB=function(d){this.a.w(d,this.ln);d=k.I.truncate((this.ln.x-this.Ml.x)*this.bn+.5);var g=k.I.truncate((this.ln.y-this.Ml.y)*this.bn+.5);return e.XC(d,g)};d.prototype.vw=
function(d){return this.a.Ra(d,this.vk)};return d}();k.wT=function(){return function(){}}();var e=function(){function d(){this.Ml=new k.b;this.Zo=[0,0,0,0];this.Kq=[0,0,0,0];this.en=this.vk=-1}d.zM=function(g,e){var m=new d;m.a=g;m.ka=e;m.Px=e*e;m.Kt=2*e;m.bn=1/m.Kt;return m.fL()};d.Vw=function(d,e,v,k,a){d-=v;e-=k;return d*d+e*e<=a};d.XC=function(d,e){return k.I.kg(e,k.I.kg(d))};d.prototype.hL=function(g,e){this.a.uc(g,a);for(var m=(a.y-this.Ml.y)*this.bn,D=k.I.truncate((a.x-this.Ml.x)*this.bn),
b=k.I.truncate(m),c=m=0;1>=c;c+=1)for(var n=0;1>=n;n+=1){var h=d.XC(D+c,b+n),l=this.uk.DN(h);-1!=l&&(this.Zo[m]=l,this.Kq[m]=h,m++)}for(D=m-1;1<=D;D--)for(l=this.Zo[D],b=D-1;0<=b;b--)if(l==this.Zo[b]){this.Kq[b]=-1;m--;D!=m&&(this.Kq[D]=this.Kq[m],this.Zo[D]=this.Zo[m]);break}for(b=0;b<m;b++)this.iL(g,this.Kq[b],a,this.Zo[b],e)};d.prototype.iL=function(g,e,v,a,b){for(var m=new k.b;-1!=a;a=this.uk.SN(a)){var D=this.uk.da(a);g==D||-1!=e&&this.a.Ra(D,this.vk)!=e||(this.a.uc(D,m),d.Vw(v.x,v.y,m.x,m.y,
this.Px)&&b.add(a))}};d.prototype.Tl=function(d,e,v){var g=this.a.Ra(d,this.en),m=this.a.Ra(e,this.en);-1==g&&(g=this.nd.jh(),this.nd.addElement(g,d),this.a.lb(d,this.en,g));-1==m?this.nd.addElement(g,e):this.nd.Qv(g,m);this.a.lb(e,this.en,-2);e=this.aQ(d,e);v&&(v=this.St.sB(d),this.a.lb(d,this.vk,v));return e};d.$P=function(g,e,v){g.lc(e);v=g;var m=new k.b;d.HH(g.w(),e.w(),m);v.ic(m)};d.HH=function(d,e,v){var g=d.x;d.x!=e.x&&(g=(1*d.x+1*e.x)/2);var m=d.y;d.y!=e.y&&(m=(1*d.y+1*e.y)/2);v.ma(g,m)};
d.prototype.aQ=function(d,e){var g=new k.b;this.a.w(d,g);var m=new k.b;this.a.w(e,m);var a=this.a.RC(d);e=this.a.RC(e);var b=a+e,c=0,n=g.x;g.x!=m.x&&(n=(g.x*a+m.x*e)/b,c++);var h=g.y;g.y!=m.y&&(h=(g.y*a+m.y*e)/b,c++);0<c&&this.a.ic(d,n,h);this.a.pS(d,b);return 0!=c};d.prototype.fL=function(){var d=this.a.pd,e=this.a.wC();this.Ml=e.yw();e=Math.max(e.ba(),e.aa())/2147483646;this.Kt<e&&(this.Kt=e,this.bn=1/this.Kt);this.nd=new k.Ur;this.nd.Dr(k.I.truncate(this.a.pd/3+1));this.nd.$l(k.I.truncate(this.a.pd/
3+1));this.vk=this.a.re();this.en=this.a.re();this.St=new b(this.a,this.Ml,this.Px,this.bn,this.vk);this.uk=new k.AH(k.I.truncate(4*d/3),this.St);this.uk.wR(this.a.pd);d=!1;for(e=this.a.$c;-1!=e;e=this.a.we(e))for(var v=this.a.Vb(e);-1!=v;v=this.a.bc(v))for(var a=this.a.Cb(v),c=0,n=this.a.Ha(v);c<n;c++){var h=this.St.sB(a);this.a.lb(a,this.vk,h);this.uk.addElement(a,h);a=this.a.X(a)}var l=new k.ga(0);l.xb(10);for(e=this.a.$c;-1!=e;e=this.a.we(e))for(v=this.a.Vb(e);-1!=v;v=this.a.bc(v))for(a=this.a.Cb(v),
c=0,n=this.a.Ha(v);c<n;c++){if(-2!=this.a.Ra(a,this.en))for(h=this.a.Ra(a,this.vk),this.uk.Jc(a,h);;){this.hL(a,l);if(0==l.size)break;for(var h=!1,q=0,u=l.size;q<u;q++){var f=l.get(q),A=this.uk.da(f);this.uk.kd(f);h=this.Tl(a,A,q+1==u)||h}d=d||h;l.clear(!1);if(!h)break}a=this.a.X(a)}d&&this.ZJ();this.St=this.uk=null;this.a.bf(this.vk);this.a.bf(this.en);return d};d.prototype.ZJ=function(){for(var d=new k.b,e=this.nd.Wd;-1!=e;e=this.nd.Cw(e)){var v=this.nd.gc(e);this.a.w(this.nd.da(v),d);for(v=this.nd.bb(v);-1!=
v;v=this.nd.bb(v))this.a.Yi(this.nd.da(v),d)}};return d}();k.Sr=e})(x||(x={}));(function(k){var a=Math.PI,b=2*Math.PI,e=Math.PI/2,d=function(){function d(){}d.yL=function(g,e){var m=new d;m.x=g;m.y=e;m.type=0;m.mh=0;return m};d.um=function(g){var e=new d;e.x=g.x;e.y=g.y;e.type=0;e.mh=0;return e};d.xL=function(g){var e=new d;e.x=g.x;e.y=g.y;e.type=g.type;e.mh=g.mh;return e};d.Ad=function(g,e,m){var v=new d;v.x=g.x+e*Math.cos(m);v.y=g.y+e*Math.sin(m);v.type=g.type;v.mh=g.mh;return v};d.Js=function(g,
e){var m=new d;m.x=.5*(g.x+e.x);m.y=.5*(g.y+e.y);m.type=g.type;m.mh=g.mh;return m};d.LB=function(g,e){var m=new d;m.x=g.x+.001*(e.x-g.x);m.y=g.y+.001*(e.y-g.y);m.type=g.type;m.mh=g.mh;return m};return d}(),g=function(){return function(){}}();(function(d){d[d.Round=0]="Round";d[d.Bevel=1]="Bevel";d[d.Miter=2]="Miter";d[d.Square=3]="Square"})(k.EH||(k.EH={}));var m=function(){function m(d){this.Kx=this.Ib=this.dg=null;this.oe=d}m.$=function(d,g,e,v,a,b){if(null==d)throw k.g.N();if(1>d.fb())throw k.g.N();
if(0==g||d.s())return d;b=new m(b);b.$m=d;b.Da=g;b.ka=a;b.bi=e;b.Dx=v;return b.hv()};m.prototype.hJ=function(){var d=this.$m,g=d.Mb(),e=d.oc(),m=new k.b;m.pc(e,g);m.normalize();m.tt();m.scale(this.Da);g.add(m);e.add(m);m=d.Pa();d.ed(g);d.vd(e);return m};m.prototype.gJ=function(){var d=this.$m;if(0<this.Da&&2!=this.bi){var g=new k.Ka;g.Wc(d,!1);this.$m=g;return this.hv()}d=new k.Vj(d.R);d.P(this.Da,this.Da);return d};m.prototype.rF=function(d,g,e,m){return(g.x-d.x)*(m.x-e.x)+(g.y-d.y)*(m.y-e.y)};m.prototype.Ub=
function(g,m){if(void 0===m)this.Ib.push(g),this.Xe++;else if(0==this.Xe)this.Ub(g);else{var v=this.eu,a,k;a=this.dg[0==m?v-1:m-1];k=this.dg[m];var D=this.rF(a,k,this.Ib[this.Xe-1],g);0<D?this.Ub(g):0>D&&(0<this.rF(a,k,k,this.Ib[this.Xe-1])?(k=this.dg[0==m?v-2:1==m?v-1:m-2],v=d.Ad(a,this.Da,Math.atan2(a.y-k.y,a.x-k.x)-e),this.Ib[this.Xe-1]=v,1==this.bi||2==this.bi?(v=d.Js(v,a),this.Ub(v),v=d.Ad(a,this.Da,this.vt+e),a=d.Js(v,a),a.type|=256,this.Ub(a)):(v=d.Ad(a,this.Da,this.vt+e),v.type|=256),this.Ub(v),
this.Ub(g,m)):(v=d.Ad(k,this.Da,this.vt+e),this.Ub(v),1==this.bi||2==this.bi?(v=d.Js(v,k),this.Ub(v),v=d.Ad(k,this.Da,this.gx-e),a=d.Js(v,k),a.type|=256,this.Ub(a)):(v=d.Ad(k,this.Da,this.gx-e),v.type|=256),this.Ub(v)))}};m.prototype.mB=function(){var g,m,v,c,n,h,l=this.eu;this.Xe=0;var q=.5*this.ka,u=0,f=0;for(g=0;g<l;g++){c=this.dg[g];n=0==g?this.dg[l-1]:this.dg[g-1];h=g==l-1?this.dg[0]:this.dg[g+1];var A=n.x-c.x,p=n.y-c.y,x=h.x-c.x,w=h.y-c.y;m=Math.atan2(p,A);v=Math.atan2(w,x);this.vt=m;this.gx=
v;0==g&&(u=m,f=v);A=A*w-x*p;p=v;v<m&&(v+=b);if(0<A*this.Da)1==this.bi||2==this.bi?(m=d.Ad(c,this.Da,m+e),this.Ub(m),m=d.LB(c,m),this.Ub(m),m=d.Ad(c,this.Da,v-e),c=d.LB(c,m),c.type|=256,this.Ub(c),this.Ub(m)):(A=.5*(v-m),A=this.Da/Math.abs(Math.sin(A)),m=d.Ad(c,A,.5*(m+v)),this.Ub(m,g));else if(0!=(c.type&512)){A=1-q/Math.abs(this.Da);n=1;h=0>this.Da?-a:a;-1<A&&1>A&&(p=2*Math.acos(A),.017453292519943295>p&&(p=.017453292519943295),n=k.I.truncate(a/p+1.5),1<n&&(h/=n));p=m+e;m=d.Ad(c,this.Da,p);0==g&&
(m.type|=1024);this.Ub(m,g);A=this.Da/Math.cos(h/2);p+=h/2;m=d.Ad(c,A,p);m.type|=1024;for(this.Ub(m);0<--n;)p+=h,m=d.Ad(c,A,p),m.type|=1024,this.Ub(m);m=d.Ad(c,this.Da,v-e);m.type|=1024;this.Ub(m)}else if(1==this.bi)m=d.Ad(c,this.Da,m+e),this.Ub(m,g),m=d.Ad(c,this.Da,v-e),this.Ub(m);else if(0==this.bi)for(A=1-q/Math.abs(this.Da),n=1,h=v-e-(m+e),-1<A&&1>A&&(p=2*Math.acos(A),.017453292519943295>p&&(p=.017453292519943295),n=k.I.truncate(Math.abs(h)/p+1.5),1<n&&(h/=n)),A=this.Da/Math.cos(.5*h),p=m+e+
.5*h,m=d.Ad(c,A,p),this.Ub(m,g);0<--n;)p+=h,m=d.Ad(c,A,p),this.Ub(m);else 2==this.bi?(A=n.x-c.x,p=n.y-c.y,x=h.x-c.x,w=h.y-c.y,n=(A*x+p*w)/Math.sqrt(A*A+p*p)/Math.sqrt(x*x+w*w),.99999999<n?(m=d.Ad(c,1.4142135623730951*this.Da,v-.25*a),this.Ub(m,g),m=d.Ad(c,1.4142135623730951*this.Da,v+.25*a),this.Ub(m)):(n=Math.abs(this.Da/Math.sin(.5*Math.acos(n))),h=Math.abs(this.Dx*this.Da),n>h?(A=.5*(v-m),A=this.Da/Math.abs(Math.sin(A)),m=d.Ad(c,A,.5*(m+v)),v=k.b.Oa(m.x,m.y),m=k.b.Oa(c.x,c.y),c=new k.b,c.pc(v,
m),v=new k.b,v.DR(h/c.length(),c,m),m=(n-h)*Math.abs(this.Da)/Math.sqrt(n*n-this.Da*this.Da),0<this.Da?c.tt():c.Kp(),c.scale(m/c.length()),m=new k.b,m.add(v,c),n=new k.b,n.pc(v,c),m=d.um(m),this.Ub(m,g),m=d.um(n),this.Ub(m)):(A=.5*(v-m),A=this.Da/Math.abs(Math.sin(A)),m=d.Ad(c,A,.5*(m+v)),this.Ub(m,g)))):(v=p,0<this.Da?(v>m&&(v-=b),n=m-v<e):(v<m&&(v+=b),n=v-m<e),n?(A=1.4142135623730951*this.Da,p=0>A?m+.25*a:m+.75*a,m=d.Ad(c,A,p),this.Ub(m,g),p=0>A?v-.25*a:v-.75*a,m=d.Ad(c,A,p),this.Ub(m)):(A=.5*(v-
m),A=this.Da/Math.abs(Math.sin(A)),v<m&&(v+=b),m=d.Ad(c,A,(m+v)/2),this.Ub(m,g)))}this.vt=u;this.gx=f;this.Ub(this.Ib[0],0);c=d.xL(this.Ib[this.Xe-1]);this.Ib[0]=c;return this.sR()};m.prototype.xs=function(d,g){if(!(2>g))for(var e=0;e<g;e++){var m=this.Ib[d+e];0!=e?this.Kx.Lm(k.b.Oa(m.x,m.y)):this.Kx.Nr(k.b.Oa(m.x,m.y))}};m.prototype.iJ=function(g,e,m){var v=g.Ea(e),a=g.Dc(e);this.Ib=[];this.Kx=m;if(g.vc(e)){for(e=g.Fa(v);g.Fa(a-1).ub(e);)a--;if(2<=a-v){this.eu=a-v;this.dg=[];for(e=v;e<a;e++)this.dg.push(d.um(g.Fa(e)));
this.mB()&&this.xs(0,this.Xe-1)}}else{for(e=g.Fa(v);v<a&&g.Fa(v+1).ub(e);)v++;for(e=g.Fa(a-1);v<a&&g.Fa(a-2).ub(e);)a--;if(2<=a-v){this.eu=2*(a-v)-2;this.dg=[];m=d.um(g.Fa(v));m.type|=1536;this.dg.push(m);for(e=v+1;e<a-1;e++)m=d.um(g.Fa(e)),this.dg.push(m);m=d.um(g.Fa(a-1));m.type|=512;this.dg.push(m);for(e=a-2;e>=v+1;e--)m=d.um(g.Fa(e)),m.type|=1024,this.dg.push(m);if(this.mB())if(2<=this.Ib.length){g=-1;(a=0!=(this.Ib[this.Xe-1].type&1024))||(g=0);for(e=1;e<this.Xe;e++)(v=0!=(this.Ib[e].type&1024))?
a||(a=e-1,1<a-g+1&&this.xs(g,a-g+1)):a&&(g=e-1),a=v;a||(a=this.Xe-1,1<a-g+1&&this.xs(g,a-g+1))}else g=0,a=this.Xe-1,0<=g&&1<=a-g&&this.xs(g,a-g+1)}}this.dg=null;this.eu=0;this.Ib=null;this.Xe=0};m.prototype.sR=function(){for(var d=!1,g=0;g<this.Xe;g++){var e=this.Ib[g];e.Rg=g+1;e.Ug=g-1;this.Ib[g]=e}e=this.Ib[0];e.Ug=this.Xe-2;this.Ib[0]=e;e=this.Ib[this.Xe-2];e.Rg=0;this.Ib[this.Xe-2]=e;for(g=e=0;g<this.Xe;g++)if(0!=(this.Ib[e].type&256)){var m=this.$L(e);if(-1!=m)e=m;else{d=!0;break}}else e=this.Ib[e].Rg;
if(d)return!1;this.vL(e);return!0};m.prototype.$L=function(d){for(var g=this.Xe-1,e=d,m,v,a=1;a<=g-2;a++){m=e=this.Ib[e].Rg;v=d;for(var k=1;k<=a;k++){v=this.Ib[v].Ug;if(0==(this.Ib[v].type&256)&&0==(this.Ib[m].type&256)){var D=this.oO(v,m);if(-1!=D)return D}m=this.Ib[m].Ug}}return-1};m.prototype.oO=function(d,e){var m,v,a,D;m=this.Ib[this.Ib[d].Ug];v=this.Ib[d];a=this.Ib[this.Ib[e].Ug];D=this.Ib[e];if(!this.HR(m,v,a,D))return-1;var b=new g;return this.NM(m,v,a,D,b)&&!b.cB&&k.I.bG((v.x-m.x)*(D.y-a.y)-
(v.y-m.y)*(D.x-a.x))!=k.I.bG(this.Da)?(m=this.Ib[d].Ug,b.Xl.type=v.type,b.Xl.Rg=e,b.Xl.Ug=m,this.Ib[d]=b.Xl,b.Xl=this.Ib[e],b.Xl.Ug=d,this.Ib[e]=b.Xl,e):-1};m.prototype.HR=function(d,g,e,m){return Math.max(d.x,g.x)>=Math.min(e.x,m.x)&&Math.max(e.x,m.x)>=Math.min(d.x,g.x)&&Math.max(d.y,g.y)>=Math.min(e.y,m.y)&&Math.max(e.y,m.y)>=Math.min(d.y,g.y)};m.prototype.NM=function(g,e,m,v,a){a.cB=!1;var k,D,b;k=(e.y-g.y)*(v.x-m.x)-(e.x-g.x)*(v.y-m.y);D=(m.y-g.y)*(e.x-g.x)-(m.x-g.x)*(e.y-g.y);k=0==k?2:D/k;return 0<=
k&&1>=k&&(b=k,k=(v.y-m.y)*(e.x-g.x)-(v.x-m.x)*(e.y-g.y),D=(g.y-m.y)*(v.x-m.x)-(g.x-m.x)*(v.y-m.y),k=0==k?2:D/k,0<=k&&1>=k)?(a.Xl=d.yL(g.x+k*(e.x-g.x),g.y+k*(e.y-g.y)),a.Xl.mh=m.mh+b*(v.mh-m.mh),0!=b&&1!=b||0!=k&&1!=k||(a.cB=!0),a.wU=k,a.xU=b,(0==b||1==b)&&0<k&&1>k||(0==k||1==k)&&0<b&&1>b?!1:!0):!1};m.prototype.vL=function(d){for(;this.Ib[d].Ug<d;)d=this.Ib[d].Ug;var g=0,e=d;do e=this.Ib[e],this.Ib[g]=e,e=e.Rg,g++;while(e!=d);this.Ib[g]=this.Ib[0];this.Xe=g+1};m.prototype.qA=function(d){var g=this.$m,
e=g.Ca();if(null!=e){e.Lk();for(var m=-1;e.kb();)m++,this.iJ(g,m,d)}};m.prototype.hv=function(){var d=this.$m.D();return 322==d?this.hJ():197==d?this.gJ():k.T.Lc(d)?(d=new k.Xa,d.Bc(this.$m,!0),this.$m=d,this.hv()):1607==d?(d=new k.Xa,this.qA(d),d):1736==d?(d=new k.Ka,this.qA(d),d):null};return m}();k.XG=m})(x||(x={}));(function(a){var k=function(){function d(d){this.xj=d}d.prototype.w=function(d,g){this.xj.a.w(d,g)};d.prototype.kd=function(d){var g=this.xj.za.da(d);this.xj.za.kd(d,-1);this.xj.a.vf(g,
!1)};return d}(),b=function(){function d(d){this.xj=d}d.prototype.w=function(d,g){this.xj.NP.w(d,g)};d.prototype.kd=function(d){this.xj.za.kd(d,-1)};return d}(),e=function(){function d(d){this.xj=d}d.prototype.w=function(d,g){g.J(this.xj.PP[d])};d.prototype.kd=function(d){this.xj.za.kd(d,-1)};return d}(),d=function(){function d(d){void 0===d?(this.za=new a.bj,this.za.de(20),this.a=new a.fd,this.FP=this.a.jg(550),this.cr=this.a.Cf(this.FP,-1),this.oh=new k(this)):d instanceof Array?(this.za=new a.bj,
this.za.de(20),this.PP=d,this.oh=new e(this)):(this.za=new a.bj,this.za.de(20),this.NP=d,this.oh=new b(this))}d.prototype.Eb=function(d){var g=d.D();if(a.Wr.Th(g))this.OJ(d);else if(a.al.Lc(g))this.SJ(d);else if(197==g)this.LJ(d);else if(33==g)this.RJ(d);else throw a.g.N("invalid shape type");};d.prototype.sN=function(){var d=new a.Va,g=this.za.gc(-1),e=new a.Ka(this.a.wp);this.a.Jk(this.za.da(g),d);e.df(d);for(g=this.za.bb(g);-1!=g;g=this.za.bb(g))this.a.Jk(this.za.da(g),d),e.lineTo(d);return e};
d.wL=function(g){var e=new d(g),m=g.F(),k=1,b=new a.b,c=new a.b,n=new a.b;for(g.w(0,b);;){g.w(k,c);if(!(c.Ww(b)&&k<m-1))break;k++}e.za.addElement(0,-1);e.za.qm(k);for(m=k+1;m<g.F();m++)g.w(m,n),k=e.cz(n),-1!=k&&e.za.Vi(k,m);n=new a.Va;k=e.za.gc(-1);m=new a.Ka(g.description);g.Sd(e.za.da(k),n);m.df(n);for(k=e.za.bb(k);-1!=k;k=e.za.bb(k))g.Sd(e.za.da(k),n),m.lineTo(n);return m};d.Oa=function(g,e,a){for(var m=new d(g),v=1,k=g[0];g[v].Ww(k)&&v<e-1;)v++;m.za.addElement(0,-1);m.za.qm(v);for(v+=1;v<e;v++)k=
m.cz(g[v]),-1!=k&&m.za.Vi(k,v);g=0;for(e=m.za.gc(-1);-1!=e;e=m.za.bb(e))a[g++]=m.za.da(e);return g};d.sD=function(g,e){var m=g.Ea(e),v=g.Dc(e);e=!g.vc(e)&&g.Oo(e);g=g.mc(0);m*=2;v*=2;e&&(v-=2);if(6>v-m)return!0;e=new a.b;var k=new a.b,b=new a.b;g.ec(m,e);g.ec(m+2,k);g.ec(m+4,b);var c=d.Bd(k,b,e);if(c.Dq()||!d.ac(c.value()))return!1;for(var n=a.b.Oa(k.x,k.y),h=new a.b,m=m+6;m<v;m+=2){h.J(k);k.J(b);g.ec(m,b);c=d.Bd(k,b,e);if(c.Dq()||!d.ac(c.value()))return!1;c=d.Bd(n,b,e);if(c.Dq()||!d.ac(c.value()))return!1;
c=d.Bd(k,b,h);if(c.Dq()||!d.ac(c.value()))return!1}return!0};d.prototype.OJ=function(d){for(var g=new a.Va,e=new a.b,m=0;m<d.F();m++){d.w(m,e);var k=this.hq(e);if(-1!=k){d.Sd(m,g);var b=this.a.Ub(this.cr,g);this.za.Vi(k,b)}}};d.prototype.LJ=function(d){for(var g=new a.Va,e=new a.b,m=0;4>m;m++){d.vu(m,e);var k=this.hq(e);if(-1!=k){d.uf(m,g);var b=this.a.Ub(this.cr,g);this.za.Vi(k,b)}}};d.prototype.SJ=function(d){var g=new a.Va,e=d.Mb(),e=this.hq(e);if(-1!=e){d.En(g);var m=this.a.Ub(this.cr,g);this.za.Vi(e,
m)}e=d.oc();e=this.hq(e);-1!=e&&(d.Bn(g),d=this.a.Ub(this.cr,g),this.za.Vi(e,d))};d.prototype.RJ=function(d){var g=d.w(),g=this.hq(g);-1!=g&&(d=this.a.Ub(this.cr,d),this.za.Vi(g,d))};d.prototype.hq=function(d){var g=-1;if(0==this.za.size(-1))return g=this.za.addElement(-4,-1);if(1==this.za.size(-1)){var e=this.a.Fa(this.za.da(this.za.gc(-1)));d.Ww(e)||(g=this.za.qm(-5));return g}return g=this.cz(d)};d.prototype.cz=function(g){var e=-1,m=this.za.gc(-1),k=this.za.tc(-1),b=this.za.da(m),c=this.za.da(k),
n=new a.b,h=new a.b;this.oh.w(b,n);this.oh.w(c,h);b=a.b.yn(h,g,n);if(d.ac(b))e=this.za.qm(-1),n=this.az(g,k,m),n!=m&&this.bz(g,m,this.za.ge(n));else if(d.ti(b)){for(var h=this.za.dt(-1),l=this.za.gc(-1),q=this.za.tc(-1),u,b=new a.b,c=new a.b;l!=this.za.ge(q);)u=this.za.da(h),this.oh.w(u,b),u=a.b.yn(b,g,n),d.ti(u)?(q=h,h=this.za.ik(h)):(l=h,h=this.za.Jo(h));h=q;n=l;u=this.za.da(h);l=this.za.da(n);this.oh.w(u,b);this.oh.w(l,c);if(n==m||(b=a.b.yn(c,g,b),d.ac(b)))e=this.za.vs(n,h,-2,!1),this.bz(g,h,k),
this.az(g,n,m)}else null==this.ib&&(this.ib=new a.yb),this.ib.ed(h),this.ib.vd(n),n=this.ib.Gd(g,!0),0>n?(n=this.za.ge(k),this.za.kd(k,-1),e=this.za.qm(-3),this.az(g,n,m)):1<n&&(n=this.za.bb(m),this.za.kd(m,-1),e=this.za.vs(-1,n,-3,!1),this.bz(g,n,k));return e};d.prototype.bz=function(g,e,k){if(e!=k){var m=this.za.da(e),v=this.za.bb(e),D=new a.b,b=new a.b;for(this.oh.w(m,D);e!=k&&2<this.za.size(-1);){this.oh.w(this.za.da(v),b);m=a.b.yn(b,g,D);if(d.ac(m))break;m=e;e=v;D.J(b);v=this.za.bb(e);this.oh.kd(m)}}};
d.prototype.az=function(g,e,k){if(e==k)return k;var m=this.za.da(e),v=this.za.ge(e),D=new a.b,b=new a.b;for(this.oh.w(m,D);e!=k&&2<this.za.size(-1);){this.oh.w(this.za.da(v),b);m=a.b.yn(D,g,b);if(d.ac(m))break;m=e;e=v;D.J(b);v=this.za.ge(e);this.oh.kd(m)}return e};d.Bd=function(d,g,e){var m=new a.$k;m.set(g.x);m.sub(d.x);var v=new a.$k;v.set(e.y);v.sub(d.y);var k=new a.$k;k.set(g.y);k.sub(d.y);g=new a.$k;g.set(e.x);g.sub(d.x);m.Ap(v);k.Ap(g);m.sub(k);return m};d.ac=function(d){return 0>d};d.ti=function(d){return 0<
d};d.ao=function(d){return 0==d};return d}();a.Tr=d})(x||(x={}));(function(a){var k=function(){function k(e){this.oe=this.a=null;this.WD=!0;this.oe=e}k.HE=function(e,d,g){e=a.Ia.As(e);return a.Sr.Vw(d.lk(),d.mk(),g.lk(),g.mk(),a.vi.Ty(e))};k.gL=function(e,d){var g=new a.Va;a.Sr.$P(e,d,g);return g};k.$=function(e,d,g,m){g=new k(g);g.a=e;g.ka=d;g.WD=m;return g.rJ()};k.prototype.lJ=function(e){return a.Sr.zM(this.a,e)};k.prototype.oJ=function(e){return a.Zu.$(this.a,e,this.oe)};k.prototype.rJ=function(){for(var e=
this.ka,d=a.Ia.As(e),e=a.Ia.UJ(e),g=1.00001*e,e=1.000001*e,m=!1,v=30<this.a.pd+10?1E3:(this.a.pd+10)*(this.a.pd+10),k=0,b=this.a.pO();;k++){if(k>v)throw a.g.ra("Internal Error: max number of iterations exceeded");var c=this.lJ(d),m=m||c;this.WD&&(c=0!=this.a.xo(d,!0,!1),m=m||c);c=!1;if(0==k||b||a.Zu.DE(!0,this.a,e,null,this.oe))c=this.oJ(g),m=m||c;if(!c)break}return m};return k}();a.aj=k})(x||(x={}));(function(a){var k=function(){function k(e){this.Ld=this.zc=null;this.Yb=e;this.hx=!0}k.prototype.et=
function(e,d){var g=this.a.cc(e);if(null==g){if(!this.a.Oc(e,d))return null;g=d}return g};k.prototype.LL=function(){var e=this.a.Gp(!1),d=!1,g=new a.yb,m=new a.yb,v=new a.i;v.Ja();var k=new a.i;k.Ja();for(var b=new a.Va,c=new a.gA,n=e.next();-1!=n;n=e.next()){var h=null,l=!1;if(!a.T.Km(this.a.Lb(e.mj))){h=this.et(n,g);if(null==h)continue;h.o(v);v.P(this.ka,this.ka);if(h.mg(this.ka))if(h.mg(0))l=!0,h=null;else continue}var q=this.a.Gp(e),u=q.next();for(-1!=u&&(u=q.next());-1!=u;u=q.next()){var f=null,
A=!1;if(!a.T.Km(this.a.Lb(q.mj))){f=this.et(u,m);if(null==f)continue;f.o(k);if(f.mg(this.ka))if(f.mg(0))A=!0,f=null;else continue}var p=0,x=0;if(null!=h&&null!=f)v.rD(k)&&(c.zn(h),c.zn(f),c.Ga(this.ka,!1),p=c.kk(0),x=c.kk(1),0<p+x&&(this.a.Tp(n,c,0,!0),this.a.Tp(u,c,1,!0)),c.clear());else if(null!=h){var w=new a.b;this.a.w(u,w);if(v.contains(w)){c.zn(h);this.a.Jk(u,b);c.Tw(this.ka,b,!1);p=c.kk(0);if(0<p)if(this.a.Tp(n,c,0,!0),A){A=-1;for(w=this.a.X(u);-1!=w&&w!=u&&(f=this.et(w,m),A=w,null!=f&&f.mg(0));w=
this.a.X(w));for(w=u;-1!=w&&(this.a.bh(w,c.nf),w!=A);w=this.a.X(w));}else this.a.bh(u,c.nf);c.clear()}}else if(null!=f){if(w=new a.b,this.a.w(n,w),k.P(this.ka,this.ka),k.contains(w)){c.zn(f);this.a.Jk(n,b);c.Tw(this.ka,b,!1);x=c.kk(0);if(0<x)if(this.a.Tp(u,c,0,!0),l){A=-1;for(w=this.a.X(n);-1!=w&&w!=n&&(f=this.et(w,m),A=w,null!=f&&f.mg(0));w=this.a.X(w));for(w=n;-1!=w&&(this.a.bh(w,c.nf),w!=A);w=this.a.X(w));}else this.a.bh(n,c.nf);c.clear()}}else continue;if(0!=p+x){if(0!=p){h=this.a.cc(n);if(null==
h){if(!this.a.Oc(n,g))continue;h=g;g.o(v)}else h.o(v);if(h.mg(this.ka))break}d=!0}}}return d};k.prototype.ML=function(){return this.HQ()};k.prototype.HQ=function(){return(new a.aA).GS(this.a,this.ka)};k.prototype.EE=function(){var e=!1,d,g;null==this.zc&&(this.zc=new a.bj);var m=new a.ga(0);m.xb(this.a.pd+1);for(var v=this.a.Gp(),k=v.next();-1!=k;k=v.next())m.add(k);this.a.Mu(m,m.size);m.add(-1);v=this.a.re();k=this.a.re();this.Ld=new a.hA(this.a,this.ka,!this.hx);this.zc.Hn(this.Ld);var b=new a.ga(0),
c=new a.ga(0),n=0;new a.b;var h=this.a.cd;this.a.wb.kc();for(var l=this.a.wb.Ba[0].f,q,u,f=m.get(n++);-1!=f;){u=h.O(f,0);q=l[2*u];u=l[2*u+1];var A=q,p=u;do{var x=h.O(f,2),w=h.O(f,1);-1!=x&&(d=h.O(x,0),g=l[2*d],d=l[2*d+1],0>(p<d?-1:p>d?1:A<g?-1:A>g?1:0)&&(c.add(f),c.add(x)));-1!=w&&(d=h.O(w,0),g=l[2*d],d=l[2*d+1],0>(p<d?-1:p>d?1:A<g?-1:A>g?1:0)&&(c.add(w),c.add(w)));g=this.a.Ra(f,v);-1!=g&&(b.add(g),this.a.lb(f,v,-1));g=this.a.Ra(f,k);-1!=g&&(b.add(g),this.a.lb(f,k,-1));f=m.get(n++);-1!==f&&(p=h.O(f,
0),A=l[2*p],p=l[2*p+1])}while(-1!=f&&A===q&&p===u);A=1==b.size&&2==c.size;g=p=-1;x=0;for(w=b.size;x<w;x++){d=b.get(x);var C=this.zc.ge(d);-1==C||b.Nw(C)||(p=C);d=this.zc.bb(d);-1==d||b.Nw(d)||(g=d);if(-1!=p&&-1!=g)break}this.Ld.XF(u,q);x=0;for(w=b.size;x<w;x++)d=b.get(x),this.zc.kd(d,-1);b.clear(!1);if(!A&&-1!=p&&-1!=g&&this.SK(p,g)){e=!0;this.ei=this.Ld.rl();break}x=0;for(w=c.size;x<w;x+=2){u=c.get(x);q=c.get(x+1);A?(u=this.zc.vs(p,g,u,!0),A=!1):u=this.zc.addElement(u,-1);if(this.Ld.Zf){this.ei=
this.Ld.rl();e=!0;break}-1==this.a.Ra(q,v)?this.a.lb(q,v,u):this.a.lb(q,k,u)}if(e)break;c.cf(0)}this.a.bf(v);this.a.bf(k);return e};k.prototype.SK=function(e,d){this.Ld.compare(this.zc,this.zc.da(e),d);e=this.Ld.Zf;this.Ld.lq();return e};k.Gh=function(e){for(var d=e.$c;-1!=d;d=e.we(d))if(a.T.Kc(e.Lb(d)))return!0;return!1};k.Yk=function(e,d,g,m){if(!k.Gh(e))return!1;d=new k(m);d.a=e;d.ka=g;if(15>e.pd)e=d.LL();else return d.ML();return e};k.$=function(e,d,g){return k.Yk(e,e.wC(),d,g)};k.DE=function(e,
d,g,m,v){if(!k.Gh(d))return!1;var D=new k(v);D.a=d;D.ka=g;D.hx=e;if(D.EE())return null!=m&&m.aq(D.ei),!0;var b=new a.Bg;b.Oy();d.Oe(b);D=new k(v);D.a=d;D.ka=g;D.hx=e;e=D.EE();b.Oy();d.Oe(b);return e?(null!=m&&m.aq(D.ei),!0):!1};return k}();a.Zu=k})(x||(x={}));(function(a){(function(d){d[d.Left=0]="Left";d[d.Right=1]="Right";d[d.Coincident=2]="Coincident";d[d.Undefined=3]="Undefined";d[d.Uncut=4]="Uncut"})(a.ZG||(a.ZG={}));var k=function(){return function(d,e,a,k,b,c,n,h,l,q,u){this.U=d;this.cu=e;
this.Yq=a;this.ag=k;this.Il=q;this.xk=u}}();a.yT=k;var b=function(){function d(d,g){this.jE=d;this.Zh=g}d.prototype.nJ=function(d,g){var e=new a.b;this.Zh.w(d,e);var m=new a.b;this.Zh.w(g,m);e=e.compare(m);if(0!=e)return e;e=this.Zh.Ra(d,this.jE);m=this.Zh.Ra(g,this.jE);return e<m?-1:e==m?0:1};return d}(),e=function(){return function(d,e,a,k,b,c,n,h,l){this.ag=d;this.Yq=e;this.Lx=a;this.sE=k;this.Wh=b;this.xk=c;this.Il=n;this.tE=h;this.RP=l}}();a.xT=e;var d=function(){function d(){}d.YG=function(g,
e,D,b,c,n){if(e.s())g=new k(e,4,-1,-1,NaN,4,-1,-1,NaN,-1,-1,NaN,-1,-1,NaN),c.push(g);else{var m=new a.fd;m.Eb(e);m.Eb(D);a.aj.$(m,b,n,!0);e=0;D=m.re();for(b=m.$c;-1!=b;b=m.we(b))for(n=m.Vb(b);-1!=n;n=m.bc(n))for(var v=m.Cb(n),h=0,L=m.Ha(n);h<L;v=m.X(v),h++)m.lb(v,D,e++);e=d.qM(D,m);d.CI(g,e,m,c)}};d.qM=function(g,e){for(var m=e.pd,v=new a.ga(0),k=e.$c;-1!=k;k=e.we(k))for(var c=e.Vb(k);-1!=c;c=e.bc(c))for(var n=e.Cb(c),h=0,l=e.Ha(c);h<l;n=e.X(n),h++)v.add(n);var q=new b(g,e);v.xd(0,m,function(d,g){return q.nJ(d,
g)});g=[];var u=[],f=e.re(),A=e.re(),k=e.$c,c=e.we(k),l=new a.b,p=new a.b,x=v.get(0),w=e.rd(x),C=e.Vf(w);e.w(x,l);for(var t=1,n=0;t<m-1;){for(var y=!1,h=t;h<m;h++)if(h!=n){var z=v.get(h),E=e.rd(z),V=e.Vf(E);e.w(z,p);if(l.ub(p))C==k&&V==c&&(y=d.SI(f,A,e,g,u,w,x,E,z));else break}if(y||n==t-1){y&&n==t-1&&t--;if(++n==m)break;x=v.get(n);w=e.rd(x);C=e.Vf(w);e.w(x,l)}y||(t=n+1)}m=[];for(k=e.$c;-1!=k;k=e.we(k))for(c=e.Vb(k);-1!=c;c=e.bc(c))for(v=e.Cb(c),h=0,l=e.Ha(c);h<l;v=e.X(v),h++){n=e.Ra(v,A);if(0<=n)for(;n<
u.length&&u[n].ag==v;)m.push(u[n++]);n=e.Ra(v,f);if(0<=n)for(;n<g.length&&g[n].ag==v;)m.push(g[n++])}e.bf(f);e.bf(A);return m};d.SI=function(g,e,a,k,b,c,n,h,l){var m=a.hk(c),v=a.hk(h),D=a.Cb(c),L=a.Cb(h),q=a.Ua(n),u=a.Ua(l),f=!1,A=!1,p=!1,x=!1;n!=D&&(l!=L&&(f=d.VI(g,a,k,c,q,h,u)),l!=v&&(A=d.YI(g,a,k,c,q,h,l)));n!=m&&(l!=L&&(p=d.aJ(e,a,b,c,n,h,u,D)),l!=v&&(x=d.dJ(e,a,b,c,n,h,l,D)));f&&A&&p?(g=k.length-1,2==b[x?b.length-2:b.length-1].Wh&&(k[g-1]=k[g],--k.length)):f&&A&&x&&2==b[b.length-1].Wh&&(b=k[k.length-
1],--k.length,a.Ra(b.ag,g)==k.length&&a.lb(b.ag,g,-1));return f||A||p||x};d.VI=function(d,g,k,b,c,n,h){var m,v;v=new a.yb;var D=new a.yb,L=[0,0],l=[0,0];m=g.cc(c);null==m&&(g.Oc(c,v),m=v);v=g.cc(h);null==v&&(g.Oc(h,D),v=D);m=m.Ga(v,null,L,l,0);2>m&&(b=new e(c,b,L[0],NaN,m,h,n,l[0],NaN),k.push(b),b=g.Ra(c,d),0>b&&g.lb(c,d,k.length-1));return!0};d.YI=function(d,g,k,b,c,n,h){var m,v;v=new a.yb;var D=new a.yb,L=[0,0],l=[0,0];m=g.cc(c);null==m&&(g.Oc(c,v),m=v);v=g.cc(h);null==v&&(g.Oc(h,D),v=D);m=m.Ga(v,
null,L,l,0);return 2>m?(b=new e(c,b,L[0],NaN,m,h,n,l[0],NaN),k.push(b),b=g.Ra(c,d),0>b&&g.lb(c,d,k.length-1),!0):!1};d.aJ=function(d,g,k,b,c,n,h,l){var m,v;v=new a.yb;var D=new a.yb,L=[0,0],q=[0,0];m=g.cc(c);null==m&&(g.Oc(c,v),m=v);v=g.cc(h);null==v&&(g.Oc(h,D),v=D);m=m.Ga(v,null,L,q,0);if(2==m)return b=new e(c,b,L[0],L[1],m,h,n,q[0],q[1]),k.push(b),b=g.Ra(c,d),0>b&&g.lb(c,d,k.length-1),!0;D=!1;c==l&&(b=new e(c,b,L[0],NaN,m,h,n,q[0],NaN),k.push(b),b=g.Ra(c,d),0>b&&g.lb(c,d,k.length-1),D=!0);return D};
d.dJ=function(d,g,k,b,c,n,h,l){var m,v;v=new a.yb;var D=new a.yb,L=[0,0],q=[0,0];m=g.cc(c);null==m&&(g.Oc(c,v),m=v);v=g.cc(h);null==v&&(g.Oc(h,D),v=D);m=m.Ga(v,null,L,q,0);if(2==m)return b=new e(c,b,L[0],L[1],m,h,n,q[0],q[1]),k.push(b),b=g.Ra(c,d),0>b&&g.lb(c,d,k.length-1),!0;D=!1;c==l&&(b=new e(c,b,L[0],NaN,m,h,n,q[0],NaN),k.push(b),b=g.Ra(c,d),0>b&&g.lb(c,d,k.length-1),D=!0);return D};d.CI=function(g,e,b,c){var m,v=[];v[0]=new a.b;v[1]=new a.b;v[2]=new a.b;v[3]=new a.b;var D=new a.b,n=new a.b,h=
new a.b,L=new a.b,l=null;null!=c&&(l=new a.Ag,l.mq());var q,u=0,f=null,A=new a.yb;new a.yb;for(var p=b.Vb(b.$c);-1!=p;p=b.bc(p)){var x,w=4,C=-1,t,y,z,E=-1,V,I,J,K,G=-1,r=-1,N=NaN;x=!0;var M=!1,Q=!0,ca=!0,S=!0,U=0;z=p;V=0;for(var W=b.Cb(p),P=b.Ha(p),B=0;B<P;W=b.X(W),B++){q=b.cc(W);if(null==q){if(!b.Oc(W,A))continue;q=A}-1==E&&(E=W);for(var O=0;u<e.length&&W==e[u].ag;){C=e[u].Yq;t=e[u].ag;y=e[u].Lx;I=e[u].Il;J=e[u].xk;K=e[u].tE;if(2==e[u].Wh){if(M||(z=C,E=t,V=y,G=I,r=J,N=K,w=2,null!=c?f=new a.Xa:U=
0,S=!1,ca=!0),y=e[u].sE,K=e[u].RP,null!=c?(q.Bi(O,e[u].sE,l),f.Bc(l.get(),ca)):U++,O=y,M=!0,ca=x=!1,u+1==e.length||2!=e[u+1].Wh||e[u+1].ag==t&&e[u+1].Lx!=O)null!=c?(m=new k(f,2,C,t,y,w,z,E,V,I,J,K,G,r,N),c.push(m)):null.add(U),z=C,E=t,V=y,G=I,r=J,N=K,w=2,M=x=!1,ca=S=!0}else{var T=b.X(t);if(u<e.length-1&&e[u+1].ag==T&&e[u+1].xk==J&&2==e[u+1].Wh)y!=O&&(S&&(null!=c?f=new a.Xa:U=0),x=0<u&&e[u-1].Yq==C?1==w?0:0==w?1:3:3,null!=c?(q.Bi(O,y,l),f.Bc(l.get(),ca),m=new k(f,x,C,t,y,w,z,E,V,I,J,K,G,r,N),c.push(m)):
(U++,null.add(U)),O=y,z=C,E=t,V=y,G=I,r=J,N=K,w=x,x=Q=!1,ca=S=!0);else if(!d.KK(g,b,e,u,D,n)){d.KG(b,e,u,p,W,h,L);var ka=!1,T=!1;m=!0;if(!(D.ub(h)||n.ub(h)||D.ub(L)||n.ub(L))){v[0].J(D);v[1].J(n);v[2].J(h);v[3].J(L);v.sort(a.b.cq);var Ia=v[0],Ja=v[1],Ka=v[2],Sa=v[3];Ia.ub(D)?Ja.ub(n)?g?(T=ka=!0,m=!1):ka=!1:Sa.ub(n)?g?m=T=ka=!0:ka=!1:(ka=!0,m=Ja.ub(h)):Ja.ub(D)?Ka.ub(n)?g?(T=ka=!0,m=!1):ka=!1:Ia.ub(n)?g?m=T=ka=!0:ka=!1:(ka=!0,m=Ka.ub(h)):Ka.ub(D)?Sa.ub(n)?g?(T=ka=!0,m=!1):ka=!1:Ja.ub(n)?g?m=T=ka=!0:
ka=!1:(ka=!0,m=Sa.ub(h)):Ia.ub(n)?g?(T=ka=!0,m=!1):ka=!1:Ka.ub(n)?g?m=T=ka=!0:ka=!1:(ka=!0,m=Ia.ub(h))}if(ka){ka=W==t;if(y!=O||ka&&0==O)S&&(null!=c?f=new a.Xa:U=0),null!=c?(q.Bi(O,y,l),f.Bc(l.get(),ca)):U++;if(m)if(1!=w){if(y!=O||ka&&0==O)null!=c?(m=new k(f,1,C,t,y,w,z,E,V,I,J,K,G,r,N),c.push(m)):null.add(U);if(!T)w=1;else if(u==e.length-2||e[u+2].Yq!=C)w=0}else{if(y!=O||ka&&0==O)null!=c?(m=new k(f,3,C,t,y,w,z,E,V,I,J,K,G,r,N),c.push(m)):null.add(U);w=1}else if(0!=w){if(y!=O||ka&&0==O)null!=c?(m=
new k(f,0,C,t,y,w,z,E,V,I,J,K,G,r,N),c.push(m)):null.add(U);if(!T)w=0;else if(u==e.length-2||e[u+2].Yq!=C)w=1}else{if(y!=O||ka&&0==O)null!=c?(m=new k(f,3,C,t,y,w,z,E,V,I,J,K,G,r,N),c.push(m)):null.add(U);w=0}if(y!=O||ka&&0==O)O=y,z=C,E=t,V=y,G=I,r=J,N=K,x=Q=!1,ca=S=!0}}}u++}1!=O&&(S&&(null!=c?f=new a.Xa:U=0),null!=c?(q.Bi(O,1,l),f.Bc(l.get(),ca)):U++,ca=S=!1,Q=!0)}Q&&(y=1,t=b.hk(p),t=b.Ua(t),J=I=-1,K=NaN,x?null!=c?(m=new k(f,4,C,t,y,w,z,E,V,I,J,K,G,r,N),c.push(m)):null.add(U):(x=1==w?0:0==w?1:3,null!=
c?(m=new k(f,x,C,t,y,w,z,E,V,I,J,K,G,r,N),c.push(m)):null.add(U)))}};d.KK=function(g,e,k,b,c,n){var m=k[b].tE;if(1==m)return d.GJ(g,e,k,b,c,n);if(0==m)return d.dK(g,e,k,b,c,n);throw a.g.wa();};d.GJ=function(d,g,e,k,b,c){var m=new a.yb,v=e[k].ag,D=e[k].Il,n=e[k].xk,h=-1,l=-1,L=-1,q=-1;if(!d&&0<k)var u=e[k-1],h=u.ag,l=u.Il,L=u.xk,q=u.Wh;var f=-1,A=-1,p=-1,x=-1;k<e.length-1&&(u=e[k+1],f=u.ag,A=u.Il,p=u.xk,x=u.Wh);var w=g.X(v),u=g.X(n);if(!d)return 0<k&&h==v&&l==D&&L==u&&2==q||k<e.length-1&&f==w&&A==
D&&p==u&&2==x?(d=g.cc(n),null==d&&(g.Oc(n,m),d=m),c.J(d.Pf(1)),b.qr(c),c.normalize(),b.normalize(),!1):k<e.length-1&&f==v&&A==D&&p==u?(d=g.cc(n),null==d&&(g.Oc(n,m),d=m),b.J(d.Pf(1)),d=g.cc(u),null==d&&(g.Oc(u,m),d=m),c.J(d.Pf(0)),b.Bp(),c.normalize(),b.normalize(),!1):!0;if(k==e.length-1||f!=v||A!=D||p!=u||2==x)return d=g.cc(n),null==d&&(g.Oc(n,m),d=m),c.J(d.Pf(1)),b.qr(c),c.normalize(),b.normalize(),!1;d=g.cc(n);null==d&&(g.Oc(n,m),d=m);b.J(d.Pf(1));d=g.cc(u);null==d&&(g.Oc(u,m),d=m);c.J(d.Pf(0));
b.Bp();c.normalize();b.normalize();return!1};d.dK=function(d,g,e,k,b,c){var m=new a.yb,v=e[k].ag,D=e[k].Il,n=e[k].xk,h=-1,l=-1,L=-1,q=-1;if(!d&&k<e.length-1)var u=e[k+1],h=u.ag,l=u.Il,L=u.xk,q=u.Wh;var f=-1,A=-1,p=-1,u=-1;0<k&&(u=e[k-1],f=u.ag,A=u.Il,p=u.xk,u=u.Wh);var x=g.X(v),w=g.Ua(n);return d?0==k||f!=v||A!=D||p!=w||2==u?(d=g.cc(n),null==d&&(g.Oc(n,m),d=m),c.J(d.Pf(0)),b.qr(c),c.normalize(),b.normalize(),!1):!0:0<k&&f==v&&A==D&&p==w&&2==u||k<e.length-1&&h==x&&l==D&&L==w&&2==q?(d=g.cc(n),null==
d&&(g.Oc(n,m),d=m),c.J(d.Pf(0)),b.qr(c),c.normalize(),b.normalize(),!1):!0};d.KG=function(d,g,e,k,b,c,n){var m=new a.yb,v=d.cc(b);null==v&&(d.Oc(b,m),v=m);e=g[e];g=e.ag;e=e.Lx;b=d.X(g);if(1==e)c.J(v.Pf(1)),-1!=b&&b!=d.hk(k)?(v=d.cc(b),null==v&&(d.Oc(b,m),v=m),n.J(v.Pf(0)),v=d.cc(g),null==v&&d.Oc(g,m)):n.J(c),c.Bp(),n.normalize(),c.normalize();else if(0==e)n.J(v.Pf(e)),c.qr(n),n.normalize(),c.normalize();else throw a.g.wa();};return d}();a.$G=d})(x||(x={}));(function(a){(function(d){d[d.Linear=0]=
"Linear";d[d.Angular=1]="Angular";d[d.Area=2]="Area"})(a.RI||(a.RI={}));var k=function(){function d(d,g,e){this.Nc=g;this.Dj=e;this.wx=d}d.PC=function(g){return 0!==g.Nc?null:-1===g.wx?new d(-1,2,g.Dj*g.Dj):d.Qd(m[g.wx])};d.Qd=function(d){d=g[d];return void 0===d?null:d};d.EL=function(g,e,m){var a=null;if(void 0!==m&&null!==m)try{"EPSG"===m.values[0]&&(a=d.Qd(parseInt(m.values[1])))}catch(ja){}null===a&&(a=new d(-1,g,e));return a};d.prototype.Qc=function(){return this.wx};d.prototype.rC=function(d){if(d.Nc!=
this.Nc)throw a.g.xa();return this.Dj/d.Dj};d.ih=function(d,g,e){return g.rC(e)*d};d.OB=function(d,g,e,m,a){e=e.rC(m);for(m=0;m<g;m++)a[m]=d[m]*e};return d}();a.Tb=k;for(var b=[109402,4046.8564224,109403,4046.87260987425,109463,100,109401,1E4,109461,225E8,109460,25E8,109451,1E-4,109444,404.68564224000005,109424,404.6849341289498,109428,404.68493792602754,109416,404.67838076760535,109420,404.68423895571647,109448,404.683871963536,109411,404.6872609874253,109450,.01,109408,3.34450944,109405,.09290304,
109430,.09290354800069446,109423,.0929028774400711,109427,.09290287831176021,109441,.09290349665192114,109407,.09290137299531805,109440,.09290286332673177,109431,.09290274144751023,109432,.09290207073852812,109433,.09290279616016,109434,.09290273520025,109419,.09290271785025629,109447,.0929026336004445,109406,.09290341161327487,109453,6.4516E-4,109454,6.451625806477421E-4,109414,1E6,109445,.04046856422400001,109425,.04046849341289498,109429,.04046849379260275,109417,.04046783807676053,109421,.04046842389557164,
109449,.0404683871963536,109412,.04046872609874253,109404,1,109410,1.000027193184865,109413,2589998.4703195216,109452,1E-6,109409,3429904,109458,3434290.937856,109457,3434528.1495040003,109464,1.244521604938272E-7,109455,25.292852640000003,109456,25.29295381171408,109459,2.89612324,109439,2589988.110336,109462,.7168473118308245,109442,.83612736,109422,.83612589696064,109426,.836125904805842,109415,.8361123569578626,109435,.836124673027592,109436,.836118636646753,109437,.8361251654414399,109438,.83612461680225,
109418,.8361244606523066,109446,.8361237024040001,109443,.8361307045194736],e=[9103,2.908882086657216E-4,9104,4.84813681109536E-6,9102,.0174532925199433,9106,.01570796326794897,9105,.01570796326794897,9109,1E-6,9114,9.817477042468104E-4,1031,4.84813681109536E-9,9112,1.570796326794897E-4,9101,1,9113,1.570796326794897E-6],d=[109031,15E4,109461,109030,5E4,109460,1033,.01,109451,9097,20.1168,109444,9052,20.1167824,109424,9062,20.116782494375872,109428,9038,20.1166195164,109416,9042,20.116765121552632,
109420,9301,20.116756,109448,9033,20.11684023368047,109411,109005,.1,109450,9014,1.8288,109408,9002,.3048,109405,9070,.3048008333333334,109430,9051,.3047997333333333,109423,9061,.3047997347632708,109427,9095,.3048007491,109441,9005,.3047972654,109407,9094,.3047997101815088,109440,9080,.3047995102481469,109431,9081,.30479841,109432,9082,.3047996,109433,9083,.3047995,109434,9041,.304799471538676,109419,9300,.3047993333333334,109447,9003,.3048006096012192,109406,109008,.0254,109453,109009,.0254000508001016,
109454,9036,1E3,109414,9098,.201168,109445,9053,.201167824,109425,9063,.2011678249437587,109429,9039,.201166195164,109417,9043,.2011676512155263,109421,9302,.20116756,109449,9034,.2011684023368047,109412,9001,1,109404,9031,1.0000135965,109410,9035,1609.3472186944375,109413,1025,.001,109452,9030,1852,109409,109013,1853.184,109458,109012,1853.248,109457,109016,3.527777777777778E-4,109464,109010,5.0292,109455,109011,5.029210058420118,109456,109014,1.7018,109459,9093,1609.344,109439,109015,.8466683600033867,
109462,9096,.9144,109442,9050,.9143992,109422,9060,.9143992042898124,109426,9037,.9143917962000001,109415,9084,.9143985307444408,109435,9085,.91439523,109436,9086,.9143988,109437,9087,.9143985,109438,9040,.9143984146160287,109418,9099,.914398,109446,109002,.9144018288036576,109443,109001,.9144,109442,109003,20.1168,109444,109004,.201168,109445,109006,.01,109451,109007,.001,109452],g=[],m=[],v=0;v<b.length;v+=2)g[b[v]]=new k(b[v],2,b[v+1]);b=null;for(v=0;v<e.length;v+=2)g[e[v]]=new k(e[v],1,e[v+1]);
e=null;for(v=0;v<d.length;v+=3)g[d[v]]=new k(d[v],0,d[v+1]),m[d[v]]=d[v+2];d=null})(x||(x={}));(function(a){var k=function(){function a(){}a.prototype.set=function(e,d){void 0!==d?(this.Lf=e,this.Og=d):"number"===typeof e?(this.Lf=e,this.Og=0):(this.Lf=e.Lf,this.Og=e.Og)};a.prototype.value=function(){return this.Lf};a.prototype.sub=function(e){if("number"===typeof e){var d=this.Lf-e;e=this.Og+2.220446049250313E-16*Math.abs(d)}else d=this.Lf-e.Lf,e=this.Og+e.Og+2.220446049250313E-16*Math.abs(d);this.Lf=
d;this.Og=e};a.prototype.Ap=function(e){var d=this.Lf*e.Lf;this.Og=this.Og*Math.abs(e.Lf)+e.Og*Math.abs(this.Lf)+this.Og*e.Og+2.220446049250313E-16*Math.abs(d);this.Lf=d};a.prototype.eP=function(){return Math.abs(this.Lf)<=this.Og};a.prototype.Dq=function(){return this.eP()&&0!=this.Og};return a}();a.$k=k})(x||(x={}));var I=new x.b,K=new x.b,J=new x.b,N=new x.b,M=new x.b;(function(a){var k;(function(e){e[e.closedPath=1]="closedPath";e[e.exteriorPath=2]="exteriorPath";e[e.ringAreaValid=4]="ringAreaValid"})(k||
(k={}));var b=function(){function e(d,g,e,a,k,b,c){void 0!==g?(this.ab=d,this.mj=g,this.$j=e,this.zh=a,this.ua=b,this.mx=c,this.Pt=k):(this.ab=d.ab,this.mj=d.mj,this.$j=d.$j,this.zh=d.zh,this.ua=d.ua,this.mx=d.mx,this.Pt=d.Pt);this.JD=!0}e.prototype.next=function(){return this.JD?(this.JD=!1,this.zh):-1!=this.zh?(this.zh=this.ab.X(this.zh),this.ua++,-1!=this.zh&&this.zh!=this.Pt?this.zh:this.cQ()):-1};e.prototype.cQ=function(){this.$j=this.ab.bc(this.$j);for(this.ua=0;-1!=this.mj;){for(;-1!=this.$j;this.$j=
this.ab.bc(this.$j))if(this.Pt=this.zh=this.ab.Cb(this.$j),-1!=this.zh)return this.zh;this.mj=this.ab.we(this.mj);if(-1==this.mj)break;if(!this.mx||a.T.Kc(this.ab.Lb(this.mj)))this.$j=this.ab.Vb(this.mj)}return-1};e.UL=function(d,g,m,a,k,b,c){return new e(d,g,m,a,k,b,c)};return e}();a.CT=b;k=function(){function e(){this.Zm=this.Al=this.Ej=this.Mc=this.Jj=this.jn=this.fi=this.Rc=this.sh=this.wg=this.Ge=this.wp=this.zp=this.wb=this.Hk=null;this.Xt=this.$c=-1;this.pd=0;this.kx=!1;this.wp=this.zp=this.wb=
null}e.prototype.Fi=function(d){return null!=this.Ge?this.Ge[d]:null};e.prototype.Fh=function(d,g){if(null==this.Ge){if(null==g)return;this.Ge=[];for(var e=0,a=this.wb.F();e<a;e++)this.Ge.push(null)}this.Ge[d]=g};e.prototype.Mn=function(d,g){this.Rc.L(d,1,g)};e.prototype.Ln=function(d,g){this.Rc.L(d,2,g)};e.prototype.Iy=function(d,g){this.Rc.L(d,6,g)};e.prototype.Ho=function(d){return this.Rc.O(d,6)};e.prototype.Hu=function(d,g){this.Rc.L(d,7,g)};e.prototype.bt=function(d){return this.Rc.O(d,0)};
e.prototype.MF=function(d,g){this.Mc.L(d,1,g)};e.prototype.QF=function(d,g){this.Mc.L(d,0,g)};e.prototype.xC=function(d){return this.Mc.O(d,7)};e.prototype.Jn=function(d,g){this.Mc.L(d,3,g)};e.prototype.Kn=function(d,g){this.Mc.L(d,4,g)};e.prototype.jQ=function(d){null==this.Mc&&(this.Mc=new a.Fc(8));var g=this.Mc.be();this.Mc.L(g,2,d);this.Mc.L(g,5,0);this.Mc.L(g,6,0);this.Mc.L(g,7,g);return g};e.prototype.bN=function(d){this.Mc.Jc(d)};e.prototype.lQ=function(d){null==this.Rc&&(this.Rc=new a.Fc(8),
this.cd=new a.Fc(5),this.fi=new a.qd(0),this.jn=new a.qd(0));var g=this.Rc.be();this.Rc.L(g,0,g);this.Rc.L(g,3,0);this.Rc.L(g,6,0);this.Hu(g,d);g>=this.fi.size&&(d=16>g?16:a.I.truncate(3*g/2),this.fi.resize(d),this.jn.resize(d));this.fi.set(g,0);this.jn.set(g,0);return g};e.prototype.iC=function(d){this.Rc.Jc(d)};e.prototype.dw=function(d){this.cd.Jc(d);this.pd--};e.prototype.mQ=function(d){null==this.Rc&&(this.Rc=new a.Fc(8),this.cd=new a.Fc(5),this.fi=new a.qd(0),this.jn=new a.qd(0));var g=this.cd.be(),
e=0<=d?d:g;this.cd.L(g,0,e);if(0>d){if(e>=this.wb.F()){d=16>e?16:a.I.truncate(3*e/2);this.wb.resize(d);if(null!=this.Ge)for(var v=0;v<d;v++)this.Ge.push(null);null!=this.wg&&this.wg.resize(d);this.zp=this.wb.mc(0)}this.wb.ic(e,-1E38,-1E38);null!=this.Ge&&(this.Ge[e]=null);null!=this.wg&&this.wg.write(e,1)}this.cd.L(g,4,2*e);this.pd++;return g};e.prototype.vl=function(d,g,e){var m=-1!=g?this.Ua(g):this.hk(d),a=-1!=m?this.X(m):-1,k=this.mQ(null==e?this.pd:-1),b=this.gb(k);null!=e&&this.wb.Iu(b,e);this.im(k,
d);this.Sc(k,a);this.Tc(k,m);-1!=a&&this.Tc(a,k);-1!=m&&this.Sc(m,k);e=this.vc(d);m=this.Cb(d);-1==g&&this.Wi(d,k);g==m&&this.Dh(d,k);e&&-1==a&&(this.Sc(k,k),this.Tc(k,k));this.hm(d,this.Ha(d)+1);d=this.Vf(d);this.Pk(d,this.F(d)+1);return k};e.prototype.Fo=function(){null==this.Zm&&(this.Zm=new a.Va(this.wb.description));return this.Zm};e.prototype.Pp=function(d,g){this.Mc.L(d,2,this.Mc.O(d,2)&-134217729||(1==g?134217728:0))};e.prototype.Cm=function(d){return 0!=(this.Mc.O(d,2)&134217728)?1:0};e.prototype.MJ=
function(d){var g=this.jg(d.D(),d.description);1736==d.D()&&this.Pp(g,d.Cm());this.WA(g,d);return g};e.prototype.NJ=function(d){var g=this.jg(d.D(),d.description);this.XA(g,d);return g};e.prototype.TQ=function(d,g){null==this.Rc&&(this.Rc=new a.Fc(8),this.cd=new a.Fc(5),this.fi=new a.qd(0),this.jn=new a.qd(0));this.Rc.de(this.Rc.Xc+d);this.cd.de(this.cd.Xc+g);this.fi.xb(this.fi.size+d);this.jn.xb(this.jn.size+d)};e.prototype.WA=function(d,g){this.TQ(g.ea(),g.F());this.Hk.Pd(g,0,g.F());this.zp=this.wb.mc(0);
for(var e=null!=this.Ge&&null!=g.Fe,v=0,k=g.ea();v<k;v++)if(!(2>g.Ha(v))){var b=this.Cf(d,-1);this.Gn(b,g.vc(v));for(var c=g.Ea(v),n=g.Dc(v);c<n;c++){var h=this.vl(b,-1,null);if(e)if(h=this.gb(h),0!=(g.NC(c)&1))this.Fh(h,null);else{var l=new a.Ag;g.cc(c,l,!0);this.Fh(h,l.get())}}}};e.prototype.XA=function(d,g){this.Hk.Pd(g,0,g.F());this.zp=this.wb.mc(0);d=this.Cf(d,-1);var e=0;for(g=g.F();e<g;e++)this.vl(d,-1,null)};e.prototype.DS=function(d,g,e){var m=this.X(d);if(-1==m)throw a.g.wa();for(var k=
this.Fo(),b=this.rd(d),c=0,n=g.kk(e);c<n;c++){var h=this.gb(d),l=this.X(d),q=g.Io(e,c);0==c&&(q.En(k),this.bh(d,k));322==q.D()?this.Fh(h,null):this.Fh(h,a.T.Yj(q));q.Bn(k);c<n-1?d=this.vl(b,l,k):this.bh(m,k)}};e.prototype.CS=function(d,g,e){var m=this.X(d);if(-1==m)throw a.g.wa();for(var k=this.Fo(),b=this.rd(d),c=0,n=g.kk(e);c<n;c++){var h=this.gb(d),l=this.X(d),q=g.Io(e,n-c-1);0==c&&(q.Bn(k),this.bh(d,k));322==q.D()?this.Fh(h,null):this.Fh(h,a.T.Yj(q));q.En(k);c<n-1?d=this.vl(b,l,k):this.bh(m,k)}};
e.prototype.wC=function(){var d=new a.i;d.Ja();for(var g=this.Gp(),e=new a.b,k=!0,b=g.next();-1!=b;b=g.next())this.w(b,e),k?d.Db(e.x,e.y):d.Oj(e.x,e.y),k=!1;return d};e.prototype.Eb=function(d){var g=d.D();if(a.T.Kc(g))return this.MJ(d);if(550==g)return this.NJ(d);throw a.g.wa();};e.prototype.YJ=function(d,g){var e=g.D();if(a.T.Kc(e))this.WA(d,g);else if(550==e)this.XA(d,g);else throw a.g.wa();};e.prototype.QJ=function(d,g){var e=this.jg(1736,d.description);if(2>d.Ha(g))return e;this.Hk.Pd(d,d.Ea(g),
d.Dc(g));this.zp=this.wb.mc(0);var k=this.Cf(e,-1);this.Gn(k,d.vc(g)||!0);var b=null!=this.Ge&&null!=d.Fe,c=d.Ea(g);for(g=d.Dc(g);c<g;c++){var n=this.vl(k,-1,null);if(b)if(n=this.gb(n),0!=(d.NC(c)&1))this.Fh(n,null);else{var h=new a.Ag;d.cc(c,h,!0);this.Fh(n,h.get())}}return e};e.prototype.hf=function(d){var g=this.Lb(d),e=a.sH.jg(g,this.Hk.description),k=this.F(d);if(0==k)return e;if(a.T.Kc(g)){for(var g=this.ea(d),b=a.Ac.Dg(g+1),c=a.Ac.to(g+1,0),n=e.description,h=0,l=n.Aa;h<l;h++){for(var q=n.Hd(h),
u=a.pa.Wa(q),f=a.Ac.Tv(q,k),A=this.wb.mc(q),p=0,x=0,w=0,C=this.Vb(d);-1!=C;C=this.bc(C)){var t=0;this.vc(C)&&(t|=1);this.VO(C)&&(t|=4);0!=t&&c.xy(x,t);var y=this.Ha(C);b.write(x++,w);w+=y;if(0==q)for(var y=A,z=f,E=new a.b,t=this.Cb(C);p<w;t=this.X(t),p++){var I=this.gb(t);y.ec(2*I,E);z.Rn(2*p,E)}else for(t=this.Cb(C);p<w;t=this.X(t),p++)for(I=this.gb(t),z=0;z<u;z++)E=A.Bh(I*u+z),f.Uk(p*u+z,E)}e.bm(q,f);b.write(g,k)}e.NF(c);e.OF(b);e.ce(16777215)}else if(550==g){n=e.description;e.resize(k);h=0;for(l=
n.Aa;h<l;h++){q=n.Hd(h);u=a.pa.Wa(q);f=e.mc(q);A=this.wb.mc(q);p=0;C=this.Vb(d);y=this.Ha(C);for(t=this.Cb(C);p<y;t=this.X(t),p++)for(I=this.gb(t),z=0;z<u;z++)E=A.Bh(I*u+z),f.Uk(p*u+z,E);e.bm(q,f)}e.ce(16777215)}return e};e.prototype.sy=function(d){for(var g=this.Vb(d);-1!=g;g=this.Cr(g));var g=this.aO(d),e=this.we(d);-1!=g?this.MF(g,e):this.$c=e;-1!=e?this.QF(e,g):this.Xt=g;this.bN(d)};e.prototype.jg=function(d,g){return void 0===g?this.QB(d,a.Od.Tf()):this.QB(d,g)};e.prototype.QB=function(d,g){d=
this.jQ(d);null==this.wb?this.wb=this.Hk=new a.pe(g):this.Hk.Ik(g);this.wp=this.Hk.description;this.kx=1<this.wp.Aa;-1==this.$c?this.$c=d:(this.QF(d,this.Xt),this.MF(this.Xt,d));return this.Xt=d};e.prototype.we=function(d){return this.Mc.O(d,1)};e.prototype.aO=function(d){return this.Mc.O(d,0)};e.prototype.Lb=function(d){return this.Mc.O(d,2)&2147483647};e.prototype.EF=function(d,g,e){g=this.Ej[g];d=this.xC(d);d>=g.size&&g.resize(Math.max(a.I.truncate(1.25*d),16),-1);g.write(d,e)};e.prototype.yC=
function(d,g){d=this.xC(d);g=this.Ej[g];return d<g.size?g.read(d):-1};e.prototype.RB=function(){null==this.Ej&&(this.Ej=[]);for(var d=0;d<this.Ej.length;d++)if(null==this.Ej[d])return this.Ej[d]=a.Ac.Dg(0),d;this.Ej.push(a.Ac.Dg(0));return this.Ej.length-1};e.prototype.tR=function(d){this.Ej[d]=null};e.prototype.Vb=function(d){return this.Mc.O(d,3)};e.prototype.Ys=function(d){return this.Mc.O(d,4)};e.prototype.F=function(d){return this.Mc.O(d,5)};e.prototype.ea=function(d){return this.Mc.O(d,6)};
e.prototype.xo=function(d,g,e){for(var m=0,k=this.$c;-1!=k;k=this.we(k)){var b=this.Lb(k);if(a.T.Kc(b)&&(!e||1736==b))for(var b=1736==this.Lb(k),c=this.Vb(k);-1!=c;){for(var n=0,h=this.Cb(c);n<a.I.truncate(this.Ha(c)/2);){var l=this.X(h);if(-1==l)break;var q=this.gb(h),u=this.Fi(q);null!=u?q=u.$b():(u=this.gb(l),q=this.wb.mv(q,u));q<=d?(0==q?0==m&&(m=-1):m=1,l!=this.hk(c)&&(this.Zy(l,h),this.vf(l,!0))):h=this.X(h);n++}n=this.Cb(c);for(h=this.vc(c)?n:this.hk(c);0<this.Ha(c);)if(l=this.Ua(h),-1!=l){var f=
this.gb(l),u=this.Fi(f);null!=u?q=u.$b():(q=this.gb(h),q=this.wb.mv(q,f));if(q<=d)0==q?0==m&&(m=-1):m=1,this.Zy(l,h),this.vf(l,!1),n==l&&(n=this.Cb(c));else if(h=this.Ua(h),h==n)break}else{this.vf(h,!0);0==m&&(m=-1);break}h=this.Ha(c);g&&(b?3>h:2>h)?(c=this.Cr(c),m=0<h?1:0==m?-1:m):c=this.bc(c)}}return m};e.prototype.Zy=function(d,g){var e=this.gb(d),a=this.gb(g);null!=this.wg&&(e=this.wg.read(e),this.wg.write(a,e));if(null!=this.sh)for(a=0,e=this.sh.length;a<e;a++)if(null!=this.sh[a]){var k=this.Ra(d,
a);-1!=k&&this.lb(g,a,k)}};e.prototype.Mr=function(d,g,e){var m=0,k=this.X(d);if(-1==k)throw a.g.wa();for(var b=this.gb(d),c=this.gb(k),n=this.Fi(b),h=null==n?this.wb.mv(b,c):n.$b(),l=0;l<e;l++){var q=g[l];if(0<q&&1>q){var u=q;null!=n&&(u=0<h?n.rA(q)/h:0);this.wb.vJ(b,c,u,this.Fo());var f=this.vl(this.rd(d),k,this.Fo());m++;if(null!=n){var A=n.xm(0,q),u=this.gb(this.Ua(f));this.Fh(u,A);this.Yi(f,A.oc());if(l==e-1||1==g[l+1])q=n.xm(q,1),this.Fh(u,q)}}}return m};e.prototype.bh=function(d,g){var e=this.gb(d);
this.wb.Iu(e,g);e=this.Fi(e);null!=e&&e.setStart(g);d=this.Ua(d);-1!=d&&(d=this.gb(d),null!=this.Fi(d)&&e.setEnd(g))};e.prototype.Jk=function(d,g){d=this.gb(d);this.wb.Sd(d,g)};e.prototype.Yi=function(d,g){this.ic(d,g.x,g.y)};e.prototype.ic=function(d,g,e){var m=this.gb(d);this.wb.ic(m,g,e);m=this.Fi(m);null!=m&&m.Ny(g,e);d=this.Ua(d);-1!=d&&(d=this.gb(d),null!=this.Fi(d)&&m.Ok(g,e))};e.prototype.w=function(d,g){this.wb.w(this.cd.O(d,0),g)};e.prototype.uc=function(d,g){this.wb.Ba[0].ec(2*this.cd.O(d,
0),g)};e.prototype.Fa=function(d){var g=new a.b;this.wb.w(this.cd.O(d,0),g);return g};e.prototype.SC=function(d,g){this.zp.ec(2*d,g)};e.prototype.ld=function(d,g,e){return this.wb.ld(d,this.gb(g),e)};e.prototype.setAttribute=function(d,g,e,a){this.wb.setAttribute(d,this.gb(g),e,a)};e.prototype.gb=function(d){return this.cd.O(d,0)};e.prototype.mk=function(d){var g=new a.b;this.w(d,g);return g.y};e.prototype.Cq=function(d,g){d=this.gb(d);g=this.gb(g);var e=this.wb.Ba[0].f;return e[2*d]===e[2*g]&&e[2*
d+1]===e[2*g+1]};e.prototype.pt=function(d,g){d=this.gb(d);var e=this.wb.Ba[0].f;return e[2*d]===g.x&&e[2*d+1]===g.y};e.prototype.pS=function(d,g){1>g&&(g=1);if(null==this.wg){if(1==g)return;this.wg=a.Ac.kl(this.wb.F(),1)}d=this.gb(d);d>=this.wg.size&&this.wg.resize(d+1,1);this.wg.write(d,g)};e.prototype.RC=function(d){d=this.gb(d);return null==this.wg||d>=this.wg.size?1:this.wg.read(d)};e.prototype.lb=function(d,g,e){g=this.sh[g];d=this.gb(d);g.size<this.wb.F()&&g.resize(this.wb.F(),-1);g.write(d,
e)};e.prototype.Ra=function(d,g){d=this.gb(d);g=this.sh[g];return d<g.size?g.read(d):-1};e.prototype.re=function(){null==this.sh&&(this.sh=[]);for(var d=0;d<this.sh.length;d++)if(null==this.sh[d])return this.sh[d]=a.Ac.Dg(0,-1),d;this.sh.push(a.Ac.Dg(0,-1));return this.sh.length-1};e.prototype.bf=function(d){this.sh[d]=null};e.prototype.cc=function(d){return null!=this.Ge?(d=this.gb(d),this.Ge[d]):null};e.prototype.Oc=function(d,g){var e=this.cd.O(d,2);if(-1==e)return!1;if(this.kx){var k=new a.Va;
this.Jk(d,k);g.setStart(k);this.Jk(e,k);g.setEnd(k)}else this.wb.uc(this.cd.O(d,0),I),g.gl(0,I),this.wb.uc(this.cd.O(e,0),I),g.gl(1,I);return!0};e.prototype.gR=function(d,g,e){if(this.kx){var m=new a.Va;this.Jk(d,m);e.setStart(m);this.Jk(g,m);e.setEnd(m)}else this.wb.uc(d,I),e.gl(0,I),this.wb.uc(g,I),e.gl(1,I)};e.prototype.Cf=function(d,g){var e;if(-1!=g){if(d!=this.Vf(g))throw a.g.wa();e=this.wq(g)}else e=this.Ys(d);var k=this.lQ(d);-1!=g&&this.Mn(g,k);this.Ln(k,g);this.Mn(k,e);-1!=e?this.Ln(e,k):
this.Jn(d,k);-1==g&&this.Kn(d,k);this.gm(d,this.ea(d)+1);return k};e.prototype.aD=function(d,g,e,a){d=this.Cf(d,-1);for(var m=0,k=g,v=!1;k==e&&(v=!0),this.im(k,d),m++,k=this.X(k),k!=g;);this.Gn(d,!0);this.hm(d,m);v&&(g=e);this.Dh(d,g);this.Wi(d,this.Ua(g));this.Jr(d,!1);null!=a&&(a[0]=v);return d};e.prototype.Cr=function(d){var g=this.wq(d),e=this.bc(d),a=this.Vf(d);-1!=g?this.Ln(g,e):this.Jn(a,e);-1!=e?this.Mn(e,g):this.Kn(a,g);this.bL(d);this.gm(a,this.ea(a)-1);this.iC(d);return e};e.prototype.bL=
function(d){var g=this.Cb(d);if(-1!=g){for(var e=0,a=this.Ha(d);e<a;e++){var k=g,g=this.X(g);this.dw(k)}g=this.Vf(d);this.Pk(g,this.F(g)-this.Ha(d))}this.hm(d,0)};e.prototype.bc=function(d){return this.Rc.O(d,2)};e.prototype.wq=function(d){return this.Rc.O(d,1)};e.prototype.Ha=function(d){return this.Rc.O(d,3)};e.prototype.vc=function(d){return 0!=(this.Ho(d)&1)};e.prototype.Gn=function(d,g){if(this.vc(d)!=g){if(0<this.Ha(d)){var e=this.Cb(d),a=this.hk(d);g?(this.Sc(a,e),this.Tc(e,a)):(this.Sc(a,
-1),this.Tc(e,-1));e=this.gb(a);this.Fh(e,null)}this.Iy(d,(this.Ho(d)|1)-1|(g?1:0))}};e.prototype.Vf=function(d){return this.Rc.O(d,7)};e.prototype.VO=function(d){return 0!=(this.Ho(d)&2)};e.prototype.Dy=function(d,g){this.Iy(d,(this.Ho(d)|2)-2|(g?2:0))};e.prototype.Gw=function(d){if(this.bP(d))return this.fi.get(this.bt(d));var g=new a.yb,e=this.Cb(d);if(-1==e)return 0;var k=new a.b;this.w(e,k);for(var b=0,c=0,n=this.Ha(d);c<n;c++,e=this.X(e)){var h=this.cc(e);if(null==h){if(!this.Oc(e,g))continue;
h=g}b+=h.kv(k.x,k.y)}this.Jr(d,!0);this.fi.set(this.bt(d),b);return b};e.prototype.Rp=function(d,g,e){g=this.Jj[g];d=this.bt(d);g.size<this.fi.size&&g.resize(this.fi.size,-1);g.write(d,e)};e.prototype.Ei=function(d,g){d=this.bt(d);g=this.Jj[g];return d<g.size?g.read(d):-1};e.prototype.Uv=function(){null==this.Jj&&(this.Jj=[]);for(var d=0;d<this.Jj.length;d++)if(null==this.Jj[d])return this.Jj[d]=a.Ac.Dg(0),d;this.Jj.push(a.Ac.Dg(0));return this.Jj.length-1};e.prototype.ty=function(d){this.Jj[d]=null};
e.prototype.bQ=function(d,g,e){if(-1==e)throw a.g.N();if(g!=e){var m=this.bc(e),k=this.wq(e),b=this.Vf(e);-1==k?this.Jn(b,m):this.Ln(k,m);-1==m?this.Kn(b,k):this.Mn(m,k);this.Pk(b,this.F(b)-this.Ha(e));this.gm(b,this.ea(b)-1);k=-1==g?this.Ys(d):this.wq(g);this.Mn(e,k);this.Ln(e,g);-1==g?this.Kn(d,e):this.Mn(g,e);-1==k?this.Jn(d,e):this.Ln(k,e);this.Pk(d,this.F(d)+this.Ha(e));this.gm(d,this.ea(d)+1);this.Hu(e,d)}};e.prototype.zi=function(d,g){this.wb.Sd(this.gb(g),this.Fo());this.vl(d,-1,this.Fo())};
e.prototype.vf=function(d,g){var e=this.rd(d),k=this.Ua(d),b=this.X(d);-1!=k&&this.Sc(k,b);var c=this.Ha(e);d==this.Cb(e)&&this.Dh(e,1<c?b:-1);-1!=b&&this.Tc(b,k);d==this.hk(e)&&this.Wi(e,1<c?k:-1);if(-1!=k&&-1!=b){var k=this.gb(k),n=this.gb(b);g?(g=this.Fi(k),null!=g&&(k=new a.b,this.wb.w(n,k),g.vd(k))):(n=this.gb(d),g=this.Fi(n),this.Fh(k,g),null!=g&&(k=this.wb.Fa(k),g.ed(k)))}this.hm(e,c-1);e=this.Vf(e);this.Pk(e,this.F(e)-1);this.dw(d);return b};e.prototype.Cb=function(d){return this.Rc.O(d,4)};
e.prototype.hk=function(d){return this.Rc.O(d,5)};e.prototype.X=function(d){return this.cd.O(d,2)};e.prototype.Ua=function(d){return this.cd.O(d,1)};e.prototype.rd=function(d){return this.cd.O(d,3)};e.prototype.Ub=function(d,g){return this.vl(d,-1,g)};e.prototype.Gp=function(d){if(void 0===d)return this.Gp(!1);if(d instanceof b)return new b(d);var g,e=-1,k=-1,D=-1,c=0,n=!1;for(g=this.$c;-1!=g;g=this.we(g))if(!d||a.T.Kc(this.Lb(g))){for(e=this.Vb(g);-1!=e;e=this.bc(e))if(D=k=this.Cb(e),c=0,-1!=k){n=
!0;break}if(n)break}return b.UL(this,g,e,k,D,c,d)};e.prototype.Oe=function(d){this.Hk.Oe(d);if(null!=this.Ge)for(var g=0,e=this.Ge.length;g<e;g++)null!=this.Ge[g]&&this.Ge[g].Oe(d)};e.prototype.Tp=function(d,g,e,a){a?this.DS(d,g,e):this.CS(d,g,e)};e.prototype.Tc=function(d,g){this.cd.L(d,1,g)};e.prototype.Sc=function(d,g){this.cd.L(d,2,g)};e.prototype.im=function(d,g){this.cd.L(d,3,g)};e.prototype.hm=function(d,g){this.Rc.L(d,3,g)};e.prototype.Dh=function(d,g){this.Rc.L(d,4,g)};e.prototype.Wi=function(d,
g){this.Rc.L(d,5,g)};e.prototype.gm=function(d,g){this.Mc.L(d,6,g)};e.prototype.Pk=function(d,g){this.Mc.L(d,5,g)};e.prototype.lF=function(d){var g=d;do{var e=this.X(g);this.Sc(g,this.Ua(g));this.Tc(g,e);g=e}while(g!=d)};e.prototype.ZF=function(d){this.pd=d};e.prototype.yu=function(d){var g=this.wq(d),e=this.bc(d),a=this.Vf(d);-1!=g?this.Ln(g,e):this.Jn(a,e);-1!=e?this.Mn(e,g):this.Kn(a,g);this.Dh(d,-1);this.Wi(d,-1);this.iC(d)};e.prototype.Ui=function(d,g){var e=this.Ua(d),k=this.X(d);-1!=e&&this.Sc(e,
k);-1!=k&&this.Tc(k,e);if(-1!=e&&-1!=k)if(e=this.gb(e),k=this.gb(k),g){if(g=this.Fi(e),null!=g){var b=new a.b;this.wb.w(k,b);g.vd(b)}}else k=this.gb(d),g=this.Fi(k),this.Fh(e,g),null!=g&&(b=new a.b,this.wb.w(e,b),g.ed(b));this.dw(d)};e.prototype.bP=function(d){return 0!=(this.Ho(d)&4)};e.prototype.Jr=function(d,g){this.Iy(d,(this.Ho(d)|4)-4|(g?4:0))};e.prototype.Mu=function(d,g){var e=this.cd.f;this.wb.kc();var a=this.wb.Ba[0].f;d.xd(0,g,function(d,g){d=e[5*d];g=e[5*g];var m=a[2*d];d=a[2*d+1];var k=
a[2*g];g=a[2*g+1];return d<g?-1:d>g?1:m<k?-1:m>k?1:0})};e.prototype.pO=function(){for(var d=this.$c;-1!=d;d=this.we(d))if(!a.T.Kc(this.Lb(d)))return!0;return!1};e.prototype.Vy=function(d,g){for(var e=this.Vb(d),a=this.Vb(g),k=this.Ys(d),b=this.Ys(g),c=this.Vb(d);-1!=c;c=this.bc(c))this.Hu(c,g);for(c=this.Vb(g);-1!=c;c=this.bc(c))this.Hu(c,d);this.Jn(d,a);this.Jn(g,e);this.Kn(d,b);this.Kn(g,k);e=this.F(d);a=this.ea(d);k=this.ea(g);this.Pk(d,this.F(g));this.Pk(g,e);this.gm(d,k);this.gm(g,a);e=this.Mc.O(d,
2);this.Mc.L(d,2,this.Mc.O(g,2));this.Mc.L(g,2,e)};return e}();a.fd=k})(x||(x={}));(function(a){var k=function(k){function e(d,g,e,v){k.call(this);this.R=new a.i;void 0===d?this.MB():"number"===typeof d?this.AL(d,g,e,v):d instanceof a.Va?void 0!==g?this.Ks(d,g,e):this.BL(d):d instanceof a.pa?void 0!==g?this.DL(d,g):this.CL(d):d instanceof a.i?this.zL(d):this.MB()}A(e,k);e.prototype.Ks=function(d,g,e){this.description=a.Od.Tf();this.R.Ja();d.s()||this.sv(d,g,e)};e.prototype.zL=function(d){this.description=
a.Od.Tf();this.R.K(d);this.R.normalize()};e.prototype.CL=function(d){if(null==d)throw a.g.N();this.description=d;this.R.Ja()};e.prototype.DL=function(d,g){if(null==d)throw a.g.N();this.description=d;this.R.K(g);this.R.normalize()};e.prototype.MB=function(){this.description=a.Od.Tf();this.R.Ja()};e.prototype.BL=function(d){this.description=a.Od.Tf();this.R.Ja();d.s()||this.sv(d)};e.prototype.AL=function(d,g,e,k){this.description=a.Od.Tf();this.K(d,g,e,k)};e.prototype.K=function(d,g,e,a){this.qc();
if("number"===typeof d)this.R.K(d,g,e,a);else for(this.Ja(),g=0,e=d.length;g<e;g++)this.Db(d[g])};e.prototype.Cu=function(d){this.qc();if(!d.dP())throw a.g.N();this.R.K(d)};e.prototype.Ja=function(){this.qc();this.R.Ja()};e.prototype.s=function(){return this.R.s()};e.prototype.aa=function(){return this.R.aa()};e.prototype.ba=function(){return this.R.ba()};e.prototype.lw=function(){return this.R.lw()};e.prototype.Vs=function(){return this.R.Vs()};e.prototype.qq=function(){return this.R.Af()};e.prototype.Db=
function(d){if(d instanceof a.b)this.qc(),this.R.Db(d);else if(d instanceof a.i)this.qc(),this.R.Db(d);else if(d instanceof a.Va){if(this.qc(),!d.sc()){var g=d.description;this.description!=g&&this.Ik(g);if(this.s())this.sv(d);else{this.R.Db(d.w());for(var m=1,k=g.Aa;m<k;m++)for(var b=g.Fd(m),c=a.pa.Wa(b),n=0;n<c;n++){var h=d.ld(b,n),l=this.Ah(b,n);l.Db(h);setInterval(b,n,l)}}}}else if(d instanceof e&&!d.s())for(g=d.description,g!=this.description&&this.Ik(g),this.R.Db(d.R),m=1,k=g.Aa;m<k;m++)for(b=
g.Hd(m),c=a.pa.Wa(b),n=0;n<c;n++)h=d.Ah(b,n),l=this.Ah(b,n),l.Db(h),setInterval(b,n,l)};e.prototype.sv=function(d,g,e){if(void 0!==g){this.R.K(d.w(),g,e);g=d.description;e=1;for(var m=g.Aa;e<m;e++)for(var k=g.Fd(e),b=a.pa.Wa(k),c=0;c<b;c++){var n=d.ld(k,c);this.setInterval(k,c,n,n)}}else for(this.R.K(d.fa[0],d.fa[1]),g=d.description,e=1,m=g.Aa;e<m;e++)for(k=g.Fd(e),b=a.pa.Wa(k),c=0;c<b;c++)n=d.ld(k,c),this.setInterval(k,c,n,n)};e.prototype.setInterval=function(d,g,e,k){var m=null;"number"===typeof e?
m=new a.Nd(e,k):m=e;this.qc();if(0==d)if(0==g)this.R.v=m.qa,this.R.B=m.va;else if(1==g)this.R.C=m.qa,this.R.G=m.va;else throw a.g.Uc();else this.DA(0,d,g,m.qa),this.DA(1,d,g,m.va)};e.prototype.P=function(d,g){this.qc();this.R.P(d,g)};e.prototype.Oe=function(d){if(d instanceof a.Bg)this.qc(),d.$y(this.R);else if(this.qc(),!this.R.s()){var g=new a.fH;this.Cn(g);g.UO()?g.Ja():d.$y(g)}};e.prototype.copyTo=function(d){if(d.D()!=this.D())throw a.g.N();d.qc();d.description=this.description;d.R.K(this.R);
d.fa=null;if(null!=this.fa){d.ns();for(var g=0;g<2*(this.description.le.length-2);g++)d.fa[g]=this.fa[g]}};e.prototype.Pa=function(){return new e(this.description)};e.prototype.Mh=function(){return this.R.rN()};e.prototype.$b=function(){return this.R.CC()};e.prototype.D=function(){return 197};e.prototype.fb=function(){return 2};e.prototype.Fp=function(d){this.copyTo(d)};e.prototype.o=function(d){d.v=this.R.v;d.C=this.R.C;d.B=this.R.B;d.G=this.R.G};e.prototype.Cn=function(d){d.v=this.R.v;d.C=this.R.C;
d.B=this.R.B;d.G=this.R.G;d.K(this.R.v,this.R.C,this.yd(0,1,0),this.R.B,this.R.G,this.yd(1,1,0))};e.prototype.Ah=function(d,g){var e=new a.Nd;e.K(this.yd(0,d,g),this.yd(1,d,g));return e};e.prototype.uf=function(d,g){g.Qf(this.description);var e=this.description.Aa-1;switch(d){case 0:for(d=0;d<e;d++)for(var k=this.description.Hd(d),b=a.pa.Wa(k),c=0;c<b;c++)g.setAttribute(k,c,this.yd(0,k,c));g.ic(this.R.v,this.R.C);break;case 1:for(d=0;d<e;d++)for(k=this.description.Hd(d),b=a.pa.Wa(k),c=0;c<b;c++)g.setAttribute(k,
c,this.yd(1,k,c));g.ic(this.R.v,this.R.G);break;case 2:for(d=0;d<e;d++)for(k=this.description.Hd(d),b=a.pa.Wa(k),c=0;c<b;c++)g.setAttribute(k,c,this.yd(0,k,c));g.ic(this.R.B,this.R.G);break;case 3:for(d=0;d<e;d++)for(k=this.description.Hd(d),b=a.pa.Wa(k),c=0;c<b;c++)g.setAttribute(k,c,this.yd(1,k,c));g.ic(this.R.B,this.R.C);break;default:throw a.g.Uc();}};e.prototype.vu=function(d,g){d=this.R.vu(d);g.ma(d.x,d.y)};e.prototype.zN=function(d,g){return g*(d.up-2)};e.prototype.mC=function(d,g,e){if(this.R.s())throw a.g.ra("empty geometry");
if(0==g)return 0!=d?0!=e?this.R.G:this.R.B:0!=e?this.R.C:this.R.v;if(e>=a.pa.Wa(g))throw a.g.N();var m=this.description.zf(g);this.ns();return 0<=m?this.fa[this.zN(this.description,d)+this.description.XN(m)-2+e]:a.pa.ue(g)};e.prototype.ns=function(){this.qc();if(null==this.fa&&2<this.description.le.length){this.fa=[];for(var d=e.V(this.description,0),g=e.V(this.description,1),m=0,k=1,b=this.description.Aa;k<b;k++)for(var c=this.description.Hd(k),n=a.pa.Wa(c),c=a.pa.ue(c),h=0;h<n;h++)this.fa[d+m]=
c,this.fa[g+m]=c,m++}};e.prototype.nm=function(d){if(null!=this.fa)if(2<d.le.length){for(var g=a.Od.iu(d,this.description),m=[],k=e.V(this.description,0),b=e.V(this.description,1),c=e.V(d,0),n=e.V(d,1),h=0,l=1,q=d.Aa;l<q;l++){var u=d.Hd(l),f=a.pa.Wa(u);if(-1==g[l])for(var A=a.pa.ue(u),u=0;u<f;u++)m[c+h]=A,m[n+h]=A,h++;else for(A=this.description.fj(g[l])-2,u=0;u<f;u++)m[c+h]=this.fa[k+A],m[n+h]=this.fa[b+A],h++,A++}this.fa=m}else this.fa=null;this.description=d};e.prototype.yd=function(d,g,m){if(this.R.s())throw a.g.ra("This operation was performed on an Empty Geometry.");
if(0==g)return 0!=d?0!=m?this.R.G:this.R.B:0!=m?this.R.C:this.R.v;if(m>=a.pa.Wa(g))throw a.g.Uc();var k=this.description.zf(g);return 0<=k?(this.ns(),this.fa[e.V(this.description,d)+this.description.fj(k)-2+m]):a.pa.ue(g)};e.prototype.DA=function(d,g,m,k){this.qc();if(0==g)0!=d?0!=m?this.R.G=k:this.R.B=k:0!=m?this.R.C=k:this.R.v=k;else{if(m>=a.pa.Wa(g))throw a.g.Uc();if(!this.hasAttribute(g)){if(a.pa.nD(g,k))return;this.Ne(g)}g=this.description.zf(g);this.ns();this.fa[e.V(this.description,d)+this.description.fj(g)-
2+m]=k}};e.V=function(d,g){return g*(d.le.length-2)};e.prototype.Ga=function(d){this.qc();var g=new a.i;d.o(g);return this.R.Ga(g)};e.prototype.jc=function(d){return d instanceof a.i?this.R.jc(d):this.R.jc(d.R)};e.prototype.offset=function(d,g){this.qc();this.R.offset(d,g)};e.prototype.normalize=function(){this.qc();this.R.normalize()};e.prototype.Af=function(d){if(void 0!==d)if(d.Qf(this.description),this.s())d.Ja();else{for(var g=this.description.Aa,e=1;e<g;e++)for(var k=this.description.Hd(e),
b=a.pa.Wa(k),c=0;c<b;c++){var n=.5*(this.mC(0,k,c)+this.mC(1,k,c));d.setAttribute(k,c,n)}d.ic(this.R.Af())}else{d=new a.Va(this.description);if(this.s())return d;g=this.description.Aa;for(e=1;e<g;e++)for(k=this.description.Fd(e),b=a.pa.Wa(k),c=0;c<b;c++)n=.5*(this.yd(0,k,c)+this.yd(1,k,c)),d.setAttribute(k,c,n);d.ic(this.R.lw(),this.R.Vs());return d}};e.prototype.yw=function(){return new a.Va(this.R.yw())};e.prototype.contains=function(d){return d instanceof a.Va?d.s()?!1:this.R.contains(d.lk(),d.mk()):
this.R.contains(d.R)};e.prototype.lc=function(d){if(d==this)return!0;if(!(d instanceof e)||this.description!=d.description)return!1;if(this.s())return d.s()?!0:!1;if(!this.R.lc(d.R))return!1;for(var g=0,m=2*(this.description.le.length-2);g<m;g++)if(this.fa[g]!=d.fa[g])return!1;return!0};e.prototype.hc=function(){var d=this.description.hc(),d=a.I.kg(d,this.R.hc());if(!this.s()&&null!=this.fa)for(var g=0,e=2*(this.description.le.length-2);g<e;g++)d=a.I.kg(d,this.fa[g]);return d};e.prototype.Rf=function(){return a.Hh.il(this,
null)};e.prototype.toString=function(){return this.s()?"Envelope: []":"Envelope: ["+this.R.v+", "+this.R.C+", "+this.R.B+", "+this.R.G+"]"};return e}(a.T);a.Vj=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,m){void 0===e?this.Ja():(this.v=e,this.C=d,this.B=g,this.G=m)}k.Oa=function(e,d,g,m){var a=new k;a.v=e;a.C=d;a.B=g;a.G=m;return a};k.prototype.K=function(e,d,g,m){"number"===typeof e?void 0!==g?(this.v=e,this.C=d,this.B=g,this.G=m,this.normalize()):(this.v=e,this.C=d,this.B=e,this.G=
d):e instanceof a.b?void 0!==d?(this.v=e.x-.5*d,this.B=this.v+d,this.C=e.y-.5*g,this.G=this.C+g,this.normalize()):(this.v=e.x,this.C=e.y,this.B=e.x,this.G=e.y):e instanceof k?this.K(e.v,e.C,e.B,e.G):e instanceof a.Nd&&(e.s()||d.s()?this.Ja():(this.v=e.qa,this.B=e.va,this.C=d.qa,this.G=d.va))};k.prototype.IN=function(e,d){var g=new k;g.K(this.v,this.C,this.B,this.G);g.P(e,d);return g};k.prototype.Ey=function(e,d){if(void 0!==d)if(0==d)this.Ja();else{this.v=e[0].x;this.C=e[0].y;this.B=this.v;this.G=
this.C;for(var g=1;g<d;g++){var m=e[g];m.x<this.v?this.v=m.x:m.x>this.B&&(this.B=m.x);m.y<this.C?this.C=m.y:m.y>this.G&&(this.G=m.y)}}else if(null==e||0==e.length)this.Ja();else for(m=e[0],this.K(m.x,m.y),g=1;g<e.length;g++)m=e[g],this.Oj(m.x,m.y)};k.prototype.Ja=function(){this.G=this.B=this.C=this.v=NaN};k.prototype.s=function(){return isNaN(this.v)};k.prototype.Db=function(e,d){"number"===typeof e?this.s()?(this.v=e,this.C=d,this.B=e,this.G=d):(this.v>e?this.v=e:this.B<e&&(this.B=e),this.C>d?this.C=
d:this.G<d&&(this.G=d)):e instanceof a.b?this.Db(e.x,e.y):e instanceof a.ee?this.Db(e.x,e.y):e instanceof k&&!e.s()&&(this.Db(e.v,e.C),this.Db(e.B,e.G))};k.prototype.Oj=function(e,d){this.v>e?this.v=e:this.B<e&&(this.B=e);this.C>d?this.C=d:this.G<d&&(this.G=d)};k.prototype.P=function(e,d){this.s()||(this.v-=e,this.B+=e,this.C-=d,this.G+=d,(this.v>this.B||this.C>this.G)&&this.Ja())};k.prototype.scale=function(e){0>e&&this.Ja();this.s()||(this.v*=e,this.B*=e,this.C*=e,this.G*=e)};k.prototype.jc=function(e){return!this.s()&&
!e.s()&&(this.v<=e.v?this.B>=e.v:e.B>=this.v)&&(this.C<=e.C?this.G>=e.C:e.G>=this.C)};k.prototype.rD=function(e){return(this.v<=e.v?this.B>=e.v:e.B>=this.v)&&(this.C<=e.C?this.G>=e.C:e.G>=this.C)};k.prototype.Ga=function(e){if(this.s()||e.s())return!1;e.v>this.v&&(this.v=e.v);e.B<this.B&&(this.B=e.B);e.C>this.C&&(this.C=e.C);e.G<this.G&&(this.G=e.G);(e=this.v<=this.B&&this.C<=this.G)||this.Ja();return e};k.prototype.vu=function(e){switch(e){case 0:return a.b.Oa(this.v,this.C);case 1:return a.b.Oa(this.v,
this.G);case 2:return a.b.Oa(this.B,this.G);case 3:return a.b.Oa(this.B,this.C);default:throw a.g.Uc();}};k.prototype.hy=function(e){if(null==e||4>e.length)throw a.g.N();null!=e[0]?e[0].ma(this.v,this.C):e[0]=a.b.Oa(this.v,this.C);null!=e[1]?e[1].ma(this.v,this.G):e[1]=a.b.Oa(this.v,this.G);null!=e[2]?e[2].ma(this.B,this.G):e[2]=a.b.Oa(this.B,this.G);null!=e[3]?e[3].ma(this.B,this.C):e[3]=a.b.Oa(this.B,this.C)};k.prototype.rN=function(){return this.s()?0:this.aa()*this.ba()};k.prototype.CC=function(){return this.s()?
0:2*(this.aa()+this.ba())};k.prototype.lw=function(){return(this.B+this.v)/2};k.prototype.Vs=function(){return(this.G+this.C)/2};k.prototype.aa=function(){return this.B-this.v};k.prototype.ba=function(){return this.G-this.C};k.prototype.move=function(e,d){this.s()||(this.v+=e,this.C+=d,this.B+=e,this.G+=d)};k.prototype.offset=function(e,d){this.v+=e;this.B+=e;this.C+=d;this.G+=d};k.prototype.normalize=function(){if(!this.s()){var e=Math.min(this.v,this.B),d=Math.max(this.v,this.B);this.v=e;this.B=
d;e=Math.min(this.C,this.G);d=Math.max(this.C,this.G);this.C=e;this.G=d}};k.prototype.Yl=function(e){e.ma(this.v,this.C)};k.prototype.YE=function(e){e.ma(this.B,this.C)};k.prototype.aF=function(e){e.ma(this.v,this.G)};k.prototype.Zl=function(e){e.ma(this.B,this.G)};k.prototype.dP=function(){return this.s()||this.v<=this.B&&this.C<=this.G};k.prototype.Af=function(){return a.b.Oa((this.B+this.v)/2,(this.G+this.C)/2)};k.prototype.yw=function(){return a.b.Oa(this.v,this.C)};k.prototype.contains=function(e,
d){if(void 0!==d)return e>=this.v&&e<=this.B&&d>=this.C&&d<=this.G;if(e instanceof a.Va)return this.contains(e.lk(),e.mk());if(e instanceof a.b)return this.contains(e.x,e.y);if(e instanceof k)return e.v>=this.v&&e.B<=this.B&&e.C>=this.C&&e.G<=this.G;throw a.g.N();};k.prototype.jl=function(e,d){if(void 0!==d)return e>this.v&&e<this.B&&d>this.C&&d<this.G;if(e instanceof a.b)return this.jl(e.x,e.y);if(e instanceof k)return e.v>this.v&&e.B<this.B&&e.C>this.C&&e.G<this.G;throw a.g.N();};k.prototype.lc=
function(e){return e==this?!0:e instanceof k?this.s()&&e.s()?!0:this.v!=e.v||this.C!=e.C||this.B!=e.B||this.G!=e.G?!1:!0:!1};k.prototype.hc=function(){var e=this.v,e=a.I.truncate(e^e>>>32),d=a.I.kg(e),e=this.B,e=a.I.truncate(e^e>>>32),d=a.I.kg(e,d),e=this.C,e=a.I.truncate(e^e>>>32),d=a.I.kg(e,d),e=this.G,e=a.I.truncate(e^e>>>32);return d=a.I.kg(e,d)};k.prototype.vv=function(e){var d=new a.b;d.J(e);if(d.pv())return d;if(this.s())return d.FA(),d;d.x<this.v?d.x=this.v:d.x>this.B&&(d.x=this.B);d.y<this.C?
d.y=this.C:d.y>this.G&&(d.y=this.G);if(!d.lc(e))return d;e=this.Af();(d.x<e.x?d.x-this.v:this.B-d.x)<(d.y<e.y?d.y-this.C:this.G-d.y)?d.x=d.x<e.x?this.v:this.B:d.y=d.y<e.y?this.C:this.G;return d};k.prototype.ms=function(e){if(this.s())return NaN;if(e.x==this.v)return e.y-this.C;var d=this.G-this.C,g=this.B-this.v;return e.y==this.G?d+e.x-this.v:e.x==this.B?d+g+this.G-e.y:e.y==this.C?2*d+g+this.B-e.x:this.ms(this.vv(e))};k.prototype.vA=function(e){if(this.s())return-1;e=this.ms(e);var d=this.G-this.C,
g=this.B-this.v;return e<d?0:(e-=d)<g?1:e-g<d?2:3};k.prototype.lv=function(){return this.s()?2.220446049250313E-14:2.220446049250313E-14*(Math.abs(this.v)+Math.abs(this.B)+Math.abs(this.C)+Math.abs(this.G)+1)};k.prototype.Nv=function(e,d){var g=this.ej(e),m=this.ej(d);if(0!=(g&m))return 0;if(0==(g|m))return 4;var a=(0!=g?1:0)|(0!=m?2:0);do{var b=d.x-e.x,c=d.y-e.y;b>c?0!=(g&k.Cc)?(0!=(g&k.ob)?(e.y+=c*(this.v-e.x)/b,e.x=this.v):(e.y+=c*(this.B-e.x)/b,e.x=this.B),g=this.ej(e)):0!=(m&k.Cc)?(0!=(m&k.ob)?
(d.y+=c*(this.v-d.x)/b,d.x=this.v):(d.y+=c*(this.B-d.x)/b,d.x=this.B),m=this.ej(d)):0!=g?(0!=(g&k.ac)?(e.x+=b*(this.C-e.y)/c,e.y=this.C):(e.x+=b*(this.G-e.y)/c,e.y=this.G),g=this.ej(e)):(0!=(m&k.ac)?(d.x+=b*(this.C-d.y)/c,d.y=this.C):(d.x+=b*(this.G-d.y)/c,d.y=this.G),m=this.ej(d)):0!=(g&k.Bd)?(0!=(g&k.ac)?(e.x+=b*(this.C-e.y)/c,e.y=this.C):(e.x+=b*(this.G-e.y)/c,e.y=this.G),g=this.ej(e)):0!=(m&k.Bd)?(0!=(m&k.ac)?(d.x+=b*(this.C-d.y)/c,d.y=this.C):(d.x+=b*(this.G-d.y)/c,d.y=this.G),m=this.ej(d)):
0!=g?(0!=(g&k.ob)?(e.y+=c*(this.v-e.x)/b,e.x=this.v):(e.y+=c*(this.B-e.x)/b,e.x=this.B),g=this.ej(e)):(0!=(m&k.ob)?(d.y+=c*(this.v-d.x)/b,d.x=this.v):(d.y+=c*(this.B-d.x)/b,d.x=this.B),m=this.ej(d));if(0!=(g&m))return 0}while(0!=(g|m));return a};k.prototype.ej=function(e){return(e.x<this.v?1:0)|(e.x>this.B?1:0)<<1|(e.y<this.C?1:0)<<2|(e.y>this.G?1:0)<<3};k.prototype.mg=function(e){return!this.s()&&(this.aa()<=e||this.ba()<=e)};k.prototype.Fb=function(e){return e instanceof a.b?Math.sqrt(this.gG(e)):
Math.sqrt(this.Ou(e))};k.prototype.Ou=function(e){var d=0,g=0,m;m=this.v-e.B;m>d&&(d=m);m=this.C-e.G;m>g&&(g=m);m=e.v-this.B;m>d&&(d=m);m=e.C-this.G;m>g&&(g=m);return d*d+g*g};k.prototype.gG=function(e){var d=0,g=0,m;m=this.v-e.x;m>d&&(d=m);m=this.C-e.y;m>g&&(g=m);m=e.x-this.B;m>d&&(d=m);m=e.y-this.G;m>g&&(g=m);return d*d+g*g};k.prototype.wu=function(e){this.s()?e.Ja():e.K(this.v,this.B)};k.ob=1;k.ac=4;k.Cc=3;k.Bd=12;return k}();a.i=k})(x||(x={}));(function(a){var k;(function(e){e[e.initialize=0]=
"initialize";e[e.initializeRed=1]="initializeRed";e[e.initializeBlue=2]="initializeBlue";e[e.initializeRedBlue=3]="initializeRedBlue";e[e.sweep=4]="sweep";e[e.sweepBruteForce=5]="sweepBruteForce";e[e.sweepRedBlueBruteForce=6]="sweepRedBlueBruteForce";e[e.sweepRedBlue=7]="sweepRedBlue";e[e.sweepRed=8]="sweepRed";e[e.sweepBlue=9]="sweepBlue";e[e.iterate=10]="iterate";e[e.iterateRed=11]="iterateRed";e[e.iterateBlue=12]="iterateBlue";e[e.iterateBruteForce=13]="iterateBruteForce";e[e.iterateRedBlueBruteForce=
14]="iterateRedBlueBruteForce";e[e.resetRed=15]="resetRed";e[e.resetBlue=16]="resetBlue"})(k||(k={}));var b=function(){function e(d,g){this.th=d;this.KD=g}e.prototype.Zp=function(d,g,e){this.th.BS(e,d,g,this.KD)};e.prototype.Mo=function(d){return this.th.pq(d,this.KD)};return e}();k=function(){function e(){this.Vt=this.cn=this.Ve=this.ad=null;this.fp=new a.i;this.Al=this.Mi=this.Ni=this.od=this.rf=this.ud=this.Nt=this.Wm=this.Zc=this.vb=null;this.Hb=-1;this.ka=0;this.Rj()}e.prototype.Vp=function(){this.Rj();
this.At=!0;null==this.vb?(this.Wm=new a.ga(0),this.vb=[]):(this.Wm.cf(0),this.vb.length=0)};e.prototype.Wc=function(d,g){if(!this.At)throw a.g.xa();var e=new a.i;e.K(g);this.Wm.add(d);this.vb.push(e)};e.prototype.wo=function(){if(!this.At)throw a.g.xa();this.At=!1;null!=this.vb&&0<this.vb.length&&(this.Hb=0,this.Ec=!1)};e.prototype.jG=function(){this.Rj();this.zt=!0;null==this.vb?(this.Wm=new a.ga(0),this.vb=[]):(this.Wm.cf(0),this.vb.length=0)};e.prototype.OA=function(d,g){if(!this.zt)throw a.g.xa();
var e=new a.i;e.K(g);this.Wm.add(d);this.vb.push(e)};e.prototype.$B=function(){if(!this.zt)throw a.g.xa();this.zt=!1;null!=this.vb&&0<this.vb.length&&null!=this.Zc&&0<this.Zc.length&&(-1==this.Hb?this.Hb=3:2==this.Hb?this.Hb=3:3!=this.Hb&&(this.Hb=1),this.Ec=!1)};e.prototype.iG=function(){this.Rj();this.yt=!0;null==this.Zc?(this.Nt=new a.ga(0),this.Zc=[]):(this.Nt.cf(0),this.Zc.length=0)};e.prototype.LA=function(d,g){if(!this.yt)throw a.g.xa();var e=new a.i;e.K(g);this.Nt.add(d);this.Zc.push(e)};
e.prototype.ZB=function(){if(!this.yt)throw a.g.xa();this.yt=!1;null!=this.vb&&0<this.vb.length&&null!=this.Zc&&0<this.Zc.length&&(-1==this.Hb?this.Hb=3:1==this.Hb?this.Hb=3:3!=this.Hb&&(this.Hb=2),this.Ec=!1)};e.prototype.next=function(){if(this.Ec)return!1;for(var d=!0;d;)switch(this.Hb){case 0:d=this.Qw();break;case 1:d=this.yO();break;case 2:d=this.vO();break;case 3:d=this.xO();break;case 4:d=this.LS();break;case 5:d=this.HS();break;case 6:d=this.IS();break;case 7:d=this.JS();break;case 8:d=this.Qu();
break;case 9:d=this.Wy();break;case 10:d=this.$w();break;case 11:d=this.iP();break;case 12:d=this.fP();break;case 13:d=this.gP();break;case 14:d=this.hP();break;case 15:d=this.hF();break;case 16:d=this.gF();break;default:throw a.g.wa();}return this.Ec?!1:!0};e.prototype.YF=function(d){this.ka=d};e.prototype.Fw=function(d){return this.vb[d]};e.prototype.jw=function(d){return this.Zc[d]};e.prototype.jk=function(d){return this.Wm.read(d)};e.prototype.ek=function(d){return this.Nt.read(d)};e.Cv=function(d){return 1==
(d&1)};e.Yk=function(d){return 0==(d&1)};e.prototype.Rj=function(){this.At=this.yt=this.zt=!1;this.pf=this.qf=this.tg=this.ae=-1;this.Ec=!0};e.prototype.Qw=function(){this.mf=this.Ff=-1;if(10>this.vb.length)return this.ae=this.vb.length,this.Hb=5,!0;null==this.ad&&(this.ad=new a.bq(!0),this.cn=this.ad.Re(),this.ud=new a.ga(0));this.ad.Vp();for(var d=0;d<this.vb.length;d++){var g=this.vb[d];this.ad.gq(g.v,g.B)}this.ad.wo();this.ud.xb(2*this.vb.length);this.ud.resize(0);for(d=0;d<2*this.vb.length;d++)this.ud.add(d);
this.Lr(this.ud,2*this.vb.length,!0);this.ae=2*this.vb.length;this.Hb=4;return!0};e.prototype.yO=function(){this.mf=this.Ff=-1;if(10>this.vb.length||10>this.Zc.length)return this.ae=this.vb.length,this.Hb=6,!0;null==this.ad&&(this.ad=new a.bq(!0),this.cn=this.ad.Re(),this.ud=new a.ga(0));this.ad.Vp();for(var d=0;d<this.vb.length;d++){var g=this.vb[d];this.ad.gq(g.v,g.B)}this.ad.wo();this.ud.xb(2*this.vb.length);this.ud.resize(0);for(d=0;d<2*this.vb.length;d++)this.ud.add(d);this.Lr(this.ud,this.ud.size,
!0);this.ae=this.ud.size;-1!=this.qf&&(this.od.Fg(this.qf),this.Ni.resize(0),this.qf=-1);this.Hb=7;return this.gF()};e.prototype.vO=function(){this.mf=this.Ff=-1;if(10>this.vb.length||10>this.Zc.length)return this.ae=this.vb.length,this.Hb=6,!0;null==this.Ve&&(this.Ve=new a.bq(!0),this.Vt=this.Ve.Re(),this.rf=new a.ga(0));this.Ve.Vp();for(var d=0;d<this.Zc.length;d++){var g=this.Zc[d];this.Ve.gq(g.v,g.B)}this.Ve.wo();this.rf.xb(2*this.Zc.length);this.rf.resize(0);for(d=0;d<2*this.Zc.length;d++)this.rf.add(d);
this.Lr(this.rf,this.rf.size,!1);this.tg=this.rf.size;-1!=this.pf&&(this.od.Fg(this.pf),this.Mi.resize(0),this.pf=-1);this.Hb=7;return this.hF()};e.prototype.xO=function(){this.mf=this.Ff=-1;if(10>this.vb.length||10>this.Zc.length)return this.ae=this.vb.length,this.Hb=6,!0;null==this.ad&&(this.ad=new a.bq(!0),this.cn=this.ad.Re(),this.ud=new a.ga(0));null==this.Ve&&(this.Ve=new a.bq(!0),this.Vt=this.Ve.Re(),this.rf=new a.ga(0));this.ad.Vp();for(var d=0;d<this.vb.length;d++){var g=this.vb[d];this.ad.gq(g.v,
g.B)}this.ad.wo();this.Ve.Vp();for(d=0;d<this.Zc.length;d++)g=this.Zc[d],this.Ve.gq(g.v,g.B);this.Ve.wo();this.ud.xb(2*this.vb.length);this.rf.xb(2*this.Zc.length);this.ud.resize(0);this.rf.resize(0);for(d=0;d<2*this.vb.length;d++)this.ud.add(d);for(d=0;d<2*this.Zc.length;d++)this.rf.add(d);this.Lr(this.ud,this.ud.size,!0);this.Lr(this.rf,this.rf.size,!1);this.ae=this.ud.size;this.tg=this.rf.size;-1!=this.qf&&(this.od.Fg(this.qf),this.Ni.resize(0),this.qf=-1);-1!=this.pf&&(this.od.Fg(this.pf),this.Mi.resize(0),
this.pf=-1);this.Hb=7;return!0};e.prototype.LS=function(){var d=this.ud.get(--this.ae),g=d>>1;if(e.Yk(d))return this.ad.remove(g),0==this.ae?(this.mf=this.Ff=-1,this.Ec=!0,!1):!0;this.cn.uy(this.vb[g].v,this.vb[g].B,this.ka);this.Ff=g;this.Hb=10;return!0};e.prototype.HS=function(){if(-1==--this.ae)return this.mf=this.Ff=-1,this.Ec=!0,!1;this.tg=this.Ff=this.ae;this.Hb=13;return!0};e.prototype.IS=function(){if(-1==--this.ae)return this.mf=this.Ff=-1,this.Ec=!0,!1;this.Ff=this.ae;this.tg=this.Zc.length;
this.Hb=14;return!0};e.prototype.JS=function(){var d=this.ud.get(this.ae-1),g=this.rf.get(this.tg-1),m=this.pq(d,!0),a=this.pq(g,!1);return m>a?this.Qu():m<a?this.Wy():e.Cv(d)?this.Qu():e.Cv(g)?this.Wy():this.Qu()};e.prototype.Qu=function(){var d=this.ud.get(--this.ae),g=d>>1;if(e.Yk(d))return-1!=this.qf&&-1!=this.Ni.get(g)?(this.od.Jc(this.qf,this.Ni.get(g)),this.Ni.set(g,-1)):this.ad.remove(g),0==this.ae?(this.mf=this.Ff=-1,this.Ec=!0,!1):!0;if(-1!=this.pf&&0<this.od.vq(this.pf))for(d=this.od.gc(this.pf);-1!=
d;){var m=this.od.getData(d);this.Ve.lg(m);this.Mi.set(m,-1);m=this.od.bb(d);this.od.Jc(this.pf,d);d=m}0<this.Ve.size()?(this.Vt.uy(this.vb[g].v,this.vb[g].B,this.ka),this.Ff=g,this.Hb=12):(-1==this.qf&&(null==this.od&&(this.od=new a.$n),this.Ni=new a.ga(0),this.Ni.resize(this.vb.length,-1),this.Ni.dh(-1,0,this.vb.length),this.qf=this.od.jh(1)),this.Ni.set(g,this.od.addElement(this.qf,g)),this.Hb=7);return!0};e.prototype.Wy=function(){var d=this.rf.get(--this.tg),g=d>>1;if(e.Yk(d))return-1!=this.pf&&
-1!=this.Mi.get(g)?(this.od.Jc(this.pf,this.Mi.get(g)),this.Mi.set(g,-1)):this.Ve.remove(g),0==this.tg?(this.mf=this.Ff=-1,this.Ec=!0,!1):!0;if(-1!=this.qf&&0<this.od.vq(this.qf))for(d=this.od.gc(this.qf);-1!=d;){var m=this.od.getData(d);this.ad.lg(m);this.Ni.set(m,-1);m=this.od.bb(d);this.od.Jc(this.qf,d);d=m}0<this.ad.size()?(this.cn.uy(this.Zc[g].v,this.Zc[g].B,this.ka),this.mf=g,this.Hb=11):(-1==this.pf&&(null==this.od&&(this.od=new a.$n),this.Mi=new a.ga(0),this.Mi.resize(this.Zc.length,-1),
this.Mi.dh(-1,0,this.Zc.length),this.pf=this.od.jh(0)),this.Mi.set(g,this.od.addElement(this.pf,g)),this.Hb=7);return!0};e.prototype.$w=function(){this.mf=this.cn.next();if(-1!=this.mf)return!1;var d=this.ud.get(this.ae)>>1;this.ad.lg(d);this.Hb=4;return!0};e.prototype.iP=function(){this.Ff=this.cn.next();if(-1!=this.Ff)return!1;this.mf=this.Ff=-1;var d=this.rf.get(this.tg)>>1;this.Ve.lg(d);this.Hb=7;return!0};e.prototype.fP=function(){this.mf=this.Vt.next();if(-1!=this.mf)return!1;var d=this.ud.get(this.ae)>>
1;this.ad.lg(d);this.Hb=7;return!0};e.prototype.gP=function(){if(-1==--this.tg)return this.Hb=5,!0;this.fp.K(this.vb[this.ae]);var d=this.vb[this.tg];this.fp.P(this.ka,this.ka);return this.fp.jc(d)?(this.mf=this.tg,!1):!0};e.prototype.hP=function(){if(-1==--this.tg)return this.Hb=6,!0;this.fp.K(this.vb[this.ae]);var d=this.Zc[this.tg];this.fp.P(this.ka,this.ka);return this.fp.jc(d)?(this.mf=this.tg,!1):!0};e.prototype.hF=function(){if(null==this.ad)return this.Ec=!0,!1;this.ae=this.ud.size;0<this.ad.size()&&
this.ad.reset();-1!=this.qf&&(this.od.Fg(this.qf),this.Ni.resize(0),this.qf=-1);this.Ec=!1;return!0};e.prototype.gF=function(){if(null==this.Ve)return this.Ec=!0,!1;this.tg=this.rf.size;0<this.Ve.size()&&this.Ve.reset();-1!=this.pf&&(this.od.Fg(this.pf),this.Mi.resize(0),this.pf=-1);this.Ec=!1;return!0};e.prototype.Lr=function(d,g,e){null==this.Al&&(this.Al=new a.Rr);e=new b(this,e);this.Al.sort(d,0,g,e)};e.prototype.BS=function(d,g,m,a){var k=this;d.xd(g,m,function(d,g){var m=k.pq(d,a),v=k.pq(g,
a);return m<v||m==v&&e.Yk(d)&&e.Cv(g)?-1:1})};e.prototype.pq=function(d,g){var m=.5*this.ka;if(g)return g=this.vb[d>>1],m=e.Yk(d)?g.C-m:g.G+m;g=this.Zc[d>>1];return m=e.Yk(d)?g.C-m:g.G+m};return e}();a.sz=k})(x||(x={}));(function(a){var k=function(){function k(){}k.Oa=function(e,d,g,m,a,b){var v=new k;v.v=e;v.C=d;v.Je=g;v.B=m;v.G=a;v.ig=b;return v};k.prototype.Ja=function(){this.Je=this.v=NaN};k.prototype.s=function(){return isNaN(this.v)};k.prototype.UO=function(){return isNaN(this.Je)};k.prototype.K=
function(e,d,g,m,a,k){void 0!==m?"number"===typeof e?(this.v=e,this.C=d,this.Je=g,this.B=m,this.G=a,this.ig=k):(this.v=e.x-.5*d,this.B=this.v+d,this.C=e.y-.5*g,this.G=this.C+g,this.Je=e.z-.5*m,this.ig=this.Je+m):(this.v=e,this.C=d,this.Je=g,this.B=e,this.G=d,this.ig=g)};k.prototype.move=function(e){this.v+=e.x;this.C+=e.y;this.Je+=e.z;this.B+=e.x;this.G+=e.y;this.ig+=e.z};k.prototype.copyTo=function(e){e.v=this.v;e.C=this.C;e.B=this.B;e.G=this.G};k.prototype.Oj=function(e,d,g){this.v>e?this.v=e:this.B<
e&&(this.B=e);this.C>d?this.C=d:this.G<d&&(this.G=d);0==isNaN(this.Je)?this.Je>g?this.Je=g:this.ig<g&&(this.ig=g):this.ig=this.Je=g};k.prototype.Db=function(e,d,g,m,v,b){if("number"===typeof e)m?(this.Db(e,d,g),this.Db(m,v,b)):this.s()?(this.v=e,this.C=d,this.Je=g,this.B=e,this.G=d,this.ig=g):this.Oj(e,d,g);else if(e instanceof a.ee)this.Db(e.x,e.y,e.z);else if(e instanceof k)e.s()||(this.Db(e.v,e.C,e.Je),this.Db(e.B,e.G,e.ig));else throw a.g.N();};k.prototype.Oa=function(e,d,g){e.s()||d.s()?this.Ja():
(this.v=e.qa,this.B=e.va,this.C=d.qa,this.G=d.va,this.Je=g.qa,this.ig=g.va)};k.prototype.hy=function(e){if(null==e||8>e.length)throw a.g.N();e[0]=new a.ee(this.v,this.C,this.Je);e[1]=new a.ee(this.v,this.G,this.Je);e[2]=new a.ee(this.B,this.G,this.Je);e[3]=new a.ee(this.B,this.C,this.Je);e[4]=new a.ee(this.v,this.C,this.ig);e[5]=new a.ee(this.v,this.G,this.ig);e[6]=new a.ee(this.B,this.G,this.ig);e[7]=new a.ee(this.B,this.C,this.ig)};k.prototype.Ey=function(e){if(null==e||0==e.length)this.Ja();else{var d=
e[0];this.K(d.x,d.y,d.z);for(d=1;d<e.length;d++){var g=e[d];this.Oj(g.x,g.y,g.z)}}};return k}();a.fH=k})(x||(x={}));(function(a){(function(a){a.wa=function(){var a=Error();a.message="Internal Error";return a};a.qe=function(){var a=Error();a.message="Not Implemented";return a};a.cj=function(){var a=Error();a.message="The input unit and the spatial reference unit are not of the same unit type.ie Linear vs.Angular";return a};a.xa=function(){var a=Error();a.message="Invalid Call";return a};a.N=function(a){var e=
Error();e.message="Illegal Argument Exception";void 0!==a&&(e.message+=": "+a);return e};a.BI=function(){var a=Error();a.message="Runtime Exception.";return a};a.ra=function(a){var e=Error();e.message="Geometry Exception: "+a;return e};a.PG=function(){var a=Error();a.message="Assert Failed Exception";return a};a.Uc=function(){var a=Error();a.message="IndexOutOfBoundsException";return a};a.aU=function(a){a.message="UserCancelException";return a}})(a.g||(a.g={}))})(x||(x={}));(function(a){var k=function(){function d(d,
e){this.Ma=d;this.hE=e;this.kE=-1;this.rk=!1}d.prototype.next=function(){if(++this.kE==this.hE.F())return null;var d=this.hE.Fa(this.kE);d.scale(this.Ma.Rb);var e=new a.Ka;this.Ma.Iv(d,this.rk,e);return e};d.prototype.ya=function(){return 0};return d}(),b=function(){function d(d,e,k){this.Ma=d;this.Zt=e;this.Om=!1;this.Um=k;this.Mt=[0];this.zj=[0];this.Qi=[0];this.Sq=[0];this.rk=!1;this.$o=new a.Ka;this.Bj=[]}d.prototype.next=function(){if(this.Om){this.Om=!1;this.bd.ia();var d=a.T.Yj(this.$o);return d=
a.Of.Qj(d,this.Ma.jp,!0,!0,this.Ma.Yb)}null==this.bd&&(this.bd=this.Zt.Ca(),this.bd.kb(),null!=this.Um&&this.Um.lo());if(!this.bd.La()){if(!this.bd.kb())return null;null!=this.Um&&this.Um.lo()}d=null;this.zj[0]=0;this.Fx=this.Mt[0]=0;this.uh=NaN;this.Om=!1;for(var m=this.Bj.length=0,k=new a.b,b=new a.b,c=[0];this.bd.La()&&8>this.Fx;){var n=this.bd.ia();k.J(n.Mb());b.J(n.oc());k.scale(this.Ma.Rb);b.scale(this.Ma.Rb);a.ui.Hs(k,b)?k.x=b.x:a.ui.Fs(k,b)&&(b.x=k.x);this.Bj.length=0;a.ui.kC(this.Ma.Gb,this.Ma.Xb,
this.Ma.ke,k,b,this.Ma.Nx,this.Ma.hr,c,this.Qi,this.Sq,this.Bj,this.Mt);null!=this.Um&&(n=this.Bj.slice(0),this.Um.dD(this.Um.ea()-1,n,n.length-1));a.ui.Gs(k,b)?(this.$o.Ja(),this.Ma.Iv(k,this.rk,this.$o),this.Om=!0):(this.$o.Ja(),this.Om=this.Lv(c[0],this.$o));if(this.Om){this.bd.oi();if(this.bd.Ow()){this.bd.oi();this.bd.ia();break}this.bd.yR();break}null==d&&(d=new a.Ka,d.lo());this.TA(d);m++}this.Mt[0]=0;if(0<m){for(c=this.bd.Jb();0<m;)this.bd.oi(),k.J(this.Zt.Fa(this.bd.Jb())),b.J(this.Zt.Fa(this.bd.Bm())),
k.scale(this.Ma.Rb),b.scale(this.Ma.Rb),this.rk&&(a.ui.Hs(k,b)?k.x=b.x:a.ui.Fs(k,b)&&(b.x=k.x)),this.Bj.length=0,a.ui.kC(this.Ma.Gb,this.Ma.Xb,this.Ma.ke,b,k,this.Ma.Nx,this.Ma.hr,null,this.Qi,this.Sq,this.Bj,this.Mt),this.TA(d),m--;k.J(this.Zt.Fa(this.bd.Jb()));k.scale(this.Ma.Rb);e.kq(this.Ma.Gb,this.Ma.Xb,this.Ma.Rb,this.Ma.hb,k,this.uh+1.570796326794897,this.uh+4.71238898038469,this.Ma.Sm,this.rk,this.zj,d,NaN,NaN);this.bd.Sb(c);this.bd.ia();m=a.Ia.Cg(null,d,!0);return d=a.Of.Qj(d,m,!0,!0,this.Ma.Yb)}this.Om=
!1;this.bd.ia();d=a.T.Yj(this.$o);return d=a.Of.Qj(d,this.Ma.jp,!0,!0,this.Ma.Yb)};d.prototype.TA=function(d){var g=this.Bj[0],k,b=this.Qi[0]-1.570796326794897,c=this.Sq[0]+1.570796326794897,n;if(!isNaN(this.uh)){this.uh>=this.Qi[0]?(k=this.uh+1.570796326794897,b=k+3.141592653589793-(this.uh-this.Qi[0])):(k=this.uh+1.570796326794897,b=k+3.141592653589793-(6.283185307179586-(this.Qi[0]-this.uh)));n=this.uh>=this.Qi[0]&&3.141592653589793>=this.uh-this.Qi[0]?!1:this.uh<this.Qi[0]&&3.141592653589793<=
this.Qi[0]-this.uh?!1:!0;var h=!1;if(Math.abs(b-k)<=.5*this.Ma.Sm)if(n){var l=d.Fa(d.F()-2);l.scale(this.Ma.Rb);var q=new a.ca(0);a.zb.gw(this.Ma.Gb,this.Ma.Xb,g.x,g.y,l.x,l.y,q);for(l=q.l;l<=k;)l+=6.283185307179586;for(;l>k;)l-=6.283185307179586;l<b&&(h=!0)}else h=!0;h?(d.eF(0,d.F()-1),this.rk||(g=new a.b,g.J(d.Fa(d.F()-1)),g.scale(this.Ma.Rb),-3.141592653589793>g.x-this.zj[0]?this.zj[0]-=6.283185307179586:3.141592653589793<g.x-this.zj[0]&&(this.zj[0]+=6.283185307179586)),n||(b=.5*(b+k))):(n?(k=
new a.b,k.J(g),k.scale(1/this.Ma.Rb),d.kf(0,-1,k)):e.kq(this.Ma.Gb,this.Ma.Xb,this.Ma.Rb,this.Ma.hb,this.Bj[0],k,b,this.Ma.Sm,this.rk,this.zj,d,NaN,NaN),this.Fx+=1)}e.Hv(this.Ma.Gb,this.Ma.Xb,this.Ma.Rb,this.Ma.hb,this.Ma.ke,this.Bj,b,c,this.rk,this.zj,d);this.uh=this.Sq[0]};d.prototype.Lv=function(d,e){return this.Ma.Lv(this.Bj,d,this.Qi[0],this.Sq[0],this.rk,e)};d.prototype.ya=function(){return 0};return d}(),e=function(){function d(){}d.buffer=function(g,e,k,b,c,n){if(null==g)throw a.g.N("Geometry::Geodesic_bufferer::buffer");
if(g.s())return new a.Ka(g.description);var m=new d;m.sg=e;m.wc=a.Ya.Em(e);var v=a.Ya.ft(m.wc);m.Yb=n;m.Gb=a.Ya.Ts(m.wc);m.Xb=v*(2-v);m.Rb=m.wc.Se().Dj;m.ka=m.sg.xq();m.jp=m.wc.xq();m.hr=m.jp*m.Rb;m.ip=1.570796326794897/m.Rb;m.rU=3.141592653589793/m.Rb;m.Uq=6.283185307179586/m.Rb;m.sU=m.Uq/6;m.Ix=0;m.qU=1.5707963267948966*m.Gb/m.Ix;4==k?(m.ke=2,m.Gt=!0):(m.ke=k,m.Gt=!1);m.Da=b;m.hb=Math.abs(b);isNaN(c)||.001>c?m.sS():m.Rm=c;k=g.D();a.T.Lc(k)?(k=new a.Xa(g.description),k.Bc(g,!0),g=k,k=1607):197==
k&&(k=new a.i,g.o(k),k.aa()<=m.ka||k.ba()<=m.ka?(k=new a.Xa(g.description),k.Wc(g,!1),g=k,k=1607):(k=new a.Ka(g.description),k.Wc(g,!1),g=k,k=1736));m.tS();a.T.Km(k)||m.uS();if(m.hb<=.5*m.Rm)return 1736!=k?new a.Ka(g.description):m.Gt?g:a.ui.oq(g,m.sg,m.ke,m.Nx,-1,n);if(0>m.Da&&1736!=k)return new a.Ka(g.description);m.Gt&&a.T.Kc(k)?(e=a.ui.oq(g,e,4,NaN,m.Rm,n),g=a.Ya.Wl(e,m.sg,m.wc)):g=a.Ya.Wl(g,m.sg,m.wc);g=a.gh.qo(g,m.wc);if(g.s())return new a.Ka(g.description);!m.Gt&&a.T.Kc(k)&&(g=a.ui.IE(m.Rb,
g));g=d.PS(g,m.wc);switch(k){case 1736:e=m.yK(g);break;case 1607:e=m.zK(g);break;case 550:e=m.wK(g);break;case 33:e=m.xK(g);break;default:throw a.g.ra("corrupted_geometry");}m=a.Ya.Wl(e,m.wc,m.sg);m.Ik(g.description);return m};d.prototype.yK=function(d){var g=new a.Ka;d=new b(this,d,g);d=a.wi.local().$(d,this.wc,this.Yb).next();d=a.Vn.nl(d,this.wc,2);var e=new a.Bg;e.scale(1/this.Rb,1/this.Rb);g.Oe(e);g=a.Vn.nl(g,this.wc,2);return 0<=this.Da?a.wi.local().$(g,d,this.wc,this.Yb):a.Zr.local().$(g,d,
this.wc,this.Yb)};d.prototype.zK=function(d){d=new b(this,d,null);d=a.wi.local().$(d,this.wc,this.Yb).next();return d=a.Vn.nl(d,this.wc,2)};d.prototype.wK=function(d){d=new k(this,d);d=a.wi.local().$(d,this.wc,this.Yb).next();return d=a.Vn.nl(d,this.wc,2)};d.prototype.xK=function(d){d=d.w();d.scale(this.Rb);var g=new a.Ka;this.Iv(d,!1,g);return g=a.Vn.nl(g,this.wc,2)};d.prototype.Lv=function(g,e,k,b,c,n){var m=g[0],v=g[g.length-1],D=m.y>v.y?m.y:v.y,h=a.u.q(this.Gb,this.Xb,m.y<v.y?m.y:v.y),D=a.u.q(this.Gb,
this.Xb,D);if(.001<this.Ix-(h+e+this.hb)&&.001<this.Ix+(D-e-this.hb))return!1;e=k-1.570796326794897;k=b+1.570796326794897;var h=e-3.141592653589793,D=e+3.141592653589793,l=k+3.141592653589793,q=[NaN],u=[NaN],L=[NaN],f=[NaN];b=!1;d.wG(this.Gb,this.Xb,this.hb,m,e,h,v,k,q,u);d.wG(this.Gb,this.Xb,this.hb,v,l,k,m,h,L,f);k<q[0]&&q[0]<l?b=!0:k<u[0]&&u[0]<l&&(b=!0);b||(h<L[0]&&L[0]<e?b=!0:h<f[0]&&f[0]<e&&(b=!0));if(!b&&c)return!1;for(var A=[],p=g.length-1;0<=p;p--)A.push(g[p]);n.Ja();n.lo();p=[0];d.Hv(this.Gb,
this.Xb,this.Rb,this.hb,this.ke,g,e,k,c,p,n);d.kq(this.Gb,this.Xb,this.Rb,this.hb,v,k,l,this.Sm,c,p,n,q[0],u[0]);d.Hv(this.Gb,this.Xb,this.Rb,this.hb,this.ke,A,l,D,c,p,n);d.kq(this.Gb,this.Xb,this.Rb,this.hb,m,h,e,this.Sm,c,p,n,L[0],f[0]);g=!1;c||(g=this.zB(this.Rb,n));return b||g};d.prototype.Iv=function(e,m,a){a.Ja();a.lo();d.kq(this.Gb,this.Xb,this.Rb,this.hb,e,-this.Sm,6.283185307179586,this.Sm,m,[0],a,NaN,NaN);m||this.zB(this.Rb,a)};d.prototype.zB=function(d,e){var g=this.XK(d,e);d=this.YK(d,
e);return g||d};d.prototype.XK=function(d,e){var g=e.F(),m=!1,k=new a.i;e.o(k);if(!a.j.S(k.G*d,1.570796326794897)&&!a.j.S(k.C*d,-1.570796326794897))return!1;for(var b=new a.b,g=g-1;0<=g;g--)e.w(g,b),b.y==k.G&&a.j.S(b.y*d,1.570796326794897)?(m=!0,this.RE(b,g,e)):b.y==k.C&&a.j.S(b.y*d,-1.570796326794897)&&(m=!0,this.RE(b,g,e));return m};d.prototype.YK=function(d,e){var g=e.Fa(0),m=e.Fa(e.F()-1);return 3.141592653589793<Math.abs(g.x-m.x)*d?(this.RQ(e),!0):this.WK(e)};d.prototype.WK=function(d){return 0>
d.Mh()?(this.QQ(d),!0):!1};d.prototype.RE=function(d,e,k){var g=k.F(),m=0<e?e-1:g-1,g=k.Fa(e<g-1?e+1:0),m=k.Fa(m);if(!a.j.S(g.y,d.y)&&!a.j.S(g.x,d.x)){var v=new a.b;v.ma(g.x,d.y);k.ic(e,v)}a.j.S(m.y,d.y)||a.j.S(m.x,d.x)||(g=new a.b,g.ma(m.x,d.y),k.kf(0,e,g))};d.prototype.RQ=function(d){var e=new a.Ka,g=new a.Ka,k=new a.Bg,b=d.Fa(0),c=d.Fa(d.F()-1),n=new a.b;b.x>c.x?(c=this.ip,k.Nn(-this.Uq,0)):(c=-this.ip,k.Nn(this.Uq,0));e.add(d,!1);d.Ja();g.add(e,!1);g.Oe(k);b=new a.i;g.o(b);b.P((this.Uq-b.aa())/
2,0);b.C=-this.ip;b.G=this.ip;for(var h=0;h<g.F();h++)g.w(h,n),e.kf(0,-1,n);g.Oe(k);for(h=0;h<g.F();h++)g.w(h,n),e.kf(0,-1,n);g=e.Fa(0);k=e.Fa(e.F()-1);n.ma(k.x,c);e.kf(0,-1,n);n.ma(.5*(k.x+g.x),c);e.kf(0,-1,n);n.ma(g.x,c);e.kf(0,-1,n);e=a.gh.Rw(e,this.wc,2,b.v);e=a.gh.Rw(e,this.wc,2,b.B);e=a.Ed.clip(e,b,this.jp,NaN);d.add(e,!1)};d.prototype.QQ=function(d){var e=new a.i;d.o(e);e.P((this.Uq-e.aa())/2,0);e.C=-this.ip;e.G=this.ip;d.lo();var g=new a.b;g.ma(e.v,e.C);d.kf(1,-1,g);g.ma(e.v,e.G);d.kf(1,-1,
g);g.ma(.5*(e.v+e.B),e.G);d.kf(1,-1,g);g.ma(e.B,e.G);d.kf(1,-1,g);g.ma(e.B,e.C);d.kf(1,-1,g);g.ma(.5*(e.v+e.B),e.C);d.kf(1,-1,g)};d.Hv=function(e,m,k,b,c,n,h,l,q,u,f){var g=null;q||(g=new a.b,g.Eh(),0<f.F()&&(g.J(f.Fa(f.F()-1)),g.scale(k)));var v=new a.ca(0),D=new a.ca(0),L=new a.ca(0),A=new a.b,p=new a.b,x=n[n.length-1];k=1/k;for(var w=0;w<n.length;w++){var C=n[w],t;0==w?t=h:w==n.length-1?t=l:(a.zb.Rd(e,m,x.x,x.y,C.x,C.y,null,null,v,c),t=v.l-1.570796326794897);a.zb.Ph(e,m,C.x,C.y,b,t,D,L);q?p.ma(D.l,
L.l):(A.ma(D.l,L.l),d.Gz(C.x,A.x,g.x,u),p.ma(u[0]+A.x,A.y),g.J(p));p.scale(k);f.kf(0,-1,p)}};d.kq=function(e,m,k,b,c,n,h,l,q,u,f,A,p){if(!(h-n<l)){var g=new a.ca(0),v=new a.ca(0),D=new a.b,L=new a.b,x=null;q||(x=new a.b,x.Eh(),0<f.F()&&(x.J(f.Fa(f.F()-1)),x.scale(k)));var w=a.I.truncate(Math.ceil(n/l)),C=w++*l;C==n&&(C=w++*l);for(k=1/k;C<h+l;){n<A&&A<C?(C=A,w--):n<p&&p<C&&(C=p,w--);if(C>=h)break;a.zb.Ph(e,m,c.x,c.y,b,C,g,v);q?L.ma(g.l,v.l):(D.ma(g.l,v.l),d.Gz(c.x,D.x,x.x,u),L.ma(u[0]+D.x,D.y),x.J(L));
L.scale(k);f.kf(0,-1,L);n=C;C=w++*l}}};d.wG=function(d,e,k,b,c,n,h,l,q,u){var g=new a.b,m=new a.b,v=new a.ca(0),D=new a.ca(0);a.zb.Ph(d,e,b.x,b.y,k,c,v,D);g.ma(v.l,D.l);a.zb.Ph(d,e,b.x,b.y,k,n,v,D);m.ma(v.l,D.l);k=new a.ca(0);a.zb.gw(d,e,h.x,h.y,g.x,g.y,k);q[0]=k.l;a.zb.gw(d,e,h.x,h.y,m.x,m.y,k);for(u[0]=k.l;q[0]<=u[0];)q[0]+=6.283185307179586;for(;q[0]>u[0];)q[0]-=6.283185307179586;for(;q[0]>=l;)q[0]-=6.283185307179586,u[0]-=6.283185307179586;for(;q[0]<l;)q[0]+=6.283185307179586,u[0]+=6.283185307179586};
d.Gz=function(d,e,a,k){if(isNaN(a)){for(;3.141592653589793<k[0]+e-d;)k[0]-=6.283185307179586;for(;3.141592653589793<d-(k[0]+e);)k[0]+=6.283185307179586}else 3.141592653589793<k[0]+e-a?k[0]-=6.283185307179586:3.141592653589793<a-(k[0]+e)&&(k[0]+=6.283185307179586)};d.PS=function(d,e){var g=d.D(),m;a.T.Kc(g)?m=d.ea():550==g?m=d.F():m=1;if(1==m)return d;var k=new a.ga(0);k.resize(m);for(var b=[],c=new a.i,n=0;n<m;n++){k.write(n,n);var h;a.T.Kc(g)?(d.Ti(n,c),h=c.Af()):h=d.Fa(n);h=a.qH.QS(e,h);b[n]=h}k.xd(0,
k.size,function(d,e){return b[d]<b[e]?-1:b[d]>b[e]?1:0});c=d.Pa();for(n=0;n<m;n++)h=k.read(n),a.T.Kc(g)?c.Zj(d,h,!0):c.Pd(d,h,h+1);return c};d.prototype.tS=function(){var d=Math.min(3.141592653589793*this.Gb-this.hb,this.hb),d=Math.min(d,.39269908169872414*this.Gb),e=new a.b;e.ma(0,10*this.Rb);var k=45*this.Rb,b=new a.ca(0),c=new a.ca(0),n=new a.ca(0),h=new a.ca(0),l=new a.ca(0),q=new a.ca(0),u=new a.ca(0),f=new a.ca(0),A=new a.b,p=new a.b,x=new a.b,w=new a.b;a.zb.Ph(this.Gb,this.Xb,e.x,e.y,d,0,b,
c);A.ma(b.l,c.l);a.zb.Ph(this.Gb,this.Xb,e.x,e.y,d,k,n,h);p.ma(n.l,h.l);for(var b=new a.ca(0),c=new a.ca(0),C=new a.ca(0);;){a.zb.Ph(this.Gb,this.Xb,e.x,e.y,d,.5*(0+k),l,q);x.ma(l.l,q.l);a.zb.Rd(this.Gb,this.Xb,A.x,A.y,p.x,p.y,b,c,null,2);a.zb.dk(this.Gb,this.Xb,A.x,A.y,.5*b.l,c.l,u,f,2);w.ma(u.l,f.l);a.zb.Rd(this.Gb,this.Xb,x.x,x.y,w.x,w.y,C,null,null,2);if(C.l<=this.Rm)break;k*=.9;a.zb.Ph(this.Gb,this.Xb,e.x,e.y,d,k,n,h);p.ma(n.l,h.l)}this.Sm=6.283185307179586/Math.ceil(6.283185307179586/(k-0))};
d.prototype.uS=function(){var d=Math.min(3.141592653589793*this.Gb-this.hb,this.hb),d=Math.min(d,.39269908169872414*this.Gb),e=new a.b,k=new a.b;e.ma(0,10*this.Rb);k.ma(10*this.Rb,10*this.Rb);var b=new a.ca(0),c=new a.ca(0),n=new a.ca(0);a.zb.Rd(this.Gb,this.Xb,e.x,e.y,k.x,k.y,n,b,c,this.ke);var h=new a.ca(0),l=new a.ca(0),q=new a.ca(0),u=new a.ca(0),f=new a.b,A=new a.ca(0),p=new a.ca(0),x=new a.ca(0),w=new a.ca(0),C=new a.ca(0),t=new a.ca(0),y=new a.ca(0),z=new a.ca(0),E=new a.ca(0),I=new a.b,J=
new a.b,V=new a.b,K=new a.b,G=1,b=b.l,c=c.l+1.570796326794897,n=n.l;a.zb.Ph(this.Gb,this.Xb,e.x,e.y,d,b-1.570796326794897,p,x);I.ma(p.l,x.l);a.zb.Ph(this.Gb,this.Xb,k.x,k.y,d,c,w,C);J.ma(w.l,C.l);for(var p=new a.ca(0),x=new a.ca(0),c=new a.ca(0),r=new a.ca(0);;){a.zb.dk(this.Gb,this.Xb,e.x,e.y,.5*(0+G)*n,b,h,l,this.ke);f.ma(h.l,l.l);a.zb.Rd(this.Gb,this.Xb,e.x,e.y,f.x,f.y,null,null,A,this.ke);a.zb.Ph(this.Gb,this.Xb,f.x,f.y,d,A.l+1.570796326794897,t,y);V.ma(t.l,y.l);a.zb.Rd(this.Gb,this.Xb,I.x,I.y,
J.x,J.y,p,x,null,2);a.zb.dk(this.Gb,this.Xb,I.x,I.y,.5*p.l,x.l,z,E,2);K.ma(z.l,E.l);a.zb.Rd(this.Gb,this.Xb,V.x,V.y,K.x,K.y,c,null,null,2);if(c.l<=this.Rm)break;G*=.9;a.zb.dk(this.Gb,this.Xb,e.x,e.y,G*n,b,q,u,this.ke);k.ma(q.l,u.l);a.zb.Rd(this.Gb,this.Xb,e.x,e.y,k.x,k.y,null,null,r,this.ke);a.zb.Ph(this.Gb,this.Xb,k.x,k.y,d,r.l+1.570796326794897,w,C);J.ma(w.l,C.l)}d=G*n;1E5<d&&(d=1E5);this.Nx=d};d.prototype.sS=function(){var d;d=5E4<this.hb?100:1E4<this.hb?10:1;500>this.hb/d&&(d=this.hb/500);.01>
d&&(d=.01);this.Rm=d};return d}();a.pH=e})(x||(x={}));(function(a){var k=function(){function k(){}k.ac=function(e,d){var g=new a.b;g.J(d);e.push(g)};k.$i=function(e,d){e.add(d.x);e.add(d.y)};k.cx=function(e){e.cf(e.size-2)};k.cy=function(e,d){d.ma(e.get(e.size-2),e.get(e.size-1))};k.oq=function(e,d,g,m,v,b){if(null==e)throw a.g.N();var c=e.D();if(e.s()||a.T.Km(c))return e;var D=new k;D.sg=d;D.wc=a.Ya.Em(d);var n=a.Ya.ft(D.wc);D.Yb=b;D.Gb=a.Ya.Ts(D.wc);D.Xb=n*(2-n);D.Rb=D.wc.Se().Dj;D.jp=D.wc.xq();
D.hr=D.jp*D.Rb;D.Bx=m;D.Ax=v;D.ke=g;197==c?(g=new a.Ka(e.description),g.Wc(e,!1)):a.T.Lc(c)?(g=new a.Xa(e.description),g.Bc(e,!0)):g=e;if(4!=D.ke){d=0==D.sg.lc(D.wc)?a.Ya.Wl(g,D.sg,D.wc):a.gh.qo(g,D.wc);if(d.s())return d;d=k.IE(D.Rb,d);d=D.hw(d);d=a.Vn.nl(d,D.wc,D.ke);D=a.Ya.Wl(d,D.wc,D.sg)}else{2==a.Nf.Am(d)?(e=a.Ya.TN(),d=a.$r.local().$(g,e,d,b),d==e&&(d=new a.Ka,e.copyTo(d))):d=a.gh.qo(g,D.wc);if(d.s())return d;D=D.wS(d)}return D};k.IE=function(e,d){var g=new a.i;d.dd(g);if(3.141592653589793>g.aa()*
e)return d;for(var m=!1,g=d.Ca(),v=new a.b,b=new a.b;g.kb();)for(;g.La();){var c=g.ia();v.J(c.Mb());b.J(c.oc());v.scale(e);b.scale(e);if(3.141592653589793<Math.abs(v.x-b.x)){var n=k.Gs(v,b);if(!n){m=!0;break}if(6.283185307179586<Math.abs(v.x-b.x)){m=!0;break}}}if(!m)return d;var m=d.Pa(),h=1<d.description.Aa,l=new a.b,q=new a.b,u=new a.b,f=new a.b,A=new a.Va;for(g.Lk();g.kb();)for(var p=NaN,x=[0];g.La();){c=g.ia();v.J(c.Mb());b.J(c.oc());v.scale(e);b.scale(e);isNaN(p)?(k.Bd(v.x,NaN,x),q.J(v)):q.J(u);
p=q.x;if(n=k.Gs(v,b)){if(6.283185307179586<b.x-v.x)for(;6.283185307179586<b.x-v.x;)b.x-=6.283185307179586;if(-6.283185307179586>b.x-v.x)for(;-6.283185307179586>b.x-v.x;)b.x+=6.283185307179586;k.Bd(b.x,NaN,x);u.J(b)}else l.J(b),k.eK(l),k.Bd(l.x,p,x),u.ma(x[0]+l.x,l.y);.5>Math.abs(u.x-b.x)&&u.J(b);h?(c.uu(0,A),f.J(q),f.scale(1/e),A.ic(f),(n=g.wl())?m.df(A):m.lineTo(A),g.Jm()&&!d.vc(g.Qa)&&(c.uu(1,A),f.J(u),f.scale(1/e),A.ic(f),m.lineTo(A))):((n=g.wl())&&m.Sw(),c=m.ea()-1,f.J(q),f.scale(1/e),m.kf(c,
-1,f),g.Jm()&&!d.vc(g.Qa)&&(f.J(u),f.scale(1/e),m.kf(c,-1,f)))}return m};k.kC=function(e,d,g,m,v,b,c,n,h,l,q,u){var D=new a.b,f=new a.b,L=0<m.compare(v);k.Ez(L,m,v,D,f);k.Jz(e,d,g,D,f,b,NaN,c,n,h,l,null,q,u);L&&k.gy(h,l,null,q)};k.prototype.hw=function(e){var d=e.Pa(),g=e.Ca(),m=[],v=null,b=null,c=1<e.description.Aa;c&&(v=new a.qd(0),b=new a.Ag);for(var n=[0],h=new a.b,l=new a.b,q=new a.b,u=new a.b;g.kb();)for(n[0]=0;g.La();){var f=g.ia();h.J(f.Mb());l.J(f.oc());h.scale(this.Rb);l.scale(this.Rb);
var A=0<h.compare(l);k.Ez(A,h,l,q,u);m.length=0;null!=v&&v.cf(0);0<this.Bx?k.Jz(this.Gb,this.Xb,this.ke,q,u,this.Bx,this.Ax,this.hr,null,null,null,c?v:null,m,n):k.dH(this.Gb,this.Xb,this.ke,q,u,this.Ax,this.hr,c?v:null,m,n);A&&k.gy(null,null,c?v:null,m);m[0].J(f.Mb());m[m.length-1].J(f.oc());for(var p=1;p<m.length-1;p++)m[p].scale(1/this.Rb);c?(A=k.Cz(A,f,b),k.oz(g.wl(),g.Jm()&&!e.vc(g.Qa),f,A,v,m,d)):k.mz(g.wl(),g.Jm()&&!e.vc(g.Qa),m,d)}return d};k.prototype.wS=function(e){var d=e.Pa(),g=e.Ca(),
m=[],v=null,b=new a.Ag,c=1<e.description.Aa;for(c&&(v=new a.qd(0));g.kb();)for(;g.La();){var n=g.ia(),h=n.Mb(),l=n.oc(),h=0<h.compare(l),l=k.Cz(h,n,b);m.length=0;null!=v&&v.cf(0);k.FR(this.Gb,this.Xb,this.Rb,l,this.sg,this.Bx,this.Ax,c?v:null,m);h&&k.gy(null,null,c?v:null,m);c?k.oz(g.wl(),g.Jm()&&!e.vc(g.Qa),n,l,v,m,d):k.mz(g.wl(),g.Jm()&&!e.vc(g.Qa),m,d)}return d};k.mz=function(e,d,g,a){e&&a.Sw();e=a.ea()-1;var m=g.slice(0);a.dD(e,m,m.length-1);d&&a.kf(e,-1,g[g.length-1])};k.oz=function(e,d,g,m,
k,b,c){var v=new a.Va;g.En(v);e?c.df(v):c.lineTo(v);if(2<b.length){e=m.$b();for(var D=1;D<b.length-1;D++){var n=m.AD(k.get(D)*e);m.uu(n,v);v.ic(b[D]);c.lineTo(v)}}d&&(g.Bn(v),c.lineTo(v))};k.Jz=function(e,d,g,m,v,b,c,n,h,l,q,u,f,A){var D=new a.ca(0),L=new a.ca(0),p=new a.ca(0);a.zb.Rd(e,d,m.x,m.y,v.x,v.y,p,D,L,g);var p=p.l,x=D=D.l,L=L.l;0>x&&(x+=6.283185307179586);0>L&&(L+=6.283185307179586);null!=h&&(h[0]=p);null!=l&&(l[0]=x);null!=q&&(q[0]=L);l=h=NaN;null!=u&&(l=a.u.gg(e,d),q=a.u.q(e,d,m.y),h=(l-
q)/p,l=(l+q)/p);q=k.Hs(m,v);var L=k.Fs(m,v),x=q||L,w=k.wz(m,v,n),C=new a.ca(0),t=new a.ca(0),y=new a.b,z=new a.b,Z=new a.b;k.Bd(m.x,NaN,A);var E=[A[0]];if(p<=b)k.ac(f,m),k.Bd(v.x,NaN,A),null!=u&&u.add(0),x?(q&&k.by(m,v,u,f),L&&k.Vx(m,v,u,f)):w?k.Xx(m,v,D,h,l,u,f):0<c&&(z.ma(m.x-E[0],m.y),y.ma(v.x-A[0],v.y),k.yv(e,d,g,m,p,D,z,y,0,1,c,u,f,E)),k.ac(f,v);else{b=1+a.I.truncate(Math.ceil(p/b));var R=p/(b-1),I=new a.b,J=0;k.ac(f,m);I.J(m);z.ma(m.x-A[0],m.y);null!=u&&u.add(0);for(var K=1;K<b;K++){var V;K<
b-1?(a.zb.dk(e,d,m.x,m.y,K*R,D,C,t,g),y.ma(C.l,t.l),k.Bd(y.x,I.x,A),Z.ma(A[0]+y.x,y.y),V=K/(b-1)):(k.Bd(v.x,NaN,A),y.ma(v.x-A[0],v.y),Z.J(v),V=1);x?(1==K&&q&&k.by(m,Z,u,f),K==b-1&&L&&k.Vx(I,v,u,f)):w?k.uz(I,Z,n)&&(m.x<v.x?I.x>Z.x&&(A[0]+=6.283185307179586,Z.ma(A[0]+y.x,y.y)):I.x<Z.x&&(A[0]-=6.283185307179586,Z.ma(A[0]+y.x,y.y)),k.Xx(I,Z,D,h,l,u,f)):0<c&&k.yv(e,d,g,m,p,D,z,y,J,V,c,u,f,E);k.ac(f,Z);null!=u&&u.add(V);I.J(Z);z.J(y);E[0]=A[0];J=V}}};k.dH=function(e,d,g,m,v,b,c,n,h,l){var D=new a.ca(0),
q=new a.ca(0),u=new a.ca(0);a.zb.Rd(e,d,m.x,m.y,v.x,v.y,u,D,q,g);var q=u.l,D=D.l,f=u=NaN;if(null!=n)var f=a.u.gg(e,d),L=a.u.q(e,d,m.y),u=(f-L)/q,f=(f+L)/q;var L=k.Hs(m,v),A=k.Fs(m,v),p=L||A;c=k.wz(m,v,c);var x=k.Gs(m,v),x=p||c||x;k.Bd(m.x,NaN,l);var w=new a.b;k.ac(h,m);w.J(m);null!=n&&n.add(0);x?(p?(L&&k.by(m,v,n,h),A&&k.Vx(m,v,n,h)):c&&k.Xx(m,v,D,u,f,n,h),k.Bd(v.x,NaN,l),k.ac(h,v)):q<=b?(k.Bd(v.x,NaN,l),k.ac(h,v)):(u=new a.b,c=new a.b,u.J(m),c.J(v),u.x-=l[0],c.x-=l[0],-3.141592653589793>c.x?c.x+=
6.283185307179586:3.141592653589793<c.x&&(c.x-=6.283185307179586),k.yv(e,d,g,m,q,D,u,c,0,1,b,n,h,l),k.ac(h,v),k.Bd(v.x,NaN,l));null!=n&&n.add(1)};k.yv=function(e,d,g,m,v,b,c,n,h,l,q,u,f,A){var D=new a.b,L=new a.b;D.ma(c.x+A[0],c.y);new a.ca(0);new a.ca(0);new a.ca(0);new a.ca(0);var p=new a.ca(0),x=new a.ca(0),w=new a.ca(0),C=new a.b,t=new a.b,y=new a.b,z=new a.b;C.J(c);t.J(n);c=new a.qd(0);n=new a.qd(0);k.$i(c,t);n.add(l);var Z=new a.b,E=new a.yb,R=[];for(k.Kz(4,R);0<c.size;){for(var I=!1,J,K=NaN,
V=0;3>V;V++)if(J=R[V]*l+(1-R[V])*h,a.zb.dk(e,d,m.x,m.y,J*v,b,p,x,g),y.ma(p.l,x.l),0==V&&(K=J,z.J(y)),k.mR(C,y,t,E),E.Kb(E.Gd(y,!0),Z),a.zb.Rd(e,d,y.x,y.y,Z.x,Z.y,w,null,null,2),w.l>q){I=!0;break}I?(t.J(z),l=K,k.$i(c,t),n.add(l)):(k.cx(c),n.oj(n.size-1,1,n.size-1),0<c.size&&(k.Bd(t.x,D.x,A),L.ma(A[0]+t.x,t.y),k.ac(f,L),D.J(L),null!=u&&u.add(l),C.J(t),h=l,k.cy(c,t),l=n.get(n.size-1)))}};k.FR=function(e,d,g,m,v,b,c,n,h){var D=new a.b,l=new a.b,q=new a.b,u=new a.b,f=new a.b,L=new a.b,A=new a.b,p=new a.b,
x=new a.b,w=new a.b,C=new a.ca(0),t=new a.ca(0),y=new a.b,z=[[],[]],Z=1==a.Nf.Am(v);v=v.Ko();var E=m.Mb(),R=m.oc();Z?(L.ma(E.x*g,E.y*g),A.ma(R.x*g,R.y*g)):(z[0][0]=E.x,z[0][1]=E.y,z[1][0]=R.x,z[1][1]=R.y,a.Ya.tu(),L.x=z[0][0]*g,L.y=z[0][1]*g,A.x=z[1][0]*g,A.y=z[1][1]*g);var I=0,J=0,K=1,V=m.mD();D.J(E);l.J(R);var R=new a.qd(0),G=new a.qd(0),r=new a.qd(0);k.$i(R,l);k.$i(G,A);r.add(K);k.ac(h,D);null!=n&&n.add(J);var N=[],M;M=0<c?V?5:3:V?5:1;k.Kz(M,N);for(var Q=new a.ca(0),ca=new a.ca(0),S=new a.ca(0),
U=new a.ca(0),W=new a.ca(0),P=new a.ca(0),B=new a.ca(0);0<G.size;){var O=!1,T,ka=NaN;a.zb.Rd(e,d,L.x,L.y,A.x,A.y,Q,ca,null,2);for(E=0;E<M;E++){if(0==E){if(!V&&0>=c&&Q.l<=b&&3.141592653589793>Math.abs(L.x-A.x))break;if(m.rA(J,K)<=v)break}T=N[E]*K+(1-N[E])*J;m.Kb(T,q);Z?p.ma(q.x*g,q.y*g):(z[0][0]=q.x,z[0][1]=q.y,a.Ya.tu(),p.x=z[0][0]*g,p.y=z[0][1]*g);if(0==E&&(ka=T,f.J(q),w.J(p),0<b&&(Q.l>b||3.141592653589793<=Math.abs(L.x-A.x)))){O=!0;break}if(V&&0<b){if(a.zb.Rd(e,d,L.x,L.y,p.x,p.y,S,null,null,2),
S.l>b||3.141592653589793<=Math.abs(L.x-p.x)){O=!0;break}}else if(0<c)if(V?(u.OO(D,l,N[E]),Z?x.ma(u.x*g,u.y*g):(z[0][0]=u.x,z[0][1]=u.y,a.Ya.tu(),x.x=z[0][0]*g,x.y=z[0][1]*g)):(u.J(q),x.J(p)),a.zb.Rd(e,d,L.x,L.y,x.x,x.y,U,null,null,2),U.l<=Q.l){a.zb.dk(e,d,L.x,L.y,U.l,ca.l,C,t,2);y.ma(C.l,t.l);a.zb.Rd(e,d,y.x,y.y,p.x,p.y,W,null,null,2);if(W.l>c){O=!0;break}if(V){a.zb.Rd(e,d,y.x,y.y,x.x,x.y,P,null,null,2);if(P.l>c){O=!0;break}a.zb.Rd(e,d,x.x,x.y,p.x,p.y,B,null,null,2);if(B.l>c){O=!0;break}}}else{O=
!0;break}}O?(l.J(f),A.J(w),K=ka,k.$i(R,l),k.$i(G,A),r.add(K)):(k.cx(R),k.cx(G),r.oj(r.size-1,1,r.size-1),k.ac(h,l),I+=Q.l,null!=n&&n.add(I),0<G.size&&(D.J(l),L.J(A),J=K,k.cy(R,l),k.cy(G,A),K=r.get(r.size-1)))}if(null!=n)for(e=1/I,E=0;E<n.size;E++)n.write(E,n.read(E)*e)};k.gy=function(e,d,g,a){a.reverse();null!=g&&g.Jp(0,g.size,1);g=null!=e?e[0]:NaN;a=null!=d?d[0]:NaN;null!=e&&(e[0]=a);null!=d&&(d[0]=g)};k.Ez=function(e,d,g,a,k){e?(a.J(g),k.J(d)):(a.J(d),k.J(g))};k.Cz=function(e,d,g){if(!e)return d;
g.create(d.D());d.copyTo(g.get());g.get().reverse();return g.get()};k.Bd=function(e,d,g){if(isNaN(d)){for(;3.141592653589793<g[0]-e;)g[0]-=6.283185307179586;for(;3.141592653589793<e-g[0];)g[0]+=6.283185307179586}else 3.141592653589793<g[0]+e-d?g[0]-=6.283185307179586:3.141592653589793<d-(g[0]+e)&&(g[0]+=6.283185307179586)};k.mR=function(e,d,g,a){3.141592653589793>Math.abs(d.x-e.x)?(a.ed(e),3.141592653589793<=g.x-e.x?a.Ok(g.x-6.283185307179586,g.y):3.141592653589793<=e.x-g.x?a.Ok(g.x+6.283185307179586,
g.y):a.Ok(g.x,g.y)):(a.ed(g),3.141592653589793<=e.x-g.x?a.Ok(e.x-6.283185307179586,e.y):3.141592653589793<=g.x-e.x?a.Ok(e.x+6.283185307179586,e.y):a.Ok(e.x,e.y))};k.Kz=function(e,d){for(var g=0;g<e;g++){var a=Math.ceil(g/2)/(e+1);0!=g%2&&(a=-a);d[g]=.5+a}};k.Hs=function(e,d){return a.j.S(e.y,1.570796326794897)&&!a.j.S(d.y,1.570796326794897)||a.j.S(e.y,-1.570796326794897)&&!a.j.S(d.y,-1.570796326794897)?!0:!1};k.Fs=function(e,d){return a.j.S(d.y,1.570796326794897)&&!a.j.S(e.y,1.570796326794897)||a.j.S(d.y,
-1.570796326794897)&&!a.j.S(e.y,-1.570796326794897)?!0:!1};k.wz=function(e,d,g){return!k.uz(e,d,g)||a.j.S(e.y,1.570796326794897)||a.j.S(e.y,-1.570796326794897)||a.j.S(d.y,1.570796326794897)||a.j.S(d.y,-1.570796326794897)?!1:!0};k.uz=function(e,d,g){return Math.abs(Math.abs(e.x-d.x)-3.141592653589793)<=g?!0:!1};k.Gs=function(e,d){return a.j.S(e.y,1.570796326794897)&&a.j.S(d.y,1.570796326794897)||a.j.S(e.y,-1.570796326794897)&&a.j.S(d.y,-1.570796326794897)?!0:!1};k.by=function(e,d,g,m){if(0<e.y){var v=
new a.b;v.ma(d.x,1.570796326794897)}else v=new a.b,v.ma(d.x,-1.570796326794897);a.j.S(e.x,v.x)||a.j.S(d.y,v.y)||(k.ac(m,v),null!=g&&g.add(0))};k.Vx=function(e,d,g,m){if(0<d.y){var v=new a.b;v.ma(e.x,1.570796326794897)}else v=new a.b,v.ma(e.x,-1.570796326794897);a.j.S(d.x,v.x)||a.j.S(e.y,v.y)||(k.ac(m,v),null!=g&&g.add(1))};k.Xx=function(e,d,g,m,v,b,c){a.j.Vc(g)?(0<1.570796326794897-e.y&&(g=new a.b,g.ma(e.x,1.570796326794897),k.ac(c,g),null!=b&&b.add(m)),0<1.570796326794897-d.y&&(g=new a.b,g.ma(d.x,
1.570796326794897),k.ac(c,g),null!=b&&b.add(m))):(0<1.570796326794897+e.y&&(g=new a.b,g.ma(e.x,-1.570796326794897),k.ac(c,g),null!=b&&b.add(v)),0<1.570796326794897+d.y&&(g=new a.b,g.ma(d.x,-1.570796326794897),k.ac(c,g),null!=b&&b.add(v)))};k.eK=function(e){if(-3.141592653589793>e.x)for(;-3.141592653589793>e.x;)e.x+=6.283185307179586;if(3.141592653589793<e.x)for(;3.141592653589793<e.x;)e.x-=6.283185307179586};return k}();a.ui=k})(x||(x={}));(function(a){var k=function(){function k(){}k.nl=function(e,
d,g){if(null==e||null==d||!a.Ya.Qo(d))throw a.g.N();if(e.s())return e;var m=e,v=m.D();if(a.T.Kc(v)){m=a.gh.qo(e,d);e=new a.i;m.o(e);for(var v=a.Ia.zd(d,e,!1),b=a.Ya.Fm(d),c=Math.floor((e.v-b.v)/b.aa())*b.aa()+b.v;c<e.B;)c>e.v+v&&c<e.B-v&&(m=a.gh.Rw(m,d,g,c)),c+=b.aa()}else{if(197==v)return e=new a.Ka(m.description),e.Wc(m,!1),k.nl(e,d,g);if(a.T.Lc(v))return e=new a.Xa(m.description),e.Bc(m,!0),k.nl(e,d,g)}return k.VG(m,d)};k.VG=function(e,d){if(null==e||null==d||!a.Ya.Qo(d))throw a.g.N();if(e.s())return e;
var g;g=e.D();197==g?(g=new a.Ka(e.description),g.Wc(e,!1)):a.T.Lc(g)?(g=new a.Xa(e.description),g.Bc(e,!0)):g=e;g=a.gh.qo(g,d);return g.s()?g:1==a.Nf.Am(d)?a.gh.aN(g,d,g!=e):k.SG(g,d,g!=e)};k.SG=function(e,d,g){if(!a.Ya.Qo(d))throw a.g.N();if(e.s())return e;var m=a.Ya.IC(d),k=0-180*m,m=360*m;2==a.Nf.Am(d)&&(k=a.Ya.Fm(d),m=k.B,k=k.v,m-=k);return a.gh.gC(e,k,m,d,g)};return k}();a.Vn=k})(x||(x={}));(function(a){var k=function(){function k(){}k.OH=function(e,d){var g=Math.abs(e%d);return isNaN(g)||g==
e||g<=Math.abs(d)/2?g:0>e?-1*(g-d):0<e?1*(g-d):0*(g-d)};k.H=function(e){return 0>e?-e:e};k.nb=function(e,d){return 0<=d?k.H(e):-k.H(e)};k.S=function(e,d){return e==d||k.H(e-d)<=k.bF*(1+(k.H(e)+k.H(d))/2)};k.Vc=function(e){return 0==e||k.H(e)<=k.bF};k.bs=function(e){e=k.OH(e,k.fv);return k.H(e)<=k.$g?e:0>e?e+k.fv:e-k.fv};k.Yz=function(e,d){e.l=k.bs(e.l);d.l=k.bs(d.l);k.H(d.l)>k.Vr&&(e.l=k.bs(e.l+k.$g),d.l=k.nb(k.$g,d.l)-d.l)};k.gg=function(e,d){d=Math.sqrt(1-d);d=(1-d)/(1+d);var g=d*d;return e/(1+
d)*(1+g*(.25+g*(.015625+1/256*g)))*k.Vr};k.pN=function(e,d,g,m,v){var b,c,n,h,l,q,u,f=0,A=q=0,p=0,x=0,w=0;l=0;var C,t,y;u=0;var z,E,I;y=new a.ca;b=new a.ca;if(null!=v)if(y.l=e,b.l=d,k.Yz(y,b),e=y.l,d=b.l,y.l=g,b.l=m,k.Yz(y,b),g=y.l,m=b.l,g=k.bs(g-e),k.S(d,m)&&(k.Vc(g)||k.S(k.H(d),k.Vr)))null!=v&&(v.l=0);else{if(k.S(d,-m)){if(k.S(k.H(d),k.Vr)){null!=v&&(v.l=2*k.gg(6378137,.0066943799901413165));return}if(k.S(k.H(g),k.$g)){null!=v&&(v.l=2*k.gg(6378137,.0066943799901413165));return}}if(k.Vc(.0066943799901413165))x=
Math.cos(d),w=Math.cos(m),null!=v&&(f=Math.sin((m-d)/2),q=Math.sin(g/2),u=2*Math.asin(Math.sqrt(f*f+x*w*q*q)),v.l=6378137*u);else{y=1-Math.sqrt(.9933056200098587);e=1-y;b=Math.atan(e*Math.tan(d));d=Math.sin(b);b=Math.cos(b);c=Math.atan(e*Math.tan(m));m=Math.sin(c);c=Math.cos(c);h=n=g;E=0;I=1;z=g;for(t=!0;1==t;)E+=1,1==I&&(l=Math.sin(z),q=Math.cos(z),f=c*l,u=b*m-d*c*q,f=Math.sqrt(f*f+u*u),q=d*m+b*c*q,u=Math.atan2(f,q),A=1E-15>k.H(f)?b*c*l/k.nb(1E-15,f):b*c*l/f,p=1-A*A,x=1E-15>k.H(p)?q-d*m/k.nb(1E-15,
p)*2:q-d*m/p*2,w=x*x,l=((-3*p+4)*y+4)*p*y/16),C=(1-l)*y*(u+l*f*(x+q*l*(2*w-1))),1==I?(z=g+C*A,1E-14>k.H(z-h)?t=!1:k.H(z)>k.$g?(I=2,z=k.$g,0>g&&(z=-z),A=0,p=1,n=h=2,u=k.$g-k.H(Math.atan(d/b)+Math.atan(m/c)),f=Math.sin(u),q=Math.cos(u),l=((-3*p+4)*y+4)*p*y/16,1E-14>k.H(A-n)?t=!1:(x=1E-15>k.H(p)?q-d*m/k.nb(1E-15,p)*2:q-d*m/p*2,w=x*x)):(0>(z-h)*(h-n)&&5<E&&(z=(2*z+3*h+n)/6),n=h,h=z)):(A=(z-g)/C,0>(A-h)*(h-n)&&5<E&&(A=(2*A+3*h+n)/6),n=h,h=A,p=1-A*A,l=A*f/(b*c),q=-Math.sqrt(k.H(1-l*l)),z=Math.atan2(l,q),
f=c*l,u=b*m-d*c*q,f=Math.sqrt(f*f+u*u),q=d*m+b*c*q,u=Math.atan2(f,q),l=((-3*p+4)*y+4)*p*y/16,1E-14>k.H(A-n)?t=!1:(x=1E-15>k.H(p)?q-d*m/k.nb(1E-15,p)*2:q-d*m/p*2,w=x*x));null!=v&&(A=Math.sqrt(1+(1/(e*e)-1)*p),A=(A-1)/(A+1),p=A*(1-.375*A*A),v.l=(1+A*A/4)/(1-A)*e*6378137*(u-p*f*(x+p/4*(q*(-1+2*w)-p/6*x*(-3+4*f*f)*(-3+4*w)))))}}};k.$g=3.141592653589793;k.Vr=1.5707963267948966;k.fv=6.283185307179586;k.bF=3.552713678800501E-15;return k}();a.nH=k})(x||(x={}));(function(a){var k=function(){function a(){}
a.prototype.uv=function(e){this.hi=e};a.prototype.GA=function(e){this.Ab=e};a.prototype.HA=function(e){this.nn=e};a.vB=function(e){return e.s()||1607!=e.D()&&1736!=e.D()?!1:!0};a.tB=function(e){return e.s()||1607!=e.D()&&1736!=e.D()||20>e.F()?!1:!0};a.uB=function(e){return e.s()||1607!=e.D()&&1736!=e.D()||20>e.F()?!1:!0};return a}();a.Wj=k})(x||(x={}));(function(a){var k=function(){function k(){}k.FH=function(e){var d=new a.Ka;d.Uy(e.R.v,e.R.C);d.wj(e.R.v,e.R.G);d.wj(e.R.B,e.R.G);d.wj(e.R.B,e.R.C);
return d};k.aT=function(e,d){var g=a.wi.local();e=new a.Pc(e);return g.$(e,d,null).next()};k.ll=function(e,d,g){return a.Zr.local().$(e,d,g,null)};k.On=function(e,d,g){return a.dv.local().$(e,d,g,null)};k.MS=function(e,d,g){var m=a.dv.local();e=new a.Pc(e);d=new a.Pc(d);g=m.$(e,d,g,null);for(m=[];null!=(d=g.next());)m.push(d);return m};k.lc=function(e,d,g){return a.bl.local().$(3,e,d,g,null)};k.nM=function(e,d,g){return a.bl.local().$(4,e,d,g,null)};k.QO=function(e,d,g){var m=a.$r.local();e=new a.Pc(e);
d=new a.Pc(d);g=m.$(e,d,g,null);for(m=[];null!=(d=g.next());)m.push(d);return m};k.kM=function(e,d,g){var m=a.Zr.local();e=new a.Pc(e);d=new a.Pc(d);g=m.$(e,d,g,null);for(m=[];null!=(d=g.next());)m.push(d);return m};k.Ga=function(e,d,g){return a.$r.local().$(e,d,g,null)};k.jT=function(e,d,g){return a.bl.local().$(2,e,d,g,null)};k.contains=function(e,d,g){return a.bl.local().$(1,e,d,g,null)};k.VL=function(e,d,g){return a.bl.local().$(16,e,d,g,null)};k.touches=function(e,d,g){return a.bl.local().$(8,
e,d,g,null)};k.tQ=function(e,d,g){return a.bl.local().$(32,e,d,g,null)};k.RO=function(e,d,g){return a.bl.local().$(1073741824,e,d,g,null)};k.py=function(e,d,g,m){return a.fI.local().$(e,d,g,m,null)};k.Fb=function(e,d,g,m){var k=null;if(null!=g){if(k=g.Se(),null!=m&&k.Qc()!=m.Qc()&&k.Nc!=m.Nc)throw a.g.cj();}else if(null!=m)throw a.g.N();e=a.ZH.local().$(e,d,null);null!==k&&null!==m&&(e=a.Tb.ih(e,k,m));return e};k.clip=function(e,d,g){return a.SH.local().$(e,a.i.Oa(d.R.v,d.R.C,d.R.B,d.R.G),g,null)};
k.xm=function(e,d,g){if(null==e||null==d)return null;e=a.UH.local().$(!0,e,d,g,null);for(d=[];null!=(g=e.next());)g.s()||d.push(g);return d.slice(0)};k.rK=function(e,d,g,m,v,b,c,n){if(!0===v)return k.VP(e,d,g,m,b,c,n);v=g;if(null!=d){if(c=d.Se(),null!=m&&c.Qc()!=m.Qc()){if(c.Nc!=m.Nc)throw a.g.cj();v=[];a.Tb.OB(g,g.length,m,c,v)}}else if(null!=m)throw a.g.N();g=a.Oz.local();if(b){e=new a.Pc(e);d=g.$(e,d,v,b,null);for(e=[];null!=(b=d.next());)e.push(b);b=e.slice(0)}else for(b=[],m=0;m<e.length;m++)b[m]=
g.$(e[m],d,v[m],null);return b};k.VP=function(e,d,g,m,k,b,c){if(null===d)throw a.g.N();if(null===m||void 0===m)m=4326!==d.Qc()?d.Se():a.Tb.Qd(9001);if(0!==m.Nc)throw a.g.N();a.Tb.OB(g,g.length,m,a.Tb.Qd(9001),g);m=a.Tz.local();if(k){e=new a.Pc(e);d=m.$(e,d,b,g,c,!1,k,null);for(g=[];null!=(b=d.next());)g.push(b);k=g.slice(0)}else{k=[];for(var v=0;v<e.length;v++)k[v]=m.$(e[v],d,b,g[v],c,!1,null)}return k};k.buffer=function(e,d,g,m,k,b,c){var v=g;if(!1===k){if(null!=d){if(k=d.Se(),null!=m&&k.Qc()!=m.Qc()){if(k.Nc!=
m.Nc)throw a.g.cj();v=a.Tb.ih(g,m,k)}}else if(null!=m)throw a.g.N();e=a.Oz.local().$(e,d,v,null)}else{if(null===d)throw a.g.N();if(null===m||void 0===m)m=4326!==d.Qc()?d.Se():a.Tb.Qd(9001);if(0!==m.Nc)throw a.g.N();v=a.Tb.ih(g,m,a.Tb.Qd(9001));e=a.Tz.local().$(e,d,b,v,c,!1,null)}return e};k.sQ=function(e,d,g,m,k,b,c){if(null!=d){var v=d.Se();if(null!=c&&v.Qc()!=c.Qc()){if(v.Nc!=c.Nc)throw a.g.cj();g=a.Tb.ih(g,c,v)}}else if(null!=c)throw a.g.N();e=new a.Pc(e);d=a.Wz.local().$(e,d,g,m,k,b,null);for(g=
[];null!=(m=d.next());)g.push(m);return g.slice(0)};k.offset=function(e,d,g,m,k,b,c){if(null!=d){var v=d.Se();if(null!=c&&v.Qc()!=c.Qc()){if(v.Nc!=c.Nc)throw a.g.cj();g=a.Tb.ih(g,c,v)}}else if(null!=c)throw a.g.N();return a.Wz.local().$(e,d,g,m,k,b,null)};k.JL=function(e){return a.Qz.local().$(e,null)};k.KL=function(e,d){var g=a.Qz.local();e=new a.Pc(e);g=g.$(e,d,null);for(e=[];null!=(d=g.next());)e.push(d);return e};k.zw=function(e,d,g){return a.bv.local().zw(e,d,g)};k.Aw=function(e,d){return a.bv.local().Aw(e,
d)};k.Bw=function(e,d,g,m){return a.bv.local().Bw(e,d,g,m)};k.Qy=function(e,d){return a.as.local().$(e,d,!1,null)};k.cP=function(e,d){return a.as.local().Ro(e,d,null)};k.fN=function(e,d,g,m,k){var v=a.Sz.local();if(null!=d){if(d=d.Se(),null!=k&&d.Qc()!=k.Qc()){if(d.Nc!=k.Nc)throw a.g.cj();g=a.Tb.ih(g,k,d)}}else if(null!=k)throw a.g.N();return v.$(e,g,m,null)};k.oq=function(e,d,g,m){var k=a.WH.local();if(null!=d){if(d=d.Se(),null!=m&&d.Qc()!=m.Qc()){if(d.Nc!=m.Nc)throw a.g.cj();g=a.Tb.ih(g,m,d)}}else if(null!=
m)throw a.g.N();return k.$(e,g,null)};k.fw=function(e,d,g,m,k){void 0===k&&(k=0);var v=a.aI.local();if(4==k)throw a.g.qe();if(0!==k)throw a.g.qe();if(null!=d){var b=d.Se();if(null!=m&&b.Qc()!=m.Qc()){if(b.Nc!=m.Nc)throw a.g.cj();g=a.Tb.ih(g,m,b)}}else if(null!=m)throw a.g.N();return v.$(e,g,d,k,null)};k.jN=function(e,d,g,m){if(null===e)return 0;if(4==m)throw a.g.qe();if(0!==m)throw a.g.qe();if(197==e.D())e=k.FH(e);else if(1736!=e.D())return 0;m=a.Ya.Em(d);e=a.Ya.Wl(e,d,m);e=a.oH.kN([e])[0];if(null!==
g){if(2!==g.Nc)throw a.g.N("Unit must be a area unit type");e=a.Tb.ih(e,a.Tb.Qd(109404),g)}return e};k.nN=function(e,d,g,m){e=a.cI.local().$(e,d,m,null);if(null!==g){if(0!==g.Nc)throw a.g.N("Unit must be a linear unit type");e=a.Tb.ih(e,a.Tb.Qd(9001),g)}return e};k.BQ=function(e,d,g){if(null===e)return 0;var m=null;if(null!=d){m=d.Se();if(0==m.Nc&&(m=a.Tb.PC(m),null==m&&null!==g))throw a.g.N();if(null!=g&&m.Qc()!=g.Qc()&&m.Nc!=g.Nc)throw a.g.cj();}else if(null!=g)throw a.g.N();return 1736==e.D()||
197==e.D()?(e=e.Mh(),null!==g?a.Tb.ih(e,m,g):e):0};k.CQ=function(e,d,g){if(null===e||e.s()||1>e.fb())return 0;var m=null;if(null!=d){if(m=d.Se(),null!=g&&m.Qc()!=g.Qc()&&m.Nc!=g.Nc)throw a.g.cj();}else if(null!=g)throw a.g.N();1736==e.D()||197==e.D()?d=e.Rf():a.T.Lc(e.D())?(d=new a.Xa(e.description),d.Bc(e,!0)):d=e;e=0;d=d.Ca();for(var k=new a.b,b=new a.b;d.kb();)for(;d.La();){var c=d.ia();c.ht(k);c.uw(b);e+=a.b.Fb(k,b)}null!==m&&null!==g&&(e=a.Tb.ih(e,m,g));return e};k.YT=function(e,d){return a.Nf.mN(e,
d)};k.IL=function(e){return void 0!==e.points?k.kH(e,void 0===e.hasZ?!1:e.hasZ,void 0===e.hasM?!1:e.hasM):void 0!==e.rings?k.Nz(e.rings,void 0===e.hasZ?!1:e.hasZ,void 0===e.hasM?!1:e.hasM,"P"):void 0!==e.paths?k.Nz(e.paths,void 0===e.hasZ?!1:e.hasZ,void 0===e.hasM?!1:e.hasM,"L"):void 0!==e.x?k.uH(e):void 0!==e.xmin?k.hH(e):null};k.uH=function(e){if(null==e.x||"NaN"==e.x)return new a.Va;var d=new a.Va(e.x,e.y);void 0!==e.z&&null!==e.z&&d.rS(e.z);void 0!==e.m&&null!==e.m&&d.bS(e.m);return d};k.hH=function(e){if(null==
e.xmin||"NaN"==e.xmin)return new a.Vj;var d=new a.Vj(e.xmin,e.ymin,e.xmax,e.ymax);void 0!==e.zmin&&null!==e.zmin&&d.setInterval(1,0,e.zmin,e.zmax);void 0!==e.mmin&&null!==e.mmin&&d.setInterval(2,0,e.mmin,e.mmax);return d};k.kH=function(e,d,g){var m=0,k=new a.pe,b=3*e.points.length;0!=b%2&&b++;2>b&&(b=2);var c=a.I.truncate(3*e.points.length/2);4>c?c=4:16>c&&(c=16);for(var b=a.Ac.kl(b,0),n=a.Ac.kl(c),c=a.Ac.kl(c),h=0;h<e.points.length;h++)b.write(2*h,e.points[h][0]),b.write(2*h+1,e.points[h][1]),n.write(h,
d||g?e.points[h][2]:NaN),c.write(h,g&&d?e.points[h][3]:NaN),m++;0!=m&&(k.resize(m),k.bm(0,b));d&&(k.Ne(1),k.bm(1,n));g&&(k.Ne(2),k.bm(2,0==d?n:c));k.ce(16777215);return k};k.Nz=function(e,d,g,m){var k,b=0,c=2;"P"==m?(k=new a.Ka,b=1,c=3):k=new a.Xa;for(var n=a.Ac.Dg(0),h=a.Ac.to(0),l=0,q=0,u=[],f=[],A=0;A<e.length;A++){var p=e[A].length;u[A]=!1;if("P"===m&&e[A][0][0]===e[A][e[A].length-1][0]&&e[A][0][1]===e[A][e[A].length-1][1]){var x=0==g?!0:e[A][0][3]===e[A][e[A].length-1][3]||void 0===e[A][0][3]&&
void 0===e[A][e[A].length-1][3];(0==d||e[A][0][2]===e[A][e[A].length-1][2]||void 0===e[A][0][2]&&void 0===e[A][e[A].length-1][2])&&x&&(u[A]=!0,--p)}p>=c?(f[A]=!1,q+=1,n.add(l),h.add(b),l+=p):f[A]=!0}m=3*l;0!=m%2&&m++;2>m&&(m=2);A=a.I.truncate(3*l/2);4>A?A=4:16>A&&(A=16);m=a.Ac.kl(m,0);b=a.Ac.kl(A);c=a.Ac.kl(A);for(A=p=0;A<e.length;A++)if(!1===f[A])for(x=0;x<e[A].length;x++){var w=!1;x===e[A].length-1&&!0===u[A]&&(w=!0);w||(m.write(2*p,e[A][x][0]),m.write(2*p+1,e[A][x][1]),b.write(p,d||g?e[A][x][2]:
NaN),c.write(p,g&&d?e[A][x][3]:NaN),p++)}0!=l&&(e=k,n.resize(q),h.resize(q),0<l&&(n.add(l),h.add(0)),e.bm(0,m),e.NF(h),e.OF(n));d&&(k.Ne(1),k.bm(1,b));g&&(k.Ne(2),k.bm(2,0==d?b:c));k.ce(16777215);return k};return k}();a.Pb=k})(x||(x={}));(function(a){var k=function(){function a(){}a.Zk=function(e){var d=0,g=0,a=e.length,k=e[g],b;for(g;g<a-1;g++)b=e[g+1],d+=(b[0]-k[0])*(b[1]+k[1]),k=b;return 0<=d};a.rotate=function(e,d,g){d=d*Math.PI/180;var m=Math.cos(d),k=Math.sin(d);if(void 0!==e.paths){d={paths:[]};
for(var b=0;b<e.paths.length;b++){for(var c=e.paths[b],n=[],h=0;h<c.length;h++){var l=c[h].slice(0);n.push(l);var q=m*(c[h][0]-g.x)-k*(c[h][1]-g.y)+g.x,u=k*(c[h][0]-g.x)+m*(c[h][1]-g.y)+g.y;l[0]=q;l[1]=u}d.paths.push(n)}return d}if(void 0!==e.rings){d={rings:[]};for(b=0;b<e.rings.length;b++){for(var c=e.rings[b],n=[],f=a.Zk(c),h=0;h<c.length;h++)l=c[h].slice(0),n.push(l),q=m*(c[h][0]-g.x)-k*(c[h][1]-g.y)+g.x,u=k*(c[h][0]-g.x)+m*(c[h][1]-g.y)+g.y,l[0]=q,l[1]=u;a.Zk(n)!==f&&n.reverse();d.rings.push(n)}return d}if(void 0!==
e.x)return d={x:m*(e.x-g.x)-k*(e.y-g.y)+g.x,y:k*(e.x-g.x)+m*(e.y-g.y)+g.y},void 0!==e.z&&(d.z=e.z),void 0!==e.m&&(d.m=e.m),d;if(void 0!==e.points){d={points:[]};e=e.points;for(h=0;h<e.length;h++)b=e[h].slice(0),b[0]=m*(e[h][0]-g.x)-k*(e[h][1]-g.y)+g.x,b[1]=k*(e[h][0]-g.x)+m*(e[h][1]-g.y)+g.y,d.points.push(b);return d}return null};a.eC=function(e,d){var g,m;if(void 0!==e.paths){g={paths:[]};for(var k=0;k<e.paths.length;k++){for(var b=e.paths[k],c=[],n=0;n<b.length;n++){var h=b[n].slice(0);c.push(h);
m=d.x-b[n][0];h[0]=b[n][0]+2*m}g.paths.push(c)}return g}if(void 0!==e.rings){g={rings:[]};for(k=0;k<e.rings.length;k++){for(var b=e.rings[k],l=a.Zk(b),c=[],n=0;n<b.length;n++)h=b[n].slice(0),c.push(h),m=d.x-b[n][0],h[0]=b[n][0]+2*m;a.Zk(c)!==l&&c.reverse();g.rings.push(c)}return g}if(void 0!==e.x)return m=d.x-e.x,g={x:e.x+2*m,y:e.y},void 0!==e.z&&(g.z=e.z),void 0!==e.m&&(g.m=e.m),g;if(void 0!==e.points){g={points:[]};k=e.points;for(n=0;n<k.length;n++)b=k[n].slice(0),m=d.x-b[0],b[0]+=2*m,g.points.push(b);
return g}return void 0!==e.xmin?(g={v:e.xmin,C:e.ymin,B:e.xmax,G:e.ymax},void 0!==e.zmin&&(g.zmin=e.zmin,g.zmax=e.zmax),void 0!==e.mmin&&(g.mmin=e.mmin,g.mmax=e.mmax),m=d.x-e.xmin,g.xmax=e.xmin+2*m,m=d.x-e.xmax,g.xmin=e.xmax+2*m,g):null};a.fC=function(e,d){var g,m;if(void 0!==e.paths){g={paths:[]};for(var k=0;k<e.paths.length;k++){for(var b=e.paths[k],c=[],n=0;n<b.length;n++){var h=b[n].slice(0);c.push(h);m=d.y-b[n][1];h[1]=b[n][1]+2*m}g.paths.push(c)}return g}if(void 0!==e.rings){g={rings:[]};for(k=
0;k<e.rings.length;k++){for(var b=e.rings[k],l=a.Zk(b),c=[],n=0;n<b.length;n++)h=b[n].slice(0),c.push(h),m=d.y-b[n][1],h[1]=b[n][1]+2*m;a.Zk(c)!==l&&c.reverse();g.rings.push(c)}return g}if(void 0!==e.x)return m=d.y-e.y,g={y:e.y+2*m,x:e.x},void 0!==e.z&&(g.z=e.z),void 0!==e.m&&(g.m=e.m),g;if(void 0!==e.points){g={points:[]};k=e.points;for(n=0;n<k.length;n++)b=k[n].slice(0),m=d.y-b[1],b[1]+=2*m,g.points.push(b);return g}return void 0!==e.xmin?(g={v:e.xmin,C:e.ymin,B:e.xmax,G:e.ymax},void 0!==e.zmin&&
(g.zmin=e.zmin,g.zmax=e.zmax),void 0!==e.mmin&&(g.mmin=e.mmin,g.mmax=e.mmax),m=d.y-e.ymin,g.ymax=e.ymin+2*m,m=d.y-e.ymax,g.ymin=e.ymax+2*m,g):null};return a}();a.Wn=k})(x||(x={}));(function(a){var k=function(){function k(){}k.jg=function(e,d){null==d&&(d=a.Od.Tf());switch(e){case 33:return new a.Va(d);case 322:return new a.yb(d);case 197:return new a.Vj(d);case 550:return new a.pe(d);case 1607:return new a.Xa(d);case 1736:return new a.Ka(d);default:throw a.g.ra("invalid argument.");}};return k}();
a.sH=k})(x||(x={}));(function(a){var k=function(){function k(e,d){this.De=a.ga.Yc(e,-1);this.oa=new a.Ur;this.tk=d}k.prototype.wR=function(e){this.oa.Dr(Math.min(this.De.size,e));this.oa.$l(e)};k.prototype.addElement=function(e,d){if(void 0===d)return this.JJ(e);d=a.I.truncate(d%this.De.size);var g=this.De.get(d);-1==g&&(g=this.oa.jh(),this.De.set(d,g));return this.oa.addElement(g,e)};k.prototype.JJ=function(e){var d=this.tk.vw(e),d=a.I.truncate(d%this.De.size),g=this.De.get(d);-1==g&&(g=this.oa.jh(),
this.De.set(d,g));return this.oa.addElement(g,e)};k.prototype.Jc=function(e,d){if(void 0===d)this.dM(e);else{d=a.I.truncate(d%this.De.size);var g=this.De.get(d);if(-1==g)throw a.g.N();for(var m=this.oa.gc(g),k=-1;-1!=m;){var b=this.oa.bb(m);this.oa.da(m)==e?(this.oa.Jc(g,k,m),-1==this.oa.gc(g)&&(this.oa.Fg(g),this.De.set(d,-1))):k=m;m=b}}};k.prototype.dM=function(e){var d=this.tk.vw(e),d=a.I.truncate(d%this.De.size),g=this.De.get(d);if(-1==g)throw a.g.N();for(var m=this.oa.gc(g),k=-1;-1!=m;){var b=
this.oa.bb(m);this.oa.da(m)==e?(this.oa.Jc(g,k,m),-1==this.oa.gc(g)&&(this.oa.Fg(g),this.De.set(d,-1))):k=m;m=b}};k.prototype.DN=function(e){e=a.I.truncate(e%this.De.size);e=this.De.get(e);return-1==e?-1:this.oa.gc(e)};k.prototype.SN=function(e){return this.oa.bb(e)};k.prototype.kd=function(e){var d=this.tk.vw(this.da(e)),d=a.I.truncate(d%this.De.size),g=this.De.get(d);if(-1==g)throw a.g.N();for(var m=this.oa.gc(g),k=-1;-1!=m;){if(m==e){this.oa.Jc(g,k,m);-1==this.oa.gc(g)&&(this.oa.Fg(g),this.De.set(d,
-1));return}k=m;m=this.oa.bb(m)}throw a.g.N();};k.prototype.da=function(e){return this.oa.da(e)};k.prototype.clear=function(){this.De=a.ga.Yc(this.De.size,-1);this.oa.clear()};k.prototype.size=function(){return this.oa.HC()};return k}();a.AH=k})(x||(x={}));(function(a){var k=function(){function k(){this.ci=new a.Fc(3);this.oa=new a.Fc(6);this.AP=!1;this.Wd=-1}k.prototype.bk=function(e){this.ci.Jc(e)};k.prototype.ou=function(){return this.ci.be()};k.prototype.Rs=function(e){this.oa.Jc(e)};k.prototype.Yx=
function(){return this.oa.be()};k.prototype.Jy=function(e,d){this.ci.L(e,1,d)};k.prototype.Gu=function(e,d){this.ci.L(e,2,d)};k.prototype.aS=function(e,d){this.ci.L(e,3,d)};k.prototype.Hy=function(e,d){this.oa.L(e,4,d)};k.prototype.dS=function(e,d){this.oa.L(e,3,d)};k.prototype.RF=function(e,d){this.oa.L(e,2,d)};k.prototype.jh=function(e){var d=this.Yx();this.oa.L(d,3,this.Wd);this.oa.L(d,4,0);this.oa.L(d,5,e);-1!=this.Wd&&this.RF(this.Wd,d);return this.Wd=d};k.prototype.Fg=function(e){this.CB(e);
var d=this.oa.O(e,2),g=this.oa.O(e,3);-1!=d?this.dS(d,g):this.Wd=g;-1!=g&&this.RF(g,d);this.Rs(e);return g};k.prototype.Dr=function(e){this.oa.de(e)};k.prototype.DC=function(e){return this.oa.O(e,5)};k.prototype.$R=function(e,d){this.oa.L(e,5,d)};k.prototype.addElement=function(e,d){return this.AO(e,d)};k.prototype.AO=function(e,d){var g=this.ou();this.Gu(g,-1);-1==this.oa.O(e,0)&&this.oa.L(e,0,g);var a=this.oa.O(e,1);this.Jy(g,a);-1!=a&&this.Gu(a,g);this.oa.L(e,1,g);this.setData(g,d);this.Hy(e,this.vq(e)+
1);this.AP&&this.aS(g,e);return g};k.prototype.Jc=function(e,d){var g=this.ge(d),a=this.bb(d);-1!=g?this.Gu(g,a):this.oa.L(e,0,a);-1!=a?this.Jy(a,g):this.oa.L(e,1,g);this.bk(d);this.Hy(e,this.vq(e)-1);return a};k.prototype.$l=function(e){this.ci.de(e)};k.prototype.getData=function(e){return this.ci.O(e,0)};k.prototype.setData=function(e,d){this.ci.L(e,0,d)};k.prototype.bb=function(e){return this.ci.O(e,2)};k.prototype.ge=function(e){return this.ci.O(e,1)};k.prototype.gc=function(e){return this.oa.O(e,
0)};k.prototype.tc=function(e){return this.oa.O(e,1)};k.prototype.clear=function(){for(var e=this.Wd;-1!=e;)e=this.Fg(e)};k.prototype.CB=function(e){for(var d=this.tc(e);-1!=d;){var g=d,d=this.ge(g);this.bk(g)}this.oa.L(e,0,-1);this.oa.L(e,1,-1);this.Hy(e,0)};k.prototype.s=function(){return 0==this.ci.size};k.prototype.HC=function(){return this.ci.size};k.prototype.vq=function(e){return this.oa.O(e,4)};k.prototype.Cw=function(e){return this.oa.O(e,3)};return k}();a.$n=k})(x||(x={}));(function(a){var k=
function(){function k(e){void 0===e?(this.bg=new a.Fc(2),this.oa=new a.Fc(4),this.Wd=-1,this.Bt=!0):(this.bg=new a.Fc(2),this.oa=new a.Fc(e?4:2),this.Wd=-1,this.Bt=e)}k.prototype.bk=function(e){this.bg.Jc(e)};k.prototype.ou=function(){return this.bg.be()};k.prototype.Rs=function(e){this.oa.Jc(e)};k.prototype.Yx=function(){return this.oa.be()};k.prototype.jh=function(){var e=this.Yx();this.Bt&&(this.oa.L(e,3,this.Wd),-1!=this.Wd&&this.oa.L(this.Wd,2,e),this.Wd=e);return e};k.prototype.Fg=function(e){for(var d=
this.gc(e);-1!=d;){var g=d,d=this.bb(d);this.bk(g)}this.Bt&&(d=this.oa.O(e,2),g=this.oa.O(e,3),-1!=d?this.oa.L(d,3,g):this.Wd=g,-1!=g&&this.oa.L(g,2,d));this.Rs(e)};k.prototype.Dr=function(e){this.oa.de(e)};k.prototype.addElement=function(e,d){var g=this.oa.O(e,1),a=this.ou();-1!=g?this.bg.L(g,1,a):this.oa.L(e,0,a);this.oa.L(e,1,a);this.bg.L(a,0,d);return a};k.prototype.$l=function(e){this.bg.de(e)};k.prototype.Jc=function(e,d,g){-1!=d?(this.bg.L(d,1,this.bg.O(g,1)),this.oa.O(e,1)==g&&this.oa.L(e,
1,d)):(this.oa.L(e,0,this.bg.O(g,1)),this.oa.O(e,1)==g&&this.oa.L(e,1,-1));this.bk(g)};k.prototype.Qv=function(e,d){var g=this.oa.O(e,1),a=this.oa.O(d,0);-1!=a&&(-1!=g?this.bg.L(g,1,a):this.oa.L(e,0,a),this.oa.L(e,1,this.oa.O(d,1)));this.Bt&&(g=this.oa.O(d,2),a=this.oa.O(d,3),-1!=g?this.oa.L(g,3,a):this.Wd=a,-1!=a&&this.oa.L(a,2,g));this.Rs(d)};k.prototype.da=function(e){return this.bg.O(e,0)};k.prototype.Vi=function(e,d){this.bg.L(e,0,d)};k.prototype.bb=function(e){return this.bg.O(e,1)};k.prototype.gc=
function(e){return this.oa.O(e,0)};k.prototype.Dm=function(e){return this.da(this.gc(e))};k.prototype.clear=function(){this.bg.Nh(!0);this.oa.Nh(!0);this.Wd=-1};k.prototype.s=function(e){return void 0===e?0==this.bg.size:-1==this.oa.O(e,0)};k.prototype.HC=function(){return this.bg.size};k.prototype.Cw=function(e){return this.oa.O(e,3)};return k}();a.Ur=k})(x||(x={}));(function(a){var k=function(){function k(){}k.kz=function(e,d,g,m,v,b,c){var n=new a.b;n.J(e);e=new a.b;e.J(d);v.vv(n);v.vv(e);d=v.ms(n);
var D=v.ms(e);0==D&&(D=v.CC());if(n.x!=e.x&&(n.y!=e.y||n.y!=v.C&&n.y!=v.G)||D>d!=b){d=v.vA(n);var D=v.vA(e),h,l=b?1:3;do d=d+l&3,h=v.vu(d),0!=c&&(m=k.kz(n,h,g,m,v,b,c)),g[m++].ma(h.x,h.y),n=h;while((d&3)!=D);0!=c&&(m=k.kz(n,e,g,m,v,b,c))}else if(v=new a.b,v.ma(e.x-n.x,e.y-n.y),0!=c&&(c=a.I.truncate(v.yJ()/c),0<c))for(v.scale(1/(c+1)),b=0;b<c;b++)n.add(v),g[m++].ma(n.x,n.y);return m};k.zd=function(e,d,g){d=d.lv();e=null!=e&&void 0!==e.Ko?e.Ko():0;g&&(d*=4,e*=1.1);return Math.max(e,d)};k.As=function(e){return 2*
Math.sqrt(2)*e};k.UJ=function(e){return Math.sqrt(2)*e};k.Cg=function(e,d,g){var m=new a.i;d.o(m);return k.zd(e,m,g)};k.rB=function(e,d,g){d=d.Ah(1,0).lv();e=null!=e?e.Ko():0;g&&(d*=4,e*=1.1);return Math.max(e,d)};k.$T=function(e,d){var g=new a.i;e.dd(g);g.Db(d);return g};k.$s=function(e,d){var g=new a.i;e.dd(g);e=new a.i;d.dd(e);g.Db(e);return g};k.fU=function(e,d){var g=e.HN(d),m=e.Ea(d),k=e.Dc(d),b=e.Fa(g);g==m?(k=e.Fa(k-1),g=e.Fa(m+1)):g==k-1?(k=e.Fa(g-1),g=e.Fa(m)):(k=e.Fa(g-1),g=e.Fa(g+1));
b=a.b.yn(k,b,g);return 0==b?0<e.oo(d):-1==b};k.CK=function(e){var d=new a.i;e.dd(d);if(d.s())return null;var g=new a.co(d,8),m=-1,k=new a.i,b=!1;do for(var c=0,n=e.ea();c<n;c++)if(e.Ti(c,k),m=g.kt(c,k,m),-1==m){if(b)throw a.g.ra("internal error");e.tm(d,!1);b=!0;g.reset(d,8);break}else b=!1;while(b);return g};k.nB=function(e){var d=new a.i;e.dd(d);for(var g=new a.co(d,8),m=-1,k=e.Ca(),b=new a.i,c=!1;k.kb();)for(;k.La();){var n=k.ia(),h=k.Jb();n.o(b);m=g.kt(h,b,m);if(-1==m){if(c)throw a.g.wa();e.tm(d,
!1);c=!0;g.reset(d,8);k.Lk();break}}return g};k.ij=function(e,d){var g=new a.i;e.dd(g);for(var m=new a.co(g,8),k=-1,b=new a.i,c=e.Ca(),n=!1;c.kb();)for(;c.La();){var h=c.ia(),l=c.Jb();h.o(b);if(b.jc(d)&&(k=m.kt(l,b,k),-1==k)){if(n)throw a.g.ra("internal error.");e.tm(g,!1);n=!0;m.reset(g,8);c.Lk();break}}return m};k.DT=function(e){var d=new a.i;e.dd(d);for(var g=new a.co(d,8),m=new a.b,k=new a.i,b=!1,c=0;c<e.F();c++)if(e.w(c,m),k.K(m),-1==g.lg(c,k)){if(b)throw a.g.wa();e.tm(d,!1);b=!0;g.reset(d,8);
c=-1}return g};k.oB=function(e,d){for(var g=new a.co(d,8),m=new a.b,k=!1,b=new a.i,c=0;c<e.F();c++)if(e.w(c,m),d.contains(m)&&(b.K(m),-1==g.lg(c,b))){if(k)throw a.g.wa();k=!0;c=new a.i;e.tm(c,!1);g.reset(c,8);c=-1}return g};k.AN=function(e,d,g){var m=new a.i,k=new a.i;e.dd(m);d.dd(k);m.P(g,g);k.P(g,g);var b=new a.i;b.K(m);b.Ga(k);e=e.Ca();d=d.Ca();var c=new a.sz;c.YF(g);var n=!1;for(c.jG();e.kb();)for(;e.La();)e.ia().o(m),m.jc(b)&&(n=!0,g=new a.i,g.K(m),c.OA(e.Jb(),g));c.$B();if(!n)return null;m=
!1;for(c.iG();d.kb();)for(;d.La();)d.ia().o(k),k.jc(b)&&(m=!0,g=new a.i,g.K(k),c.LA(d.Jb(),g));c.ZB();return m?c:null};k.BN=function(e,d,g,m,k){var b=e.D(),v=d.D(),c=new a.i,n=new a.i;e.dd(c);d.dd(n);c.P(g,g);n.P(g,g);var h=new a.i;h.K(c);h.Ga(n);var l=new a.sz;l.YF(g);var q=!1;l.jG();var u=0;for(g=e.ea();u<g;u++)if(!m||1736!=b||e.qt(u))e.Ti(u,c),c.jc(h)&&(q=!0,l.OA(u,c));l.$B();if(!q)return null;e=!1;l.iG();m=0;for(g=d.ea();m<g;m++)if(!k||1736!=v||d.qt(m))d.Ti(m,n),n.jc(h)&&(e=!0,l.LA(m,n));l.ZB();
return e?l:null};k.hU=function(e,d){return 0<e.rj(d)};k.zT=function(e,d){var g=new a.i;e.hR(d,g);var g=new a.co(g,8),m=-1,k=new a.i;e=e.Ca();e.vy(d);if(e.kb())for(;e.La();){d=e.ia();var b=e.Jb();d.dd(k);m=g.kt(b,k,m);if(-1==m)throw a.g.ra("internal error");}return g};return k}();a.Ia=k})(x||(x={}));(function(a){var k=function(){function d(d){this.Na=d}d.prototype.compare=function(d,e,a){d=d.da(a);a=this.Na.uj(e);var m=this.Na.uj(d);return a<m?-1:a==m?g.Po(e)&&g.st(d)?-1:g.Po(d)&&g.st(e)?1:0:1};return d}(),
b=function(){function d(d){this.Na=d}d.prototype.Zp=function(d,e,g){this.Na.yS(g,d,e)};d.prototype.Mo=function(d){return this.Na.uj(d)};return d}(),e;(function(d){d[d.initialize=0]="initialize";d[d.pIn=1]="pIn";d[d.pL=2]="pL";d[d.pR=3]="pR";d[d.pT=4]="pT";d[d.right=5]="right";d[d.left=6]="left";d[d.all=7]="all"})(e||(e={}));var d=function(){function d(){this.Na=null;this.gi=new a.Nd;this.ug=new a.ga(0);this.$f=[0,0]}d.prototype.Ch=function(d,e){this.gi.qa=d.qa-e;this.gi.va=d.va+e;this.ug.resize(0);
this.Ud=0;this.$f[0]=0};d.prototype.uy=function(d,e,g){if(d>e)throw a.g.N();this.gi.qa=d-g;this.gi.va=e+g;this.ug.resize(0);this.Ud=0;this.$f[0]=0};d.prototype.Fn=function(d,e){this.gi.qa=d-e;this.gi.va=d+e;this.ug.resize(0);this.Ud=0;this.$f[0]=0};d.prototype.next=function(){if(!this.Na.Vo)throw a.g.xa();if(0>this.Ud)return-1;for(var d=!0;d;)switch(this.$f[this.Ud]){case 1:d=this.uQ();break;case 2:d=this.vQ();break;case 3:d=this.wQ();break;case 4:d=this.xQ();break;case 5:d=this.BR();break;case 6:d=
this.sP();break;case 7:d=this.XJ();break;case 0:d=this.Qw();break;default:throw a.g.wa();}return-1!=this.pg?this.Bo()>>1:-1};d.JT=function(e,g,a){var m=new d;m.Na=e;m.ug.xb(20);m.Ch(g,a);return m};d.KT=function(e,g,a){var m=new d;m.Na=e;m.ug.xb(20);m.Fn(g,a);return m};d.Oa=function(e){var g=new d;g.Na=e;g.ug.xb(20);g.Ud=-1;return g};d.prototype.Qw=function(){this.pg=this.YD=this.di=this.yc=-1;if(null!=this.Na.Yd&&0<this.Na.Yd.size)return this.$f[0]=1,this.di=this.Na.Ze,!0;this.Ud=-1;return!1};d.prototype.uQ=
function(){this.yc=this.di;if(-1==this.yc)return this.pg=this.Ud=-1,!1;var d=this.Na.Co(this.yc);if(this.gi.va<d)return d=this.Na.tj(this.yc),this.di=this.Na.Di(this.yc),-1!=d&&(this.vh=this.Na.gk(d),this.$f[++this.Ud]=6),!0;if(d<this.gi.qa)return d=this.Na.tj(this.yc),this.di=this.Na.sj(this.yc),-1!=d&&(this.vh=this.Na.uq(d),this.$f[++this.Ud]=5),!0;this.$f[this.Ud]=2;this.YD=this.yc;d=this.Na.tj(this.yc);this.di=this.Na.Di(this.yc);-1!=d&&(this.vh=this.Na.gk(d),this.$f[++this.Ud]=7);return!0};d.prototype.vQ=
function(){this.yc=this.di;if(-1==this.yc)return this.$f[this.Ud]=3,this.di=this.Na.sj(this.YD),!0;if(this.Na.Co(this.yc)<this.gi.qa){var d=this.Na.tj(this.yc);this.di=this.Na.sj(this.yc);-1!=d&&(this.vh=this.Na.uq(d),this.$f[++this.Ud]=5);return!0}d=this.Na.tj(this.yc);this.di=this.Na.Di(this.yc);-1!=d&&(this.vh=this.Na.gk(d),this.$f[++this.Ud]=7);d=this.Na.sj(this.yc);-1!=d&&this.ug.add(d);return!0};d.prototype.wQ=function(){this.yc=this.di;if(-1==this.yc)return this.$f[this.Ud]=4,!0;if(this.gi.va<
this.Na.Co(this.yc)){var d=this.Na.tj(this.yc);this.di=this.Na.Di(this.yc);-1!=d&&(this.vh=this.Na.gk(d),this.$f[++this.Ud]=6);return!0}d=this.Na.tj(this.yc);this.di=this.Na.sj(this.yc);-1!=d&&(this.vh=this.Na.gk(d),this.$f[++this.Ud]=7);d=this.Na.Di(this.yc);-1!=d&&this.ug.add(d);return!0};d.prototype.xQ=function(){if(0==this.ug.size)return this.pg=this.Ud=-1,!1;this.yc=this.ug.get(this.ug.size-1);this.ug.resize(this.ug.size-1);var d=this.Na.tj(this.yc);-1!=d&&(this.vh=this.Na.gk(d),this.$f[++this.Ud]=
7);-1!=this.Na.Di(this.yc)&&this.ug.add(this.Na.Di(this.yc));-1!=this.Na.sj(this.yc)&&this.ug.add(this.Na.sj(this.yc));return!0};d.prototype.sP=function(){this.pg=this.vh;if(-1!=this.pg&&g.Po(this.Bo())&&this.Na.uj(this.Bo())<=this.gi.va)return this.vh=this.GC(),!1;this.Ud--;return!0};d.prototype.BR=function(){this.pg=this.vh;if(-1!=this.pg&&g.st(this.Bo())&&this.Na.uj(this.Bo())>=this.gi.qa)return this.vh=this.bO(),!1;this.Ud--;return!0};d.prototype.XJ=function(){this.pg=this.vh;if(-1!=this.pg&&
g.Po(this.Bo()))return this.vh=this.GC(),!1;this.Ud--;return!0};d.prototype.GC=function(){return this.Na.Df?this.Na.If.bb(this.pg):this.Na.ki.bb(this.pg)};d.prototype.bO=function(){return this.Na.Df?this.Na.If.ge(this.pg):this.Na.ki.ge(this.pg)};d.prototype.Bo=function(){return this.Na.Df?this.Na.If.da(this.pg):this.Na.ki.getData(this.pg)};return d}();a.IT=d;var g=function(){function e(d){this.Al=this.rh=this.If=this.ki=this.Hl=this.Ki=this.Yd=this.Li=null;this.Df=d;this.Vo=this.Dt=!1}e.prototype.Vp=
function(){this.Rj(!0)};e.prototype.gq=function(d,e){if(!this.Dt)throw a.g.xa();this.Li.push(new a.Nd(d,e))};e.prototype.wo=function(){if(!this.Dt)throw a.g.ra("invalid call");this.Dt=!1;this.Vo=!0;this.Df||(this.BO(),this.Jt=this.Li.length)};e.prototype.lg=function(d){if(!this.Df||!this.Vo)throw a.g.N("invalid call");if(-1==this.Ze){var e=this.Li.length;if(this.nx){var g=new a.ga(0);g.xb(2*e);this.$E(g);this.rh.xb(2*e);this.rh.resize(0);this.ZE(g);this.Hl.resize(e,-1);this.Hl.dh(-1,0,e);this.nx=
!1}else this.Hl.dh(-1,0,e);this.Ze=this.Ms()}e=this.cD(d<<1,this.Ze);g=this.If.addElement((d<<1)+1,this.Hw(e));this.TF(e,g);this.Hl.set(d,e);this.Jt++};e.prototype.remove=function(d){if(!this.Df||!this.Vo)throw a.g.ra("invalid call");var e=this.Hl.get(d);if(-1==e)throw a.g.N("the interval does not exist in the interval tree");this.Hl.set(d,-1);this.Jt--;var g=this.Hw(e),m;m=this.If.hO(g);this.If.kd(this.LN(e),g);this.If.kd(this.eO(e),g);d=this.If.size(g);0==d&&(this.If.fM(g),this.WF(m,-1));this.Ki.Jc(e);
for(var g=this.JC(m),k=this.Di(m),b=this.sj(m),e=0;!(0<d||m==this.Ze||-1!=k&&-1!=b);)m==this.Di(g)?-1!=k?(this.Sj(g,k),this.Xi(k,g),this.Sj(m,-1)):-1!=b?(this.Sj(g,b),this.Xi(b,g),this.Uj(m,-1)):this.Sj(g,-1):-1!=k?(this.Uj(g,k),this.Xi(k,g),this.Sj(m,-1)):-1!=b?(this.Uj(g,b),this.Xi(b,g),this.Uj(m,-1)):this.Uj(g,-1),this.Xi(m,-1),e++,m=g,g=this.tj(m),d=-1!=g?this.If.size(g):0,k=this.Di(m),b=this.sj(m),g=this.JC(m)};e.prototype.reset=function(){if(!this.Df||!this.Vo)throw a.g.N("invalid call");this.Rj(!1)};
e.prototype.size=function(){return this.Jt};e.prototype.Re=function(){return d.Oa(this)};e.prototype.$E=function(d){for(var e=this.Li.length,g=0;g<2*e;g++)d.add(g);this.zS(d,2*e)};e.prototype.ZE=function(d){for(var e=NaN,g=0;g<d.size;g++){var a=d.get(g),m=this.uj(a);m!=e&&(this.rh.add(a),e=m)}};e.prototype.BO=function(){var d=this.Li.length,e=new a.ga(0);e.xb(2*d);this.$E(e);this.rh.xb(2*d);this.rh.resize(0);this.ZE(e);this.Ki.de(d);this.ki.$l(2*d);var g=a.Ac.Dg(d);g.dh(-1,0,d);this.Ze=this.Ms();
for(d=0;d<e.size;d++){var m=e.get(d),k=g.get(m>>1);-1!=k?this.TF(k,this.ki.addElement(this.Hw(k),m)):(k=this.cD(m,this.Ze),g.set(m>>1,k))}};e.prototype.cD=function(d,e){var g=e,m=e,k,b=-1,v=0,c=this.rh.size-1,n=0,D=d>>1,h=NaN,l=NaN;k=!0;for(var q=this.RN(D),D=this.ON(D);k;){v<c?(n=v+a.I.truncate((c-v)/2),-1==this.rw(g)&&this.CF(g,this.rh.get(n),this.rh.get(n+1))):-1==this.rw(g)&&this.CF(g,this.rh.get(v),this.rh.get(v));var u=this.Co(g);if(D<u)-1!=e&&(e==g?(m=g,h=u,e=this.Di(g),-1!=e?l=this.Co(e):
l=NaN):l>u&&(u<h?this.Sj(m,g):this.Uj(m,g),this.Uj(g,e),this.Df&&(this.Xi(g,m),this.Xi(e,g)),m=g,h=u,e=-1,l=NaN)),c=this.MN(g),-1==c&&(c=this.Ms(),this.YR(g,c)),g=c,c=n;else if(q>u)-1!=e&&(e==g?(m=g,h=u,e=this.sj(g),-1!=e?l=this.Co(e):l=NaN):l<u&&(u<h?this.Sj(m,g):this.Uj(m,g),this.Sj(g,e),this.Df&&(this.Xi(g,m),this.Xi(e,g)),m=g,h=u,e=-1,l=NaN)),v=this.fO(g),-1==v&&(v=this.Ms(),this.iS(g,v)),g=v,v=n+1;else{k=this.tj(g);-1==k&&(k=this.TL(g),this.WF(g,k));var f=this.KJ(k,d),b=this.SL();this.lS(b,k);
this.XR(b,f);g!=e&&(u<h?this.Sj(m,g):this.Uj(m,g),this.Df&&this.Xi(g,m),-1!=e&&(l<u?this.Sj(g,e):this.Uj(g,e),this.Df&&this.Xi(e,g)));k=!1}}return b};e.prototype.Ms=function(){return this.Yd.be()};e.prototype.TL=function(d){return this.Df?this.If.nq(d):this.ki.jh(d)};e.prototype.SL=function(){return this.Ki.be()};e.prototype.Rj=function(d){d?(this.Dt=this.nx=!0,this.Vo=!1,null==this.rh?this.rh=a.Ac.Dg(0):this.rh.resize(0),null==this.Li?this.Li=[]:this.Li.length=0):this.nx=!1;this.Df?null==this.Hl?
(this.Hl=a.Ac.Dg(0),this.If=new a.bj,this.If.Hn(new k(this))):this.If.clear():null==this.ki?this.ki=new a.$n:this.ki.clear();null==this.Yd?(this.Ki=new a.Fc(3),this.Yd=new a.Fc(this.Df?8:7)):(this.Ki.Nh(!1),this.Yd.Nh(!1));this.Ze=-1;this.Jt=0};e.prototype.CF=function(d,e,g){this.SR(d,e);this.TR(d,g)};e.prototype.Co=function(d){var e=this.rw(d);if(-1==e)return NaN;e=this.uj(e);d=this.uj(this.wN(d));return e==d?e:.5*(e+d)};e.prototype.SR=function(d,e){this.Yd.L(d,0,e)};e.prototype.TR=function(d,e){this.Yd.L(d,
1,e)};e.prototype.YR=function(d,e){this.Yd.L(d,3,e)};e.prototype.iS=function(d,e){this.Yd.L(d,4,e)};e.prototype.WF=function(d,e){this.Yd.L(d,2,e)};e.prototype.Sj=function(d,e){this.Yd.L(d,5,e)};e.prototype.Uj=function(d,e){this.Yd.L(d,6,e)};e.prototype.Xi=function(d,e){this.Yd.L(d,7,e)};e.prototype.lS=function(d,e){this.Ki.L(d,0,e)};e.prototype.KJ=function(d,e){return this.Df?this.If.addElement(e,d):this.ki.addElement(d,e)};e.prototype.XR=function(d,e){this.Ki.L(d,1,e)};e.prototype.TF=function(d,
e){this.Ki.L(d,2,e)};e.prototype.gk=function(d){return this.Df?this.If.gc(d):this.ki.gc(d)};e.prototype.uq=function(d){return this.Df?this.If.tc(d):this.ki.tc(d)};e.Po=function(d){return 0==(d&1)};e.st=function(d){return 1==(d&1)};e.prototype.rw=function(d){return this.Yd.O(d,0)};e.prototype.wN=function(d){return this.Yd.O(d,1)};e.prototype.tj=function(d){return this.Yd.O(d,2)};e.prototype.MN=function(d){return this.Yd.O(d,3)};e.prototype.fO=function(d){return this.Yd.O(d,4)};e.prototype.Di=function(d){return this.Yd.O(d,
5)};e.prototype.sj=function(d){return this.Yd.O(d,6)};e.prototype.JC=function(d){return this.Yd.O(d,7)};e.prototype.Hw=function(d){return this.Ki.O(d,0)};e.prototype.LN=function(d){return this.Ki.O(d,1)};e.prototype.eO=function(d){return this.Ki.O(d,2)};e.prototype.RN=function(d){return this.Li[d].qa};e.prototype.ON=function(d){return this.Li[d].va};e.prototype.zS=function(d,e){null==this.Al&&(this.Al=new a.Rr);var g=new b(this);this.Al.sort(d,0,e,g)};e.prototype.yS=function(d,g,a){var m=this;d.xd(g,
a,function(d,g){var a=m.uj(d),k=m.uj(g);return a<k||a==k&&e.Po(d)&&e.st(g)?-1:1})};e.prototype.uj=function(d){var g=this.Li[d>>1];return e.Po(d)?g.qa:g.va};return e}();a.bq=g})(x||(x={}));(function(a){var k=function(k){function e(d,e,m,b){k.call(this);void 0===d?this.description=a.Od.Tf():void 0===m?this.description=d:(this.description=a.Od.Tf(),this.Ny(d,e),this.Ok(m,b))}A(e,k);e.prototype.D=function(){return 322};e.prototype.$b=function(){var d=this.na-this.la,e=this.ja-this.ha;return Math.sqrt(d*
d+e*e)};e.prototype.mg=function(d){var e=this.na-this.la,a=this.ja-this.ha;return Math.sqrt(e*e+a*a)<=d};e.prototype.mD=function(){return!1};e.prototype.Pf=function(){var d=new a.b;d.pc(this.oc(),this.Mb());return d};e.prototype.Fp=function(d){d.Ja();d.Qf(this.description);var e=new a.i;this.o(e);d.Cu(e);for(var e=1,m=this.description.Aa;e<m;e++)for(var k=this.description.Hd(e),b=a.pa.Wa(k);e<b;e++){var c=this.Ah(k,0);d.setInterval(k,0,c)}};e.prototype.o=function(d){d.K(this.na,this.ja,this.la,this.ha);
d.normalize()};e.prototype.Cn=function(d){d.Ja();d.Db(this.na,this.ja,this.yd(0,1,0));d.Db(this.la,this.ha,this.yd(1,1,0))};e.prototype.Oe=function(d){if(d instanceof a.Bg){this.qc();var e=new a.b;e.x=this.na;e.y=this.ja;d.Zi(e,e);this.na=e.x;this.ja=e.y;e.x=this.la;e.y=this.ha;d.Zi(e,e);this.la=e.x;this.ha=e.y}else this.qc(),e=new a.ee,e.x=this.na,e.y=this.ja,e.z=this.yd(0,1,0),e=d.Qn(e),this.na=e.x,this.ja=e.y,this.om(0,1,0,e.z),e.x=this.la,e.y=this.ha,e.z=this.yd(1,1,0),e=d.Qn(e),this.la=e.x,this.ha=
e.y,this.om(1,1,0,e.z)};e.prototype.Pa=function(){return new e(this.description)};e.prototype.kv=function(d,e){return(this.la-d-(this.na-d))*(this.ha-e+(this.ja-e))*.5};e.prototype.Ru=function(d){return d*this.$b()};e.prototype.AD=function(d){return d/this.$b()};e.prototype.sC=function(d){return a.vi.ut(this.na,this.la,d)};e.prototype.vN=function(d){return a.vi.ut(this.ja,this.ha,d)};e.prototype.xm=function(d,e){var g=new a.Ag;this.Bi(d,e,g);return g.get()};e.prototype.Bi=function(d,e,m){if(null==
m)throw a.g.N();m.mq();m=m.get();m.Qf(this.description);var g=new a.b;this.Kb(d,g);m.Ny(g.x,g.y);this.Kb(e,g);m.Ok(g.x,g.y);for(var g=1,k=this.description.Aa;g<k;g++)for(var b=this.description.Fd(g),c=a.pa.Wa(b),n=0;n<c;n++){var h=this.ld(d,b,n);m.My(b,n,h);h=this.ld(e,b,n);m.Cy(b,n,h)}};e.prototype.ld=function(d,e,m){if(0==e)return 0==m?this.Kb(d).x:this.Kb(d).y;switch(a.pa.JN(e)){case 0:return.5>d?this.gt(e,m):this.Ws(e,m);case 1:var g=this.gt(e,m);e=this.Ws(e,m);return a.vi.ut(g,e,d);case 2:throw a.g.ra("not implemented");
}throw a.g.wa();};e.prototype.Gd=function(d,e){var g=this.la-this.na,a=this.ha-this.ja,k=g*g+a*a;if(0==k)return.5;g=((d.x-this.na)*g+(d.y-this.ja)*a)/k;e||(0>g?g=0:1<g&&(g=1));return g};e.prototype.nt=function(d,e,a,k){if(d){d=this.ha-this.ja;if(0==d)return e==this.ha?-1:0;e=(e-this.ja)/d;if(0>e||1<e)return 0;null!=a&&(a[0]=this.sC(e))}else{d=this.la-this.na;if(0==d)return e==this.la?-1:0;e=(e-this.na)/d;if(0>e||1<e)return 0;null!=a&&(a[0]=this.vN(e))}null!=k&&(k[0]=e);return 1};e.prototype.xe=function(d,
e){var g=this.ha-this.ja;if(0==g)return d==this.ha?e:NaN;g=(d-this.ja)/g;d=this.sC(g);1==g&&(d=this.la);return d};e.prototype.qs=function(d,e,a){return 0<=this.ho(d.x,d.y,e,a)};e.prototype.Kh=function(d,e,a){return 0<=this.ho(d,e,a,!0)};e.prototype.Eq=function(d,e){return this.qs(d,e,!1)};e.prototype.KE=function(){if(this.ha<this.ja||this.ha==this.ja&&this.la<this.na){var d=this.na;this.na=this.la;this.la=d;d=this.ja;this.ja=this.ha;this.ha=d;for(var d=0,e=this.description.up-2;d<e;d++){var a=this.fa[d];
this.fa[d]=this.fa[d+e];this.fa[d+e]=a}}};e.prototype.rs=function(d,e){d=a.b.Oa(d,e);d.sub(this.Mb());e=new a.b;e.pc(this.oc(),this.Mb());var g=e.Ai(d);d=8.881784197001252E-16*(Math.abs(e.x*d.y)+Math.abs(e.y*d.x));return g>d?-1:g<-d?1:0};e.prototype.ho=function(d,e,m,k){var g=this.na,b=this.ja,v=d-g,c=e-b,v=Math.sqrt(v*v+c*c);if(v<=Math.max(m,6.661338147750939E-16*v))return k&&0==v?NaN:0;v=d-this.la;c=e-this.ha;v=Math.sqrt(v*v+c*c);if(v<=Math.max(m,6.661338147750939E-16*v))return k&&0==v?NaN:1;v=
this.la-this.na;c=this.ha-this.ja;k=Math.sqrt(v*v+c*c);if(0<k){var n=1/k,v=v*n,c=c*n,h=d-g,l=e-b,q=h*v+l*c,u=1.7763568394002505E-15*(Math.abs(h*v)+Math.abs(l*c)),f=v,v=-c,c=f,u=Math.max(m,u);if(q<-u||q>k+u)return NaN;if(Math.abs(h*v+l*c)<=Math.max(m,1.7763568394002505E-15*(Math.abs(h*v)+Math.abs(l*c)))&&(v=a.I.Kr(q*n,0,1),.5>=v?(c=this.na+(this.la-this.na)*v,k=this.ja+(this.ha-this.ja)*v):(c=this.la-(this.la-this.na)*(1-v),k=this.ha-(this.ha-this.ja)*(1-v)),a.b.Yv(c,k,d,e)<=m)){if(.5>v){if(a.b.Yv(c,
k,g,b)<=m)return 0}else if(a.b.Yv(c,k,this.la,this.ha)<=m)return 1;return v}}return NaN};e.prototype.lc=function(d){return null==d?!1:d==this?!0:d.constructor!==this.constructor?!1:this.sJ(d)};e.prototype.AA=function(d,e,m){var g=m?this.na:this.la;m=m?this.ja:this.ha;var k=new a.b;k.x=d.la-g;k.y=d.ha-m;return e.ml(k)>6.661338147750939E-16*e.uA(k)?(k.x=d.na-g,k.y=d.ja-m,e.ml(k)<=6.661338147750939E-16*e.uA(k)):!0};e.prototype.zA=function(d){var e=new a.b;e.x=this.la-this.na;e.y=this.ha-this.ja;if(!this.AA(d,
e,!1))return!1;e.Bp();return this.AA(d,e,!0)?!0:!1};e.ye=function(d,e){var g=d.rs(e.na,e.ja),a=d.rs(e.la,e.ha);if(0>g&&0>a||0<g&&0<a)return!1;g=e.rs(d.na,d.ja);a=e.rs(d.la,d.ha);if(0>g&&0>a||0<g&&0<a)return!1;g=d.$b();a=e.$b();return g>a?d.zA(e):e.zA(d)};e.Id=function(d,e,m){var g=a.b.Oa(NaN,NaN),k=d.la-d.na,b=d.ha-d.ja,c=e.la-e.na,n=e.ha-e.ja,h=c*b-k*n;if(0==h)return g;var l=8.881784197001252E-16*(Math.abs(c*b)+Math.abs(k*n)),q=e.na-d.na,u=e.ja-d.ja,f=c*u-q*n,A=f/h,p=Math.abs(h),c=(8.881784197001252E-16*
(Math.abs(c*u)+Math.abs(q*n))*p+l*Math.abs(f))/(h*h)+2.220446049250313E-16*Math.abs(A);if(A<-c||A>1+c)return g;n=k*u-q*b;c=n/h;k=(8.881784197001252E-16*(Math.abs(k*u)+Math.abs(q*b))*p+l*Math.abs(n))/(h*h)+2.220446049250313E-16*Math.abs(c);if(c<-k||c>1+k)return g;A=a.I.Kr(A,0,1);k=a.I.Kr(c,0,1);b=d.Kb(A);h=e.Kb(k);l=new a.b;l.pc(b,h);if(l.length()>m&&(l.add(b,h),l.scale(.5),A=d.Gd(l,!1),k=e.Gd(l,!1),d=d.Kb(A),e=e.Kb(k),d.sub(e),d.length()>m))return g;g.ma(A,k);return g};e.xJ=function(d,g,a,k){var m=
0;if(d.na==g.na&&d.ja==g.ja||d.na==g.la&&d.ja==g.ha)if(m++,!k)return 1;if(d.la==g.na&&d.ha==g.ja||d.la==g.la&&d.ha==g.ha){m++;if(2==m)return 2;if(!k)return 1}return g.Kh(d.na,d.ja,a)||g.Kh(d.la,d.ha,a)||d.Kh(g.na,g.ja,a)||d.Kh(g.la,g.ha,a)?1:k&&0!=m?0:0==e.ye(d,g)?0:1};e.ov=function(d,g,m,k,b,c){var v=0,n=d.ho(g.na,g.ja,c,!1),h=d.ho(g.la,g.ha,c,!1),D=g.ho(d.na,d.ja,c,!1),l=g.ho(d.la,d.ha,c,!1);isNaN(n)||(null!=k&&(k[v]=n),null!=b&&(b[v]=0),null!=m&&(m[v]=a.b.Oa(g.na,g.ja)),v++);isNaN(h)||(null!=k&&
(k[v]=h),null!=b&&(b[v]=1),null!=m&&(m[v]=a.b.Oa(g.la,g.ha)),v++);2==v||isNaN(D)||0==n&&0==D||0==h&&1==D||(null!=k&&(k[v]=0),null!=b&&(b[v]=D),null!=m&&(m[v]=a.b.Oa(d.na,d.ja)),v++);2==v||isNaN(l)||1==n&&0==l||1==h&&1==l||(null!=k&&(k[v]=1),null!=b&&(b[v]=l),null!=m&&(m[v]=a.b.Oa(g.la,g.ha)),v++);if(0<v)return 2==v&&null!=k&&k[0]>k[1]&&(d=k[0],k[0]=k[1],k[1]=d,null!=b&&(k=b[0],b[0]=b[1],b[1]=k),null!=m&&(b=a.b.Oa(m[0].x,m[0].y),m[0]=m[1],m[1]=b)),v;v=e.Id(d,g,c);if(isNaN(v.x))return 0;null!=m&&(m[0]=
d.Kb(v.x));null!=k&&(k[0]=v.x);null!=b&&(b[0]=v.y);return 1};e.prototype.TC=function(){return 0};e.prototype.eo=function(){};e.prototype.toString=function(){return"Line: ["+this.na.toString()+", "+this.ja.toString()+", "+this.la.toString()+", "+this.ha.toString()+"]"};return e}(a.fA);a.yb=k})(x||(x={}));(function(a){var k=function(){function a(){this.Gl=[];this.ua=-1}a.prototype.ya=function(){return this.ua};a.prototype.next=function(){if(null!=this.Gl&&0!=this.Gl.length){this.ua++;var e=this.Gl[0];
1>=this.Gl.length?this.Gl=[]:this.Gl=this.Gl.slice(1);return e}return this.Gl=null};return a}();a.MT=k})(x||(x={}));(function(a){(function(a){a[a.enumFillRuleOddEven=0]="enumFillRuleOddEven";a[a.enumFillRuleWinding=1]="enumFillRuleWinding"})(a.qI||(a.qI={}));var k=function(k){function e(d,e){k.call(this);this.Yf=!1;this.np=null;this.ap=this.bp=0;this.Uh=null;this.ng=!1;this.td=this.li=this.Fe=this.qb=this.jb=null;this.gp=this.Qa=this.cp=0;if(void 0===e)this.Yf=d,this.ng=!1,this.ta=this.ap=this.bp=
this.cp=0,this.description=a.Od.Tf();else{if(null==e)throw a.g.N();this.Yf=d;this.ng=!1;this.ta=this.ap=this.bp=this.cp=0;this.description=e}this.Uh=null;this.Qa=0}A(e,k);e.prototype.Hm=function(){return 0<this.cp};e.prototype.nv=function(){this.qc();null==this.np?this.np=new a.Va(this.description):this.np.Qf(this.description)};e.prototype.Uy=function(d,e){var g=new a.b;g.x=d;g.y=e;this.Nr(g)};e.prototype.Nr=function(d){this.nv();this.np.ic(d);this.ng=!0};e.prototype.df=function(d){if(d.s())throw a.g.N();
this.Ik(d.description);this.nv();d.copyTo(this.np);this.ng=!0};e.prototype.iv=function(){var d=1;this.ng&&(this.nv(),null==this.jb?(this.jb=a.Ac.Dg(2),this.jb.write(0,0),this.qb=a.Ac.to(2,0)):(this.jb.resize(this.jb.size+1,0),this.qb.resize(this.qb.size+1,0)),this.Yf&&this.qb.write(this.qb.size-2,1),d++);var e=this.ta;this.jb.write(this.jb.size-1,this.ta+d);this.jo(e+d);this.qb.write(this.jb.size-1,0);this.ng&&(this.Iu(e,this.np),this.ng=!1)};e.prototype.wj=function(d,e){this.iv();this.ic(this.ta-
1,d,e)};e.prototype.Lm=function(d){this.iv();this.ic(this.ta-1,d)};e.prototype.lineTo=function(d){this.iv();this.Iu(this.ta-1,d)};e.prototype.ro=function(){var d;this.Su();void 0===d&&(this.ng=!1,d=this.ea()-1);var e=this.qb.read(d);this.qb.write(d,e|1);null!=this.Fe&&(d=this.Dc(d)-1,this.Fe.write(d,1),this.li.write(d,-1))};e.$i=function(d){return e.Id[d]};e.prototype.vc=function(d){return 0!=(this.qb.read(d)&1)};e.prototype.Oo=function(d){if(this.vc(d))return!0;var e=this.Ea(d);d=this.Dc(d)-1;if(e>
d)return!1;e=this.Fa(e);d=this.Fa(d);return e.ub(d)};e.prototype.yq=function(d){return 0!=(this.qb.read(d)&2)};e.prototype.Bc=function(d,e){this.Ik(d.description);if(322==d.D()){var g=new a.Va;if(e||this.s())d.En(g),this.df(g);d.Bn(g);this.lineTo(g)}else throw a.g.wa();};e.prototype.ws=function(d){var e=0==this.ta;this.Uy(d.v,d.C);this.wj(d.v,d.G);this.wj(d.B,d.G);this.wj(d.B,d.C);this.ro();this.ng=!1;e&&this.yf(256,!1)};e.prototype.Wc=function(d,e){if(!d.s()){for(var g=0==this.ta,k=new a.Va(this.description),
b=0;4>b;b++)d.uf(e?4-b-1:b,k),0==b?this.df(k):this.lineTo(k);this.ro();this.ng=!1;g&&!e&&this.yf(256,!1)}};e.prototype.add=function(d,e){for(var g=0;g<d.ea();g++)this.Zj(d,g,!e)};e.prototype.Zj=function(d,e,a){this.Cf(-1,d,e,a)};e.prototype.lo=function(){this.Sw()};e.prototype.ys=function(d,e,m,k,b){b||0!=this.ea()||(b=!0);0>e&&(e=d.ea()-1);if(e>=d.ea()||0>m||0>k||k>d.ct(e))throw a.g.ra("index out of bounds");if(0!=k){var g=d.vc(e)&&m+k==d.ct(e);if(!g||1!=k){this.ng=!1;this.Ik(d.description);m=d.Ea(e)+
m+1;b&&(k++,m--);g&&k--;g=this.ta;this.jo(this.ta+k);this.kc();if(b){if(0==k)return;this.jb.add(this.ta);b=d.qb.read(e);b&=-5;this.Yf&&(b|=1);this.qb.write(this.qb.size-1,b);this.qb.add(0)}else this.jb.write(this.qb.size-1,this.ta);b=0;for(var v=this.description.Aa;b<v;b++){var c=this.description.Hd(b),n=a.pa.Wa(c),h=d.description.zf(c);0>h||null==d.Ba[h]?this.Ba[b].ul(n*g,a.pa.ue(c),k*n,n*g):this.Ba[b].nk(n*g,d.Ba[h],n*m,k*n,!0,n,n*g)}if(this.Hm())throw a.g.wa();if(d.yq(e))throw a.g.wa();this.ce(1993)}}};
e.prototype.Cr=function(d){this.kc();var e=this.ea();0>d&&(d=e-1);if(d>=e)throw a.g.N();for(var m=this.Ea(d),k=this.Ha(d),b=0,c=this.description.Aa;b<c;b++)if(null!=this.Ba[b]){var n=a.pa.Wa(this.description.Fd(b));this.Ba[b].oj(n*m,n*k,n*this.ta)}for(m=d+1;m<=e;m++)b=this.jb.read(m),this.jb.write(m-1,b-k);if(null==this.qb)for(m=d+1;m<=e;m++)d=this.qb.read(m),this.qb.write(m-1,d);this.jb.resize(e);this.qb.resize(e);this.ta-=k;this.rg-=k;this.ce(1993)};e.prototype.Cf=function(d,e,m,k){if(e==this)throw a.g.N();
if(m>=e.ea())throw a.g.N();var g=this.ea();if(d>g)throw a.g.N();0>d&&(d=g);0>m&&(m=e.ea()-1);this.ng=!1;this.Ik(e.description);e.kc();var b=e.Ea(m),c=e.Ha(m),v=this.ta,n=e.vc(m)&&!k?1:0;this.jo(this.ta+c);this.kc();for(var h=d<g?this.Ea(d):v,l=0,q=this.description.Aa;l<q;l++){var u=this.description.Fd(l),f=e.description.zf(u),A=a.pa.Wa(u);0<=f&&null!=e.Ba[f]?(0!=n&&this.Ba[l].nk(h*A,e.Ba[f],A*b,A,!0,A,A*v),this.Ba[l].nk((h+n)*A,e.Ba[f],A*(b+n),A*(c-n),k,A,A*(v+n))):this.Ba[l].ul(h*A,a.pa.ue(u),A*
c,A*v)}this.jb.add(v+c);for(k=g;k>=d+1;k--)b=this.jb.read(k-1),this.jb.write(k,b+c);e.yq(m);this.qb.add(0);for(k=g-1;k>=d+1;k--)g=this.qb.read(k),g&=-5,this.qb.write(k+1,g);g=e.VN().read(m);g&=-5;this.Yf&&(g|=1);this.qb.write(d,g)};e.prototype.Sw=function(){var d=-1,e=this.ea();if(d>e)throw a.g.N();0>d&&(d=e);this.ng=!1;this.kc();this.jb.add(this.ta);for(var m=e;m>=d+1;m--){var k=this.jb.read(m-1);this.jb.write(m,k+0)}this.qb.add(0);for(m=e-1;m>=d+1;m--)e=this.qb.read(m),e&=-5,this.qb.write(m+1,e);
this.Yf&&this.qb.write(d,1)};e.prototype.dD=function(d,e,m){var g=-1;0>d&&(d=this.ea());if(d>this.ea()||g>this.Ha(d)||m>e.length)throw a.g.ra("index out of bounds");if(0!=m){d==this.ea()&&(this.jb.add(this.ta),this.Yf?this.qb.add(1):this.qb.add(0));0>g&&(g=this.Ha(d));this.kc();var k=this.ta;this.jo(this.ta+m);this.kc();for(var b=0,c=this.description.Aa;b<c;b++){var n=this.description.Fd(b),h=a.pa.Wa(n);this.Ba[b].km(h*(this.Ea(d)+g+m),(k-this.Ea(d)-g)*h,this.Ba[b],h*(this.Ea(d)+g),!0,h);0==b?this.Ba[b].$p(h*
(this.Ea(d)+g),m,e,0,!0):this.Ba[b].dh(a.pa.ue(n),(this.Ea(d)+g)*h,m*h)}this.Hm()&&(this.Fe.km(this.Ea(d)+g+m,k-this.Ea(d)-g,this.Fe,this.Ea(d)+g,!0,1),this.li.km(this.Ea(d)+g+m,k-this.Ea(d)-g,this.li,this.Ea(d)+g,!0,1),this.Fe.dh(1,this.Ea(d)+g,m),this.li.dh(-1,this.Ea(d)+g,m));d+=1;for(e=this.ea();d<=e;d++)this.jb.write(d,this.jb.read(d)+m)}};e.prototype.kf=function(d,e,m){var g=this.ea();0>d&&(d=this.ea());if(d>=g||e>this.Ha(d))throw a.g.ra("index out of bounds");d==this.ea()&&(this.jb.add(this.ta),
this.Yf?this.qb.add(1):this.qb.add(0));0>e&&(e=this.Ha(d));var k=this.ta;this.jo(this.ta+1);this.kc();var b=this.Ea(d);this.Ba[0].lg(2*(b+e),m,2*k);m=1;for(var c=this.description.Aa;m<c;m++){var n=this.description.Fd(m),h=a.pa.Wa(n);this.Ba[m].ul(h*(b+e),a.pa.ue(n),h,h*k)}for(d+=1;d<=g;d++)this.jb.write(d,this.jb.read(d)+1)};e.prototype.eF=function(d,e){var g=this.ea();0>d&&(d=g-1);if(d>=g||e>=this.Ha(d))throw a.g.ra("index out of bounds");this.kc();var k=this.Ea(d);0>e&&(e=this.Ha(d)-1);k+=e;e=0;
for(var b=this.description.Aa;e<b;e++)if(null!=this.Ba[e]){var c=a.pa.Wa(this.description.Fd(e));this.Ba[e].oj(c*k,c,c*this.ta)}for(;g>=d+1;g--)k=this.jb.read(g),this.jb.write(g,k-1);this.ta--;this.rg--;this.ce(1993)};e.prototype.Rf=function(){return a.Hh.il(this,null)};e.prototype.Ja=function(){this.cp=0;this.ng=!1;this.td=this.Fe=this.li=this.qb=this.jb=null;this.EA()};e.prototype.Oe=function(d){d instanceof a.Bg?this.ZA(d,-1):this.$J(d)};e.prototype.ZA=function(d,e){if(!this.s()&&!d.XO()){this.kc();
var g=this.Ba[0],k=new a.b,b=new a.b,c,n,h;for(0>e?(c=this.Hm(),n=0,h=this.ta):(c=this.yq(e),n=this.Ea(e),h=this.Dc(e));n<h;n++){k.x=g.read(2*n);k.y=g.read(2*n+1);if(c&&(e=this.li.read(n),0<=e))switch(this.Fe.read(n)&7){case 2:b.x=this.td.read(e);b.y=this.td.read(e+1);d.Zi(b,b);this.td.write(e,b.x);this.td.write(e+1,b.y);b.x=this.td.read(e+3);b.y=this.td.read(e+4);d.Zi(b,b);this.td.write(e+3,b.x);this.td.write(e+4,b.y);break;case 4:throw a.g.wa();}d.Zi(k,k);g.write(2*n,k.x);g.write(2*n+1,k.y)}this.ce(1993)}};
e.prototype.$J=function(d){if(!this.s()){this.Ne(1);this.kc();for(var e=this.Ba[0],m=this.Ba[1],k=new a.ee,b=new a.ee,c=this.Hm(),n=0;n<this.ta;n++){k.x=e.read(2*n);k.y=e.read(2*n+1);k.z=m.read(n);if(c){var h=this.li.read(n);if(0<=h)switch(this.Fe.read(n)&7){case 2:b.x=this.td.read(h);b.y=this.td.read(h+1);b.z=this.td.read(h+2);b=d.Qn(b);this.td.write(h,b.x);this.td.write(h+1,b.y);this.td.write(h+1,b.z);b.x=this.td.read(h+3);b.y=this.td.read(h+4);b.z=this.td.read(h+5);b=d.Qn(b);this.td.write(h+3,
b.x);this.td.write(h+4,b.y);this.td.write(h+5,b.z);break;case 4:throw a.g.wa();}}k=d.Qn(k);e.write(2*n,k.x);e.write(2*n+1,k.y);m.write(n,k.z)}this.ce(1993)}};e.prototype.xv=function(){null==this.jb&&(this.jb=a.Ac.Dg(1,0),this.qb=a.Ac.to(1,0));null!=this.Fe&&(this.Fe.resize(this.rg,1),this.li.resize(this.rg,-1))};e.prototype.eo=function(d){d.ng=!1;d.cp=this.cp;d.gp=this.gp;null!=this.jb?d.jb=a.ga.lj(this.jb):d.jb=null;null!=this.qb?d.qb=a.Wk.lj(this.qb):d.qb=null;null!=this.li?d.li=a.ga.lj(this.li):
d.li=null;null!=this.Fe?d.Fe=a.Wk.lj(this.Fe):d.Fe=null;null!=this.td?d.td=a.qd.lj(this.td):d.td=null;d.bp=this.bp;d.ap=this.ap;this.gj(1024)?d.Uh=null:d.Uh=this.Uh};e.prototype.$b=function(){if(!this.gj(512))return this.bp;for(var d=this.Ca(),e=new a.av(0);d.kb();)for(;d.La();)e.add(d.ia().$b());this.bp=e.rl();this.yf(512,!1);return e.rl()};e.prototype.lc=function(d){if(d==this)return!0;if(!(d instanceof e&&k.prototype.lc.call(this,d)))return!1;var g=this.ea();return g!=d.ea()||null!=this.jb&&!this.jb.lc(d.jb,
0,g+1)||this.gp!=d.gp||null!=this.qb&&!this.qb.lc(d.qb,0,g)?!1:k.prototype.lc.call(this,d)};e.prototype.Ca=function(){return new a.GI(this)};e.prototype.wv=function(d){k.prototype.wv.call(this,d);if(this.Hm())for(d=this.Ca();d.kb();)for(;d.La();)break};e.prototype.tm=function(d,e){k.prototype.tm.call(this,d,e);if(this.Hm())for(d=this.Ca();d.kb();)for(;d.La();)break};e.prototype.qv=function(){null==this.jb||0==this.jb.size?this.ta=0:this.ta=this.jb.read(this.jb.size-1)};e.prototype.Mh=function(){if(!this.Yf)return 0;
this.ts();return this.ap};e.prototype.qt=function(d){if(!this.Yf)return!1;if(!this.gj(8))return 0!=(this.qb.read(d)&4);this.ts();return 0<this.Uh.read(d)};e.prototype.oo=function(d){if(!this.Yf)return 0;this.ts();return this.Uh.read(d)};e.prototype.ts=function(){if(this.gj(1024)){var d=this.ea();null==this.Uh?this.Uh=new a.qd(d):this.Uh.size!=d&&this.Uh.resize(d);for(var d=new a.av(0),e=new a.av(0),m=new a.b,k=0,b=this.Ca();b.kb();){e.reset();for(this.w(this.Ea(b.Qa),m);b.La();)e.add(b.ia().kv(m.x,
m.y));d.add(e.rl());var c=k++;this.Uh.write(c,e.rl())}this.ap=d.rl();this.yf(1024,!1)}};e.prototype.hl=function(){if(this.gj(8)){this.ts();var d=this.ea();if(null==this.qb||this.qb.size<d)this.qb=a.Ac.to(d+1);for(var e=1,m=0;m<d;m++){var k=this.Uh.read(m);0==m&&(e=0<k?1:-1);0<k*e?this.qb.xy(m,4):this.qb.BB(m,4)}this.yf(8,!1)}};e.prototype.Ew=function(d){var e=this.Qa,m=this.ea();if(0<=e&&e<m){if(d<this.Dc(e)){if(d>=this.Ea(e))return e;e--}else e++;if(0<=e&&e<m&&d>=this.Ea(e)&&d<this.Dc(e))return this.Qa=
e}if(5>m){for(e=0;e<m;e++)if(d<this.Dc(e))return this.Qa=e;throw a.g.ra("corrupted geometry");}e=0;for(--m;m>e;){var k=e+(m-e>>1),b=this.Ea(k);if(d<b)m=k-1;else if(e=this.Dc(k),d>=e)e=k+1;else return this.Qa=k}return this.Qa=e};e.prototype.HN=function(d){var e=this.mc(0);this.WN();var m=this.Dc(d),k=this.Ea(d);d=-1;var b=new a.b,c=new a.b;b.y=-Infinity;b.x=-Infinity;for(k+=0;k<m;k++)e.ec(2*k,c),-1==b.compare(c)&&(d=k,b.J(c));return d};e.prototype.Iw=function(){var d=this.F();if(!this.Yf)for(var d=
d-this.ea(),e=0,a=this.ea();e<a;e++)this.vc(e)&&d++;return d};e.prototype.ct=function(d){var e=this.Ha(d);this.vc(d)||e--;return e};e.prototype.Pa=function(){return new e(this.Yf,this.description)};e.prototype.fb=function(){return this.Yf?2:1};e.prototype.D=function(){return this.Yf?1736:1607};e.prototype.WN=function(){this.Su()};e.prototype.OF=function(d){this.jb=d;this.ce(16777215)};e.prototype.VN=function(){this.Su();return this.qb};e.prototype.NF=function(d){this.qb=d;this.ce(16777215)};e.prototype.ea=
function(){return null!=this.jb?this.jb.size-1:0};e.prototype.Dc=function(d){return this.jb.read(d+1)};e.prototype.Ha=function(d){return this.jb.read(d+1)-this.jb.read(d)};e.prototype.Ea=function(d){return this.jb.read(d)};e.prototype.jv=function(d,e){null==this.pb&&(this.pb=new a.Wj);e=a.dA.jR(e);var g=this.pb.hi;if(null!=g)if(g.Sx<d||e>g.cO())this.pb.uv(null);else return!0;g=a.dA.create(this,d,e);this.pb.uv(g);return!0};e.prototype.hc=function(){var d=k.prototype.hc.call(this);if(!this.sc()){var e=
this.ea();null!=this.jb&&this.jb.jj(d,0,e+1);null!=this.qb&&this.qb.jj(d,0,e)}return d};e.prototype.NC=function(d){return null!=this.Fe?this.Fe.read(d):1};e.prototype.cc=function(d,e,m){var g=this.Ew(d);if(d==this.Dc(g)-1&&!this.vc(g))throw a.g.ra("index out of bounds");this.kc();var k=this.Fe,b=1;null!=k&&(b=k.read(d)&7);switch(b){case 1:e.mq();break;case 2:throw a.g.wa();case 4:throw a.g.wa();default:throw a.g.wa();}e=e.get();m?e.Qf(a.Od.Tf()):e.Qf(this.description);g=d==this.Dc(g)-1&&this.vc(g)?
this.Ea(g):d+1;k=new a.b;this.w(d,k);e.ed(k);this.w(g,k);e.vd(k);if(!m)for(m=1,k=this.description.Aa;m<k;m++)for(var b=this.description.Fd(m),c=a.pa.Wa(b),n=0;n<c;n++){var h=this.ld(b,d,n);e.My(b,n,h);h=this.ld(b,g,n);e.Cy(b,n,h)}};e.prototype.Ti=function(d,e){if(d>=this.ea())throw a.g.N();if(this.s())e.Ja();else{if(this.yq(d))throw a.g.ra("not implemented");var g=this.mc(0),k=new a.b,b=new a.i;b.Ja();var c=this.Ea(d);for(d=this.Dc(d);c<d;c++)g.ec(2*c,k),b.Db(k);e.K(b)}};e.prototype.hR=function(d,
e){if(d>=this.ea())throw a.g.N();if(this.s())e.Ja();else{if(this.yq(d))throw a.g.ra("not implemented");var g=this.mc(0),k=new a.b,b=new a.i;b.Ja();var c=this.Ea(d);for(d=this.Dc(d);c<d;c++)g.ec(2*c,k),b.Db(k);e.K(b)}};e.prototype.dj=function(d){null==this.pb&&(this.pb=new a.Wj);if(0==d||16>this.F())return!1;d=a.Ia.nB(this);this.pb.GA(d);return!0};e.prototype.jJ=function(){null==this.pb&&(this.pb=new a.Wj);if(null!=this.pb.nn)return!0;this.pb.HA(null);var d=a.Ia.CK(this);this.pb.HA(d);return!0};e.prototype.Pp=
function(d){this.gp=d};e.prototype.Cm=function(){return this.gp};e.Id=[0,0,6,0,8,0];return e}(a.Wr);a.al=k})(x||(x={}));(function(a){var k=function(k){function e(d){k.call(this);if(void 0!==d){if(null==d)throw a.g.N();this.description=d}else this.description=a.Od.Tf();this.ta=0}A(e,k);e.prototype.Pa=function(){return new e(this.description)};e.prototype.add=function(d){this.resize(this.ta+1);this.bh(this.ta-1,d)};e.prototype.zs=function(d,e){this.resize(this.ta+1);var g=new a.b;g.ma(d,e);this.ic(this.ta-
1,g)};e.prototype.Pd=function(d,e,m){m=0>m?d.F():m;if(0>e||e>d.F()||m<e)throw a.g.N();if(e!=m){this.Ik(d.description);m-=e;var g=this.ta;this.resize(this.ta+m);this.kc();for(var k=0,b=d.description.Aa;k<b;k++){var c=d.description.Fd(k),n=a.pa.Wa(c),h=this.mc(c),c=d.mc(c);h.nk(g*n,c,e*n,m*n,!0,1,g*n)}}};e.prototype.eF=function(d){if(0>d||d>=this.F())throw a.g.ra("index out of bounds");this.kc();for(var e=0,m=this.description.Aa;e<m;e++)if(null!=this.Ba[e]){var k=a.pa.Wa(this.description.Fd(e));this.Ba[e].oj(k*
d,k,k*this.ta)}this.ta--;this.rg--;this.ce(1993)};e.prototype.resize=function(d){this.jo(d)};e.prototype.eo=function(){};e.prototype.Ja=function(){k.prototype.EA.call(this)};e.prototype.Oe=function(d){if(d instanceof a.Bg){if(!this.s()){this.kc();for(var e=this.Ba[0],m=new a.b,k=0;k<this.ta;k++)m.x=e.read(2*k),m.y=e.read(2*k+1),d.Zi(m,m),e.write(2*k,m.x),e.write(2*k+1,m.y);this.ce(1993)}}else if(!this.s()){this.kc();this.Ne(1);this.kc();for(var e=this.Ba[0],m=this.Ba[1],b=new a.ee,k=0;k<this.ta;k++){b.x=
e.read(2*k);b.y=e.read(2*k+1);b.z=m.read(k);var c=d.Qn(b);e.write(2*k,c.x);e.write(2*k+1,c.y);m.write(k,c.z)}this.ce(1993)}};e.prototype.fb=function(){return 0};e.prototype.D=function(){return 550};e.prototype.Mh=function(){return 0};e.prototype.$b=function(){return 0};e.prototype.lc=function(d){return d==this?!0:d instanceof e?k.prototype.lc.call(this,d):!1};e.prototype.fR=function(d,e){var g=this.ta,g=Math.min(g,e+1E3);if(0>e||e>=this.ta||g<e||1E3!=d.length)throw a.g.N();var k=this.mc(0),b=g-e,
c=[];k.Hp(2*e,2*b,c,0,!0);for(k=0;k<b;k++)d[k]=a.b.Oa(c[2*k],c[2*k+1]);return g};e.prototype.qv=function(){};e.prototype.xv=function(){};e.prototype.jv=function(){return!1};e.prototype.dj=function(){return!1};e.prototype.Rf=function(){return null};return e}(a.Wr);a.pe=k})(x||(x={}));(function(a){(function(a){a[a.NotDetermined=0]="NotDetermined";a[a.Structure=1]="Structure";a[a.DegenerateSegments=2]="DegenerateSegments";a[a.Clustering=3]="Clustering";a[a.Cracking=4]="Cracking";a[a.CrossOver=5]="CrossOver";
a[a.RingOrientation=6]="RingOrientation";a[a.RingOrder=7]="RingOrder";a[a.OGCPolylineSelfTangency=8]="OGCPolylineSelfTangency";a[a.OGCPolygonSelfTangency=9]="OGCPolygonSelfTangency";a[a.OGCDisconnectedInterior=10]="OGCDisconnectedInterior"})(a.NH||(a.NH={}));var k=function(){function a(e,d,g){void 0===e?(this.yh=0,this.Gk=this.Fk=-1):(this.yh=e,this.Fk=d,this.Gk=g)}a.prototype.aq=function(e){this.yh=e.yh;this.Fk=e.Fk;this.Gk=e.Gk};return a}();a.wd=k})(x||(x={}));(function(a){var k=function(){function k(){}
k.WT=function(e){if(!1===e)throw a.g.PG();};k.bG=function(e){return isNaN(e)?NaN:0===e?e:0<e?1:-1};k.Lh=function(e,d){void 0===d&&(d=0);for(var g=[],a=0;a<e;a++)g[a]=d;return g};k.Ps=function(e,d){var g,a;void 0===g&&(g=0);for(void 0===a&&(a=e.length-1);g<=a;g++)e[g]=d};k.Kr=function(e,d,g){return e<d?d:e>g?g:e};k.mU=function(){return 4};k.kg=function(e,d){var g=5381;void 0!==d?g=(d<<5)+d+(e&255):g=(g<<5)+g+(e&255);g=(g<<5)+g+(e>>8&255);g=(g<<5)+g+(e>>16&255);return(g<<5)+g+(e>>24&255)&2147483647};
k.Rh=function(){throw Error("Not Implemented");};k.iU=function(){return-Infinity};k.kU=function(){return Infinity};k.bU=function(){return 2147483647};k.QT=function(){return 2.220446049250313E-16};k.ST=function(){return 1.7976931348623157E308};k.$x=function(e){return k.JH(e)+12345&2147483647};k.FD=function(e){var d=32,g=e%k.gv|0,a=e/k.gv|0;if(0===(d&=63))return e;32>d?(e=g>>>d|a<<32-d,d=a>>d):(e=a>>d-32,d=0<=a?0:-1);return d*k.gv+(e>>>0)};k.JH=function(e){e|=0;return(1103495168*e|0)+(20077*e|0)|0};
k.truncate=function(e){return 0>e?-1*Math.floor(Math.abs(e)):Math.floor(e)};k.aH=Math.pow(2,53)-1;k.UT=-k.aH;k.pF=65536;k.zU=16777216;k.gv=k.pF*k.pF;return k}();a.I=k})(x||(x={}));(function(a){(function(a){a[a.Project=0]="Project";a[a.Union=1]="Union";a[a.Difference=2]="Difference";a[a.Proximity2D=3]="Proximity2D";a[a.Relate=4]="Relate";a[a.Equals=5]="Equals";a[a.Disjoint=6]="Disjoint";a[a.Intersects=7]="Intersects";a[a.Within=8]="Within";a[a.Contains=9]="Contains";a[a.Crosses=10]="Crosses";a[a.Touches=
11]="Touches";a[a.Overlaps=12]="Overlaps";a[a.Buffer=13]="Buffer";a[a.Distance=14]="Distance";a[a.Intersection=15]="Intersection";a[a.Clip=16]="Clip";a[a.Cut=17]="Cut";a[a.DensifyByLength=18]="DensifyByLength";a[a.DensifyByAngle=19]="DensifyByAngle";a[a.LabelPoint=20]="LabelPoint";a[a.GeodesicBuffer=21]="GeodesicBuffer";a[a.GeodeticDensifyByLength=22]="GeodeticDensifyByLength";a[a.ShapePreservingDensify=23]="ShapePreservingDensify";a[a.GeodeticLength=24]="GeodeticLength";a[a.GeodeticArea=25]="GeodeticArea";
a[a.Simplify=26]="Simplify";a[a.SimplifyOGC=27]="SimplifyOGC";a[a.Offset=28]="Offset";a[a.Generalize=29]="Generalize";a[a.SymmetricDifference=30]="SymmetricDifference";a[a.ConvexHull=31]="ConvexHull";a[a.Boundary=32]="Boundary";a[a.SimpleRelation=33]="SimpleRelation"})(a.iI||(a.iI={}));var k=function(){function k(){}k.prototype.D=function(){return null};k.NT=function(e){a.T.Th(e.D())&&(e=e.pb,null!=e&&(e.uv(null),e.GA(null)))};return k}();a.Me=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,
arguments)}A(e,k);e.prototype.D=function(){return 13};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,m,k,b){return d instanceof a.T?(b=new a.Pc(d),this.$(b,e,[m],!1,k).next()):!0===k?(m=new a.Pz(d,e,m,!1,b),a.wi.local().$(m,e,b)):new a.Pz(d,e,m,!1,b)};e.V=null;return e}(a.Me);a.Oz=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,m,k){this.ua=-1;this.ne=e;this.fx=d;this.Oq=g;this.BP=new a.i;this.BP.Ja();this.Vm=-1;this.Yb=k}k.prototype.next=function(){for(var e;null!=
(e=this.ne.next());)return this.ua=this.ne.ya(),this.Vm+1<this.Oq.length&&this.Vm++,this.buffer(e,this.Oq[this.Vm]);return null};k.prototype.ya=function(){return this.ua};k.prototype.buffer=function(e,d){return a.UG.buffer(e,d,this.fx,NaN,96,this.Yb)};return k}();a.Pz=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 16};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,m,k){return d instanceof
a.T?(d=new a.Pc(d),this.$(d,e,m,k).next()):new a.TH(d,e,m,k)};e.V=null;return e}(a.Me);a.SH=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g){this.ua=-1;if(null==e)throw a.g.N();this.R=d;this.wk=e;this.ka=a.Ia.zd(g,d,!1)}k.prototype.next=function(){var e;return null!=(e=this.wk.next())?(this.ua=this.wk.ya(),a.Ed.clip(e,this.R,this.ka,0)):null};k.prototype.ya=function(){return this.ua};return k}();a.TH=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}
A(e,k);e.prototype.D=function(){return 31};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,m){return d instanceof a.T?a.Rz.qB(d):new a.Rz(e,d,m)};e.V=null;return e}(a.Me);a.Qz=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g){this.cE=new a.Tr;this.ua=-1;if(null==d)throw a.g.N();this.zP=e;this.Ec=!1;this.wk=d;this.Yb=g}k.prototype.next=function(){if(this.zP){if(!this.Ec){var e=this.GK(this.wk);this.Ec=!0;return e}return null}if(!this.Ec){e=this.wk.next();
if(null!=e)return this.ua=this.wk.ya(),k.qB(e);this.Ec=!0}return null};k.prototype.ya=function(){return this.ua};k.prototype.GK=function(e){for(var d;null!=(d=e.next());)this.cE.Eb(d);return this.cE.sN()};k.qB=function(e){if(k.Gh(e))return e;var d=e.D();if(a.al.Lc(d))return d=new a.Xa(e.description),d.Bc(e,!0),d;if(550==d&&2==e.F()){var g=new a.Va,d=new a.Xa(e.description);e.Sd(0,g);d.df(g);e.Sd(1,g);d.lineTo(g);return d}return a.Tr.wL(e)};k.Gh=function(e){if(e.s())return!0;var d=e.D();return 33==
d||197==d?!0:a.al.Lc(d)?!1:550==d?1==e.F()?!0:!1:1607==d?1==e.ea()&&2>=e.F()?!0:!1:1!=e.ea()?!1:2>=e.F()?!0:a.Tr.sD(e,0)};return k}();a.Rz=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 17};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,m,k,b){return new a.VH(d,e,m,k,b)};e.V=null;return e}(a.Me);a.UH=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,m,k){this.Ef=null;if(null==
d||null==g)throw a.g.ra("invalid argument");this.xP=e;this.rx=d;this.RD=g;e=a.Ia.$s(d,g);this.ka=a.Ia.zd(m,e,!0);this.QD=-1;this.oe=k}k.prototype.ya=function(){return 0};k.prototype.next=function(){this.gN();return++this.QD<this.Ef.length?this.Ef[this.QD]:null};k.prototype.gN=function(){if(null==this.Ef)switch(this.Ef=[],this.rx.D()){case 1607:this.iN();break;case 1736:this.hN()}};k.prototype.iN=function(){var e=new a.Xa,d=new a.Xa,g=new a.Xa;this.Ef.push(e);this.Ef.push(d);var m=[];a.$G.YG(this.xP,
this.rx,this.RD,this.ka,m,this.oe);for(var k=0;k<m.length;k++){var b=m[k];0==b.cu?e.add(b.U,!1):1==b.cu||2==b.cu?d.add(b.U,!1):3==b.cu?this.Ef.push(b.U):g.add(b.U,!1)}g.s()||e.s()&&d.s()&&!(3<=this.Ef.length)||this.Ef.push(g);e.s()&&d.s()&&3>this.Ef.length&&(this.Ef.length=0)};k.prototype.hN=function(){var e=new a.ga(0),d=new a.fd,g=d.RB(),m=d.Eb(this.rx),k=d.Eb(this.RD),b=new a.Of;try{b.Np(d,this.ka,this.oe);b.xm(g,m,k,e);var c=d.hf(m),n=new a.Ka,h=new a.Ka;this.Ef.length=0;this.Ef.push(n);this.Ef.push(h);
for(m=0;m<e.size;m++){var l,q=new a.fd,u=q.Eb(c),f=q.Eb(d.hf(e.get(m)));b.Mp(q,this.oe);var A=b.mt(u,f);l=q.hf(A);if(!l.s()){var p=d.yC(e.get(m),g);2==p?n.add(l,!1):1==p?h.add(l,!1):this.Ef.push(l);var x=new a.fd,u=x.Eb(c),f=x.Eb(d.hf(e.get(m)));b.Mp(x,this.oe);c=x.hf(b.ll(u,f))}}!c.s()&&0<e.size&&this.Ef.push(c);n.s()&&h.s()&&(this.Ef.length=0)}finally{b.xg()}};return k}();a.VH=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 18};
e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,m){if(d instanceof a.T)return d=new a.Pc(d),this.$(d,e,m).next();if(0>=e)throw a.g.N();return new a.XH(d,e,m)};e.V=null;return e}(a.Me);a.WH=k})(x||(x={}));(function(a){var k=function(){function k(e,d){this.ua=-1;this.ne=e;this.$q=d}k.prototype.ya=function(){return this.ua};k.prototype.next=function(){var e;return null!=(e=this.ne.next())?(this.ua=this.ne.ya(),this.hM(e)):null};k.prototype.hM=function(e){if(e.s()||1>
e.fb())return e;var d=e.D();if(1736==d||1607==d)return this.Xv(e);if(a.T.Lc(d))return this.jM(e);if(197==d)return this.iM(e);throw a.g.wa();};k.prototype.jM=function(e){if(e.$b()<=this.$q)return e;var d=new a.Xa(e.description);d.Bc(e,!0);return this.Xv(d)};k.prototype.iM=function(e){var d=new a.Ka(e.description);d.Wc(e,!1);var g=new a.i;e.o(g);e=g.ba();return g.aa()<=this.$q&&e<=this.$q?d:this.Xv(d)};k.prototype.Xv=function(e){for(var d=e.Pa(),g=e.Ca();g.kb();)for(var m=!0;g.La();){var k=g.ia();if(322!=
k.D())throw a.g.ra("not implemented");var b=g.lD(),c=k.$b();if(c>this.$q){var n=Math.ceil(c/this.$q),c=new a.Va(e.description);m&&(k.En(c),d.df(c));for(var h=m=1/n,l=0,n=n-1;l<n;l++)k.uu(h,c),d.lineTo(c),h+=m;b?d.ro():(k.Bn(c),d.lineTo(c))}else b?d.ro():d.Bc(k,m);m=!1}return d};return k}();a.XH=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.D=function(){return 2};e.prototype.$=function(d,
e,m,k){return d instanceof a.T?(d=new a.Pc(d),e=new a.Pc(e),this.$(d,e,m,k).next()):new a.YH(d,e,m,k)};e.ll=function(d,g,m,k){if(d.s()||g.s())return d;var b=d.fb(),c=g.fb();if(b>c)return d;var v=d.D(),n=g.D(),h=new a.i,l=new a.i,q=new a.i;d.o(h);g.o(l);q.K(h);q.Db(l);var q=a.Ia.zd(m,q,!1),u=q*Math.sqrt(2)*1.00001,f=new a.i;f.K(h);f.P(u,u);if(!f.jc(l))return d;if(1==b&&2==c)return e.UI(d,g,n,m,k);if(33==v)switch(a.al.Lc(n)?(m=new a.Xa(g.description),m.Bc(g,!0)):m=g,n){case 1736:return e.kP(d,m,q);
case 1607:return e.nP(d,m,q);case 550:return e.dN(d,m,q);case 197:return e.FM(d,m,q);case 33:return e.rO(d,m,q);default:throw a.g.N();}else if(550==v)switch(n){case 1736:return e.ZI(d,g,q);case 197:return e.TI(d,g,q);case 33:return e.WI(d,g,q)}return a.Of.ll(d,g,m,k)};e.kP=function(d,e,m){return 0==a.gd.uD(e,d,m)?d:d.Pa()};e.nP=function(d,e,m){var g=d.w();e=e.Ca();for(var k=m*Math.sqrt(2)*1.00001,b=k*k,c=new a.i;e.kb();)for(;e.La();){var n=e.ia();n.o(c);c.P(k,k);if(c.contains(g)){if(n.Eq(g,m))return d.Pa();
var h=n.Mb();if(a.b.Zb(g,h)<=b)return d.Pa();h=n.oc();if(a.b.Zb(g,h)<=b)return d.Pa()}}return d};e.dN=function(d,e,m){var g=e.mc(0);e=e.F();var k=d.w(),b=new a.b;m=m*Math.sqrt(2)*1.00001;m*=m;for(var c=0;c<e;c++)if(g.ec(2*c,b),a.b.Zb(b,k)<=m)return d.Pa();return d};e.FM=function(d,e,m){var g=new a.i;e.o(g);g.P(m,m);e=d.w();return g.contains(e)?d.Pa():d};e.rO=function(d,e,m){m=m*Math.sqrt(2)*1.00001;m*=m;var g=d.w();e=e.w();return a.b.Zb(g,e)<=m?d.Pa():d};e.ZI=function(d,e,m){var g=new a.i;e.o(g);
g.P(m,m);for(var k=d.F(),b=!1,c=[],n=0;n<k;n++)c[n]=!1;for(var h=new a.b,n=0;n<k;n++)d.w(n,h),g.contains(h)&&0!=a.gd.he(e,h,m)&&(b=!0,c[n]=!0);if(!b)return d;e=d.Pa();for(n=0;n<k;n++)c[n]||e.Pd(d,n,n+1);return e};e.TI=function(d,e,m){var g=new a.i;e.o(g);g.P(m,m);e=d.F();var k=!1;m=[];for(var b=0;b<e;b++)m[b]=!1;for(var c=new a.b,b=0;b<e;b++)d.w(b,c),g.contains(c)&&(k=!0,m[b]=!0);if(!k)return d;g=d.Pa();for(b=0;b<e;b++)m[b]||g.Pd(d,b,b+1);return g};e.WI=function(d,e,m){var g=d.mc(0),k=d.F(),b=e.w(),
c=new a.b,n=!1;e=[];for(var h=0;h<k;h++)e[h]=!1;h=m*Math.sqrt(2)*1.00001;m=h*h;for(h=0;h<k;h++)g.ec(2*h,c),a.b.Zb(c,b)<=m&&(n=!0,e[h]=!0);if(!n)return d;g=d.Pa();for(h=0;h<k;h++)e[h]||g.Pd(d,h,h+1);return g};e.UI=function(d,e,m,k,b){var g=new a.Vj;d.Fp(g);var c=new a.i;e.o(c);g.Db(c);g.P(.1*g.aa(),.1*g.ba());c=new a.Ka;c.Wc(g,!1);1736==m?c.add(e,!0):c.Wc(e,!0);return a.$r.local().$(d,c,k,b)};e.V=null;return e}(a.Me);a.Zr=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,a){this.Fq=null==
d;this.ua=-1;this.ne=e;this.fx=g;this.EP=d.next();this.Yb=a}k.prototype.next=function(){if(this.Fq)return null;var e;return null!=(e=this.ne.next())?(this.ua=this.ne.ya(),a.Zr.ll(e,this.EP,this.fx,this.Yb)):null};k.prototype.ya=function(){return this.ua};return k}();a.YH=k})(x||(x={}));(function(a){var k=function(){function e(d){this.oe=d;this.Ii=new a.i;this.Ii.Ja();this.Ng=new a.i;this.Ng.Ja()}e.prototype.Pr=function(){var d;d=this.Ii.v;this.Ii.v=this.Ng.v;this.Ng.v=d;d=this.Ii.B;this.Ii.B=this.Ng.B;
this.Ng.B=d;d=this.Ii.C;this.Ii.C=this.Ng.C;this.Ng.C=d;d=this.Ii.G;this.Ii.G=this.Ng.G;this.Ng.G=d};e.prototype.wM=function(d,e){var g=!this.Ii.jc(this.Ng);if(a.T.Kc(d.D())&&a.T.Kc(e.D())){if(d.F()>e.F())return this.gB(d,e,g);this.Pr();g=this.gB(e,d,g);this.Pr();return g}if(550==d.D()&&a.T.Kc(e.D()))return g=this.hB(e,d,g),this.Pr(),g;if(550==e.D()&&a.T.Kc(d.D()))return this.hB(d,e,g);if(550==d.D()&&550==e.D()){if(d.F()>e.F())return this.iB(d,e);this.Pr();g=this.iB(e,d);this.Pr();return g}return 0};
e.prototype.gB=function(d,e,m){var g=d.Ca(),k=e.Ca(),b=new a.i,c=new a.i,n=1.7976931348623157E308;if(!m&&this.iT(d,e,g,k))return 0;for(;g.kb();)for(;g.La();)if(d=g.ia(),d.o(b),!(b.Ou(this.Ng)>n)){for(;k.kb();)for(;k.La();)if(e=k.ia(),e.o(c),b.Ou(c)<n&&(e=d.Fb(e,m),e*=e,e<n)){if(0==e)return 0;n=e}k.Lk()}return Math.sqrt(n)};e.prototype.hB=function(d,e,m){var g=d.Ca(),k=new a.i,b=1.7976931348623157E308,c=new a.b,n,h=e.F();for(m=!m&&1736==d.D();g.kb();)for(;g.La();){var l=g.ia();l.o(k);if(!(1<h&&k.Ou(this.Ng)>
b)){for(var q=0;q<h;q++){e.w(q,c);if(m&&0!=a.gd.he(d,c,0))return 0;n=l.Gd(c,!1);c.sub(l.Kb(n));n=c.Up();if(n<b){if(0==n)return 0;b=n}}m=!1}}return Math.sqrt(b)};e.prototype.iB=function(d,e){for(var g=1.7976931348623157E308,k=new a.b,b=new a.b,c,n=d.F(),h=e.F(),l=0;l<n;l++)if(d.w(l,k),!(1<h&&this.Ng.gG(k)>g))for(var q=0;q<h;q++)if(e.w(q,b),c=a.b.Zb(k,b),c<g){if(0==c)return 0;g=c}return Math.sqrt(g)};e.prototype.iT=function(d,e,m,k){if(1736==d.D()){for(;k.kb();)if(k.La()){var g=k.ia();if(0!=a.gd.he(d,
g.oc(),0))return!0}k.Lk()}if(1736==e.D()){for(;m.kb();)if(m.La()&&(d=m.ia(),0!=a.gd.he(e,d.oc(),0)))return!0;m.Lk()}return!1};e.prototype.il=function(d,e){if(d.s()||e.s())return NaN;d.o(this.Ii);e.o(this.Ng);return this.wM(d,e)};return e}(),b=function(e){function d(){e.apply(this,arguments)}A(d,e);d.prototype.$=function(d,e,b){if(null==d||null==e)throw a.g.N();if(d.s()||e.s())return NaN;var g,m;g=d.D();m=e.D();if(33==g){if(33==m)return a.b.Fb(d.w(),e.w());if(197==m)return b=new a.i,e.o(b),b.Fb(d.w());
g=new a.pe;g.add(d);d=g}else if(197==g){if(197==m)return m=new a.i,d.o(m),b=new a.i,e.o(b),b.Fb(m);g=new a.Ka;g.Wc(d,!1);d=g}33==m?(m=new a.pe,m.add(e),e=m):197==m&&(m=new a.Ka,m.Wc(e,!1),e=m);return(new k(b)).il(d,e)};d.local=function(){null===d.V&&(d.V=new d);return d.V};d.prototype.D=function(){return 14};d.V=null;return d}(a.Me);a.ZH=b})(x||(x={}));(function(a){var k=function(){function k(e,d,g,a){this.aE=e;this.fE=d;this.oe=a;this.HD=g}k.prototype.next=function(){var e=this.aE.next();return null==
e?null:this.yz(e)};k.prototype.ya=function(){return this.aE.ya()};k.prototype.yz=function(e){var d=e.D();if(a.T.Km(d))return e;if(197==d)return d=new a.Ka(e.description),d.Wc(e,!1),this.yz(d);if(e.s())return e;if(null==e)throw a.g.wa();for(var d=e.Pa(),g=new a.yb,m=0,k=e.ea();m<k;m++)this.mH(e,m,d,g);return d};k.prototype.mH=function(e,d,g,m){if(!(2>e.Ha(d))){var k=e.Ea(d),b=e.Dc(d)-1,c=e.mc(0),n=e.vc(d),h=new a.ga(0);h.xb(e.Ha(d)+1);var l=new a.ga(0);l.xb(e.Ha(d)+1);h.add(n?k:b);h.add(k);for(k=new a.b;1<
h.size;){var q=h.tc();h.af();var u=h.tc();e.w(q,k);m.ed(k);e.w(u,k);m.vd(k);u=this.jH(m,k,c,q,u,b);0<=u?(h.add(u),h.add(q)):l.add(q)}n||l.add(h.get(0));if(l.size==h.size)g.Zj(e,d,!0);else if(2<=l.size&&(!this.HD||2!=l.size||!(n||a.b.Fb(e.Fa(l.get(0)),e.Fa(l.get(1)))<=this.fE))){d=new a.Va;m=0;for(b=l.size;m<b;m++)e.Sd(l.get(m),d),0==m?g.df(d):g.lineTo(d);n&&(this.HD||2!=l.size||g.lineTo(d),g.ro())}}};k.prototype.jH=function(e,d,g,a,k,b){var m=k-1;k<=a&&(m=b);b=k=-1;for(a+=1;a<=m;a++){g.ec(2*a,d);
var c=d.x,v=d.y;e.Kb(e.Gd(d,!1),d);d.x-=c;d.y-=v;c=d.length();c>this.fE&&c>b&&(k=a,b=c)}return k};return k}();a.$H=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 29};e.prototype.$=function(d,e,m,k){return d instanceof a.T?(d=new a.Pc(d),this.$(d,e,m,k).next()):new a.$H(d,e,m,k)};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.V=null;return e}(a.Me);a.Sz=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,
arguments)}A(e,k);e.prototype.D=function(){return 21};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,m,k,b,c,n,h){return d instanceof a.T?(h=new a.Pc(d),this.$(h,e,m,[k],b,c,!1,n).next()):!0===n?(m=new a.Uz(d,e,m,k,b,!1,!1,h),a.wi.local().$(m,e,h)):new a.Uz(d,e,m,k,b,!1,!1,h)};e.V=null;return e}(a.Me);a.Tz=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,k,b,c,n,h){if(c)throw a.g.qe();if(null==d)throw a.g.N();this.ua=-1;this.Xq=e;this.cg=d;this.ke=g;
this.Oq=k;this.Rm=b;this.Vm=-1;this.Yb=h;this.CP=new a.i;this.CP.Ja()}k.prototype.next=function(){for(var e;null!=(e=this.Xq.next());)return this.ua=this.Xq.ya(),this.Vm+1<this.Oq.length&&this.Vm++,this.oN(e,this.Oq[this.Vm]);return null};k.prototype.ya=function(){return this.ua};k.prototype.oN=function(e,d){return a.pH.buffer(e,this.cg,this.ke,d,this.Rm,this.Yb)};return k}();a.Uz=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 24};
e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,m){if(null==e)throw a.g.N();if(d.s()||1>d.fb())return 0;if(4==m)throw a.g.qe();var g=a.Ya.Em(e),k=a.Ya.ft(g),b=a.Ya.Ts(g),k=k*(2-k),c=g.Se().Dj,n=d.D(),h;1736==n||197==n?h=d.Rf():a.T.Lc(n)?(h=new a.Xa(d.description),h.Bc(d,!0)):h=d;if(0==g.lc(e)){if(a.Ya.Qo(e)){h=a.gh.qo(h,e);1607==n&&h==d&&(h=a.T.Yj(d));d=new a.Nd;a.Ya.Fm(e).wu(d);for(var n=0,l=h.F();n<l;n++){var q=h.Fa(n);q.x=a.gh.pu(q.x,d);h.ic(n,q)}}d=h.Pa();h=a.gh.ZQ(e,
g,h,d)?d:a.Ya.Wl(h,e,g)}return this.yM(h,m,b,k,c)};e.prototype.yM=function(d,e,m,k,b){var g=new a.ca(0),c=0;for(d=d.Ca();d.kb();)for(;d.La();){var v=d.ia(),n=v.Mb(),v=v.oc();n.scale(b);v.scale(b);a.zb.Rd(m,k,n.x,n.y,v.x,v.y,g,null,null,e);c+=g.l}return c};e.V=null;return e}(a.Me);a.cI=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 18};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,m,k,b){return d instanceof
a.T?(d=new a.Pc(d),this.$(d,e,m,k,b).next()):new a.bI(d,m,k,e,-1,-1,b)};e.V=null;return e}(a.Me);a.aI=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,k,b,c){if(0<c)throw a.g.qe();if(4!=g&&0<b)throw a.g.qe();if(null==d)throw a.g.N();this.ua=-1;this.Xq=e;this.cg=d;this.ke=g;this.IP=k;this.HP=b}k.prototype.next=function(){for(var e;null!=(e=this.Xq.next());)return this.ua=this.Xq.ya(),this.hw(e);return null};k.prototype.ya=function(){return this.ua};k.prototype.hw=function(e){return a.ui.oq(e,
this.cg,this.ke,this.IP,this.HP,this.Yb)};return k}();a.bI=k})(x||(x={}));(function(a){(function(a){a[a.Unknown=0]="Unknown";a[a.Contains=1]="Contains";a[a.Within=2]="Within";a[a.Equals=3]="Equals";a[a.Disjoint=4]="Disjoint";a[a.Touches=8]="Touches";a[a.Crosses=16]="Crosses";a[a.Overlaps=32]="Overlaps";a[a.NoThisRelation=64]="NoThisRelation";a[a.Intersects=1073741824]="Intersects";a[a.IntersectsOrDisjoint=1073741828]="IntersectsOrDisjoint"})(a.xH||(a.xH={}));var k=function(){function k(){}k.lU=function(e,
d,g,m){if(d.s()||e.s())return 4;var b=e.D(),c=d.D(),n;a.T.Lc(b)&&(e=n=new a.Xa(e.description),n.Bc(e,!0));a.T.Lc(c)&&(d=n=new a.Xa(d.description),n.Bc(d,!0));switch(b){case 33:switch(c){case 33:return k.sO(e,d,g);case 197:return k.Id(k.BG(d,e,g));case 550:return k.Id(k.HG(d,e,g));case 1607:return k.Id(k.Az(d,e,g,m));case 1736:return k.Id(k.pz(d,e,g))}throw a.g.wa();case 197:switch(c){case 33:return k.BG(e,d,g);case 197:return k.fK(e,d,g);case 550:return k.Id(k.DG(d,e,g,m));case 1607:return k.Id(k.vz(d,
e));case 1736:return k.Id(k.lz(d,e))}throw a.g.wa();case 550:switch(c){case 33:return k.HG(e,d,g);case 197:return k.DG(e,d,g,m);case 550:return k.FG(e,d,g,m);case 1607:return k.Id(k.xz(d,e));case 1736:return k.Id(k.nz(d,e))}throw a.g.wa();case 1607:switch(c){case 33:return k.Az(e,d,g,m);case 197:return k.vz(e,d);case 550:return k.xz(e,d);case 1607:return k.iQ(e,d);case 1736:return k.Id(k.rz(d,e))}throw a.g.wa();case 1736:switch(c){case 33:return k.pz(e,d,g);case 197:return k.lz(e,d);case 550:return k.nz(e,
d);case 1607:return k.rz(e,d);case 1736:return k.oP(e,d)}throw a.g.wa();default:throw a.g.wa();}};k.sO=function(e,d,g){e=e.w();d=d.w();return k.jz(e,d,g)};k.jz=function(e,d,g){e.sub(d);return e.Up()<=g*g?3:4};k.BG=function(e,d,g){var m=new a.i;e.o(m);e=d.w();return k.ZL(m,e,g)};k.ZL=function(e,d,g){e.P(-g,-g);if(e.contains(d))return 1;e.P(g,g);return e.contains(d)?8:4};k.uM=function(e,d,g){return d.contains(g)?1:e.contains(g)?8:4};k.fK=function(e,d,g){var m=new a.i;e.o(m);e=new a.i;d.o(e);return k.MK(m,
e,g)};k.MK=function(e,d,g){var a=0;e.contains(d)&&(a|=1);d.contains(e)&&(a|=2);if(0!=a)return a;e.P(-g,-g);d.P(-g,-g);if(e.jc(d))return a=e,a.P(g,g),a=a.contains(d)?1:0,d.P(g,g),a|=d.contains(e)?2:0,0!=a?a:32;a=e;a.P(g,g);d.P(g,g);return a.jc(d)?8:4};k.HG=function(e,d,g){d=d.w();return k.JG(e,d,g)};k.JG=function(e,d,g){for(var a=0,b=e.F();a<b;a++){var c;c=e.Fa(a);c=k.jz(c,d,g);if(4!=c)return 0!=(c&2)&&1!=b?1:c}return 4};k.DG=function(e,d,g,m){var b=new a.i;d.o(b);return k.eN(e,b,g,m)};k.eN=function(e,
d,g,a){d.P(-g,-g);d.P(g,g);for(var m=g=0,b=e.F();m<b;m++){var c;c=e.Fa(m);c=k.Id(k.uM(d,d,c));if(4!=c&&(g|=c,4==a))return 1073741824}return 0==g?4:2==g?g:32};k.FG=function(e,d,g,a){for(var m=0,b=0,c=d.F();b<c;b++){var n;n=d.Fa(b);n=k.JG(e,n,g);if(4!=n&&(m++,4==a))return 1073741824}return 0<m?m==d.F()?3==a?(n=k.FG(d,e,g,1),1==n?3:0):1:32:0};k.Az=function(e,d,g,a){d=d.w();return k.XP(e,d,g,a)};k.GM=function(e,d){var g=null;e=e.pb;null!=e&&(g=e.hi);if(null!=g){g=g.Kk(d.x,d.y);if(0==g)return 4;if(1==
g)return 1}else return-1;return 0};k.XP=function(e,d,g,m){if(0==(m&1073741839))return 64;var b=k.GM(e,d);if(0<b)return b;g*=g;for(b=e.Ca();b.kb();){var c=b.Qa;if(!e.vc(c)){var n=e.Ha(c),c=e.Ea(c);if(0==n)continue;if(a.b.Zb(e.Fa(c),d)<=g||1<n&&a.b.Zb(e.Fa(c+n-1),d)<=g)return 8}if(8!=m)for(;b.La();)if(n=b.ia(),n=n.Kb(n.Gd(d,!1)),a.b.Zb(n,d)<=g)return 0!=(m&1073741828)?1073741824:1}return 0!=(m&1073741828)?4:64};k.vz=function(e,d){var g=new a.i;d.o(g);return k.rP(e,g)};k.rP=function(e,d){e=k.ao(e,d);
return 0<e?e:0};k.ao=function(e,d){e=e.pb;if(null!=e)e=e.hi;else return-1;if(null!=e){e=e.Dn(d);if(0==e)return 4;if(1==e)return 1}else return-1;return 0};k.xz=function(e,d){var g=new a.i;d.o(g);g=k.ao(e,g);return 0<g?g:0};k.fs=function(e,d){var g=new a.i;d.o(g);g=k.ao(e,g);return 0<g?g:-1==g&&(g=new a.i,e.o(g),g=k.ao(d,g),0<g)?k.Id(g):0};k.iQ=function(e,d){e=k.fs(e,d);return 0<e?e:0};k.pz=function(e,d,g){d=d.w();return k.lP(e,d,g)};k.lP=function(e,d,g){e=a.gd.he(e,d,g);if(0==e)return 4;if(1==e)return 1;
if(2==e)return 8;throw a.g.wa();};k.lz=function(e,d){var g=new a.i;d.o(g);return k.uO(e,g)};k.uO=function(e,d){e=k.ao(e,d);return 0<e?e:0};k.nz=function(e,d){e=k.fs(e,d);return 0<e?e:0};k.rz=function(e,d){e=k.fs(e,d);return 0<e?e:0};k.oP=function(e,d){e=k.fs(e,d);return 0<e?e:0};k.iR=function(e,d){var g=e.D(),k=d.D(),b;if(a.T.Th(g)&&(b=e.pb,null!=b&&(b=b.hi,null!=b))){if(33==k){var c=d.w();b=b.Kk(c.x,c.y)}else c=new a.i,d.o(c),b=b.Dn(c);if(1==b)return 1;if(0==b)return 4}if(a.T.Th(k)&&(b=d.pb,null!=
b&&(b=b.hi,null!=b))){33==g?(g=e.w(),b=b.Kk(g.x,g.y)):(g=new a.i,e.o(g),b=b.Dn(g));if(1==b)return 2;if(0==b)return 4}return 0};k.Id=function(e){0!=(e&1)&&(e=e&-2|2);0!=(e&2)&&(e=e&-3|1);return e};return k}();a.dI=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.D=function(){return 15};e.prototype.$=function(d,e,k,b,c){return d instanceof a.T?(d=new a.Pc(d),e=new a.Pc(e),this.$(d,e,k,b,c).next()):
void 0===c?new a.Vz(d,e,k,b,-1):new a.Vz(d,e,k,b,c)};e.V=null;return e}(a.Me);a.$r=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,k,b){this.Fq=null==d;this.ua=-1;this.ne=e;this.cg=g;this.Ce=d.next();this.Ji=this.Ce.D();this.Yb=k;this.Xh=b;if(-1!=this.Xh&&(0>=this.Xh||7<this.Xh))throw a.g.N("bad dimension mask");}k.prototype.next=function(){if(this.Fq)return null;var e;if(null!=this.du){e=this.du.next();if(null!=e)return e;this.du=null}for(;null!=(e=this.ne.next());){this.ua=this.ne.ya();
if(-1==this.Xh)return e=this.Ga(e);this.du=this.PO(e);return e=this.du.next()}return null};k.prototype.ya=function(){return this.ua};k.prototype.Ga=function(e){var d=this.uG(e);if(null!=d)return d;var d=a.Ia.$s(this.Ce,e),g=a.Ia.zd(this.cg,d,!0),d=new a.i;this.Ce.o(d);var k=new a.i;e.o(k);d.P(2*g,2*g);d.Ga(k);d.P(100*g,100*g);g=a.Ed.clip(this.Ce,d,0,0);e=a.Ed.clip(e,d,0,0);return a.Of.mt(e,g,this.cg,this.Yb)};k.prototype.SE=function(e,d,g){var k=0;if(0!=(d&1))null==g[0]&&(g[0]=new a.pe(e)),k++;else for(var b=
0;b<g.length-1;b++)g[b]=g[b+1];if(0!=(d&2))null==g[k]&&(g[k]=new a.Xa(e)),k++;else for(b=k;b<g.length-1;b++)g[b]=g[b+1];if(0!=(d&4))null==g[k]&&(g[k]=new a.Ka(e)),k++;else for(b=k;b<g.length-1;b++)g[b]=g[b+1];if(3!=k){e=[];for(b=0;b<k;b++)e[b]=g[b];return new a.Pc(e)}return new a.Pc(g)};k.prototype.PO=function(e){var d=this.uG(e);if(null!=d){var g=[null,null,null];g[d.fb()]=d;return this.SE(e.description,this.Xh,g)}d=a.Ia.$s(this.Ce,e);g=a.Ia.zd(this.cg,d,!0);d=new a.i;this.Ce.o(d);d.P(2*g,2*g);var k=
new a.i;e.o(k);d.Ga(k);d.P(100*g,100*g);g=a.Ed.clip(this.Ce,d,0,0);d=a.Ed.clip(e,d,0,0);g=a.Of.Uw(d,g,this.cg,this.Yb);return this.SE(e.description,this.Xh,g)};k.prototype.uG=function(e){var d=a.Ia.$s(e,this.Ce),g=a.Ia.zd(this.cg,d,!1),d=e.D(),m=e.s(),b=this.Ce.s(),b=m||b;if(!b){b=new a.i;e.o(b);var c=new a.i;this.Ce.o(c);c.P(2*g,2*g);b=!b.jc(c)}if(!b)if(c=a.dI.iR(this.Ce,e),4==c)b=!0;else{if(0!=(c&2))return this.Ce;if(0!=(c&1))return e}if(b)return g=a.T.ve(d),b=a.T.ve(this.Ji),g<b?k.V(e,m):g>b?this.kF():
0==g?550==d&&33==this.Ji?this.kF():k.V(e,m):k.V(e,m);if((-1==this.Xh||4==this.Xh)&&197==d&&197==this.Ji)return g=this.Ce,d=new a.i,e.o(d),m=new a.i,g.o(m),d.Ga(m),g=new a.Vj,e.copyTo(g),g.Cu(d),g;if(197==d&&0==a.T.ve(this.Ji)||197==this.Ji&&0==a.T.ve(d))return m=197==d?e:this.Ce,e=197==d?this.Ce:e,d=new a.i,m.o(d),a.Ed.clip(e,d,g,0);if(0==a.T.ve(d)&&0<a.T.ve(this.Ji)||0<a.T.ve(d)&&0==a.T.ve(this.Ji)){g=a.Ia.Cg(this.cg,e,!1);if(550==d||33==d)return a.Of.jD(e,this.Ce,g);if(550==this.Ji||33==this.Ji)return a.Of.jD(this.Ce,
e,g);throw a.g.wa();}return-1!=this.Xh&&2!=this.Xh||1607!=d||1736!=this.Ji?-1!=this.Xh&&2!=this.Xh||1736!=d||1607!=this.Ji?null:this.rG(this.Ce,e):this.rG(e,this.Ce)};k.prototype.rG=function(e,d){var g=e,k=d,b=a.Ia.Cg(this.cg,d,!1),c=new a.i;k.o(c);var n=new a.i;g.o(n);n.P(2*b,2*b);c.Ga(n);c.P(10*b,10*b);var g=e=a.Ed.clip(e,c,0,0),n=new a.ga(0),h=-1,l=k.pb;if(null!=l){var q=l.hi;if(null!=q){h=0;n.xb(g.F()+g.ea());for(var u=new a.i,f=g.Ca();f.kb();)for(;f.La();){f.ia().o(u);var A=q.Dn(u);1==A?n.add(1):
0==A?n.add(0):(n.add(-1),h++)}}}5<d.F()&&(k=d=a.Ed.clip(d,c,0,0),l=k.pb);0>h&&(h=g.Iw());c=g.F()+k.F();if(h*k.F()>Math.log(c)*c*4)return null;c=null;h=k.Ca();null!=l&&null!=l.Ab&&(c=l.Ab);null==c&&20<k.F()&&(c=a.Ia.nB(k));k=e.Pa();l=null;q=g.Ca();u=[0,0,0,0,0,0,0,0,0];f=new a.qd(0);A=new a.Ag;e=-1;for(var p=0,x=0,w=0<n.size,C=-1;q.kb();){var C=q.Qa,t=0;e=-1;for(p=0;q.La();){var y=w?a.I.truncate(n.get(x)):-1;x++;var z=q.ia();if(0>y){if(null!=c)for(null==l?l=c.KN(z,b):l.Fn(z,b),y=l.next();-1!=y;y=l.next()){h.Sb(c.da(y));
for(var y=h.ia(),E=z.Ga(y,null,u,null,b),y=0;y<E;y++)f.add(u[y])}else for(h.Lk();h.kb();)for(;h.La();)for(y=h.ia(),E=z.Ga(y,null,u,null,b),y=0;y<E;y++)f.add(u[y]);if(0<f.size){f.xd(0,f.size,function(d,e){return d-e});var I=0;f.add(1);for(var E=-1,y=0,J=f.size;y<J;y++){var K=f.get(y);if(K!=I){var G=!1;0!=I||1!=K?(z.Bi(I,K,A),I=A.get()):(I=z,G=!0);if(2<=t){k.ys(g,C,e,p,3==t);if(1!=this.UA(d,I.Mb(),b)&&1!=this.VA(d,I,b))return null;k.Bc(I,!1);t=1;p=0}else switch(E=this.VA(d,I,b),E){case 1:G?2>t?(e=q.Jb()-
g.Ea(C),p=1,t=0==t?3:2):p++:(k.Bc(I,0==t),t=1);break;case 0:t=0;e=-1;p=0;break;default:return null}I=K}}}else{y=this.UA(d,z.Mb(),b);if(0>y)return null;1==y?(2>t&&(e=q.Jb()-g.Ea(C),t=0==t?3:2),p++):(e=-1,p=0)}f.clear(!1)}else 0!=y&&1==y&&(0==t?(t=3,e=q.Jb()-g.Ea(C)):1==t?(t=2,e=q.Jb()-g.Ea(C)):p++)}2<=t&&(k.ys(g,C,e,p,3==t),e=-1)}return k};k.prototype.UA=function(e,d,g){return a.ff.xl(e,d,g)};k.prototype.VA=function(e,d,g){var k=d.Mb();d=d.oc();var b=a.ff.xl(e,k,g),c=a.ff.xl(e,d,g);if(1==b&&0==c||
0==b&&1==c)return-1;if(0==b||0==c)return 0;if(1==b||1==c)return 1;b=new a.b;b.add(k,d);b.scale(.5);e=a.ff.xl(e,b,g);return 0==e?0:1==e?1:-1};k.V=function(e,d){return d?e:e.Pa()};k.prototype.kF=function(){null==this.$D&&(this.$D=this.Ce.Pa());return this.$D};return k}();a.Vz=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 28};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,k,b,c,n,h){return d instanceof
a.T?(d=new a.Pc(d),this.$(d,e,k,b,c,n,h).next()):new a.eI(d,e,k,b,c,n,h)};e.V=null;return e}(a.Me);a.Wz=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,a,k,b,c){this.ua=-1;this.ne=e;this.Pi=d;this.Da=g;this.bi=a;this.Dx=k;this.XD=b;this.oe=c}k.prototype.next=function(){var e=this.ne.next();return null!=e?(this.ua=this.ne.ya(),this.RH(e)):null};k.prototype.ya=function(){return this.ua};k.prototype.RH=function(e){var d;d=0>=this.XD?a.Ia.Cg(this.Pi,e,!1):this.XD;return a.XG.$(e,this.Da,
this.bi,this.Dx,d,this.oe)};return k}();a.eI=k})(x||(x={}));(function(a){var k=function(){function e(){}e.prototype.reset=function(){this.Pg=this.Fj=-1;this.Hq=this.Uo=!1};e.prototype.QM=function(d,e,a){for(d.Sb(e,a);d.La();){var g=d.ia(),g=g.$b();if(0!=g)return d.Jb()}for(d.Sb(e,a);d.Ow();)if(g=d.oi(),g=g.$b(),0!=g)return d.Jb();return-1};e.prototype.RM=function(d,e){for(d.Sb(e,-1);d.Ow();)if(0!=d.oi().$b())return d.Jb();return-1};e.prototype.PM=function(d,e){d.Sb(e,-1);for(d.ia();d.La();)if(0!=
d.ia().$b())return d.Jb();return-1};e.prototype.OM=function(d,e,k,b){this.Fj=this.QM(e,k,b);if(-1!=this.Fj){e.Sb(this.Fj,-1);var g=e.ia(),m=g.Kb(g.Gd(d,!1));k=a.b.Zb(m,d);b=new a.b;b.J(m);b.sub(g.Mb());m=new a.b;m.J(d);m.sub(g.Mb());this.Uo=0>b.Ai(m);this.Pg=this.PM(e,this.Fj);if(-1!=this.Pg){e.Sb(this.Pg,-1);var g=e.ia(),c=g.Gd(d,!1),c=g.Kb(c),v=a.b.Zb(c,d);v>k?this.Pg=-1:(b.J(c),b.sub(g.Mb()),m.J(d),m.sub(g.Mb()),this.Hq=0>b.Ai(m))}-1==this.Pg&&(this.Pg=this.RM(e,this.Fj),-1!=this.Pg&&(e.Sb(this.Pg,
-1),g=e.ia(),c=g.Gd(d,!1),c=g.Kb(c),v=a.b.Zb(c,d),v>k?this.Pg=-1:(b.J(c),b.sub(g.Mb()),m.J(d),m.sub(g.Mb()),this.Hq=0>b.Ai(m),d=this.Fj,this.Fj=this.Pg,this.Pg=d,d=this.Uo,this.Uo=this.Hq,this.Hq=d)))}};e.prototype.FK=function(d,e,a,k,b){a=a.Ca();this.OM(d,a,k,b);if(-1!=this.Fj&&-1==this.Pg)return this.Uo;if(-1!=this.Fj&&-1!=this.Pg){if(this.Uo==this.Hq)return this.Uo;a.Sb(this.Fj,-1);d=a.ia().Pf(1);a.Sb(this.Pg,-1);e=a.ia().Pf(0);return 0<=d.Ai(e)?!0:!1}return e};return e}(),b=function(e){function d(){e.apply(this,
arguments)}A(d,e);d.local=function(){null===d.V&&(d.V=new d);return d.V};d.prototype.D=function(){return 3};d.prototype.zw=function(d,e,k,b){void 0===b&&(b=!1);if(d.s())return new a.dl;e=e.w();var g=d,m=d.D();197==m&&(g=new a.Ka,g.Wc(d,!1),m=1736);switch(m){case 33:return this.OE(g,e);case 550:return this.BE(g,e);case 1607:case 1736:return this.dQ(g,e,k,b);default:throw a.g.ra("not implemented");}};d.prototype.Aw=function(d,e){if(d.s())return new a.dl;e=e.w();var g=d,k=d.D();197==k&&(g=new a.Ka,g.Wc(d,
!1),k=1736);switch(k){case 33:return this.OE(g,e);case 550:case 1607:case 1736:return this.BE(g,e);default:throw a.g.ra("not implemented");}};d.prototype.Bw=function(d,e,k,b){if(0>b)throw a.g.N();if(d.s())return[];e=e.w();var g=d,m=d.D();197==m&&(g=new a.Ka,g.Wc(d,!1),m=1736);switch(m){case 33:return this.IQ(g,e,k,b);case 550:case 1607:case 1736:return this.gQ(g,e,k,b);default:throw a.g.ra("not implemented");}};d.prototype.dQ=function(d,e,b,c){if(1736==d.D()&&b&&(b=new a.i,d.o(b),b=a.Ia.zd(null,b,
!1),0!=(c?a.gd.he(d,e,0):a.gd.he(d,e,b)))){var g=new a.dl(e,0,0);c&&g.UF(!0);return g}for(var m=d.Ca(),g=new a.b,v=b=-1,n=1.7976931348623157E308,h=0;m.kb();)for(;m.La();){var l=m.ia(),l=l.Kb(l.Gd(e,!1)),q=a.b.Zb(l,e);q<n?(h=1,g=l,b=m.Jb(),v=m.Qa,n=q):q==n&&h++}g=new a.dl(g,b,Math.sqrt(n));c&&(m.Sb(b,v),l=m.ia(),c=0>a.b.yn(e,l.Mb(),l.oc()),1<h&&(h=new k,h.reset(),c=h.FK(e,c,d,b,v)),g.UF(c));return g};d.prototype.OE=function(d,e){d=d.w();e=a.b.Fb(d,e);return new a.dl(d,0,e)};d.prototype.BE=function(d,
e){var g=d.mc(0);d=d.F();for(var k=0,m=0,b=0,c=1.7976931348623157E308,n=0;n<d;n++){var h=new a.b;g.ec(2*n,h);var l=a.b.Zb(h,e);l<c&&(m=h.x,b=h.y,k=n,c=l)}g=new a.dl;g.tv(m,b,k,Math.sqrt(c));return g};d.prototype.IQ=function(d,e,k,b){if(0==b)return k=[];k*=k;d=d.w();e=a.b.Zb(d,e);e<=k?(k=[],b=new a.dl,b.tv(d.x,d.y,0,Math.sqrt(e)),k[0]=b):k=[];return k};d.prototype.gQ=function(d,e,k,b){if(0==b)return b=[];var g=d.mc(0),m=d.F();d=[];var c=0;k*=k;for(var v=0;v<m;v++){var n=g.read(2*v),h=g.read(2*v+1),
l=e.x-n,q=e.y-h,l=l*l+q*q;l<=k&&(q=new a.dl,q.tv(n,h,v,Math.sqrt(l)),c++,d.push(q))}e=d.length;d.sort(function(d,e){return d.Da<e.Da?-1:d.Da==e.Da?0:1});if(b>=e)return d.slice(0);d.length=b;return d.slice(0)};d.V=null;return d}(a.Me);a.bv=b})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 4};e.prototype.$=function(d,e,k,b,c){return a.el.py(d,e,k,b,c)};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.V=null;return e}(a.Me);
a.fI=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 33};e.prototype.$=function(d,e,k,b,c){return 1073741824===d?!a.hd.qy(e,k,b,4,c):a.hd.qy(e,k,b,d,c)};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.V=null;return e}(a.Me);a.bl=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,k){this.oe=k;this.yP=g;this.ua=-1;if(null==e)throw a.g.N();this.wk=e;this.Pi=d}k.prototype.next=function(){var e;return null!=(e=
this.wk.next())?(this.ua=this.wk.ya(),this.Qy(e)):null};k.prototype.ya=function(){return this.ua};k.prototype.Qy=function(e){if(null==e)throw a.g.N();return a.cv.cG(e,this.Pi,this.yP,this.oe)};return k}();a.gI=k})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 26};e.prototype.$=function(d,e,k,b){return d instanceof a.T?(d=new a.Pc(d),this.$(d,e,k,b).next()):new a.gI(d,e,k,b)};e.prototype.Ro=function(d,e,k,b,c){return 0<(void 0!==
b?a.cv.Ro(d,e,k,b,c):a.cv.Ro(d,e,!1,null,k))};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.V=null;return e}(a.Me);a.as=k})(x||(x={}));(function(a){var k=function(){function d(){this.hp=0}d.prototype.hS=function(d){this.hp&=-2;this.hp|=d?1:0};d.prototype.sl=function(){return 0!=(this.hp&1)};d.prototype.LC=function(){return this.sl()?0:1};return d}();a.AT=k;var b=function(){return function(){}}(),e=function(){return function(d,e,g,a){this.x=d;this.y=e;this.Sh=g;this.yl=a}}(),d=function(){function d(d){this.me=
d}d.prototype.compare=function(d,e,g){d=d.da(g);e=this.me.$e.read(2*e);d=this.me.$e.read(2*d);e-=d;return 0>e?-1:0<e?1:0};return d}(),g=function(){function d(d){this.me=d}d.prototype.compare=function(d,e,g){e=this.me.$a[e];d=this.me.$a[d.da(g)];var a=e.sl(),k=d.sl();g=e.Zd.xe(this.me.wn,0);var m=d.Zd.xe(this.me.wn,0);g==m&&(g=Math.min(a?e.Zd.ja:e.Zd.ha,k?d.Zd.ja:d.Zd.ha),a=.5*(g-this.me.wn)+this.me.wn,a==this.me.wn&&(a=g),g=e.Zd.xe(a,0),m=d.Zd.xe(a,0));return g<m?-1:g>m?1:0};return d}(),m=function(){function d(d,
e){this.VE=new a.b;this.parent=d;this.mO=e}d.prototype.Zp=function(d,e,g){var a=this.parent,k=this.mO;g.xd(d,e,function(d,e){return a.kj(d,e,k)})};d.prototype.Mo=function(d){d=this.parent.xh.get(d);this.parent.$e.ec(2*(d>>1),this.VE);return this.VE.y+(0!=(d&1)?this.parent.Ri:-this.parent.Ri)};return d}(),c=function(){function c(d,e,g,k,m){this.SD=d.description;this.U=d;this.sg=e;this.Ri=a.Ia.Cg(this.sg,d,!1);this.pn=a.Ia.Cg(this.sg,d,!0);this.yx=g;this.wP=this.SD.Aa;this.$a=[];this.dn=[];this.Lg=
new a.$n;this.Za=new a.bj;this.Kd=new a.wd;this.GD=this.pk=m}c.prototype.Yw=function(){this.GD=!0;return(!a.T.Kc(this.U.D())||this.yB()&&this.xB(!1))&&this.OK()?a.T.Kc(this.U.D())?this.RK()?1607==this.U.D()?this.TK()?2:0:this.UK()?this.VK():0:0:2:0};c.prototype.Yy=function(d,e){var g=this.$e.read(2*d);d=this.$e.read(2*d+1);var k=this.$e.read(2*e);e=this.$e.read(2*e+1);var m=!a.Sr.Vw(g,d,k,e,this.Ri*this.Ri);return m?m:0==this.U.fb()?!1:g==k&&d==e};c.prototype.yB=function(){for(var d=this.U,e=d.Yf?
3:2,g=0,k=d.ea();g<k;g++)if(d.Ha(g)<e)return this.Kd=new a.wd(1,g,0),!1;return!0};c.prototype.xB=function(d){for(var e=this.U,g=e.Ca(),k=e.hasAttribute(1),e=k?a.Ia.rB(this.sg,e,!1):0;g.kb();)for(;g.La();){var m=g.ia();if(!(m.$b()>this.Ri)){if(d&&k){var b=m.gt(1,0),m=m.gt(1,0);if(Math.abs(m-b)>e)continue}this.Kd=new a.wd(2,g.Jb(),-1);return!1}}return!0};c.prototype.OK=function(){var e=this.U,g=null;a.T.Kc(this.U.D())&&(g=this.U);var k=(this.GD||this.pk)&&null!=g,b=e.F();this.$e=e.mc(0);this.xh=new a.ga(0);
this.xh.xb(2*b);this.wh=new a.ga(0);this.wh.xb(2*b);k&&(null==this.Bk&&(this.Bk=new a.ga(0)),this.Bk.xb(b));for(var c=e=0;c<b;c++)if(this.xh.add(2*c),this.xh.add(2*c+1),this.wh.add(2*c),this.wh.add(2*c+1),k){for(;c>=g.Dc(e);)e++;this.Bk.add(e)}(new a.Rr).sort(this.wh,0,2*b,new m(this,k));this.Za.clear();this.Za.Hn(new d(this));this.Za.de(b);g=0;for(b*=2;g<b;g++)if(k=this.wh.get(g),e=this.xh.get(k),k=e>>1,0==(e&1)){e=this.Za.addElement(k,-1);c=this.Za.ge(e);if(-1!=c&&!this.Yy(this.Za.da(c),k))return this.Kd=
new a.wd(3,k,this.Za.da(c)),!1;var v=this.Za.bb(e);if(-1!=v&&!this.Yy(this.Za.da(v),k))return this.Kd=new a.wd(3,k,this.Za.da(v)),!1}else if(e=this.Za.search(k,-1),c=this.Za.ge(e),v=this.Za.bb(e),this.Za.kd(e,-1),-1!=c&&-1!=v&&!this.Yy(this.Za.da(c),this.Za.da(v)))return this.Kd=new a.wd(3,this.Za.da(c),this.Za.da(v)),!1;return!0};c.prototype.RK=function(){return 10>this.U.F()?this.PK():this.QK()};c.prototype.QK=function(){var d=new a.fd;d.Eb(this.U);var e=new a.wd;return a.Zu.DE(!1,d,this.Ri,e,this.oe)?
(e.Fk=d.gb(e.Fk),e.Gk=d.gb(e.Gk),this.Kd.aq(e),!1):!0};c.prototype.PK=function(){for(var d=this.U,e=d.Ca(),d=d.Ca();e.kb();)for(;e.La();){var g=e.ia();if(!e.Jm()||!e.YO()){d.xR(e);do for(;d.La();){var k=d.ia(),k=g.fq(k,this.Ri,!0);if(0!=k)return this.Kd=new a.wd(2==k?5:4,e.Jb(),d.Jb()),!1}while(d.kb())}}return!0};c.prototype.UK=function(){var d=this.U;this.$a.length=0;this.dn.length=0;this.Hf=d.Ca();this.Hf.NR();var e=new a.ga(0);e.xb(10);for(var g=NaN,k=0,m=0,d=2*d.F();m<d;m++){var b=this.wh.get(m),
b=this.xh.get(b);if(0==(b&1)){var b=b>>1,c=this.$e.read(2*b),v=this.$e.read(2*b+1);if(0!=e.size&&(c!=g||v!=k)){if(!this.TE(e))return!1;null!=e&&e.clear(!1)}e.add(b);g=c;k=v}}return this.TE(e)?!0:!1};c.prototype.TK=function(){for(var d=this.U,e=Array(d.ea()),g=0,k=d.ea();g<k;g++)e[g]=d.Oo(g);var k=new b,m,c,v,n=new a.b,g=this.wh.get(0),g=this.xh.get(g),h=g>>1;this.$e.ec(2*h,n);g=this.Bk.get(h);m=e[g];c=d.Ea(g);v=d.Dc(g)-1;k.ak=h==c||h==v;k.Ev=this.pk?!m&&k.ak:k.ak;k.Sh=g;k.x=n.x;k.y=n.y;k.yl=h;for(var l=
new b,q=1,u=this.wh.size;q<u;q++)if(g=this.wh.get(q),g=this.xh.get(g),0==(g&1)){h=g>>1;this.$e.ec(2*h,n);g=this.Bk.get(h);g!=k.Sh&&(m=e[g],c=d.Ea(g),v=d.Dc(g)-1);var D,f=h==c||h==v;D=this.pk?!m&&k.ak:k.ak;l.x=n.x;l.y=n.y;l.Sh=g;l.yl=h;l.Ev=D;l.ak=f;if(l.x==k.x&&l.y==k.y)if(this.pk){if(!l.Ev||!k.Ev)if(l.Sh!=k.Sh||!l.ak&&!k.ak)return this.Kd=new a.wd(8,l.yl,k.yl),!1}else if(!l.ak||!k.ak)return this.Kd=new a.wd(5,l.yl,k.yl),!1;g=k;k=l;l=g}return!0};c.prototype.AB=function(){for(var d=this.U,g=[],k=-1,
m=!1,b=0,c=d.ea();b<c;b++)d.qt(b)&&(m=!1,k++,b<c-1&&(d.qt(b+1)||(m=!0))),g[b]=m?k:-1;var m=new a.b,b=this.wh.get(0),b=this.xh.get(b),v=b>>1;this.$e.ec(2*v,m);for(var b=this.Bk.get(v),k=new e(m.x,m.y,b,v,g[b]),d=[],n=1,c=this.wh.size;n<c;n++)if(b=this.wh.get(n),b=this.xh.get(b),0==(b&1)){v=b>>1;this.$e.ec(2*v,m);b=this.Bk.get(v);b=new e(m.x,m.y,b,v,g[b]);if(b.x==k.x&&b.y==k.y){if(b.Sh==k.Sh)return this.Kd=new a.wd(9,b.yl,k.yl),!1;0<=g[b.Sh]&&g[b.Sh]==g[k.Sh]&&(0!=d.length&&d[d.length-1]==k||d.push(k),
d.push(b))}k=b}if(0==d.length)return!0;b=new a.$n(!0);a.I.Ps(g,-1);m=-1;n=new a.b;n.Eh();k=0;for(c=d.length;k<c;k++){v=d[k];if(v.x!=n.x||v.y!=n.y)m=b.jh(0),n.x=v.x,n.y=v.y;var h=g[v.Sh];-1==h&&(h=b.jh(2),g[v.Sh]=h);b.addElement(h,m);b.addElement(m,h)}c=new a.ga(0);c.xb(10);for(k=b.Wd;-1!=k;k=b.Cw(k))if(d=b.DC(k),0==(d&1)&&0!=(d&2)){d=-1;c.add(k);for(c.add(-1);0<c.size;){m=c.tc();c.af();n=c.tc();c.af();v=b.DC(n);if(0!=(v&1)){d=0==(v&2)?m:n;break}b.$R(n,v|1);for(v=b.gc(n);-1!=v;v=b.bb(v))h=b.getData(v),
h!=m&&(c.add(h),c.add(n))}if(-1!=d){b=-1;k=0;for(c=g.length;k<c;k++)if(g[k]==d){b=k;break}this.Kd=new a.wd(10,b,-1);return!1}}return!0};c.prototype.VK=function(){var d=this.U;if(0>=d.Mh())return this.Kd=new a.wd(6,1==d.ea()?1:-1,-1),0;if(1==d.ea())return this.pk&&!this.AB()?0:2;this.gn=a.ga.Yc(d.ea(),0);this.Hx=a.ga.Yc(d.ea(),-1);for(var e=-1,k=0,m=0,b=d.ea();m<b;m++){var c=d.oo(m);this.gn.write(m,0>c?0:256);if(0<c)e=m,k=c;else{if(0==c)return this.Kd=new a.wd(6,m,-1),0;if(0>e||k<Math.abs(c))if(this.Kd=
new a.wd(7,m,-1),this.pk)return 0;this.Hx.write(m,e)}}this.kr=d.ea();this.Ll=new a.ga(0);this.Ll.xb(10);b=d.F();this.wn=NaN;d=new a.ga(0);d.xb(10);this.yp=a.ga.Yc(b,-1);this.hu=a.ga.Yc(b,-1);null!=this.Hi?this.Hi.clear(!1):this.Hi=new a.ga(0);this.Hi.xb(10);this.Za.clear();this.Za.Hn(new g(this));e=0;for(b*=2;0<this.kr&&e<b;e++)if(k=this.wh.get(e),k=this.xh.get(k),0==(k&1)){k>>=1;m=this.$e.read(2*k+1);if(m!=this.wn&&0!=d.size){if(!this.yr(d))return 0;null!=d&&d.clear(!1)}d.add(k);this.wn=m}return 0<
this.kr&&!this.yr(d)?0:this.pk?0==this.Kd.yh&&this.AB()?2:0:0==this.Kd.yh?2:1};c.prototype.TE=function(d){if(1==d.size)return!0;for(var e=0,g=d.size;e<g;e++){var k=d.get(e);this.Hf.Sb(k);var m=this.Hf.oi();this.$a.push(this.Ls(m,k,this.Hf.Qa,!0));this.Hf.ia();m=this.Hf.ia();this.$a.push(this.Ls(m,k,this.Hf.Qa,!1))}var b=this;this.$a.sort(function(d,e){return b.sM(d,e)});k=this.Lg.Wd;-1==k&&(k=this.Lg.jh(0));this.Lg.$l(this.$a.length);e=0;for(g=this.$a.length;e<g;e++)this.Lg.addElement(k,e);for(var e=
!0,c=g=-1;e;){e=!1;m=this.Lg.gc(k);if(-1==m)break;for(var v=this.Lg.bb(m);-1!=v;){g=this.Lg.getData(m);c=this.Lg.getData(v);g=this.$a[g].tn;c=this.$a[c].tn;if(g==c)if(e=!0,this.Lg.Jc(k,m),m=this.Lg.ge(v),v=this.Lg.Jc(k,v),-1==v||-1==m)break;else continue;m=v;v=this.Lg.bb(m)}}e=this.Lg.vq(k);this.Lg.CB(k);if(0<e)return this.Kd=new a.wd(5,g,c),!1;e=0;for(g=d.size;e<g;e++)this.my(this.$a[e]);this.$a.length=0;return!0};c.prototype.yr=function(d){for(var e=0,g=d.size;e<g;e++){var k=d.get(e),m=this.yp.read(k);
if(-1!=m){var b=this.Za.da(m);this.Hi.add(b);this.Za.kd(m,-1);this.my(this.$a[b]);this.$a[b]=null;this.yp.write(k,-1)}m=this.hu.read(k);-1!=m&&(b=this.Za.da(m),this.Hi.add(b),this.Za.kd(m,-1),this.my(this.$a[b]),this.$a[b]=null,this.hu.write(k,-1))}e=0;for(g=d.size;e<g;e++){k=d.get(e);this.Hf.Sb(k);m=this.Hf.oi();if(m.ja>m.ha){var c=this.Hf.Jb(),v=this.Ls(m,k,this.Hf.Qa,!0);0<this.Hi.size?(b=this.Hi.tc(),this.Hi.af(),this.$a[b]=v):(b=this.$a.length,this.$a.push(v));m=this.Za.addElement(b,-1);-1==
this.yp.read(c)?this.yp.write(c,m):this.hu.write(c,m);0==(this.gn.read(this.Hf.Qa)&3)&&this.Ll.add(m)}this.Hf.ia();m=this.Hf.ia();m.ja<m.ha&&(c=this.Hf.Bm(),v=this.Ls(m,k,this.Hf.Qa,!1),0<this.Hi.size?(b=this.Hi.tc(),this.Hi.af(),this.$a[b]=v):(b=this.$a.length,this.$a.push(v)),m=this.Za.addElement(b,-1),-1==this.yp.read(c)?this.yp.write(c,m):this.hu.write(c,m),0==(this.gn.read(this.Hf.Qa)&3)&&this.Ll.add(m))}e=0;for(g=this.Ll.size;e<g&&0<this.kr;e++)if(m=this.Ll.get(e),0==(this.gn.read(this.$a[this.Za.da(m)].Gx)&
3)){d=-1;for(var k=this.Za.ge(m),n=m,v=null,b=-1,h=0;-1!=k;){b=this.Za.da(k);v=this.$a[b];b=v.Gx;h=this.gn.read(b);if(0!=(h&3))break;n=k;k=this.Za.ge(k)}-1==k?(c=1,k=n):(d=1==(h&3)?b:this.Hx.read(b),c=0!=v.LC()?0:1,k=this.Za.bb(k));do{b=this.Za.da(k);v=this.$a[b];b=v.Gx;n=this.gn.read(b);if(0==(n&3)){if(c!=v.LC())return this.Kd=new a.wd(6,b,-1),!1;h=0==c||v.sl()?2:1;n=n&252|h;this.gn.write(b,h);if(2==h&&0==this.Kd.yh&&this.Hx.read(b)!=d&&(this.Kd=new a.wd(7,b,-1),this.pk))return!1;this.kr--;if(0==
this.kr)return!0}1==(n&3)&&(d=b);n=k;k=this.Za.bb(k);c=0!=c?0:1}while(n!=m)}null!=this.Ll?this.Ll.clear(!1):this.Ll=new a.ga(0);return!0};c.prototype.Ls=function(d,e,g,k){if(322==d.D())d=this.PL(d);else throw a.g.wa();d.tn=e;d.Gx=g;d.hp=0;d.hS(k);return d};c.prototype.PL=function(d){var e;0<this.dn.length?(e=this.dn[this.dn.length-1],--this.dn.length,d.copyTo(e.Zd)):(e=new k,e.Zd=a.fA.Yj(d));return e};c.prototype.my=function(d){322==d.Zd.D()&&this.dn.push(d)};c.prototype.eQ=function(){for(var d=this.U.F(),
e=new a.ga(0),g=0;g<d;g++)e.add(g);var k=this;e.xd(0,d,function(d,e){return k.Is(d,e)});for(g=1;g<d;g++)if(0==this.Is(e.get(g-1),e.get(g)))return this.Kd=new a.wd(3,e.get(g-1),e.get(g)),0;return 2};c.prototype.NQ=function(){return this.yB()?this.xB(!0)?2:0:0};c.prototype.LQ=function(){return this.Yw()};c.prototype.fQ=function(){for(var d=this.U.F(),e=new a.ga(0),g=0;g<d;g++)e.add(g);var k=this;e.xd(0,d,function(d,e){return k.uL(d,e)});var m=Array(d);a.I.Ps(m,!1);m[e.get(0)]=!0;for(g=1;g<d;g++){var b=
e.get(g-1),c=e.get(g);0==this.Is(b,c)?m[c]=!1:m[c]=!0}for(var e=this.U.Pa(),b=this.U,c=0,v=1,g=0;g<d;g++)m[g]?v=g+1:(c<v&&e.Pd(b,c,v),c=g+1);c<v&&e.Pd(b,c,v);e.hg(2,this.pn);return e};c.prototype.OQ=function(){var d=this.U,e=d.Ca(),g=d.Ca(),k=this.U.Pa(),m=this.U,b=d.hasAttribute(1),c=b?a.Ia.rB(this.sg,d,!0):0,v=new a.ga(0),n=new a.ga(0);v.xb(a.I.truncate(d.F()/2+1));for(n.xb(a.I.truncate(d.F()/2+1));e.kb();)if(g.kb(),!(2>d.Ha(e.Qa))){g.zR();for(var h,l,q=!0;e.La();){var u=e.ia(),D=g.oi();if(e.Jb()>
g.Jb())break;q&&(v.add(e.Jb()),n.add(g.Bm()),q=!1);l=v.tc();var f=e.Bm();if(1<f-l){var A=new a.b;A.pc(d.Fa(l),d.Fa(f));h=A.length()}else h=u.$b();l=n.tc();f=g.Jb();1<f-l?(A=new a.b,A.pc(d.Fa(l),d.Fa(f)),l=A.length()):l=D.$b();h>this.pn?v.add(e.Bm()):b&&(h=d.ld(1,v.tc(),0),u=u.Ws(1,0),Math.abs(u-h)>c&&v.add(e.Bm()));l>this.pn?n.add(g.Jb()):b&&(h=d.ld(1,n.tc(),0),u=D.Ws(1,0),Math.abs(u-h)>c&&n.add(g.Jb()))}v.tc()<n.tc()?v.size>n.size?v.af():n.af():(v.tc()!=n.tc()&&n.af(),n.af());if(2<=n.size+v.size){q=
new a.Va;D=0;for(u=v.size;D<u;D++)m.Sd(v.get(D),q),0==D?k.df(q):k.lineTo(q);for(D=n.size-1;0<D;D--)m.Sd(n.get(D),q),k.lineTo(q);m.vc(e.Qa)?k.ro():0<n.size&&(m.Sd(n.get(0),q),k.lineTo(q))}null!=v&&v.clear(!1);null!=n&&n.clear(!1)}k.hg(2,this.pn);return k};c.prototype.MQ=function(){return this.xS()};c.prototype.xS=function(){if(1736==this.U.D()&&1==this.U.Cm())return a.Of.Qj(this.U,this.pn,!0,!1,this.oe);this.Zh=new a.fd;this.Zh.Eb(this.U);0!=this.Zh.pd&&(1!=this.yx&&a.aj.$(this.Zh,this.pn,this.oe,
!0),1736==this.U.D()&&a.mm.$(this.Zh,this.Zh.$c,this.yx,!1,this.oe));this.U=this.Zh.hf(this.Zh.$c);1736==this.U.D()&&(this.U.hl(),this.U.Pp(0));this.U.hg(2,this.pn);return this.U};c.ac=function(d,e,g){if(d.s())return 1;var k=d.D();if(33==k)return 1;if(197==k)return g=new a.i,d.o(g),g.mg(a.Ia.Cg(e,d,!1))?0:1;if(a.T.Lc(k))throw a.g.wa();if(!a.T.Th(k))throw a.g.wa();var k=a.Ia.Cg(e,d,!1),m=d.rj(k);g=g?-1:m;if(-1!=g)return g;1==g&&(k=0);g=(new c(d,e,g,0,!1)).Yw();d.hg(g,k);return g};c.Ro=function(d,e,
g,k,m){null!=k&&(k.yh=0,k.Fk=-1,k.Gk=-1);if(d.s())return 1;var b=d.D();if(33==b)return 1;var v=a.Ia.Cg(e,d,!1);if(197==b)return e=new a.i,d.o(e),e.mg(v)?(null!=k&&(k.yh=2,k.Fk=-1,k.Gk=-1),0):1;if(a.T.Lc(b))return v=new a.Xa(d.description),v.Bc(d,!0),c.Ro(v,e,g,k,m);m=d.rj(v);g=g?-1:m;if(-1!=g)return g;e=new c(d,e,g,0,!1);if(550==b)g=e.eQ();else if(1607==b)g=e.NQ();else if(1736==b)g=e.LQ();else throw a.g.wa();d.hg(g,v);null!=k&&0==g&&k.aq(e.Kd);return g};c.ob=function(d,e,g,k,m){null!=k&&(k.yh=0,k.Fk=
-1,k.Gk=-1);if(d.s())return 1;var b=d.D();if(33==b)return 1;var v=a.Ia.Cg(e,d,!1);if(197==b)return e=new a.i,d.o(e),e.mg(v)?(null!=k&&(k.yh=2,k.Fk=-1,k.Gk=-1),0):1;if(a.T.Lc(b))return b=new a.Xa(d.description),b.Bc(d,!0),c.Ro(b,e,g,k,m);d=new c(d,e,-1,0,!0);if(550==b||1607==b||1736==b)e=d.Yw();else throw a.g.wa();null!=k&&k.aq(d.Kd);return e};c.cG=function(d,e,g,k){if(d.s())return d;var m=d.D();if(33==m)return d;var b=a.Ia.Cg(e,d,!1);if(197==m)return e=new a.i,d.o(e),e.mg(b)?d.Pa():d;if(a.T.Lc(m))return m=
new a.Xa(d.description),m.Bc(d,!0),c.cG(m,e,g,k);k=d.rj(b);g=g?-1:k;if(2==g)return d;d=new c(d,e,g,0,!1);if(550==m)d=d.fQ();else if(1607==m)d=d.OQ();else if(1736==m)d=d.MQ();else throw a.g.wa();return d};c.Ry=function(d,e,g,k){if(d.s())return d;var m=d.D();if(33==m)return d;var b=a.Ia.Cg(e,d,!1);if(197==m)return e=new a.i,d.o(e),e.mg(b)?d.Pa():d;if(a.T.Lc(m))return b=new a.Xa(d.description),b.Bc(d,!0),c.Ry(b,e,g,k);if(!a.T.Th(m))throw a.g.ra("OGC simplify is not implemented for this geometry type "+
m);return a.Of.Ry(d,b,!1,k)};c.prototype.kj=function(d,e,g){if(d==e)return 0;d=this.xh.get(d);var k=this.xh.get(e);e=d>>1;var m=k>>1,b=new a.b,c=new a.b;this.$e.ec(2*e,b);b.y+=0!=(d&1)?this.Ri:-this.Ri;this.$e.ec(2*m,c);c.y+=0!=(k&1)?this.Ri:-this.Ri;d=b.compare(c);return 0==d&&g?(g=this.Bk.get(e)-this.Bk.get(m),0>g?-1:0<g?1:0):d};c.prototype.Is=function(d,e){if(d==e)return 0;var g=this.U,k=g.Fa(d),m=g.Fa(e);if(k.x<m.x)return-1;if(k.x>m.x)return 1;if(k.y<m.y)return-1;if(k.y>m.y)return 1;for(k=1;k<
this.wP;k++)for(var m=this.SD.Hd(k),b=a.pa.Wa(m),c=0;c<b;c++){var v=g.ld(m,d,c),n=g.ld(m,e,c);if(v<n)return-1;if(v>n)return 1}return 0};c.prototype.uL=function(d,e){var g=this.Is(d,e);return 0==g?d<e?-1:1:g};c.prototype.sM=function(d,e){if(d===e)return 0;var g=d.Zd.Pf(d.sl()?1:0);d.sl()&&g.Bp();d=e.Zd.Pf(e.sl()?1:0);e.sl()&&d.Bp();e=g.ps();var a=d.ps();return a==e?(e=g.Ai(d),Math.abs(e)<=8.881784197001252E-16*(Math.abs(d.x*g.y)+Math.abs(d.y*g.x))&&(e--,e++),0>e?1:0<e?-1:0):e<a?-1:1};return c}();a.cv=
c})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 30};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.$=function(d,e,k,b){return d instanceof a.T?(d=new a.Pc(d),e=new a.Pc(e),this.$(d,e,k,b).next()):new a.hI(d,e,k,b)};e.On=function(d,g,k,b){var m=d.fb(),c=g.fb();if(d.s()&&g.s())return m>c?d:g;if(d.s())return g;if(g.s())return d;var v=new a.i,n=new a.i,h=new a.i;d.o(v);g.o(n);h.K(v);h.Db(n);v=a.Ia.zd(k,h,!1);
n=d.D();h=g.D();return 33==n&&33==h?e.qP(d,g,v):n!=h?0<m||0<c?m>c?d:g:550==n?e.pA(d,g,v):e.pA(g,d,v):a.Of.On(d,g,k,b)};e.qP=function(d,e,k){k=k*Math.sqrt(2)*1.00001;k*=k;var g=d.w(),m=e.w(),b=new a.pe(d.description);a.b.Zb(g,m)>k&&(b.add(d),b.add(e));return b};e.pA=function(d,e,k){var g=d.mc(0),m=d.F(),b=e.w(),c=d.Pa();k=k*Math.sqrt(2)*1.00001;var n=new a.i;d.o(n);n.P(k,k);if(n.contains(b)){k*=k;for(var n=!1,h=[],l=0;l<m;l++)h[l]=!1;for(l=0;l<m;l++){var q=g.read(2*l),u=g.read(2*l+1),q=q-b.x,u=u-b.y;
q*q+u*u<=k&&(n=!0,h[l]=!0)}if(n)for(l=0;l<m;l++)h[l]||c.Pd(d,l,l+1);else c.Pd(d,0,m),c.add(e)}else c.Pd(d,0,m),c.add(e);return c};e.V=null;return e}(a.Me);a.dv=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g,a){this.Fq=null==d;this.ua=-1;this.ne=e;this.cg=g;this.QP=d.next();this.Yb=a}k.prototype.next=function(){if(this.Fq)return null;var e;return null!=(e=this.ne.next())?(this.ua=this.ne.ya(),a.dv.On(e,this.QP,this.cg,this.Yb)):null};k.prototype.ya=function(){return this.ua};return k}();
a.hI=k})(x||(x={}));(function(a){var k=function(){function d(){}d.prototype.jt=function(){this.iw=null;this.Vu=-1;this.xG=!1};return d}(),b=function(){function d(){this.jq=0;this.Ci=[]}d.prototype.TJ=function(d){this.jq+=d.Vu;this.Ci.push(d)};d.prototype.PQ=function(){this.jq-=this.Ci[this.Ci.length-1].Vu;--this.Ci.length};d.prototype.Dv=function(){return this.Ci[this.Ci.length-1]};d.prototype.lc=function(d){return d===this};return d}(),e=function(){function d(d,e,a){this.ua=-1;this.Ec=!1;this.bE=
[!1,!1,!1,!1];this.ep=[0,0,0,0];this.ox=!1;this.Gj=-1;this.So=0;this.Tm=-1;this.rn=[];this.ne=d;this.cg=e;this.Yb=a}d.ac=function(d){var e=[],g;for(g in d)e.push(Number(g));e.sort(function(d,e){return d-e});return e};d.prototype.UC=function(e){var g=this.rn[e],k=d.ac(g)[0],b=g[k],c=b.Dv().iw,b=b.Dv().xG;delete g[k];b&&(c=a.as.local().$(c,this.cg,!1,this.Yb),0==e&&33==c.D()&&(e=new a.pe(c.description),c.s()||e.add(c),c=e));return c};d.prototype.next=function(){if(this.Ec&&this.Tm==this.Gj)return null;
for(;!this.FS(););if(-1==this.Gj)return null;if(this.ox){for(this.Tm++;;){if(this.Tm>this.Gj||0>this.Tm)throw a.g.wa();if(this.bE[this.Tm])break}this.ua++;return this.UC(this.Tm)}this.ua=0;this.Tm=this.Gj;return this.UC(this.Gj)};d.prototype.ya=function(){return this.ua};d.prototype.FS=function(){if(this.Ec)return!0;var d=null;null!=this.ne&&(d=this.ne.next(),null==d&&(this.Ec=!0,this.ne=null));if(null!=d){var e=d.fb();this.bE[e]=!0;e>=this.Gj&&!this.ox&&(this.SA(e,!1,d),e>this.Gj&&!this.ox&&this.vR(e))}if(0<
this.So)for(e=0;e<=this.Gj;e++)for(;1<this.ep[e];)if(d=this.jL(e),0!=d.length)d=a.Of.oM(d,this.cg,this.Yb),this.SA(e,!0,d);else break;return this.Ec};d.prototype.jL=function(e){for(var g=[],a=[],k=this.rn[e],b=d.ac(k),c=0;c<b.length;c++){var n=b[c],h=k[n];if(this.Ec||1E4<h.jq&&1<h.Ci.length){this.ep[e]-=h.Ci.length;for(this.So-=h.Ci.length;0<h.Ci.length;)g.push(h.Dv().iw),h.PQ();a.push(n)}}for(c=0;c<a.length;c++)delete k[a[c]];return g};d.prototype.vR=function(d){for(var e=0;e<d;e++)this.rn[e]=[],
this.So-=this.ep[e],this.ep[e]=0};d.prototype.SA=function(e,a,c){var g=new k;g.jt();g.iw=c;c=d.$g(c);g.Vu=c;c=d.Wf(c);if(e+1>this.rn.length)for(var m=0,v=Math.max(2,e+1);m<v;m++)this.rn.push([]);m=this.rn[e][c];void 0===m&&(m=new b,this.rn[e][c]=m);g.xG=a;m.TJ(g);this.ep[e]++;this.So++;this.Gj=Math.max(this.Gj,e)};d.Wf=function(d){return 0<d?a.I.truncate(Math.log(d)/Math.log(4)+.5):0};d.$g=function(d){var e=d.D();if(a.T.Th(e))return d.F();if(33==e)return 1;if(197==e)return 4;if(a.T.Lc(e))return 2;
throw a.g.wa();};return d}();a.jI=e})(x||(x={}));(function(a){var k=function(k){function e(){k.apply(this,arguments)}A(e,k);e.prototype.D=function(){return 1};e.prototype.$=function(d,e,k,b){return void 0===b?new a.jI(d,e,k):this.xM(d,e,k,b)};e.prototype.xM=function(d,e,k,b){d=new a.Pc([d,e]);return this.$(d,k,b).next()};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.V=null;return e}(a.Me);a.wi=k})(x||(x={}));(function(a){var k;(function(a){a[a.nextPath=0]="nextPath";a[a.nextSegment=1]=
"nextSegment";a[a.iterate=2]="iterate"})(k||(k={}));k=function(){function k(e,d,g,k){this.dr=new a.i;this.LP=e;this.MP=d;this.Wo=k;this.hn=-1;this.qk=!1;var m=e.pb;null!=m&&(m=k?m.nn:m.Ab,null!=m&&(this.Ec=!1,this.ka=g,this.Ab=m,this.au=this.Ab.Re(),this.Xo=this.qk=!0,this.Hb=0,k?this.hn=d.ea():this.bd=d.Ca()));this.qk||(m=d.pb,null!=m&&(m=k?m.nn:m.Ab,null!=m&&(this.Ec=!1,this.ka=g,this.Ab=m,this.au=this.Ab.Re(),this.qk=!0,this.Xo=!1,this.Hb=0,k?this.hn=e.ea():this.bd=e.Ca())));this.qk||(this.th=
k?a.Ia.BN(e,d,g,1<=e.rj(0),1<=d.rj(0)):a.Ia.AN(e,d,g))}k.prototype.next=function(){if(this.qk){if(this.Ec)return!1;for(var e=!0;e;)switch(this.Hb){case 0:e=this.nQ();break;case 1:e=this.oQ();break;case 2:e=this.$w();break;default:throw a.g.ra("internal error");}return this.Ec?!1:!0}return null==this.th?!1:this.th.next()};k.prototype.jk=function(){return this.qk?this.Xo?this.Ab.da(this.Rq):this.Wo?this.hn:this.bd.Jb():this.th.jk(this.th.Ff)};k.prototype.ek=function(){return this.qk?this.Xo?this.Wo?
this.hn:this.bd.Jb():this.Ab.da(this.Rq):this.th.ek(this.th.mf)};k.prototype.Fw=function(){if(!this.Wo)throw a.g.ra("internal error");return this.qk?this.Xo?this.Ab.uC(this.Rq):this.dr:this.th.Fw(this.th.Ff)};k.prototype.jw=function(){if(!this.Wo)throw a.g.ra("internal error");return this.qk?this.Xo?this.dr:this.Ab.uC(this.Rq):this.th.jw(this.th.mf)};k.prototype.nQ=function(){if(!this.Wo){if(!this.bd.kb())return this.Ec=!0,!1;this.Hb=1;return!0}if(-1==--this.hn)return this.Ec=!0,!1;this.Xo?this.MP.Ti(this.hn,
this.dr):this.LP.Ti(this.hn,this.dr);this.au.Ch(this.dr,this.ka);this.Hb=2;return!0};k.prototype.oQ=function(){if(!this.bd.La())return this.Hb=0,!0;var e=this.bd.ia();this.au.Fn(e,this.ka);this.Hb=2;return!0};k.prototype.$w=function(){this.Rq=this.au.next();return-1==this.Rq?(this.Hb=this.Wo?0:1,!0):!1};return k}();a.cl=k})(x||(x={}));(function(a){a=a.kI||(a.kI={});a[a.enumClosed=1]="enumClosed";a[a.enumHasNonlinearSegments=2]="enumHasNonlinearSegments";a[a.enumOGCStartPolygon=4]="enumOGCStartPolygon";
a[a.enumCalcMask=4]="enumCalcMask"})(x||(x={}));(function(a){var k=function(){function k(){}k.Fb=function(e,d,g,m,b,c,n,h,l){var v=[0,0,0],q=[0,0,0],u=[0,0,0],D=[0,0,0,0],f=new a.ca(0),A=new a.ca(0),p=new a.ca(0);if(null!=n||null!=h||null!=l)if(a.j.Ih(d))a.zg.Fb(e,g,m,b,c,n,h,l);else{b=a.u.W(b);g=a.u.W(g);var x=a.u.W(b-g);if(a.j.S(m,c)&&(a.j.S(g,b)||a.j.S(a.j.H(m),1.570796326794897)))null!=n&&(n.l=0),null!=h&&(h.l=0),null!=l&&(l.l=0);else{if(a.j.S(m,-c)){if(a.j.S(a.j.H(m),1.570796326794897)){null!=
n&&(n.l=2*a.u.gg(e,d));null!=h&&(h.l=0<m?a.u.W(3.141592653589793-a.u.W(b)):a.u.W(b));null!=l&&(l.l=0<m?a.u.W(b):a.u.W(3.141592653589793-a.u.W(b)));return}a.j.S(a.j.H(x),3.141592653589793)&&(null!=n&&(n.l=2*a.u.gg(e,d)),null!=h&&(h.l=0),null!=l&&(l.l=0))}else{if(a.j.S(a.j.H(m),1.570796326794897)||a.j.S(a.j.H(c),1.570796326794897)){a.Xj.Fb(e,d,g,m,b,c,n,h,l);return}if(a.j.S(g,b)||a.j.S(a.j.H(x),3.141592653589793)){a.Xj.Fb(e,d,g,m,b,c,n,h,l);return}if(a.j.Vc(m)){a.Xj.Fb(e,d,g,m,b,c,n,h,l);return}}var w=
Math.sqrt(1-d);b=a.u.W(b-g);g=0;a.u.wm(d,m,g,f,A,p);v[0]=f.l;v[1]=A.l;v[2]=p.l;a.u.wm(d,c,b,f,A,p);q[0]=f.l;q[1]=A.l;q[2]=p.l;u[0]=0;u[1]=0;u[2]=-1*d*a.u.n(1,d,m)*Math.sin(m);0>b?a.u.Ep(u,q,v,D,0):a.u.Ep(u,v,q,D,0);for(var A=[0,0,0],p=[0,0,0],t=[0,0,0],v=[0,0,0],f=[0,0,0],C=Math.acos(D[2]/1),y=1-d,z=Math.tan(C),E=1+z*z/y,I=2*u[2]*z/y,z=Math.sqrt(I*I-4*E*(u[2]*u[2]/y-1)),E=2*E,y=(-I+z)/E,I=(-I-z)/E,z=Math.tan(C),E=z*y+u[2],C=(y+I)/2,u=(E+(z*I+u[2]))/2,z=a.u.Sn(y-C,E-u),y=u/w*1.570796326794897,I=0;100>
I;I++){E=a.u.Tk(d,y);E=E*E/Math.cos(y)*(Math.sin(y)-u*E/(1*(1-d)));if(a.j.Vc(E))break;y-=E}var u=a.u.n(1,d,y)*Math.cos(y),u=Math.sqrt((u-C)*(u+C)),z=1-z/u,z=z*(2-z),E=a.u.jm(A),C=a.u.jm(p),y=a.u.jm(t),L=a.u.Qr(t,A),I=a.u.Qr(t,p);a.u.Uu(t,A,v);a.u.Uu(t,p,f);A=Math.acos(L/(y*E));p=Math.acos(I/(y*C));p*=a.j.nb(1,a.u.Qr(v,f));if(1.570796326794897<=a.j.H(A)&&1.570796326794897<=a.j.H(p)||3.141592653589793<a.j.H(A-p))A=(3.141592653589793-a.j.H(A))*a.j.nb(1,A),p=(3.141592653589793-a.j.H(p))*a.j.nb(1,p);v=
a.u.Si(z,p);f=a.u.q(u,z,a.u.Si(z,A));v=a.u.q(u,z,v);v=a.j.H(v-f)*e;A=new a.ca(0);p=new a.ca(0);t=D[1]/1;t*=-a.j.nb(1,x);f=Math.acos(t)*a.j.nb(1,x);k.gf(e,d,g,m,v,f,A,p);a.j.S(b,A.l)&&a.j.S(c,p.l)||(z=a.u.Sn(a.u.W(b-A.l),c-p.l),k.gf(e,d,g,m,v,a.u.W(f+3.141592653589793),A,p),E=a.u.Sn(a.u.W(b-A.l),c-p.l),E<z&&(f=a.u.W(f+3.141592653589793)));A=[0,0,0,0];p=[0,0,0,0];u=[0,0,0];z=[0,0,0];e=[0,0,0];g=[0,0,0];m=[0,0,0];t=[0,0,0];u[0]=0;u[1]=0;u[2]=w;z[0]=0;z[1]=0;z[2]=0;a.u.Ep(z,u,q,A,0);a.j.Vc(c)?(e[0]=q[0],
e[1]=q[1],e[2]=1,g[0]=1*Math.cos(b)-1*Math.sin(b),g[1]=1*Math.sin(b)+1*Math.cos(b)):(d=a.u.n(1,d,c)*Math.cos(c),e[0]=0,e[1]=0,q[2]+=Math.tan(1.570796326794897-a.j.H(c))*d*a.j.nb(1,c),g[0]=d*Math.cos(b)-d*Math.sin(b),g[1]=d*Math.sin(b)+d*Math.cos(b));g[2]=q[2];a.u.Ep(q,g,e,p,1);a.u.Uu(p,A,m);a.u.Uu(p,D,t);t=a.u.Qr(m,t)/(a.u.jm(m)*a.u.jm(t));t*=a.j.nb(1,x);b=Math.acos(t)*-a.j.nb(1,x);0<f&&0<b?b=a.u.W(b+3.141592653589793):0>f&&0>b&&(b=a.u.W(b+3.141592653589793));null!=n&&(n.l=v);null!=h&&(h.l=f);null!=
l&&(l.l=b)}}};k.gf=function(e,d,g,k,b,c,n,h){var m=[0,0,0],v=[0,0,0],l=[0,0,0],q=[0,0,0],u=[0,0,0],D=[0,0,0],f=[0,0,0],A=[0,0,0,0],p=new a.ca(0),x=new a.ca(0),w=new a.ca(0),t=new a.ca(0),C=new a.ca(0),y=new a.ca(0);if(null!=n&&null!=h)if(a.j.Ih(d))a.zg.gf(e,g,k,b,c,n,h);else if(a.j.Vc(b))null!=n&&(n.l=g),null!=h&&(h.l=k);else if(c=a.u.W(c),0>b&&(b=a.j.H(b),c=a.u.W(c+3.141592653589793)),g=a.u.W(g),k=a.u.W(k),1.570796326794897<a.j.H(k)&&(g=a.u.W(g+3.141592653589793),k=a.j.nb(3.141592653589793,k)-k),
a.j.S(a.j.H(k),1.570796326794897)||a.j.Vc(k)||a.j.Vc(c)||a.j.S(a.j.H(c),3.141592653589793))a.Xj.gf(e,d,g,k,b,c,n,h);else{var z=Math.sqrt(1-d);e=b/e;a.u.wm(d,k,0,t,C,y);m[0]=t.l;m[1]=C.l;m[2]=C.l;f[0]=0;f[1]=0;f[2]=-1*d*a.u.n(1,d,k)*Math.sin(k);t=a.u.n(1,d,k);C=a.u.W(1.570796326794897-c);y=Math.sin(C);b=Math.cos(k);k=Math.sin(k);u[0]=t*b-k*y;u[1]=Math.cos(C);u[2]=(1-d)*t*k+b*y;0>c?a.u.Ep(f,u,m,A,0):a.u.Ep(f,m,u,A,0);m=Math.acos(A[2]/1);A=Math.atan2(-A[1],-A[0]);k=1-d;u=Math.tan(m);C=1+u*u/k;t=2*f[2]*
u/k;u=Math.sqrt(t*t-4*C*(f[2]*f[2]/k-1));C*=2;k=(-t+u)/C;t=(-t-u)/C;u=Math.tan(m);C=u*k+f[2];m=(k+t)/2;f=(C+(u*t+f[2]))/2;u=a.u.Sn(k-m,C-f);z=f/z*1.570796326794897;for(k=0;100>k;k++){t=a.u.Tk(d,z);t=t*t/Math.cos(z)*(Math.sin(z)-f*t/(1*(1-d)));if(a.j.Vc(t))break;z-=t}z=a.u.n(1,d,z)*Math.cos(z);z=Math.sqrt((z-m)*(z+m));f=1-u/z;f*=2-f;D=Math.acos(a.u.Qr(D,v)/(a.u.jm(D)*a.u.jm(v)));D*=a.j.nb(1,v[0]);c=(a.u.q(z,f,a.u.Si(f,D))+e*a.j.nb(1,c))/a.u.gg(z,f);c=a.u.W(1.570796326794897*c);c=a.u.xn(f,c);a.u.n(z,
f,c);u=a.u.W(A+g);g=Math.cos(u);c=Math.sin(u);l[0]=q[0]*g+q[1]*-c;l[1]=q[0]*c+q[1]*g;l[2]=q[2];a.u.JK(d,l[0],l[1],l[2],w,x,p);null!=n&&(n.l=x.l);null!=h&&(h.l=w.l)}};return k}();a.$z=k})(x||(x={}));(function(a){var k=function(){function d(d){this.Na=null;this.Ar=new a.b;this.Br=new a.b;this.a=d}d.prototype.compare=function(d,e,g){this.a.uc(e,this.Ar);this.a.uc(d.da(g),this.Br);return this.Ar.compare(this.Br)};return d}(),b=function(){function d(d){this.nf=new a.b;this.ln=new a.b;this.a=d}d.prototype.bh=
function(d){this.nf.J(d)};d.prototype.compare=function(d,e){this.a.uc(d.da(e),this.ln);return this.nf.compare(this.ln)};return d}(),e=function(d){function e(e){d.call(this,e.a,e.ka,!1);this.ab=e}A(e,d);e.prototype.compare=function(d,e,g){if(this.Zf)return-1;var a=this.ab.Cd.Dm(this.ab.lh(e));d=d.da(g);var k=this.ab.Cd.Dm(this.ab.lh(d));this.Cl=g;return this.JB(e,a,d,k)};return e}(a.hA),d=function(d){function e(e){d.call(this,e.a,e.ka);this.ab=e}A(e,d);e.prototype.compare=function(d,e){if(this.Zf)return-1;
d=this.ab.Cd.Dm(this.ab.lh(d.da(e)));this.Cl=e;return this.KB(e,d)};return e}(a.JI),g=function(){function g(){this.zc=this.Ue=this.Zm=this.Cd=this.Kg=this.nd=this.$a=this.a=null;this.og=!1;this.Xg=this.Kl=this.Vd=this.Lj=this.Mg=this.Hj=this.sf=this.Ld=null;this.Yg=this.rp=this.Tx=this.ka=0;this.Ht=this.Nm=!1;this.mn=new a.b;this.Ck=new a.b;this.$a=new a.Fc(8);this.nd=new a.Fc(5);this.Kg=new a.Ur;this.Cd=new a.Ur;this.og=!1;this.Xg=new a.b;this.Xg.ma(0,0);this.ka=0;this.Yg=-1;this.Nm=!1;this.a=null;
this.Ue=new a.bj;this.zc=new a.bj;this.Mg=new a.ga(0);this.Lj=new a.gA;this.sf=new a.ga(0);this.Hj=new a.ga(0);this.Zm=new a.Va}g.prototype.GS=function(d,e){var g=new a.Bg;g.Oy();d.Oe(g);this.Op(d);this.Nm=!1;this.ka=e;this.Tx=e*e;e=this.Xy();d.Oe(g);e||(this.JM(),e||this.Xy());-1!=this.Yg&&(this.a.bf(this.Yg),this.Yg=-1);this.a=null;return this.Nm};g.prototype.KS=function(d,e){this.Op(d);this.Nm=!1;this.ka=e;this.Tx=e*e;this.og=!1;this.Xy();this.og||(this.og=1==d.xo(e,!0,!1));-1!=this.Yg&&(this.a.bf(this.Yg),
this.Yg=-1);this.a=null};g.prototype.Uf=function(d,e){return this.$a.O(d,0+e)};g.prototype.zy=function(d,e,g){this.$a.L(d,0+e,g)};g.prototype.lh=function(d){return this.$a.O(d,2)};g.prototype.UR=function(d,e){this.$a.L(d,2,e)};g.prototype.FC=function(d,e){return this.$a.O(d,3+e)};g.prototype.Eo=function(d){return this.$a.O(d,7)};g.prototype.Nk=function(d,e){this.$a.L(d,7,e)};g.prototype.Go=function(d,e){return this.$a.O(d,3+this.Do(d,e))};g.prototype.Qp=function(d,e,g){this.$a.L(d,3+this.Do(d,e),
g)};g.prototype.ZN=function(d,e){return this.$a.O(d,5+this.Do(d,e))};g.prototype.Sp=function(d,e,g){this.$a.L(d,5+this.Do(d,e),g)};g.prototype.rq=function(d){return this.nd.O(d,0)};g.prototype.RR=function(d,e){this.nd.L(d,0,e)};g.prototype.ow=function(d){return this.nd.O(d,4)};g.prototype.Lp=function(d,e){this.nd.L(d,4,e)};g.prototype.fk=function(d){return this.nd.O(d,1)};g.prototype.dm=function(d,e){this.nd.L(d,1,e)};g.prototype.nw=function(d){return this.nd.O(d,3)};g.prototype.Hr=function(d,e){this.nd.L(d,
3,e)};g.prototype.Ul=function(d){var e=this.nd.be(),g=this.Kg.jh();this.RR(e,g);-1!=d?(this.Kg.addElement(g,d),this.a.lb(d,this.Yg,e),this.Lp(e,this.a.gb(d))):this.Lp(e,-1);return e};g.prototype.aM=function(d){this.nd.Jc(d)};g.prototype.QA=function(d,e){this.Kg.addElement(this.rq(d),e);this.a.lb(e,this.Yg,d)};g.prototype.rr=function(d){var e=this.$a.be(),g=this.Cd.jh();this.UR(e,g);-1!=d&&this.Cd.addElement(g,d);return e};g.prototype.RA=function(d,e){this.Cd.addElement(this.lh(d),e)};g.prototype.Ns=
function(d){this.$a.Jc(d);d=this.Mg.Qs(d);0<=d&&this.Mg.QE(d)};g.prototype.yi=function(d,e){if(-1==this.Uf(d,0))this.zy(d,0,e);else if(-1==this.Uf(d,1))this.zy(d,1,e);else throw a.g.wa();this.Av(d,e)};g.prototype.Av=function(d,e){var g=this.fk(e);if(-1!=g){var a=this.Go(g,e);this.Sp(a,e,d);this.Qp(d,e,a);this.Qp(g,e,d);this.Sp(d,e,g)}else this.Sp(d,e,d),this.Qp(d,e,d),this.dm(e,d)};g.prototype.Do=function(d,e){return this.Uf(d,0)==e?0:1};g.prototype.Tl=function(d,e){var g=this.nw(e);-1!=g&&(this.Ue.kd(g,
-1),this.Hr(e,-1));var a,g=this.fk(e);if(-1!=g){var k=a=g,m;do{m=!1;var b=this.Do(a,e),c=this.FC(a,b);if(this.Uf(a,b+1&1)==d){this.Os(a);this.Cd.Fg(this.lh(a));this.Ns(a);if(a==c){g=-1;break}g==a&&(g=this.fk(e),k=c,m=!0)}a=c}while(a!=k||m);if(-1!=g){do b=this.Do(a,e),c=this.FC(a,b),this.zy(a,b,d),a=c;while(a!=k);a=this.fk(d);-1!=a?(k=this.Go(a,d),m=this.Go(g,d),k==a?(this.dm(d,g),this.Av(a,d),this.dm(d,a)):m==g&&this.Av(g,d),this.Qp(g,d,k),this.Sp(k,d,g),this.Qp(a,d,m),this.Sp(m,d,a)):this.dm(d,g)}}g=
this.rq(d);a=this.rq(e);for(k=this.Kg.gc(a);-1!=k;k=this.Kg.bb(k))this.a.lb(this.Kg.da(k),this.Yg,d);this.Kg.Qv(g,a);this.aM(e)};g.prototype.YP=function(d,e){var g=this.Uf(d,0),a=this.Uf(d,1),k=this.Uf(e,0),m=this.Uf(e,1);this.Cd.Qv(this.lh(d),this.lh(e));e==this.fk(g)&&this.dm(g,d);e==this.fk(a)&&this.dm(a,d);this.Os(e);this.Ns(e);g==k&&a==m||a==k&&g==m||(this.zm(g,this.mn),this.zm(k,this.Ck),this.mn.ub(this.Ck)?(g!=k&&this.Tl(g,k),a!=m&&this.Tl(a,m)):(a!=k&&this.Tl(a,k),g!=m&&this.Tl(g,m)))};g.prototype.Os=
function(d){var e=this.Uf(d,1);this.SB(d,this.Uf(d,0));this.SB(d,e)};g.prototype.SB=function(d,e){var g=this.Go(d,e),a=this.ZN(d,e),k=this.fk(e);g!=d?(this.Qp(a,e,g),this.Sp(g,e,a),k==d&&this.dm(e,g)):this.dm(e,-1)};g.prototype.YA=function(d,e,g){var a=this.Cd.gc(d),k=this.Cd.da(a);d=this.se(k);var m=this.se(this.a.X(k));this.a.Tp(k,e,g,!0);for(a=this.Cd.bb(a);-1!=a;a=this.Cd.bb(a)){var k=this.Cd.da(a),b=this.se(k)==d;this.a.Tp(k,e,g,b)}a=e.Io(g,0).Mb();e=e.Io(g,e.kk(g)-1).oc();this.yG(d,a);this.yG(m,
e)};g.prototype.PB=function(d,e,g){var a=this.lh(d),k=this.Uf(d,0),m=this.Uf(d,1),b=this.rr(-1);this.Mg.add(b);this.Nk(b,-3);this.sf.add(b);this.yi(b,k);d=1;for(e=e.kk(g);d<e;d++)g=this.Ul(-1),this.Hj.add(g),this.sf.add(g),this.yi(b,g),b=this.rr(-1),this.Mg.add(b),this.Nk(b,-3),this.sf.add(b),this.yi(b,g);this.yi(b,m);for(a=this.Cd.gc(a);-1!=a;a=this.Cd.bb(a))if(m=this.Cd.da(a),this.se(m)==k){d=0;do 0<d&&(b=this.sf.get(d-1),this.QA(b,m),-1==this.ow(b)&&this.Lp(b,this.a.gb(m))),b=this.sf.get(d),d+=
2,this.RA(b,m),m=this.a.X(m);while(d<this.sf.size)}else{d=this.sf.size-1;do d<this.sf.size-2&&(b=this.sf.get(d+1),this.QA(b,m),0>this.ow(b)&&this.Lp(b,this.a.gb(m))),b=this.sf.get(d),d-=2,this.RA(b,m),m=this.a.X(m);while(0<=d)}this.sf.clear(!1)};g.prototype.se=function(d){return this.a.Ra(d,this.Yg)};g.prototype.UE=function(d,e,g){var k=this.Uf(e,0),m=new a.b;this.zm(k,m);var b=new a.b,c=this.Uf(e,1);this.zm(c,b);var n=g.kk(d),v=g.Io(d,0),h=new a.b;v.ht(h);if(!m.ub(h)){if(!this.og){var l=m.compare(this.Xg),
h=h.compare(this.Xg);0>l*h&&(this.og=!0)}this.lC(k,this.sf);this.Hj.add(k)}!this.og&&1<n&&(l=m.compare(b),v=v.oc(),m.compare(v)!=l||v.compare(b)!=l?this.og=!0:0>v.compare(this.Xg)&&(this.og=!0));v=g.Io(d,n-1);d=v.oc();b.ub(d)||(this.og||(l=b.compare(this.Xg),h=d.compare(this.Xg),0>l*h&&(this.og=!0)),this.lC(c,this.sf),this.Hj.add(c));this.sf.add(e);b=0;for(c=this.sf.size;b<c;b++)d=this.sf.get(b),g=this.Eo(d),a.Fc.Zw(g)&&(this.zc.kd(g,-1),this.Nk(d,-1)),d!=e&&-3!=this.Eo(d)&&(this.Mg.add(d),this.Nk(d,
-3));this.sf.clear(!1)};g.prototype.NK=function(d,e){this.Ld.compare(this.zc,this.zc.da(d),e);this.Ld.Zf&&(this.Ld.lq(),this.dC(d,e))};g.prototype.dC=function(d,e){this.Nm=!0;d=this.zc.da(d);e=this.zc.da(e);var g,k;k=this.Cd.Dm(this.lh(d));var m=this.Cd.Dm(this.lh(e));g=this.a.cc(k);null==g&&(null==this.Vd&&(this.Vd=new a.yb),this.a.Oc(k,this.Vd),g=this.Vd);k=this.a.cc(m);null==k&&(null==this.Kl&&(this.Kl=new a.yb),this.a.Oc(m,this.Kl),k=this.Kl);this.Lj.zn(g);this.Lj.zn(k);this.Lj.Ga(this.ka,!0)&&
(this.og=!0);this.fG(d,e,-1,this.Lj);this.Lj.clear()};g.prototype.VM=function(d,e){this.Nm=!0;e=this.zc.da(e);var g,k=this.Cd.Dm(this.lh(e));g=this.a.cc(k);null==g&&(null==this.Vd&&(this.Vd=new a.yb),this.a.Oc(k,this.Vd),g=this.Vd);k=this.qC(d);this.Lj.zn(g);this.a.Jk(k,this.Zm);this.Lj.Tw(this.ka,this.Zm,!0);this.fG(e,-1,d,this.Lj);this.Lj.clear()};g.prototype.DO=function(){if(0!=this.Mg.size)for(;0!=this.Mg.size;){if(this.Mg.size>Math.max(100,this.a.pd)){this.Mg.clear(!1);this.og=!0;break}var d=
this.Mg.tc();this.Mg.af();this.Nk(d,-1);-1!=this.TO(d)&&this.CO(d);this.Mm=!1}};g.prototype.CO=function(d){var e;this.Mm?(e=this.zc.vs(this.lE,this.iE,d,!0),this.Mm=!1):e=this.zc.PA(d);-1==e?this.YP(this.zc.da(this.zc.tC()),d):(this.Nk(d,e),this.Ld.Zf&&(this.Ld.lq(),this.dC(this.Ld.Cl,e)))};g.prototype.TO=function(d){var e=this.Uf(d,0);d=this.Uf(d,1);this.zm(e,this.mn);this.zm(d,this.Ck);if(a.b.Zb(this.mn,this.Ck)<=this.Tx)return this.og=!0,-1;var g=this.mn.compare(this.Xg),k=this.Ck.compare(this.Xg);
return 0>=g&&0<k?d:0>=k&&0<g?e:-1};g.prototype.HM=function(){var d=new a.ga(0);d.xb(this.a.pd);for(var e=this.a.Gp(),g=e.next();-1!=g;g=e.next())-1!=this.a.Ra(g,this.Yg)&&d.add(g);this.a.Mu(d,d.size);this.IM(d)};g.prototype.IM=function(d){this.Ue.clear();this.Ue.de(d.size);this.Ue.Hn(new k(this.a));var e=new a.b;e.Eh();for(var g=-1,m=new a.b,b=0,c=d.size;b<c;b++){var n=d.get(b);this.a.uc(n,m);m.ub(e)?(n=this.a.Ra(n,this.Yg),this.Tl(g,n)):(g=this.se(n),this.a.uc(n,e),n=this.Ue.qm(n),this.Hr(g,n))}};
g.prototype.JM=function(){var d=new a.ga(0);d.xb(this.a.pd);for(var e=this.Ue.gc(-1);-1!=e;e=this.Ue.bb(e))d.add(this.Ue.da(e));this.Ue.clear();this.a.Mu(d,d.size);for(var e=0,g=d.size;e<g;e++){var k=d.get(e),m=this.se(k),k=this.Ue.qm(k);this.Hr(m,k)}};g.prototype.lC=function(d,e){var g=this.fk(d);if(-1!=g){var k=g;do a.Fc.Zw(this.Eo(k))&&e.add(k),k=this.Go(k,d);while(k!=g)}};g.prototype.yG=function(d,e){for(d=this.Kg.gc(this.rq(d));-1!=d;d=this.Kg.bb(d))this.a.Yi(this.Kg.da(d),e)};g.prototype.fG=
function(d,e,g,a){this.Os(d);-1!=e&&this.Os(e);this.UE(0,d,a);-1!=e&&this.UE(1,e,a);-1!=g&&(a.nf.w(this.mn),this.zm(g,this.Ck),this.Ck.ub(this.mn)||this.Hj.add(g));g=0;for(var k=this.Hj.size;g<k;g++){var m=this.Hj.get(g),b=this.nw(m);-1!=b&&(this.Ue.kd(b,-1),this.Hr(m,-1))}g=this.lh(d);k=-1!=e?this.lh(e):-1;this.YA(g,a,0);-1!=e&&this.YA(k,a,1);this.PB(d,a,0);-1!=e&&this.PB(e,a,1);this.Cd.Fg(g);this.Ns(d);-1!=e&&(this.Cd.Fg(k),this.Ns(e));g=0;for(k=this.Hj.size;g<k;g++)m=this.Hj.get(g),m==this.rp&&
(this.Ht=!0),b=this.nw(m),-1==b&&(b=this.Ue.PA(this.qC(m)),-1==b?(d=this.se(this.Ue.da(this.Ue.tC())),this.Tl(d,m)):this.Hr(m,b));this.Hj.clear(!1)};g.prototype.zm=function(d,e){this.a.SC(this.ow(d),e)};g.prototype.qC=function(d){return this.Kg.Dm(this.rq(d))};g.prototype.Xy=function(){this.Ht=!1;this.rp=-1;null==this.Ld&&(this.zc.Ct=!1,this.Ld=new e(this),this.zc.Qm=this.Ld);var g=new a.ga(0),k=null,m=null,c=0;this.iE=this.lE=-1;this.Mm=!1;for(var n=this.Ue.gc(-1);-1!=n;){c++;this.Mm=!1;var h=this.Ue.da(n);
this.rp=this.se(h);this.a.uc(h,this.Xg);this.Ld.XF(this.Xg.y,this.Xg.x);var l,q=this.fk(this.rp);l=-1==q;if(!l){h=q;do{var u=this.Eo(h);-1==u?(this.Mg.add(h),this.Nk(h,-3)):-3!=u&&g.add(u);h=this.Go(h,this.rp)}while(h!=q)}if(0<g.size){this.Mm=1==g.size&&1==this.Mg.size;l=0;for(q=g.size;l<q;l++)h=this.zc.da(g.get(l)),this.Nk(h,-2);var f=-2,A=-2;l=0;for(q=g.size;l<q;l++){u=g.get(l);if(-2==f){var p=this.zc.ge(u);-1!=p?(h=this.zc.da(p),h=this.Eo(h),-2!=h&&(f=p)):f=-1}-2==A&&(u=this.zc.bb(u),-1!=u?(h=
this.zc.da(u),h=this.Eo(h),-2!=h&&(A=u)):A=-1);if(-2!=f&&-2!=A)break}l=0;for(q=g.size;l<q;l++)u=g.get(l),h=this.zc.da(u),this.zc.kd(u,-1),this.Nk(h,-1);g.clear(!1);this.lE=-1!=f?f:-1;this.iE=-1!=A?A:-1;-1!=f&&-1!=A?this.Mm||this.NK(f,A):-1==f&&-1==A&&(this.Mm=!1)}else l&&(null==k&&(k=new d(this)),k.bh(this.Xg),this.zc.sF(k),k.Zf&&(k.lq(),this.VM(this.rp,k.Cl)));this.DO();this.Ht?(this.Ht=!1,null==m&&(m=new b(this.a)),m.bh(this.Xg),n=this.Ue.sF(m)):n=this.Ue.bb(n)}return this.Nm};g.prototype.Op=function(d){this.a=
d;this.Yg=this.a.re();this.$a.de(d.pd+32);this.nd.de(d.pd);this.Kg.Dr(d.pd);this.Kg.$l(d.pd);this.Cd.Dr(d.pd+32);this.Cd.$l(d.pd+32);for(d=this.a.$c;-1!=d;d=this.a.we(d))if(a.T.Kc(this.a.Lb(d)))for(n=this.a.Vb(d);-1!=n;n=this.a.bc(n)){var e=this.a.Ha(n),g=this.a.Cb(n),k=this.Ul(g),m=this.rr(g);this.yi(m,k);h=this.a.X(g);g=0;for(e-=2;g<e;g++){var b=this.a.X(h),c=this.Ul(h);this.yi(m,c);m=this.rr(h);this.yi(m,c);h=b}this.a.vc(n)?(c=this.Ul(h),this.yi(m,c),m=this.rr(h),this.yi(m,c),this.yi(m,k)):(c=
this.Ul(h),this.yi(m,c))}else for(var n=this.a.Vb(d);-1!=n;n=this.a.bc(n))for(var h=this.a.Cb(n),k=0,e=this.a.Ha(n);k<e;k++)this.Ul(h),h=this.a.X(h);this.HM()};return g}();a.aA=g})(x||(x={}));(function(a){var k=function(k){function e(d,e,m){k.call(this);if(void 0!==d)if(void 0!==m){this.description=a.Od.Tf();var g=new a.ee;g.K(d,e,m);this.Py(g)}else if(void 0!==e)this.description=a.Od.Tf(),this.ic(d,e);else if(d instanceof a.pa)this.description=d;else if(d instanceof a.b)this.description=a.Od.Tf(),
this.ic(d);else throw a.g.N();else this.description=a.Od.Tf()}A(e,k);e.prototype.w=function(d){if(void 0!==d){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");d.ma(this.fa[0],this.fa[1])}else{if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");d=new a.b;d.ma(this.fa[0],this.fa[1]);return d}};e.prototype.ic=function(d,e){"number"===typeof d?(this.qc(),null==this.fa&&this.ko(),this.fa[0]=d,this.fa[1]=e):(this.qc(),this.ic(d.x,
d.y))};e.prototype.Lw=function(){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");var d=new a.ee;d.x=this.fa[0];d.y=this.fa[1];this.description.WC()?d.z=this.fa[2]:d.z=a.pa.ue(1);return d};e.prototype.Py=function(d){this.qc();var e=this.hasAttribute(1);e||a.pa.nD(1,d.z)||(this.Ne(1),e=!0);null==this.fa&&this.ko();this.fa[0]=d.x;this.fa[1]=d.y;e&&(this.fa[2]=d.z)};e.prototype.lk=function(){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");
return this.fa[0]};e.prototype.qS=function(d){this.setAttribute(0,0,d)};e.prototype.mk=function(){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");return this.fa[1]};e.prototype.$F=function(d){this.setAttribute(0,1,d)};e.prototype.lO=function(){return this.ld(1,0)};e.prototype.rS=function(d){this.setAttribute(1,0,d)};e.prototype.NN=function(){return this.ld(2,0)};e.prototype.bS=function(d){this.setAttribute(2,0,d)};e.prototype.Qc=function(){return this.nC(3,
0)};e.prototype.ld=function(d,e){var g=this.description.zf(d);return 0<=g?this.fa[this.description.fj(g)+e]:a.pa.ue(d)};e.prototype.nC=function(d,e){var g=this.description.zf(d);return 0<=g?this.fa[this.description.fj(g)+e]:a.pa.ue(d)};e.prototype.setAttribute=function(d,e,a){this.qc();var g=this.description.zf(d);0>g&&(this.Ne(d),g=this.description.zf(d));null==this.fa&&this.ko();this.fa[this.description.fj(g)+e]=a};e.prototype.D=function(){return 33};e.prototype.fb=function(){return 0};e.prototype.Ja=
function(){this.qc();null!=this.fa&&(this.fa[0]=NaN,this.fa[1]=NaN)};e.prototype.nm=function(d){if(null!=this.fa){for(var e=a.Od.iu(d,this.description),k=[],b=0,c=0,n=d.Aa;c<n;c++){var h=d.Hd(c),l=a.pa.Wa(h);if(-1==e[c])for(var q=a.pa.ue(h),h=0;h<l;h++)k[b]=q,b++;else for(q=this.description.fj(e[c]),h=0;h<l;h++)k[b]=this.fa[q],b++,q++}this.fa=k}this.description=d};e.prototype.ko=function(){this.iF(this.description.le.length);e.ob(this.description.le,this.fa,this.description.le.length);this.fa[0]=
NaN;this.fa[1]=NaN};e.prototype.Oe=function(d){if(d instanceof a.Bg){if(!this.sc()){var e=this.w();d.Zi(e,e);this.ic(e)}}else this.sc()||(this.Ne(1),e=this.Lw(),this.Py(d.Qn(e)))};e.prototype.copyTo=function(d){if(33!=d.D())throw a.g.N();d.qc();null==this.fa?(d.Ja(),d.fa=null,d.Qf(this.description)):(d.Qf(this.description),d.iF(this.description.le.length),e.ob(this.fa,d.fa,this.description.le.length))};e.prototype.Pa=function(){return new e(this.description)};e.prototype.s=function(){return this.sc()};
e.prototype.sc=function(){return null==this.fa||isNaN(this.fa[0])||isNaN(this.fa[1])};e.prototype.Fp=function(d){d.Ja();this.description!=d.description&&d.Qf(this.description);d.Db(this)};e.prototype.o=function(d){this.sc()?d.Ja():(d.v=this.fa[0],d.C=this.fa[1],d.B=this.fa[0],d.G=this.fa[1])};e.prototype.Cn=function(d){if(this.sc())d.Ja();else{var e=this.Lw();d.v=e.x;d.C=e.y;d.Je=e.z;d.B=e.x;d.G=e.y;d.ig=e.z}};e.prototype.Ah=function(d,e){var g=new a.Nd;if(this.sc())return g.Ja(),g;d=this.ld(d,e);
g.qa=d;g.va=d;return g};e.prototype.iF=function(d){if(null==this.fa)this.fa=a.I.Lh(d);else if(this.fa.length<d){for(var e=this.fa.slice(0),k=this.fa.length;k<d;k++)e[k]=0;this.fa=e}};e.ob=function(d,e,a){if(0<a)for(a=0;a<d.length;a++)e[a]=d[a]};e.prototype.lc=function(d){if(d==this)return!0;if(!(d instanceof e)||this.description!=d.description)return!1;if(this.sc())return d.sc()?!0:!1;for(var g=0,a=this.description.le.length;g<a;g++)if(this.fa[g]!=d.fa[g])return!1;return!0};e.prototype.hc=function(){var d=
this.description.hc();if(!this.sc())for(var e=0,k=this.description.le.length;e<k;e++)var b=this.fa[e],b=a.I.truncate(b^b>>>32),d=a.I.kg(b,d);return d};e.prototype.Rf=function(){return null};return e}(a.T);a.Va=k})(x||(x={}));(function(a){var k=function(){function a(e,d,g){void 0!==e&&(this.x=e,this.y=d,this.z=g)}a.Oa=function(e,d,g){var k=new a;k.x=e;k.y=d;k.z=g;return k};a.prototype.K=function(e,d,g){this.x=e;this.y=d;this.z=g};a.prototype.Lu=function(){this.z=this.y=this.x=0};a.prototype.normalize=
function(){var e=this.length();0==e&&(this.x/=e,this.y/=e,this.z/=e)};a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};a.prototype.sub=function(e){return new a(this.x-e.x,this.y-e.y,this.z-e.z)};a.prototype.Ap=function(e){return new a(this.x*e,this.y*e,this.z*e)};a.prototype.FA=function(){this.x=NaN};a.prototype.pv=function(){return isNaN(this.x)};return a}();a.ee=k})(x||(x={}));(function(a){var k=function(){function k(e,d,g){this.gu=this.Yt=null;this.Gf=
d;this.KP=d.y-g;this.JP=d.y+g;this.xp=0;this.ix=e;this.ka=g;this.UP=g*g;this.jx=0!=g;this.xt=!1}k.prototype.result=function(){return 0!=this.xp?1:0};k.prototype.DJ=function(e){e=e.Kb(e.Gd(this.Gf,!1));return a.b.Zb(e,this.Gf)<=this.UP?!0:!1};k.prototype.WB=function(e){if(!this.jx&&(this.ix&&this.Gf.ub(e.Mb())||this.Gf.ub(e.oc())))this.xt=!0;else if(e.ja==this.Gf.y&&e.ja==e.ha){if(this.ix&&!this.jx){var d=Math.max(e.na,e.la);this.Gf.x>Math.min(e.na,e.la)&&this.Gf.x<d&&(this.xt=!0)}}else{var g=!1,d=
Math.max(e.na,e.la);this.Gf.x>d?g=!0:this.Gf.x>=Math.min(e.na,e.la)&&(g=0<e.nt(!0,this.Gf.y,this.gu,null)&&this.gu[0]<=this.Gf.x);if(g){if(this.Gf.y==e.Mb().y){if(this.Gf.y<e.oc().y)return}else if(this.Gf.y==e.oc().y&&this.Gf.y<e.Mb().y)return;this.xp=this.ix?this.xp^1:this.xp+(e.Mb().y>e.oc().y?1:-1)}}};k.prototype.zr=function(e){var d=e.Ah(0,1);if(d.qa>this.JP||d.va<this.KP)return!1;if(this.jx&&this.DJ(e))return!0;if(d.qa>this.Gf.y||d.va<this.Gf.y)return!1;null==this.Yt&&(this.Yt=[null,null,null,
null,null]);null==this.gu&&(this.gu=[0,0,0]);d=e.TC(this.Yt);if(0<d)for(e=0;e<d;e++){var g=this.Yt[e].get();this.WB(g);if(this.xt)return!0}else if(this.WB(e),this.xt)return!0;return!1};k.V=function(e,d,g){d=new k(0==e.Cm(),d,g);for(e=e.Ca();e.kb();)for(;e.La();)if(g=e.ia(),d.zr(g))return-1;return d.result()};k.Bd=function(e,d,g,m){var b=new a.i;e.dd(b);b.P(m,m);var c=new k(0==e.Cm(),g,m);e=e.Ca();var n=new a.i;n.K(b);n.B=g.x+m;n.C=g.y-m;n.G=g.y+m;g=d.xw(n,m);for(m=g.next();-1!=m;m=g.next())if(e.Sb(d.da(m)),
e.La()&&(m=e.ia(),c.zr(m)))return-1;return c.result()};k.xl=function(e,d,g){if(e.s())return 0;var m=new a.i;e.dd(m);m.P(g,g);if(!m.contains(d))return 0;m=e.pb;if(null!=m){var b=m.hi;if(null!=b){b=b.Kk(d.x,d.y);if(1==b)return 1;if(0==b)return 0}m=m.Ab;if(null!=m)return k.Bd(e,m,d,g)}return k.V(e,d,g)};k.aP=function(e,d,g,m){if(e.s())return 0;var b=new a.i;e.dd(b);b.P(m,m);if(!b.contains(d,g))return 0;b=e.pb;if(null!=b&&(b=b.hi,null!=b)){b=b.Kk(d,g);if(1==b)return 1;if(0==b)return 0}return k.V(e,a.b.Oa(d,
g),m)};k.$O=function(e,d,g){return d.s()?0:k.xl(e,d.w(),g)};k.vD=function(e,d,g,b,c){var m=new a.i;e.dd(m);m.P(b,b);if(!m.contains(g))return 0;var n=new k(!0,g,b);if(null!=c){var h=new a.i;h.K(m);h.B=g.x+b;h.C=g.y-b;h.G=g.y+b;e=e.Ca();b=c.xw(h,b);for(h=b.next();-1!=h;h=b.next())if(e.Sb(c.da(h),d),e.La()&&e.Qa==d&&(h=e.ia(),n.zr(h)))return-1}else if(e=e.Ca(),e.vy(d),e.kb())for(;e.La();)if(h=e.ia(),n.zr(h))return-1;return n.result()};k.tD=function(e,d,g){var b=new a.i;e.dd(b);b.P(g,g);if(!b.contains(d))return 0;
d=new k(!1,d,g);for(g=e.Ca();g.kb();)if(!(0>e.oo(g.Qa))){for(d.xp=0;g.La();)if(b=g.ia(),d.zr(b))return-1;if(0!=d.xp)return 1}return d.result()};k.$i=function(e,d,g,b,c){var m=e.Ca();m.vy(d);if(!m.kb()||!m.La())throw a.g.ra("corrupted geometry");for(d=2;2==d&&m.La();)d=m.ia().Kb(.5),d=k.vD(e,g,d,b,c);if(2==d)throw a.g.ra("internal error");return 1==d?!0:!1};k.An=function(e,d){e=e.F();return 16>e?!1:2*e+Math.log(e)/Math.log(2)*1*d<1*e*d};return k}();a.ff=k})(x||(x={}));(function(a){var k=function(a){function e(d){a.call(this,
!0,d)}A(e,a);e.prototype.Pa=function(){return new e(this.description)};e.prototype.fb=function(){return 2};e.prototype.D=function(){return 1736};return e}(a.al);a.Ka=k})(x||(x={}));(function(a){(function(a){a[a.PiPOutside=0]="PiPOutside";a[a.PiPInside=1]="PiPInside";a[a.PiPBoundary=2]="PiPBoundary"})(a.pI||(a.pI={}));var k=function(){function k(){}k.uD=function(e,d,g){e=a.ff.$O(e,d,g);return 0==e?0:1==e?1:2};k.he=function(e,d,g){e=a.ff.xl(e,d,g);return 0==e?0:1==e?1:2};k.CH=function(e,d,g,k){e=a.ff.aP(e,
d,g,k);return 0==e?0:1==e?1:2};k.gU=function(e,d,g,k){return 0==a.ff.vD(e,d,g,k,null)?0:1};k.tD=function(e,d,g){return 0==a.ff.tD(e,d,g)?0:1};k.ZS=function(e,d,g,b,c){if(d.length<g||c.length<g)throw a.g.N();for(var m=0;m<g;m++)c[m]=k.he(e,d[m],b)};k.eT=function(e,d,g,b,c){if(d.length/2<g||c.length<g)throw a.g.N();for(var m=0;m<g;m++)c[m]=k.CH(e,d[2*m],d[2*m+1],b)};k.nG=function(e,d,g,b,c){if(1736==e.D())k.ZS(e,d,g,b,c);else if(197==e.D()){var m=new a.i;e.o(m);k.jP(m,d,g,b,c)}else throw a.g.ra("invalid_call");
};k.nU=function(e,d,g,b,c){if(1736==e.D())k.eT(e,d,g,b,c);else if(197==e.D()){var m=new a.i;e.o(m);k.mP(m,d,g,b,c)}else throw a.g.xa();};k.jP=function(e,d,g,k,b){if(d.length<g||b.length<g)throw a.g.N();if(e.s())for(k=0;k<g;k++)b[k]=0;else for(e.P(.5*-k,.5*-k),e.P(.5*k,.5*k),k=0;k<g;k++)e.contains(d[k])?b[k]=1:e.contains(d[k])?b[k]=2:b[k]=0};k.mP=function(e,d,g,k,b){if(d.length/2<g||b.length<g)throw a.g.N();if(e.s())for(k=0;k<g;k++)b[k]=0;else for(e.P(.5*-k,.5*-k),e.P(.5*k,.5*k),k=0;k<g;k++)e.contains(d[2*
k],d[2*k+1])?b[k]=1:e.contains(d[2*k],d[2*k+1])?b[k]=2:b[k]=0};k.lT=function(e,d,g,a,k){for(var b=0;b<g;b++)k[b]=e.Eq(d[b],a)?2:0};k.hT=function(e,d,g,a,k){var b=e.pb,m=null;null!=b&&(m=b.hi);for(var b=g,c=0;c<g;c++)if(k[c]=1,null!=m){var n=d[c];0==m.Kk(n.x,n.y)&&(k[c]=0,b--)}if(0!=b)for(e=e.Ca();e.kb()&&0!=b;)for(;e.La()&&0!=b;)for(m=e.ia(),c=0;c<g&&0!=b;c++)1==k[c]&&m.Eq(d[c],a)&&(k[c]=2,b--);for(c=0;c<g;c++)1==k[c]&&(k[c]=0)};k.oG=function(e,d,g,b,c){var m=e.D();if(1607==m)k.hT(e,d,g,b,c);else if(a.T.Lc(m))k.lT(e,
d,g,b,c);else throw a.g.ra("Invalid call.");};return k}();a.gd=k})(x||(x={}));(function(a){var k=function(a){function e(d,e){2==arguments.length?(a.call(this,!1,d.description),this.df(d),this.lineTo(e)):a.call(this,!1,d)}A(e,a);e.prototype.Pa=function(){return new e(this.description)};e.prototype.fb=function(){return 1};e.prototype.D=function(){return 1607};return e}(a.al);a.Xa=k})(x||(x={}));(function(a){var k=function(){function a(){}a.GT=function(){};return a}();a.RT=k})(x||(x={}));(function(a){var k=
function(){function e(){}e.Rv=function(d){return d*e.rQ};e.aG=function(d,g){return e.cR(g-d)};e.kR=function(d){if(-360<=d&&720>d)return 0>d?d+=360:360<=d&&(d-=360),d;d=a.vi.gH(d);0>d&&(d+=360);return d};e.cR=function(d){d=e.kR(d);180<d&&(d-=360);return d};e.OT=.0174532925199433;e.rQ=57.29577951308232;return e}(),b=function(){function e(){}e.qo=function(d,e){var g=new a.i;d.o(g);var k=a.Ya.Fm(e),b=new a.i;b.K(k);b.v=g.v;b.B=g.B;b.P(.01*b.ba(),0);k=a.Ia.zd(e,g,!1);return b.contains(g)?d:a.Ed.clip(d,
b,k,0)};e.Rw=function(d,g,k,b){if(!a.Ya.Qo(g))throw a.g.N();var m=a.Ia.Cg(g,d,!1),c=a.Ya.Fm(g),n=a.Ya.Em(g),h=n.Se().Dj,v=a.Ya.ft(n),n=a.Ya.Ts(n),v=v*(2-v),l=new a.Nd;c.wu(l);var q=[[0,0],[0,0]];2==a.Nf.Am(g)?(q[0][0]=e.pu(b,l),q[0][1]=c.Vs(),a.Ya.tu(),c=q[0][0]*h):c=b*h;var u=new a.ca,f=new a.fd;d=f.Eb(d);for(var A=[0],p=new a.b,x=new a.b,w=new a.b,t=new a.b,C=new a.b,y=new a.b,z=f.Vb(d);-1!=z;z=f.bc(z)){var E=f.Cb(z);f.w(E,w);for(var I=!1,J=E=f.X(E);-1!=J;J=f.X(J)){if(J==E){if(I)break;I=!0}f.w(J,
t);if((m<b-w.x&&t.x-b>m||m<b-t.x&&w.x-b>m||m<-t.y&&w.y>m)&&!(Math.abs(w.x-t.x)>=.5*l.aa())&&(2==a.Nf.Am(g)?(q[0][0]=e.pu(w.x,l),q[0][1]=w.y,q[1][0]=e.pu(t.x,l),q[1][1]=t.y,a.Ya.YQ(),C.x=q[0][0]*h,C.y=q[0][1]*h,y.x=q[1][0]*h,y.y=q[1][1]*h):(C.x=w.x*h,C.y=w.y*h,y.x=t.x*h,y.y=t.y*h),y.x=6.283185307179586*(t.x-w.x)/l.aa()+C.x,x.x=c,x.y=e.yH(n,v,C,y,c,k),!isNaN(x.y))){a.zb.Rd(n,v,C.x,C.y,y.x,y.y,u,null,null,k);var K=u.l;a.zb.Rd(n,v,C.x,C.y,x.x,x.y,u,null,null,k);var G=u.l;2==a.Nf.Am(g)?(q[0][0]=x.x/h,
q[0][1]=x.y/h,a.Ya.qN(),p.y=q[0][1],p.x=b):(p.x=b,p.y=x.y/h);A[0]=0<K?a.I.Kr(G/K,0,1):.5;0!=A[0]&&1!=A[0]&&(K=f.Ua(J),f.Mr(K,A,1),f.ic(f.X(K),p.x,p.y))}w.J(t)}}return f.hf(d)};e.aN=function(d,g,k){if(d.s())return d;var b=a.Ya.IC(g);return e.gC(d,0-180*b,360*b,g,k)};e.yH=function(d,g,k,b,c,n){if(3.141592653589793<=Math.abs(k.x-b.x)||!e.Jv(k.x,b.x,c))return NaN;var m;k.x>b.x?m=b:(m=k,k=b);b=new a.ca(0);var h=new a.ca(0),v=new a.ca(0);a.zb.Rd(d,g,m.x,m.y,k.x,k.y,h,b,null,n);var l=h.l,q=0,u=1,f=new a.b;
for(f.J(m);l*(u-q)>1E-12*d;){var A=.5*(q+u);a.zb.dk(d,g,m.x,m.y,l*A,b.l,h,v,n);f.x=h.l;f.y=v.l;if(f.x==c)break;if(e.Jv(m.x,f.x,c))u=A;else if(e.Jv(k.x,f.x,c))q=A;else return NaN}return f.y};e.Jv=function(d,e,a){d=k.Rv(d);e=k.aG(d,k.Rv(e));a=k.aG(d,k.Rv(a));return 0==a||0<e&&0<a&&a<=e||0>e&&0>a&&a>=e?!0:!1};e.pu=function(d,e){var g=e.va-e.qa;return e.Sy(d-Math.floor((d-e.qa)/g)*g)};e.eU=function(d,e,k,b){var g=new a.Nd;g.K(e,k);k=b.aa();d=Math.floor((d-e)/k)*k+d;for(g=g.Af();Math.abs(d-g)>Math.abs(d+
k-g);)d+=k;return d};e.cU=function(d,e,k,b,c){var g;k.y>b.y?g=b:(g=k,k=b);b=new a.Nd;b.K(g.y,k.y);if(!b.contains(0)||3.141592653589793<=Math.abs(g.x-k.x))return NaN;if(g.x==k.x)return g.x;var m=new a.ca(0),n=new a.ca(0),h=new a.ca(0);a.zb.Rd(d,e,g.x,g.y,k.x,k.y,n,m,null,c);var v=n.l,l=0,q=1,u=new a.b;for(u.J(g);v*(q-l)>1E-12*d;){var f=.5*(l+q);a.zb.dk(d,e,g.x,g.y,v*f,m.l,n,h,c);u.x=n.l;u.y=h.l;b.K(g.y,u.y);if(0==u.y)break;if(b.contains(0))q=f;else if(b.K(k.y,u.y),b.contains(0))l=f;else return NaN}return u.x};
e.gC=function(d,e,k,b,c){var g=new a.i;d.o(g);if(g.s())return d;var m=new a.Nd;g.wu(m);var n=new a.Nd;n.K(e,e+k);if(n.contains(m)&&n.va!=m.va)return d;var h=new a.i;h.K(g);var v=d.D();if(33==v){h=c?d:d.vm();g=h.lk();if(g<n.qa||g>=n.va||g==n.va)g+=Math.ceil((n.qa-g)/k)*k,g=n.Sy(g),h.qS(g);return h}if(550==v){h=c?d:d.vm();b=h.mc(0);v=2*h.F();d=!1;for(c=0;c<v;c+=2)if(g=b.read(c),g<n.qa||g>=n.va||g==n.va)d=!0,g+=Math.ceil((n.qa-g)/k)*k,g=n.Sy(g),b.write(c,g);d&&h.ce(1993);return h}if(n.contains(m))return d;
if(197==v)return k=c?d:d.vm(),g.Ga(h),k.Cu(g),k;var l=.1*Math.max(g.ba(),g.aa());h.P(0,l);n=d;d=b.Ko();c=a.wi.local();for(var q=new a.Bg,u=0;;){var f=Math.floor((m.qa-e)/k),A=Math.ceil((m.va-e)/k);if(3<A-f){f=Math.floor(.5*(A+f));h.v=g.v-l;h.B=e+k*f;var p=a.Ed.clip(n,h,d,0);h.v=h.B;h.B=g.B+l;var D=a.Ed.clip(n,h,d,0);q.Nn((f-A)*k,0);D.Oe(q);1736==v?n=c.$(p,D,b,null):(n=p,n.add(D,!1));n.o(g);g.wu(m);u++}else break}h.v=e;h.B=e+k;e=new a.i;e.K(h);e.P(d,0);e=Math.floor((g.v-h.v)/k)*k;0!=e?(h.move(e,0),
q.Nn(-e,0)):q.IF();e=1607==v?new a.Xa(n.description):new a.Ka(n.description);m=new a.i;for(l=new a.i;g.B>h.v;){u=a.Ed.clip(n,h,d,0);u.o(l);if(1607==v?!u.s()&&(l.aa()>d||l.ba()>d):!u.s()&&(1736!=v||l.aa()>d))u.Oe(q),u.o(l),e.o(m),m.P(d,d),m.jc(l)&&1736==v?e=c.$(e,u,b,null):e.add(u,!1);h.move(k,0);q.shift(-k,0)}return e};e.ZQ=function(d,e,k,b){var g=new a.pe(k.description);g.Pd(k,0,-1);var g=a.Ya.Wl(g,d,e),m=k.F();b.Ja();if(!a.Ya.Qo(d)||m!=g.F())return!1;var c=new a.i;k.o(c);var n=new a.i;g.o(n);c=
c.aa();n=n.aa();if(0!=c&&0!=n){if(n/=c,d=a.Ya.Fm(e).aa()/a.Ya.Fm(d).aa(),1E-10<Math.abs(n/d-1))return!1}else if(0!=c||0!=n)return!1;b.add(k,!1);for(k=0;k<m;k++)d=g.Fa(k),b.ic(k,d);return!0};e.dU=function(){throw a.g.qe();};return e}();a.gh=b})(x||(x={}));(function(a){(function(a){a[a.rightSide=1]="rightSide"})(a.sI||(a.sI={}));var k=function(){function k(e,d,g){this.Nq=new a.b;void 0===e?this.tn=-1:(this.Nq.J(e),this.tn=d,this.Da=g,this.Ut=0)}k.prototype.UF=function(e){this.Ut=e?this.Ut|1:this.Ut&
-2};k.prototype.s=function(){return 0>this.tn};k.prototype.pw=function(){if(this.s())throw a.g.ra("invalid call");return new a.Va(this.Nq.x,this.Nq.y)};k.prototype.gb=function(){if(this.s())throw a.g.ra("invalid call");return this.tn};k.prototype.sw=function(){if(this.s())throw a.g.ra("invalid call");return this.Da};k.prototype.Xw=function(){return 0!=(this.Ut&1)};k.prototype.tv=function(e,d,g,a){this.Nq.x=e;this.Nq.y=d;this.tn=g;this.Da=a};return k}();a.dl=k})(x||(x={}));(function(a){var k=function(){function e(){}
e.prototype.Fn=function(d,e){this.Vg.resize(0);this.ai.length=0;this.Aj=-1;d.dd(this.Kj);this.Kj.P(e,e);this.Kj.jc(this.Ab.Qb)?((this.Iq=a.T.Lc(d.D()))?(this.rE=d.Mb(),this.qE=d.oc(),this.ka=e):this.ka=NaN,this.Vg.add(this.Ab.Ze),this.ai.push(this.Ab.Qb),this.ar=this.Ab.sq(this.Ab.Ze)):this.ar=-1};e.prototype.Ch=function(d,e){this.Vg.resize(0);this.ai.length=0;this.Aj=-1;this.Kj.K(d);this.Kj.P(e,e);this.ka=NaN;this.Kj.jc(this.Ab.Qb)?(this.Vg.add(this.Ab.Ze),this.ai.push(this.Ab.Qb),this.ar=this.Ab.sq(this.Ab.Ze),
this.Iq=!1):this.ar=-1};e.prototype.next=function(){if(0==this.Vg.size)return-1;this.Aj=this.ar;var d=null,e=null,k,c=null,n=null;this.Iq&&(d=new a.b,e=new a.b,c=new a.i);for(var h=!1;!h;){for(;-1!=this.Aj;){k=this.Ab.kw(this.Ab.Us(this.Aj));if(k.jc(this.Kj))if(this.Iq){if(d.J(this.rE),e.J(this.qE),c.K(k),c.P(this.ka,this.ka),0<c.Nv(d,e)){h=!0;break}}else{h=!0;break}this.Aj=this.Ab.at(this.Aj)}if(-1==this.Aj){k=this.Vg.tc();var l=this.ai[this.ai.length-1];null==n&&(n=[],n[0]=new a.i,n[1]=new a.i,
n[2]=new a.i,n[3]=new a.i);b.BF(l,n);this.Vg.af();--this.ai.length;for(l=0;4>l;l++){var q=this.Ab.zo(k,l);if(-1!=q&&0<this.Ab.gO(q)&&n[l].jc(this.Kj))if(this.Iq){if(d.J(this.rE),e.J(this.qE),c.K(n[l]),c.P(this.ka,this.ka),0<c.Nv(d,e)){var u=new a.i;u.K(n[l]);this.Vg.add(q);this.ai.push(u)}}else u=new a.i,u.K(n[l]),this.Vg.add(q),this.ai.push(u)}if(0==this.Vg.size)return-1;this.Aj=this.Ab.sq(this.Vg.get(this.Vg.size-1))}}this.ar=this.Ab.at(this.Aj);return this.Aj};e.HL=function(d,g,k){var b=new e;
b.Ab=d;b.Kj=new a.i;b.Vg=new a.ga(0);b.ai=[];b.Fn(g,k);return b};e.GL=function(d,g,k){var b=new e;b.Ab=d;b.Kj=new a.i;b.Vg=new a.ga(0);b.ai=[];b.Ch(g,k);return b};e.FL=function(d){var g=new e;g.Ab=d;g.Kj=new a.i;g.Vg=new a.ga(0);g.ai=[];return g};return e}();a.TT=k;var b=function(){function e(d,e){this.Ye=new a.Fc(11);this.qh=new a.Fc(5);this.Jq=[];this.Rt=new a.ga(0);this.Qb=new a.i;this.Rj(d,e)}e.prototype.reset=function(d,e){this.Ye.Nh(!1);this.qh.Nh(!1);this.Jq.length=0;this.Rt.clear(!1);this.Rj(d,
e)};e.prototype.lg=function(d,e){return this.lt(d,e,0,this.Qb,this.Ze,!1,-1)};e.prototype.kt=function(d,e,a){a=-1==a?this.Ze:this.KC(a);var g=this.ba(a),k=this.CN(a);return this.lt(d,e,g,k,a,!1,-1)};e.prototype.da=function(d){return this.yN(d)};e.prototype.uC=function(d){return this.kw(this.Us(d))};e.prototype.ba=function(d){return this.Xs(d)};e.prototype.CN=function(d){var e=new a.i;e.K(this.Qb);var k=this.Xs(d);d=this.EC(d);for(var b=0;b<2*k;b+=2){var c=a.I.truncate(3&d>>b);0==c?(e.v=.5*(e.v+e.B),
e.C=.5*(e.C+e.G)):1==c?(e.B=.5*(e.v+e.B),e.C=.5*(e.C+e.G)):(2==c?e.B=.5*(e.v+e.B):e.v=.5*(e.v+e.B),e.G=.5*(e.C+e.G))}return e};e.prototype.gO=function(d){return this.Kw(d)};e.prototype.KN=function(d,e){return k.HL(this,d,e)};e.prototype.xw=function(d,e){return k.GL(this,d,e)};e.prototype.Re=function(){return k.FL(this)};e.prototype.Rj=function(d,e){if(0>e||32<2*e)throw a.g.N("invalid height");this.GP=e;this.Qb.K(d);this.Ze=this.Ye.be();this.Ku(this.Ze,0);this.Eu(this.Ze,0);this.LF(this.Ze,0);this.HF(this.Ze,
0)};e.prototype.lt=function(d,g,k,b,c,n,h){if(!b.contains(g))return 0==k?-1:this.lt(d,g,0,this.Qb,this.Ze,n,h);if(!n)for(var m=c;-1!=m;m=this.UN(m))this.Ku(m,this.Kw(m)+1);m=new a.i;m.K(b);b=c;var v=[];v[0]=new a.i;v[1]=new a.i;v[2]=new a.i;for(v[3]=new a.i;k<this.GP&&this.IK(b);k++){e.BF(m,v);for(var l=!1,q=0;4>q;q++)if(v[q].contains(g)){var l=!0,u=this.zo(b,q);-1==u&&(u=this.OL(b,q));this.Ku(u,this.Kw(u)+1);b=u;m.K(v[q]);break}if(!l)break}return this.zO(d,g,k,m,b,n,c,h)};e.prototype.zO=function(d,
e,a,k,b,c,n,h){var g=this.AC(b);if(c){if(b==n)return h;this.mM(h);c=h}else c=this.QL(),this.By(c,d),this.IR(this.Us(c),e);this.gS(c,b);-1!=g?(this.Ju(c,g),this.Fu(g,c)):this.DF(b,c);this.Fy(b,c);this.Eu(b,this.Zs(b)+1);this.HK(b)&&this.$M(a,k,b);return c};e.prototype.mM=function(d){var e=this.KC(d),a=this.AC(e),k=this.$N(d),b=this.at(d);this.sq(e)==d?(-1!=b?this.Ju(b,-1):this.Fy(e,-1),this.DF(e,b)):a==d?(this.Fu(k,-1),this.Fy(e,k)):(this.Ju(b,k),this.Fu(k,b));this.Ju(d,-1);this.Fu(d,-1);this.Eu(e,
this.Zs(e)-1)};e.BF=function(d,e){var g=.5*(d.v+d.B),a=.5*(d.C+d.G);e[0].K(g,a,d.B,d.G);e[1].K(d.v,a,g,d.G);e[2].K(d.v,d.C,g,a);e[3].K(g,d.C,d.B,a)};e.prototype.HK=function(d){return 8==this.Zs(d)&&!this.VC(d)};e.prototype.$M=function(d,e,a){var g,k,b=this.sq(a);do k=this.Us(b),g=this.qh.O(b,0),k=this.kw(k),this.lt(g,k,d,e,a,!0,b),b=g=this.at(b);while(-1!=b)};e.prototype.IK=function(d){return 8<=this.Zs(d)||this.VC(d)};e.prototype.VC=function(d){return-1!=this.zo(d,0)||-1!=this.zo(d,1)||-1!=this.zo(d,
2)||-1!=this.zo(d,3)};e.prototype.OL=function(d,e){var g=this.Ye.be();this.MR(d,e,g);this.Ku(g,0);this.Eu(g,0);this.Tj(g,d);this.HF(g,this.Xs(d)+1);this.LF(g,e<<2*this.Xs(d)|this.EC(d));return g};e.prototype.QL=function(){var d=this.qh.be(),e;0<this.Rt.size?(e=this.Rt.tc(),this.Rt.af()):(e=this.Jq.length,this.Jq.push(new a.i));this.JR(d,e);return d};e.prototype.zo=function(d,e){return this.Ye.O(d,e)};e.prototype.MR=function(d,e,a){this.Ye.L(d,e,a)};e.prototype.sq=function(d){return this.Ye.O(d,4)};
e.prototype.DF=function(d,e){this.Ye.L(d,4,e)};e.prototype.AC=function(d){return this.Ye.O(d,5)};e.prototype.Fy=function(d,e){this.Ye.L(d,5,e)};e.prototype.EC=function(d){return this.Ye.O(d,6)};e.prototype.LF=function(d,e){this.Ye.L(d,6,e)};e.prototype.Zs=function(d){return this.Ye.O(d,7)};e.prototype.Kw=function(d){return this.Ye.O(d,8)};e.prototype.Eu=function(d,e){this.Ye.L(d,7,e)};e.prototype.Ku=function(d,e){this.Ye.L(d,8,e)};e.prototype.UN=function(d){return this.Ye.O(d,9)};e.prototype.Tj=function(d,
e){this.Ye.L(d,9,e)};e.prototype.Xs=function(d){return this.Ye.O(d,10)};e.prototype.HF=function(d,e){this.Ye.L(d,10,e)};e.prototype.yN=function(d){return this.qh.O(d,0)};e.prototype.By=function(d,e){this.qh.L(d,0,e)};e.prototype.$N=function(d){return this.qh.O(d,1)};e.prototype.at=function(d){return this.qh.O(d,2)};e.prototype.Ju=function(d,e){this.qh.L(d,1,e)};e.prototype.Fu=function(d,e){this.qh.L(d,2,e)};e.prototype.KC=function(d){return this.qh.O(d,3)};e.prototype.gS=function(d,e){this.qh.L(d,
3,e)};e.prototype.Us=function(d){return this.qh.O(d,4)};e.prototype.JR=function(d,e){this.qh.L(d,4,e)};e.prototype.kw=function(d){return this.Jq[d]};e.prototype.IR=function(d,e){this.Jq[d].K(e)};return e}();a.co=b})(x||(x={}));(function(a){(function(e){e[e.Outside=0]="Outside";e[e.Inside=1]="Inside";e[e.Border=2]="Border"})(a.wH||(a.wH={}));var k=function(){function e(d,e){this.Hg=null;this.SP=e;this.Hg=d}e.prototype.Bu=function(d,e){this.PD!=e&&d.flush();this.PD=e};e.prototype.XB=function(d,e){for(var g=
0;g<e;)for(var a=d[g++],k=d[g++],b=d[g++]*this.SP;a<k;a++)this.Hg[b+(a>>4)]|=this.PD<<2*(a&15)};return e}();a.VT=k;var b=function(){function e(d,e,a){this.Hg=null;this.Qx=this.Sx=this.zE=this.xE=this.Qq=this.VD=this.tf=this.Pl=0;this.ii=this.Nj=this.sk=null;this.jt(d,e,a)}e.create=function(d,g,k){if(!e.Cc(d))throw a.g.N();return e.Id(d,g,k)};e.ti=function(d,g,k){if(!e.Cc(d))throw a.g.N();return e.ye(d,g,k)};e.jR=function(d){switch(d){case 0:d=1024;break;case 1:d=16384;break;case 2:d=262144;break;
default:throw a.g.ra("Internal Error");}return d};e.Cc=function(d){return d.s()||1607!=d.D()&&1736!=d.D()?!1:!0};e.prototype.KM=function(d,e){e=e.Ca();for(var g=new a.b,k=new a.b;e.kb();)for(;e.La();){var b=e.ia();if(322!=b.D())throw a.g.ra("Internal Error");d.Zi(b.Mb(),g);d.Zi(b.oc(),k);this.ii.zv(g.x,g.y,k.x,k.y)}this.ii.fF(a.ev.$u)};e.prototype.LM=function(){throw a.g.ra("Internal Error");};e.prototype.cw=function(d,e){for(var g=1;4>g;g++)d.zv(e[g-1].x,e[g-1].y,e[g].x,e[g].y);d.zv(e[3].x,e[3].y,
e[0].x,e[0].y);this.ii.fF(a.ev.$u)};e.prototype.kG=function(d,e,k){for(var g=[null,null,null,null],b=0;b<g.length;b++)g[b]=new a.b;e=e.Ca();k=this.Nj.TS(k)+1.5;for(var b=new a.b,m=new a.b,c=new a.b,n=new a.b,h=new a.b,l=new a.i,q=new a.b;e.kb();){var u=!1,f=!0;for(q.ma(0,0);e.La();){var A=e.ia();n.x=A.na;n.y=A.ja;h.x=A.la;h.y=A.ha;l.Ja();l.Db(n.x,n.y);l.Oj(h.x,h.y);if(this.sk.rD(l)){this.Nj.Zi(h,h);f?(this.Nj.Zi(n,n),q.J(n),f=!1):n.J(q);b.pc(h,n);var A=b.length(),p=.5>A;0==A?b.ma(1,0):(p||q.J(h),
b.scale(k/A),m.ma(-b.y,b.x),c.ma(b.y,-b.x),n.sub(b),h.add(b),g[0].add(n,m),g[1].add(n,c),g[2].add(h,c),g[3].add(h,m),p?u=!0:this.cw(d,g))}else u&&(this.cw(d,g),u=!1),f=!0}u&&this.cw(d,g)}};e.prototype.fz=function(d){return a.I.truncate(d*this.VD+this.xE)};e.prototype.gz=function(d){return a.I.truncate(d*this.Qq+this.zE)};e.Id=function(d,g,a){return new e(d,g,a)};e.ye=function(d,g,a){return new e(d,g,a)};e.prototype.jt=function(d,e,b){this.tf=Math.max(a.I.truncate(2*Math.sqrt(b)+.5),64);this.Pl=a.I.truncate((2*
this.tf+31)/32);this.sk=new a.i;this.Sx=e;b=0;for(var g=this.tf,m=this.Pl;8<=g;)b+=g*m,g=a.I.truncate(g/2),m=a.I.truncate((2*g+31)/32);this.Hg=a.I.Lh(b,0);this.ii=new a.ev;b=new k(this.Hg,this.Pl,this);this.ii.vS(this.tf,this.tf,b);d.o(this.sk);this.sk.P(e,e);var g=new a.i,m=a.i.Oa(1,1,this.tf-2,this.tf-2),c=e*m.aa();e*=m.ba();g.K(this.sk.Af(),Math.max(c,this.sk.aa()),Math.max(e,this.sk.ba()));this.Qx=this.Sx;this.Nj=new a.Bg;this.Nj.wO(g,m);new a.Bg;switch(d.D()){case 550:b.Bu(this.ii,2);this.LM();
break;case 1607:b.Bu(this.ii,2);this.kG(this.ii,d,this.Qx);break;case 1736:b.Bu(this.ii,1),this.KM(this.Nj,d),b.Bu(this.ii,2),this.kG(this.ii,d,this.Qx)}this.VD=this.Nj.mb;this.Qq=this.Nj.eb;this.xE=this.Nj.Nb;this.zE=this.Nj.Ob;this.BK()};e.prototype.BK=function(){this.ii.flush();for(var d=0,e=this.tf*this.Pl,k=this.tf,b=a.I.truncate(this.tf/2),c=this.Pl,n=a.I.truncate((2*b+31)/32);8<k;){for(k=0;k<b;k++)for(var h=2*k,l=2*k+1,q=0;q<b;q++){var u=2*q,f=2*q+1,A=u>>4,u=2*(u&15),p=f>>4,f=2*(f&15),x=this.Hg[d+
c*h+A]>>u&3,x=x|this.Hg[d+c*h+p]>>f&3,x=x|this.Hg[d+c*l+A]>>u&3,x=x|this.Hg[d+c*l+p]>>f&3;this.Hg[e+n*k+(q>>4)]|=x<<2*(q&15)}k=b;c=n;d=e;b=a.I.truncate(k/2);n=a.I.truncate((2*b+31)/32);e=d+c*k}};e.prototype.Kk=function(d,e){if(!this.sk.contains(d,e))return 0;d=this.fz(d);e=this.gz(e);if(0>d||d>=this.tf||0>e||e>=this.tf)return 0;d=this.Hg[this.Pl*e+(d>>4)]>>2*(d&15)&3;return 0==d?0:1==d?1:2};e.prototype.Dn=function(d){if(!d.Ga(this.sk))return 0;var e=this.fz(d.v),k=this.fz(d.B),b=this.gz(d.C);d=this.gz(d.G);
0>e&&(e=0);0>b&&(b=0);k>=this.tf&&(k=this.tf-1);d>=this.tf&&(d=this.tf-1);if(e>k||b>d)return 0;for(var c=Math.max(k-e,1)*Math.max(d-b,1),n=0,h=this.Pl,l=this.tf,q=0;;){if(32>c||16>l){for(c=b;c<=d;c++)for(var u=e;u<=k;u++)if(q=this.Hg[n+h*c+(u>>4)]>>2*(u&15)&3,1<q)return 2;if(0==q)return 0;if(1==q)return 1}n+=h*l;l=a.I.truncate(l/2);h=a.I.truncate((2*l+31)/32);e=a.I.truncate(e/2);b=a.I.truncate(b/2);k=a.I.truncate(k/2);d=a.I.truncate(d/2);c=Math.max(k-e,1)*Math.max(d-b,1)}};e.prototype.cO=function(){return this.tf*
this.Pl};return e}();a.dA=b})(x||(x={}));(function(a){(function(e){e[e.contains=1]="contains";e[e.within=2]="within";e[e.equals=3]="equals";e[e.disjoint=4]="disjoint";e[e.touches=8]="touches";e[e.crosses=16]="crosses";e[e.overlaps=32]="overlaps";e[e.unknown=0]="unknown";e[e.intersects=1073741824]="intersects"})(a.zI||(a.zI={}));var b=function(){function e(){}e.Oa=function(d,a,b,k,c,n,h,l){var g=new e;g.Wt=d;g.Jl=a;g.Oi=b;g.ji=k;g.dE=c;g.tU=n;g.uU=h;g.vU=l;return g};return e}(),k=function(){function e(){}
e.vT=function(d,g,b){if(!e.pQ(d))return!1;var k=a.Ia.Cg(g,d,!1);g=!1;a.Wj.vB(d)&&(g=g||d.jv(k,b));k=d.D();1736!=k&&1607!=k||!a.Wj.tB(d)||0==b||(g=g||d.dj(b));1736!=k&&1607!=k||!a.Wj.uB(d)||0==b||(g=g||d.jJ());return g};e.pQ=function(d){return a.Wj.vB(d)||a.Wj.tB(d)||a.Wj.uB(d)};return e}();a.rT=k;k=function(){function e(){this.Tg=[]}e.qy=function(d,g,b,k,c){var m=d.D(),n=g.D();if(197==m){if(197==n)return e.AQ(d,g,b,k);if(33==n)return 2==k?k=1:1==k&&(k=2),e.Iz(g,d,b,k)}else if(33==m){if(197==n)return e.Iz(d,
g,b,k);if(33==n)return e.eR(d,g,b,k)}if(d.s()||g.s())return 4==k?!0:!1;var h=new a.i;d.o(h);var l=new a.i;g.o(l);var v=new a.i;v.K(h);v.Db(l);b=a.Ia.zd(b,v,!1);if(e.nj(h,l,b))return 4==k?!0:!1;h=!1;a.al.Lc(m)&&(m=new a.Xa(d.description),m.Bc(d,!0),d=m,m=1607);a.al.Lc(n)&&(n=new a.Xa(g.description),n.Bc(g,!0),g=n,n=1607);if(197!=m&&197!=n){if(d.fb()<g.fb()||33==m&&550==n)2==k?k=1:1==k&&(k=2)}else 1736!=m&&197!=n&&(2==k?k=1:1==k&&(k=2));switch(m){case 1736:switch(n){case 1736:h=e.vr(d,g,b,k,c);break;
case 1607:h=e.Vl(d,g,b,k,c);break;case 33:h=e.ur(d,g,b,k,c);break;case 550:h=e.tr(d,g,b,k,c);break;case 197:h=e.xD(d,g,b,k,c)}break;case 1607:switch(n){case 1736:h=e.Vl(g,d,b,k,c);break;case 1607:h=e.ey(d,g,b,k,c);break;case 33:h=e.xr(d,g,b,k,c);break;case 550:h=e.wr(d,g,b,k,c);break;case 197:h=e.WE(d,g,b,k)}break;case 33:switch(n){case 1736:h=e.ur(g,d,b,k,c);break;case 1607:h=e.xr(g,d,b,k,c);break;case 550:h=e.pr(g,d,b,k,c)}break;case 550:switch(n){case 1736:h=e.tr(g,d,b,k,c);break;case 1607:h=e.wr(g,
d,b,k,c);break;case 550:h=e.Wx(d,g,b,k,c);break;case 33:h=e.pr(d,g,b,k,c);break;case 197:h=e.oA(d,g,b,k)}break;case 197:switch(n){case 1736:h=e.xD(g,d,b,k,c);break;case 1607:h=e.WE(g,d,b,k);break;case 550:h=e.oA(g,d,b,k)}}return h};e.AQ=function(d,g,b,k){if(d.s()||g.s())return 4==k?!0:!1;var m=new a.i,c=new a.i,n=new a.i;d.o(m);g.o(c);n.K(m);n.Db(c);d=a.Ia.zd(b,n,!1);switch(k){case 4:return e.nj(m,c,d);case 2:return e.Bz(c,m,d);case 1:return e.Bz(m,c,d);case 3:return e.ye(m,c,d);case 8:return e.kT(m,
c,d);case 32:return e.fT(m,c,d);case 16:return e.cT(m,c,d)}return!1};e.Iz=function(d,g,b,k){if(d.s()||g.s())return 4==k?!0:!1;d=d.w();var m=new a.i,c=new a.i;g.o(m);c.K(d);c.Db(m);g=a.Ia.zd(b,c,!1);switch(k){case 4:return e.ru(d,m,g);case 2:return e.bx(d,m,g);case 1:return e.YL(d,m,g);case 3:return e.KA(d,m,g);case 8:return e.ax(d,m,g)}return!1};e.eR=function(d,g,b,k){if(d.s()||g.s())return 4==k?!0:!1;d=d.w();g=g.w();var m=new a.i;m.K(d);m.Db(g);b=a.Ia.zd(b,m,!1);switch(k){case 4:return e.rM(d,g,
b);case 2:return e.hz(g,d,b);case 1:return e.hz(d,g,b);case 3:return e.dB(d,g,b)}return!1};e.vr=function(d,a,b,k,c){switch(k){case 4:return e.dT(d,a,b);case 2:return e.su(a,d,b,c);case 1:return e.su(d,a,b,c);case 3:return e.TG(d,a,b);case 8:return e.vH(d,a,b);case 32:return e.bH(d,a,b,c)}return!1};e.Vl=function(d,a,b,k,c){switch(k){case 4:return e.gT(d,a,b);case 1:return e.dy(d,a,b,c);case 8:return e.zH(d,a,b,c);case 16:return e.lR(d,a,b)}return!1};e.ur=function(d,a,b,k){switch(k){case 4:return e.YS(d,
a,b);case 1:return e.qQ(d,a,b);case 8:return e.lH(d,a,b)}return!1};e.tr=function(d,a,b,k){switch(k){case 4:return e.OS(d,a,b);case 1:return e.hQ(d,a,b);case 8:return e.iH(d,a,b);case 16:return e.dR(d,a,b)}return!1};e.xD=function(d,a,b,k,c){if(e.ER(d,a,b))return 4==k?!0:!1;if(4==k)return!1;switch(k){case 2:return e.DH(d,a,b);case 1:return e.WP(d,a,b);case 3:return e.OG(d,a,b);case 8:return e.eH(d,a,b,c);case 32:return e.WG(d,a,b,c);case 16:return e.zQ(d,a,b,c)}return!1};e.ey=function(d,a,b,k){switch(k){case 4:return e.EI(d,
a,b);case 2:return e.JE(a,d,b);case 1:return e.JE(d,a,b);case 3:return e.QI(d,a,b);case 8:return e.cF(d,a,b);case 32:return e.$I(d,a,b);case 16:return e.LE(d,a,b)}return!1};e.xr=function(d,a,b,k){switch(k){case 4:return e.yI(d,a,b);case 1:return e.KH(d,a,b);case 8:return e.MG(d,a,b)}return!1};e.wr=function(d,a,b,k){switch(k){case 4:return e.vI(d,a,b);case 1:return e.IH(d,a,b);case 8:return e.fJ(d,a,b);case 16:return e.QH(d,a,b)}return!1};e.WE=function(d,a,b,k){if(e.nI(d,a,b))return 4==k?!0:!1;if(4==
k)return!1;switch(k){case 2:return e.WJ(d,a,b);case 1:return e.GH(d,a,b);case 3:return e.MI(d,a,b);case 8:return e.cJ(d,a,b);case 32:return e.XI(d,a,b);case 16:return e.MH(d,a,b)}return!1};e.Wx=function(d,a,b,k){switch(k){case 4:return e.xI(d,a,b);case 2:return e.kA(a,d,b);case 1:return e.kA(d,a,b);case 3:return e.LI(d,a,b);case 32:return e.bJ(d,a,b)}return!1};e.pr=function(d,a,b,k){switch(k){case 4:return e.lA(d,a,b);case 2:return e.HJ(d,a,b);case 1:return e.PH(d,a,b);case 3:return e.mu(d,a,b)}return!1};
e.oA=function(d,a,b,k){switch(k){case 4:return e.uI(d,a,b);case 2:return e.LG(d,a,b);case 1:return e.LH(d,a,b);case 3:return e.DI(d,a,b);case 8:return e.eJ(d,a,b);case 16:return e.mI(d,a,b)}return!1};e.TG=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);if(!e.ye(k,m,b))return!1;k=e.fc(d,g,!1);if(4==k||1==k||2==k)return!1;if(e.jA(d,g,b))return!0;k=d.$b();m=g.$b();return Math.abs(k-m)>4*Math.max(d.F(),g.F())*b?!1:e.Vv(d,g,b,!0)};e.dT=function(d,a,b){var g=e.fc(d,a,!0);return 4==g?!0:1==g||2==g||
1073741824==g?!1:e.ZC(d,a,b)};e.vH=function(d,a,b){var g=e.fc(d,a,!1);return 4==g||1==g||2==g?!1:e.AE(d,a,b,null)};e.bH=function(d,a,b,k){var g=e.fc(d,a,!1);return 4==g||1==g||2==g?!1:e.wD(d,a,b,k)};e.su=function(d,g,b,k){var m=new a.i,c=new a.i;d.o(m);g.o(c);if(!e.rc(m,c,b))return!1;m=e.fc(d,g,!1);return 4==m||2==m?!1:1==m?!0:e.bC(d,g,b,k)};e.gT=function(d,a,b){var g=e.fc(d,a,!0);return 4==g?!0:1==g||1073741824==g?!1:e.ZC(d,a,b)};e.zH=function(d,a,b,k){var g=e.fc(d,a,!1);return 4==g||1==g?!1:e.CE(d,
a,b,k)};e.lR=function(d,a,b){var g=e.fc(d,a,!1);return 4==g||1==g?!1:e.YC(d,a,b,null)};e.dy=function(d,g,b,k){var m=new a.i,c=new a.i;d.o(m);g.o(c);if(!e.rc(m,c,b))return!1;m=e.fc(d,g,!1);return 4==m?!1:1==m?!0:e.jC(d,g,b,k)};e.YS=function(d,e,b){return 0==a.gd.uD(d,e,b)?!0:!1};e.lH=function(d,a,b){a=a.w();return e.yD(d,a,b)};e.qQ=function(d,a,b){a=a.w();return e.YB(d,a,b)};e.OS=function(d,g,b){var k=e.fc(d,g,!1);if(4==k)return!0;if(1==k)return!1;k=new a.i;d.o(k);k.P(b,b);for(var m=new a.b,c=0;c<
g.F();c++)if(g.w(c,m),k.contains(m)){var n=a.gd.he(d,m,b);if(1==n||2==n)return!1}return!0};e.iH=function(d,e,b){var g=this.fc(d,e,!1);if(4==g||1==g)return!1;g=new a.i;d.o(g);g.P(b,b);var k,m=!1,c;c=d;for(var n=!1,h=0;h<e.F();h++){k=e.Fa(h);if(g.contains(k))if(k=a.gd.he(c,k,b),2==k)m=!0;else if(1==k)return!1;n||(!a.ff.An(d,e.F()-1)||null!=d.pb&&null!=d.pb.Ab?c=d:(c=new a.Ka,d.copyTo(c),c.dj(1)),n=!0)}return m?!0:!1};e.dR=function(d,e,b){var g=this.fc(d,e,!1);if(4==g||1==g)return!1;var k=new a.i,g=
new a.i,m=new a.i;d.o(k);e.o(m);g.K(k);g.P(b,b);var m=k=!1,c,n;n=d;for(var h=!1,l=0;l<e.F();l++){c=e.Fa(l);g.contains(c)?(c=a.gd.he(n,c,b),0==c?m=!0:1==c&&(k=!0)):m=!0;if(k&&m)return!0;h||(!a.ff.An(d,e.F()-1)||null!=d.pb&&null!=d.pb.Ab?n=d:(n=new a.Ka,d.copyTo(n),n.dj(1)),h=!0)}return!1};e.hQ=function(d,e,b){var g=new a.i,k=new a.i;d.o(g);e.o(k);if(!this.rc(g,k,b))return!1;k=this.fc(d,e,!1);if(4==k)return!1;if(1==k)return!0;var k=!1,m,c;c=d;for(var n=!1,h=0;h<e.F();h++){m=e.Fa(h);if(!g.contains(m))return!1;
m=a.gd.he(c,m,b);if(1==m)k=!0;else if(0==m)return!1;n||(!a.ff.An(d,e.F()-1)||null!=d.pb&&null!=d.pb.Ab?c=d:(c=new a.Ka,d.copyTo(c),c.dj(1)),n=!0)}return k};e.OG=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);if(!e.ye(k,m,b))return!1;k=new a.Ka;k.Wc(g,!1);return e.Vv(d,k,b,!0)};e.ER=function(d,g,b){var k=e.fc(d,g,!1);if(4==k)return!0;if(1==k||2==k)return!1;var m=new a.i,k=new a.i;d.o(m);g.o(k);if(e.rc(k,m,b))return!1;m=new a.b;k.Yl(m);g=a.gd.he(d,m,b);if(0!=g)return!1;k.YE(m);g=a.gd.he(d,m,
b);if(0!=g)return!1;k.Zl(m);g=a.gd.he(d,m,b);if(0!=g)return!1;k.aF(m);g=a.gd.he(d,m,b);if(0!=g)return!1;g=d.mc(0);m=new a.i;m.K(k);m.P(b,b);for(var c=0,n=d.F();c<n;c++){var h=g.read(2*c),l=g.read(2*c+1);if(m.contains(h,l))return!1}return!e.cA(d,k,b)};e.eH=function(d,g,b,k){var m=e.fc(d,g,!1);if(4==m||1==m||2==m)return!1;var m=new a.i,c=new a.i;d.o(m);g.o(c);if(e.rc(c,m,b))return!1;if(c.aa()<=b&&c.ba()<=b)return g=g.qq(),e.yD(d,g,b);if(c.aa()<=b||c.ba()<=b)return m=new a.Xa,c=new a.Va,g.uf(0,c),m.df(c),
g.uf(2,c),m.lineTo(c),e.CE(d,m,b,k);m=new a.Ka;m.Wc(g,!1);return e.AE(d,m,b,k)};e.WG=function(d,g,b,k){var m=e.fc(d,g,!1);if(4==m||1==m||2==m)return!1;var m=new a.i,c=new a.i;d.o(m);g.o(c);if(e.rc(c,m,b)||c.aa()<=b||c.ba()<=b)return!1;m=new a.Ka;m.Wc(g,!1);return e.wD(d,m,b,k)};e.DH=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);return e.rc(m,k,b)};e.WP=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);if(!e.rc(k,m,b))return!1;k=e.fc(d,g,!1);if(4==k||2==k)return!1;if(1==k)return!0;if(m.aa()<=
b&&m.ba()<=b)return g=g.qq(),e.YB(d,g,b);if(m.aa()<=b||m.ba()<=b)return m=new a.Xa,k=new a.Va,g.uf(0,k),m.df(k),g.uf(2,k),m.lineTo(k),e.jC(d,m,b,null);m=new a.Ka;m.Wc(g,!1);return e.bC(d,m,b,null)};e.zQ=function(d,g,b,k){var m=new a.i,c=new a.i;d.o(m);g.o(c);if(e.rc(c,m,b)||c.ba()>b&&c.aa()>b||c.ba()<=b&&c.aa()<=b)return!1;m=new a.Xa;c=new a.Va;g.uf(0,c);m.df(c);g.uf(2,c);m.lineTo(c);return e.YC(d,m,b,k)};e.QI=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);return e.ye(k,m,b)&&4!=e.fc(d,g,!1)?
e.jA(d,g,b)?!0:e.Vv(d,g,b,!1):!1};e.EI=function(d,e,b){return 4==this.fc(d,e,!1)?!0:(new a.cl(d,e,b,!0)).next()?!this.ED(d,e,b):!1};e.cF=function(d,g,b){if(4==e.fc(d,g,!1))return!1;var k=new a.qd(0);if(0!=e.Zv(d,g,b,k))return!1;for(var m=new a.pe,c=0;c<k.size;c+=2){var n=k.read(c),h=k.read(c+1);m.zs(n,h)}d=d.Rf();g=g.Rf();d.Pd(g,0,g.F());return e.lu(d,m,b)};e.LE=function(d,g,b){if(4==e.fc(d,g,!1))return!1;var k=new a.qd(0);if(0!=e.Zv(d,g,b,k))return!1;for(var m=new a.pe,c=0;c<k.size;c+=2){var n=k.read(c),
h=k.read(c+1);m.zs(n,h)}d=d.Rf();g=g.Rf();d.Pd(g,0,g.F());return!e.lu(d,m,b)};e.$I=function(d,a,b){return 4==e.fc(d,a,!1)?!1:e.iA(d,a,b)};e.JE=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);return e.rc(k,m,b)&&4!=e.fc(d,g,!1)?e.Wf(g,d,b,!1):!1};e.yI=function(d,a,b){if(4==e.fc(d,a,!1))return!0;a=a.w();return!e.ex(d,a,b)};e.MG=function(d,a,b){if(4==e.fc(d,a,!1))return!1;a=a.w();return e.bw(d,a,b)};e.KH=function(d,a,b){if(4==e.fc(d,a,!1))return!1;a=a.w();return e.bA(d,a,b)};e.vI=function(d,a,
b){return 4==e.fc(d,a,!1)?!0:!e.eA(d,a,b,!1)};e.fJ=function(d,e,b){if(4==this.fc(d,e,!1))return!1;var g=d.Ca(),k=new a.i,m=new a.i,c=new a.i;d.o(k);e.o(m);k.P(b,b);m.P(b,b);c.K(k);c.Ga(m);var n,h,k=null;n=d.pb;null!=n?(h=n.Ab,k=n.nn,null==h&&(h=n=a.Ia.ij(d,c))):h=n=a.Ia.ij(d,c);var l=h.Re(),q=null;null!=k&&(q=k.Re());var u=new a.b,f=new a.b,A=!1,p=b*b,k=new a.Wk(e.F());for(n=0;n<e.F();n++)k.write(n,0);for(n=0;n<e.F();n++)if(e.w(n,u),c.contains(u))if(m.K(u.x,u.y,u.x,u.y),null==q||(q.Ch(m,b),-1!=q.next())){l.Ch(m,
b);for(var x=l.next();-1!=x;x=l.next())if(g.Sb(h.da(x)),x=g.ia(),x.Kb(x.Gd(u,!1),f),a.b.Zb(u,f)<=p){k.write(n,1);A=!0;break}}if(!A)return!1;d=d.Rf();g=new a.pe;m=new a.b;for(n=0;n<e.F();n++)0!=k.read(n)&&(e.w(n,m),g.zs(m.x,m.y));return this.lu(d,g,b)};e.QH=function(d,e,b){if(4==this.fc(d,e,!1))return!1;var g=d.Ca(),k=new a.i,m=new a.i,c=new a.i;d.o(k);e.o(m);k.P(b,b);m.P(b,b);c.K(k);c.Ga(m);var n,h,k=null;n=d.pb;null!=n?(h=n.Ab,k=n.nn,null==h&&(h=n=a.Ia.ij(d,c))):h=n=a.Ia.ij(d,c);var l=h.Re(),q=null;
null!=k&&(q=k.Re());var u=new a.b,f=new a.b,A=!1,p=!1,x=b*b,k=new a.Wk(e.F());for(n=0;n<e.F();n++)k.write(n,0);for(n=0;n<e.F();n++)if(e.w(n,u),c.contains(u))if(m.K(u.x,u.y,u.x,u.y),null!=q&&(q.Ch(m,b),-1==q.next()))p=!0;else{l.Ch(m,b);for(var w=!1,t=l.next();-1!=t;t=l.next())if(g.Sb(h.da(t)),t=g.ia(),t.Kb(t.Gd(u,!1),f),a.b.Zb(u,f)<=x){k.write(n,1);w=A=!0;break}w||(p=!0)}else p=!0;if(!A||!p)return!1;d=d.Rf();g=new a.pe;m=new a.b;for(n=0;n<e.F();n++)0!=k.read(n)&&(e.w(n,m),g.zs(m.x,m.y));return!this.lu(d,
g,b)};e.IH=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);if(!e.rc(k,m,b)||4==e.fc(d,g,!1)||!e.eA(d,g,b,!0))return!1;d=d.Rf();return!e.nA(d,g,b)};e.MI=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);return m.ba()>b&&m.aa()>b?!1:e.ye(k,m,b)};e.nI=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);return e.rc(m,k,b)?!1:!e.cA(d,m,b)};e.cJ=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);if(m.ba()<=b&&m.aa()<=b)return m=g.qq(),e.bw(d,m,b);if(m.ba()<=b||m.aa()<=b)return m=new a.Xa,
k=new a.Va,g.uf(0,k),m.df(k),g.uf(2,k),m.lineTo(k),e.cF(d,m,b);d=d.Ca();g=new a.i;k=new a.i;g.K(m);k.K(m);g.P(-b,-b);k.P(b,b);for(var m=!1,c=new a.i,n=new a.i;d.kb();)for(;d.La();){d.ia().o(c);n.K(g);n.Ga(c);if(!n.s()&&(n.ba()>b||n.aa()>b))return!1;n.K(k);n.Ga(c);n.s()||(m=!0)}return m};e.XI=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);if(e.rc(k,m,b)||e.rc(m,k,b)||e.rc(m,k,b)||m.ba()>b&&m.aa()>b||m.ba()<=b&&m.aa()<=b)return!1;k=new a.Xa;m=new a.Va;g.uf(0,m);k.df(m);g.uf(2,m);k.lineTo(m);
return e.iA(d,k,b)};e.WJ=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);if(!e.rc(m,k,b)||m.ba()<=b&&m.aa()<=b)return!1;if(m.ba()<=b||m.aa()<=b)return e.rc(m,k,b);d=d.Ca();g=new a.i;g.K(m);g.P(-b,-b);for(var m=!1,k=new a.i,c=new a.i;d.kb();)for(;d.La();)d.ia().o(k),g.jl(k)?m=!0:(c.K(g),c.Ga(k),!c.s()&&(c.ba()>b||c.aa()>b)&&(m=!0));return m};e.GH=function(d,g,b){var k=new a.i,m=new a.i;g.o(m);d.o(k);if(!e.rc(k,m,b)||m.ba()>b&&m.aa()>b)return!1;if(m.ba()<=b&&m.aa()<=b)return g=g.qq(),e.bA(d,g,
b);k=new a.Xa;m=new a.Va;g.uf(0,m);k.df(m);g.uf(2,m);k.lineTo(m);return e.Wf(k,d,b,!1)};e.MH=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);if(e.rc(m,k,b)||m.ba()<=b&&m.aa()<=b)return!1;if(m.ba()<=b||m.aa()<=b)return k=new a.Xa,m=new a.Va,g.uf(0,m),k.df(m),g.uf(2,m),k.lineTo(m),e.LE(d,k,b);d=d.Ca();g=new a.i;k=new a.i;k.K(m);g.K(m);k.P(-b,-b);g.P(b,b);for(var c=m=!1,n=new a.i,h=new a.i;d.kb();)for(;d.La();)if(d.ia().o(n),c||g.contains(n)||(c=!0),m||(h.K(k),h.Ga(n),!h.s()&&(h.ba()>b||h.aa()>
b)&&(m=!0)),m&&c)return!0;return!1};e.LI=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);return e.ye(k,m,b)?e.OI(d,g,b)?!0:e.Pw(d,g,b,!1,!0,!1):!1};e.xI=function(d,a,b){return!e.nA(d,a,b)};e.bJ=function(d,a,b){return e.Pw(d,a,b,!1,!1,!0)};e.kA=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);return e.rc(k,m,b)?e.Pw(g,d,b,!0,!1,!1):!1};e.lu=function(d,e,b){b*=b;for(var g=new a.b,k=new a.b,m=0;m<e.F();m++){e.w(m,k);for(var c=!1,n=0;n<d.F();n++)if(d.w(n,g),a.b.Zb(g,k)<=b){c=!0;break}if(!c)return!1}return!0};
e.mu=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);return e.ye(k,m,b)};e.lA=function(d,a,b){a=a.w();return e.or(d,a,b)};e.HJ=function(d,a,b){return e.mu(d,a,b)};e.PH=function(d,a,b){return!e.lA(d,a,b)};e.DI=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);return m.ba()>b||m.aa()>b?!1:e.ye(k,m,b)};e.uI=function(d,g,b){var k=new a.i,m=new a.i;d.o(k);g.o(m);if(e.rc(m,k,b))return!1;g=new a.i;g.K(m);g.P(b,b);b=new a.b;for(m=0;m<d.F();m++)if(d.w(m,b),g.contains(b))return!1;return!0};e.eJ=function(d,
e,b){var g=new a.i,k=new a.i,m=new a.i;e.o(g);if(g.ba()<=b&&g.aa()<=b)return!1;if(g.ba()<=b||g.aa()<=b){e=new a.b;var c=!1;k.K(g);m.K(g);k.P(b,b);g.ba()>b?m.P(0,-b):m.P(-b,0);for(var n=0;n<d.F();n++)if(d.w(n,e),k.contains(e)){if(g.ba()>b){if(e.y>m.C&&e.y<m.G)return!1}else if(e.x>m.v&&e.x<m.B)return!1;c=!0}return c}k.K(g);m.K(g);k.P(b,b);m.P(-b,-b);e=new a.b;c=!1;for(n=0;n<d.F();n++)if(d.w(n,e),k.contains(e)){if(m.jl(e))return!1;c=!0}return c};e.LG=function(d,g,b){var k=new a.i,c=new a.i;d.o(k);g.o(c);
if(!e.rc(c,k,b))return!1;if(c.ba()<=b&&c.aa()<=b)return e.ye(k,c,b);if(c.ba()<=b||c.aa()<=b){g=!1;var k=new a.i,m=new a.i;k.K(c);m.K(c);c.ba()>b?k.P(0,-b):k.P(-b,0);m.P(b,b);for(var n=new a.b,h=0;h<d.F();h++){d.w(h,n);if(!m.contains(n))return!1;c.ba()>b?n.y>k.C&&n.y<k.G&&(g=!0):n.x>k.v&&n.x<k.B&&(g=!0)}return g}g=!1;k=new a.i;m=new a.i;k.K(c);m.K(c);k.P(-b,-b);m.P(b,b);n=new a.b;for(h=0;h<d.F();h++){d.w(h,n);if(!m.contains(n))return!1;k.jl(n)&&(g=!0)}return g};e.LH=function(d,g,b){var k=new a.i,c=
new a.i;d.o(k);g.o(c);if(!e.rc(k,c,b)||c.ba()>b||c.aa()>b)return!1;g=g.qq();return!e.or(d,g,b)};e.mI=function(d,g,b){var k=new a.i,c=new a.i;d.o(k);g.o(c);if(e.rc(c,k,b)||c.ba()<=b&&c.aa()<=b)return!1;if(c.ba()<=b||c.aa()<=b){g=new a.i;k=new a.i;g.K(c);c.ba()>b?g.P(0,-b):g.P(-b,0);k.K(c);k.P(b,b);for(var m=new a.b,n=!1,h=!1,l=0;l<d.F();l++)if(d.w(l,m),n||(c.ba()>b?m.y>g.C&&m.y<g.G&&(n=!0):m.x>g.v&&m.x<g.B&&(n=!0)),h||k.contains(m)||(h=!0),n&&h)return!0;return!1}g=new a.i;k=new a.i;g.K(c);g.P(-b,-b);
k.K(c);k.P(b,b);m=new a.b;h=n=!1;for(l=0;l<d.F();l++)if(d.w(l,m),!n&&g.jl(m)&&(n=!0),h||k.contains(m)||(h=!0),n&&h)return!0;return!1};e.dB=function(d,e,b){return a.b.Zb(d,e)<=b*b?!0:!1};e.rM=function(d,e,b){return a.b.Zb(d,e)>b*b?!0:!1};e.hz=function(d,a,b){return e.dB(d,a,b)};e.KA=function(d,g,b){var k=new a.i;k.K(d);return e.ye(k,g,b)};e.ru=function(d,e,b){var g=new a.i;g.K(e);g.P(b,b);return!g.contains(d)};e.ax=function(d,e,b){if(e.ba()<=b&&e.aa()<=b)return!1;var g=new a.i,k=new a.i;g.K(e);g.P(b,
b);if(!g.contains(d))return!1;if(e.ba()<=b||e.aa()<=b){k.K(e);e.ba()>b?k.P(0,-b):k.P(-b,0);if(e.ba()>b){if(d.y>k.C&&d.y<k.G)return!1}else if(d.x>k.v&&d.x<k.B)return!1;return!0}k.K(e);k.P(-b,-b);return k.jl(d)?!1:!0};e.bx=function(d,e,b){if(e.ba()<=b&&e.aa()<=b)return!0;if(e.ba()<=b||e.aa()<=b){var g=new a.i;g.K(e);e.ba()>b?g.P(0,-b):g.P(-b,0);var k=!1;e.ba()>b?d.y>g.C&&d.y<g.G&&(k=!0):d.x>g.v&&d.x<g.B&&(k=!0);return k}g=new a.i;g.K(e);g.P(-b,-b);return g.jl(d)};e.YL=function(d,a,b){return e.KA(d,
a,b)};e.ye=function(d,a,b){return e.rc(d,a,b)&&e.rc(a,d,b)};e.nj=function(d,e,b){var g=new a.i;g.K(e);g.P(b,b);return!d.jc(g)};e.kT=function(d,g,b){if(d.ba()<=b&&d.aa()<=b){var k=d.Af();return e.ax(k,g,b)}if(g.ba()<=b&&g.aa()<=b)return k=g.Af(),e.ax(k,d,b);d.ba()>b&&d.aa()>b&&(g.ba()<=b||g.aa()<=b)?k=g:(k=d,d=g);if(k.ba()<=b||k.aa()<=b){if(d.ba()<=b||d.aa()<=b){g=new a.yb;var c=new a.yb,m=[0,0],n=[0,0],h=new a.b;k.Yl(h);g.ed(h);k.Zl(h);g.vd(h);d.Yl(h);c.ed(h);d.Zl(h);c.vd(h);g.Ga(c,null,m,n,b);return 1!=
g.Ga(c,null,null,null,b)?!1:0==m[0]||1==m[1]||0==n[0]||1==n[1]}g=new a.i;c=new a.i;g.K(d);g.P(-b,-b);c.K(g);c.Ga(k);return!c.s()&&(c.ba()>b||c.aa()>b)?!1:!0}d.P(b,b);c=new a.i;c.K(k);c.Ga(d);return c.s()||!c.s()&&c.ba()>b&&c.aa()>b?!1:!0};e.fT=function(d,g,b){if(e.rc(d,g,b)||e.rc(g,d,b)||d.ba()<=b&&d.aa()<=b||g.ba()<=b&&g.aa()<=b)return!1;if(d.ba()<=b||d.aa()<=b){if(g.ba()>b&&g.aa()>b)return!1;var k=new a.yb,c=new a.yb,m=[0,0],n=[0,0],h=new a.b;d.Yl(h);k.ed(h);d.Zl(h);k.vd(h);g.Yl(h);c.ed(h);g.Zl(h);
c.vd(h);k.Ga(c,null,m,n,b);return 2!=k.Ga(c,null,null,null,b)?!1:(0<m[0]||1>m[1])&&(0<n[0]||1>n[1])}if(g.ba()<=b||g.aa()<=b)return!1;k=new a.i;k.K(d);k.Ga(g);return k.s()||k.ba()<=b||k.aa()<=b?!1:!0};e.Bz=function(d,g,b){if(!e.rc(d,g,b))return!1;if(d.ba()<=b&&d.aa()<=b)return d=d.Af(),e.bx(d,g,b);if(g.ba()<=b&&g.aa()<=b)return g=g.Af(),e.bx(g,d,b);if(d.ba()<=b||d.aa()<=b)return e.rc(d,g,b);if(g.ba()<=b||g.aa()<=b){var k=new a.i;k.K(d);k.P(-b,-b);if(k.jl(g))return!0;d=new a.i;d.K(k);d.Ga(g);return d.s()||
d.ba()<=b&&d.aa()<=b?!1:!0}return e.rc(d,g,b)};e.cT=function(d,g,b){if(e.rc(d,g,b)||e.rc(g,d,b)||d.ba()<=b&&d.aa()<=b||g.ba()<=b&&g.aa()<=b||g.ba()>b&&g.aa()>b&&d.ba()>b&&d.aa()>b)return!1;var k;d.ba()>b&&d.aa()>b?k=g:(k=d,d=g);if(d.ba()>b&&d.aa()>b){g=new a.i;var c=new a.i;c.K(d);c.P(-b,-b);g.K(c);g.Ga(k);return g.s()||g.ba()<=b&&g.aa()<=b?!1:!0}g=new a.yb;var c=new a.yb,m=[0,0],n=[0,0],h=new a.b;k.Yl(h);g.ed(h);k.Zl(h);g.vd(h);d.Yl(h);c.ed(h);d.Zl(h);c.vd(h);g.Ga(c,null,m,n,b);return 1!=g.Ga(c,
null,null,null,b)?!1:0<m[0]&&1>m[1]&&0<n[0]&&1>n[1]};e.ZC=function(d,e,b){var g,k,c=new a.i,m=new a.i,n=new a.cl(d,e,b,!0);if(!n.next())return!0;if(this.ED(d,e,b))return!1;var h;h=d;var l;l=null;1736==e.D()&&(l=e);var q=!1,u=!1;do{g=n.jk();k=n.ek();k=e.Fa(e.Ea(k));c.K(n.Fw());c.P(b,b);if(c.contains(k)&&(k=a.gd.he(h,k,0),0!=k)||1736==e.D()&&(g=d.Fa(d.Ea(g)),m.K(n.jw()),m.P(b,b),m.contains(g)&&(k=a.gd.he(l,g,0),0!=k)))return!1;q||(!a.ff.An(d,e.ea()-1)||null!=d.pb&&null!=d.pb.Ab?h=d:(h=new a.Ka,d.copyTo(h),
h.dj(1)),q=!0);1736!=e.D()||u||(u=e,!a.ff.An(u,d.ea()-1)||null!=e.pb&&null!=e.pb.Ab?l=e:(l=new a.Ka,u.copyTo(l),l.dj(1)),u=!0)}while(n.next());return!0};e.rc=function(d,e,b){var g=new a.i;g.K(d);g.P(b,b);return g.contains(e)};e.lm=function(d,e,b){var g=new a.i;g.K(e);g.P(b,b);e=new a.b;d.Yl(e);if(!g.contains(e))return!0;d.YE(e);if(!g.contains(e))return!0;d.aF(e);if(!g.contains(e))return!0;d.Zl(e);return g.contains(e)?!1:!0};e.jA=function(d,e,b){if(d.ea()!=e.ea()||d.F()!=e.F())return!1;var g=new a.b,
k=new a.b,c=!0;b*=b;for(var m=0;m<d.ea();m++){if(d.Dc(m)!=e.Dc(m)){c=!1;break}for(var n=d.Ea(m);n<e.Dc(m);n++)if(d.w(n,g),e.w(n,k),a.b.Zb(g,k)>b){c=!1;break}if(!c)break}return c?!0:!1};e.OI=function(d,e,b){if(d.F()!=e.F())return!1;var g=new a.b,k=new a.b,c=!0;b*=b;for(var m=0;m<d.F();m++)if(d.w(m,g),e.w(m,k),a.b.Zb(g,k)>b){c=!1;break}return c?!0:!1};e.Pw=function(d,e,b,k,c,n){var g=!1,m;d.F()>e.F()?(k&&(k=!1,g=!0),m=e):(m=d,d=e);e=null;if(c||n||g){e=new a.Wk(d.F());for(var h=0;h<d.F();h++)e.write(h,
0)}var h=new a.i,l=new a.i,q=new a.i;m.o(h);d.o(l);h.P(b,b);l.P(b,b);q.K(h);q.Ga(l);for(var l=new a.b,u=new a.b,v=!0,f=a.Ia.oB(d,q),A=f.Re(),p=b*b,x=0;x<m.F();x++)if(m.w(x,l),q.contains(l)){var w=!1;h.K(l.x,l.y,l.x,l.y);A.Ch(h,b);for(var t=A.next();-1!=t&&!(t=f.da(t),d.w(t,u),a.b.Zb(l,u)<=p&&((c||n||g)&&e.write(t,1),w=!0,k));t=A.next());if(!w&&(v=!1,c||k))return!1}else{if(c||k)return!1;v=!1}if(n&&v)return!1;if(k)return!0;for(h=0;h<d.F();h++)if(1==e.read(h)){if(n)return!0}else if(c||g)return!1;return n?
!1:!0};e.nA=function(d,e,b){var g;d.F()>e.F()?g=e:(g=d,d=e);e=new a.i;var k=new a.i,c=new a.i;g.o(e);d.o(k);e.P(b,b);k.P(b,b);c.K(e);c.Ga(k);for(var k=new a.b,m=new a.b,n=b*b,h=a.Ia.oB(d,c),l=h.Re(),q=0;q<g.F();q++)if(g.w(q,k),c.contains(k)){e.K(k.x,k.y,k.x,k.y);l.Ch(e,b);for(var u=l.next();-1!=u;u=l.next())if(d.w(h.da(u),m),a.b.Zb(k,m)<=n)return!0}return!1};e.Vv=function(d,a,b,k){return e.Wf(d,a,b,k)&&e.Wf(a,d,b,k)};e.Wf=function(d,g,k,c){function m(d,e){return v.IB(d,e)}var n=!0,h=[0,0],l=[0,0],
q=0,u=new a.ga(0),v=new e,f,A=new a.i,p=new a.i,x=new a.i;d.o(A);g.o(p);A.P(k,k);p.P(k,k);x.K(A);x.Ga(p);d=d.Ca();var p=g.Ca(),w=null,t=w=null,C=g.pb;null!=C?(w=C.Ab,t=C.nn,null==w&&(w=a.Ia.ij(g,x))):w=a.Ia.ij(g,x);g=w.Re();C=null;for(null!=t&&(C=t.Re());d.kb();)for(;d.La();){var y=!1,z=d.ia();z.o(A);if(!A.jc(x))return!1;if(null!=C&&(C.Ch(A,k),-1==C.next()))return n=!1;t=z.$b();g.Fn(z,k);for(f=g.next();-1!=f;f=g.next()){p.Sb(w.da(f));f=p.ia();var E=z.Ga(f,null,h,l,k);if(2==E&&(!c||l[0]<=l[1])){var E=
h[0],I=h[1],J=l[0],K=l[1];if(E*t<=k&&(1-I)*t<=k){y=!0;q=0;u.resize(0);v.Tg.length=0;for(var G=d.Jb(),J=!0;J;){if(d.La()){z=d.ia();t=z.$b();E=z.Ga(f,null,h,l,k);if(2==E&&(!c||l[0]<=l[1])&&(E=h[0],I=h[1],E*t<=k&&(1-I)*t<=k)){G=d.Jb();continue}if(p.La()&&(f=p.ia(),E=z.Ga(f,null,h,l,k),2==E&&(!c||l[0]<=l[1])&&(E=h[0],I=h[1],E*t<=k&&(1-I)*t<=k))){G=d.Jb();continue}}J=!1}G!=d.Jb()&&(d.Sb(G),d.ia());break}else G=d.Jb(),f=b.Oa(G,d.Qa,E,I,p.Jb(),p.Qa,J,K),v.Tg.push(f),u.add(u.size)}}if(!y){if(q==v.Tg.length)return!1;
1<u.size-q&&u.xd(q,u.size,m);for(y=0;q<v.Tg.length;q++)if(f=v.Tg[u.get(q)],!(f.Oi<y&&f.ji<y)){if(t*(f.Oi-y)>k)return!1;y=f.ji;if(t*(1-y)<=k||1==y)break}if(t*(1-y)>k)return!1;q=0;u.resize(0);v.Tg.length=0}}return n};e.iA=function(d,g,b){if(1>e.Zv(d,g,b,null))return!1;var k=new a.i,c=new a.i;d.o(k);g.o(c);var m=e.lm(k,c,b),k=e.lm(c,k,b);return m&&k?!0:m&&!k?!e.Wf(g,d,b,!1):k&&!m?!e.Wf(d,g,b,!1):!e.Wf(d,g,b,!1)&&!e.Wf(g,d,b,!1)};e.Zv=function(d,g,k,c){function m(d,e){return p.IB(d,e)}var n,h;d.Iw()>
g.Iw()?(n=g,h=d):(n=d,h=g);d=n.Ca();g=h.Ca();var l=[0,0],q=[0,0],u=-1,v=0,f,A=new a.ga(0),p=new e,x,w=new a.i,t=new a.i,C=new a.i;n.o(w);h.o(t);w.P(k,k);t.P(k,k);C.K(w);C.Ga(t);n=null;null!=c&&(n=new a.b);f=t=t=null;var y=h.pb;null!=y?(t=y.Ab,f=y.nn,null==t&&(t=a.Ia.ij(h,C))):t=a.Ia.ij(h,C);h=t.Re();y=null;for(null!=f&&(y=f.Re());d.kb();)for(f=0;d.La();){var z=d.ia();z.o(w);if(w.jc(C)&&(null==y||(y.Ch(w,k),-1!=y.next()))){var E=z.$b();h.Fn(z,k);for(var I=h.next();-1!=I;I=h.next()){var J=t.da(I);g.Sb(J);
x=g.ia();var K=x.$b(),G=z.Ga(x,null,l,q,k);if(0<G){var I=l[0],u=q[0],r=2==G?l[1]:NaN,N=2==G?q[1]:NaN;if(2==G){if(E*(r-I)>k)return u=1;var M=E*(r-I);if(g.La()){x=g.ia();G=z.Ga(x,null,l,null,k);if(2==G){var G=l[0],Q=l[1],G=E*(Q-G);if(M+G>k)return u=1}g.Sb(J);g.ia()}if(!g.wl()){g.oi();x=g.oi();G=z.Ga(x,null,l,null,k);if(2==G&&(G=l[0],Q=l[1],G=E*(Q-G),M+G>k))return u=1;g.Sb(J);g.ia()}if(d.La()){J=d.Jb();z=d.ia();G=z.Ga(x,null,l,null,k);if(2==G&&(G=l[0],Q=l[1],G=E*(Q-G),M+G>k))return u=1;d.Sb(J);d.ia()}if(!d.wl()){J=
d.Jb();d.oi();z=d.oi();G=z.Ga(x,null,l,null,k);if(2==G&&(G=l[0],Q=l[1],G=K*(Q-G),M+G>k))return u=1;d.Sb(J);d.ia()}x=b.Oa(d.Jb(),d.Qa,I,r,g.Jb(),g.Qa,u,N);p.Tg.push(x);A.add(A.size)}u=0;null!=c&&(z.Kb(I,n),c.add(n.x),c.add(n.y))}}if(v<p.Tg.length){A.xd(v,A.size,m);z=0;for(I=p.Tg[A.get(v)].Jl;v<p.Tg.length;v++)if(x=p.Tg[A.get(v)],!(x.Oi<z&&x.ji<z))if(E*(x.Oi-z)>k)f=E*(x.ji-x.Oi),z=x.ji,I=x.Jl;else{x.Jl!=I?(f=E*(x.ji-x.Oi),I=x.Jl):f+=E*(x.ji-x.Oi);if(f>k)return u=1;z=x.ji;if(1==z)break}E*(1-z)>k&&(f=
0);v=0;A.resize(0);p.Tg.length=0}}}return u};e.ED=function(d,e,b){var g=d.Ca(),k=e.Ca();for(d=new a.cl(d,e,b,!1);d.next();){e=d.jk();var c=d.ek();g.Sb(e);k.Sb(c);e=g.ia();if(0<k.ia().Ga(e,null,null,null,b))return!0}return!1};e.eA=function(d,e,b,k){var g=d.Ca(),c=new a.i,m=new a.i,n=new a.i;d.o(c);e.o(m);c.P(b,b);c.contains(m);m.P(b,b);n.K(c);n.Ga(m);c=d.pb;null!=c?(c=c.Ab,null==c&&(c=a.Ia.ij(d,n))):c=a.Ia.ij(d,n);d=c.Re();for(var h=new a.b,l=new a.b,q=b*b,u=0;u<e.F();u++)if(e.w(u,h),n.contains(h)){m.K(h.x,
h.y,h.x,h.y);d.Ch(m,b);for(var v=!1,f=d.next();-1!=f;f=d.next())if(g.Sb(c.da(f)),f=g.ia(),f.Kb(f.Gd(h,!1),l),a.b.Zb(l,h)<=q){v=!0;break}if(k){if(!v)return!1}else if(v)return!0}return k?!0:!1};e.ex=function(d,e,b){var g=new a.b,k=b*b,c=d.Ca();d=d.pb;if(null!=d&&(d=d.Ab,null!=d)){var m=new a.i;m.K(e);b=d.xw(m,b);for(m=b.next();-1!=m;m=b.next())if(c.Sb(d.da(m)),c.La()){var m=c.ia(),n=m.Gd(e,!1);m.Kb(n,g);if(a.b.Zb(e,g)<=k)return!0}return!1}for(d=new a.i;c.kb();)for(;c.La();)if(m=c.ia(),m.o(d),d.P(b,
b),d.contains(e)&&(n=m.Gd(e,!1),m.Kb(n,g),a.b.Zb(e,g)<=k))return!0;return!1};e.bA=function(d,a,b){return e.ex(d,a,b)&&!e.bw(d,a,b)};e.bw=function(d,a,b){d=d.Rf();return!e.or(d,a,b)};e.cA=function(d,e,b){if(d.Hm()){var g=new a.yb(e.v,e.C,e.v,e.G),k=new a.yb(e.v,e.G,e.B,e.G),c=new a.yb(e.B,e.G,e.B,e.C);e=new a.yb(e.B,e.C,e.v,e.C);for(d=d.Ca();d.kb();)for(;d.La();){var m=d.ia();if(m.jc(g,b)||m.jc(k,b)||m.jc(c,b)||m.jc(e,b))return!0}}else{g=new a.i;g.K(e);g.P(b,b);b=d.mc(0);k=new a.b;c=new a.b;e=new a.b;
for(var m=new a.b,n=0,h=d.ea();n<h;n++)for(var l=!0,q=d.Ea(n),u=d.Dc(n);q<u;q++)if(l)b.ec(2*q,c),l=!1;else{b.ec(2*q,k);e.J(c);m.J(k);if(0!=g.Nv(e,m))return!0;c.J(k)}}return!1};e.fc=function(d,g,b){var k=d.D(),c=g.D();if(a.T.Th(k)){var m=d.pb;if(null!=m&&(m=m.hi,null!=m))if(33==c){var n=g.w(),n=m.Kk(n.x,n.y);if(1==n)return 1;if(0==n)return 4}else{n=new a.i;g.o(n);n=m.Dn(n);if(1==n)return 1;if(0==n)return 4;if(b&&a.T.Th(c)&&e.zz(g,m))return 1073741824}}if(a.T.Th(c)&&(m=g.pb,null!=m&&(m=m.hi,null!=m)))if(33==
k){d=d.w();n=m.Kk(d.x,d.y);if(1==n)return 2;if(0==n)return 4}else{g=new a.i;d.o(g);n=m.Dn(g);if(1==n)return 2;if(0==n)return 4;if(b&&a.T.Th(k)&&e.zz(d,m))return 1073741824}return 0};e.zz=function(d,e){for(var g=d.F(),b=new a.b,k=0;k<g;k++)if(d.w(k,b),1==e.Kk(b.x,b.y))return!0;return!1};e.AE=function(d,e,b,k){for(var g=1<=d.rj(0)&&1<=e.rj(0),c=d.Ca(),m=e.Ca(),n=[0,0],h=[0,0],l=new a.cl(d,e,b,!1),q=!1;l.next();){var u=l.jk(),f=l.ek();c.Sb(u);m.Sb(f);u=c.ia();f=m.ia().Ga(u,null,h,n,b);if(2==f){q=n[0];
f=n[1];u=u.$b();if(g&&(f-q)*u>b)return!1;q=!0}else if(0!=f){q=n[0];u=h[0];if(0<q&&1>q&&0<u&&1>u)return!1;q=!0}}if(!q)return!1;c=new a.i;m=new a.i;g=new a.i;d.o(c);e.o(m);c.P(1E3*b,1E3*b);m.P(1E3*b,1E3*b);g.K(c);g.Ga(m);return 10<d.F()&&(d=a.Ed.clip(d,g,b,0),d.s())||10<e.F()&&(e=a.Ed.clip(e,g,b,0),e.s())?!1:a.el.vr(d,e,b,"F********",k)};e.wD=function(d,g,b,k){var c=1<=d.rj(0)&&1<=g.rj(0),m=new a.i,n=new a.i,h=new a.i;d.o(m);g.o(n);for(var l=!1,q=e.lm(m,n,b),u=e.lm(n,m,b),f=d.Ca(),v=g.Ca(),A=[0,0],
p=[0,0],x=new a.cl(d,g,b,!1);x.next();){var w=x.jk(),t=x.ek();f.Sb(w);v.Sb(t);t=f.ia();w=v.ia().Ga(t,null,p,A,b);if(2==w){var w=A[0],C=A[1],t=t.$b();if(c&&(C-w)*t>b&&(l=!0,q&&u))return!0}else if(0!=w&&(w=A[0],t=p[0],0<w&&1>w&&0<t&&1>t))return!0}c=new a.i;f=new a.i;c.K(m);c.P(1E3*b,1E3*b);f.K(n);f.P(1E3*b,1E3*b);h.K(c);h.Ga(f);m="";m=l?m+"**":m+"T*";if(q){if(10<g.F()&&(g=a.Ed.clip(g,h,b,0),g.s()))return!1;m+="****"}else m+="T***";if(u){if(10<d.F()&&(d=a.Ed.clip(d,h,b,0),d.s()))return!1;m+="***"}else m+=
"T**";return a.el.vr(d,g,b,m.toString(),k)};e.bC=function(d,g,b,k){var c=[!1],m=e.wB(d,g,b,c);if(c[0])return m;c=new a.i;g.o(c);c.P(1E3*b,1E3*b);return 10<d.F()&&(d=a.Ed.clip(d,c,b,0),d.s())?!1:a.el.su(d,g,b,k)};e.wB=function(d,e,b,k){k[0]=!1;for(var g=d.Ca(),c=e.Ca(),m=[0,0],n=[0,0],h=new a.cl(d,e,b,!1),l=!1;h.next();){var q=h.jk(),u=h.ek();g.Sb(q,-1);c.Sb(u,-1);q=g.ia();q=c.ia().Ga(q,null,n,m,b);if(0!=q&&(l=!0,1==q&&(q=m[0],u=n[0],0<q&&1>q&&0<u&&1>u)))return k[0]=!0,!1}if(!l){k[0]=!0;m=new a.i;
d.o(m);m.P(b,b);h=d;l=!1;n=new a.i;k=0;for(g=e.ea();k<g;k++)if(0<e.Ha(k)){e.Ti(k,n);if(m.jc(n)){if(c=e.Fa(e.Ea(k)),c=a.ff.xl(h,c,0),0==c)return!1}else return!1;l||(!a.ff.An(d,e.ea()-1)||null!=d.pb&&null!=d.pb.Ab?h=d:(c=new a.Ka,d.copyTo(c),c.dj(1),h=c),l=!0)}if(1==d.ea()||1607==e.D())return!0;m=new a.i;e.o(m);m.P(b,b);n=e;h=!1;b=new a.i;k=0;for(g=d.ea();k<g;k++)if(0<d.Ha(k)){d.Ti(k,b);if(m.jc(b)&&(c=d.Fa(d.Ea(k)),c=a.ff.xl(n,c,0),1==c))return!1;h||(!a.ff.An(e,d.ea()-1)||null!=e.pb&&null!=e.pb.Ab?
n=e:(c=new a.Ka,e.copyTo(c),c.dj(1),n=c),h=!0)}return!0}return!1};e.CE=function(d,e,b,k){for(var g=d.Ca(),c=e.Ca(),m=[0,0],n=[0,0],h=new a.cl(d,e,b,!1),l=!1;h.next();){var q=h.jk(),u=h.ek();g.Sb(q);c.Sb(u);q=g.ia();q=c.ia().Ga(q,null,n,m,b);if(2==q)l=!0;else if(0!=q){l=m[0];q=n[0];if(0<l&&1>l&&0<q&&1>q)return!1;l=!0}}if(!l)return!1;c=new a.i;m=new a.i;g=new a.i;d.o(c);e.o(m);c.P(1E3*b,1E3*b);m.P(1E3*b,1E3*b);g.K(c);g.Ga(m);return 10<d.F()&&(d=a.Ed.clip(d,g,b,0),d.s())||10<e.F()&&(e=a.Ed.clip(e,g,
b,0),e.s())?!1:a.el.Vl(d,e,b,"F********",k)};e.YC=function(d,g,b,k){for(var c=d.Ca(),m=g.Ca(),n=[0,0],h=[0,0],l=new a.cl(d,g,b,!1),q=!1;l.next();){var u=l.jk(),f=l.ek();c.Sb(u);m.Sb(f);u=c.ia();u=m.ia().Ga(u,null,h,n,b);if(2==u)q=!0;else if(0!=u){q=n[0];u=h[0];if(0<q&&1>q&&0<u&&1>u)return!0;q=!0}}if(!q)return!1;m=new a.i;n=new a.i;h=new a.i;l=new a.i;c=new a.i;d.o(m);g.o(n);return e.lm(n,m,b)?(h.K(m),h.P(1E3*b,1E3*b),l.K(n),l.P(1E3*b,1E3*b),c.K(h),c.Ga(l),10<d.F()&&(d=a.Ed.clip(d,c,b,0),d.s())||10<
g.F()&&(g=a.Ed.clip(g,c,b,0),g.s())?!1:b=a.el.Vl(d,g,b,"T********",k)):b=a.el.Vl(d,g,b,"T*****T**",k)};e.jC=function(d,g,b,k){var c=[!1],m=e.wB(d,g,b,c);if(c[0])return m;c=new a.i;g.o(c);c.P(1E3*b,1E3*b);return 10<d.F()&&(d=a.Ed.clip(d,c,b,0),d.s())?!1:a.el.dy(d,g,b,k)};e.YB=function(d,e,b){return 1==a.gd.he(d,e,b)?!0:!1};e.yD=function(d,e,b){return 2==a.gd.he(d,e,b)?!0:!1};e.or=function(d,e,b){var g=new a.b;b*=b;for(var k=0;k<d.F();k++)if(d.w(k,g),a.b.Zb(g,e)<=b)return!1;return!0};e.prototype.IB=
function(d,e){d=this.Tg[d];e=this.Tg[e];return d.Jl<e.Jl||d.Jl==e.Jl&&(d.Wt<e.Wt||d.Wt==e.Wt&&(d.Oi<e.Oi||d.Oi==e.Oi&&(d.ji<e.ji||d.ji==e.ji&&d.dE<e.dE)))?-1:1};return e}();a.hd=k})(x||(x={}));(function(a){var b;(function(e){e[e.InteriorInterior=0]="InteriorInterior";e[e.InteriorBoundary=1]="InteriorBoundary";e[e.InteriorExterior=2]="InteriorExterior";e[e.BoundaryInterior=3]="BoundaryInterior";e[e.BoundaryBoundary=4]="BoundaryBoundary";e[e.BoundaryExterior=5]="BoundaryExterior";e[e.ExteriorInterior=
6]="ExteriorInterior";e[e.ExteriorBoundary=7]="ExteriorBoundary";e[e.ExteriorExterior=8]="ExteriorExterior"})(b||(b={}));var k;(function(e){e[e.AreaAreaPredicates=0]="AreaAreaPredicates";e[e.AreaLinePredicates=1]="AreaLinePredicates";e[e.LineLinePredicates=2]="LineLinePredicates";e[e.AreaPointPredicates=3]="AreaPointPredicates";e[e.LinePointPredicates=4]="LinePointPredicates";e[e.PointPointPredicates=5]="PointPointPredicates"})(k||(k={}));b=function(){function e(){this.Xd=0;this.h=new a.gs;this.A=
[0,0,0,0,0,0,0,0,0];this.Ta=[0,0,0,0,0,0,0,0,0];this.Y=[!1,!1,!1,!1,!1,!1,!1,!1,!1];this.Nl=this.$t=-1}e.py=function(d,e,b,k,c){if(9!=k.length)throw a.g.ra("relation string length has to be 9 characters");for(var g=0;9>g;g++){var m=k.charAt(g);if("*"!=m&&"T"!=m&&"F"!=m&&"0"!=m&&"1"!=m&&"2"!=m)throw a.g.ra("relation string");}g=this.YN(k,d.fb(),e.fb());if(0!=g)return a.hd.qy(d,e,b,g,c);g=new a.i;d.o(g);m=new a.i;e.o(m);var n=new a.i;n.K(g);n.Db(m);b=a.Ia.zd(b,n,!1);d=this.NB(d,b);e=this.NB(e,b);if(d.s()||
e.s())return this.rR(d,e,k);g=e.D();m=!1;switch(d.D()){case 1736:switch(g){case 1736:m=this.vr(d,e,b,k,c);break;case 1607:m=this.Vl(d,e,b,k,c);break;case 33:m=this.ur(d,e,b,k,c);break;case 550:m=this.tr(d,e,b,k,c)}break;case 1607:switch(g){case 1736:m=this.Vl(e,d,b,this.Lo(k),c);break;case 1607:m=this.ey(d,e,b,k,c);break;case 33:m=this.xr(d,e,b,k,c);break;case 550:m=this.wr(d,e,b,k,c)}break;case 33:switch(g){case 1736:m=this.ur(e,d,b,this.Lo(k),c);break;case 1607:m=this.xr(e,d,b,this.Lo(k),c);break;
case 33:m=this.KQ(d,e,b,k);break;case 550:m=this.pr(e,d,b,this.Lo(k),c)}break;case 550:switch(g){case 1736:m=this.tr(e,d,b,this.Lo(k),c);break;case 1607:m=this.wr(e,d,b,this.Lo(k),c);break;case 550:m=this.Wx(d,e,b,k,c);break;case 33:m=this.pr(d,e,b,k,c)}break;default:m=!1}return m};e.vr=function(d,g,b,k,c){var m=new e;m.pi();m.si(k);m.vF();var n=new a.i,h=new a.i;d.o(n);g.o(h);k=!1;a.hd.nj(n,h,b)&&(m.Bs(d,g),k=!0);k||(n=a.hd.fc(d,g,!1),4==n?(m.Bs(d,g),k=!0):1==n?(m.Bv(g),k=!0):2==n&&(m.$A(d),k=!0));
k||(k=new a.fd,d=k.Eb(d),g=k.Eb(g),m.In(k,b,c),m.so(d,g),m.h.xg());return e.Mf(m.A,m.Hc)};e.su=function(d,g,b,k){var c=new e;c.pi();c.si("T*****F**");c.vF();var m=new a.i,n=new a.i;d.o(m);g.o(n);var h=!1;a.hd.nj(m,n,b)&&(c.Bs(d,g),h=!0);h||(m=a.hd.fc(d,g,!1),4==m?(c.Bs(d,g),h=!0):1==m?(c.Bv(g),h=!0):2==m&&(c.$A(d),h=!0));if(h)return m=this.Mf(c.A,c.Hc);h=new a.fd;d=h.Eb(d);m=h.Eb(g);a.aj.$(h,b,k,!1);b=h.hf(m).Rf();h.xo(0,!0,!0);a.mm.$(h,d,-1,!1,k);if(0==h.F(d))return!1;a.mm.$(h,m,-1,!1,k);c.Op(h,
k);g=0==h.F(m);if(!g&&(c.so(d,m),c.h.xg(),m=this.Mf(c.A,c.Hc),!m))return m;d=h.hf(d);h=new a.fd;d=h.Eb(d);m=h.Eb(b);c.Op(h,k);c.Xd=0;c.pi();c.si(g?"T*****F**":"******F**");c.wy();c.so(d,m);c.h.xg();return m=this.Mf(c.A,c.Hc)};e.Vl=function(d,g,b,k,c){var m=new e;m.pi();m.si(k);m.wy();var n=new a.i,h=new a.i;d.o(n);g.o(h);k=!1;a.hd.nj(n,h,b)&&(m.Cs(d,g),k=!0);k||(n=a.hd.fc(d,g,!1),4==n?(m.Cs(d,g),k=!0):1==n&&(m.aB(g),k=!0));k||(k=new a.fd,d=k.Eb(d),g=k.Eb(g),m.In(k,b,c),m.Jg=m.h.uo(),e.es(g,m.h,m.Jg),
m.so(d,g),m.h.vo(m.Jg),m.h.xg());return e.Mf(m.A,m.Hc)};e.dy=function(d,g,b,k){var c=new e;c.pi();c.si("T*****F**");c.wy();var m=new a.i,n=new a.i;d.o(m);g.o(n);var h=!1;a.hd.nj(m,n,b)&&(c.Cs(d,g),h=!0);h||(m=a.hd.fc(d,g,!1),4==m?(c.Cs(d,g),h=!0):1==m&&(c.aB(g),h=!0));if(h)return b=this.Mf(c.A,c.Hc);h=new a.fd;d=h.Eb(d);g=h.Eb(g);c.In(h,b,k);if(0==h.F(d))return!1;c.so(d,g);c.h.xg();return b=this.Mf(c.A,c.Hc)};e.tr=function(d,g,b,k,c){var m=new e;m.pi();m.si(k);m.wF();var n=new a.i,h=new a.i;d.o(n);
g.o(h);k=!1;a.hd.nj(n,h,b)&&(m.Ds(d),k=!0);k||(n=a.hd.fc(d,g,!1),4==n?(m.Ds(d),k=!0):1==n&&(m.cK(),k=!0));k||(k=new a.fd,d=k.Eb(d),g=k.Eb(g),m.In(k,b,c),m.Pv(d,g),m.h.xg());return e.Mf(m.A,m.Hc)};e.ey=function(d,g,b,k,c){var m=new e;m.pi();m.si(k);m.ZR();k=new a.i;var n=new a.i;d.o(k);g.o(n);var h=!1;a.hd.nj(k,n,b)&&(m.CD(d,g),h=!0);h||4!=a.hd.fc(d,g,!1)||(m.CD(d,g),h=!0);h||(k=new a.fd,d=k.Eb(d),g=k.Eb(g),m.In(k,b,c),m.ph=m.h.uo(),m.Jg=m.h.uo(),e.es(d,m.h,m.ph),e.es(g,m.h,m.Jg),m.so(d,g),m.h.vo(m.ph),
m.h.vo(m.Jg),m.h.xg());return e.Mf(m.A,m.Hc)};e.wr=function(d,g,b,k,c){var m=new e;m.pi();m.si(k);m.KF();k=new a.i;var n=new a.i;d.o(k);g.o(n);var h=!1;a.hd.nj(k,n,b)&&(m.dx(d),h=!0);h||4!=a.hd.fc(d,g,!1)||(m.dx(d),h=!0);h||(k=new a.fd,d=k.Eb(d),g=k.Eb(g),m.In(k,b,c),m.ph=m.h.uo(),e.es(d,m.h,m.ph),m.Pv(d,g),m.h.vo(m.ph),m.h.xg());return e.Mf(m.A,m.Hc)};e.Wx=function(d,g,b,k,c){var m=new e;m.pi();m.si(k);m.PF();k=new a.i;var n=new a.i;d.o(k);g.o(n);var h=!1;a.hd.nj(k,n,b)&&(m.PE(),h=!0);h||(k=new a.fd,
d=k.Eb(d),g=k.Eb(g),m.In(k,b,c),m.Pv(d,g),m.h.xg());return e.Mf(m.A,m.Hc)};e.ur=function(d,g,b,k){var c=new e;c.pi();c.si(k);c.wF();var m=new a.i;d.o(m);g=g.w();var n=!1;a.hd.ru(g,m,b)&&(c.Ds(d),n=!0);n||(b=a.gd.he(d,g,b),1==b?(c.A[0]=0,c.A[2]=2,c.A[3]=-1,c.A[5]=1,c.A[6]=-1):2==b?(c.A[6]=-1,0!=d.Mh()?(c.A[0]=-1,c.A[3]=0,c.A[2]=2,c.A[5]=1):(c.A[0]=0,c.A[3]=-1,c.A[5]=-1,b=new a.i,d.o(b),c.A[2]=0==b.ba()&&0==b.aa()?-1:1)):c.Ds(d));return this.Mf(c.A,k)};e.xr=function(d,g,b,k,c){var m=new e;m.pi();m.si(k);
m.KF();var n=new a.i;d.o(n);k=g.w();var h=!1;a.hd.ru(k,n,b)&&(m.dx(d),h=!0);if(!h){var n=null,l=h=!1;if(m.Y[0]||m.Y[6])a.hd.ex(d,k,b)?(m.Y[0]&&(n=a.Hh.il(d,c),l=!a.hd.or(n,k,b),h=!0,m.A[0]=l?-1:0),m.A[6]=-1):(m.A[0]=-1,m.A[6]=0);m.Y[3]&&(null!=n&&n.s()?m.A[3]=-1:(h||(null==n&&(n=a.Hh.il(d,c)),l=!a.hd.or(n,k,b),h=!0),m.A[3]=l?0:-1));m.Y[5]&&(null!=n&&n.s()?m.A[5]=-1:h&&!l?m.A[5]=0:(null==n&&(n=a.Hh.il(d,c)),c=a.hd.mu(n,g,b),m.A[5]=c?-1:0));m.Y[2]&&(0!=d.$b()?m.A[2]=1:(c=new a.pe(d.description),c.Pd(d,
0,d.F()),d=a.hd.mu(c,g,b),m.A[2]=d?-1:0))}return this.Mf(m.A,m.Hc)};e.pr=function(d,g,b,k){var c=new e;c.pi();c.si(k);c.PF();var m=new a.i;d.o(m);g=g.w();var n=!1;a.hd.ru(g,m,b)&&(c.PE(),n=!0);if(!n){m=!1;n=!0;b*=b;for(var h=0;h<d.F();h++){var l=d.Fa(h);a.b.Zb(l,g)<=b?m=!0:n=!1;if(m&&!n)break}m?(c.A[0]=0,c.A[2]=n?-1:0,c.A[6]=-1):(c.A[0]=-1,c.A[2]=0,c.A[6]=0)}return e.Mf(c.A,k)};e.KQ=function(d,g,b,k){d=d.w();g=g.w();for(var c=[],m=0;9>m;m++)c[m]=-1;a.b.Zb(d,g)<=b*b?c[0]=0:(c[2]=0,c[6]=0);c[8]=2;return e.Mf(c,
k)};e.Mf=function(d,e){for(var a=0;9>a;a++)switch(e.charAt(a)){case "T":if(-1==d[a])return!1;break;case "F":if(-1!=d[a])return!1;break;case "0":if(0!=d[a])return!1;break;case "1":if(1!=d[a])return!1;break;case "2":if(2!=d[a])return!1}return!0};e.rR=function(d,e,b){var g=[-1,-1,-1,-1,-1,-1,-1,-1,-1];if(d.s()&&e.s()){for(var k=0;9>k;k++)g[k]=-1;return this.Mf(g,b)}k=!1;d.s()&&(d=e,k=!0);g[0]=-1;g[1]=-1;g[3]=-1;g[4]=-1;g[6]=-1;g[7]=-1;g[8]=2;e=d.D();a.T.Kc(e)?1736==e?0!=d.Mh()?(g[2]=2,g[5]=1):(g[5]=
-1,e=new a.i,d.o(e),g[2]=0==e.ba()&&0==e.aa()?0:1):(e=0!=d.$b(),g[2]=e?1:0,g[5]=a.Hh.No(d)?0:-1):(g[2]=0,g[5]=-1);k&&this.qG(g);return this.Mf(g,b)};e.YN=function(d,a,b){return e.mT(d)?3:e.NS(d)?4:e.nT(d,a,b)?8:e.CR(d,a,b)?16:e.yQ(d)?1:e.LK(d,a,b)?32:0};e.mT=function(d){return"T"==d.charAt(0)&&"*"==d.charAt(1)&&"F"==d.charAt(2)&&"*"==d.charAt(3)&&"*"==d.charAt(4)&&"F"==d.charAt(5)&&"F"==d.charAt(6)&&"F"==d.charAt(7)&&"*"==d.charAt(8)?!0:!1};e.NS=function(d){return"F"==d.charAt(0)&&"F"==d.charAt(1)&&
"*"==d.charAt(2)&&"F"==d.charAt(3)&&"F"==d.charAt(4)&&"*"==d.charAt(5)&&"*"==d.charAt(6)&&"*"==d.charAt(7)&&"*"==d.charAt(8)?!0:!1};e.nT=function(d,e,a){if(0==e&&0==a)return!1;if(2!=e||2!=a)if("F"==d.charAt(0)&&"*"==d.charAt(1)&&"*"==d.charAt(2)&&"T"==d.charAt(3)&&"*"==d.charAt(4)&&"*"==d.charAt(5)&&"*"==d.charAt(6)&&"*"==d.charAt(7)&&"*"==d.charAt(8)||1==e&&1==a&&"F"==d.charAt(0)&&"T"==d.charAt(1)&&"*"==d.charAt(2)&&"*"==d.charAt(3)&&"*"==d.charAt(4)&&"*"==d.charAt(5)&&"*"==d.charAt(6)&&"*"==d.charAt(7)&&
"*"==d.charAt(8))return!0;return 0!=a&&"F"==d.charAt(0)&&"*"==d.charAt(1)&&"*"==d.charAt(2)&&"*"==d.charAt(3)&&"T"==d.charAt(4)&&"*"==d.charAt(5)&&"*"==d.charAt(6)&&"*"==d.charAt(7)&&"*"==d.charAt(8)?!0:!1};e.CR=function(d,e,a){return e>a?"T"==d.charAt(0)&&"*"==d.charAt(1)&&"*"==d.charAt(2)&&"*"==d.charAt(3)&&"*"==d.charAt(4)&&"*"==d.charAt(5)&&"T"==d.charAt(6)&&"*"==d.charAt(7)&&"*"==d.charAt(8)?!0:!1:1==e&&1==a&&"0"==d.charAt(0)&&"*"==d.charAt(1)&&"*"==d.charAt(2)&&"*"==d.charAt(3)&&"*"==d.charAt(4)&&
"*"==d.charAt(5)&&"*"==d.charAt(6)&&"*"==d.charAt(7)&&"*"==d.charAt(8)?!0:!1};e.yQ=function(d){return"T"==d.charAt(0)&&"*"==d.charAt(1)&&"*"==d.charAt(2)&&"*"==d.charAt(3)&&"*"==d.charAt(4)&&"*"==d.charAt(5)&&"F"==d.charAt(6)&&"F"==d.charAt(7)&&"*"==d.charAt(8)?!0:!1};e.LK=function(d,e,a){if(e==a){if(1!=e)return"T"==d.charAt(0)&&"*"==d.charAt(1)&&"T"==d.charAt(2)&&"*"==d.charAt(3)&&"*"==d.charAt(4)&&"*"==d.charAt(5)&&"T"==d.charAt(6)&&"*"==d.charAt(7)&&"*"==d.charAt(8)?!0:!1;if("1"==d.charAt(0)&&
"*"==d.charAt(1)&&"T"==d.charAt(2)&&"*"==d.charAt(3)&&"*"==d.charAt(4)&&"*"==d.charAt(5)&&"T"==d.charAt(6)&&"*"==d.charAt(7)&&"*"==d.charAt(8))return!0}return!1};e.es=function(d,e,a){d=e.ya(d);for(var g=e.Be;-1!=g;g=e.Bf(g))if(0!=(e.md(g)&d)){var b=e.te(g);if(-1==b)e.fm(g,a,0);else{var k=b,c=0;do 0!=(e.Gg(k)&d)&&c++,k=e.Wb(e.sa(k));while(k!=b);e.fm(g,a,c)}}};e.Lo=function(d){var e;e=""+d.charAt(0);e+=d.charAt(3);e+=d.charAt(6);e+=d.charAt(1);e+=d.charAt(4);e+=d.charAt(7);e+=d.charAt(2);e+=d.charAt(5);
return e+=d.charAt(8)};e.prototype.pi=function(){for(var d=0;9>d;d++)this.A[d]=-2,this.Ta[d]=-2};e.qG=function(d){var e=d[1],a=d[2],b=d[5];d[1]=d[3];d[2]=d[6];d[5]=d[7];d[3]=e;d[6]=a;d[7]=b};e.prototype.si=function(d){this.Hc=d;for(d=0;9>d;d++)"*"!=this.Hc.charAt(d)?(this.Y[d]=!0,this.Xd++):this.Y[d]=!1};e.prototype.SF=function(){for(var d=0;9>d;d++)this.Y[d]&&-2==this.A[d]&&(this.A[d]=-1,this.Y[d]=!1)};e.prototype.dc=function(d){if(-2==this.A[d])return!1;if(-1==this.A[d])return this.Y[d]=!1,this.Xd--,
!0;if("T"!=this.Hc.charAt(d)&&"F"!=this.Hc.charAt(d)){if(this.A[d]<this.Ta[d])return!1;this.Y[d]=!1;this.Xd--;return!0}this.Y[d]=!1;this.Xd--;return!0};e.prototype.vF=function(){this.$t=0;this.Ta[0]=2;this.Ta[1]=1;this.Ta[2]=2;this.Ta[3]=1;this.Ta[4]=1;this.Ta[5]=1;this.Ta[6]=2;this.Ta[7]=1;this.Ta[8]=2;this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};e.prototype.wy=function(){this.$t=1;this.Nl=3;this.Ta[0]=1;this.Ta[1]=0;this.Ta[2]=2;this.Ta[3]=1;this.Ta[4]=0;this.Ta[5]=1;this.Ta[6]=1;this.Ta[7]=
0;this.Ta[8]=2;this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};e.prototype.ZR=function(){this.$t=2;this.Nl=4;this.Ta[0]=1;this.Ta[1]=0;this.Ta[2]=1;this.Ta[3]=0;this.Ta[4]=0;this.Ta[5]=0;this.Ta[6]=1;this.Ta[7]=0;this.Ta[8]=2;this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};e.prototype.wF=function(){this.Nl=3;this.Ta[0]=0;this.Ta[1]=-1;this.Ta[2]=2;this.Ta[3]=0;this.Ta[4]=-1;this.Ta[5]=1;this.Ta[6]=0;this.Ta[7]=-1;this.Ta[8]=2;this.Y[1]&&(this.A[1]=-1,this.Y[1]=!1,this.Xd--);this.Y[4]&&(this.A[4]=
-1,this.Y[4]=!1,this.Xd--);this.Y[7]&&(this.A[7]=-1,this.Y[7]=!1,this.Xd--);this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};e.prototype.KF=function(){this.Nl=4;this.Ta[0]=0;this.Ta[1]=-1;this.Ta[2]=1;this.Ta[3]=0;this.Ta[4]=-1;this.Ta[5]=0;this.Ta[6]=0;this.Ta[7]=-1;this.Ta[8]=2;this.Y[1]&&(this.A[1]=-1,this.Y[1]=!1,this.Xd--);this.Y[4]&&(this.A[4]=-1,this.Y[4]=!1,this.Xd--);this.Y[7]&&(this.A[7]=-1,this.Y[7]=!1,this.Xd--);this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};e.prototype.PF=function(){this.Nl=
5;this.Ta[0]=0;this.Ta[1]=-1;this.Ta[2]=0;this.Ta[3]=-1;this.Ta[4]=-1;this.Ta[5]=-1;this.Ta[6]=0;this.Ta[7]=-1;this.Ta[8]=2;this.Y[1]&&(this.A[1]=-1,this.Y[1]=!1,this.Xd--);this.Y[3]&&(this.A[3]=-1,this.Y[3]=!1,this.Xd--);this.Y[4]&&(this.A[4]=-1,this.Y[4]=!1,this.Xd--);this.Y[5]&&(this.A[5]=-1,this.Y[5]=!1,this.Xd--);this.Y[7]&&(this.A[7]=-1,this.Y[7]=!1,this.Xd--);this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};e.prototype.aK=function(d,e,a){var g=!0;this.Y[0]&&(this.HO(d,e,a),g=g&&this.dc(0));
this.Y[1]&&(this.eD(d,e,1),g=g&&this.dc(1));this.Y[2]&&(this.fD(d,e,a,2),g=g&&this.dc(2));this.Y[3]&&(this.eD(d,a,3),g=g&&this.dc(3));this.Y[4]&&(this.gK(d,e,a),g=g&&this.dc(4));this.Y[5]&&(this.eB(d,a,5),g=g&&this.dc(5));this.Y[6]&&(this.fD(d,a,e,6),g=g&&this.dc(6));this.Y[7]&&(this.eB(d,e,7),g=g&&this.dc(7));return g};e.prototype.Bs=function(d,e){this.A[0]=-1;this.A[1]=-1;this.A[3]=-1;this.A[4]=-1;this.iq(d,this.Y[2]?2:-1,this.Hc.charAt(2),this.Y[5]?5:-1,this.Hc.charAt(5));this.iq(e,this.Y[6]?6:
-1,this.Hc.charAt(6),this.Y[7]?7:-1,this.Hc.charAt(7))};e.prototype.iq=function(d,e,b,k,c){if(-1!=e||-1!=k)("T"!=b&&"F"!=b&&-1!=e||"T"!=c&&"F"!=c&&-1!=k?0!=d.Mh():1)?(-1!=e&&(this.A[e]=2),-1!=k&&(this.A[k]=1)):(-1!=k&&(this.A[k]=-1),-1!=e&&(b=new a.i,d.o(b),this.A[e]=0==b.ba()&&0==b.aa()?0:1))};e.prototype.Bv=function(d){this.A[2]=2;this.A[3]=-1;this.A[4]=-1;this.A[5]=1;this.A[6]=-1;this.A[7]=-1;this.iq(d,this.Y[0]?0:-1,this.Hc.charAt(0),this.Y[1]?1:-1,this.Hc.charAt(1))};e.prototype.$A=function(d){this.Bv(d);
e.qG(this.A)};e.prototype.Cs=function(d,e){this.A[0]=-1;this.A[1]=-1;this.A[3]=-1;this.A[4]=-1;if(this.Y[6]){var g=this.Hc.charAt(6),g="T"!=g&&"F"!=g?0!=e.$b():!0;this.A[6]=g?1:0}this.Y[7]&&(g=a.Hh.No(e),this.A[7]=g?0:-1);this.iq(d,this.Y[2]?2:-1,this.Hc.charAt(2),this.Y[5]?5:-1,this.Hc.charAt(5))};e.prototype.aB=function(d){if(this.Y[0]){var e=this.Hc.charAt(0),e="T"!=e&&"F"!=e?0!=d.$b():!0;this.A[0]=e?1:0}this.Y[1]&&(d=a.Hh.No(d),this.A[1]=d?0:-1);this.A[2]=2;this.A[3]=-1;this.A[4]=-1;this.A[5]=
1;this.A[6]=-1;this.A[7]=-1};e.prototype.Ds=function(d){this.A[0]=-1;this.A[3]=-1;this.A[6]=0;this.iq(d,this.Y[2]?2:-1,this.Hc.charAt(2),this.Y[5]?5:-1,this.Hc.charAt(5))};e.prototype.cK=function(){this.A[0]=0;this.A[2]=2;this.A[3]=-1;this.A[5]=1;this.A[6]=-1};e.prototype.CD=function(d,e){this.A[0]=-1;this.A[1]=-1;this.A[3]=-1;this.A[4]=-1;if(this.Y[2]){var g=this.Hc.charAt(2),g="T"!=g&&"F"!=g?0!=d.$b():!0;this.A[2]=g?1:0}this.Y[5]&&(g=a.Hh.No(d),this.A[5]=g?0:-1);this.Y[6]&&(g=this.Hc.charAt(6),
g="T"!=g&&"F"!=g?0!=e.$b():!0,this.A[6]=g?1:0);this.Y[7]&&(g=a.Hh.No(e),this.A[7]=g?0:-1)};e.prototype.dx=function(d){this.A[0]=-1;this.A[3]=-1;if(this.Y[2]){var e=this.Hc.charAt(2),e="T"!=e&&"F"!=e?0!=d.$b():!0;this.A[2]=e?1:0}this.Y[5]&&(d=a.Hh.No(d),this.A[5]=d?0:-1);this.A[6]=0};e.prototype.PE=function(){this.A[0]=-1;this.A[2]=0;this.A[6]=0};e.prototype.bK=function(d,e,a){var g=!0;this.Y[0]&&(this.IO(d,e),g=g&&this.dc(0));this.Y[1]&&(this.EO(d,e,a,this.Jg),g=g&&this.dc(1));this.Y[2]&&(this.FO(d,
e),g=g&&this.dc(2));this.Y[3]&&(this.kK(d,e,a,this.Jg),g=g&&this.dc(3));this.Y[4]&&(this.hK(d,e,a,this.Jg),g=g&&this.dc(4));this.Y[5]&&(this.iK(d,e,a),g=g&&this.dc(5));this.Y[6]&&(this.BM(d,e),g=g&&this.dc(6));this.Y[7]&&(this.AM(d,e,a,this.Jg),g=g&&this.dc(7));return g};e.prototype.uP=function(d,e,a){var g=!0;this.Y[0]&&(this.LO(d,e,a,this.ph,this.Jg),g=g&&this.dc(0));this.Y[1]&&(this.gD(d,e,a,this.ph,this.Jg,1),g=g&&this.dc(1));this.Y[2]&&(this.hD(d,e,a,2),g=g&&this.dc(2));this.Y[3]&&(this.gD(d,
a,e,this.Jg,this.ph,3),g=g&&this.dc(3));this.Y[4]&&(this.mK(d,e,a,this.ph,this.Jg),g=g&&this.dc(4));this.Y[5]&&(this.fB(d,a,this.ph,5),g=g&&this.dc(5));this.Y[6]&&(this.hD(d,a,e,6),g=g&&this.dc(6));this.Y[7]&&(this.fB(d,e,this.Jg,7),g=g&&this.dc(7));return g};e.prototype.bB=function(d,e,a){var g=!0;this.Y[0]&&(this.JO(d,e),g=g&&this.dc(0));this.Y[2]&&(this.GO(d,e),g=g&&this.dc(2));this.Y[3]&&(this.lK(d,e,a),g=g&&this.dc(3));this.Y[5]&&(this.jK(d,e),g=g&&this.dc(5));this.Y[6]&&(this.CM(d,e),g=g&&this.dc(6));
return g};e.prototype.DD=function(d,e,a){var g=!0;this.Y[0]&&(this.MO(d,e,a,this.ph),g=g&&this.dc(0));this.Y[2]&&(this.KO(d,a),g=g&&this.dc(2));this.Y[3]&&(this.oK(d,e,a,this.ph),g=g&&this.dc(3));this.Y[5]&&(this.nK(d,e,a,this.ph),g=g&&this.dc(5));this.Y[6]&&(this.DM(d,e,a),g=g&&this.dc(6));return g};e.prototype.JQ=function(d,e,a){var g=!0;this.Y[0]&&(this.NO(d,e,a),g=g&&this.dc(0));this.Y[2]&&(this.iD(d,e,a,2),g=g&&this.dc(2));this.Y[6]&&(this.iD(d,a,e,6),g=g&&this.dc(6));return g};e.prototype.HO=
function(d,e,a){2!=this.A[0]&&(d=this.h.Qe(d),0!=(d&e)&&0!=(d&a)&&(this.A[0]=2))};e.prototype.eD=function(d,e,a){if(1!=this.A[a]){var g=this.h.Qe(this.h.sa(d));0!=(this.h.Qe(d)&e)&&0!=(g&e)&&(this.A[a]=1)}};e.prototype.fD=function(d,e,a,b){2!=this.A[b]&&(d=this.h.Qe(d),0!=(d&e)&&0==(d&a)&&(this.A[b]=2))};e.prototype.gK=function(d,e,a){if(1!=this.A[4]){var g=this.h.Gg(d);0!=(g&e)&&0!=(g&a)?this.A[4]=1:0!=this.A[4]&&1!=this.h.tb(this.h.fe(this.h.sa(d)),this.ni)&&(d=this.h.md(this.h.jf(d)),0!=(d&e)&&
0!=(d&a)&&(this.A[4]=0))}};e.prototype.eB=function(d,e,a){if(1!=this.A[a]){var g=this.h.Qe(this.h.sa(d));0==(this.h.Qe(d)&e)&&0==(g&e)&&(this.A[a]=1)}};e.prototype.IO=function(d,e){if(1!=this.A[0]){var a=this.h.Qe(this.h.sa(d));0!=(this.h.Qe(d)&e)&&0!=(a&e)&&(this.A[0]=1)}};e.prototype.EO=function(d,e,a,b){if(0!=this.A[1]&&1!=this.h.tb(this.h.fe(this.h.sa(d)),this.ni)){var g=this.h.jf(d),k=this.h.md(g);0==(k&e)&&0!=(this.h.Qe(d)&e)&&(d=this.h.Sf(g,b),0!=(k&a)&&0!=d%2&&(this.A[1]=0))}};e.prototype.FO=
function(d,e){2!=this.A[2]&&0!=(this.h.Gg(d)&e)&&(this.A[2]=2)};e.prototype.kK=function(d,e,a,b){if(1!=this.A[3]){var g=this.h.Gg(d);0!=(g&e)&&0!=(g&a)?this.A[3]=1:0!=this.A[3]&&1!=this.h.tb(this.h.fe(this.h.sa(d)),this.ni)&&(g=this.h.jf(d),d=this.h.md(g),0!=(d&e)&&(e=this.h.Sf(g,b),0!=(d&a)&&0==e%2&&(this.A[3]=0)))}};e.prototype.hK=function(d,e,a,b){if(0!=this.A[4]&&1!=this.h.tb(this.h.fe(this.h.sa(d)),this.ni)){var g=this.h.jf(d);d=this.h.md(g);0!=(d&e)&&(e=this.h.Sf(g,b),0!=(d&a)&&0!=e%2&&(this.A[4]=
0))}};e.prototype.iK=function(d,e,a){1!=this.A[5]&&(d=this.h.Gg(d),0!=(d&e)&&0==(d&a)&&(this.A[5]=1))};e.prototype.BM=function(d,e){if(1!=this.A[6]){var a=this.h.Qe(this.h.sa(d));0==(this.h.Qe(d)&e)&&0==(a&e)&&(this.A[6]=1)}};e.prototype.AM=function(d,e,a,b){if(0!=this.A[7]&&1!=this.h.tb(this.h.fe(this.h.sa(d)),this.ni)){var g=this.h.jf(d),k=this.h.md(g);0==(k&e)&&0==(this.h.Qe(d)&e)&&(d=this.h.Sf(g,b),0!=(k&a)&&0!=d%2&&(this.A[7]=0))}};e.prototype.LO=function(d,e,a,b,k){if(1!=this.A[0]){var g=this.h.Gg(d);
0!=(g&e)&&0!=(g&a)?this.A[0]=1:0!=this.A[0]&&1!=this.h.tb(this.h.fe(this.h.sa(d)),this.ni)&&(d=this.h.jf(d),g=this.h.md(d),0!=(g&e)&&0!=(g&a)&&(e=this.h.Sf(d,b),k=this.h.Sf(d,k),0==e%2&&0==k%2&&(this.A[0]=0)))}};e.prototype.gD=function(d,e,a,b,k,c){if(0!=this.A[c]&&1!=this.h.tb(this.h.fe(this.h.sa(d)),this.ni)){d=this.h.jf(d);var g=this.h.md(d);0!=(g&e)&&0!=(g&a)&&(e=this.h.Sf(d,b),k=this.h.Sf(d,k),0==e%2&&0!=k%2&&(this.A[c]=0))}};e.prototype.hD=function(d,e,a,b){1!=this.A[b]&&(d=this.h.Gg(d),0!=
(d&e)&&0==(d&a)&&(this.A[b]=1))};e.prototype.mK=function(d,e,a,b,k){if(0!=this.A[4]&&1!=this.h.tb(this.h.fe(this.h.sa(d)),this.ni)){d=this.h.jf(d);var g=this.h.md(d);0!=(g&e)&&0!=(g&a)&&(e=this.h.Sf(d,b),k=this.h.Sf(d,k),0!=e%2&&0!=k%2&&(this.A[4]=0))}};e.prototype.fB=function(d,e,a,b){0!=this.A[b]&&1!=this.h.tb(this.h.fe(this.h.sa(d)),this.ni)&&(d=this.h.jf(d),0==(this.h.md(d)&e)&&0!=this.h.Sf(d,a)%2&&(this.A[b]=0))};e.prototype.JO=function(d,e){0!=this.A[0]&&0==(this.h.md(d)&e)&&0!=(this.h.pj(this.h.mw(d))&
e)&&(this.A[0]=0)};e.prototype.GO=function(d,e){2!=this.A[2]&&0!=(this.h.md(d)&e)&&(this.A[2]=2)};e.prototype.lK=function(d,e,a){0!=this.A[3]&&(d=this.h.md(d),0!=(d&e)&&0!=(d&a)&&(this.A[3]=0))};e.prototype.jK=function(d,e){1!=this.A[5]&&0!=(this.h.md(d)&e)&&(this.A[5]=1)};e.prototype.CM=function(d,e){0!=this.A[6]&&0==(this.h.md(d)&e)&&0==(this.h.pj(this.h.mw(d))&e)&&(this.A[6]=0)};e.prototype.MO=function(d,e,a,b){if(0!=this.A[0]){var g=this.h.md(d);0!=(g&e)&&0!=(g&a)&&0==this.h.Sf(d,b)%2&&(this.A[0]=
0)}};e.prototype.KO=function(d,e){1!=this.A[2]&&(-1!=this.h.te(d)?this.A[2]=1:0!=this.A[2]&&0==(this.h.md(d)&e)&&(this.A[2]=0))};e.prototype.oK=function(d,e,a,b){if(0!=this.A[3]){var g=this.h.md(d);0!=(g&e)&&0!=(g&a)&&0!=this.h.Sf(d,b)%2&&(this.A[3]=0)}};e.prototype.nK=function(d,e,a,b){if(0!=this.A[5]){var g=this.h.md(d);0!=(g&e)&&0==(g&a)&&0!=this.h.Sf(d,b)%2&&(this.A[5]=0)}};e.prototype.DM=function(d,e,a){0!=this.A[6]&&(d=this.h.md(d),0==(d&e)&&0!=(d&a)&&(this.A[6]=0))};e.prototype.NO=function(d,
e,a){0!=this.A[0]&&(d=this.h.md(d),0!=(d&e)&&0!=(d&a)&&(this.A[0]=0))};e.prototype.iD=function(d,e,a,b){0!=this.A[b]&&(d=this.h.md(d),0!=(d&e)&&0==(d&a)&&(this.A[b]=0))};e.prototype.so=function(d,e){var g=!1;d=this.h.ya(d);e=this.h.ya(e);this.ni=this.h.Eg();for(var b=this.h.Be;-1!=b;b=this.h.Bf(b)){var k=this.h.te(b);if(-1==k){if(-1!=this.Nl)switch(this.Nl){case 3:g=this.bB(b,d,e);break;case 4:g=this.DD(b,d,e);break;default:throw a.g.ra("internal error");}}else{var c=k;do{var n=c;if(1!=this.h.tb(n,
this.ni)){do{switch(this.$t){case 0:g=this.aK(n,d,e);break;case 1:g=this.bK(n,d,e);break;case 2:g=this.uP(n,d,e);break;default:throw a.g.ra("internal error");}if(g)break;this.h.Bb(n,this.ni,1);n=this.h.Wb(n)}while(n!=c&&!g)}if(g)break;c=this.h.Wb(this.h.sa(n))}while(c!=k);if(g)break}}g||this.SF();this.h.kh(this.ni)};e.prototype.Pv=function(d,e){var g=!1;d=this.h.ya(d);e=this.h.ya(e);for(var b=this.h.Be;-1!=b;b=this.h.Bf(b)){switch(this.Nl){case 3:g=this.bB(b,d,e);break;case 4:g=this.DD(b,d,e);break;
case 5:g=this.JQ(b,d,e);break;default:throw a.g.wa();}if(g)break}g||this.SF()};e.prototype.Op=function(d,e){this.h.Mp(d,e)};e.prototype.In=function(d,e,a){this.tM(d,e,a);this.Op(d,a)};e.prototype.tM=function(d,e,b){a.aj.$(d,e,b,!1);d.xo(0,!0,!0);for(e=d.$c;-1!=e;e=d.we(e))1736==d.Lb(e)&&a.mm.$(d,e,-1,!1,b)};e.NB=function(d,e){var g=d.D();if(a.T.Lc(g))return g=new a.Xa(d.description),g.Bc(d,!0),g;if(197==g){g=new a.i;d.o(g);if(g.ba()<=e&&g.aa()<=e)return g=new a.Va(d.description),d.Af(g),g;if(g.ba()<=
e||g.aa()<=e)return g=new a.Xa(d.description),e=new a.Va,d.uf(0,e),g.df(e),d.uf(2,e),g.lineTo(e),g;g=new a.Ka(d.description);g.Wc(d,!1);return g}return d};return e}();a.el=b})(x||(x={}));(function(a){var b=function(){function d(d){this.Dl=new a.ga(0);this.Ot=new a.ga(0);this.Ar=new a.b;this.Br=new a.b;this.a=d;this.Tq=-1}d.prototype.cc=function(d){return this.a.cc(this.Jw(d))};d.prototype.ot=function(d){var e=this.tw(d);d=this.vC(d);if(this.a.Ua(e)==d){var a=e,e=d;d=a}this.a.uc(e,this.Ar);this.a.uc(d,
this.Br);return this.Ar.y<this.Br.y};d.prototype.Jw=function(d){var e=this.tw(d);d=this.vC(d);return this.a.X(e)==d?e:d};d.prototype.tw=function(d){return this.Dl.get(d)};d.prototype.vC=function(d){return this.Ot.get(d)};d.prototype.hC=function(d){this.Dl.set(d,this.Tq);this.Tq=d};d.prototype.GE=function(d){if(-1!=this.Tq){var e=this.Tq;this.Tq=this.Dl.get(e);this.Dl.set(e,d);this.Ot.set(e,this.a.X(d));return e}null==this.Dl&&(this.Dl=new a.ga(0),this.Ot=new a.ga(0));e=this.Dl.size;this.Dl.add(d);
this.Ot.add(this.a.X(d));return e};d.prototype.Dw=function(d){return this.a.rd(this.tw(d))};return d}();a.BT=b;var k=function(){function d(d){this.me=d;this.Vd=new a.yb;this.Kl=new a.yb;this.eE=0;this.on=null;this.zx=-1}d.prototype.compare=function(d,e,a){a=d.da(a);var g=this.me.$a,b;this.zx==e?b=this.eE:(this.on=g.cc(e),null==this.on?(d=g.a,d.Oc(g.Jw(e),this.Vd),this.on=this.Vd,b=this.Vd.xe(this.me.Zg,0)):b=this.on.xe(this.me.Zg,0),this.eE=b,this.zx=e);d=g.cc(a);var k;null==d?(d=g.a,d.Oc(g.Jw(a),
this.Kl),d=this.Kl,k=this.Kl.xe(this.me.Zg,0)):k=d.xe(this.me.Zg,0);b==k&&(e=g.ot(e),a=g.ot(a),a=Math.min(e?this.on.ha:this.on.ja,a?d.ha:d.ja),e=.5*(a+this.me.Zg),e==this.me.Zg&&(e=a),b=this.on.xe(e,0),k=d.xe(e,0));return b<k?-1:b>k?1:0};d.prototype.reset=function(){this.zx=-1};return d}(),e=function(){function d(){this.Rl=this.Dk=null;this.Za=new a.bj;this.Za.lM();this.Ld=new k(this);this.Za.Hn(this.Ld)}d.prototype.XM=function(){var d=!1;this.Qt&&(d=this.YM());if(1==this.a.ea(this.U)){var e=this.a.Vb(this.U),
d=this.a.Gw(e);this.a.Dy(e,!0);return 0>d?(d=this.a.Cb(e),this.a.lF(d),this.a.Wi(e,this.a.Ua(d)),!0):!1}this.Ak=this.a.Uv();this.kn=this.a.Uv();for(e=this.a.Vb(this.U);-1!=e;e=this.a.bc(e))this.a.Rp(e,this.Ak,0),this.a.Rp(e,this.kn,-1);e=new a.ga(0);this.Zg=NaN;var b=new a.b;this.lr=this.a.ea(this.U);this.fn=this.a.re();this.br=this.a.re();for(var k=this.Dk.gc(this.Dk.Wd);-1!=k;k=this.Dk.bb(k)){var c=this.Dk.getData(k);this.a.uc(c,b);b.y!=this.Zg&&0!=e.size&&(d=this.yr(e)||d,this.Ld.reset(),e.clear(!1));
e.add(c);this.Zg=b.y;if(0==this.lr)break}0<this.lr&&(d=this.yr(e)||d,e.clear(!1));this.a.bf(this.fn);this.a.bf(this.br);for(e=this.a.Vb(this.U);-1!=e;)if(3==this.a.Ei(e,this.Ak)){this.a.Dy(e,!0);b=e;for(e=this.a.Ei(e,this.kn);-1!=e;)k=this.a.Ei(e,this.kn),this.a.bQ(this.U,this.a.bc(b),e),b=e,e=k;e=this.a.bc(b)}else this.a.Dy(e,!1),e=this.a.bc(e);this.a.ty(this.Ak);this.a.ty(this.kn);return d};d.prototype.yr=function(d){return this.WQ(d)};d.prototype.WQ=function(d){var e=!1;null==this.$a&&(this.$a=
new b(this.a));null==this.Rl?(this.Rl=new a.ga(0),this.Rl.xb(16)):this.Rl.clear(!1);this.VQ(d);for(var g=0,k=d.size;g<k;g++){var c=d.get(g);-1!=c&&this.bD(c,-1)}for(g=0;g<this.Rl.size&&0<this.lr;g++)if(d=this.Rl.get(g),c=this.$a.Dw(this.Za.da(d)),k=-1,0==this.a.Ei(c,this.Ak)){for(var c=this.Za.ge(d),n=d,h;-1!=c;){var l=this.Za.da(c),q=this.$a.Dw(l),u=this.a.Ei(q,this.Ak);if(0!=u){k=q;break}n=c;c=this.Za.ge(c)}-1==c?(h=!0,c=n):(l=this.Za.da(c),h=this.$a.ot(l),c=this.Za.bb(c),h=!h);do{l=this.Za.da(c);
q=this.$a.Dw(l);u=this.a.Ei(q,this.Ak);if(0==u&&(h!=this.$a.ot(l)&&(e=this.a.Cb(q),this.a.lF(e),this.a.Wi(q,this.a.Ua(e)),e=!0),this.a.Rp(q,this.Ak,h?3:2),h||(n=this.a.Ei(k,this.kn),this.a.Rp(k,this.kn,q),this.a.Rp(q,this.kn,n)),this.lr--,0==this.lr))return e;k=q;n=c;c=this.Za.bb(c);h=!h}while(n!=d)}return e};d.prototype.VQ=function(d){for(var e=0,a=d.size;e<a;e++){var g=d.get(e),b=this.a.Ra(g,this.fn),k=this.a.Ra(g,this.br);if(-1!=b){var c=this.Za.da(b);this.$a.hC(c);this.a.lb(g,this.fn,-1)}-1!=
k&&(c=this.Za.da(k),this.$a.hC(c),this.a.lb(g,this.br,-1));c=-1;-1!=b&&-1!=k?(this.Za.kd(b,-1),this.Za.kd(k,-1),d.set(e,-1)):c=-1!=b?b:k;-1!=c&&(this.bD(g,c)||this.Za.kd(c,-1),d.set(e,-1))}};d.prototype.bD=function(d,e){var g=new a.b,b=new a.b;this.a.uc(d,g);var k=this.a.X(d);this.a.uc(k,b);var c=!1;if(g.y<b.y){var c=!0,m=this.$a.GE(d),n;-1==e?n=this.Za.addElement(m,-1):(n=e,this.Za.Vi(n,m));m=this.a.Ra(k,this.fn);-1==m?this.a.lb(k,this.fn,n):this.a.lb(k,this.br,n);k=this.a.rd(d);0==this.a.Ei(k,this.Ak)&&
this.Rl.add(n)}k=this.a.Ua(d);this.a.uc(k,b);g.y<b.y&&(c=!0,m=this.$a.GE(k),-1==e?n=this.Za.addElement(m,-1):(n=e,this.Za.Vi(n,m)),m=this.a.Ra(k,this.fn),-1==m?this.a.lb(k,this.fn,n):this.a.lb(k,this.br,n),k=this.a.rd(d),0==this.a.Ei(k,this.Ak)&&this.Rl.add(n));return c};d.$=function(e,a,b,k){var g=new d;g.a=e;g.U=a;g.Dk=b;g.Qt=k;return g.XM()};d.prototype.YM=function(){var d=new a.ga(0),e=new a.ga(0),b=-1,k=-1,c=new a.b;c.Eh();for(var n=-1,h=-1,l=-1,q=new a.b,u=this.Dk.gc(this.Dk.Wd);-1!=u;u=this.Dk.bb(u)){var f=
this.Dk.getData(u);this.a.uc(f,q);var A=this.a.rd(f);c.ub(q)&&h==A?(-1==k&&(b=this.a.Uv(),k=this.a.re()),-1==l&&(l=e.size,this.a.lb(n,k,l),e.add(1),-1==this.a.Ei(A,b)&&(this.a.Rp(A,b,n),d.add(A))),this.a.lb(f,k,l),e.JF(e.tc()+1)):(l=-1,c.J(q));n=f;h=A}if(0==d.size)return!1;c=new a.ga(0);n=new a.ga(0);h=0;for(l=d.size;h<l;h++){var A=d.get(h),p=this.a.Ei(A,b),f=this.a.Ra(p,k);c.clear(!1);n.clear(!1);c.add(p);n.add(f);for(f=this.a.X(p);f!=p;f=this.a.X(f)){var x=f,q=this.a.Ra(x,k);if(-1!=q)if(0==n.size)n.add(q),
c.add(x);else if(n.tc()==q){var u=c.tc(),w=this.a.X(u),p=this.a.X(x);this.a.Sc(u,p);this.a.Tc(p,u);this.a.Sc(x,w);this.a.Tc(w,x);x=[!1];w=this.a.aD(this.U,w,this.a.Cb(A),x);this.a.lb(f,k,-1);x[0]&&this.a.Dh(A,p);f=this.a.Ha(A);p=this.a.Ha(w);f-=p;this.a.hm(A,f);e.set(q,e.get(q)-1);1==e.get(q)&&(e.set(q,0),n.af(),c.af());f=p=u}else c.add(f),n.add(q)}}this.a.ty(b);this.a.bf(k);return!0};return d}();a.AI=e})(x||(x={}));(function(a){var b=function(){function b(){}b.prototype.Ag=function(){this.Mx=this.ib=
null};b.prototype.get=function(){return this.Mx};b.prototype.set=function(e){this.Mx=e;if(null!=e)throw 322==e.D()&&(this.ib=e),a.g.wa();};b.prototype.create=function(e){if(322==e)this.mq();else throw a.g.ra("Not Implemented");};b.prototype.mq=function(){null==this.ib&&(this.ib=new a.yb);this.Mx=this.ib};return b}();a.Ag=b})(x||(x={}));(function(a){a=a.FI||(a.FI={});a[a.enumLineSeg=1]="enumLineSeg";a[a.enumBezierSeg=2]="enumBezierSeg";a[a.enumArcSeg=4]="enumArcSeg";a[a.enumNonlinearSegmentMask=6]=
"enumNonlinearSegmentMask";a[a.enumSegmentMask=7]="enumSegmentMask";a[a.enumDensified=8]="enumDensified"})(x||(x={}));(function(a){var b=function(){return function(e){this.ri=e;this.dz=this.ez=1;this.ky=this.jy=this.ly=0}}(),k=function(){function e(){this.op=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.Ij=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.nf=new a.Va;this.ka=this.fu=0;this.an=[];this.ir=[];this.bu=[];this.qp=[];this.Jx=[]}e.prototype.ny=function(d){if(null!=d){for(var e=0,a=d.length;e<a;e++)this.oR(d[e]);
d.length=0}};e.prototype.oR=function(d){d.ri=null;this.qp.push(d)};e.prototype.nu=function(d){if(0===this.qp.length)var e=new b(d);else e=this.qp[this.qp.length-1],e.ri=d,--this.qp.length;return e};e.prototype.dO=function(d,e){return 0==d?this.ir[e]:this.bu[e]};e.prototype.Zx=function(){this.fu>=this.Jx.length&&this.Jx.push(new a.Ag);var d=this.Jx[this.fu];this.fu++;return d};e.prototype.clear=function(){this.ny(this.an);this.ny(this.ir);this.ny(this.bu);this.fu=0};e.prototype.zn=function(d){this.an.push(this.nu(d))};
e.prototype.kk=function(d){return 0==d?this.ir.length:this.bu.length};e.prototype.Io=function(d,e){return this.dO(d,e).ri};e.prototype.Ga=function(d,e){if(2!=this.an.length)throw a.g.wa();this.ka=d;var g=a.vi.Ty(.01*d),b=!1,k=this.an[0],c=this.an[1];if(e||0!=(k.ri.fq(c.ri,d,!0)&5)){if(322==k.ri.D()&&(e=k.ri,322==c.ri.D())){var n=c.ri,h=a.yb.ov(e,n,null,this.op,this.Ij,d);if(0==h)throw a.yb.ov(e,n,null,this.op,this.Ij,d),a.g.wa();d=Array(9);a.I.Ps(d,null);for(var l=0;l<h;l++){var q=this.op[l],u=this.Ij[l],
f=k.ky,A=1;0==q?(f=k.ly,A=k.ez):1==q&&(f=k.jy,A=k.dz);var p=c.ky,x=1;0==u?(p=c.ly,x=c.ez):1==u&&(p=c.jy,x=c.dz);var w=new a.b;f==p?(f=new a.b,e.Kb(q,f),q=new a.b,n.Kb(u,q),u=A+x,x/=u,a.vi.BD(f,q,x,w),a.b.Zb(w,f)+a.b.Zb(w,q)>g&&(b=!0)):f>p?(e.Kb(q,w),q=new a.b,n.Kb(u,q),a.b.Zb(w,q)>g&&(b=!0)):(n.Kb(u,w),f=new a.b,e.Kb(q,f),a.b.Zb(w,f)>g&&(b=!0));d[l]=w}k=0;c=-1;for(l=0;l<=h;l++)x=l<h?this.op[l]:1,x!=k&&(g=this.Zx(),e.Bi(k,x,g),-1!=c&&g.get().ed(d[c]),l!=h&&g.get().vd(d[l]),k=x,this.ir.push(this.nu(g.get()))),
c=l;e=[0,0,0,0,0,0,0,0,0];for(l=0;l<h;l++)e[l]=l;1<h&&this.Ij[0]>this.Ij[1]&&(x=this.Ij[0],this.Ij[0]=this.Ij[1],this.Ij[1]=x,l=e[0],e[0]=e[1],e[1]=l);k=0;c=-1;for(l=0;l<=h;l++)x=l<h?this.Ij[l]:1,x!=k&&(g=this.Zx(),n.Bi(k,x,g),-1!=c&&(k=e[c],g.get().ed(d[k])),l!=h&&(k=e[l],g.get().vd(d[k])),k=x,this.bu.push(this.nu(g.get()))),c=l;return b}throw a.g.wa();}return!1};e.prototype.Tw=function(d,e,b){e.copyTo(this.nf);if(1!=this.an.length)throw a.g.wa();this.ka=d;var g=this.an[0];if(b||g.ri.qs(e.w(),d,
!0))if(322==g.ri.D()){d=g.ri;var k=d.Gd(e.w(),!1);this.op[0]=k;var c=g.ky;b=1;0==k?(c=g.ly,b=g.ez):1==k&&(c=g.jy,b=g.dz);g=new a.b;0==c?(c=new a.b,d.Kb(k,c),e=e.w(),a.vi.BD(c,e,1/(b+1),g)):0<c?(g=new a.b,d.Kb(k,g)):g=e.w();b=0;k=-1;for(c=0;1>=c;c++){e=1>c?this.op[c]:1;if(e!=b){var m=this.Zx();d.Bi(b,e,m);-1!=k&&m.get().ed(g);1!=c&&m.get().vd(g);b=e;this.ir.push(this.nu(m.get()))}k=c}this.nf.ic(g)}else throw a.g.wa();};return e}();a.gA=k})(x||(x={}));(function(a){var b=function(){function b(e){this.Pq=
this.yj=this.ib=null;this.zk=this.Ee=this.Gc=this.ze=this.Sg=this.Qa=0;this.ab=null;this.zl=!1;this.ze=-1;this.Sg=this.Gc=0;this.Qa=-1;this.ab=e;this.Ee=this.eq(this.Sg);this.zl=!1;this.yj=null;this.zk=-1;this.Pq=new a.b}b.Yn=function(e,d){if(0>d||d>=e.F())throw a.g.Uc();var g=new b(e),k=e.Ew(d);g.Gc=d-e.Ea(k);g.Sg=k+1;g.Qa=k;g.Ee=g.eq(g.Qa);g.zk=g.ab.Ea(g.Qa);return g};b.Un=function(e,d,g){if(0>d||d>=e.ea()||0>g)throw a.g.Uc();var k=e.vc(d)?0:1;if(g>=e.Ha(d)-k)throw a.g.Uc();e=new b(e);e.ze=-1;e.Gc=
g;e.Qa=d;e.Sg=e.Gc+1;e.Ee=e.eq(e.Sg);e.zk=e.ab.Ea(e.Qa);return e};b.prototype.xR=function(e){if(this.ab!=e.ab)throw a.g.xa();this.ze=e.ze;this.Gc=e.Gc;this.Qa=e.Qa;this.Sg=e.Sg;this.Ee=e.Ee;this.zl=e.zl;this.zk=e.zk;this.yj=null};b.prototype.ia=function(){this.ze!=this.Gc&&this.JA();if(this.zl)this.Gc=(this.Gc+1)%this.Ee;else{if(this.Gc==this.Ee)throw a.g.Uc();this.Gc++}return this.yj};b.prototype.oi=function(){if(this.zl)this.Gc=(this.Ee+this.Gc-1)%this.Ee;else{if(0==this.Gc)throw a.g.Uc();this.Gc--}this.Gc!=
this.ze&&this.JA();return this.yj};b.prototype.yR=function(){this.ze=-1;this.Gc=0};b.prototype.zR=function(){this.Gc=this.Ee;this.ze=-1};b.prototype.Sb=function(e,d){void 0===d&&(d=-1);if(0<=this.Qa&&this.Qa<this.ab.ea()){var a=this.uJ();if(e>=a&&e<this.ab.Dc(this.Qa)){this.ze=-1;this.Gc=e-a;return}}a=0<=d&&d<this.ab.ea()&&e>=this.ab.Ea(d)&&e<this.ab.Dc(d)?d:this.ab.Ew(e);this.Sg=a+1;this.Qa=a;this.ze=-1;this.Gc=e-this.ab.Ea(a);this.Ee=this.eq(a);this.zk=this.ab.Ea(this.Qa)};b.prototype.kb=function(){this.Qa=
this.Sg;if(this.Qa>=this.ab.ea())return!1;this.ze=-1;this.Gc=0;this.Ee=this.eq(this.Qa);this.zk=this.ab.Ea(this.Qa);this.Sg++;return!0};b.prototype.Lk=function(){this.Ee=this.Gc=this.ze=-1;this.Sg=0;this.zk=this.Qa=-1};b.prototype.vy=function(e){if(0>e)throw a.g.Uc();this.Sg=e;this.zk=this.Ee=this.Gc=this.ze=this.Qa=-1};b.prototype.eq=function(e){if(this.ab.sc())return 0;var d=1;this.ab.vc(e)&&(d=0);return this.ab.Ha(e)-d};b.prototype.lD=function(){return this.ze==this.Ee-1&&this.ab.vc(this.Qa)};
b.prototype.NR=function(){this.zl=!0};b.prototype.Jb=function(){return this.ab.jb.f[this.Qa]+this.ze};b.prototype.uJ=function(){return this.ab.Ea(this.Qa)};b.prototype.Bm=function(){return this.lD()?this.ab.Ea(this.Qa):this.Jb()+1};b.prototype.wl=function(){return 0==this.ze};b.prototype.Jm=function(){return this.ze==this.Ee-1};b.prototype.La=function(){return this.Gc<this.Ee};b.prototype.Ow=function(){return 0<this.Gc};b.prototype.vm=function(){var e=new b(this.ab);e.ze=this.ze;e.Gc=this.Gc;e.Ee=
this.Ee;e.Qa=this.Qa;e.Sg=this.Sg;e.ab=this.ab;e.zl=this.zl;return e};b.prototype.JA=function(){if(0>this.Gc||this.Gc>=this.Ee)throw a.g.Uc();this.ze=this.Gc;var e=this.Jb();this.ab.kc();var d=this.ab.Fe,g=1;null!=d&&(g=d.read(e)&7);d=this.ab.description;switch(g){case 1:null==this.ib&&(this.ib=new a.yb);this.yj=this.ib;break;case 2:throw a.g.ra("internal error");case 4:throw a.g.wa();default:throw a.g.wa();}this.yj.Qf(d);g=this.Bm();this.ab.uc(e,this.Pq);this.yj.ed(this.Pq);this.ab.uc(g,this.Pq);
this.yj.vd(this.Pq);for(var b=1,k=d.Aa;b<k;b++)for(var c=d.Hd(b),n=a.pa.Wa(c),h=0;h<n;h++){var l=this.ab.ld(c,e,h);this.yj.My(c,h,l);l=this.ab.ld(c,g,h);this.yj.Cy(c,h,l)}};b.prototype.YO=function(){return this.Qa==this.ab.ea()-1};return b}();a.GI=b})(x||(x={}));(function(a){var b=function(){function b(e){e instanceof a.T?(this.ZD=e,this.ua=-1,this.Wh=1):(this.DP=e.slice(0),this.ua=-1,this.Wh=e.length)}b.prototype.ya=function(){return this.ua};b.prototype.next=function(){return this.ua<this.Wh-1?
(this.ua++,null!=this.ZD?this.ZD:this.DP[this.ua]):null};return b}();a.Pc=b})(x||(x={}));(function(a){var b=function(){return function(){this.next=null}}(),k=function(){function e(){this.Cp=this.ju=this.ku=this.vj=this.eh=0;this.aC=!1;this.eG=0;this.am=this.wf=this.Vk=this.hh=null;this.Mk=0;this.Kv=null;this.vj=this.eh=-1}e.prototype.vS=function(d,e,b){this.eh=d;this.vj=e;this.hh=this.Vk=null;this.Cp=0;this.Kv=b;null==this.am&&(this.am=a.I.Lh(384,0));this.hG()};e.prototype.aa=function(){return this.eh};
e.prototype.ba=function(){return this.vj};e.prototype.flush=function(){0<this.Mk&&(this.Kv.XB(this.am,this.Mk),this.Mk=0)};e.prototype.hG=function(){if(0<this.Cp){for(var d=0;d<this.vj;d++){for(var e=this.Vk[d];null!=e;){var a=e,e=e.next;a.next=null}this.Vk[d]=null}this.hh=null}this.ku=this.vj;this.ju=-1;this.Cp=0};e.prototype.fF=function(d){this.aC=d==e.$u;for(d=this.ku;d<=this.ju;d++)this.VJ(),this.PJ(d),this.vM();this.hG()};e.prototype.zv=function(d,e,k,c){if(e!=c){var g=1;e>c&&(g=d,d=k,k=g,g=
e,e=c,c=g,g=-1);if(!(0>c||e>=this.vj)){0>d&&0>k?k=d=-1:d>=this.eh&&k>=this.eh&&(k=d=this.eh);var m=(k-d)/(c-e);c>this.vj&&(c=this.vj,k=m*(c-e)+d);0>e&&(d=m*(0-e)+d,e=0);var n=Math.max(this.eh+1,8388607);-8388607>d?(e=(0-d)/m+e,d=0):d>n&&(e=(this.eh-d)/m+e,d=this.eh);-8388607>k?c=(0-d)/m+e:k>n&&(c=(this.eh-d)/m+e);e=a.I.truncate(e);c=a.I.truncate(c);e!=c&&(k=new b,k.x=a.I.truncate(4294967296*d),k.y=e,k.G=c,k.pM=a.I.truncate(4294967296*m),k.dir=g,null==this.Vk&&(this.Vk=a.I.Lh(this.vj,null)),k.next=
this.Vk[k.y],this.Vk[k.y]=k,k.y<this.ku&&(this.ku=k.y),k.G>this.ju&&(this.ju=k.G),this.Cp++)}}};e.prototype.VJ=function(){if(null!=this.hh){for(var d=!1,e=null,a=this.hh;null!=a;)if(a.y++,a.y==a.G){var b=a,a=a.next;null!=e?e.next=a:this.hh=a;b.next=null}else a.x+=a.pM,null!=e&&e.x>a.x&&(d=!0),e=a,a=a.next;d&&(this.hh=this.dG(this.hh))}};e.prototype.PJ=function(d){if(!(d>=this.vj)){var e=this.Vk[d];if(null!=e){this.Vk[d]=null;e=this.dG(e);this.Cp-=this.eG;d=this.hh;for(var a=!0,b=e,k=null;null!=d&&
null!=b;)d.x>b.x?(a&&(this.hh=b),a=b.next,b.next=d,null!=k&&(k.next=b),k=b,b=a):(a=d.next,d.next=b,null!=k&&(k.next=d),k=d,d=a),a=!1;null==this.hh&&(this.hh=e)}}};e.Mz=function(d,e){return 0>d?0:d>e?e:d};e.prototype.vM=function(){if(null!=this.hh)for(var d=0,g=this.hh,b=a.I.truncate(a.I.FD(g.x)),k=g.next;null!=k;k=k.next)if(d=this.aC?d^1:d+k.dir,k.x>g.x){var c=a.I.truncate(a.I.FD(k.x));0!=d&&(g=e.Mz(b,this.eh),b=e.Mz(c,this.eh),b>g&&g<this.eh&&(this.am[this.Mk++]=g,this.am[this.Mk++]=b,this.am[this.Mk++]=
k.y,this.Mk==this.am.length&&(this.Kv.XB(this.am,this.Mk),this.Mk=0)));g=k;b=c}};e.prototype.dG=function(d){for(var g=0,b=d;null!=b;b=b.next)g++;this.eG=g;if(1==g)return d;null==this.wf?this.wf=a.I.Lh(Math.max(g,16),null):this.wf.length<g&&(this.wf=a.I.Lh(Math.max(g,2*this.wf.length),null));for(var k=0,b=d;null!=b;b=b.next)this.wf[k++]=b;2==g?this.wf[0].x>this.wf[1].x&&(d=this.wf[0],this.wf[0]=this.wf[1],this.wf[1]=d):e.pP(this.wf,g,function(d,e){return d==e?0:d.x<e.x?-1:d.x>e.x?1:0});d=this.wf[0];
this.wf[0]=null;b=d;for(k=1;k<g;k++)b.next=this.wf[k],b=this.wf[k],this.wf[k]=null;b.next=null;return d};e.pP=function(d,e,a){if(e==d.length)d.sort(a);else{var g=d.slice(0,0),b=d.slice(e);e=d.slice(0,e).sort(a);d.length=0;d.push.apply(d,g.concat(e).concat(b))}};e.$u=0;e.sT=1;return e}();a.ev=k})(x||(x={}));(function(a){var b=function(){function b(){}b.prototype.Jh=function(e,d){var a=this.a.Ra(e,this.vp);this.yk==a&&(this.yk=this.$d.bb(this.yk));this.Xm==a&&(this.Xm=this.$d.bb(this.Xm));this.$d.Jc(this.Ox,
a);this.hj(e);if(d&&(a=this.a.rd(e),-1!=a&&this.a.Cb(a)==e)){d=this.a.X(e);if(d!=e){var b=this.a.rd(d);if(b==a){this.a.Dh(a,d);return}d=this.a.Ua(e);if(d!=e&&(b=this.a.rd(d),b==a)){this.a.Dh(a,d);return}}this.a.Dh(a,-1);this.a.Wi(a,-1)}};b.prototype.yA=function(){for(var e=!1,d=0,g=new a.b;;){d++;null==this.nh?(this.nh=new a.ga(0),this.Mq=new a.ga(0),this.ie=new a.ga(0)):(this.nh.clear(!1),this.Mq.clear(!1),this.ie.clear(!1));for(var b=this.Xm,k=0,c=!0;b!=this.yk;){var n=this.$d.getData(b),h=new a.b;
this.a.uc(n,h);c&&(this.a.uc(n,g),c=!1);var h=this.a.Ua(n),l=this.a.X(n);-559038737!=this.a.Ra(h,this.fg)&&(this.nh.add(h),this.a.lb(h,this.fg,-559038737),this.Mq.add(n),this.ie.add(k++));-559038737!=this.a.Ra(l,this.fg)&&(this.nh.add(l),this.a.lb(l,this.fg,-559038737),this.Mq.add(n),this.ie.add(k++));b=this.$d.bb(b)}if(2>this.nh.size)break;var q=this;this.ie.xd(0,this.ie.size,function(d,e){return q.mJ(d,e)});b=0;for(k=this.ie.size;b<k;b++)c=this.ie.get(b),c=this.nh.get(c),this.a.lb(c,this.fg,b),
h=new a.b,this.a.uc(c,h);h=this.zJ(g);b=0;for(k=this.ie.size;b<k;b++)c=this.ie.get(b),-1!=c&&(c=this.nh.get(c),this.a.lb(c,this.fg,-1));if(h)e=!0;else break}return e};b.prototype.zJ=function(e){for(var d=!1,a=!0;a;){var a=!1,b=0;-1==this.ie.get(b)&&(b=this.fl(b));for(var k=this.fl(b),c=0,n=this.ie.size;c<n&&-1!=b&&-1!=k&&b!=k;c++){var h=this.ie.get(b),k=this.ie.get(k),h=this.nh.get(h),k=this.nh.get(k),l=this.a.X(h);this.a.pt(l,e)||(l=this.a.Ua(h));var q=this.a.X(k);this.a.pt(q,e)||(q=this.a.Ua(k));
var u=this.os(l,h),f=this.os(q,k),A=u?this.a.Ua(l):this.a.X(l),p=f?this.a.Ua(q):this.a.X(q),x=!1;this.io(l)?x=!0:this.io(q)?x=!0:this.io(h)?x=!0:this.io(k)?x=!0:this.io(A)?x=!0:this.io(p)&&(x=!0);!x&&this.a.Cq(h,k)&&(x=!0,this.BA(u,f,l,h,q,k));!x&&this.a.Cq(A,p)&&(x=!0,this.BA(!u,!f,l,A,q,p));x&&(d=!0);a=a||x;b=this.fl(b);k=this.fl(b)}}if(!d)for(b=0,-1==this.ie.get(b)&&(b=this.fl(b)),k=this.fl(b),c=0,n=this.ie.size;c<n&&-1!=b&&-1!=k&&b!=k;c++)h=this.ie.get(b),k=this.ie.get(k),h=this.nh.get(h),k=this.nh.get(k),
l=this.a.X(h),this.a.pt(l,e)||(l=this.a.Ua(h)),q=this.a.X(k),this.a.pt(q,e)||(q=this.a.Ua(k)),u=this.os(l,h),f=this.os(q,k),A=u?this.a.Ua(l):this.a.X(l),p=f?this.a.Ua(q):this.a.X(q),this.qJ(u,f,h,l,A,k,q,p)&&(d=!0),b=this.fl(b),k=this.fl(b);return d};b.prototype.CJ=function(){1736==this.a.Lb(this.U)&&1==this.a.Cm(this.U)&&(new a.Of).DQ(this.Qt,this.a,this.U,this.oe);var e=!1,d=!0;this.fg=this.vp=-1;var g=this.a.F(this.U),b=new a.ga(0);b.xb(g);for(var k=this.a.Vb(this.U);-1!=k;k=this.a.bc(k))for(var c=
this.a.Cb(k),n=0,h=this.a.Ha(k);n<h;n++)b.add(c),c=this.a.X(c);var l=this.a.cd.f,q=this.a.cd.Ic;this.a.wb.kc();var u=this.a.wb.Ba[0].f;b.xd(0,g,function(d,e){var a=l[q*d],g=l[q*e],b=u[2*a],a=u[2*a+1],k=u[2*g],g=u[2*g+1],b=a<g?-1:a>g?1:b<k?-1:b>k?1:0;0==b&&(b=l[q*d+3],g=l[q*e+3],b=b<g?-1:b==g?0:1);return b});this.vp=this.a.re();this.$d=new a.$n;this.Ox=this.$d.jh(0);this.$d.$l(g);for(k=0;k<g;k++)c=b.get(k),n=this.$d.addElement(this.Ox,c),this.a.lb(c,this.vp,n);this.fg=this.a.re();this.yk=-1;for(this.sA()&&
(e=!0);d;){d=!1;g=0;b=!1;do{b=!1;this.Xm=-1;for(var h=0,k=new a.b,n=new a.b,f=this.$d.gc(this.Ox);-1!=f;)c=this.$d.getData(f),-1!=this.Xm?(this.a.uc(c,n),k.ub(n))?h++:(k.J(n),this.yk=f,0<h&&(c=this.yA())&&(b=!0,-1!=this.yk&&(c=this.$d.getData(this.yk),this.a.uc(c,k))),this.Xm=f=this.yk,h=0):(this.Xm=f,this.a.uc(this.$d.getData(f),k),h=0),-1!=f&&(f=this.$d.bb(f));this.yk=-1;0<h&&(c=this.yA())&&(b=!0);if(10<g++)throw a.g.wa();b&&this.tJ();this.sA()&&(b=!0);d=d||b&&!1;e=e||b}while(b)}this.a.bf(this.vp);
this.a.bf(this.fg);return e=a.AI.$(this.a,this.U,this.$d,this.Qt)||e};b.prototype.os=function(e,d){return this.a.X(d)==e?!1:!0};b.prototype.qJ=function(e,d,a,b,k,c,n,h){if(b==n)return this.hj(a),this.hj(c),!1;var g=this.a.Ra(a,this.fg),m=this.a.Ra(k,this.fg),l=this.a.Ra(c,this.fg),q=this.a.Ra(h,this.fg);a=[0,0,0,0,0,0,0,0];var u=[0,0,0,0];a[0]=0;u[0]=g;a[1]=0;u[1]=m;a[2]=1;u[2]=l;a[3]=1;u[3]=q;for(g=1;4>g;g++){m=u[g];l=a[g];for(q=g-1;0<=q&&u[q]>m;)u[q+1]=u[q],a[q+1]=a[q],q--;u[q+1]=m;a[q+1]=l}u=0;
0!=a[0]&&(u|=1);0!=a[1]&&(u|=2);0!=a[2]&&(u|=4);0!=a[3]&&(u|=8);if(5!=u&&10!=u)return!1;e==d?e?(this.a.Sc(h,b),this.a.Tc(b,h),this.a.Sc(k,n),this.a.Tc(n,k)):(this.a.Tc(h,b),this.a.Sc(b,h),this.a.Tc(k,n),this.a.Sc(n,k)):e?(this.a.Tc(b,c),this.a.Sc(c,b),this.a.Tc(n,k),this.a.Sc(k,n)):(this.a.Sc(b,c),this.a.Tc(c,b),this.a.Sc(n,k),this.a.Tc(k,n));return!0};b.prototype.BA=function(e,d,a,b,k,c){this.pU?this.BJ():this.AJ(e,d,a,b,k,c)};b.prototype.BJ=function(){throw a.g.ra("not implemented.");};b.prototype.AJ=
function(e,d,a,b,k,c){if(e!=d)e?(this.a.Sc(a,k),this.a.Tc(k,a),this.a.Sc(c,b),this.a.Tc(b,c),this.pm(k,a),this.Jh(k,!0),this.a.Ui(k,!0),this.hj(a),this.pm(c,b),this.Jh(c,!0),this.a.Ui(c,!1)):(this.a.Sc(k,a),this.a.Tc(a,k),this.a.Sc(b,c),this.a.Tc(c,b),this.pm(k,a),this.Jh(k,!0),this.a.Ui(k,!1),this.hj(a),this.pm(c,b),this.Jh(c,!0),this.a.Ui(c,!0)),this.hj(b);else{var g=e?a:b,m=d?k:c;e=e?b:a;d=d?c:k;k=!1;this.a.Sc(g,m);this.a.Sc(m,g);this.a.Tc(e,d);this.a.Tc(d,e);for(c=d;c!=m;)a=this.a.Ua(c),b=this.a.X(c),
this.a.Tc(c,b),this.a.Sc(c,a),k=k||c==g,c=b;k||(a=this.a.Ua(m),b=this.a.X(m),this.a.Tc(m,b),this.a.Sc(m,a));this.pm(m,g);this.Jh(m,!0);this.a.Ui(m,!1);this.hj(g);this.pm(d,e);this.Jh(d,!0);this.a.Ui(d,!1);this.hj(e)}};b.prototype.sA=function(){for(var e=!1,d=this.a.Vb(this.U);-1!=d;){for(var a=this.a.Cb(d),b=0,k=this.a.Ha(d);b<k&&1<k;){var c=this.a.Ua(a),n=this.a.X(a);this.a.Cq(c,n)?(e=!0,this.Jh(a,!1),this.a.vf(a,!0),this.Jh(n,!1),this.a.vf(n,!0),a=c,b=0,k=this.a.Ha(d)):(a=n,b++)}if(2>this.a.Ha(d)){e=
this.a.Cb(d);b=0;for(k=this.a.Ha(d);b<k;b++)this.Jh(e,!1),e=this.a.X(e);d=this.a.Cr(d);e=!0}else d=this.a.bc(d)}return e};b.prototype.io=function(e){for(var d=!1;;){var a=this.a.X(e),b=this.a.Ua(e);if(a==e)return this.Jh(e,!0),this.a.Ui(e,!1),!0;if(!this.a.Cq(a,b))break;d=!0;this.hj(b);this.hj(a);this.Jh(e,!0);this.a.Ui(e,!1);this.pm(a,b);this.Jh(a,!0);this.a.Ui(a,!0);if(a==b)break;e=b}return d};b.prototype.tJ=function(){for(var e=0,d=this.$d.gc(this.$d.Wd);-1!=d;d=this.$d.bb(d)){var a=this.$d.getData(d);
this.a.im(a,-1)}for(var b=0,k=this.a.Vb(this.U);-1!=k;)if(d=this.a.Cb(k),-1==d||-1!=this.a.rd(d))a=k,k=this.a.bc(k),this.a.yu(a);else{this.a.im(d,k);for(var c=1,a=this.a.X(d);a!=d;a=this.a.X(a))this.a.im(a,k),c++;this.a.Jr(k,!1);this.a.hm(k,c);this.a.Wi(k,this.a.Ua(d));b+=c;e++;k=this.a.bc(k)}for(d=this.$d.gc(this.$d.Wd);-1!=d;d=this.$d.bb(d))a=this.$d.getData(d),-1==this.a.rd(a)&&(k=this.a.aD(this.U,a,a,null),b+=this.a.Ha(k),e++);this.a.gm(this.U,e);this.a.Pk(this.U,b);e=0;for(b=this.a.$c;-1!=b;b=
this.a.we(b))e+=this.a.F(b);this.a.ZF(e)};b.prototype.fl=function(e){for(var d=0,a=this.ie.size-1;d<a;d++)if(e=(e+1)%this.ie.size,-1!=this.ie.get(e))return e;return-1};b.prototype.pm=function(e,d){var a=this.a.Ra(d,this.vp),b=this.a.Ra(d,this.fg);this.a.Zy(e,d);this.a.lb(d,this.vp,a);this.a.lb(d,this.fg,b)};b.prototype.hj=function(e){var d=this.a.Ra(e,this.fg);-1!=d&&(this.ie.set(d,-1),this.a.lb(e,this.fg,-1))};b.$=function(e,d,a,k,c){var g=new b;g.a=e;g.U=d;g.yx=a;g.Qt=k;g.oe=c;return g.CJ()};b.prototype.mJ=
function(e,d){var g=this.nh.get(e),b=new a.b;this.a.uc(g,b);var g=new a.b,k=this.nh.get(d);this.a.uc(k,g);if(b.ub(g))return 0;e=this.Mq.get(e);k=new a.b;this.a.uc(e,k);d=this.Mq.get(d);e=new a.b;this.a.uc(d,e);d=new a.b;d.pc(b,k);b=new a.b;b.pc(g,e);return a.b.cq(d,b)};return b}();a.mm=b})(x||(x={}));(function(a){(function(a){a[a.Local=0]="Local";a[a.Geographic=1]="Geographic";a[a.Projected=2]="Projected";a[a.Unknown=3]="Unknown"})(a.HI||(a.HI={}));(function(a){a[a.Integer32=0]="Integer32";a[a.Integer64=
1]="Integer64";a[a.FloatingPoint=2]="FloatingPoint"})(a.rI||(a.rI={}));var b=function(){function b(){this.fo="";this.mi=0;this.Sl=null}b.prototype.Qc=function(){return this.mi};b.prototype.Ko=function(){var e=.001;0!=this.mi?e=a.ls.SM(this.mi):null!=this.Sl&&(e=a.mA.TM(this.Sl));return e};b.prototype.Se=function(){if(0!=this.mi)return a.Tb.Qd(a.ls.cC(this.mi));if(null!=this.Sl)return a.mA.UM(this.Sl)};b.Am=function(e){if(0!=e.mi){if(!0===a.ls.WO(e.mi))return 1;if(!0===a.ls.ZO(e.mi))return 2}return 3};
b.create=function(e){if(0>=e)throw a.g.N("Invalid or unsupported wkid: "+e);var d=new b;d.mi=e;return d};b.NL=function(e){if(null==e||0==e.length)throw a.g.N("Cannot create SpatialReference from null or empty text.");var d=new b;d.Sl=e;return d};b.prototype.lc=function(e){return this==e?!0:null==e||this.constructor!=e.constructor||this.mi!=e.mi||0==this.mi&&this.Sl!==e.Sl?!1:!0};b.mN=function(e,d){var g=Math.PI/180,b=new a.ca;a.nH.pN(e.w().x*g,e.w().y*g,d.w().x*g,d.w().y*g,b);return b.l};b.prototype.toString=
function(){return"[ tol: "+this.xq()+"; wkid: "+this.Qc()+"; wkt: "+this.Sl+"]"};b.prototype.hc=function(){if(""!==this.fo)return this.fo;var e=this.toString();if(Array.prototype.reduce)return this.fo="S"+e.split("").reduce(function(d,e){d=(d<<5)-d+e.charCodeAt(0);return d&d},0);var d=0;if(0===e.length)return"";for(var a=0;a<e.length;a++)d=(d<<5)-d+e.charCodeAt(a),d&=d;return this.fo="S"+d};b.prototype.xq=function(){return this.Ko()};b.jU=!0;b.ET=2147483645;b.FT=9007199254740990;return b}();a.Nf=
b})(x||(x={}));(function(a){function b(d,e){89.99999<e?e=89.99999:-89.99999>e&&(e=-89.99999);e*=.017453292519943;return[111319.49079327169*d,3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e)))]}function k(d,e,a){d=d/6378137*57.29577951308232;return a?[d,57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*e/6378137)))]:[d-360*Math.floor((d+180)/360),57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*e/6378137)))]}function e(d,e){var g=d.vm();if(33===d.D()){var b=e(g.lk(),g.mk());
g.ic(b[0],b[1])}else if(197===d.D())b=e(d.R.v,d.R.C,!0),d=e(d.R.B,d.R.G,!0),g.K(b[0],b[1],d[0],d[1]);else for(b=new a.b,d=0;d<g.F();d++){g.w(d,b);var k=e(b.x,b.y,!0);b.ma(k[0],k[1]);g.ic(d,b)}return g}function d(d){return e(d,k)}function g(d){return e(d,b)}var c=function(){function d(){}d.Xr=function(d){var e=Math.PI/180,g=Math.sin(d.y*e);return a.b.Oa(6378137*d.x*e,3167719.6636462314*(g/(1-.006694379990197414*g*g)-6.111035746609262*Math.log((1-.0818191908429643*g)/(1+.0818191908429643*g))))};d.Wu=
function(d,e,g,b){var k=1/298.257223563,c=Math.sin(g);g=Math.cos(g);var n=(1-k)*Math.tan(d);d=1/Math.sqrt(1+n*n);for(var m=n*d,h=Math.atan2(n,g),n=d*c*d*c,l=1-n,q=2.7233160610754688E11*l/4.040829998466145E13,u=1+q/16384*(4096+q*(-768+q*(320-175*q))),f=q/1024*(256+q*(-128+q*(74-47*q))),q=b/(6356752.31424518*u),A=2*Math.PI,p,x,w,t;1E-12<Math.abs(q-A);)w=Math.cos(2*h+q),p=Math.sin(q),x=Math.cos(q),t=f*p*(w+f/4*(x*(-1+2*w*w)-f/6*w*(-3+4*p*p)*(-3+4*w*w))),A=q,q=b/(6356752.31424518*u)+t;b=m*p-d*x*g;l=k/
16*l*(4+k*(4-3*l));return a.b.Oa((e+(Math.atan2(p*c,d*x-m*p*g)-(1-l)*k*Math.sqrt(n)*(q+l*p*(w+l*x*(-1+2*w*w)))))/(Math.PI/180),Math.atan2(m*x+d*p*g,(1-k)*Math.sqrt(n+b*b))/(Math.PI/180))};d.cN=function(d,e,a,g){var b=1/298.257223563,k=g-e,c=Math.atan((1-b)*Math.tan(d)),n=Math.atan((1-b)*Math.tan(a)),m=Math.sin(c),c=Math.cos(c),h=Math.sin(n),n=Math.cos(n),l=k,q,u=1E3,f,A,p,x,w,t,v;do{p=Math.sin(l);x=Math.cos(l);A=Math.sqrt(n*p*n*p+(c*h-m*n*x)*(c*h-m*n*x));if(0===A)return 0;x=m*h+c*n*x;w=Math.atan2(A,
x);t=c*n*p/A;f=1-t*t;p=x-2*m*h/f;isNaN(p)&&(p=0);v=b/16*f*(4+b*(4-3*f));q=l;l=k+(1-v)*b*t*(w+v*A*(p+v*x*(-1+2*p*p)))}while(1E-12<Math.abs(l-q)&&0<--u);if(0===u)return m=g-e,{azimuth:Math.atan2(Math.sin(m)*Math.cos(a),Math.cos(d)*Math.sin(a)-Math.sin(d)*Math.cos(a)*Math.cos(m)),geodesicDistance:6371009*Math.acos(Math.sin(d)*Math.sin(a)+Math.cos(d)*Math.cos(a)*Math.cos(g-e))};d=2.7233160610754688E11*f/4.040829998466145E13;e=d/1024*(256+d*(-128+d*(74-47*d)));return{azimuth:Math.atan2(n*Math.sin(l),c*
h-m*n*Math.cos(l)),lN:6356752.31424518*(1+d/16384*(4096+d*(-768+d*(320-175*d))))*(w-e*A*(p+e/4*(x*(-1+2*p*p)-e/6*p*(-3+4*A*A)*(-3+4*p*p)))),yU:Math.atan2(c*Math.sin(l),c*h*Math.cos(l)-m*n)}};d.oT=function(d){var e=d.hasAttribute(1),g=d.hasAttribute(2),b=[],k=d.ea(),c=null,n=null;e&&(c=d.mc(1));g&&(n=d.mc(2));for(var m=new a.b,h=0;h<k;h++){for(var l=d.Ea(h),q=d.Ha(h),u=0,f=0,A=NaN,p=NaN,x=NaN,w=NaN,t=d.vc(h),v=[],C=l;C<l+q;C++){d.w(C,m);var w=x=NaN,y=[m.x,m.y];e&&(x=c.get(C),y.push(x));g&&(k=n.get(C),
y.push(w));C==l&&t&&(u=m.x,f=m.y,A=x,p=w);v.push(y)}!t||u==m.x&&f==m.y&&(!e||isNaN(A)&&isNaN(x)||A==x)&&(!g||isNaN(p)&&isNaN(w)||p==w)||v.push(v[0].slice(0));b.push(v)}return b};d.fw=function(e,a){e=d.oT(e);var g=Math.PI/180;637.100877151506>a&&(a=637.100877151506);for(var b=[],k=0;k<e.length;k++){var c=e[k],n;b.push(n=[]);n.push([c[0][0],c[0][1]]);var m,h,l,q,u,f;m=c[0][0]*g;h=c[0][1]*g;for(u=0;u<c.length-1;u++)if(l=c[u+1][0]*g,q=c[u+1][1]*g,m!==l||h!==q){q=d.cN(h,m,q,l);l=q.azimuth;q=q.lN;var A=
q/a;if(1<A){for(f=1;f<=A-1;f++){var p=d.Wu(h,m,l,f*a);n.push([p.x,p.y])}f=d.Wu(h,m,l,(q+Math.floor(A-1)*a)/2);n.push([f.x,f.y])}h=d.Wu(h,m,l,q);n.push([h.x,h.y]);m=h.x*g;h=h.y*g}}return{mF:b}};d.kN=function(e){for(var g=[],b=0;b<e.length;b++){var k=e[b],k=d.fw(k,1E4);g.push(k)}e=[];for(var c,n,m=0;m<g.length;m++){for(var k=g[m],h=0,b=0;b<k.mF.length;b++){var l=k.mF[b];c=d.Xr(a.b.Oa(l[0][0],l[0][1]));n=d.Xr(a.b.Oa(l[l.length-1][0],l[l.length-1][1]));var q=n.x*c.y-c.x*n.y,u;for(u=0;u<l.length-1;u++)c=
d.Xr(a.b.Oa(l[u+1][0],l[u+1][1])),n=d.Xr(a.b.Oa(l[u][0],l[u][1])),q+=n.x*c.y-c.x*n.y;q/=4046.87;h+=q}e.push(h/-2*4046.85642)}return e};return d}();a.oH=c;c=function(){function e(){}e.oy=function(d,a,g,b,k,c,n){e.AG[d.hc()]=a;0==isNaN(g)&&(e.CG[d.hc()]=g);0==isNaN(b)&&(e.iz[d.hc()]=b);0==isNaN(k)&&(e.lG[d.hc()]=k);e.EG[d.hc()]=c;null!==n&&(e.GG[d.hc()]=n)};e.xu=function(d,a,g){e.IG[d.hc()+"-"+a.hc()]=g};e.Em=function(d){d=e.AG[d.hc()];if(void 0==d)throw a.g.qe();return d};e.IC=function(d){d=e.CG[d.hc()];
if(void 0==d)throw a.g.qe();return d};e.ft=function(d){d=e.iz[d.hc()];if(void 0==d)throw a.g.qe();return d};e.Ts=function(d){d=e.lG[d.hc()];if(void 0==d)throw a.g.qe();return d};e.Fm=function(d){d=e.GG[d.hc()];if(void 0==d)throw a.g.qe();return a.i.Oa(d[0],d[1],d[2],d[3])};e.Qo=function(d){d=e.EG[d.hc()];if(void 0==d)throw a.g.qe();return d};e.Wl=function(d,g,b){if(g.lc(b))return d;var k=e.IG[g.hc()+"-"+b.hc()];if(void 0!==k)return k(d,g,b);throw a.g.qe();};e.tu=function(){throw a.g.qe();};e.qN=function(){throw a.g.qe();
};e.YQ=function(){throw a.g.qe();};e.TN=function(){throw a.g.qe();};e.qR=function(){var e=a.Nf.create(102100),b=a.Nf.create(3857),k=a.Nf.create(4326);a.Ya.oy(e,k,NaN,NaN,NaN,!1,null);a.Ya.oy(k,k,1,.0033528106647474805,6378137,!0,[-180,-90,180,90]);a.Ya.oy(b,k,NaN,NaN,NaN,!1,null);a.Ya.xu(e,k,d);a.Ya.xu(k,e,g);a.Ya.xu(b,k,d);a.Ya.xu(k,b,g)};e.AG=[];e.CG=[];e.iz=[];e.lG=[];e.EG=[];e.GG=[];e.IG=[];return e}();a.Ya=c})(x||(x={}));x.Ya.qR();(function(a){var b=function(){function b(e){this.f=null;this.qg=
-1;this.Xc=this.size=this.We=0;this.Ic=e}b.prototype.Jc=function(e){e<this.We?(this.f[e*this.Ic]=this.qg,this.qg=e):this.We--;this.size--};b.prototype.O=function(e,d){return this.f[e*this.Ic+d]};b.prototype.L=function(e,d,a){this.f[e*this.Ic+d]=a};b.prototype.be=function(){var e=this.qg;if(-1==e){if(this.We==this.Xc){e=0!=this.Xc?a.I.truncate(3*(this.Xc+1)/2):1;2147483647<e&&(e=2147483647);if(e==this.Xc)throw a.g.Uc();this.Gm(e)}e=this.We;this.We++}else this.qg=this.f[e*this.Ic];this.size++;for(var d=
e*this.Ic+this.Ic,g=e*this.Ic;g<d;g++)this.f[g]=-1;return e};b.prototype.Pj=function(e){var d=this.qg;if(-1==d){if(this.We==this.Xc){d=0!=this.Xc?a.I.truncate(3*(this.Xc+1)/2):1;2147483647<d&&(d=2147483647);if(d==this.Xc)throw a.g.Uc();this.Gm(d)}d=this.We;this.We++}else this.qg=this.f[d*this.Ic];this.size++;for(var g=d*this.Ic,b=this.Ic,k=0;k<b;k++)this.f[g+k]=e[k];return d};b.prototype.Nh=function(e){this.qg=-1;this.size=this.We=0;e&&(this.f=null,this.Xc=0)};b.prototype.de=function(e){e>this.Xc&&
this.Gm(e)};b.prototype.Pu=function(e,d,a){var g=this.f[this.Ic*d+a];this.f[this.Ic*d+a]=this.f[this.Ic*e+a];this.f[this.Ic*e+a]=g};b.Zk=function(){return-2};b.lm=function(){return-3};b.Zw=function(e){return 0<=e};b.prototype.Gm=function(e){null==this.f&&(this.f=[]);this.Xc=e};return b}();a.Fc=b;b=function(){function b(e){this.f=new Int32Array(0);this.qg=-1;this.Xc=this.size=this.We=0;this.Ic=e}b.prototype.Jc=function(e){e<this.We?(this.f[e*this.Ic]=this.qg,this.qg=e):this.We--;this.size--};b.prototype.O=
function(e,d){return this.f[e*this.Ic+d]};b.prototype.L=function(e,d,a){this.f[e*this.Ic+d]=a};b.prototype.be=function(){var e=this.qg;if(-1==e){if(this.We==this.Xc){e=0!=this.Xc?a.I.truncate(3*(this.Xc+1)/2):1;2147483647<e&&(e=2147483647);if(e==this.Xc)throw a.g.Uc();this.Gm(e)}e=this.We;this.We++}else this.qg=this.f[e*this.Ic];this.size++;for(var d=e*this.Ic;d<e*this.Ic+this.Ic;d++)this.f[d]=-1;return e};b.prototype.Pj=function(e){var d=this.qg;if(-1==d){if(this.We==this.Xc){d=0!=this.Xc?a.I.truncate(3*
(this.Xc+1)/2):1;2147483647<d&&(d=2147483647);if(d==this.Xc)throw a.g.Uc();this.Gm(d)}d=this.We;this.We++}else this.qg=this.f[d*this.Ic];this.size++;for(var g=d*this.Ic,b=0;b<e.length;b++)this.f[g+b]=e[b];return d};b.prototype.Nh=function(e){this.qg=-1;this.size=this.We=0;e&&(this.f=null,this.Xc=0)};b.prototype.de=function(e){e>this.Xc&&this.Gm(e)};b.prototype.Pu=function(e,d,a){var g=this.f[this.Ic*d+a];this.f[this.Ic*d+a]=this.f[this.Ic*e+a];this.f[this.Ic*e+a]=g};b.Zk=function(){return-2};b.lm=
function(){return-3};b.Zw=function(e){return 0<=e};b.prototype.Gm=function(e){null==this.f&&(this.f=new Int32Array(0));var d=new Int32Array(this.Ic*e);d.set(this.f,0);this.f=d;this.Xc=e};return b}();a.II=b;!0===a.ah.Sk&&(a.Fc=a.II)})(x||(x={}));(function(a){var b;(function(d){d[d.enumInputModeBuildGraph=0]="enumInputModeBuildGraph";d[d.enumInputModeSimplifyAlternate=4]="enumInputModeSimplifyAlternate";d[d.enumInputModeSimplifyWinding=5]="enumInputModeSimplifyWinding";d[d.enumInputModeIsSimplePolygon=
7]="enumInputModeIsSimplePolygon"})(b||(b={}));var k=function(){function d(d){this.me=d;this.Zg=NaN;this.LD=new a.Ag;this.MD=new a.Ag;this.Aq=new a.Nd;this.Bq=new a.Nd}d.prototype.compare=function(d,e,a){d=d.da(a);this.me.iy(e,this.LD);this.me.iy(d,this.MD);e=this.LD.get();d=this.MD.get();this.Aq.K(e.na,e.la);this.Bq.K(d.na,d.la);if(this.Aq.va<this.Bq.qa)return-1;if(this.Aq.qa>this.Bq.va)return 1;a=e.ja==e.ha;var g=d.ja==d.ha;if(a||g){if(a&&g)return 0;if(e.ja==d.ja&&e.na==d.na)return a?1:-1;if(e.ha==
d.ha&&e.la==d.la)return a?-1:1}a=e.xe(this.Zg,this.Aq.qa);g=d.xe(this.Zg,this.Bq.qa);a==g&&(a=Math.min(e.ha,d.ha),g=.5*(a+this.Zg),g==this.Zg&&(g=a),a=e.xe(g,this.Aq.qa),g=d.xe(g,this.Bq.qa));return a<g?-1:a>g?1:0};d.prototype.$F=function(d){this.Zg=d};return d}(),e=function(){function d(d){this.ab=d;this.uE=new a.Ag;this.nf=new a.b;this.xx=new a.Nd}d.prototype.eS=function(d){this.nf.J(d)};d.prototype.compare=function(d,e){this.ab.iy(d.da(e),this.uE);d=this.uE.get();this.xx.K(d.na,d.la);if(this.nf.x<
this.xx.qa)return-1;if(this.nf.x>this.xx.va)return 1;d=d.xe(this.nf.y,this.nf.x);return this.nf.x<d?-1:this.nf.x>d?1:0};return d}();b=function(){function d(){this.OD=this.Vh=this.Yh=this.px=this.Pm=this.je=this.xc=this.Ig=this.Td=null;this.sn=this.eg=-1;this.ND=!0;this.tx=!1;this.qx=NaN;this.ei=new a.wd;this.EK=2147483647;this.DK=a.I.truncate(-2147483648);this.Kf=this.Md=this.Ek=this.lp=this.Bl=this.kp=this.Zq=this.Be=-1;this.ta=0}d.prototype.Mv=function(d){this.qx=d};d.prototype.Ul=function(){null==
this.Td&&(this.Td=new a.Fc(8));var d=this.Td.be();this.Td.L(d,1,0);return d};d.prototype.kQ=function(){null==this.xc&&(this.xc=new a.Fc(8));var d=this.xc.be();this.xc.L(d,2,0);this.xc.L(d,3,0);var e=this.xc.be();this.xc.L(e,2,0);this.xc.L(e,3,0);this.GF(d,e);this.GF(e,d);return d};d.prototype.FE=function(){null==this.je&&(this.je=new a.Fc(8));var d=this.je.be();this.je.L(d,2,0);return d};d.prototype.QR=function(d,e){this.Td.L(d,7,e)};d.prototype.em=function(d,e){this.Td.L(d,2,e)};d.prototype.PR=function(d,
e){this.Td.L(d,1,e)};d.prototype.fS=function(d,e){this.Td.L(d,3,e)};d.prototype.cS=function(d,e){this.Td.L(d,4,e)};d.prototype.Lp=function(d,e){this.Td.L(d,5,e)};d.prototype.uN=function(d){return this.Td.O(d,5)};d.prototype.OR=function(d,e){this.Td.L(d,6,e)};d.prototype.IJ=function(d,e){this.OR(e,d)};d.prototype.FF=function(d,e){this.xc.L(d,1,e)};d.prototype.GF=function(d,e){this.xc.L(d,4,e)};d.prototype.Rk=function(d,e){this.xc.L(d,5,e)};d.prototype.Qk=function(d,e){this.xc.L(d,6,e)};d.prototype.VR=
function(d,e){this.xc.L(d,2,e)};d.prototype.Du=function(d,e){this.xc.L(d,3,e)};d.prototype.zC=function(d){return this.xc.O(d,3)};d.prototype.Ir=function(d,e){this.xc.L(d,7,e)};d.prototype.zG=function(d,e){if(-1!=this.ql(d))for(e=e?-1:d,d=this.ql(d);-1!=d;d=this.zq(d))this.a.lb(this.Gi(d),this.lp,e)};d.prototype.Tu=function(d,e){-1!=d&&(this.zG(d,e),this.zG(this.sa(d),e))};d.prototype.Gr=function(d,e){this.je.L(d,1,e)};d.prototype.yg=function(d,e){this.je.L(d,2,e)};d.prototype.cm=function(d,e){this.je.L(d,
3,e);this.LR(d,this.tN(e));this.KR(e,d)};d.prototype.KR=function(d,e){this.je.L(d,4,e)};d.prototype.LR=function(d,e){this.je.L(d,5,e)};d.prototype.AF=function(d,e){this.je.L(d,6,e)};d.prototype.yF=function(d,e){this.je.L(d,7,e)};d.prototype.xF=function(d,e){this.Pm.write(d,e)};d.prototype.zF=function(d,e){this.px.write(d,e)};d.prototype.bT=function(d){var e=0,g=0,b=this.pC(d),k=new a.b,c=new a.b,n=new a.b;this.tq(b,k);c.J(k);var h=b;do this.pl(h,n),g+=a.b.Fb(c,n),this.Pe(this.sa(h))!=d&&(e+=(n.x-
k.x-(c.x-k.x))*(n.y-k.y+(c.y-k.y))*.5),c.J(n),h=this.Wb(h);while(h!=b);this.Pm.write(d,e);this.px.write(d,g)};d.prototype.GQ=function(d){var g=new k(this),b=new a.bj;b.de(a.I.truncate(this.ta/2));b.Hn(g);for(var c=new a.ga(0),n=this.Eg(),h=null,l=0,q=new a.b,u=this.Be;-1!=u;u=this.Bf(u)){l++;var f=this.te(u);if(-1!=f){c.cf(0);if(!this.VS(b,n,c,f)){this.w(u,q);g.$F(q.y);var A=f;do{var p=this.tb(A,n);-1!=p&&(b.kd(p,-1),this.Bb(A,n,-2));A=this.Wb(this.sa(A))}while(f!=A);A=f;do p=this.tb(A,n),-1==p&&
(p=b.addElement(A,-1),c.add(p)),A=this.Wb(this.sa(A));while(f!=A)}for(f=c.size-1;0<=f;f--)p=c.get(f),A=b.da(p),this.Bb(this.sa(A),n,p),this.FQ(b,p,d)}else-1==this.mw(u)&&(null==h&&(h=new e(this)),this.w(u,q),h.eS(q),A=b.GR(h),f=this.Ek,-1!=A&&(p=b.da(A),this.Pe(p)==this.Pe(this.sa(p))&&(p=this.BC(b,A)),-1!=p&&(f=this.Pe(p))),this.IJ(f,u))}this.kh(n)};d.prototype.FQ=function(d,e,a){var g=d.da(e),b=this.Pe(g);if(-1==this.ym(b)){var k=this.BC(d,e),c=this.sa(g),n=this.Pe(c);this.yo(b);this.yo(n);var m=
this.ym(b),h=this.ym(n);-1==k&&-1==m&&(n==b?(this.cm(n,this.Ek),m=h=this.Ek):(-1==h&&(this.cm(n,this.Ek),h=this.Ek),this.cm(b,n),m=n));if(-1!=k){var l=this.Pe(k);-1==h&&(0>=this.yo(l)?(h=this.ym(l),this.cm(n,h)):(this.cm(n,l),h=l),n==b&&(m=h))}-1==m&&this.WS(b,n);0==a?this.aR(d,e,g,k,b,n):5==a?this.bR(d,e,g,c,b,n):4==a&&this.$Q(g,k,b,n)}};d.prototype.aR=function(d,e,a,b,k,c){var g=this.pj(k);if(-1!=b){var n=this.pj(c),m=this.pj(this.Pe(b));b=g&n&m;m^=m&this.Gg(a);m|=b;0!=m&&(this.yg(c,n|m),this.yg(k,
m|g),g=g||m)}for(e=d.bb(e);-1!=e;e=d.bb(e)){b=d.da(e);a=this.Pe(this.sa(b));k=this.pj(a);c=this.Gg(b);n=this.Pe(b);m=this.pj(n);b=k&m&g;g^=g&c;g|=b;if(0==g)break;this.yg(a,k|g);this.yg(n,m|g)}};d.prototype.bR=function(d,e,b,k,c,n){if(c!=n){b=this.tb(b,this.Kf);b+=this.tb(k,this.Kf);k=0;var g=new a.ga(0),m=new a.ga(0);m.add(0);for(var h=d.gc(-1);h!=e;h=d.bb(h)){var l=d.da(h),q=this.sa(l),u=this.Pe(l),f=this.Pe(q);if(u!=f){l=this.tb(l,this.Kf);l+=this.tb(q,this.Kf);k+=l;q=!1;0!=g.size&&g.tc()==f&&(m.af(),
g.af(),q=!0);if(-1==this.ym(f))throw a.g.wa();q&&this.ym(f)==u||(m.add(k),g.add(u))}}k+=b;0!=g.size&&g.tc()==n&&(m.af(),g.af());0!=k?0==m.tc()&&(d=this.a.$c,d=this.ya(d),this.yg(c,d)):0!=m.tc()&&(d=this.a.$c,d=this.ya(d),this.yg(c,d))}};d.prototype.$Q=function(d,e,a,b){var g=this.ya(this.a.$c);if(-1==e)this.yg(b,this.sn),d=this.tb(d,this.eg),0!=(d&1)?this.yg(a,g):this.yg(a,this.sn);else{var k=this.pj(b);0==k&&(k=this.pj(this.Pe(e)),this.yg(b,k));d=this.tb(d,this.eg);0!=(d&1)?this.yg(a,k==g?this.sn:
g):this.yg(a,k)}};d.prototype.VS=function(d,e,a,b){var g=b,k=-1,c=-1,n=0;do{if(2==n)return!1;var m=this.tb(g,e);if(-1!=m){if(-1!=k)return!1;k=m}else{if(-1!=c)return!1;c=g}n++;g=this.Wb(this.sa(g))}while(b!=g);if(-1==c||-1==k)return!1;this.Bb(d.da(k),e,-2);d.Vi(k,c);a.add(k);return!0};d.prototype.WS=function(d,e){var a=this.yo(d);if(0!=a){var g=this.yo(e);0<a&&0>g?this.cm(d,e):0>a&&0<g?this.cm(d,e):(a=this.ym(e),-1!=a&&this.cm(d,a))}};d.prototype.RL=function(d,e){this.lp=this.a.re();for(var g=0,b=
e.size;g<b;g++){var k=e.get(g),c=this.a.Ra(k,this.Bl),n=this.a.Vf(this.a.rd(k)),m=this.a.Lb(n);if(a.T.Kc(m)){var h=this.a.X(k);if(-1!=h){var l=this.a.Ra(h,this.Bl);if(c!=l){var q=this.kQ(),u=this.sa(q),f=this.Ig.be();this.Ig.L(f,0,k);this.Ig.L(f,1,-1);this.Ir(q,f);this.FF(q,c);f=this.te(c);-1==f?(this.em(c,q),this.Rk(q,u),this.Qk(u,q)):(c=this.fe(f),this.Rk(f,u),this.Qk(u,f),this.Qk(c,q),this.Rk(q,c));this.FF(u,l);c=this.te(l);-1==c?(this.em(l,u),this.Qk(q,u),this.Rk(u,q)):(l=this.fe(c),this.Rk(c,
q),this.Qk(q,c),this.Qk(l,u),this.Rk(u,l));n=this.ya(n);0==d?(this.Bb(u,this.Md,0),this.Bb(q,this.Md,1736==m?n:0)):5==d?(l=new a.b,this.a.w(k,l),k=new a.b,this.a.w(h,k),c=h=0,0>l.compare(k)?h=1:c=-1,this.Bb(u,this.Md,0),this.Bb(q,this.Md,0),this.Bb(q,this.Kf,h),this.Bb(u,this.Kf,c)):7==d?(this.Bb(u,this.Md,this.sn),this.Bb(q,this.Md,1736==m?n:0)):4==d&&(this.Bb(u,this.Md,0),this.Bb(q,this.Md,0),this.Bb(q,this.eg,1),this.Bb(u,this.eg,1));m=1736==m?this.DK:0;this.Du(q,n|m);this.Du(u,n|m)}}}}};d.prototype.ZP=
function(d,e){var a=this.ql(e);if(-1!=a){var g=this.ql(d);this.Ig.L(a,1,g);this.Ir(d,a);this.Ir(e,-1)}d=this.sa(d);e=this.sa(e);a=this.ql(e);-1!=a&&(g=this.ql(d),this.Ig.L(a,1,g),this.Ir(d,a),this.Ir(e,-1))};d.prototype.AS=function(d){function e(d,e){return b.lL(d,e)}var g=new a.ga(0);g.xb(10);for(var b=this,k=this.Be;-1!=k;k=this.Bf(k)){g.clear(!1);var c=this.te(k);if(-1!=c){var n=c;do g.add(n),n=this.Wb(this.sa(n));while(n!=c);if(1<g.size){n=!0;if(2<g.size)g.xd(0,g.size,e),g.add(g.get(0));else if(0<
this.kL(g.get(0),g.get(1))){var h=g.get(0);g.set(0,g.get(1));g.set(1,h)}else n=!1;for(var l=h=g.get(0),q=this.jf(l),u=this.sa(l),f=-1,A=1,p=g.size;A<p;A++){var x=g.get(A),w=this.sa(x),t=this.qj(w);if(t==q&&x!=l){if(0==d)f=this.zC(l)|this.zC(x),this.Du(l,f),this.Du(u,f),this.Bb(l,this.Md,this.tb(l,this.Md)|this.tb(x,this.Md)),this.Bb(u,this.Md,this.tb(u,this.Md)|this.tb(w,this.Md));else if(-1!=this.Kf)f=this.tb(l,this.Kf)+this.tb(x,this.Kf),w=this.tb(u,this.Kf)+this.tb(w,this.Kf),this.Bb(l,this.Kf,
f),this.Bb(u,this.Kf,w);else{if(7==d){this.ei=new a.wd(5,k,-1);return}-1!=this.eg&&(f=this.tb(l,this.eg)+this.tb(x,this.eg),w=this.tb(u,this.eg)+this.tb(w,this.eg),this.Bb(l,this.eg,f),this.Bb(u,this.eg,w))}this.ZP(l,x);this.Wv(x);f=l;g.set(A,-1);x==h&&(g.set(0,-1),h=-1)}else this.Tu(f,!1),f=-1,l=x,q=t,u=w}this.Tu(f,!1);f=-1;if(n){h=-1;A=0;for(p=g.size;A<p;A++)if(x=g.get(A),-1!=x)if(-1==h)l=h=x,q=this.jf(l),u=this.sa(l);else if(x!=l&&(w=this.sa(x),t=this.qj(w),this.Qk(u,x),this.Rk(x,u),l=x,q=t,u=
w,7==d&&(this.tb(x,this.Md)|this.tb(this.fe(x),this.Md))==(this.sn|1))){this.ei=new a.wd(5,k,-1);return}this.em(k,h)}else{h=-1;A=0;for(p=g.size;A<p;A++)if(x=g.get(A),-1!=x){h=x;break}c!=h&&this.em(k,h)}}}}};d.prototype.AK=function(){for(var d=-1,e=this.Eg(),b=this.Be;-1!=b;b=this.Bf(b)){var k=this.te(b);if(-1!=k){var c=k;do{if(1!=this.tb(c,e)){var n=this.FE();this.Gr(n,c);this.yF(n,d);-1!=d&&this.AF(d,n);var d=n,h=0,l=c;do h|=this.tb(l,this.Md),this.VR(l,n),this.Bb(l,e,1),l=this.Wb(l);while(l!=c);
this.yg(n,h)}c=this.Wb(this.sa(c))}while(c!=k)}}n=this.FE();this.Gr(n,-1);this.yF(n,d);-1!=d&&this.AF(d,n);this.Ek=n;this.Pm=a.qd.Yc(this.je.size,NaN);this.px=a.qd.Yc(this.je.size,NaN);this.xF(this.Ek,Infinity);this.zF(this.Ek,Infinity);this.kh(e)};d.prototype.EN=function(d,e,a){e=-1!=e?e:this.te(d);if(-1==e)return-1;for(d=e;;){if(1!=this.tb(e,a))return e;e=this.Wb(this.sa(e));if(e==d)return-1}};d.prototype.uR=function(){for(var d=this.Eg(),e=this.Be;-1!=e;e=this.Bf(e))for(var a=-1;;){var b=this.EN(e,
a,d);if(-1==b)break;for(var a=this.Wb(this.sa(b)),k=b;;){var c=this.Wb(k),n=this.fe(k),h=this.sa(k);if(n==h){this.bM(k);if(a==k||a==h)a=-1;if(k==b||n==b){b=c;if(k==b||n==b)break;k=c;continue}}else this.Bb(k,d,1);k=c;if(k==b)break}}};d.prototype.Ay=function(d,e,b,k){this.xg();this.ND=k;this.a=d;this.kp=this.a.RB();d=new a.ga(0);d.xb(null!=b?this.a.F(b.get(0)):this.a.pd);var g=0,c=1,n=null!=b?b.get(0):this.a.$c;for(k=1;-1!=n;){this.a.EF(n,this.kp,c);for(var c=c<<1,m=this.a.Vb(n);-1!=m;m=this.a.bc(m))for(var h=
this.a.Cb(m),l=0,q=this.a.Ha(m);l<q;l++)d.add(h),h=this.a.X(h);a.T.Km(this.a.Lb(n))||(g+=this.a.ea(n));null!=b?(n=k<b.size?b.get(k):-1,k++):n=this.a.we(n)}this.sn=c;this.ta=d.size;this.a.Mu(d,this.ta);null==this.Ig&&(this.Ig=new a.Fc(2),this.Td=new a.Fc(8),this.xc=new a.Fc(8),this.je=new a.Fc(8));this.Ig.de(this.ta);this.Td.de(this.ta+10);this.xc.de(2*this.ta+32);this.je.de(Math.max(32,g));this.Bl=this.a.re();b=new a.b;k=0;g=new a.b;b.Eh();for(c=0;c<=this.ta;c++)if(c<this.ta?(h=d.get(c),this.a.w(h,
g)):g.Eh(),!b.ub(g)){if(k<c){h=this.Ul();for(q=l=-1;k<c;k++)q=d.get(k),this.a.lb(q,this.Bl,h),n=this.Ig.be(),this.Ig.L(n,0,q),this.Ig.L(n,1,l),l=n,m=this.a.rd(q),n=this.a.Vf(m),n=this.ya(n),this.PR(h,this.md(h)|n);this.QR(h,l);this.Lp(h,this.a.gb(q));-1!=this.Zq&&this.cS(this.Zq,h);this.fS(h,this.Zq);this.Zq=h;-1==this.Be&&(this.Be=h)}k=c;b.J(g)}this.Md=this.Eg();5==e&&(this.Kf=this.Eg());4==e&&(this.eg=this.Eg());this.RL(e,d);0==this.ei.yh&&(this.AS(e),0==this.ei.yh&&(isNaN(this.qx)||this.ZK()?(this.AK(),
0==this.ei.yh&&(this.kh(this.Md),this.Md=-1,this.ND&&this.GQ(e))):this.tx=!0))};d.prototype.Wv=function(d){var e=this.Wb(d),a=this.fe(d),g=this.sa(d),b=this.Wb(g),k=this.fe(g);e!=g&&(this.Qk(k,e),this.Rk(e,k));a!=g&&(this.Qk(a,b),this.Rk(b,a));a=this.qj(d);this.te(a)==d&&(b!=d?this.em(a,b):this.em(a,-1));b=this.qj(g);this.te(b)==g&&(e!=g?this.em(b,e):this.em(b,-1));this.xc.Jc(d);this.xc.Jc(g)};d.prototype.BC=function(d,e){for(;;)if(e=d.ge(e),-1!=e){var a=d.da(e);if(this.Pe(a)!=this.Pe(this.sa(a)))return a}else return-1};
d.prototype.Mp=function(d,e,a){void 0===a&&(a=!0);this.Ay(d,0,null,a)};d.prototype.tF=function(d,e){var g=new a.ga(0);g.add(e);this.Ay(d,4,g,1736==d.Lb(e))};d.prototype.uF=function(d,e){var g=new a.ga(0);g.add(e);this.Ay(d,5,g,!0)};d.prototype.xg=function(){null!=this.a&&(-1!=this.kp&&(this.a.tR(this.kp),this.kp=-1),-1!=this.Bl&&(this.a.bf(this.Bl),this.Bl=-1),-1!=this.lp&&(this.a.bf(this.lp),this.lp=-1),-1!=this.Md&&(this.kh(this.Md),this.Md=-1),-1!=this.Kf&&(this.kh(this.Kf),this.Kf=-1),-1!=this.eg&&
(this.kh(this.eg),this.eg=-1),this.a=null,this.Td.Nh(!0),this.Ig.Nh(!0),this.Zq=this.Be=-1,null!=this.xc&&this.xc.Nh(!0),null!=this.Yh&&(this.Yh.length=0),null!=this.Vh&&(this.Vh.length=0),null!=this.OD&&(this.OD.length=0),null!=this.je&&this.je.Nh(!0),this.Ek=-1,this.Pm=null)};d.prototype.te=function(d){return this.Td.O(d,2)};d.prototype.w=function(d,e){this.a.SC(this.uN(d),e)};d.prototype.md=function(d){return this.Td.O(d,1)};d.prototype.Bf=function(d){return this.Td.O(d,4)};d.prototype.mw=function(d){return this.Td.O(d,
6)};d.prototype.ol=function(d){return this.Td.O(d,7)};d.prototype.zq=function(d){return this.Ig.O(d,1)};d.prototype.Gi=function(d){return this.Ig.O(d,0)};d.prototype.Sf=function(d,e){e=this.Vh[e];return e.size<=d?-1:e.read(d)};d.prototype.fm=function(d,e,a){e=this.Vh[e];e.size<=d&&e.resize(this.Td.size,-1);e.write(d,a)};d.prototype.uo=function(){null==this.Vh&&(this.Vh=[]);for(var d=a.ga.Yc(this.Td.Xc,-1),e=0,b=this.Vh.length;e<b;e++)if(null==this.Vh[e])return this.Vh[e]=d,e;this.Vh.push(d);return this.Vh.length-
1};d.prototype.vo=function(d){this.Vh[d]=null};d.prototype.qj=function(d){return this.xc.O(d,1)};d.prototype.jf=function(d){return this.qj(this.sa(d))};d.prototype.sa=function(d){return this.xc.O(d,4)};d.prototype.fe=function(d){return this.xc.O(d,5)};d.prototype.Wb=function(d){return this.xc.O(d,6)};d.prototype.Pe=function(d){return this.xc.O(d,2)};d.prototype.Qe=function(d){return this.pj(this.xc.O(d,2))};d.prototype.ql=function(d){return this.xc.O(d,7)};d.prototype.tq=function(d,e){this.w(this.qj(d),
e)};d.prototype.pl=function(d,e){this.w(this.jf(d),e)};d.prototype.Gg=function(d){return this.xc.O(d,3)&this.EK};d.prototype.tb=function(d,e){e=this.Yh[e];return e.size<=d?-1:e.read(d)};d.prototype.Bb=function(d,e,a){e=this.Yh[e];e.size<=d&&e.resize(this.xc.size,-1);e.write(d,a)};d.prototype.Eg=function(){null==this.Yh&&(this.Yh=[]);for(var d=a.ga.Yc(this.xc.Xc,-1),e=0,b=this.Yh.length;e<b;e++)if(null==this.Yh[e])return this.Yh[e]=d,e;this.Yh.push(d);return this.Yh.length-1};d.prototype.kh=function(d){this.Yh[d]=
null};d.prototype.bM=function(d){var e=this.Pe(d),a=this.Wb(d);a==this.sa(d)&&(a=this.Wb(a),a==d&&(a=-1));this.pC(e)==d&&this.Gr(e,a);a=this.Pm.read(e);isNaN(a)||(this.xF(e,NaN),this.zF(e,NaN));this.Tu(d,!0);this.Wv(d)};d.prototype.cM=function(d){for(var e=0,a=d.size;e<a;e++){var g=d.get(e),b=this.Pe(this.sa(g));this.Gr(this.Pe(g),-1);this.Gr(b,-1);this.Tu(g,!0);this.Wv(g)}};d.prototype.pC=function(d){return this.je.O(d,1)};d.prototype.pj=function(d){return this.je.O(d,2)};d.prototype.ym=function(d){return this.je.O(d,
3)};d.prototype.tN=function(d){return this.je.O(d,4)};d.prototype.yo=function(d){var e=this.Pm.read(d);isNaN(e)&&(this.bT(d),e=this.Pm.read(d));return e};d.prototype.ya=function(d){return this.a.yC(d,this.kp)};d.prototype.se=function(d){return this.a.Ra(d,this.Bl)};d.prototype.GN=function(d){return this.a.Ra(d,this.lp)};d.prototype.FN=function(d,e){var a=this.te(d);if(-1==a)return-1;var g=a,b=-1,k=-1;do{if(this.jf(g)==e)return g;if(-1==b){b=this.te(e);if(-1==b)break;k=b}if(this.jf(k)==d)return g=
this.sa(k);g=this.Wb(this.sa(g));k=this.Wb(this.sa(k))}while(g!=a&&k!=b);return-1};d.prototype.iy=function(d,e){e.mq();e=e.get();var g=new a.b;this.tq(d,g);e.ed(g);this.pl(d,g);e.vd(g)};d.prototype.lL=function(d,e){if(d==e)return 0;var g=new a.b;this.pl(d,g);var b=new a.b;this.pl(e,b);if(g.ub(b))return 0;e=new a.b;this.tq(d,e);d=new a.b;d.pc(g,e);g=new a.b;g.pc(b,e);return a.b.cq(d,g)};d.prototype.kL=function(d,e){if(d==e)return 0;var g=new a.b;this.pl(d,g);var b=new a.b;this.pl(e,b);if(g.ub(b))return 0;
e=new a.b;this.tq(d,e);d=new a.b;d.pc(g,e);g=new a.b;g.pc(b,e);return 0<=g.y&&0<d.y?a.b.cq(d,g):0};d.prototype.ZK=function(){for(var d=a.vi.Ty(this.qx),e=new a.b,b=new a.b,k=new a.b,c=new a.b,n=new a.b,h=this.Be;-1!=h;h=this.Bf(h)){var l=this.te(h);if(-1!=l){var q=l;this.tq(q,e);this.pl(q,b);n.pc(b,e);var u=n.Up();do{var f=q,q=this.Wb(this.sa(q));if(q!=f){this.pl(q,k);c.pc(k,e);var f=c.Up(),A=c.Ai(n);if(A*A/(f*u)*Math.min(f,u)<=d)return!1;n.J(c);u=f;b.J(k)}}while(q!=l)}}return!0};return d}();a.gs=
b})(x||(x={}));(function(a){var b=function(){function b(){this.h=null;this.TD=new a.b;this.UD=new a.b;this.Qg=null;this.Gq=!1;this.Ym=-1}b.prototype.Te=function(e){return e<this.Qg.length?this.Qg[e]:!1};b.prototype.xm=function(e,d,g,b){var k=a.T.ve(this.h.a.Lb(g));if(2==a.T.ve(this.h.a.Lb(d))&&1==k)this.WL(e,d,g,b);else throw a.g.wa();};b.prototype.Mp=function(e,d){null==this.h&&(this.h=new a.gs);this.h.Mp(e,d)};b.prototype.Np=function(e,d,g){a.aj.$(e,d,g,!0);for(d=e.$c;-1!=d;d=e.we(d))1736==e.Lb(d)&&
a.mm.$(e,d,-1,this.Gq,g);this.Mp(e,g)};b.prototype.EB=function(e,d,a,b,k){var g=this.h.a;if(1736==g.Lb(e))for(e=g.Vb(e);-1!=e;e=g.bc(e)){var c=g.Cb(e);this.h.se(c);this.h.se(g.X(c));var n=this.h.GN(c);if(-1!=n){var m=this.h.tb(n,a);if(1!=m&&2!=m)if(this.Te(this.h.Qe(n))){this.h.Bb(n,a,1);var m=g.Cf(d,-1),h=n,l=this.h.se(c),q=1;do{var u=this.tl(c,k);g.zi(m,u);-1!=b&&this.h.fm(l,b,1);this.h.Bb(h,a,1);var h=this.h.Wb(h),f;do u=1==q?g.X(c):g.Ua(c),f=-1!=u?this.h.se(u):-1;while(f==l);var A=this.h.qj(h);
if(A!=f){do u=1==q?g.Ua(c):g.X(c),f=-1!=u?this.h.se(u):-1;while(f==l);A!=f?(f=A,u=this.h.Gi(this.h.ol(f))):q=-q}l=f;c=u}while(h!=n);g.Gn(m,!0)}else this.h.Bb(n,a,2)}}};b.prototype.UB=function(){for(var e=this.h.Eg(),d=new a.ga(0),g=this.h.Be;-1!=g;g=this.h.Bf(g)){var b=this.h.te(g),k=b;if(-1!=b){do{if(1!=this.h.tb(k,e)){var c=this.h.sa(k);this.h.Bb(c,e,1);this.h.Bb(k,e,1);this.Te(this.h.Qe(k))&&this.Te(this.h.Qe(c))&&d.add(k)}k=this.h.Wb(this.h.sa(k))}while(k!=b)}}this.h.kh(e);this.h.cM(d)};b.prototype.tl=
function(e,d){return-1==d?e:this.kO(e,d)};b.prototype.kO=function(e,d){var a=this.h.a,b,k,c=this.h.ol(this.h.se(e));do{b=this.h.Gi(c);k=a.Vf(a.rd(b));if(k==d)return b;c=this.h.zq(c)}while(-1!=c);return e};b.prototype.Xp=function(e,d,g){this.UB();var b=this.h.a,k=b.jg(1736),c=this.h.Eg();this.pG(e,d,k,g,c,-1);this.h.kh(c);a.mm.$(b,k,1,this.Gq,null);return k};b.prototype.pG=function(e,d,a,b,k,c){this.EB(e,a,k,c,b);-1!=d&&this.EB(d,a,k,c,b);e=this.h.a;for(d=this.h.Be;-1!=d;d=this.h.Bf(d)){var g=this.h.te(d);
if(-1!=g){var n=g;do{var m=this.h.tb(n,k);if(1!=m&&2!=m)if(this.Te(this.h.Qe(n))){var m=e.Cf(a,-1),h=n;do{var l=this.h.ql(h);-1!=l?l=this.h.Gi(l):(l=this.h.Gi(this.h.ql(this.h.sa(h))),l=this.h.a.X(l));l=this.tl(l,b);e.zi(m,l);this.h.Bb(h,k,1);-1!=c&&(l=this.h.se(l),this.h.fm(l,c,1));h=this.h.Wb(h)}while(h!=n);e.Gn(m,!0)}else this.h.Bb(n,k,2);n=this.h.Wb(this.h.sa(n))}while(n!=g)}}};b.prototype.RS=function(e,d,g){var b=this.h.a,k=b.jg(1736),c=b.jg(1607),n=b.jg(550);this.UB();var h=-1,l=this.h.Eg(),
q=this.h.uo();this.pG(e,d,k,g,l,q);for(e=this.h.Be;-1!=e;e=this.h.Bf(e))if(d=this.h.te(e),-1!=d){var u=d;do{var f=this.h.tb(u,l),A=this.h.tb(this.h.sa(u),l),f=f|A;if(2==f)if(f=this.h.Gg(u),this.Te(f)){var p=b.Cf(c,-1),x=u,f=this.Au(e,b),f=this.tl(f,g);b.zi(p,f);this.h.fm(e,q,1);do{f=this.h.jf(x);A=this.Au(f,b);A=this.tl(A,g);b.zi(p,A);this.h.Bb(x,l,1);this.h.Bb(this.h.sa(x),l,1);this.h.fm(f,q,1);x=this.h.Wb(x);f=this.h.tb(x,l);A=this.h.tb(this.h.sa(x),l);f|=A;if(2!=f)break;f=this.h.Gg(x);if(!this.Te(f)){this.h.Bb(x,
l,1);this.h.Bb(this.h.sa(x),l,1);break}}while(x!=u)}else this.h.Bb(u,l,1),this.h.Bb(this.h.sa(u),l,1);u=this.h.Wb(this.h.sa(u))}while(u!=d)}for(e=this.h.Be;-1!=e;e=this.h.Bf(e))f=this.h.Sf(e,q),1!=f&&(f=this.h.md(e),this.Te(f)&&(-1==h&&(h=b.Cf(n,-1)),d=this.h.ol(e),-1!=d&&(d=this.h.Gi(d),f=this.tl(d,g),b.zi(h,f))));this.h.vo(q);this.h.kh(l);a.mm.$(b,k,1,this.Gq,null);g=[];g[0]=n;g[1]=c;g[2]=k;return g};b.prototype.Au=function(e,d){var a=-1;for(e=this.h.ol(e);-1!=e;e=this.h.zq(e)){var b=this.h.Gi(e);
-1==a&&(a=b);var k=this.h.ya(d.Vf(d.rd(b)));if(this.Te(k)){a=b;break}}return a};b.prototype.fy=function(e,d){for(var g=this.h.qj(d),b=this.h.jf(d),k=0,c=0,n=this.h.ol(g);-1!=n;n=this.h.zq(n)){var h=this.h.Gi(n),l=e.rd(h),q=this.h.ya(e.Vf(l)),u=e.X(h),f=e.Ua(h),l=e.Cb(l);l==h&&(this.Ym=d);-1!=u&&this.h.se(u)==b?(k++,this.Te(q)&&(l==u&&(this.Ym=this.h.Wb(d)),c++)):-1!=f&&this.h.se(f)==b&&(k--,this.Te(q)&&(l==f&&(this.Ym=this.h.Wb(d)),c--))}this.h.w(g,this.TD);this.h.w(b,this.UD);g=a.b.Fb(this.TD,this.UD);
return(0!=c?c:k)*g};b.prototype.Ao=function(e){return this.h.Gg(e)|this.h.Qe(e)|this.h.Qe(this.h.sa(e))};b.prototype.sG=function(e){for(var d=this.h.sa(this.h.fe(e)),a=-1;d!=e;){if(this.Te(this.Ao(d))){if(-1!=a)return-1;a=d}d=this.h.sa(this.h.fe(d))}return-1!=a?this.h.sa(a):-1};b.prototype.tG=function(e){for(var d=this.h.sa(this.h.Wb(e)),a=-1;d!=e;){if(this.Te(this.Ao(d))){if(-1!=a)return-1;a=d}d=this.h.sa(this.h.Wb(d))}return-1!=a?this.h.sa(a):-1};b.prototype.jF=function(e,d,g,b,k){var c=this.h.a,
n=e,m=this.h.sa(n);this.h.Bb(n,g,1);this.h.Bb(m,g,1);var h=this.fy(c,n);this.Ym=-1;for(var l=n,q=-1,u=!1,f=1;;){var A=this.h.fe(n);if(A==m)break;m=this.h.Wb(m);if(this.h.sa(A)!=m)if(n=this.sG(n),-1==n)break;else u=!0,m=this.h.sa(n);else n=A;if(n==e){q=e;break}A=this.Ao(n);if(!this.Te(A))break;this.h.Bb(n,g,1);this.h.Bb(m,g,1);l=n;h+=this.fy(c,n);f++}if(-1==q)for(n=e,m=this.h.sa(n),q=n;;){e=this.h.Wb(n);if(e==m)break;m=this.h.fe(m);if(this.h.sa(e)!=m)if(n=this.tG(n),-1==n){u=!0;break}else m=this.h.sa(n);
else n=e;A=this.Ao(n);if(!this.Te(A))break;this.h.Bb(n,g,1);this.h.Bb(m,g,1);q=n;h+=this.fy(c,n);f++}else if(-1!=this.Ym&&(l=this.Ym,q=this.h.fe(this.Ym),this.h.sa(q)!=this.h.Wb(this.h.sa(l))&&(q=this.sG(l),-1==q)))throw a.g.wa();0<=h||(n=q,q=this.h.sa(l),l=this.h.sa(n));g=c.Cf(d,-1);n=l;l=this.h.qj(l);u=this.h.jf(q)==l&&u;h=this.Au(l,c);h=this.tl(h,k);c.zi(g,h);-1!=b&&this.h.fm(l,b,1);l=0;for(f=u?a.I.truncate((f+1)/2):-1;;){e=this.h.jf(n);h=this.Au(e,c);h=this.tl(h,k);c.zi(g,h);l++;-1!=b&&this.h.fm(e,
b,1);u&&l==f&&(g=c.Cf(d,-1),c.zi(g,h));if(n==q)break;e=this.h.Wb(n);if(this.h.fe(this.h.sa(n))!=this.h.sa(e)){if(n=this.tG(n),-1==n)throw a.g.wa();}else n=e}};b.prototype.Yp=function(e){for(var d=this.h.a.jg(1607),a=this.h.Eg(),b=this.h.Be;-1!=b;b=this.h.Bf(b)){var k=this.h.te(b),c=k;do 1!=this.h.tb(c,a)&&this.Te(this.Ao(c))&&this.jF(c,d,a,-1,e),c=this.h.Wb(this.h.sa(c));while(c!=k)}this.h.kh(a);return d};b.prototype.SS=function(e){for(var d=this.h.a,a=d.jg(1607),b=d.jg(550),k=this.h.Eg(),c=this.h.uo(),
n=-1,h=this.h.Be;-1!=h;h=this.h.Bf(h)){var l=this.h.te(h),q=l;do{var u=this.h.tb(q,k);1!=u&&(u=this.Ao(q),this.Te(u)&&this.jF(q,a,k,c,e));q=this.h.Wb(this.h.sa(q))}while(q!=l)}for(h=this.h.Be;-1!=h;h=this.h.Bf(h))u=this.h.Sf(h,c),1!=u&&(u=this.h.md(h),this.Te(u)&&(-1==n&&(n=d.Cf(b,-1)),l=this.h.ol(h),-1!=l&&(l=this.h.Gi(l),l=this.tl(l,e),d.zi(n,l))));this.h.kh(k);this.h.vo(c);e=[];e[0]=b;e[1]=a;return e};b.prototype.Pn=function(){for(var e=this.h.a,d=e.jg(550),a=e.Cf(d,-1),b=this.h.Be;-1!=b;b=this.h.Bf(b))if(this.Te(this.h.md(b))){for(var k=
-1,c=this.h.ol(b);-1!=c;c=this.h.zq(c)){var n=this.h.Gi(c);-1==k&&(k=n);var h=this.h.ya(e.Vf(e.rd(n)));if(this.Te(h)){k=n;break}}e.zi(a,k)}return d};b.prototype.Im=function(e){this.Qg=[];for(var d=0;d<e;d++)this.Qg[d]=!1};b.qF=function(e,d,g,b){var k=e.Pa(),c=Array(1E3);a.I.Ps(c,null);var n=a.I.Lh(1E3,0),h=e.F(),m=!0,l=2==d.fb();if(1!=d.fb()&&2!=d.fb())throw a.g.wa();for(var q=0;q<h;){var u=a.I.truncate(e.fR(c,q)-q);l?a.gd.nG(d,c,u,g,n):a.gd.oG(d,c,u,g,n);for(var f=0,A=0;A<u;A++){var p=0==n[A];b||
(p=!p);p&&(m&&(m=!1,k.Pd(e,0,q)),f!=A&&k.Pd(e,q+f,q+A),f=A+1)}m||f==u||k.Pd(e,q+f,q+u);q+=u}return m?e:k};b.jD=function(e,d,g){return e instanceof a.pe?b.qF(e,d,g,!0):d instanceof a.Va?e.s()||d.s()?e.Pa():a.aj.HE(g,e,d)?a.aj.gL(e,d):e.Pa():b.mG(e,d,g,!0)};b.mt=function(e,d,g,k){var c=new a.i;e.o(c);var n=new a.i;d.o(n);var h=new a.i;h.K(c);h.Db(n);g=a.Ia.zd(g,h,!0);h=new a.i;h.K(n);n=a.Ia.As(g);h.P(n,n);if(!c.jc(h)){if(e.fb()<=d.fb())return b.Cc(b.ob(e.Pa()),e,"\x26");if(e.fb()>d.fb())return b.Cc(b.ob(d.Pa()),
e,"\x26")}n=new b;c=new a.fd;h=c.Eb(b.ob(e));d=c.Eb(b.ob(d));n.Np(c,g,k);k=n.mt(h,d);e=b.Cc(c.hf(k),e,"\x26");a.T.Kc(e.D())&&(e.hg(2,g),1736==e.D()&&e.hl());return e};b.mG=function(e,d,g,b){if(e.s())return e.Pa();if(d.s())return b?e.Pa():null;var k=[null],c=[0],n=2==d.fb();if(1!=d.fb()&&2!=d.fb())throw a.g.wa();k[0]=e.w();n?a.gd.nG(d,k,1,g,c):a.gd.oG(d,k,1,g,c);d=0==c[0];b||(d=!d);return d?e.Pa():e};b.PT=function(e,d,g){return e instanceof a.pe?b.qF(e,d,g,!1):d instanceof a.Va?e.s()?e.Pa():d.s()?
e:a.aj.HE(g,e,d)?e.Pa():e:b.mG(e,d,g,!1)};b.prototype.ME=function(e,d,g,b,k){if(e.s())return e;var c=new a.fd;e=c.Eb(e);return this.Qj(c,e,d,g,b,k)};b.prototype.EQ=function(e,d,g,b,k,c){if(k&&550!=e.Lb(d)){var n=new a.aA;n.KS(e,g);n.og?(a.aj.$(e,g,c,!0),k=!1):this.h.Mv(g)}else a.aj.$(e,g,c,!0),k=!1;b&&550!=e.Lb(d)?this.h.uF(e,d):this.h.tF(e,d);if(this.h.tx)return this.h.xg(),this.h=null,this.Qj(e,d,g,b,!1,c);this.h.Mv(NaN);c=this.h.ya(d);this.Im(c+1);this.Qg[c]=!0;if(1736==e.Lb(d)||b&&550!=e.Lb(d))return e.Pp(d,
0),d=this.Xp(d,-1,-1),e=e.hf(d),e.Pp(0),k?e.hg(1,0):(e.hg(2,g),e.hl()),e;if(1607==e.Lb(d))return d=this.Yp(-1),e=e.hf(d),k||e.hg(2,g),e;if(550==e.Lb(d))return d=this.Pn(),e=e.hf(d),k||e.hg(2,g),e;throw a.g.wa();};b.prototype.Qj=function(e,d,g,b,k,c){this.h=new a.gs;try{return this.EQ(e,d,g,b,k,c)}finally{this.h.xg()}};b.Qj=function(e,d,a,k,c){return(new b).ME(e,d,a,k,c)};b.prototype.DQ=function(e,d,g){this.Gq=e;this.h=new a.gs;e=d.Cm(g);var b=d.Lb(g);1!=e||550==b?this.h.tF(d,g):this.h.uF(d,g);if(!this.h.tx)if(this.h.Mv(NaN),
b=this.h.ya(g),this.Im(b+1),this.Qg[b]=!0,1736==d.Lb(g)||1==e&&550!=d.Lb(g))d.Pp(g,0),e=this.Xp(g,-1,-1),d.Vy(e,g),d.sy(e);else if(1607==d.Lb(g))e=this.Yp(-1),d.Vy(e,g),d.sy(e);else if(550==d.Lb(g))e=this.Pn(),d.Vy(e,g),d.sy(e);else throw a.g.ra("internal error");};b.Ry=function(e,d,a,k){var g=new b;g.Gq=!0;return g.ME(e,d,!1,a,k)};b.prototype.ll=function(e,d){var g=a.T.ve(this.h.a.Lb(e)),b=a.T.ve(this.h.a.Lb(d));if(g>b)return e;var k=this.h.ya(e),c=this.h.ya(d);this.Im((k|c)+1);this.Qg[this.h.ya(e)]=
!0;if(2==g&&2==b)return this.Xp(e,d,-1);if(1==g&&2==b||1==g&&1==b)return this.Yp(-1);if(0==g)return this.Pn();throw a.g.wa();};b.prototype.TB=function(e,d){var g=a.T.ve(this.h.a.Lb(e)),b=a.T.ve(this.h.a.Lb(d));if(g>b)return e;if(g<b)return d;var k=this.h.ya(e),c=this.h.ya(d);this.Im((k|c)+1);this.Qg[this.h.ya(e)]=!0;this.Qg[this.h.ya(d)]=!0;this.Qg[this.h.ya(e)|this.h.ya(d)]=!0;if(2==g&&2==b)return this.Xp(e,d,-1);if(1==g&&1==b)return this.Yp(-1);if(0==g&&0==b)return this.Pn();throw a.g.wa();};b.prototype.mt=
function(e,d){var g=a.T.ve(this.h.a.Lb(e)),b=a.T.ve(this.h.a.Lb(d)),k=this.h.ya(e),c=this.h.ya(d);this.Im((k|c)+1);this.Qg[this.h.ya(e)|this.h.ya(d)]=!0;k=-1;1<this.h.a.wp.Aa&&(k=e);if(2==g&&2==b)return this.Xp(e,d,k);if(1==g&&0<b||1==b&&0<g)return this.Yp(k);if(0==g||0==b)return this.Pn();throw a.g.wa();};b.prototype.Uw=function(e,d){var g=a.T.ve(this.h.a.Lb(e)),b=a.T.ve(this.h.a.Lb(d)),k=this.h.ya(e),c=this.h.ya(d);this.Im((k|c)+1);this.Qg[this.h.ya(e)|this.h.ya(d)]=!0;k=-1;1<this.h.a.wp.Aa&&(k=
e);if(2==g&&2==b)return this.RS(e,d,k);if(1==g&&0<b||1==b&&0<g)return this.SS(k);if(0==g||0==b)return g=[],g[0]=this.Pn(),g;throw a.g.wa();};b.prototype.On=function(e,d){var g=a.T.ve(this.h.a.Lb(e)),b=a.T.ve(this.h.a.Lb(d)),k=this.h.ya(e),c=this.h.ya(d);this.Im((k|c)+1);this.Qg[this.h.ya(e)]=!0;this.Qg[this.h.ya(d)]=!0;if(2==g&&2==b)return this.Xp(e,d,-1);if(1==g&&1==b)return this.Yp(-1);if(0==g&&0==b)return this.Pn();throw a.g.wa();};b.ob=function(e){var d=e.D();return 197==d?(d=new a.Ka(e.description),
e.s()||d.Wc(e,!1),d):33==d?(d=new a.pe(e.description),e.s()||d.add(e),d):322==d?(d=new a.Xa(e.description),e.s()||d.Bc(e,!0),d):e};b.Cc=function(e,d,g){var b=e.D();return 197==b?(d=new a.Ka(e.description),e.s()||d.Wc(e,!1),d):33!=b||"|"!=g&&"^"!=g?322==b?(d=new a.Xa(e.description),e.s()||d.Bc(e,!0),d):33==b&&"-"==g&&33==d.D()||550==b&&"\x26"==g&&33==d.D()?(d=new a.Va(e.description),e.s()||e.Sd(0,d),d):e:(d=new a.pe(e.description),e.s()||d.add(e),d)};b.ll=function(e,d,g,k){if(e.s()||d.s()||e.fb()>
d.fb())return b.Cc(b.ob(e),e,"-");var c=new a.i;e.o(c);var n=new a.i;d.o(n);if(!c.jc(n))return b.Cc(b.ob(e),e,"-");var h=new a.i;h.K(c);h.Db(n);g=a.Ia.zd(g,h,!0);n=new b;c=new a.fd;h=c.Eb(b.ob(e));d=c.Eb(b.ob(d));n.Np(c,g,k);k=n.ll(h,d);k=c.hf(k);e=b.Cc(k,e,"-");a.T.Kc(e.D())&&(e.hg(2,g),1736==e.D()&&e.hl());return e};b.TB=function(e,d,g,k){if(e.fb()>d.fb())return b.Cc(b.ob(e),e,"|");if(e.fb()<d.fb()||e.s())return b.Cc(b.ob(d),e,"|");if(d.s())return b.Cc(b.ob(e),e,"|");var c=new a.i;e.o(c);var n=
new a.i;d.o(n);var h=new a.i;h.K(c);h.Db(n);g=a.Ia.zd(g,h,!0);if(!c.jc(n.IN(g,g)))switch(e=b.ob(e),d=b.ob(d),e.D()){case 550:return e=a.T.Yj(e),e.Pd(d,0,-1),e;case 1607:return e=a.T.Yj(e),e.add(d,!1),e;case 1736:return e=a.T.Yj(e),e.add(d,!1),e;default:throw a.g.wa();}n=new b;c=new a.fd;h=c.Eb(b.ob(e));d=c.Eb(b.ob(d));n.Np(c,g,k);d=n.TB(h,d);e=b.Cc(c.hf(d),e,"|");a.T.Kc(e.D())&&(e.hg(2,g),1736==e.D()&&e.hl());return e};b.oM=function(e,d,g){if(2>e.length)throw a.g.N("not enough geometries to dissolve");
for(var k=0,c=0,n=e.length;c<n;c++)k=Math.max(e[c].fb(),k);var h=new a.i;h.Ja();for(var l=new a.fd,q=-1,u=0,f=-1,c=0,n=e.length;c<n;c++)if(e[c].fb()==k)if(e[c].s())-1==f&&(f=c);else{f=c;-1==q?q=l.Eb(b.ob(e[c])):l.YJ(q,b.ob(e[c]));var A=new a.i;e[c].dd(A);h.Db(A);u++}if(2>u)return b.ob(e[f]);e=2==k;d=a.Ia.zd(0==k?d:null,h,!0);return(new b).Qj(l,q,d,e,!0,g)};b.Uw=function(e,d,g,k){var c=[null,null,null],n=new a.i;e.o(n);var h=new a.i;d.o(h);var m=new a.i;m.K(n);m.Db(h);g=a.Ia.zd(g,m,!0);m=new a.i;m.K(h);
h=a.Ia.As(g);m.P(h,h);if(!n.jc(m)){if(e.fb()<=d.fb())return e=b.Cc(b.ob(e.Pa()),e,"\x26"),c[e.fb()]=e,c;if(e.fb()>d.fb())return e=b.Cc(b.ob(d.Pa()),e,"\x26"),c[e.fb()]=e,c}h=new b;n=new a.fd;m=n.Eb(b.ob(e));d=n.Eb(b.ob(d));h.Np(n,g,k);k=h.Uw(m,d);for(d=0;d<k.length;d++)h=b.Cc(n.hf(k[d]),e,"\x26"),a.T.Kc(h.D())&&(h.hg(2,g),1736==h.D()&&h.hl()),c[h.fb()]=h;return c};b.On=function(e,d,g,k){if(e.fb()>d.fb())return b.Cc(b.ob(e),e,"^");if(e.fb()<d.fb()||e.s())return b.Cc(b.ob(d),e,"^");if(d.s())return b.Cc(b.ob(e),
e,"^");var c=new a.i;e.o(c);var n=new a.i;d.o(n);var h=new a.i;h.K(c);h.Db(n);g=a.Ia.zd(g,h,!0);n=new b;c=new a.fd;h=c.Eb(b.ob(e));d=c.Eb(b.ob(d));n.Np(c,g,k);k=n.On(h,d);e=b.Cc(c.hf(k),e,"^");a.T.Kc(e.D())&&(e.hg(2,g),1736==e.D()&&e.hl());return e};b.uT=function(e,d,g){d=d.D();g=g.D();return 550==e.D()&&(33==d||33==g)&&1>=e.F()?(g=new a.Va(e.description),e.s()||e.Sd(0,g),g):e};b.prototype.ZM=function(e,d){var a=this.h.a;e=a.Cf(e,-1);for(var b=d.size,k=0;k<b;k++){var c=d.get(k);a.zi(e,c)}a.Gn(e,!0)};
b.prototype.WR=function(e,d){for(var a=this.h.a,b=a.$c;-1!=b;b=a.we(b))if(b==d)for(var k=a.Vb(b);-1!=k;k=a.bc(k)){var c=a.Cb(k);if(-1!=c)for(var n=a.X(c);-1!=n;){var c=this.h.se(c),h=this.h.se(n),c=this.h.FN(c,h);-1!=c&&(h=this.h.sa(c),this.h.Bb(c,e,1),this.h.Bb(h,e,2));c=n;n=a.X(c)}}};b.prototype.XQ=function(e,d,g,b){g=this.h.ya(g);b=this.h.ya(b);var k=new a.ga(0);k.xb(256);for(var c=this.h.a,n=this.h.Eg(),h=this.h.Be;-1!=h;h=this.h.Bf(h)){var m=this.h.te(h);if(-1!=m){var l=m;do{if(1!=this.h.tb(l,
n)){var q=l,u=l,f=!1,A=0;do{this.h.Bb(q,n,1);if(!f){var p=this.h.Gg(q);0!=(p&b)&&0!=(this.h.Qe(q)&g)&&(u=q,f=!0)}f&&(k.add(this.h.Gi(this.h.ol(this.h.qj(q)))),-1!=e&&(p=this.h.Gg(q),0!=(p&b)&&(p=this.h.tb(q,e),A|=p)));q=this.h.Wb(q)}while(q!=u);f&&0<this.h.yo(this.h.Pe(u))&&(q=c.jg(1736),this.ZM(q,k),-1!=d&&c.EF(q,d,A));k.clear(!1)}l=this.h.Wb(this.h.sa(l))}while(l!=m)}}this.h.kh(n)};b.prototype.WL=function(e,d,a,b){this.h.uR();var g=-1;-1!=e&&(g=this.h.Eg(),this.WR(g,a));this.XQ(g,e,d,a);var k=this.h.a;
e=0;for(g=k.$c;-1!=g;g=k.we(g))g!=d&&g!=a&&(b.add(g),e++);b.xd(0,e,function(d,e){d=k.Gw(k.Vb(d));e=k.Gw(k.Vb(e));return d<e?-1:d==e?0:1})};b.prototype.xg=function(){null!=this.h&&(this.h.xg(),this.h=null)};return b}();a.Of=b})(x||(x={}));(function(a){var b=function(){function b(e){void 0!==e?this.Ly(e):this.IF()}b.prototype.Lu=function(){this.Ob=this.Nb=this.sb=this.rb=this.eb=this.mb=0};b.prototype.lc=function(e){return this==e?!0:e instanceof b?this.mb==e.mb&&this.rb==e.rb&&this.Nb==e.Nb&&this.sb==
e.sb&&this.eb==e.eb&&this.Ob==e.Ob:!1};b.prototype.hc=function(){a.I.Rh();a.I.Rh();a.I.Rh();a.I.Rh();a.I.Rh();return a.I.Rh()};b.prototype.Zi=function(e,d){var a=this.sb*e.x+this.eb*e.y+this.Ob;d.x=this.mb*e.x+this.rb*e.y+this.Nb;d.y=a};b.prototype.multiply=function(e){b.multiply(this,e,this)};b.multiply=function(e,d,a){var g,b,k,c,n;g=e.mb*d.mb+e.sb*d.rb;b=e.rb*d.mb+e.eb*d.rb;k=e.Nb*d.mb+e.Ob*d.rb+d.Nb;c=e.mb*d.sb+e.sb*d.eb;n=e.rb*d.sb+e.eb*d.eb;e=e.Nb*d.sb+e.Ob*d.eb+d.Ob;a.mb=g;a.rb=b;a.Nb=k;a.sb=
c;a.eb=n;a.Ob=e};b.prototype.vm=function(){var e=new b;e.mb=this.mb;e.rb=this.rb;e.Nb=this.Nb;e.sb=this.sb;e.eb=this.eb;e.Ob=this.Ob;return e};b.prototype.$y=function(e){if(!e.s()){for(var d=[],g=0;4>g;g++)d[g]=new a.b;e.hy(d);this.US(d,d);e.Ey(d,4)}};b.prototype.US=function(e,d){for(var g=0;g<e.length;g++){var b=new a.b,k=e[g];b.x=this.mb*k.x+this.rb*k.y+this.Nb;b.y=this.sb*k.x+this.eb*k.y+this.Ob;d[g]=b}};b.prototype.wO=function(e,d){e.s()||d.s()||0==e.aa()||0==e.ba()?this.Lu():(this.rb=this.sb=
0,this.mb=d.aa()/e.aa(),this.eb=d.ba()/e.ba(),this.Nb=d.v-e.v*this.mb,this.Ob=d.C-e.C*this.eb)};b.prototype.TS=function(e){var d=new a.b,g=new a.b;d.ma(this.mb,this.sb);g.ma(this.rb,this.eb);d.sub(d);var b=.5*d.Up();d.ma(this.mb,this.sb);g.ma(this.rb,this.eb);d.add(g);d=.5*d.Up();return e*(b>d?Math.sqrt(b):Math.sqrt(d))};b.prototype.IF=function(){this.mb=1;this.sb=this.Nb=this.rb=0;this.eb=1;this.Ob=0};b.prototype.XO=function(){return 1==this.mb&&1==this.eb&&0==this.rb&&0==this.Nb&&0==this.sb&&0==
this.Ob};b.prototype.mg=function(e){return Math.abs(this.mb*this.eb-this.sb*this.rb)<=2*e*(Math.abs(this.mb*this.eb)+Math.abs(this.sb*this.rb))};b.prototype.Nn=function(e,d){this.mb=1;this.rb=0;this.Nb=e;this.sb=0;this.eb=1;this.Ob=d};b.prototype.Ly=function(e,d){void 0!==d?(this.mb=e,this.sb=this.Nb=this.rb=0,this.eb=d,this.Ob=0):this.Ly(e,e)};b.prototype.Oy=function(){this.mb=0;this.rb=1;this.Nb=0;this.sb=1;this.Ob=this.eb=0};b.prototype.jS=function(e){this.kS(Math.cos(e),Math.sin(e))};b.prototype.kS=
function(e,d){this.mb=e;this.rb=-d;this.Nb=0;this.sb=d;this.eb=e;this.Ob=0};b.prototype.shift=function(e,d){this.Nb+=e;this.Ob+=d};b.prototype.scale=function(e,d){this.mb*=e;this.rb*=e;this.Nb*=e;this.sb*=d;this.eb*=d;this.Ob*=d};b.prototype.rotate=function(e){var d=new b;d.jS(e);this.multiply(d)};b.prototype.inverse=function(e){if(void 0!==e){var d=this.mb*this.eb-this.rb*this.sb;0==d?e.Lu():(d=1/d,e.Nb=(this.rb*this.Ob-this.Nb*this.eb)*d,e.Ob=(this.Nb*this.sb-this.mb*this.Ob)*d,e.mb=this.eb*d,e.rb=
-this.rb*d,e.sb=-this.sb*d,e.eb=this.mb*d)}else this.inverse(this)};return b}();a.Bg=b})(x||(x={}));(function(a){var b=function(){function b(){}b.prototype.Lu=function(){this.fh=this.Ob=this.Nb=this.Le=this.Ie=this.He=this.Ke=this.eb=this.rb=this.ef=this.sb=this.mb=0};b.prototype.Ly=function(e,d,a){this.mb=e;this.rb=this.ef=this.sb=0;this.eb=d;this.Ie=this.He=this.Ke=0;this.Le=a;this.fh=this.Ob=this.Nb=0};b.prototype.$y=function(e){if(e.s())return e;for(var d=new a.ee[8],b=0;8>b;b++)d[b]=new a.ee;
e.hy(d);this.transform(d,8,d);e.Ey(d);return e};b.prototype.transform=function(e,d,b){for(var g=0;g<d;g++){var k=new a.ee,c=e[g];k.x=this.mb*c.x+this.rb*c.y+this.He*c.z+this.Nb;k.y=this.sb*c.x+this.eb*c.y+this.Ie*c.z+this.Ob;k.z=this.ef*c.x+this.Ke*c.y+this.Le*c.z+this.fh;b[g]=k}};b.prototype.Qn=function(e){var d=new a.ee;d.x=this.mb*e.x+this.rb*e.y+this.He*e.z+this.Nb;d.y=this.sb*e.x+this.eb*e.y+this.Ie*e.z+this.Ob;d.z=this.ef*e.x+this.Ke*e.y+this.Le*e.z+this.fh;return d};b.prototype.Ap=function(e){b.multiply(this,
e,this)};b.multiply=function(e,d,a){var b,g,k,c,n,h,l,q,u,f,A;b=e.mb*d.mb+e.sb*d.rb+e.ef*d.He;g=e.mb*d.sb+e.sb*d.eb+e.ef*d.Ie;k=e.mb*d.ef+e.sb*d.Ke+e.ef*d.Le;c=e.rb*d.mb+e.eb*d.rb+e.Ke*d.He;n=e.rb*d.sb+e.eb*d.eb+e.Ke*d.Ie;h=e.rb*d.ef+e.eb*d.Ke+e.Ke*d.Le;l=e.He*d.mb+e.Ie*d.rb+e.Le*d.He;q=e.He*d.sb+e.Ie*d.eb+e.Le*d.Ie;u=e.He*d.ef+e.Ie*d.Ke+e.Le*d.Le;f=e.Nb*d.mb+e.Ob*d.rb+e.fh*d.He+d.Nb;A=e.Nb*d.sb+e.Ob*d.eb+e.fh*d.Ie+d.Ob;e=e.Nb*d.ef+e.Ob*d.Ke+e.fh*d.Le+d.fh;a.mb=b;a.sb=g;a.ef=k;a.rb=c;a.eb=n;a.Ke=
h;a.He=l;a.Ie=q;a.Le=u;a.Nb=f;a.Ob=A;a.fh=e};b.inverse=function(e,d){var b=e.mb*(e.eb*e.Le-e.Ke*e.Ie)-e.sb*(e.rb*e.Le-e.Ke*e.He)+e.ef*(e.rb*e.Ie-e.eb*e.He);if(0!=b){var k,c,n,h,l,q,u,f,A,p;f=1/b;b=(e.eb*e.Le-e.Ke*e.Ie)*f;n=-(e.rb*e.Le-e.Ke*e.He)*f;q=(e.rb*e.Ie-e.eb*e.He)*f;k=-(e.sb*e.Le-e.Ie*e.ef)*f;h=(e.mb*e.Le-e.ef*e.He)*f;u=-(e.mb*e.Ie-e.sb*e.He)*f;c=(e.sb*e.Ke-e.ef*e.eb)*f;l=-(e.mb*e.Ke-e.ef*e.rb)*f;f*=e.mb*e.eb-e.sb*e.rb;A=-(e.Nb*b+e.Ob*n+e.fh*q);p=-(e.Nb*k+e.Ob*h+e.fh*u);e=-(e.Nb*c+e.Ob*l+e.fh*
f);d.mb=b;d.sb=k;d.ef=c;d.rb=n;d.eb=h;d.Ke=l;d.He=q;d.Ie=u;d.Le=f;d.Nb=A;d.Ob=p;d.fh=e}else throw a.g.ra("math singularity");};b.prototype.vm=function(){var e=new b;e.mb=this.mb;e.sb=this.sb;e.ef=this.ef;e.rb=this.rb;e.eb=this.eb;e.Ke=this.Ke;e.He=this.He;e.Ie=this.Ie;e.Le=this.Le;e.Nb=this.Nb;e.Ob=this.Ob;e.fh=this.fh;return e};return b}();a.ZT=b})(x||(x={}));(function(a){var b=function(e){function d(d){if(void 0!==d)e.call(this,d.hc(),d);else{e.call(this);this.Jf=[];this.Jf[0]=0;this.Aa=1;this.Wg=
[];for(d=0;10>d;d++)this.Wg[d]=-1;this.Wg[this.Jf[0]]=0}this.To=!0}A(d,e);d.prototype.Ne=function(d){this.hasAttribute(d)||(this.Wg[d]=0,this.xA())};d.prototype.removeAttribute=function(d){if(0==d)throw a.g.N("Position attribue cannot be removed");this.hasAttribute(d)&&(this.Wg[d]=-1,this.xA())};d.prototype.reset=function(){this.Jf[0]=0;this.Aa=1;for(var d=0;d<this.Wg.length;d++)this.Wg[d]=-1;this.Wg[this.Jf[0]]=0;this.To=!0};d.prototype.qw=function(){return k.ww().add(this)};d.Tf=function(){return k.ww().iO()};
d.Zn=function(){return k.ww().jO()};d.prototype.pJ=function(){var d=this.hc();return new a.pa(d,this)};d.prototype.xA=function(){for(var d=this.Aa=0,e=0;10>d;d++)0<=this.Wg[d]&&(this.Jf[e]=d,this.Wg[d]=e,e++,this.Aa++);this.To=!0};d.prototype.hc=function(){this.To&&(this.tk=this.jj(),this.To=!1);return this.tk};d.prototype.lc=function(e){if(null==e)return!1;if(e==this)return!0;if(!(e instanceof d)||e.Aa!=this.Aa)return!1;for(var a=0;a<this.Aa;a++)if(this.Jf[a]!=e.Jf[a])return!1;return this.To!=e.To?
!1:!0};d.prototype.qD=function(d){if(d.Aa!=this.Aa)return!1;for(var e=0;e<this.Aa;e++)if(this.Jf[e]!=d.Jf[e])return!1;return!0};d.iu=function(d,e){for(var a=[],b=0;b<d.Aa;b++)a[b]=-1;for(var b=0,g=d.Aa;b<g;b++)a[b]=e.zf(d.Hd(b));return a};d.PN=function(e,a){e=new d(e);e.Ne(a);return e.qw()};d.QN=function(e,a){for(var b=null,g=0;10>g;g++)!e.hasAttribute(g)&&a.hasAttribute(g)&&(null==b&&(b=new d(e)),b.Ne(g));return null!=b?b.qw():e};d.bo=function(e,a){e=new d(e);e.removeAttribute(a);return e.qw()};
return d}(a.pa);a.Od=b;var k=function(){function e(){this.map=[];var d=new b;this.add(d);d=new b;d.Ne(1);this.add(d)}e.ww=function(){return e.lI};e.prototype.iO=function(){return e.Yn};e.prototype.jO=function(){return e.Zn};e.prototype.add=function(d){var a=d.hc();if(null!=e.Yn&&e.Yn.hc()==a&&d.qD(e.Yn))return e.Yn;if(null!=e.Zn&&e.Zn.hc()==a&&d.qD(e.Zn))return e.Zn;var b=null;void 0!==this.map[a]&&(b=this.map[a]);null==b&&(b=d.pJ(),1==b.Aa?e.Yn=b:2==b.Aa&&1==b.Hd(1)?e.Zn=b:this.map[a]=b);return b};
e.lI=new e;return e}()})(x||(x={}));var Q=0==f.version.indexOf("4."),S;(function(a){a[a.Linear=0]="Linear";a[a.Angular=1]="Angular";a[a.Area=2]="Area";a[a.LinearOrAngular=3]="LinearOrAngular"})(S||(S={}));var P={feet:9002,kilometers:9036,meters:9001,miles:9035,"nautical-miles":9030,yards:9096},O={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109413,"square-yards":109442},T={degrees:9102,radians:9101};void 0===a.prototype.getCacheValue&&
l.extend(a,{cache:null,getCacheValue:function(a){if(null===this.cache||void 0===this.cache)this.cache={};return this.cache[a]},setCacheValue:function(a,b){if(null===this.cache||void 0===this.cache)this.cache={};this.cache[a]=b}});var U=x.Nf.create(4326),W=x.Nf.create(102100);return function(){function b(){}b.extendedSpatialReferenceInfo=function(a){if(null===a)return null;a=E(a);var b=a.Se();return{tolerance:a.xq(),unitType:null==b?-1:b.Nc,unitID:null==b?-1:b.Qc(),unitBaseFactor:null==b?0:b.Dj,unitSquareDerivative:null==
b?0:x.Tb.PC(b).Qc()}};b.clip=function(a,b){if(null===a)return null;b=x.Pb.clip(G(a),G(b),n(a));return u(b,a.spatialReference)};b.cut=function(a,b){b=G(b);b=x.Pb.xm(G(a),b,n(a));for(var e=[],d=0;d<b.length;d++)e.push(u(b[d],a.spatialReference));return e};b.contains=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return x.Pb.contains(G(a),G(b),n(a))};b.crosses=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return x.Pb.VL(G(a),G(b),n(a))};
b.distance=function(a,b,e){if(null===a||null===b)throw Error("Illegal Argument Exception");return x.Pb.Fb(G(a),G(b),n(a),x.Tb.Qd(z(e,3)))};b.equals=function(a,b){return null===a&&null!==b||null===b&&null!==a?!1:x.Pb.lc(G(a),G(b),n(a))};b.intersects=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return x.Pb.RO(G(a),G(b),n(a))};b.touches=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return x.Pb.touches(G(a),G(b),n(a))};b.within=function(a,
b){if(null===a||null===b)throw Error("Illegal Argument Exception");return x.Pb.jT(G(a),G(b),n(a))};b.disjoint=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return x.Pb.nM(G(a),G(b),n(a))};b.overlaps=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return x.Pb.tQ(G(a),G(b),n(a))};b.relate=function(a,b,e){if(null===a||null===b)throw Error("Illegal Argument Exception");return x.Pb.py(G(a),G(b),n(a),e)};b.isSimple=function(a){if(null===a)throw Error("Illegal Argument Exception");
return x.Pb.cP(G(a),n(a))};b.simplify=function(a){if(null===a)throw Error("Illegal Argument Exception");var b=x.Pb.Qy(G(a),n(a));return u(b,a.spatialReference)};b.convexHull=function(k,c){void 0===c&&(c=!1);if(null===k)throw Error("Illegal Argument Exception");return k instanceof a?(c=x.Pb.JL(G(k),n(k)),u(c,k.spatialReference)):b.NI(k,c)};b.NI=function(a,b){for(var e=[],d=0;d<a.length;d++)e.push(G(a[d]));e=x.Pb.KL(e,b);for(d=0;d<e.length;d++)e[d]=u(e[d],a[0].spatialReference);return e};b.difference=
function(k,c){if(null===k||null===c)throw Error("Illegal Argument Exception");return k instanceof a?(c=x.Pb.ll(G(k),G(c),n(k)),u(c,k.spatialReference)):b.XL(k,c)};b.XL=function(a,b){for(var e=[],d=0;d<a.length;d++)e.push(G(a[d]));e=x.Pb.kM(e,G(b),n(b));for(d=0;d<e.length;d++)e[d]=u(e[d],b.spatialReference);return e};b.symmetricDifference=function(k,c){if(null===k||null===c)throw Error("Illegal Argument Exception");return k instanceof a?(c=x.Pb.On(G(k),G(c),n(k)),u(c,k.spatialReference)):b.tO(k,c)};
b.tO=function(a,b){for(var e=[],d=0;d<a.length;d++)e.push(G(a[d]));e=x.Pb.MS(e,G(b),n(b));for(d=0;d<e.length;d++)e[d]=u(e[d],b.spatialReference);return e};b.intersect=function(k,c){if(null===k||null===c)throw Error("Illegal Argument Exception");return k instanceof a?(c=x.Pb.Ga(G(k),G(c),n(k)),u(c,k.spatialReference)):b.EM(k,c)};b.EM=function(a,b){for(var e=[],d=0;d<a.length;d++)e.push(G(a[d]));e=x.Pb.QO(e,G(b),n(b));for(d=0;d<e.length;d++)e[d]=u(e[d],b.spatialReference);return e};b.union=function(b,
k){void 0===k&&(k=null);if(null===b)return null;b instanceof a&&(b=[b],null!==k&&b.push(k));if(0===b.length)return null;k=[];for(var e=0;e<b.length;e++)k.push(G(b[e]));return u(x.Pb.aT(k,n(b[0])),b[0].spatialReference)};b.offset=function(k,c,e,d,g,h){var m=0;if(null!=d&&void 0!=d)switch(d){case "round":m=0;break;case "bevel":m=1;break;case "miter":m=2;break;case "square":m=3}return k instanceof a?(c=x.Pb.offset(G(k),n(k),c,m,g,h,x.Tb.Qd(z(e,3))),u(c,k.spatialReference)):b.qO(k,c,e,m,g,h)};b.qO=function(a,
b,e,d,g,k){if(null===a)return null;if(0===a.length)return[];for(var c=[],h=0;h<a.length;h++)c.push(G(a[h]));b=x.Pb.sQ(c,n(a[0]),b,d,g,k,x.Tb.Qd(z(e,3)));for(h=0;h<b.length;h++)b[h]=u(b[h],a[0].spatialReference);return b};b.buffer=function(k,c,e,d){void 0===d&&(d=!1);if(k instanceof a)return c=x.Pb.buffer(G(k),n(k),c,x.Tb.Qd(z(e,3)),!1,0,NaN),u(c,k.spatialReference);if("[object Array]"!==Object.prototype.toString.call(c)){for(var g=[],h=0;h<k.length;h++)g.push(c);c=g}if(c.length!=k.length){if(0==c.length)throw Error("Illegal Argument Exception");
for(var g=[],l=0,h=0;h<k.length;h++)void 0===c[h]?g.push(l):(g.push(c[h]),l=c[h]);c=g}return b.vG(k,c,e,!1,d,"geodesic",NaN)};b.geodesicBuffer=function(k,c,e,d,g,h){if(k instanceof a)return void 0===g&&(g=NaN),c=x.Pb.buffer(G(k),n(k),c,x.Tb.Qd(z(e,0)),!0,w(d),g),u(c,k.spatialReference);if("[object Array]"!==Object.prototype.toString.call(c)){for(var m=[],l=0;l<k.length;l++)m.push(c);c=m}if(c.length!=k.length){if(0==c.length)throw Error("Illegal Argument Exception");for(var m=[],q=0,l=0;l<k.length;l++)void 0===
c[l]?m.push(q):(m.push(c[l]),q=c[l]);c=m}return b.vG(k,c,e,!0,d,g,h)};b.vG=function(a,b,e,d,g,k,c){if(null===a)return null;if(0===a.length)return[];void 0===c&&(c=NaN);for(var h=[],m=0;m<a.length;m++)h.push(G(a[m]));b=x.Pb.rK(h,n(a[0]),b,x.Tb.Qd(z(e,0)),d,g,w(k),c);for(m=0;m<b.length;m++)b[m]=u(b[m],a[0].spatialReference);return b};b.nearestCoordinate=function(a,b,e){void 0===e&&(e=!0);b=x.Pb.zw(G(a),G(b),e);return{coordinate:u(b.pw(),a.spatialReference),distance:b.sw(),isRightSide:b.Xw(),vertexIndex:b.gb(),
isEmpty:b.s()}};b.nearestVertex=function(a,b){b=x.Pb.Aw(G(a),G(b));return{coordinate:u(b.pw(),a.spatialReference),distance:b.sw(),isRightSide:b.Xw(),vertexIndex:b.gb(),isEmpty:b.s()}};b.nearestVertices=function(a,b,e,d){b=G(b);e=x.Pb.Bw(G(a),b,e,d);d=[];for(b=0;b<e.length;b++)!1===e[b].s()&&d.push({coordinate:u(e[b].pw(),a.spatialReference),distance:e[b].sw(),isRightSide:e[b].Xw(),vertexIndex:e[b].gb(),isEmpty:e[b].s()});return d};b.generalize=function(a,b,e,d){b=x.Pb.fN(G(a),n(a),b,e,x.Tb.Qd(z(d,
3)));return u(b,a.spatialReference)};b.densify=function(a,b,e){b=x.Pb.oq(G(a),n(a),b,x.Tb.Qd(z(e,3)));return u(b,a.spatialReference)};b.geodesicDensify=function(a,b,e,d){void 0===d&&(d=0);b=x.Pb.fw(G(a),n(a),b,x.Tb.Qd(z(e,3)),d);return u(b,a.spatialReference)};b.rotate=function(a,b,e){if(void 0===e||null===e)switch(a.type){case "point":e=a;break;case "extent":e=Q?a.get("center"):a.getCenter();break;default:e=Q?a.get("extent").get("center"):a.getExtent().getCenter()}b=Q?x.Wn.rotate(a.toJSON(),b,e.toJSON()):
x.Wn.rotate(a.toJson(),b,e.toJson());Q?(b=y(b),b.set("spatialReference",a.spatialReference)):(b=q(b),b.setSpatialReference(a.spatialReference));return b};b.flipHorizontal=function(a,b){if(void 0===b||null===b)switch(a.type){case "point":b=a;break;case "extent":b=Q?a.get("center"):a.getCenter();break;default:b=Q?a.get("extent").get("center"):a.getExtent().getCenter()}b=Q?x.Wn.eC(a.toJSON(),b.toJSON()):x.Wn.eC(a.toJson(),b.toJson());Q?(b=y(b),b.set("spatialReference",a.spatialReference)):(b=q(b),b.setSpatialReference(a.spatialReference));
return b};b.flipVertical=function(a,b){if(void 0===b||null===b)switch(a.type){case "point":b=a;break;case "extent":b=Q?a.get("center"):a.getCenter();break;default:b=Q?a.get("extent").get("center"):a.getExtent().getCenter()}b=Q?x.Wn.fC(a.toJSON(),b.toJSON()):x.Wn.fC(a.toJson(),b.toJson());Q?(b=y(b),b.set("spatialReference",a.spatialReference)):(b=q(b),b.setSpatialReference(a.spatialReference));return b};b.planarArea=function(a,b){if(null===a)throw Error("Illegal Argument Exception");return x.Pb.BQ(G(a),
n(a),x.Tb.Qd(z(b,2)))};b.planarLength=function(a,b){if(null===a)throw Error("Illegal Argument Exception");return x.Pb.CQ(G(a),n(a),x.Tb.Qd(z(b,3)))};b.geodesicArea=function(a,b,e){if(null===a)throw Error("Illegal Argument Exception");return x.Pb.jN(G(a),n(a),x.Tb.Qd(z(b,2)),w(e))};b.geodesicLength=function(a,b,e){if(null===a)throw Error("Illegal Argument Exception");return x.Pb.nN(G(a),n(a),x.Tb.Qd(z(b,0)),w(e))};return b}()})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/watchUtils ../../core/Accessor ../../core/Evented ../../core/HandleRegistry ../../core/watchUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l){return function(q){function p(){var a=q.call(this)||this;a._anchorHandles=new h;a.location=null;a.screenLocation=null;a.screenLocationEnabled=!1;a.view=null;a._anchorHandles.add([l.watch(a,"screenLocationEnabled,location,view.size",function(){return a._updateScreenPointAndHandle()}),l.watch(a,"view, view.ready",function(){return a._wireUpView()})]);return a}f(p,q);p.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=
this._anchorHandles=null};p.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var b=this.view,b=c.pausable(b,"3d"===b.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(b,"view");this._viewpointHandle=b;this._toggleWatchingViewpoint()}};p.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};p.prototype._updateScreenPointAndHandle=
function(){this._setScreenLocation();this._toggleWatchingViewpoint()};p.prototype._toggleWatchingViewpoint=function(){var a=this._viewpointHandle,b=this.screenLocationEnabled;a&&(this.location&&b?a.resume():a.pause())};p.prototype._setScreenLocation=function(){var a=this.location,b=this.view,c=this.screenLocationEnabled,h=this.get("view.ready"),a=c&&a&&h?b.toScreen(a.x,a.y,a.z):null;this._set("screenLocation",a)};a([b.property()],p.prototype,"location",void 0);a([b.property({readOnly:!0})],p.prototype,
"screenLocation",void 0);a([b.property()],p.prototype,"screenLocationEnabled",void 0);a([b.property()],p.prototype,"view",void 0);return p=a([b.subclass("esri.widgets.support.AnchorElementViewModel")],p)}(b.declared(t,p))})},"dojo/fx/easing":function(){define(["../_base/lang"],function(B){var r={linear:function(f){return f},quadIn:function(f){return Math.pow(f,2)},quadOut:function(f){return f*(f-2)*-1},quadInOut:function(f){f*=2;return 1>f?Math.pow(f,2)/2:-1*(--f*(f-2)-1)/2},cubicIn:function(f){return Math.pow(f,
3)},cubicOut:function(f){return Math.pow(f-1,3)+1},cubicInOut:function(f){f*=2;return 1>f?Math.pow(f,3)/2:(Math.pow(f-2,3)+2)/2},quartIn:function(f){return Math.pow(f,4)},quartOut:function(f){return-1*(Math.pow(f-1,4)-1)},quartInOut:function(f){f*=2;return 1>f?Math.pow(f,4)/2:-.5*(Math.pow(f-2,4)-2)},quintIn:function(f){return Math.pow(f,5)},quintOut:function(f){return Math.pow(f-1,5)+1},quintInOut:function(f){f*=2;return 1>f?Math.pow(f,5)/2:(Math.pow(f-2,5)+2)/2},sineIn:function(f){return-1*Math.cos(Math.PI/
2*f)+1},sineOut:function(f){return Math.sin(Math.PI/2*f)},sineInOut:function(f){return-1*(Math.cos(Math.PI*f)-1)/2},expoIn:function(f){return 0==f?0:Math.pow(2,10*(f-1))},expoOut:function(f){return 1==f?1:-1*Math.pow(2,-10*f)+1},expoInOut:function(f){if(0==f)return 0;if(1==f)return 1;f*=2;if(1>f)return Math.pow(2,10*(f-1))/2;--f;return(-1*Math.pow(2,-10*f)+2)/2},circIn:function(f){return-1*(Math.sqrt(1-Math.pow(f,2))-1)},circOut:function(f){return Math.sqrt(1-Math.pow(f-1,2))},circInOut:function(f){f*=
2;return 1>f?-.5*(Math.sqrt(1-Math.pow(f,2))-1):.5*(Math.sqrt(1-Math.pow(f-2,2))+1)},backIn:function(f){return Math.pow(f,2)*(2.70158*f-1.70158)},backOut:function(f){--f;return Math.pow(f,2)*(2.70158*f+1.70158)+1},backInOut:function(f){f*=2;if(1>f)return Math.pow(f,2)*(3.5949095*f-2.5949095)/2;f-=2;return(Math.pow(f,2)*(3.5949095*f+2.5949095)+2)/2},elasticIn:function(f){if(0==f||1==f)return f;--f;return-1*Math.pow(2,10*f)*Math.sin(2*(f-.075)*Math.PI/.3)},elasticOut:function(f){return 0==f||1==f?f:
Math.pow(2,-10*f)*Math.sin(2*(f-.075)*Math.PI/.3)+1},elasticInOut:function(f){if(0==f)return 0;f*=2;if(2==f)return 1;var a=.3*1.5,b=a/4;if(1>f)return--f,-.5*Math.pow(2,10*f)*Math.sin(2*(f-b)*Math.PI/a);--f;return.5*Math.pow(2,-10*f)*Math.sin(2*(f-b)*Math.PI/a)+1},bounceIn:function(f){return 1-r.bounceOut(1-f)},bounceOut:function(f){return f<1/2.75?7.5625*Math.pow(f,2):f<2/2.75?7.5625*Math.pow(f-1.5/2.75,2)+.75:f<2.5/2.75?7.5625*Math.pow(f-2.25/2.75,2)+.9375:7.5625*Math.pow(f-2.625/2.75,2)+.984375},
bounceInOut:function(f){return.5>f?r.bounceIn(2*f)/2:r.bounceOut(2*f-1)/2+.5}};B.setObject("dojo.fx.easing",r);return r})},"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./support/widget ../core/accessorSupport/decorators ./Widget ../core/promiseUtils ../core/watchUtils ./support/AnchorElementViewModel".split(" "),function(B,r,f,a,b,c,t,p,h,l){return function(q){function t(a){a=q.call(this)||this;a._animationDelay=
500;a._animationPromise=null;a.location=null;a.view=null;a.visible=!1;a.viewModel=new l;return a}f(t,q);t.prototype.postInitialize=function(){var a=this;this.own([h.watch(this,"visible",function(b){return a._visibleChange(b)})])};t.prototype.destroy=function(){this._cancelAnimationPromise()};t.prototype.show=function(a){var b=this,c=a.location;a=a.promise;c&&(this.viewModel.location=c);this.visible=!0;a&&a.always(function(){return b.hide()})};t.prototype.hide=function(){this.visible=!1};t.prototype.render=
function(){var a=this.visible,c=!!this.viewModel.screenLocation,a=(h={},h["esri-spinner--start"]=a&&c,h["esri-spinner--finish"]=!a&&c,h),h=this._getPositionStyles();return b.tsx("div",{class:"esri-spinner",classes:a,styles:h});var h};t.prototype._cancelAnimationPromise=function(){this._animationPromise&&(this._animationPromise.cancel(),this._animationPromise=null)};t.prototype._visibleChange=function(a){var b=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=
p.after(this._animationDelay).then(function(){b.viewModel.screenLocationEnabled=!1;b._animationPromise=null}))};t.prototype._getPositionStyles=function(){var a=this.viewModel.screenLocation;return a?{left:a.x+"px",top:a.y+"px"}:{}};a([c.aliasOf("viewModel.location")],t.prototype,"location",void 0);a([c.aliasOf("viewModel.view")],t.prototype,"view",void 0);a([c.property(),b.renderable()],t.prototype,"visible",void 0);a([c.property({type:l}),b.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],
t.prototype,"viewModel",void 0);return t=a([c.subclass("esri.widgets.Spinner")],t)}(c.declared(t))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/watchUtils ./UI ./Component ../../widgets/Attribution ../../widgets/Compass ../../widgets/Zoom ../../widgets/NavigationToggle dojo/dom-geometry".split(" "),function(B,r,f,a,b,c,t,p,h,l,q,y,z){return function(w){function u(a){a=
w.call(this)||this;a._defaultPositionLookup=null;a.components=[];return a}f(u,w);u.prototype.initialize=function(){this._handles.add([c.init(this,"components",this._componentsWatcher.bind(this)),c.init(this,"view",this._updateViewAwareWidgets.bind(this))])};u.prototype._findComponentPosition=function(a){if(!this._defaultPositionLookup){var b=z.isBodyLtr();this._defaultPositionLookup={attribution:"manual",compass:b?"top-left":"top-right","navigation-toggle":b?"top-left":"top-right",zoom:b?"top-left":
"top-right"}}return this._defaultPositionLookup[a]};u.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};u.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&void 0!==c.view&&c.set("view",a)})};u.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a)};u.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),
b._findComponentPosition(a))})};u.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new p({id:a,node:b})};u.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};u.prototype._createAttribution=function(){return new h({view:this.view})};u.prototype._createCompass=function(){return new l({view:this.view})};
u.prototype._createNavigationToggle=function(){return new y({view:this.view})};u.prototype._createZoom=function(){return new q({view:this.view})};a([b.property()],u.prototype,"components",void 0);return u=a([b.subclass("esri.views.ui.DefaultUI")],u)}(b.declared(t))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Component ../../core/Accessor ../../core/HandleRegistry ../../core/watchUtils dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/dom-style".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z){function w(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(c)||!("component"in a||"index"in a||"position"in a)?null:a}var u={left:0,top:0,bottom:0,right:0},C={bottom:30,top:15,right:15,left:15};return function(t){function E(){var a=t.call(this)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._handles=new p;a.padding=C;a.view=null;a._initContainers();return a}f(E,t);E.prototype.initialize=function(){this._handles.add([h.init(this,
"view.padding, container",this._applyViewPadding.bind(this)),h.init(this,"padding",this._applyUIPadding.bind(this))])};E.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy()};Object.defineProperty(E.prototype,"container",{set:function(a){var b=this._get("container");a!==b&&(a&&(q.add(a,"esri-ui"),this._attachContainers(a)),b&&(q.remove(b,"esri-ui"),z.set(b,{top:"",bottom:"",left:"",right:""}),y.empty(b)),
this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(E.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});E.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:l.mixin({},C,a)};Object.defineProperty(E.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();
return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});E.prototype.add=function(a,b){var n=this,h;if(Array.isArray(a))a.forEach(function(a){return n.add(a,b)});else{var l=w(a);l&&(h=l.index,b=l.position,a=l.component);b&&"object"===typeof b&&(h=b.index,b=b.position);!a||b&&!this._isValidPosition(b)||(a&&a.isInstanceOf&&a.isInstanceOf(c)||(a=new c({node:a})),this._place({component:a,position:b,index:h}),this._components.push(a))}};E.prototype.remove=function(a){if(a){if(Array.isArray(a))return a.map(this.remove,
this);if(a=this.find(a)){var b=this._components.indexOf(a);a.node.parentNode&&a.node.parentNode.removeChild(a.node);return this._components.splice(b,1)[0]}}};E.prototype.empty=function(a){var b=this;if(Array.isArray(a))return a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!q.contains(a,"esri-ui-corner")}).map(function(a){return b.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};E.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var n,h=w(a)||w(b);h&&(n=h.index,b=h.position,a=h.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:n})}};E.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(c)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};E.prototype._getViewPadding=function(){return this.get("view.padding")||
u};E.prototype._attachContainers=function(a){y.place(this._manualContainer,a);y.place(this._innerContainer,a)};E.prototype._initContainers=function(){var a=y.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=y.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),c=y.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),h=y.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),q=y.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},
a),u=y.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;this._cornerNameToContainerLookup={"top-left":c,"top-right":h,"bottom-left":q,"bottom-right":u};this._positionNameToContainerLookup=l.mixin({manual:b},this._cornerNameToContainerLookup)};E.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};E.prototype._place=function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||
"manual"];var n;-1<c?(n=Array.prototype.slice.call(a.children),0===c?this._placeComponent(b,a,"first"):c>=n.length?this._placeComponent(b,a,"last"):this._placeComponent(b,n[c],"before")):this._placeComponent(b,a,"last")};E.prototype._placeComponent=function(a,b,c){var n=a.widget;n&&!n._started&&"function"===typeof n.postMixInProperties&&"function"===typeof n.buildRendering&&"function"===typeof n.postCreate&&"function"===typeof n.startup&&a.widget.startup();y.place(a.node,b,c)};E.prototype._applyViewPadding=
function(){var a=this.container;a&&z.set(a,this._toPxPosition(this._getViewPadding()))};E.prototype._applyUIPadding=function(){this._innerContainer&&z.set(this._innerContainer,this._toPxPosition(this.padding))};E.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};E.prototype._toPxUnit=function(a){return 0===a?0:a+"px"};E.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(n){(c=
n===a)&&(b=n);return c});return b};E.prototype._findById=function(a){var b=null,c;this._components.some(function(n){(c=n.id===a)&&(b=n);return c});return b};E.prototype._findByNode=function(a){var b=null,c;this._components.some(function(n){(c=n.node===a)&&(b=n);return c});return b};a([b.property()],E.prototype,"container",null);a([b.property({dependsOn:["view.height"]})],E.prototype,"height",null);a([b.property()],E.prototype,"padding",void 0);a([b.cast("padding")],E.prototype,"castPadding",null);
a([b.property()],E.prototype,"view",void 0);a([b.property({dependsOn:["view.width"]})],E.prototype,"width",null);return E=a([b.subclass("esri.views.ui.UI")],E)}(b.declared(t))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor dojo/dom dojo/dom-class".split(" "),function(B,r,f,a,b,c,t,p){return function(c){function h(){var a=null!==c&&c.apply(this,arguments)||
this;a.widget=null;return a}f(h,c);h.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(h.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"node",{set:function(a){var b=this._get("node");a!==b&&(a&&p.add(a,"esri-component"),b&&p.remove(b,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});h.prototype.castNode=
function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),t.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};a([b.property()],h.prototype,"id",null);a([b.property()],h.prototype,"node",null);a([b.cast("node")],h.prototype,"castNode",null);a([b.property({readOnly:!0})],h.prototype,"widget",void 0);return h=a([b.subclass("esri.views.ui.Component")],
h)}(b.declared(c))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./Attribution/AttributionViewModel".split(" "),function(B,r,f,a,b,c,t,p){return function(h){function l(a){a=h.call(this)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.view=null;a.viewModel=new p;return a}f(l,h);l.prototype.render=function(){var a=(b={},
b["esri-attribution--open"]=this._isOpen,b);return c.tsx("div",{bind:this,class:"esri-attribution esri-widget",classes:a,onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),c.tsx("div",{class:"esri-attribution__powered-by"},"Powered by ",c.tsx("a",{target:"_blank",href:"http://www.esri.com/",class:"esri-attribution__link"},"Esri")));var b};l.prototype._renderSourcesNode=function(){var a=this._isOpen,b=this._isInteractive(),h=b?0:-1,l=this.get("viewModel.attributionText"),
a=(u={},u["esri-attribution__sources--open"]=a,u["esri-interactive"]=b,u);return c.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:"esri-attribution__sources",classes:a,innerHTML:l,role:b?"button":void 0,tabIndex:h});var u};l.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth};l.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var h=this._attributionTextOverflowed!==
a;this._attributionTextOverflowed=a;h&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};l.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};l.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};a([b.aliasOf("viewModel.view")],l.prototype,"view",void 0);a([b.property({type:p}),c.renderable(["attributionText","state","view.size"])],l.prototype,
"viewModel",void 0);a([c.accessibleHandler()],l.prototype,"_toggleState",null);return l=a([b.subclass("esri.widgets.Attribution")],l)}(b.declared(t))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../geometry/support/webMercatorUtils ../../core/HandleRegistry ../../core/Accessor ../../core/lang ../../core/watchUtils ../../geometry/Extent".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q){return function(p){function y(a){a=p.call(this,a)||this;a._handles=new t;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.itemDelimiter=" | ";a.items=[];a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}f(y,p);y.prototype.initialize=function(){this._handles.add(l.init(this,"view",this._viewWatcher))};y.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(y.prototype,
"attributionText",{get:function(){return this.items.join(this.itemDelimiter)},enumerable:!0,configurable:!0});Object.defineProperty(y.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});y.prototype._viewWatcher=function(a){var b=this,c=this._handles;c&&c.remove();a&&(c.add([a.allLayerViews.on("change",function(a){b._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){c.remove(a.uid)}),b._updateAttributionItems())}),
l.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};y.prototype._addLayerViews=function(a){var b=this;a.forEach(function(a){b._handles.has(a.uid)||b._handles.add(l.init(a,"suspended",b._updateAttributionItems),a.uid)})};y.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(c){var h=c.layer;if(!h.hasAttributionData)c=h.get("copyright"),a._isUnique(b,c)&&b.push(c);else if(h&&h.tileInfo){var l=a._attributionDataByLayerId;
if(l[h.uid])c=a._getDynamicAttribution(l[h.uid],a.view,h),a._isUnique(b,c)&&b.push(c);else{var n=a._pendingAttributionItemsByLayerId;a._inProgress(n[h.uid])||(n[h.uid]=h.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(h));delete n[h.uid];l[h.uid]=b;a._updateAttributionItems()}))}}});this._itemsChanged(this.items,b)&&this._set("items",b)};y.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,c){return a!==b[c]})};y.prototype._inProgress=
function(a){return a&&!a.isFulfilled()};y.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&a.get("layer.attributionVisible")})};y.prototype._isUnique=function(a,b){return b&&-1===a.indexOf(b)};y.prototype._isBingLayer=function(a){return-1!==a.declaredClass.toLowerCase().indexOf("vetiledlayer")};y.prototype._createContributionIndex=function(a,b){a=a.contributors;var l={};if(!a)return l;a.forEach(function(a,u){var n=a.coverageAreas;
n&&n.forEach(function(n){var f=n.bbox,A=n.zoomMin-(b&&n.zoomMin?1:0),p=n.zoomMax-(b&&n.zoomMax?1:0);a={extent:c.geographicToWebMercator(new q({xmin:f[1],ymin:f[0],xmax:f[3],ymax:f[2]})),attribution:a.attribution||"",score:h.isDefined(n.score)?n.score:100,id:u};for(n=A;n<=p;n++)l[n]=l[n]||[],l[n].push(a)})});l.maxKey=Math.max.apply(null,Object.keys(l));return l};y.prototype._getDynamicAttribution=function(a,b,c){var l=b.extent;b=c.tileInfo.scaleToZoom(b.scale);b=Math.min(a.maxKey,Math.round(b));if(!l||
!h.isDefined(b)||-1>=b)return"";a=a[b];var q=l.center.clone().normalize(),n={};return a.filter(function(a){var b=!n[a.id]&&a.extent.contains(q);b&&(n[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", ")};a([b.property({dependsOn:["items","itemDelimiter"],readOnly:!0})],y.prototype,"attributionText",null);a([b.property()],y.prototype,"itemDelimiter",void 0);a([b.property({readOnly:!0})],y.prototype,"items",void 0);
a([b.property({dependsOn:["view.ready"],readOnly:!0})],y.prototype,"state",null);a([b.property()],y.prototype,"view",void 0);return y=a([b.subclass("esri.widgets.Attribution.AttributionViewModel")],y)}(b.declared(p))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./Compass/CompassViewModel dojo/i18n!./Compass/nls/Compass".split(" "),function(B,r,f,a,b,
c,t,p,h){return function(l){function q(a){a=l.call(this)||this;a.view=null;a.viewModel=new p;return a}f(q,l);q.prototype.reset=function(){};q.prototype.render=function(){var a=this.viewModel.orientation,b=this.viewModel.state,l="disabled"===b,q="compass"===("rotation"===b?"rotation":"compass"),b=(f={},f["esri-disabled"]=l,f["esri-interactive"]=!l,f),f=(p={},p["esri-icon-compass"]=q,p["esri-icon-dial"]=!q,p);return c.tsx("div",{bind:this,class:"esri-compass esri-widget-button esri-widget",classes:b,
onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:l?-1:0,"aria-label":h.reset,title:h.reset},c.tsx("span",{"aria-hidden":"true",class:"esri-compass__icon",classes:f,styles:this._toRotationTransform(a)}),c.tsx("span",{class:"esri-icon-font-fallback-text"},h.reset));var f,p};q.prototype._reset=function(){this.reset()};q.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};a([b.aliasOf("viewModel.view")],q.prototype,"view",void 0);a([b.property({type:p}),
c.renderable(["viewModel.orientation","viewModel.state"])],q.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.reset")],q.prototype,"reset",null);a([c.accessibleHandler()],q.prototype,"_reset",null);return q=a([b.subclass("esri.widgets.Compass")],q)}(b.declared(t))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/HandleRegistry ../../core/Accessor ../../core/watchUtils".split(" "),
function(B,r,f,a,b,c,t,p){return function(h){function l(a){a=h.call(this,a)||this;a._handles=new c;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);return a}f(l,h);l.prototype.initialize=function(){this._handles.add(p.init(this,"view",this._updateRotationWatcher))};l.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(l.prototype,
"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});l.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.view.goTo(a)}};l.prototype._updateForRotation=function(a){void 0!==a&&
null!==a&&(this.orientation={z:a})};l.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};l.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(p.init(this,"view.rotation",this._updateForRotation)):this._handles.add(p.init(this,"view.camera",this._updateForCamera)))};a([b.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],l.prototype,"canShowNorth",null);a([b.property()],
l.prototype,"orientation",void 0);a([b.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],l.prototype,"state",null);a([b.property()],l.prototype,"view",void 0);a([b.property()],l.prototype,"reset",null);return l=a([b.subclass("esri.widgets.CompassViewModel")],l)}(b.declared(t))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel dojo/i18n!./Zoom/nls/Zoom".split(" "),
function(B,r,f,a,b,c,t,p,h,l){return function(q){function t(a){a=q.call(this)||this;a.view=null;a.viewModel=new h;return a}f(t,q);t.prototype.postInitialize=function(){this._zoomInButton=new p({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus",title:l.zoomIn});this._zoomOutButton=new p({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus",title:l.zoomOut})};Object.defineProperty(t.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,
configurable:!0});t.prototype.render=function(){var a=this.viewModel,b=(h={},h["esri-zoom--horizontal"]="horizontal"===this.layout,h);this._zoomInButton.enabled="ready"===a.state&&a.canZoomIn;this._zoomOutButton.enabled="ready"===a.state&&a.canZoomOut;return c.tsx("div",{class:"esri-zoom esri-widget",classes:b},this._zoomInButton.render(),this._zoomOutButton.render());var h};t.prototype.zoomIn=function(){};t.prototype.zoomOut=function(){};a([b.property({value:"vertical"}),c.renderable()],t.prototype,
"layout",null);a([b.aliasOf("viewModel.view"),c.renderable()],t.prototype,"view",void 0);a([b.property({type:h}),c.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],t.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.zoomIn")],t.prototype,"zoomIn",null);a([b.aliasOf("viewModel.zoomOut")],t.prototype,"zoomOut",null);return t=a([b.subclass("esri.widgets.Zoom")],t)}(b.declared(t))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../support/widget ../Widget".split(" "),
function(B,r,f,a,b,c,t){return function(p){function h(){var a=null!==p&&p.apply(this,arguments)||this;a.enabled=!0;a.iconClass="";a.title="";return a}f(h,p);h.prototype.render=function(){var a=this.enabled?0:-1,b=(h={},h["esri-disabled"]=!this.enabled,h["esri-interactive"]=this.enabled,h),h=(f={},f[this.iconClass]=!!this.iconClass,f);return c.tsx("div",{bind:this,class:"esri-widget-button esri-widget",classes:b,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:a,title:this.title},
c.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon",classes:h}),c.tsx("span",{class:"esri-icon-font-fallback-text"},this.title));var h,f};h.prototype._triggerAction=function(){this.action.call(this)};a([b.property()],h.prototype,"action",void 0);a([b.property(),c.renderable()],h.prototype,"enabled",void 0);a([b.property(),c.renderable()],h.prototype,"iconClass",void 0);a([b.property(),c.renderable()],h.prototype,"title",void 0);a([c.accessibleHandler()],h.prototype,"_triggerAction",
null);return h=a([b.subclass("esri.widgets.IconButton")],h)}(b.declared(t))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./ZoomConditions3D ./ZoomConditions2D ../../core/Accessor".split(" "),function(B,r,f,a,b,c,t,p){return function(h){function l(a){a=h.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);a.zoomOut=a.zoomOut.bind(a);
return a}f(l,h);l.prototype.destroy=function(){this.view=null};Object.defineProperty(l.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new t({view:a}):"3d"===a.type&&(this._zoomConditions=new c):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});l.prototype.zoomIn=function(){this.canZoomIn&&this._zoomToFactor(.5)};
l.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};l.prototype._zoomToFactor=function(a){"ready"===this.state&&this.view.goTo({scale:this.get("view.scale")*a})};a([b.property()],l.prototype,"_zoomConditions",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],l.prototype,"canZoomIn",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],l.prototype,"canZoomOut",void 0);a([b.property({dependsOn:["view.ready"],readOnly:!0})],l.prototype,
"state",null);a([b.property()],l.prototype,"view",null);a([b.property()],l.prototype,"zoomIn",null);a([b.property()],l.prototype,"zoomOut",null);return l=a([b.subclass("esri.widgets.Zoom.ZoomViewModel")],l)}(b.declared(p))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor".split(" "),function(B,r,f,a,b,c){return function(c){function p(){var a=
null!==c&&c.apply(this,arguments)||this;a.canZoomIn=!0;a.canZoomOut=!0;return a}f(p,c);a([b.property({readOnly:!0})],p.prototype,"canZoomIn",void 0);a([b.property({readOnly:!0})],p.prototype,"canZoomOut",void 0);return p=a([b.subclass("esri.widgets.Zoom.ZoomConditions3D")],p)}(b.declared(c))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor".split(" "),
function(B,r,f,a,b,c){return function(c){function p(){return null!==c&&c.apply(this,arguments)||this}f(p,c);Object.defineProperty(p.prototype,"canZoomIn",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"canZoomOut",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");return 0===b||a<b},enumerable:!0,configurable:!0});a([b.property({dependsOn:["view.ready",
"view.scale"],readOnly:!0})],p.prototype,"canZoomIn",null);a([b.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],p.prototype,"canZoomOut",null);a([b.property()],p.prototype,"view",void 0);return p=a([b.subclass("esri.widgets.Zoom.ZoomConditions2D")],p)}(b.declared(c))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./NavigationToggle/NavigationToggleViewModel dojo/i18n!./NavigationToggle/nls/NavigationToggle".split(" "),
function(B,r,f,a,b,c,t,p,h){return function(l){function q(a){a=l.call(this)||this;a.view=null;a.viewModel=new p;return a}f(q,l);Object.defineProperty(q.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});q.prototype.toggle=function(){};q.prototype.render=function(){var a="disabled"===this.get("viewModel.state"),b="pan"===this.get("viewModel.navigationMode"),l=(q={},q["esri-disabled"]=a,q["esri-navigation-toggle--horizontal"]=
"horizontal"===this.layout,q),q=(f={},f["esri-navigation-toggle__button--active"]=b,f),b=(p={},p["esri-navigation-toggle__button--active"]=!b,p);return c.tsx("div",{bind:this,class:"esri-navigation-toggle esri-widget",classes:l,onclick:this._toggle,onkeydown:this._toggle,tabIndex:a?-1:0,"aria-label":h.toggle,title:h.toggle},c.tsx("div",{class:c.join("esri-navigation-toggle__button esri-widget-button","esri-navigation-toggle__button--pan"),classes:q},c.tsx("span",{class:"esri-icon-pan"})),c.tsx("div",
{class:c.join("esri-navigation-toggle__button esri-widget-button","esri-navigation-toggle__button--rotate"),classes:b},c.tsx("span",{class:"esri-icon-rotate"})));var q,f,p};q.prototype._toggle=function(){this.toggle()};a([b.property({value:"vertical"}),c.renderable()],q.prototype,"layout",null);a([b.aliasOf("viewModel.view"),c.renderable()],q.prototype,"view",void 0);a([b.property({type:p}),c.renderable(["viewModel.state","viewModel.navigationMode"])],q.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.toggle")],
q.prototype,"toggle",null);a([c.accessibleHandler()],q.prototype,"_toggle",null);return q=a([b.subclass("esri.widgets.NavigationToggle")],q)}(b.declared(t))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/watchUtils ../../core/Accessor ../../core/HandleRegistry".split(" "),function(B,r,f,a,b,c,t,p){return function(h){function l(a){a=
h.call(this,a)||this;a._handles=new p;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}f(l,h);l.prototype.initialize=function(){this._handles.add(c.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};l.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(l.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!0,configurable:!0});l.prototype.toggle=
function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};l.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a([b.property({dependsOn:["view.ready"],readOnly:!0})],l.prototype,"state",null);a([b.property()],l.prototype,"navigationMode",void 0);a([b.property()],l.prototype,"view",void 0);a([b.property()],l.prototype,"toggle",null);return l=a([b.subclass("esri.widgets.NavigationToggleViewModel")],
l)}(b.declared(t))})},"esri/views/animation/easing":function(){define(["require","exports"],function(B,r){function f(a){return a}function a(a){var b=2*(a-Math.sqrt((a-1)*a)),c=b/2/a;return function(h){return h<c?a*h*h:b*h-b+1}}function b(a,b){return function(c){return c<b?b*a(c/b):1-a((1-c)/(1-b))*(1-b)}}Object.defineProperty(r,"__esModule",{value:!0});r.linear=f;r.inQuad=function(a){return a*a};r.outQuad=function(a){return 1-r.inQuad(1-a)};r.inOutQuad=function(a){return.5>a?r.inQuad(2*a)/2:(r.outQuad(2*
(a-.5))+1)/2};r.inCubic=function(a){return a*a*a};r.outCubic=function(a){return 1-r.inCubic(1-a)};r.inOutCubic=function(a){return.5>a?r.inCubic(2*a)/2:(r.outCubic(2*(a-.5))+1)/2};r.inQuart=function(a){return a*a*a*a};r.outQuart=function(a){return 1-r.inQuart(1-a)};r.inOutQuart=function(a){return.5>a?r.inQuart(2*a)/2:(r.outQuart(2*(a-.5))+1)/2};r.inQuint=function(a){return a*a*a*a*a};r.outQuint=function(a){return 1-r.inQuint(1-a)};r.inOutQuint=function(a){return.5>a?r.inQuint(2*a)/2:(r.outQuint(2*
(a-.5))+1)/2};r.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};r.outSine=function(a){return 1-r.inSine(1-a)};r.inOutSine=function(a){return.5>a?r.inSine(2*a)/2:(r.outSine(2*(a-.5))+1)/2};r.inExpo=function(a){return Math.pow(2,10*(a-1))};r.outExpo=function(a){return 1-r.inExpo(1-a)};r.inOutExpo=function(a){return.5>a?r.inExpo(2*a)/2:(r.outExpo(2*(a-.5))+1)/2};r.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};r.outCirc=function(a){return 1-r.inCirc(1-a)};r.inOutCirc=function(a){return.5>a?r.inCirc(2*
a)/2:(r.outCirc(2*(a-.5))+1)/2};r.inCoastQuad=b(a(1),1);r.outCoastQuad=b(a(1),0);r.inOutCoastQuad=b(a(1),.5);r.inCoastCubic=b(a(2),1);r.outCoastCubic=b(a(2),0);r.inOutCoastCubic=b(a(2),.5);r.inCoastQuart=b(a(3),1);r.outCoastQuart=b(a(3),0);r.inOutCoastQuart=b(a(3),.5);r.inCoastQuint=b(a(4),1);r.outCoastQuint=b(a(4),0);r.inOutCoastQuint=b(a(4),.5);r.named={linear:f,"in-quad":r.inQuad,"out-quad":r.outQuad,"in-out-quad":r.inOutQuad,"in-cubic":r.inCubic,"out-cubic":r.outCubic,"in-out-cubic":r.inOutCubic,
"in-quart":r.inQuart,"out-quart":r.outQuart,"in-out-quart":r.inOutQuart,"in-quint":r.inQuint,"out-quint":r.outQuint,"in-out-quint":r.inOutQuint,"in-sine":r.inSine,"out-sine":r.outSine,"in-out-sine":r.inOutSine,"in-expo":r.inExpo,"out-expo":r.outExpo,"in-out-expo":r.inOutExpo,"in-circ":r.inCirc,"out-circ":r.outCirc,"in-out-circ":r.inOutCirc}})},"esri/geometry/ScreenPoint":function(){define(["./Point"],function(B){return B.createSubclass({declaredClass:"esri.geometry.ScreenPoint",verifySR:function(){}})})},
"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./Lighting".split(" "),function(B,r,f,a,b,c,t){return function(b){function h(a){a=b.call(this,a)||this;a.lighting=new t;return a}f(h,b);l=h;h.prototype.clone=function(){return new l({lighting:t.prototype.clone.call(this.lighting)})};h.sanitizeJSON=function(a){return{lighting:a.lighting?t.sanitizeJSON(a.lighting):
(new t).toJSON()}};a([c.property({type:t,json:{write:!0}})],h.prototype,"lighting",void 0);return h=l=a([c.subclass("esri.webscene.Environment")],h);var l}(c.declared(b))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(B,r,f,a,b,c){return function(b){function p(a){a=b.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=
null;return a}f(p,b);h=p;p.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};p.prototype.writeDate=function(a,b){null!=a&&(b.datetime=a.getTime())};p.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};p.prototype.writedirectShadowsEnabled=function(a,b){a&&(b.directShadows=!0)};p.prototype.writeDisplayUTCOffset=function(a,b){null!=a&&(b.displayUTCOffset=a)};p.prototype.clone=function(){return new h({date:null!=this.date?new Date(this.date.getTime()):
null,directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null})};p.sanitizeJSON=function(a){var b={datetime:a.datetime};void 0!==a.directShadows&&(b.directShadows=!!a.directShadows);void 0!==a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);return b};a([c.property({type:Date})],p.prototype,"date",void 0);a([c.reader("date",["datetime"])],p.prototype,"readDate",null);a([c.writer("date")],p.prototype,"writeDate",null);a([c.property({type:Boolean})],
p.prototype,"directShadowsEnabled",void 0);a([c.reader("directShadowsEnabled",["directShadows"])],p.prototype,"readDirectShadowsEnabled",null);a([c.writer("directShadowsEnabled")],p.prototype,"writedirectShadowsEnabled",null);a([c.property({type:Number,json:{write:!0}})],p.prototype,"displayUTCOffset",void 0);a([c.writer("displayUTCOffset")],p.prototype,"writeDisplayUTCOffset",null);return p=h=a([c.subclass("esri.webscene.Lighting")],p);var h}(c.declared(b))})},"esri/views/support/screenshotUtils":function(){define(["require",
"exports","dojo/_base/lang"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});r.adjustScreenshotSettings=function(a,b){a=f.mixin({format:"png",quality:100},a||{});var c,t;a.includePadding?(c=b.width,t=b.height):(c=b.width-b.padding.left-b.padding.right,t=b.height-b.padding.top-b.padding.bottom);var p=c/t;void 0!==a.width&&void 0===a.height?a.height=a.width/p:void 0!==a.height&&void 0===a.width&&(a.width=p*a.height);void 0!==a.height&&(a.height=Math.floor(a.height));void 0!==a.width&&
(a.width=Math.floor(a.width));a.area||a.includePadding||(a.area={x:b.padding.left,y:b.padding.top,width:c,height:t});return a};r.resampleHermite=function(a,b,c,f,p,h,l){void 0===l&&(l=!0);var q=b/p;c/=h;for(var t=Math.ceil(q/2),z=Math.ceil(c/2),w=0;w<h;w++)for(var u=0;u<p;u++){for(var C=4*(u+(l?h-w-1:w)*p),E=0,G=0,n=0,A=0,x=0,I=0,K=0,J=(w+.5)*c,r=Math.floor(w*c);r<(w+1)*c;r++)for(var M=Math.abs(J-(r+.5))/z,Q=(u+.5)*q,M=M*M,S=Math.floor(u*q);S<(u+1)*q;S++){var P=Math.abs(Q-(S+.5))/t,E=Math.sqrt(M+
P*P);-1<=E&&1>=E&&(E=2*E*E*E-3*E*E+1,0<E&&(P=4*(S+r*b),K+=E*a[P+3],n+=E,255>a[P+3]&&(E=E*a[P+3]/250),A+=E*a[P],x+=E*a[P+1],I+=E*a[P+2],G+=E))}f[C]=A/G;f[C+1]=x/G;f[C+2]=I/G;f[C+3]=K/n}}})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/Error","../../core/sniff"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});r.check=function(){var b=null;a("esri-webgl")?a("esri-webgl-major-performance-caveat")?b=new f("webgl:major-performance-caveat-detected",
"Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check if your GPU is blacklisted."):a("esri-webgl-high-precision-fragment")?a("esri-webgl-vertex-shader-samplers")?a("esri-webgl-element-index-uint")||(b=new f("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.")):b=new f("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):b=new f("webgl:high-precision-fragment-required",
"WebGL support for high precision fragment shaders is required but not supported."):b=new f("webgl:required","WebGL is required but not supported.");return b}})},"esri/views/3d/environment/SceneViewEnvironment":function(){define(["dojo/_base/lang","../../../webscene/Environment","../../../webscene/Lighting","./SceneViewLighting","./SceneViewAtmosphere"],function(B,r,f,a,b){var c=r.createSubclass({declaredClass:"esri.views.3d.environment.SceneViewEnvironment",properties:{atmosphere:{type:b,json:{read:!1}},
atmosphereEnabled:{value:!0,json:{read:!1}},starsEnabled:{value:!0,json:{read:!1}},lighting:{set:function(b){if(b)if(this.lighting)null!=b.date&&(this.lighting.date=b.date),null!=b.defaultDate&&(this.lighting.defaultDate=b.defaultDate),null!=b.displayUTCOffset&&(this.lighting.displayUTCOffset=b.displayUTCOffset),this.lighting.directShadowsEnabled=b.directShadowsEnabled,null!=b.ambientOcclusionEnabled&&(this.lighting.ambientOcclusionEnabled=b.ambientOcclusionEnabled),null!=b.cameraTrackingEnabled&&
(this.lighting.cameraTrackingEnabled=b.cameraTrackingEnabled);else if(b instanceof a)this._set("lighting",b);else if(b instanceof f){var c={directShadowsEnabled:b.directShadowsEnabled};null!=b.date&&(c.date=b.date);null!=b.displayUTCOffset&&(c.displayUTCOffset=b.displayUTCOffset);null!=b.defaultDate&&(c.defaultDate=b.defaultDate);this._set("lighting",new a(c))}else this._set("lighting",new a(b));else this.lighting||this._set("lighting",new a)}}},getDefaults:function(){return B.mixin(this.inherited(arguments),
{atmosphere:{}})},atmosphere:null,atmosphereEnabled:!0,starsEnabled:!0,clone:function(){return new c({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled})}});return c})},"esri/views/3d/environment/SceneViewLighting":function(){define(["../../../core/Evented","../../../webscene/Lighting"],function(B,r){var f=new Date,a={target:null,date:null},b={target:null,timezoneOffset:0};return r.createSubclass([B],{declaredClass:"esri.views.3d.environment.SceneViewLighting",
properties:{cameraTrackingEnabled:{value:!0},ambientOcclusionEnabled:{value:!1},defaultDate:{get:function(){return new Date(this._get("defaultDate"))},set:function(a){var b=this._get("date")===this._get("defaultDate");a=new Date(a);this._set("defaultDate",a);b&&this._set("date",a)}},date:{cast:function(a){return a},set:function(a){null!=a&&(this._set("date",new Date(a)),this.positionTimezoneInfo.autoUpdated=!1,this._emitDateWillChange())}}},constructor:function(){this.positionTimezoneInfo={hours:0,
minutes:0,seconds:0,autoUpdated:!0};this._autoUpdateDate=null;var a=(new Date).getFullYear(),a=new Date("March 15, "+a+" 12:00:00 UTC");this._set("defaultDate",a);this._set("date",a)},autoUpdate:function(a,f){var c=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=f.hours;this.positionTimezoneInfo.minutes=f.minutes;this.positionTimezoneInfo.seconds=f.seconds;if(null!=a){this.positionTimezoneInfo.autoUpdated=!0;var h=this.date&&this.date.getTime();this._set("date",
new Date(a));this._emitDateWillChange()}f=this._calculateTimezoneOffset(this.positionTimezoneInfo);c!==f&&(b.target=this,b.timezoneOffset=f,this.emit("timezone-will-change",b));if(null!=a)return h!==a.getTime()},_calculateTimezoneOffset:function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)},_emitDateWillChange:function(){a.target=this;f.setTime(this._get("date").getTime());a.date=f;this.emit("date-will-change",a)}})})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define(["../../../core/Accessor"],
function(B){return B.createSubclass({properties:{quality:{}},quality:"low",_qualitySetter:function(r){-1!==["low","high"].indexOf(r)&&this._set("quality",r)},clone:function(){return new this.constructor({quality:this.quality})}})})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("../../../core/declare ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/watchUtils ../../../core/HandleRegistry ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../../geometry/SpatialReference ../support/sunUtils ../support/earthUtils ./EnvironmentRenderer ../webgl-engine/lighting/Lightsources ../lib/glMatrix".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w){var u=w.vec3d,C=new Date,E={hours:0,minutes:0,seconds:0},G=[.5773502691896258,-.5773502691896258,.5773502691896258],n=u.createFrom(.22,.22,.33),A=u.createFrom(.22,.22,.22);B=B([r,f],{declaredClass:"esri.views.3d.environment.SceneViewEnvironmentManager",referencePointUpdateDelay:200,referencePointUpdateInterval:3E3,referencePointUpdateDistThreshold:1E6,properties:{updating:{dependsOn:["noReferencePositionQueries"],readOnly:!0,get:function(){return!this.noReferencePositionQueries&&
(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)}},noReferencePositionQueries:{},view:{},_environmentRenderer:{}},constructor:function(){this._viewHandles=new c;this._environmentRenderer=null;this._viewConnected=this._trackingEnabled=this._preserveAbsoluteDateTime=!1;this._referencePosResetPreserveAbsoluteTime=null;this._resetReferencePosition()},destroy:function(){this._viewHandles.destroy();this.disposeRendering()},disposeRendering:function(){this._environmentRenderer&&
(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)},updateReadyChange:function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))},connectView:function(a){this._environmentRenderer=new y({view:a});this._viewHandles.add([b.on(this.view,"environment.lighting","date-will-change",this._lightingDateHandler.bind(this)),this.view.watch("interacting,stationary",
this._interactingStationaryHandler.bind(this)),this.view.watch("environment.lighting.directShadowsEnabled,environment.lighting.ambientOcclusionEnabled",this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),b.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),b.init(this.view,"environment.lighting.cameraTrackingEnabled",this._updateCameraTracking.bind(this),!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,
null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()},_updateCameraTracking:function(a){if(this._trackingEnabled=a)a=b.on(this,"view.navigation","currentViewChanged",this._cameraHandler.bind(this,null),this._cameraHandler.bind(this,null),null,!0),this._viewHandles.add(a,"camera");else{if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=!1;this._viewHandles.remove("camera")}},disconnectView:function(a){this.disposeRendering();this._viewHandles.removeAll()},
_lightingDateHandler:function(a){if(a=a.date){var b=this.view.environment.lighting;if(!b.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var c=this.view.spatialReference;if(!(c.isWGS84||c.isWebMercator||(c=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(c)))){this._requestReferencePositionUpdate(c);return}this._preupdateTracking(a);this._referencePosWGS84&&(c=q.positionToTimezone(this._referencePosWGS84,E),b.autoUpdate(null,c),this._trackingEnabled&&
(b.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(a)}},_preupdateTracking:function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)},_cameraHandler:function(a){var b=this.view.camera;if(b){var c=this.view.spatialReference;c.isWGS84||c.isWebMercator?this._cameraHandlerGlobal(b,a):this._cameraHandlerLocal(b,a)}},_cameraHandlerGlobal:function(a,b){a=a.position;this._referencePosWGS84||(this._referencePosWGS84=new t({spatialReference:h.WGS84}));
a.spatialReference.isWebMercator?p.webMercatorToGeographic(a,!1,this._referencePosWGS84):(this._referencePosWGS84.x=a.x,this._referencePosWGS84.y=a.y);this._referencePosWGS84.z=a.z;this._autoUpdateTimezone(a,b)||this._updateLightParams(b)},_cameraHandlerLocal:function(a,b){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&(this._referencePosWGS84.z=
a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())},_interactingStationaryHandler:function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()},_mainLight:new z.MainLight,_ambientLight:new z.AmbientLight,_moonLight:new z.FillLight,_updateLightParams:function(a){var b=this.view.environment.lighting;a=a||b.date;var b=this.view._stage,c;this._referencePosWGS84?(c=l.computeColorAndIntensity(a,this._referencePosWGS84),l.computeDirection(a,
this._referencePosWGS84,this.view.viewingMode,c.diffuse.direction)):c={diffuse:{color:[1,1,1],intensity:.55,direction:G},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};u.scale(c.diffuse.color,c.diffuse.intensity*Math.PI,this._mainLight.intensity);u.negate(c.diffuse.direction,this._mainLight.direction);u.scale(c.ambient.color,c.ambient.intensity,this._ambientLight.intensity);u.lerp(n,A,c.globalFactor,this._moonLight.intensity);u.scale(this._moonLight.intensity,(1-.5*c.globalFactor)*
(1-.4*c.noonFactor*(1-c.globalFactor)));u.set(c.diffuse.direction,this._moonLight.direction);b.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:c.globalFactor,groundLightingFactor:1-c.noonFactor});this._updateRenderParamsHandler()},_autoUpdateTimezone:function(a,b){if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;C.setTime((b||this.view.environment.lighting.date).getTime());a=q.positionToTimezone(a,E);var c=this.view.environment.lighting.positionTimezoneInfo;
if(!c.autoUpdated)c=a;else if(c.hours===a.hours&&c.minutes===a.minutes&&c.seconds===a.seconds)return!1;var n=C.getUTCHours()-(a.hours-c.hours),h=C.getUTCMinutes()-(a.minutes-c.minutes),c=C.getUTCSeconds()-(a.seconds-c.seconds);C.setUTCHours(n);C.setUTCMinutes(h);C.setUTCSeconds(c);return b?!1:this.view.environment.lighting.autoUpdate(C,a)},_updateRenderParamsHandler:function(){var a=this.view._stage,b=!0;this._referencePosWGS84&&(b=l.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));
a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&b,ssao:this.view.environment.lighting.ambientOcclusionEnabled})},_spatialReferenceHandler:function(){this._resetReferencePosition()},_viewingModeHandler:function(a){this._resetReferencePosition()},_resetReferencePosition:function(a){this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")},
_requestReferencePositionUpdate:function(b,c){if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(b):this._referencePosMapCoordsRequested=b.clone(),this._referencePosResetPreserveAbsoluteTime=!!c,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var n=this,h=this._referencePosUpdateQuery=a.after(this.referencePointUpdateDelay).then(function(){if(n._referencePosUpdateQuery===
h)return n._doReferencePositionUpdateQuery(function(){return n._referencePosUpdateQuery!==h})}).always(function(){n._referencePosUpdateQuery===h&&(n._referencePosUpdateQuery=null,n._referencePosUpdateTimer||n._executePendingReferencePositionUpdate(),n.notifyChange("updating"))}),l=this._referencePosUpdateTimer=a.after(this.referencePointUpdateInterval).then(function(){n._referencePosUpdateTimer===l&&(n._referencePosUpdateTimer=null,n._referencePosUpdateQuery||n._executePendingReferencePositionUpdate())});
this.notifyChange("updating")}},_doReferencePositionUpdateQuery:function(a){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(b){if(!a()&&
!isNaN(b[0])&&!isNaN(b[1])){var c=this._referencePosMapCoords.z*this.view.mapCoordsHelper.unitInMeters;this._referencePosWGS84?(this._referencePosWGS84.x=b[0],this._referencePosWGS84.y=b[1],this._referencePosWGS84.z=c):this._referencePosWGS84=new t({x:b[0],y:b[1],z:c,spatialReference:h.WGS84});this._referencePosChanged()}}.bind(this))},_executePendingReferencePositionUpdate:function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)},
_referencePosChanged:function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()},_exceedsReferencePosDistThreshold:function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0},_cancelReferencePosUpdates:function(){this._referencePosUpdateTimer=this._referencePosUpdateQuery=
null}});B.FIXED_LIGHT_DIRECTION=G;return B})},"esri/views/3d/support/sunUtils":function(){define(["./mathUtils","../lib/glMatrix","../lib/SunCalc"],function(B,r,f){var a=r.vec3d,b=r.mat4d,c=B.lerp,t=b.identity(),p={azimuth:0,altitude:0},h={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:Math.PI/3,altitude:Math.PI/
3}}},l={ambient:{color:a.create(),intensity:0},diffuse:{color:a.create(),intensity:0,direction:a.create()}},q={settings:h,computeDirection:function(c,h,l,C){C||(C=a.create());var u=b.identity(t);if("global"===l)f.getPosition(c,0,0,p),a.set3(0,0,-1,C),b.rotateX(u,-p.azimuth),b.rotateY(u,-p.altitude);else{var w=q.settings.planarDirection;l=w.globalAngles;w=(h.z-w.localAltitude)/(w.globalAltitude-w.localAltitude);w=B.clamp(w,0,1);1>w?(f.getPosition(c,h.y,h.x,p),p.azimuth=(1-w)*p.azimuth+w*l.azimuth,
p.altitude=(1-w)*p.altitude+w*l.altitude):(p.azimuth=l.azimuth,p.altitude=l.altitude);a.set3(0,-1,0,C);b.rotateZ(u,-p.azimuth);b.rotateX(u,-p.altitude)}b.multiplyVec3(u,C);return C},computeShadowsEnabled:function(a,b){return"global"===b?!0:a.z<q.settings.planarDirection.localAltitude},computeColorAndIntensity:function(b,p){var u,w,t,z=p.z;w=q.settings;a.set3(1,1,1,l.ambient.color);l.ambient.intensity=w.global.ambient;a.set3(1,1,1,l.diffuse.color);l.diffuse.intensity=w.global.diffuse;z=(z-w.local.altitude)/
(w.global.altitude-w.local.altitude);z=B.clamp(z,0,1);l.globalFactor=z;p=f.getTimes(b,p.y,p.x);if(1>z){w=b.valueOf();var n,A;p.polarException===f.POLAR_EXCEPTION.MIDNIGHT_SUN?(n=w-36E5*(b.getHours()+48)-6E4*b.getMinutes(),A=n+432E6):p.polarException===f.POLAR_EXCEPTION.POLAR_NIGHT?(n=w-2,A=w-1):(n=p.sunrise.valueOf(),A=p.sunset.valueOf());var x=A-n;t=n+x/2;var I=x/4;u=t-I;var I=t+I,K=.06*x,x=n-K/2;n+=K/2;var J=A-K/2,r=A+K/2;A=h.local;var M=[.01,A.ambientAtNight],Q=[.8,.8,1],S=[.01,.01,.01],P=[A.diffuseAtTwilight,
A.ambientAtTwilight],O=[1,.75,.75],T=[.8,.8,1],U=[.9*A.diffuseAtNoon,A.ambientAtNoon],W=[1,.98,.98],k=[.98,.98,1],ca=[A.diffuseAtNoon,A.ambientAtNoon],V=[1,1,1],e=[1,1,1];A=[0,0];var d=[0,0],K=[0,0];w<x||w>r?(A=M,d=S,K=Q):w<n?(K=n-x,A=y(w-x,K,M,P),d=y(w-x,K,S,O),K=y(w-x,K,Q,T)):w<u?(K=u-n,A=y(w-n,K,P,U),d=y(w-n,K,O,W),K=y(w-n,K,T,k)):w<t?(K=t-u,A=y(w-u,K,U,ca),d=y(w-u,K,W,V),K=y(w-u,K,k,e)):w<I?(K=I-t,A=y(w-t,K,ca,U),d=y(w-t,K,V,W),K=y(w-t,K,e,k)):w<J?(K=J-I,A=y(w-I,K,U,P),d=y(w-I,K,W,O),K=y(w-I,
K,k,T)):w<r&&(K=r-J,A=y(w-J,K,P,M),d=y(w-J,K,O,S),K=y(w-J,K,T,Q));w=A[0];t=d;u=A[1];a.lerp(K,l.ambient.color,z,l.ambient.color);l.ambient.intensity=c(u,l.ambient.intensity,z);a.lerp(t,l.diffuse.color,z,l.diffuse.color);l.diffuse.intensity=c(w,l.diffuse.intensity,z)}z=b.valueOf();p.polarException===f.POLAR_EXCEPTION.MIDNIGHT_SUN?(b=z-36E5*(b.getHours()+48)-6E4*b.getMinutes(),p=b+432E6):p.polarException===f.POLAR_EXCEPTION.POLAR_NIGHT?(b=z-2,p=z-1):(b=p.sunrise.valueOf(),p=p.sunset.valueOf());b=1-B.clamp(Math.abs(z-
(b+(p-b)/2))/432E5,0,1);l.noonFactor=b;return l}},y=function(a,b,c,h){for(var l=[],q=0;q<c.length;q++)l[q]=(h[q]-c[q])*a/b+c[q];return l};return q})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function B(a){return new Date(864E5*(a+.5-2440588))}function r(a,b){return u(q(a)*y(n)-z(b)*q(n),y(a))}function f(a,b){return w(q(b)*y(n)+y(b)*q(n)*q(a))}function a(a,b,c){return u(q(a),y(a)*q(b)-z(c)*y(b))}function b(a,b,c){return w(q(b)*q(c)+y(b)*y(c)*y(a))}function c(a){return E*(1.9148*
q(a)+.02*q(2*a)+3E-4*q(3*a))}function t(a,b){a=E*(357.5291+.98560028*a);var n=c(a);a=a+n+102.9372*E+l;b||(b={dec:0,ra:0});b.dec=f(a,0);b.ra=r(a,0);return b}function p(a,b,c){return 2451545+a+.0053*q(b)-.0069*q(2*c)}function h(a){var b=E*(134.963+13.064993*a),c=E*(93.272+13.22935*a);a=E*(218.316+13.176396*a)+6.289*E*q(b);c=5.128*E*q(c);b=385001-20905*y(b);return{ra:r(a,c),dec:f(a,c),dist:b}}var l=Math.PI,q=Math.sin,y=Math.cos,z=Math.tan,w=Math.asin,u=Math.atan2,C=Math.acos,E=l/180,G={dec:0,ra:0},n=
23.4397*E,A={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(c,n,h,l){h=E*-h;n*=E;var q=c.valueOf()/864E5-.5+2440588-2451545;c=t(q,G);h=E*(280.16+360.9856235*q)-h-c.ra;l||(l={azimuth:0,altitude:0});l.azimuth=a(h,n,c.dec);l.altitude=b(h,n,c.dec);return l}},x=[[-.83,"sunrise","sunset"]];A.addTime=function(a,b,c){x.push([a,b,c])};A.getTimes=function(a,b,n){function h(a){var e=w,d=J;a=C((q(a)-q(e)*q(d))/(y(e)*y(d)));return p(9E-4+(a+u)/(2*l)+t,z,I)}var u=E*-n,w=E*b,t=Math.round(a.valueOf()/
864E5-.5+2440588-2451545-9E-4-u/(2*l));a=9E-4+(0+u)/(2*l)+t;var z=E*(357.5291+.98560028*a);b=c(z);var I=z+b+102.9372*E+l,J=f(I,0);a=p(a,z,I);b={solarNoon:B(a),nadir:B(a-.5),polarException:A.POLAR_EXCEPTION.NORMAL};var K,G,k,r;n=0;for(K=x.length;n<K;n+=1)G=x[n],k=h(G[0]*E),r=a-(k-a),b[G[1]]=B(r),b[G[2]]=B(k);b.polarException=function(a){a=(q(a)-q(w)*q(J))/(y(w)*y(J));return-1>a?A.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?A.POLAR_EXCEPTION.POLAR_NIGHT:A.POLAR_EXCEPTION.NORMAL}(x[0][0]*E);return b};A.getMoonPosition=
function(c,n,l){l=E*-l;n*=E;var q=c.valueOf()/864E5-.5+2440588-2451545;c=h(q);l=E*(280.16+360.9856235*q)-l-c.ra;q=b(l,n,c.dec);q+=.017*E/z(q+10.26*E/(q+5.1*E));return{azimuth:a(l,n,c.dec),altitude:q,distance:c.dist}};A.getMoonFraction=function(a){var b=a.valueOf()/864E5-.5+2440588-2451545;a=t(b);b=h(b);a=C(q(a.dec)*q(b.dec)+y(a.dec)*y(b.dec)*y(a.ra-b.ra));a=u(149598E3*q(a),b.dist-149598E3*y(a));return(1+y(a))/2};return A})},"esri/views/3d/support/earthUtils":function(){define(["dojo/_base/lang","./mathUtils",
"../../../geometry/Point","../../../geometry/SpatialReference","../../../geometry/support/webMercatorUtils"],function(B,r,f,a,b){var c=6378137*Math.PI,t=new f(0,0,a.WGS84),p={earthRadius:6378137,halfEarthCircumference:c,earthCircumference:2*c,metersPerDegree:c/180,getGreatCircleDistance:function(a,b,c,f){void 0===c&&void 0===f&&B.isObject(a)&&B.isObject(b)&&(c=b.get("longitude"),f=b.get("latitude"),b=a.get("latitude"),a=a.get("longitude"));b=r.deg2rad(b);f=r.deg2rad(f);a=r.deg2rad(a);var h=r.deg2rad(c);
c=Math.sin((b-f)/2);a=Math.sin((a-h)/2);b=12756274*r.asin(Math.sqrt(c*c+Math.cos(b)*Math.cos(f)*a*a));return b=Math.round(1E4*b)/1E4},getGreatCircleSpanAt:function(a,b,c){var h=b.spatialReference,l=new f(b.x,a.y,h),q=new f(c.x,a.y,h);b=new f(a.x,b.y,h);a=new f(a.x,c.y,h);return{lon:this.getGreatCircleDistance(l,q),lat:this.getGreatCircleDistance(b,a)}},getLonDeltaForDistance:function(a,b,c){a=c/6378137;b=r.deg2rad(b);a=Math.sin(a/2);b=Math.cos(b);b=2*r.asin(Math.sqrt(a*a/(b*b)));return r.rad2deg(b)},
getLatDeltaForDistance:function(a,b,c){return r.rad2deg(c/6378137)},getLatLonDeltaForDistance:function(a,b,c){return{lat:this.getLatDeltaForDistance(a,b,c),lon:this.getLonDeltaForDistance(a,b,c)}},getMaxCameraAltitude:function(a){a=r.deg2rad(a/2);return 6378137*(1-Math.sin(a))/Math.sin(a)},getViewExtentDistance:function(a,b){b=r.deg2rad(b/2);return 12756274*r.acos((Math.pow(a+6378137,2)+Math.pow(6378137,2)-Math.pow((a+6378137)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+6378137),2)-a*a-12756274*
a),2))/(12756274*(a+6378137)))},computeCarthesianDistance:function(a,b){function c(a){var b=r.deg2rad(a.get("latitude")),c=r.deg2rad(a.get("longitude")),h=Math.cos(b);a=6378137+(a.z||0);return[Math.cos(c)*h*a,Math.sin(b)*a,-Math.sin(c)*h*a]}a=c(a);b=c(b);b=[b[0]-a[0],b[1]-a[1],b[2]-a[2]];return Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])},longitudeToTimezone:function(a,b){a/=15;b||(a=Math.round(a));return a},positionToTimezone:function(c,l){c.spatialReference.wkid!==a.WGS84.wkid?b.webMercatorToGeographic(c,
!1,t):(t.x=c.x,t.y=c.y);t.z=c.z;l||(l={hours:0,minutes:0,seconds:0});l.hours=p.longitudeToTimezone(t.x,!0);c=l.hours%1;l.hours-=c;l.minutes=60*c;c=l.minutes%1;l.minutes-=c;l.seconds=Math.round(60*c);return l}};return p})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("../../../core/watchUtils ../support/ExternalRenderer ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars ../webgl-engine/lib/RenderSlot".split(" "),function(B,r,f,a,b,c,t){return r.createSubclass({declaredClass:"esri.views.3d.environment.EnvironmentRenderer",
properties:{view:{},viewingMode:{dependsOn:["view.viewingMode"],get:function(){return this.get("view.viewingMode")||"global"}},atmosphereQuality:{dependsOn:["view.environment.atmosphereEnabled","view.environment.atmosphere.quality"],get:function(){return this.get("view.environment.atmosphereEnabled")?this.get("view.environment.atmosphere.quality")||"none":"none"}},starsEnabled:{dependsOn:["view.environment.starsEnabled"],get:function(){return this.get("view.environment.starsEnabled")||!1}},transparent:{dependsOn:["view.basemapTerrain.opacity",
"view.basemapTerrain.wireframe"],get:function(){var a=this.get("view.basemapTerrain");return a&&a._renderer.isTransparent()}},_atmosphere:{},_stars:{},needsRender:{dependsOn:["_stars.needsRender","_atmosphere.needsRender"],get:function(){return!!(this._needsRender||this._atmosphere&&this._atmosphere.needsRender||this._stars&&this._stars.needsRender)}}},constructor:function(){this._STANDARD_SLOT=t.BACKGROUND;this._SPECIAL_SLOT=t.POSTPROCESSING_ATMOSPHERE;this._slots=[this._STANDARD_SLOT,this._SPECIAL_SLOT];
this._stars=this._atmosphere=this._atmosphereReadyPromise=this._AtmosphereClass=null;this._needsRender=!0;this.notifyChange("needsRender")},initialize:function(){this.view._stage.addExternalRenderer(this._slots,this);this._basemapTerrainHandle=B.when(this.view,"basemapTerrain",this._updateBasemapTerrain.bind(this))},destroy:function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._basemapTerrainHandle&&this._basemapTerrainHandle.remove();
this.view&&(this.view._stage.removeExternalRenderer(this),this.view=null)},setup:function(a){this.watch("viewingMode,atmosphereQuality,transparent,visible",this._updateAtmosphere.bind(this));this._updateAtmosphere();this.watch("starsEnabled,transparent,visible",this._updateStars.bind(this));this._updateStars();this.watch("view.basemapTerrain.loaded",function(){this._needsRender=!0;this.notifyChange("needsRender")}.bind(this))},resetNeedsRender:function(){this._atmosphere&&(this._atmosphere.resetNeedsRender?
this._atmosphere.resetNeedsRender():this._atmosphere.didRender&&(this._atmosphere.needsRender=!1,this._atmosphere.didRender=!1));this._stars&&(this._stars.resetNeedsRender?this._stars.resetNeedsRender():this._stars.didRender&&(this._stars.needsRender=!1,this._stars.didRender=!1));this.didRender&&(this.didRender=this._needsRender=!1,this.notifyChange("needsRender"))},render:function(a){if(!this.get("view.basemapTerrain.loaded")&&"global"===this.viewingMode)return!1;if(!this._stars&&!this._atmosphere)return!0;
this._stars&&this._stars.render(a);this._atmosphere&&this._atmosphere.render(a);return this._stars&&this._stars.didRender||this._atmosphere&&this._atmosphere.didRender},_updateStars:function(){var a=this._getAtmosphereSlot();this.starsEnabled&&!this._stars?(this._stars=new c({view:this.view,slot:a}),this._stars.initializeRenderContext(this.renderContext)):!this.starsEnabled&&this._stars?(this._stars.destroy(),this._stars=null):this._stars&&(this._stars.slot=a);this._needsRender=!0;this.notifyChange("needsRender")},
_updateAtmosphere:function(){var a=this._getAtmosphereSlot();this._atmosphere&&(this._atmosphere.slot=a);if(this._updateAtmosphereClass(this.renderContext)){this._needsRender=!0;this.notifyChange("needsRender");var b=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null)}.bind(this);if(this._AtmosphereClass){this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null);var c=new this._AtmosphereClass({view:this.view,slot:a});c.initializeRenderContext(this.renderContext);
this._atmosphere?this._atmosphereReadyPromise=c.then(function(){b();this._atmosphereReadyPromise=null;this._atmosphere=c}.bind(this)):this._atmosphere=c;c.then(function(){this._updateBasemapTerrain()}.bind(this))}else b(),this._updateBasemapTerrain()}},_updateAtmosphereClass:function(c){var h=this._AtmosphereClass;"none"===this.atmosphereQuality?this._AtmosphereClass=null:"high"===this.atmosphereQuality&&!this.transparent&&a.isSupported(c)?this._AtmosphereClass="local"===this.viewingMode?f:a:this._AtmosphereClass=
"local"===this.viewingMode?f:b;return this._AtmosphereClass!==h},_getAtmosphereSlot:function(){return this.transparent&&"global"===this.viewingMode?this._SPECIAL_SLOT:this._STANDARD_SLOT},_updateBasemapTerrain:function(){var b=this.get("view.basemapTerrain");b&&(b.velvetOverground=!(!this._AtmosphereClass||this._AtmosphereClass===a))}})})},"esri/views/3d/support/ExternalRenderer":function(){define("../../../core/declare ../../../core/Accessor ../../../core/Promise dojo/Deferred dojo/aspect dojo/_base/lang".split(" "),
function(B,r,f,a,b,c){return B([r,f],{"-chains-":c.mixin(r._meta.chains,{setup:"after",initializeRenderContext:"after",uninitializeRenderContext:"before"}),properties:{gl:{readOnly:!0,get:function(){return this._gl}},needsRender:{value:!0},visible:{value:!0}},constructor:function(){this.didRender=!1;this.renderContext=null;this.watch("visible",function(){this.needsRender=!0}.bind(this));this._contextDfd=new a},initialize:function(){this.addResolvingPromise(this._contextDfd.promise);b.around(this,
"render",function(a){return function(){return this.isRejected()?this.didRender=!0:this.isResolved()?!this.visible||a.apply(this,arguments)?this.didRender=!0:!1:!1}.bind(this)}.bind(this));this.then(function(){this.destroyed||this.setup(this.renderContext)}.bind(this))},needsRender:!0,visible:!0,initializeRenderContext:function(a){this.renderContext=a;this._contextDfd.resolve()},uninitializeRenderContext:function(a){},setup:function(a){},render:function(a){return!1}})})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u){var C=a.vec2d,E=a.vec3d,G=a.mat4d,n=p.VertexAttrConstants,A=G.create();return f.createSubclass({declaredClass:"esri.views.3d.environment.PanoramicAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:q.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={texV:C.create(),silCircleCenter:E.create(),silCircleV1:E.create(),silCircleV2:E.create()};this._textureRep=this._texture=null;this.slot=
q.BACKGROUND},initialize:function(){this._textureDfd=new r;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),this._textureDfd=null)},initializeRenderContext:function(a){this._textureRep=new h({SimpleAtmosphere:new t(y,
"SimpleAtmosphere",{wrapClamp:!0})},a.programRep,function(){return this.view._stage.getCamera().viewport}.bind(this),a.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,void 0,function(a){this._texture=a.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(a){var c=this._createGeometryData(),n=this.renderContext.rctx;this._renderer=new b(c,w.Pos3,null,n);a.shaderSnippets.vsSimpleAtmosphere||a.shaderSnippets._parse(B);this._program=new z(n,
a.shaderSnippets.vsSimpleAtmosphere,a.shaderSnippets.fsSimpleAtmosphere,u.Default3D,["PANORAMIC"])},render:function(a){if(a.slot!==this.slot||a.pass!==l.MATERIAL||!this._textureRep.getIsLoaded("SimpleAtmosphere"))return!1;var b=this.renderContext.rctx,c=b.gl,n=this._program;b.bindProgram(n);b.bindTexture(this._texture);n.setUniform1i("tex",0);n.setUniformMatrix4fv("proj",a.camera.projectionMatrix);G.toRotationMat(a.camera.viewMatrix,A);n.setUniformMatrix4fv("view",A);n.setUniform4f("color",1,1,1,
1);n.setUniform3fv("lightDirection",a.lightingData.direction);b.setFaceCullingEnabled(!0);b.setDepthFunction(c.LEQUAL);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);this._renderer.render(this._program);b.setDepthWriteEnabled(!0);b.setBlendingEnabled(!1);b.setDepthFunction(c.LESS);b.setFaceCullingEnabled(!1);return!0},_createGeometryData:function(){for(var a=c.createPolySphereGeometry(1,2),b=a.getFaces(),h=b[0].indices[n.POSITION],l=0;l<h.length;l+=3){var q=h[l];h[l]=h[l+2];h[l+2]=q}a=a.getVertexAttr();
h=a[n.NORMAL].data;for(l=0;l<h.length;l++)h[l]=-h[l];return{faces:b[0],vertexAttr:a}}})})},"esri/views/3d/webgl-engine/lib/GeometryRenderer":function(){define("require exports ../materials/internal/MaterialUtil ./DefaultVertexAttributeLocations ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/enums".split(" "),function(B,r,f,a,b,c,t,p){return function(){function h(h,q,p,z){this._drawMode=4;this._layout=q;var l=h.faces;this._count=l.indices[l.positionKey].length;
l=new Float32Array(this._count*t.getStride(q)/4);p?p(h,void 0,void 0,null,q,l,0):f.fillInterleaved(h,void 0,void 0,null,q,l,0);this._rctx=z;this._vao=new b(z,a.Default3D,{geometry:q},{geometry:c.createVertex(z,35044,l)})}h.prototype.enablePointRendering=function(a){this._drawMode=a?0:4};h.prototype.render=function(a){var b=this._rctx;b.bindVAO(this._vao);t.assertCompatibleVertexAttributeLocations(this._vao,a);b.drawArrays(this._drawMode,0,this._count)};return h}()})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../lib/IdGen ../../lib/gl-matrix ../../lib/ComponentUtils ../../lib/Util ../../parts/Model ../../lib/screenSizePerspectiveUtils ../../../../webgl/Util ../../../support/aaBoundingBox".split(" "),
function(B,r,f,a,b,c,t,p,h,l){function q(a,b,c,n,h,e){if(void 0===h||3!==e)for(h=0;h<e;++h)c[n+h]=a[b+h];else{var d=a[b],g=a[b+1];a=a[b+2];c[n]=h[0]*d+h[4]*g+h[8]*a+h[12];c[n+1]=h[1]*d+h[5]*g+h[9]*a+h[13];c[n+2]=h[2]*d+h[6]*g+h[10]*a+h[14]}return e}function y(a,b,c,n,h,e){for(var d=a.length,g=0;g<d;++g){for(var k=c*a[g],l=0;l<c;++l)n[h+l]=b[k+l];h+=e}}function z(a,b,c,n,h,e){n=new Uint8Array(n.buffer);h*=4;e*=4;var d=a.length;if(4===c)for(c=0;c<d;++c){var g=4*a[c];n[h]=b[g];n[h+1]=b[g+1];n[h+2]=b[g+
2];n[h+3]=b[g+3];h+=e}else if(3===c)for(c=0;c<d;++c)g=3*a[c],n[h]=b[g],n[h+1]=b[g+1],n[h+2]=b[g+2],n[h+3]=255,h+=e}function w(a,b,c,n,h){var e=C(b,c,N);l.setMin(K,a.getBBMin());l.setMax(K,a.getBBMax());if(E(K,b,e,n)){var e=a.getPrimitiveIndices(),d=a.getIndices(),g=a.getPosition(),k=e?e.length:d.length/3;if(1E4<k&&(a=a.getChildren(),void 0!==a)){for(e=0;8>e;++e)void 0!==a[e]&&w(a[e],b,c,n,h);return}u(b,c,0,k,d,g,e,h)}}function u(b,c,k,n,h,e,d,g){var m=e.data;e=e.size;var l=b[0],q=b[1];b=b[2];var u=
c[0]-l,f=c[1]-q;for(c=c[2]-b;k<n;k++){var A=d?d[k]:k,p=e*h[3*A],x=e*h[3*A+1],w=e*h[3*A+2],t=m[p],C=m[p+1],y=m[p+2],p=m[x]-t,z=m[x+1]-C,x=m[x+2]-y,E=m[w]-t,I=m[w+1]-C,w=m[w+2]-y,J=f*w-I*c,K=c*E-w*u,G=u*I-E*f,r=p*J+z*K+x*G,t=l-t,N=q-C,U=b-y,C=N*x-z*U,y=U*p-x*t,W=t*z-p*N;if(r>M){J=t*J+N*K+U*G;if(0>J||J>r)continue;K=u*C+f*y+c*W;if(0>K||J+K>r)continue}else if(r<-M){J=t*J+N*K+U*G;if(0<J||J<r)continue;K=u*C+f*y+c*W;if(0<K||J+K<r)continue}else continue;r=(E*C+I*y+w*W)/r;0<=r&&(J=Q,a.vec3d.set3(p,z,x,S),a.vec3d.set3(E,
I,w,P),p=a.vec3d.normalize(a.vec3d.cross(S,P,J)),g(r,p,A))}}function C(b,c,k){return a.vec3d.set3(1/(c[0]-b[0]),1/(c[1]-b[1]),1/(c[2]-b[2]),k)}function E(a,b,c,n){var k=(a[0]-n-b[0])*c[0],e=(a[3]+n-b[0])*c[0],d=Math.min(k,e),k=Math.max(k,e),e=(a[1]-n-b[1])*c[1],g=(a[4]+n-b[1])*c[1],d=Math.max(d,Math.min(e,g)),k=Math.min(k,Math.max(e,g));if(d>k)return!1;e=(a[2]-n-b[2])*c[2];a=(a[5]+n-b[2])*c[2];d=Math.max(d,Math.min(e,a));k=Math.min(k,Math.max(e,a));return d<=k}function G(a,b,c,n){if(void 0!==a)return c.aquire(a,
b,n)}function n(a,b){void 0!==a&&b.release(a)}function A(a,b){b=b?A(b):{};for(var c in a){var n=a[c];n&&n.forEach&&(n=x(n));null==n&&c in b||(b[c]=n)}return b}function x(a){var b=[];a.forEach(function(a){return b.push(a)});return b}Object.defineProperty(r,"__esModule",{value:!0});var I=a.mat4d.create(),K=l.create(),J=c.VertexAttrConstants;r.__Material_idGen=new f;r.__GLMaterial_id=0;r.IDENTITY=a.mat4d.identity();r.fill=q;r.fillInterleaved=function(a,b,c,n,l,e,d,g){for(var k=h.getStride(l)/4,q=0;q<
l.length;q++){var u=l[q],f=d+u.offset/4,u=u.name,A=a.vertexAttr[u];if(null!=A&&(null==g||null!=g[u]))switch(u){case "uv0":y(a.faces.indices[u],A.data,A.size,e,f,k);break;case "region":for(var u=a.faces.indices[u],p=A.data,x=A.size,A=e,w=k,A=new Uint16Array(A.buffer),f=2*f,w=2*w,t=u.length,C=0;C<t;++C){for(var E=x*u[C],I=0;I<x;++I)A[f+I]=p[E+I];f+=w}break;case "color":if(n&&n.color)if(u=a.faces.indices[u],p=A.data,x=n.color,C=A.size,A=e,w=k,A=new Uint8Array(A.buffer),f*=4,w*=4,t=u.length,4===C)for(C=
0;C<t;++C)E=4*u[C],A[f]=p[E]*x[0],A[f+1]=p[E+1]*x[1],A[f+2]=p[E+2]*x[2],A[f+3]=p[E+3]*x[3],f+=w;else{if(3===C)for(I=255*x[3],C=0;C<t;++C)E=3*u[C],A[f]=p[E]*x[0],A[f+1]=p[E+1]*x[1],A[f+2]=p[E+2]*x[2],A[f+3]=I,f+=w}else z(a.faces.indices[u],A.data,A.size,e,f,k);break;case "symbolColor":z(a.faces.indices[u],A.data,A.size,e,f,k);break;default:if(x=u===J.POSITION?b:u===J.NORMAL?c:void 0,void 0!==x&&3===A.size)for(u=a.faces.indices[u],p=A.data,A=e,w=k,t=u.length,C=0;C<t;++C){var K=3*u[C],E=p[K],I=p[K+1],
K=p[K+2];A[f]=x[0]*E+x[4]*I+x[8]*K+x[12];A[f+1]=x[1]*E+x[5]*I+x[9]*K+x[13];A[f+2]=x[2]*E+x[6]*I+x[10]*K+x[14];f+=w}else y(a.faces.indices[u],A.data,A.size,e,f,k)}}};r.triangleVertexArrayToWireframeLines=function(a,b,c,n){for(c=Math.floor(c/3)-1;0<=c;c--){var k=b+3*c*n,e=b+6*c*n+5*n;q(a,k,a,e,null,n);e-=n;q(a,k+n,a,e,null,n);e-=n;q(a,k+n,a,e,null,n);e-=n;q(a,k+2*n,a,e,null,n);e-=n;q(a,k+2*n,a,e,null,n);e-=n;q(a,k,a,e,null,n)}};r.intersectTriangleGeometry=function(a,n,k,h,q,e,d){c.assert("triangle"===
a.data.primitiveType);n=n.componentVisibilities;h=h.tolerance;var g=a.getBoundingInfo(0);if(1<a.getComponentCount()){if(k=C(q,e,N),l.setMin(K,g.getBBMin()),l.setMax(K,g.getBBMax()),E(K,q,k,h))for(var g=a.getComponentCount(),m=a.data.faces[0],f=m.indices[m.positionKey],m=a.data.vertexAttributes[m.positionKey],A=a.data.componentOffsets,p=0;p<g;p++)if(b.getVisibility(n,p)){var x=a.getComponentAABB(p,K);E(x,q,k,h)&&u(q,e,A[p]/3,A[p+1]/3,f,m,void 0,d)}}else b.getVisibility(n,0)&&w(g,q,e,h,d)};var N=a.vec3d.create(),
M=Math.pow(2,-52),Q=a.vec3d.create(),S=a.vec3d.create(),P=a.vec3d.create();r.transformToWorld=function(b,c,k){return a.vec4d.set4(b[0]-c[0],b[1]-c[1],b[2]-c[2],1,k)};r.transformToView=function(b,c,k,n){a.mat4d.translate(k,c,I);k=I;return a.mat4d.multiplyVec4(k,b,n)};r.transformToProjection=function(b,c,k,n){n[0]=b[0]+k[0];n[1]=b[1]+k[1];n[2]=b[2]+k[2];n[3]=b[3];return a.mat4d.multiplyVec4(c,n)};r.transformToNDC=function(b,c){return a.vec4d.scale(b,1/Math.abs(b[3]),c)};r.applyScreenSizePerspectiveScale=
function(a,b,c,n,h){return p.scale(a,n,c,h)};r.verticalOffsetAtDistance=function(a,b,k,n,h){var e=k.screenLength||0;h&&(e=p.scale(e,n,b,h));return c.clamp(e*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,k.minWorldLength||0,null!=k.maxWorldLength?k.maxWorldLength:Infinity)};r.basicMaterialConstructor=function(a,b){var k=!0,n=0,h=r.__Material_idGen.gen(b);a.getId=function(){return h};var e;a.getParentStage=function(){return e};a.addParentStage=function(d){c.assert(void 0===e,"Material can only be added to a single Stage");
e=d};a.removeParentStage=function(d){e=void 0};a.setVisible=function(d){k!==d&&(k=d,a.notifyDirty("matChanged"))};a.isVisible=function(){return k};a.notifyDirty=function(d){e&&e.notifyDirty(t.ContentType.MATERIAL,a,d)};a.setRenderPriority=function(d){n=d;this.notifyDirty("matChanged")};a.getRenderPriority=function(){return n}};r.aquireIfNotUndefined=G;r.releaseIfNotUndefined=n;var O=a.mat4.create();r.bindView=function(b,c,k){a.mat4d.translate(c,b,O);k.setUniform3fv("localOrigin",b);k.setUniformMatrix4fv("view",
O)};r.bindCamPos=function(a,b,c){c.setUniform3f("camPos",b[3]-a[0],b[7]-a[1],b[11]-a[2])};r.bindVerticalOffset=function(a,b,c){if(a){var k=b.fovY;b=b.viewport[3];var n=void 0;void 0===n&&(n=T);n.screenLength=a.screenLength;n.perDistance=Math.tan(.5*k)/(.5*b);n.minWorldLength=a.minWorldLength;n.maxWorldLength=a.maxWorldLength;a=n;c.setUniform4f("verticalOffset",a.screenLength,a.perDistance,a.minWorldLength,a.maxWorldLength)}};r.bindScreenSizePerspective=function(a,b,c){void 0===c&&(c="screenSizePerspectiveAlignment");
if(a){var k=a.parameters;b.setUniform4f(c,k.divisor,k.offset,k.minPixelSize,a.paddingPixelsOverride)}};r.basicGLMaterialConstructor=function(a,b){var c=r.__GLMaterial_id++;a.getId=function(){return c};a.getMaterialId=function(){return b.getId()};a.isVisible=function(){return b.isVisible()};a.getRenderPriority=function(){return b.getRenderPriority()}};r.singleTextureGLMaterialConstructor=function(a,b,c,h){var k=G(c.textureId,c.initTexture,b,h);a.updateTexture=function(e){c.textureId!==e&&(n(c.textureId,
b),c.textureId=e,k=G(c.textureId,c.initTexture,b,h))};a.renderTexture=function(e){(e=b.getTexture(c.textureId))&&e.dirty&&e.redraw&&e.redraw()};a.bindTexture=function(e,d){void 0!==k&&(d.setUniform1i("tex",0),e.bindTexture(k.getGLTexture()))};a.bindTextureSize=function(e,d){void 0!==k&&(e=k.getGLTexture(),d.setUniform2f("texSize",e.descriptor.width,e.descriptor.height))};a.dispose=function(){n(c.textureId,b)}};r.multiTextureGLMaterialConstructor=function(a,b,c,h){for(var k=h.length,e=Array(k),d=0;d<
k;d++)e[d]=G(c[h[d][0]],c[h[d][1]],b);a.updateTextures=function(d){for(var a=0;a<k;a++){var g=c[h[a][0]],l=d[h[a][0]];g!==l&&(n(g,b),c[h[a][0]]=l,e[a]=G(l,c[h[a][1]],b))}};a.bindTextures=function(d,a){for(var b=0;b<k;b++)void 0!==e[b]&&(a.setUniform1i(h[b][2],b),d.bindTexture(e[b].getGLTexture(),b));d.setActiveTexture(0)};a.bindOneTexture=function(d,a,b){a.setUniform1i(h[b][2],b);d.bindTexture(e[b].getGLTexture(),b);d.setActiveTexture(0)};a.disposeTextures=function(){for(var d=0;d<k;d++)n(c[h[d][0]],
b)}};r.copyParameters=A;r.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var T={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(B,r){return function(){function f(){this._count=0}f.prototype.gen=function(a){null==a&&(a="a");return a+"_"+this._count++};return f}()})},"esri/views/3d/webgl-engine/lib/gl-matrix":function(){define([],function(){var B={};(function(r,f){f(r,!0);f(r,!1)})(B,function(r,
f){var a={};(function(){if("undefined"!=typeof Float32Array){var b=new Float32Array(1),c=new Int32Array(b.buffer);a.invsqrt=function(a){b[0]=a;c[0]=1597463007-(c[0]>>1);var n=b[0];return n*(1.5-.5*a*n*n)}}else a.invsqrt=function(a){return 1/Math.sqrt(a)}})();var b=Array;"undefined"!=typeof Float32Array&&(b=f?Float32Array:Array);var c={create:function(a){var c=new b(3);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2]):c[0]=c[1]=c[2]=0;return c},createFrom:function(a,c,h){var n=new b(3);n[0]=a;n[1]=c;n[2]=h;return n},
set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},set3:function(a,b,c,h){h[0]=a;h[1]=b;h[2]=c;return h},add:function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},subtract:function(a,b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},multiply:function(a,b,c){if(!c||a===c)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];
return c},max:function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);return c},min:function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},normalize:function(a,b){b||(b=a);var c=a[0],n=a[1];a=a[2];var h=Math.sqrt(c*c+n*n+a*a);if(!h)return b[0]=
0,b[1]=0,b[2]=0,b;if(1===h)return b[0]=c,b[1]=n,b[2]=a,b;h=1/h;b[0]=c*h;b[1]=n*h;b[2]=a*h;return b},cross:function(a,b,c){c||(c=a);var n=a[0],h=a[1];a=a[2];var l=b[0],q=b[1];b=b[2];c[0]=h*b-a*q;c[1]=a*l-n*b;c[2]=n*q-h*l;return c},length:function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)},length2:function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,b,c){c||(c=a);var n=a[0]-b[0],h=a[1]-b[1];a=a[2]-b[2];
b=Math.sqrt(n*n+h*h+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=n*b;c[1]=h*b;c[2]=a*b;return c},lerp:function(a,b,c,h){h||(h=a);h[0]=a[0]+c*(b[0]-a[0]);h[1]=a[1]+c*(b[1]-a[1]);h[2]=a[2]+c*(b[2]-a[2]);return h},dist:function(a,b){var c=b[0]-a[0],n=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+n*n+a*a)},dist2:function(a,b){var c=b[0]-a[0],n=b[1]-a[1];a=b[2]-a[2];return c*c+n*n+a*a}},t=null,p=new b(4);c.unproject=function(a,b,c,h,l){l||(l=a);t||(t=u.create());var n=t;p[0]=2*(a[0]-h[0])/h[2]-1;p[1]=
2*(a[1]-h[1])/h[3]-1;p[2]=2*a[2]-1;p[3]=1;u.multiply(c,b,n);if(!u.inverse(n))return null;u.multiplyVec4(n,p);if(0===p[3])return null;l[0]=p[0]/p[3];l[1]=p[1]/p[3];l[2]=p[2]/p[3];return l};var h=c.createFrom(1,0,0),l=c.createFrom(0,1,0),q=c.createFrom(0,0,1);c.rotationTo=function(a,b,u){u||(u=C.create());var n=c.dot(a,b),f=c.create();if(1<=n)C.set(E,u);else if(-.999999>n)c.cross(h,a,f),1E-6>f.length&&c.cross(l,a,f),1E-6>f.length&&c.cross(q,a,f),c.normalize(f),C.fromAxisAngle(f,Math.PI,u);else{var n=
Math.sqrt(2*(1+n)),p=1/n;c.cross(a,b,f);u[0]=f[0]*p;u[1]=f[1]*p;u[2]=f[2]*p;u[3]=.5*n;C.normalize(u)}1<u[3]?u[3]=1:-1>u[3]&&(u[3]=-1);return u};var y=c.create(),z=c.create();c.project=function(a,b,h,l){l||(l=a);c.direction(b,h,y);c.subtract(a,b,z);a=c.dot(y,z);c.scale(y,a,l);c.add(l,b,l)};c.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var w={create:function(a){var c=new b(9);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8]):c[0]=c[1]=c[2]=c[3]=
c[4]=c[5]=c[6]=c[7]=c[8]=0;return c},createFrom:function(a,c,h,l,q,u,f,p,w){var n=new b(9);n[0]=a;n[1]=c;n[2]=h;n[3]=l;n[4]=q;n[5]=u;n[6]=f;n[7]=p;n[8]=w;return n},determinant:function(a){var b=a[3],c=a[4],n=a[5],h=a[6],l=a[7],q=a[8];return a[0]*(q*c-n*l)+a[1]*(-q*b+n*h)+a[2]*(l*b-c*h)},inverse:function(a,b){var c=a[0],n=a[1],h=a[2],l=a[3],q=a[4],u=a[5],f=a[6],p=a[7];a=a[8];var A=a*q-u*p,t=-a*l+u*f,C=p*l-q*f,y=c*A+n*t+h*C;if(!y)return null;y=1/y;b||(b=w.create());b[0]=A*y;b[1]=(-a*n+h*p)*y;b[2]=(u*
n-h*q)*y;b[3]=t*y;b[4]=(a*c-h*f)*y;b[5]=(-u*c+h*l)*y;b[6]=C*y;b[7]=(-p*c+n*f)*y;b[8]=(q*c-n*l)*y;return b},multiply:function(a,b,c){c||(c=a);var n=a[0],h=a[1],l=a[2],q=a[3],u=a[4],f=a[5],p=a[6],A=a[7];a=a[8];var w=b[0],x=b[1],t=b[2],C=b[3],k=b[4],y=b[5],z=b[6],e=b[7];b=b[8];c[0]=w*n+x*q+t*p;c[1]=w*h+x*u+t*A;c[2]=w*l+x*f+t*a;c[3]=C*n+k*q+y*p;c[4]=C*h+k*u+y*A;c[5]=C*l+k*f+y*a;c[6]=z*n+e*q+b*p;c[7]=z*h+e*u+b*A;c[8]=z*l+e*f+b*a;return c},multiplyVec2:function(a,b,c){c||(c=b);var n=b[0];b=b[1];c[0]=n*
a[0]+b*a[3]+a[6];c[1]=n*a[1]+b*a[4]+a[7];return c},multiplyVec3:function(a,b,c){c||(c=b);var n=b[0],h=b[1];b=b[2];c[0]=n*a[0]+h*a[3]+b*a[6];c[1]=n*a[1]+h*a[4]+b*a[7];c[2]=n*a[2]+h*a[5]+b*a[8];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},identity:function(a){a||(a=w.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],n=a[5];a[1]=a[3];
a[2]=a[6];a[3]=b;a[5]=a[7];a[6]=c;a[7]=n;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},toMat4:function(a,b){b||(b=u.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},u={create:function(a){var c=new b(16);4===
arguments.length?(c[0]=arguments[0],c[1]=arguments[1],c[2]=arguments[2],c[3]=arguments[3],c[4]=arguments[4],c[5]=arguments[5],c[6]=arguments[6],c[7]=arguments[7],c[8]=arguments[8],c[9]=arguments[9],c[10]=arguments[10],c[11]=arguments[11],c[12]=arguments[12],c[13]=arguments[13],c[14]=arguments[14],c[15]=arguments[15]):a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);return c},
createFrom:function(a,c,h,l,q,u,f,p,w,t,C,y,z,E,G,k){var n=new b(16);n[0]=a;n[1]=c;n[2]=h;n[3]=l;n[4]=q;n[5]=u;n[6]=f;n[7]=p;n[8]=w;n[9]=t;n[10]=C;n[11]=y;n[12]=z;n[13]=E;n[14]=G;n[15]=k;return n},createFromMatrixRowMajor:function(a){var c=new b(16);c[0]=a[0];c[4]=a[1];c[8]=a[2];c[12]=a[3];c[1]=a[4];c[5]=a[5];c[9]=a[6];c[13]=a[7];c[2]=a[8];c[6]=a[9];c[10]=a[10];c[14]=a[11];c[3]=a[12];c[7]=a[13];c[11]=a[14];c[15]=a[15];return c},createFromMatrix:function(a){var c=new b(16);c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},setRowMajor:function(a,b){b[0]=a[0];b[4]=a[1];b[8]=a[2];b[12]=a[3];b[1]=a[4];b[5]=a[5];b[9]=a[6];b[13]=a[7];b[2]=a[8];b[6]=a[9];b[10]=a[10];b[14]=
a[11];b[3]=a[12];b[7]=a[13];b[11]=a[14];b[15]=a[15];return b},identity:function(a){a||(a=u.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],h=a[3],n=a[6],l=a[7],q=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=b;a[6]=a[9];a[7]=a[13];a[8]=c;a[9]=n;a[11]=a[14];a[12]=h;a[13]=l;a[14]=q;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];
b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var b=a[0],c=a[1],h=a[2],n=a[3],l=a[4],q=a[5],u=a[6],f=a[7],p=a[8],w=a[9],t=a[10],C=a[11],y=a[12],z=a[13],k=a[14];a=a[15];return y*w*u*n-p*z*u*n-y*q*t*n+l*z*t*n+p*q*k*n-l*w*k*n-y*w*h*f+p*z*h*f+y*c*t*f-b*z*t*f-p*c*k*f+b*w*k*f+y*q*h*C-l*z*h*C-y*c*u*C+b*z*u*C+l*c*k*C-b*q*k*C-p*q*h*a+l*w*h*a+p*c*u*a-b*w*u*a-l*c*t*a+b*q*t*a},inverse:function(a,b){b||(b=a);var c=a[0],h=
a[1],n=a[2],l=a[3],q=a[4],u=a[5],f=a[6],p=a[7],w=a[8],A=a[9],t=a[10],C=a[11],y=a[12],k=a[13],z=a[14];a=a[15];var E=c*u-h*q,e=c*f-n*q,d=c*p-l*q,g=h*f-n*u,m=h*p-l*u,v=n*p-l*f,G=w*k-A*y,r=w*z-t*y,B=w*a-C*y,Z=A*z-t*k,ba=A*a-C*k,ja=t*a-C*z,aa=E*ja-e*ba+d*Z+g*B-m*r+v*G;if(!aa)return null;aa=1/aa;b[0]=(u*ja-f*ba+p*Z)*aa;b[1]=(-h*ja+n*ba-l*Z)*aa;b[2]=(k*v-z*m+a*g)*aa;b[3]=(-A*v+t*m-C*g)*aa;b[4]=(-q*ja+f*B-p*r)*aa;b[5]=(c*ja-n*B+l*r)*aa;b[6]=(-y*v+z*d-a*e)*aa;b[7]=(w*v-t*d+C*e)*aa;b[8]=(q*ba-u*B+p*G)*aa;b[9]=
(-c*ba+h*B-l*G)*aa;b[10]=(y*m-k*d+a*E)*aa;b[11]=(-w*m+A*d-C*E)*aa;b[12]=(-q*Z+u*r-f*G)*aa;b[13]=(c*Z-h*r+n*G)*aa;b[14]=(-y*g+k*e-z*E)*aa;b[15]=(w*g-A*e+t*E)*aa;return b},toRotationMat:function(a,b){b||(b=u.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=w.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];
b[8]=a[10];return b},toInverseMat3:function(a,b){var c=a[0],h=a[1],n=a[2],l=a[4],q=a[5],u=a[6],f=a[8],p=a[9];a=a[10];var t=a*q-u*p,A=-a*l+u*f,C=p*l-q*f,y=c*t+h*A+n*C;if(!y)return null;y=1/y;b||(b=w.create());b[0]=t*y;b[1]=(-a*h+n*p)*y;b[2]=(u*h-n*q)*y;b[3]=A*y;b[4]=(a*c-n*f)*y;b[5]=(-u*c+n*l)*y;b[6]=C*y;b[7]=(-p*c+h*f)*y;b[8]=(q*c-h*l)*y;return b},multiply:function(a,b,c){c||(c=a);var h=a[0],n=a[1],l=a[2],q=a[3],u=a[4],f=a[5],p=a[6],w=a[7],t=a[8],x=a[9],A=a[10],C=a[11],k=a[12],y=a[13],z=a[14];a=a[15];
var e=b[0],d=b[1],g=b[2],m=b[3],E=b[4],G=b[5],r=b[6],B=b[7],Z=b[8],ba=b[9],ja=b[10],aa=b[11],ea=b[12],ha=b[13],ga=b[14];b=b[15];c[0]=e*h+d*u+g*t+m*k;c[1]=e*n+d*f+g*x+m*y;c[2]=e*l+d*p+g*A+m*z;c[3]=e*q+d*w+g*C+m*a;c[4]=E*h+G*u+r*t+B*k;c[5]=E*n+G*f+r*x+B*y;c[6]=E*l+G*p+r*A+B*z;c[7]=E*q+G*w+r*C+B*a;c[8]=Z*h+ba*u+ja*t+aa*k;c[9]=Z*n+ba*f+ja*x+aa*y;c[10]=Z*l+ba*p+ja*A+aa*z;c[11]=Z*q+ba*w+ja*C+aa*a;c[12]=ea*h+ha*u+ga*t+b*k;c[13]=ea*n+ha*f+ga*x+b*y;c[14]=ea*l+ha*p+ga*A+b*z;c[15]=ea*q+ha*w+ga*C+b*a;return c},
multiplyVec3:function(a,b,c){c||(c=b);var h=b[0],n=b[1];b=b[2];c[0]=a[0]*h+a[4]*n+a[8]*b+a[12];c[1]=a[1]*h+a[5]*n+a[9]*b+a[13];c[2]=a[2]*h+a[6]*n+a[10]*b+a[14];return c},multiplyVec4:function(a,b,c){c||(c=b);var h=b[0],n=b[1],l=b[2];b=b[3];c[0]=a[0]*h+a[4]*n+a[8]*l+a[12]*b;c[1]=a[1]*h+a[5]*n+a[9]*l+a[13]*b;c[2]=a[2]*h+a[6]*n+a[10]*l+a[14]*b;c[3]=a[3]*h+a[7]*n+a[11]*l+a[15]*b;return c},translate:function(a,b,c){var h=b[0],n=b[1];b=b[2];var l,q,u,f,p,w,t,x,A,C,k,y;if(!c||a===c)return a[12]=a[0]*h+a[4]*
n+a[8]*b+a[12],a[13]=a[1]*h+a[5]*n+a[9]*b+a[13],a[14]=a[2]*h+a[6]*n+a[10]*b+a[14],a[15]=a[3]*h+a[7]*n+a[11]*b+a[15],a;l=a[0];q=a[1];u=a[2];f=a[3];p=a[4];w=a[5];t=a[6];x=a[7];A=a[8];C=a[9];k=a[10];y=a[11];c[0]=l;c[1]=q;c[2]=u;c[3]=f;c[4]=p;c[5]=w;c[6]=t;c[7]=x;c[8]=A;c[9]=C;c[10]=k;c[11]=y;c[12]=l*h+p*n+A*b+a[12];c[13]=q*h+w*n+C*b+a[13];c[14]=u*h+t*n+k*b+a[14];c[15]=f*h+x*n+y*b+a[15];return c},scale:function(a,b,c){var h=b[0],n=b[1];b=b[2];if(!c||a===c)return a[0]*=h,a[1]*=h,a[2]*=h,a[3]*=h,a[4]*=
n,a[5]*=n,a[6]*=n,a[7]*=n,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;c[0]=a[0]*h;c[1]=a[1]*h;c[2]=a[2]*h;c[3]=a[3]*h;c[4]=a[4]*n;c[5]=a[5]*n;c[6]=a[6]*n;c[7]=a[7]*n;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},maxScale:function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))},rotate:function(a,b,c,h){var n=c[0],l=c[1];c=c[2];var q=Math.sqrt(n*
n+l*l+c*c),u,f,p,w,t,A,x,C,k,y,z,e,d,g,m,E,I,G,r,Z;if(!q)return null;1!==q&&(q=1/q,n*=q,l*=q,c*=q);u=Math.sin(b);f=Math.cos(b);p=1-f;b=a[0];q=a[1];w=a[2];t=a[3];A=a[4];x=a[5];C=a[6];k=a[7];y=a[8];z=a[9];e=a[10];d=a[11];g=n*n*p+f;m=l*n*p+c*u;E=c*n*p-l*u;I=n*l*p-c*u;G=l*l*p+f;r=c*l*p+n*u;Z=n*c*p+l*u;n=l*c*p-n*u;l=c*c*p+f;h?a!==h&&(h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]):h=a;h[0]=b*g+A*m+y*E;h[1]=q*g+x*m+z*E;h[2]=w*g+C*m+e*E;h[3]=t*g+k*m+d*E;h[4]=b*I+A*G+y*r;h[5]=q*I+x*G+z*r;h[6]=w*I+C*G+e*
r;h[7]=t*I+k*G+d*r;h[8]=b*Z+A*n+y*l;h[9]=q*Z+x*n+z*l;h[10]=w*Z+C*n+e*l;h[11]=t*Z+k*n+d*l;return h},rotateX:function(a,b,c){var h=Math.sin(b);b=Math.cos(b);var n=a[4],l=a[5],q=a[6],u=a[7],f=a[8],p=a[9],w=a[10],t=a[11];c?a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=n*b+f*h;c[5]=l*b+p*h;c[6]=q*b+w*h;c[7]=u*b+t*h;c[8]=n*-h+f*b;c[9]=l*-h+p*b;c[10]=q*-h+w*b;c[11]=u*-h+t*b;return c},rotateY:function(a,b,c){var h=Math.sin(b);b=Math.cos(b);var n=
a[0],l=a[1],q=a[2],u=a[3],f=a[8],p=a[9],w=a[10],t=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=n*b+f*-h;c[1]=l*b+p*-h;c[2]=q*b+w*-h;c[3]=u*b+t*-h;c[8]=n*h+f*b;c[9]=l*h+p*b;c[10]=q*h+w*b;c[11]=u*h+t*b;return c},rotateZ:function(a,b,c){var h=Math.sin(b);b=Math.cos(b);var n=a[0],l=a[1],q=a[2],u=a[3],f=a[4],p=a[5],w=a[6],t=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;
c[0]=n*b+f*h;c[1]=l*b+p*h;c[2]=q*b+w*h;c[3]=u*b+t*h;c[4]=n*-h+f*b;c[5]=l*-h+p*b;c[6]=q*-h+w*b;c[7]=u*-h+t*b;return c},frustum:function(a,b,c,h,l,q,f){f||(f=u.create());var n=b-a,p=h-c,w=q-l;f[0]=2*l/n;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*l/p;f[6]=0;f[7]=0;f[8]=(b+a)/n;f[9]=(h+c)/p;f[10]=-(q+l)/w;f[11]=-1;f[12]=0;f[13]=0;f[14]=-(q*l*2)/w;f[15]=0;return f},perspective:function(a,b,c,h,l){a=c*Math.tan(a*Math.PI/360);b*=a;return u.frustum(-b,b,-a,a,c,h,l)},ortho:function(a,b,c,h,l,q,f){f||(f=u.create());
var n=b-a,p=h-c,w=q-l;f[0]=2/n;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2/p;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=-2/w;f[11]=0;f[12]=-(a+b)/n;f[13]=-(h+c)/p;f[14]=-(q+l)/w;f[15]=1;return f},lookAt:function(a,b,c,h){h||(h=u.create());var n,l,q,f,p,w,t,C,A=a[0],y=a[1];a=a[2];q=c[0];f=c[1];l=c[2];t=b[0];c=b[1];n=b[2];if(A===t&&y===c&&a===n)return u.identity(h);b=A-t;c=y-c;t=a-n;C=1/Math.sqrt(b*b+c*c+t*t);b*=C;c*=C;t*=C;n=f*t-l*c;l=l*b-q*t;q=q*c-f*b;(C=Math.sqrt(n*n+l*l+q*q))?(C=1/C,n*=C,l*=C,q*=C):q=l=n=0;f=c*q-
t*l;p=t*n-b*q;w=b*l-c*n;(C=Math.sqrt(f*f+p*p+w*w))?(C=1/C,f*=C,p*=C,w*=C):w=p=f=0;h[0]=n;h[1]=f;h[2]=b;h[3]=0;h[4]=l;h[5]=p;h[6]=c;h[7]=0;h[8]=q;h[9]=w;h[10]=t;h[11]=0;h[12]=-(n*A+l*y+q*a);h[13]=-(f*A+p*y+w*a);h[14]=-(b*A+c*y+t*a);h[15]=1;return h},fromRotationTranslation:function(a,b,c){c||(c=u.create());var h=a[0],n=a[1],l=a[2],q=a[3],f=h+h,p=n+n,w=l+l;a=h*f;var t=h*p,h=h*w,C=n*p,n=n*w,l=l*w,f=q*f,p=q*p,q=q*w;c[0]=1-(C+l);c[1]=t+q;c[2]=h-p;c[3]=0;c[4]=t-q;c[5]=1-(a+l);c[6]=n+f;c[7]=0;c[8]=h+p;c[9]=
n-f;c[10]=1-(a+C);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},C={create:function(a){var c=new b(4);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]):c[0]=c[1]=c[2]=c[3]=0;return c},createFrom:function(a,c,h,l){var n=new b(4);n[0]=a;n[1]=c;n[2]=h;n[3]=l;return n},set:function(a,b){b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=C.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},E=C.identity();C.calculateW=function(a,b){var c=a[0],h=a[1],n=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-h*h-n*n)),a;b[0]=c;b[1]=h;b[2]=n;b[3]=-Math.sqrt(Math.abs(1-c*c-h*h-n*n));return b};C.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};C.inverse=function(a,b){var c=a[0],h=a[1],n=a[2],l=a[3],c=(c=c*c+h*h+n*n+l*l)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=
-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};C.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};C.length=function(a){var b=a[0],c=a[1],h=a[2];a=a[3];return Math.sqrt(b*b+c*c+h*h+a*a)};C.normalize=function(a,b){b||(b=a);var c=a[0],h=a[1],n=a[2];a=a[3];var l=Math.sqrt(c*c+h*h+n*n+a*a);if(0===l)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;l=1/l;b[0]=c*l;b[1]=h*l;b[2]=n*l;b[3]=a*l;return b};C.add=function(a,
b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};C.multiply=function(a,b,c){c||(c=a);var h=a[0],n=a[1],l=a[2];a=a[3];var q=b[0],u=b[1],f=b[2];b=b[3];c[0]=h*b+a*q+n*f-l*u;c[1]=n*b+a*u+l*q-h*f;c[2]=l*b+a*f+h*u-n*q;c[3]=a*b-h*q-n*u-l*f;return c};C.multiplyVec3=function(a,b,c){c||(c=b);var h=b[0],n=b[1],l=b[2];b=a[0];var q=a[1],u=a[2];a=a[3];var f=a*h+q*l-u*n,p=a*n+u*h-b*l,w=a*l+b*n-q*h,h=-b*h-q*n-u*l;c[0]=f*a+
h*-b+p*-u-w*-q;c[1]=p*a+h*-q+w*-b-f*-u;c[2]=w*a+h*-u+f*-q-p*-b;return c};C.scale=function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};C.toMat3=function(a,b){b||(b=w.create());var c=a[0],h=a[1],n=a[2],l=a[3],q=c+c,u=h+h,f=n+n;a=c*q;var p=c*u,c=c*f,t=h*u,h=h*f,n=n*f,q=l*q,u=l*u,l=l*f;b[0]=1-(t+n);b[1]=p+l;b[2]=c-u;b[3]=p-l;b[4]=1-(a+n);b[5]=h+q;b[6]=c+u;b[7]=h-q;b[8]=1-(a+t);return b};C.toMat4=function(a,b){b||(b=u.create());
var c=a[0],h=a[1],n=a[2],l=a[3],q=c+c,f=h+h,p=n+n;a=c*q;var w=c*f,c=c*p,t=h*f,h=h*p,n=n*p,q=l*q,f=l*f,l=l*p;b[0]=1-(t+n);b[1]=w+l;b[2]=c-f;b[3]=0;b[4]=w-l;b[5]=1-(a+n);b[6]=h+q;b[7]=0;b[8]=c+f;b[9]=h-q;b[10]=1-(a+t);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};C.slerp=function(a,b,c,h){h||(h=a);var n=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],l,q;if(1<=Math.abs(n))return h!==a&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3]),h;l=Math.acos(n);q=Math.sqrt(1-n*n);if(.001>Math.abs(q))return h[0]=.5*a[0]+
.5*b[0],h[1]=.5*a[1]+.5*b[1],h[2]=.5*a[2]+.5*b[2],h[3]=.5*a[3]+.5*b[3],h;n=Math.sin((1-c)*l)/q;c=Math.sin(c*l)/q;h[0]=a[0]*n+b[0]*c;h[1]=a[1]*n+b[1]*c;h[2]=a[2]*n+b[2]*c;h[3]=a[3]*n+b[3]*c;return h};C.fromRotationMatrix=function(a,b){b||(b=C.create());var c=a[0]+a[4]+a[8],h;if(0<c)h=Math.sqrt(c+1),b[3]=.5*h,h=.5/h,b[0]=(a[7]-a[5])*h,b[1]=(a[2]-a[6])*h,b[2]=(a[3]-a[1])*h;else{h=C.fromRotationMatrix.s_iNext=C.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var n=h[c],l=
h[n];h=Math.sqrt(a[3*c+c]-a[3*n+n]-a[3*l+l]+1);b[c]=.5*h;h=.5/h;b[3]=(a[3*l+n]-a[3*n+l])*h;b[n]=(a[3*n+c]+a[3*c+n])*h;b[l]=(a[3*l+c]+a[3*c+l])*h}return b};w.toQuat4=C.fromRotationMatrix;(function(){var a=w.create();C.fromAxes=function(b,c,h,n){a[0]=c[0];a[3]=c[1];a[6]=c[2];a[1]=h[0];a[4]=h[1];a[7]=h[2];a[2]=b[0];a[5]=b[1];a[8]=b[2];return C.fromRotationMatrix(a,n)}})();C.identity=function(a){a||(a=C.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};C.fromAngleAxis=function(a,b,c){c||(c=C.create());
a*=.5;var h=Math.sin(a);c[3]=Math.cos(a);c[0]=h*b[0];c[1]=h*b[1];c[2]=h*b[2];return c};C.toAngleAxis=function(b,c){c||(c=b);var h=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<h?(c[3]=2*Math.acos(b[3]),h=a.invsqrt(h),c[0]=b[0]*h,c[1]=b[1]*h,c[2]=b[2]*h):(c[3]=0,c[0]=1,c[1]=0,c[2]=0);return c};C.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var G={create:function(a){var c=new b(4);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]):c[0]=c[1]=c[2]=c[3]=0;return c},createFrom:function(a,c,h,l){var n=new b(4);
n[0]=a;n[1]=c;n[2]=h;n[3]=l;return n},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=G.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b)return b=a[1],a[1]=a[2],a[2]=b,a;b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],h=a[1],n=a[2];a=a[3];var l=c*a-n*h;if(!l)return null;l=1/l;b[0]=a*l;b[1]=-h*l;b[2]=-n*l;b[3]=c*l;return b},
multiply:function(a,b,c){c||(c=a);var h=a[0],n=a[1],l=a[2];a=a[3];c[0]=h*b[0]+n*b[2];c[1]=h*b[1]+n*b[3];c[2]=l*b[0]+a*b[2];c[3]=l*b[1]+a*b[3];return c},rotate:function(a,b,c){c||(c=a);var h=a[0],n=a[1],l=a[2];a=a[3];var q=Math.sin(b);b=Math.cos(b);c[0]=h*b+n*q;c[1]=h*-q+n*b;c[2]=l*b+a*q;c[3]=l*-q+a*b;return c},multiplyVec2:function(a,b,c){c||(c=b);var h=b[0];b=b[1];c[0]=h*a[0]+b*a[1];c[1]=h*a[2]+b*a[3];return c},scale:function(a,b,c){c||(c=a);var h=a[1],l=a[2],n=a[3],q=b[0];b=b[1];c[0]=a[0]*q;c[1]=
h*b;c[2]=l*q;c[3]=n*b;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};f=f?"":"d";r["glMath"+f]=a;r["vec2"+f]={create:function(a){var c=new b(2);a?(c[0]=a[0],c[1]=a[1]):(c[0]=0,c[1]=0);return c},createFrom:function(a,c){var h=new b(2);h[0]=a;h[1]=c;return h},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c},
divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;return c},dist:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)},dist2:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},set2:function(a,b,c){c[0]=a;c[1]=b;return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),
b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,b,c){a=a[0]*b[1]-a[1]*b[0];if(!c)return a;c[0]=c[1]=0;c[2]=a;return c},length:function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,c){c||(c=a);var h=a[0]-b[0];a=a[1]-b[1];b=h*h+a*a;if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/Math.sqrt(b);c[0]=h*b;c[1]=a*b;return c},lerp:function(a,b,c,h){h||(h=a);h[0]=a[0]+c*(b[0]-a[0]);h[1]=a[1]+c*(b[1]-a[1]);return h},str:function(a){return"["+
a[0]+", "+a[1]+"]"}};r["vec3"+f]=c;r["vec4"+f]={create:function(a){var c=new b(4);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]):(c[0]=0,c[1]=0,c[2]=0,c[3]=0);return c},createFrom:function(a,c,h,l){var n=new b(4);n[0]=a;n[1]=c;n[2]=h;n[3]=l;return n},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=
a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},set4:function(a,b,c,h,l){l[0]=a;l[1]=b;l[2]=c;l[3]=h;return l},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];
b[3]=-a[3];return b},lerp:function(a,b,c,h){h||(h=a);h[0]=a[0]+c*(b[0]-a[0]);h[1]=a[1]+c*(b[1]-a[1]);h[2]=a[2]+c*(b[2]-a[2]);h[3]=a[3]+c*(b[3]-a[3]);return h},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};r["mat2"+f]=G;r["mat3"+f]=w;r["mat4"+f]=u;r["quat4"+f]=C});return B})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports"],function(B,r){function f(a,b){if(null!=a){var c=a.isVisibleBit,h=a.data,l=8*h.BYTES_PER_ELEMENT;return b<h.length*l?
y(c,h,b,l):!a.isVisibleBit}return!0}function a(a){return null===a.component?-1:a.component}function b(a,b,h,l,q){f(b,l)&&c(a,b,h,h[l],h[l+1]-1,q)}function c(a,b,c,h,l,q){c=(b=0<a.length?a[a.length-1]:null)?b.range[1]:-1;var n=b?b.options:null;c>=h||(c+1===h&&n===q?b.range[1]=l:a.push({range:[h,l],options:q}))}function t(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function p(a,b){return l(a,b,!0)}function h(a,b){return l(a,b,!1)}function l(a,b,c){var h=!1;a=a||w;h=a.isVisibleBit;
a=a.data;b=z(b);var l=8*a.BYTES_PER_ELEMENT,q=a.length*l;c=c===h;if(0===a.length||0===b)h=!c;else if(q<b&&!c)h=!0;else{for(var f=u[l],q=u[0],p=0;p<a.length-1;p++)if(h=!c&&a[p]!==f||c&&a[p]!==q)return h;h=a.length-1;b=u[(b-1)%l+1];h=!c&&(a[h]&b)!==b||c&&(a[h]&b)!==q}return h}function q(a){return 0<a.length}function y(a,b,c,h){var l=c/h|0;return 0!==(b[l]&1<<c-l*h)===a}function z(a){return Math.max(0,a.length-1)}Object.defineProperty(r,"__esModule",{value:!0});r.updateVisibility=function(a,b,c,h){if(c<
z(b)){null==a&&(a=t());var l=a.isVisibleBit,n=a.data,q=8*n.BYTES_PER_ELEMENT,u=c/q|0,f=c-q*u;b=(z(b)-1)/q|0;var p=n;h=h===l;c<p.length*q||!h||(c=Math.max(u+1,Math.ceil(1.5*p.length)),c=Math.min(c,b+1),n=new Uint32Array(c),n.set(p));u<n.length&&(n[u]=n[u]&~(1<<f)|(h?1:0)<<f);a.data=n}return a};r.getVisibility=f;r.hideAllComponents=function(a){if(null==a)a=t(!1);else{a.isVisibleBit=!0;for(var b=0;b<a.data.length;b++)a.data[b]=0}return a};r.unhideAllComponents=function(a){var b;if(null!=a)for(b=a,b.isVisibleBit=
!1,a=0;a<b.data.length;a++)b.data[a]=0;return b};r.generateVisibleIndexRanges=function(a,b){var c;if(a)if(q(b))if(0===a.data.length)c=[],b=[[b[0],b[b.length-1]-1]],c=a.isVisibleBit?c:b;else{c=[];for(var h=a.isVisibleBit,l=a.data,u=8*l.BYTES_PER_ELEMENT,f=l.length*u,p=z(b),w=!1,t=0;t<f&&t<p;t++){var C=y(h,l,t,u);if(C!==w){var E=b[t];C?c.push([E,0]):(w=c[c.length-1],w[1]=E-1);w=C}}a=!a.isVisibleBit;p>f&&a&&!w?c.push([b[f],b[p]-1]):w&&(w=c[c.length-1],w[1]=b[a?p:Math.min(p,f)]-1)}else c=[],c=a.isVisibleBit?
c:null;else c=null;return c};r.addHighlight=function(b,c,h,l){b=b||[];c={component:c,options:h,id:l};b.push(c);c=a(c);for(h=b.length-1;0<h&&c<a(b[h-1]);)l=[b[h],b[h-1]],b[h-1]=l[0],b[h]=l[1],--h;return b};r.removeHighlight=function(a,b){return a?(a=a.filter(function(a){return a.id!==b}),0===a.length?null:a):a};r.generateHighlightedIndexRanges=function(a,l,u){if(l){if(q(u)){for(var n=u[0],f=u[u.length-1]-1,p=[],w=!h(a,u),t=0;t<l.length;++t){var y=l[t].options,C=l[t].component;if(null!==C)b(p,a,u,C,
y);else if(w)c(p,a,u,n,f,y);else for(C=0;C<z(u);++C)b(p,a,u,C,y)}return 0<p.length?p:null}var w=!a||!a.isVisibleBit;return w?l.map(function(a){return{range:null,options:a.options}}):null}return null};r.defaultVisibilities=t;r.isAllVisible=function(a,b){return!h(a,b)};r.isAllHidden=function(a,b){return!p(a,b)};r.hasVisible=p;r.hasHidden=h;var w=t();r.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};r.hasComponent=function(a,b){return b<z(a)};r.hasComponents=q;var u=[];for(B=
0;65>B;B++)u.push(Math.pow(2,B)-1);r.componentCount=z})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require","exports","./gl-matrix"],function(B,r,f){function a(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new U(b);}function b(a,b,c){return a<b?b:a>c?c:a}function c(a){return a/180*Math.PI}function t(a){return 180*a/Math.PI}function p(a,b,c){f.mat4d.multiply(b,a,z);f.mat4d.inverse(z);for(a=0;8>a;++a)f.mat4d.multiplyVec4(z,w[a],u),f.vec3d.set3(u[0]/u[3],u[1]/u[3],u[2]/
u[3],c[a])}function h(a,b,c,h){f.vec3d.subtract(a,b,E);f.vec3d.subtract(c,b,G);f.vec3d.cross(G,E,h);f.vec3d.normalize(h);h[3]=-f.vec3d.dot(h,a)}function l(a,b,c,h){var e=6378137/Math.sqrt(1-r.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),d=Math.cos(a);h[0]=(e+c)*Math.cos(b)*d;h[1]=(e*(1-r.ECCENTRICITY_SQUARED)+c)*Math.sin(a);h[2]=-(e+c)*Math.sin(b)*d}function q(a){for(var b in a)return b}function y(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}Object.defineProperty(r,"__esModule",{value:!0});var z=f.mat4d.create(),
w=[f.vec4d.createFrom(-1,-1,-1,1),f.vec4d.createFrom(1,-1,-1,1),f.vec4d.createFrom(1,1,-1,1),f.vec4d.createFrom(-1,1,-1,1),f.vec4d.createFrom(-1,-1,1,1),f.vec4d.createFrom(1,-1,1,1),f.vec4d.createFrom(1,1,1,1),f.vec4d.createFrom(-1,1,1,1)],u=f.vec4d.create(),C=[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],E=f.vec3d.create(),G=f.vec3d.create(),n=f.vec3d.create(),A=f.vec3d.create(),x=f.vec3d.create(),I=f.vec3d.create(),
K=f.vec3d.create(),J=f.vec3d.create(),N=f.vec3d.create(),M=f.vec3d.create(),Q=f.vec3d.create(),S=f.vec3d.create(),P=f.vec3d.create(),O=f.vec3d.create(),T=f.vec3d.createFrom(0,0,0),U=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();r.AssertException=U;r.EARTH_RADIUS=6378137;r.METER2FEET=3.28084;r.ECCENTRICITY_SQUARED=.0066943799901414;r.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",
COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region"};r.assert=a;r.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};r.createQuadVertexUvBuffer=function(a){void 0===a&&(a=Float32Array);a=new a(20);a[0]=-1;a[1]=-1;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=-1;a[7]=0;a[8]=1;a[9]=0;a[10]=-1;a[11]=1;a[12]=0;a[13]=0;a[14]=1;a[15]=1;a[16]=1;a[17]=0;a[18]=1;a[19]=1;return a};r.isPowerOfTwo=function(a){return 0===(a&a-1)};r.lerp=function(a,b,c){return a+(b-
a)*c};r.clamp=b;r.fallbackIfUndefined=function(a,b){return void 0===a?b:a};r.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};r.rgb2hex=function(a){var c=b(Math.round(255*a[0]),0,255),h=b(Math.round(255*a[1]),0,255);a=b(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(h<<8)+a).toString(16)};r.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};r.deg2rad=c;r.rad2deg=t;r.azimuthElevationAngle2Direction=function(a,b){a=1.5*Math.PI-a;b=
.5*Math.PI-b;return[Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b)]};r.rayPlane=function(a,b,c,h){var e=f.vec3d.dot(c,b);if(0===e)return!1;c=-(f.vec3d.dot(c,a)+c[3])/e;f.vec3d.add(a,f.vec3d.scale(b,c,h),h);return!0};r.raySphere=function(a,b,c,h,e){c=c||T;var d=f.vec3d.subtract(a,c,E);c=f.vec3d.dot(b,b);var g=2*f.vec3d.dot(b,d);h=f.vec3d.dot(d,d)-h*h;h=g*g-4*c*h;if(0>h)return!1;d=Math.sqrt(h);h=(-g-d)/(2*c);c=(-g+d)/(2*c);if(0>h||c<h&&0<c)h=c;return 0<h?(f.vec3d.add(a,f.vec3d.scale(b,
h,e),e),!0):!1};r.rayTriangle3D=function(a,b,c,h,e,d,g,m,l){void 0===l&&(l=f.vec3d.create());var k=h[g]-c[d],n=h[g+1]-c[d+1],q=h[g+2]-c[d+2];h=e[m]-c[d];g=e[m+1]-c[d+1];e=e[m+2]-c[d+2];var u=b[1]*e-g*b[2],p=b[2]*h-e*b[0],w=b[0]*g-h*b[1];m=k*u+n*p+q*w;if(-1E-5<m&&1E-5>m)return!1;m=1/m;var t=a[0]-c[d],y=a[1]-c[d+1];a=a[2]-c[d+2];l[1]=m*(t*u+y*p+a*w);if(0>l[1]||1<l[1])return!1;c=y*q-n*a;a=a*k-q*t;k=t*n-k*y;l[2]=m*(b[0]*c+b[1]*a+b[2]*k);if(0>l[2]||1<l[1]+l[2])return!1;l[0]=m*(h*c+g*a+e*k);return!0};r.rayBoxTest=
function(a,b,c,h){var e,d=(c[0]-a[0])/b[0],g=(h[0]-a[0])/b[0];d>g&&(e=d,d=g,g=e);var k=(c[1]-a[1])/b[1],l=(h[1]-a[1])/b[1];k>l&&(e=k,k=l,l=e);if(d>l||k>g)return!1;k>d&&(d=k);l<g&&(g=l);c=(c[2]-a[2])/b[2];a=(h[2]-a[2])/b[2];c>a&&(e=c,c=a,a=e);if(d>a||c>g)return!1;a<g&&(g=a);return 0>g?!1:!0};r.rayRay2D=function(a,b,c,h,e,d){void 0===d&&(d=f.vec2d.create());var g=(h[e]-c[e])*(b[0]-a[0])-(h[0]-c[0])*(b[e]-a[e]);if(0===g)return!1;c=((h[0]-c[0])*(a[e]-c[e])-(h[e]-c[e])*(a[0]-c[0]))/g;d[0]=a[0]+c*(b[0]-
a[0]);d[1]=a[e]+c*(b[e]-a[e]);return!0};r.matrix2frustum=p;r.matrix2frustumPlanes=function(a,b,c,l){void 0===l&&(l=c,c=C);p(a,b,c);h(c[4],c[0],c[3],l[0]);h(c[1],c[5],c[6],l[1]);h(c[4],c[5],c[1],l[2]);h(c[3],c[2],c[6],l[3]);h(c[0],c[1],c[2],l[4]);h(c[5],c[4],c[7],l[5])};r.point2plane=h;r.project=function(b,c,h,l,e){e||(e=b);u[0]=b[0];u[1]=b[1];u[2]=b[2];u[3]=1;f.mat4d.multiplyVec4(c,u);2<e.length&&(e[2]=-u[2]);f.mat4d.multiplyVec4(h,u);a(0!==u[3]);e[0]=u[0]/u[3];e[1]=u[1]/u[3];e[2]=u[2]/u[3];e[0]=
(.5*e[0]+.5)*l[2]+l[0];e[1]=(.5*e[1]+.5)*l[3]+l[1]};r.geodeticToGeocentricLatidude=function(a){return Math.atan((1-r.ECCENTRICITY_SQUARED)*Math.tan(a))};r.latLon2positionWGS84Ellipsoid=l;r.pos2latLon=function(a,c){var k=f.vec3d.length(a);c[0]=Math.asin(b(a[1]/k,-1,1));c[1]=(0>a[2]?1:-1)*Math.acos(b(a[0]/(Math.cos(c[0])*k),-1,1));c[0]=t(c[0]);c[1]=t(c[1]);c[2]=k};r.pos2latLonWGS84Ellipsoid=function(a,b){var c=a[0],k=-a[2],e=a[1],d=Math.sqrt(Math.pow(6378137,2)*(1-r.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(c,
2)+Math.pow(k,2));var g=Math.atan2(6378137*e,d*a),c=Math.atan2(k,c),k=Math.atan2(e+Math.pow(Math.sqrt((Math.pow(6378137,2)-Math.pow(d,2))/Math.pow(d,2)),2)*d*Math.pow(Math.sin(g),3),a-6378137*r.ECCENTRICITY_SQUARED*Math.pow(Math.cos(g),3));a=a/Math.cos(k)-6378137/Math.sqrt(1-r.ECCENTRICITY_SQUARED*Math.pow(Math.sin(k),2))+r.EARTH_RADIUS;b[0]=k;b[1]=c;b[2]=a};r.computeGlobeTransformation=function(a,b,h){var k=c(a[0]);a=c(a[1]);l(k,a,b,n);f.mat4d.translate(h,n);f.mat4d.rotateY(h,.5*Math.PI+a);f.mat4d.rotateX(h,
.5*Math.PI-k);return h};r.readUInt16=function(a,b){return a[b]+(a[b+1]<<8)};r.readUInt32=function(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)};r.setIfDefined=function(a,b,c){void 0!==b[a]&&(c[a]=b[a])};r.array2object=function(a,b){var c={};if(void 0!==b)for(var k=0;k<a.length;k++){var e=a[k];c[b(e)]=e}else for(b=0;b<a.length;b++)e=a[b],c[e]=e;return c};r.object2array=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};r.mergeObjects=function(a,b,c){void 0===c&&(c={});if(c!==a)for(var k in a)c[k]=
a[k];if(c!==b)for(var e in b)c[e]=b[e];return c};r.subtractObjects=function(a,b){var c={},k;for(k in a)void 0===b[k]&&(c[k]=a[k]);return c};r.intersectObjects=function(a,b){var c={},k;for(k in a)void 0!==b[k]&&(c[k]=a[k]);return c};r.getFirstObjectKey=q;r.getFirstObjectValue=function(a){return a[q(a)]};r.objectEmpty=function(a){for(var b in a)return!1;return!0};r.arraysEqual=function(a,b){if(a.length!==b.length)return!1;for(var c=0,k=a.length;c<k;++c)if(a[c]!==b[c])return!1;return!0};r.arrayRemove=
function(a,b){var c=a.indexOf(b);return-1!==c?(a[c]=a[a.length-1],a.pop(),b):null};r.byteBuffer2base64image=function(b,c,h,l,e){var d=4*c;a(b.length===d*h,"buffer length must match image resolution");var g=document.createElement("canvas");g.width=c;g.height=h;var k=g.getContext("2d");c=k.getImageData(0,0,c,h);for(var n=c.data,q=0;q<h;++q)for(var u=q*d,f=(h-1-q)*d,p=0;p<d;++p)n[u++]=b[f++];k.putImageData(c,0,0);return g.toDataURL(l,e)};r.cround=function(a){return Math.round(100*a)/100};r.logWithBase=
function(a,b){return Math.log(a)/Math.log(b)};r.setMatrixTranslation=y;r.setMatrixTranslation3=function(a,b,c,h){a[12]=b;a[13]=c;a[14]=h};r.getMatrixTranslation=function(a,b){void 0===b&&(b=f.vec3d.create());b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};r.createTranslationMatrix=function(a,b){a=f.mat4d.identity(a);y(a,b);return a};r.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};r.fovy2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/c)};r.fovx2fovd=function(a,b,c){return 2*
Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};r.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};r.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};r.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};r.nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};r.lineSegmentLineSegmentDistance3D=function(a,c,h,l){var e,d,g;A[0]=a[0]-h[0];A[1]=a[1]-h[1];A[2]=a[2]-h[2];x[0]=l[0]-
h[0];x[1]=l[1]-h[1];x[2]=l[2]-h[2];if(1E-4>Math.abs(x[0])&&1E-4>Math.abs(x[1])&&1E-4>Math.abs(x[2]))return[!1];I[0]=c[0]-a[0];I[1]=c[1]-a[1];I[2]=c[2]-a[2];if(1E-4>Math.abs(I[0])&&1E-4>Math.abs(I[1])&&1E-4>Math.abs(I[2]))return[!1];c=A[0]*x[0]+A[1]*x[1]+A[2]*x[2];l=x[0]*I[0]+x[1]*I[1]+x[2]*I[2];e=A[0]*I[0]+A[1]*I[1]+A[2]*I[2];d=x[0]*x[0]+x[1]*x[1]+x[2]*x[2];g=(I[0]*I[0]+I[1]*I[1]+I[2]*I[2])*d-l*l;if(1E-4>Math.abs(g))return[!1];e=b((c*l-e*d)/g,0,1);c=b((c+l*e)/d,0,1);K[0]=a[0]+e*I[0];K[1]=a[1]+e*I[1];
K[2]=a[2]+e*I[2];J[0]=h[0]+c*x[0];J[1]=h[1]+c*x[1];J[2]=h[2]+c*x[2];return[!0,f.vec3d.dist(K,J),K,J]};r.pointLineSegmentDistance2D=function(a,c,h){S[0]=c[0]-a[0];S[1]=c[1]-a[1];S[2]=0;P[0]=h[0]-a[0];P[1]=h[1]-a[1];P[2]=0;O[0]=h[0];O[1]=h[1];O[2]=0;c=f.vec3d.dot(P,S);h=f.vec3d.length(S);c=b(c/(h*h),0,1);Q[0]=S[0]*c;Q[1]=S[1]*c;N[0]=a[0]+Q[0];N[1]=a[1]+Q[1];f.vec3d.subtract(O,N,M);a=f.vec3d.length(M);c=f.vec3d.length(P);h=f.vec3d.length(S);var k=f.vec3d.length(Q);if(k>c||k>h)a=Number.MAX_VALUE;return a};
B=function(){var a=window.performance||{};if(a.now)return function(){return a.now()};if(a.webkitNow)return function(){return a.webkitNow()};if(a.mozNow)return function(){return a.mozNow()};if(a.msNow)return function(){return a.msNow()};if(a.oNow)return function(){return a.oNow()};var b;b=a.timing&&a.timing.navigationStart?a.timing.navigationStart:Date.now();return function(){return Date.now()-b}}();r.performance={now:B}})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/gl-matrix".split(" "),
function(B,r,f,a,b,c,t,p){var h=t.assert,l=t.verify,q=p.vec3d,y=p.mat4d,z=t.logWithBase;return function(){function p(){this.dirtySet=new b(this);this._uniqueIdx=0;this._id2origin={};this.content={};for(var c in a)this.content[a[c]]={}}p.prototype.getAll=function(a){a=this.content[a];h(void 0!==a);return a};p.prototype.get=function(a,b){return this.getAll(a)[b]};p.prototype.add=function(b,c){var l=this.content[b];h(void 0!==l);var q=c.getId();h(null==l[q],"Model/Stage already contains object to be added");
l[q]=c;b===a.LAYER&&this.notifyDirty(b,c,"layerAdded")};p.prototype.remove=function(b,c){var l=this.content[b];h(void 0!==l);var q=l[c];h(void 0!==q,"Model/Stage doesn't contain object to be removed");delete l[c];b===a.TEXTURE&&q.unload();b===a.LAYER&&this.notifyDirty(b,q,"layerRemoved");return q};p.prototype.getDirtySet=function(){return this.dirtySet};p.prototype.notifyDirty=function(a,b,c,h){this.dirtySet.handleUpdate(b,c,h)};p.prototype.getOrigin=function(a,b,c){void 0===c&&(c=10);var h=0;b=b*
c/1E4;1<b&&(h=Math.ceil(z(b,2)));b=1E4*Math.pow(2,h);c=Math.round(a[0]/b);var l=Math.round(a[1]/b);a=Math.round(a[2]/b);var h=h+"_"+c+"_"+l+"_"+a,f=this._id2origin[h];null==f&&(f={vec3:q.createFrom(c*b,l*b,a*b),id:h},this._id2origin[h]=f);return f};p.prototype.getGeometryRenderGeometries=function(a,b,h){var l=a.getId(),n=b.geometry,q=n.getData(),f=!!n.singleUse,u=b.materials,p=b.instanceParameters,w=a.getCombinedStaticTransformation(b),t=y.maxScale(w),C=b.origin,n=n.getBoundingInfo(0),z=b.getId()+
"#0",E=this._uniqueIdx++;a=new c(q,n,u[0],w,b.customTransformation,t,a.getCastShadow(),f,l,z,E);a.origin=C||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=p;h.push(a)};p.prototype.updateRenderGeometryTransformation=function(a,b,c){a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(c.transformation)};p.prototype.formatDebugInfo=function(b){var c=[];if(b){c[0]="\x3ctable\x3e";for(var h in a)b=a[h],c[0]+="\x3ctr\x3e\x3ctd\x3e"+b+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+
Object.keys(this.getAll(b)).length+"\x3c/td\x3e\x3c/tr\x3e";c[0]+="\x3c/table\x3e";c[1]=this.dirtySet.formatDebugInfo(!0)}else{c[0]="";for(h in a)b=a[h],c[0]+=f.pad(String(Object.keys(this.getAll(b)).length),6," ")+" "+b+", ";c[1]=this.dirtySet.formatDebugInfo(!1)}return c};p.prototype.validateContent=function(){var b=this.getAll(a.OBJECT),c;for(c in b)this.validateObject(b[c]);var b=this.getAll(a.LAYER),h;for(h in b)this.validateLayer(b[h]);h=this.getAll(a.MATERIAL);for(var l in h)this.validateMaterial(h[l])};
p.prototype.validateObject=function(b){b=b.geometryRecords;for(var c=0;c<b.length;++c){var q=b[c];h(null!=this.get(a.GEOMETRY,q.geometry.id));var f=q.geometry.numGroups;h(f<=q.materials.length,"object materials do not match geometry groups");l(f===q.materials.length,"object materials do not match geometry groups");for(var n=0;n<f;++n)h(null!=this.get(a.MATERIAL,q.materials[n].getId()))}};p.prototype.validateLayer=function(b){b=b.getObjects();for(var c=0;c<b.length;++c){var l=this.get(a.OBJECT,b[c].getId());
h(null!=l)}};p.prototype.validateMaterial=function(b){b=b.getAllTextureIds();for(var c=0;c<b.length;++c){var l=this.get(a.TEXTURE,b[c]);h(null!=l)}};p.ContentType=a;return p}()})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(B,r){return function(){function f(){}f.LAYER="layers";f.OBJECT="objects";f.GEOMETRY="geometries";f.MATERIAL="materials";f.TEXTURE="textures";return f}()})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require",
"exports","./ModelContentType","./ModelDirtyTypesTs","./Util"],function(B,r,f,a,b){var c=b.objectEmpty,t=b.assert;return function(){function a(a){this._residentGeomRecords={};this._dirtyGeomRecords={};this._dirtyMaterials={};this._model=a}Object.defineProperty(a.prototype,"residentLayerCount",{get:function(){return Object.keys(this._residentGeomRecords).length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"residentObjectCount",{get:function(){var a=0,b;for(b in this._residentGeomRecords)a+=
Object.keys(this._residentGeomRecords[b]).length;return a},enumerable:!0,configurable:!0});a.prototype._getResidentGeometryRecords=function(){return this._residentGeomRecords};a.prototype._getDirtyGeometryRecords=function(){return this._dirtyGeomRecords};a.prototype.getDirtyMaterials=function(){return c(this._dirtyMaterials)?null:this._dirtyMaterials};a.prototype.clearDirtyMaterials=function(){this._dirtyMaterials={}};a.prototype.hasDirtyGeometryRecords=function(){for(var a in this._dirtyGeomRecords)for(var b in this._dirtyGeomRecords[a]){var q=
this._dirtyGeomRecords[a][b];if(q&&!c(q))return!0}return!1};a.prototype.handleUpdate=function(a,b,c){t(this[b],"ModelDirtySet doesn't know how to process "+b);return this[b](a,c)};a.prototype.shaderTransformationChanged=function(a){if(a=this._residentGeomRecords[a.getId()])for(var b in a){var c=this._model.content[f.OBJECT][b];if(c&&c.hasVolativeTransformation()){var c=a[b],h;for(h in c)for(var p=0,w=c[h][1];p<w.length;p++)w[p].shaderTransformationChanged()}}};a.prototype.getAddRemoveUpdateList=function(a){return this.getAddRemoveUpdateListFilteredByLayers(Object.keys(this._dirtyGeomRecords),
a)};a.prototype.getAddRemoveUpdateListFilteredByLayers=function(a,b){for(var h=[],l=[],p=[],w=0;w<a.length;w++){var u=a[w];if(u in this._dirtyGeomRecords){for(var C in this._dirtyGeomRecords[u]){var E=this._dirtyGeomRecords[u][C];if(E){var r=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,u,C),n;for(n in E){var A=E[n],x=A[0],I=A[1],A=A[2],K=I&2&&A&1;if(I&4||K){var J=r[n];J?l.push.apply(l,J[1]):4===I&&t(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");b&&J&&delete r[n]}if(I&
1||K){var J=[x,[]],N=this._model.get(f.OBJECT,C);this._model.getGeometryRenderGeometries(N,x,J[1]);h.push.apply(h,J[1]);b&&(r[n]=J)}if(I&2&&!K)if(J=r[n],N=this._model.get(f.OBJECT,C),J){I=J[1];K=I.length;if(A&16)for(J=0;J<K;J++){var M=I[J];this._model.updateRenderGeometryTransformation(N,x,M)}for(J=0;J<K;J++)M=I[J],p.push({renderGeometry:M,updateType:A})}else t(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}c(r)&&delete this._residentGeomRecords[u][C]}}c(this._residentGeomRecords[u])&&
delete this._residentGeomRecords[u]}b&&delete this._dirtyGeomRecords[u]}return[h,l,p]};a.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(Object.keys(this._residentGeomRecords))};a.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var b=[],c=0;c<a.length;c++){var h=a[c];if(h in this._residentGeomRecords)for(var f in this._residentGeomRecords[h]){var p=this._residentGeomRecords[h][f];if(p)for(var u in p)b.push.apply(b,p[u][1])}}return b};
a.prototype.componentVisibilityChanged=function(a,b,c){if(null!=b)this._componentPropertyChanged(a,b,c,2);else{b=0;for(var h=a.getGeometryRecords();b<h.length;b++)this._componentPropertyChanged(a,h[b],c,2)}};a.prototype.componentHighlightChanged=function(a,b,c){if(null!=b)this._componentPropertyChanged(a,b,c,32);else{b=0;for(var h=a.getGeometryRecords();b<h.length;b++)this._componentPropertyChanged(a,h[b],c,32)}};a.prototype.vertexAttrsUpdated=function(a,b,c){this._updateOrCreateDirtyRecord(a,b,c,
2,0,0,2,5,4)};a.prototype.colorAttrsUpdated=function(a,b,c){this._updateOrCreateDirtyRecord(a,b,c,2,0,0,2,5,8)};a.prototype.matChanged=function(a){this._dirtyMaterials[a.getId()]=!0};a.prototype.layerAdded=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectAdded(a,b[c])};a.prototype.layerRemoved=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectRemoved(a,b[c])};a.prototype.layObjectAdded=function(a,b){a=a.getId();for(var c=b.getGeometryRecords(),h=0;h<c.length;h++)this.objGeometryAdded(b,
c[h],a)};a.prototype.layObjectRemoved=function(a,b){a=a.getId();for(var c=b.getGeometryRecords(),h=0;h<c.length;h++)this.objGeometryRemoved(b,c[h],a)};a.prototype.layObjectReplaced=function(a,b){this.layObjectRemoved(a,b[0]);this.layObjectAdded(a,b[1])};a.prototype.objDirty=function(a,b){b=b||this._getParentLayerId(a);var c=a.getId(),c=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,b,c),h;for(h in c)this._updateOrCreateDirtyRecord(a,c[h][0],b,2,0,2,0,5,1)};a.prototype.objTransformation=
function(a,b){b=b||this._getParentLayerId(a);var c=a.getId(),c=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,b,c),h;for(h in c)this._updateOrCreateDirtyRecord(a,c[h][0],b,2,0,0,2,5,16)};a.prototype.objGeometryAdded=function(a,b,c){this._updateOrCreateDirtyRecord(a,b,c,1,4,0,0,0)};a.prototype.objGeometryRemoved=function(a,b,c){this._updateOrCreateDirtyRecord(a,b,c,4,1,2,0,0)};a.prototype.objGeometryReplaced=function(a,b){this.objGeometryRemoved(a,b[0]);this.objGeometryAdded(a,
b[1])};a.prototype.objGeometryTransformation=function(a,b){this.objGeometryReplaced(a,b)};a.prototype._componentPropertyChanged=function(a,b,c,f){this._updateOrCreateDirtyRecord(a,b,c,2,0,0,2,5,f)};a.prototype._updateOrCreateDirtyRecord=function(a,b,c,f,p,w,u,C,E){c=c||this._getParentLayerId(a);var h=a.getId();a=b.getId();c=this._createObjectRecordObjIfNonexistent(this._dirtyGeomRecords,c,h);(h=c[a])?(b=h[1],b&p?delete c[a]:b&w?(h[1]=f,h[2]=E):b&u?h[2]|=E:b&C||t(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):
c[a]=[b,f,E]};a.prototype._createObjectRecordObjIfNonexistent=function(a,b,c){a[b]||(a[b]={});a[b][c]||(a[b][c]={});return a[b][c]};a.prototype._getParentLayerId=function(a){return a.parentLayer.id};a.prototype.formatDebugInfo=function(a){var b=["ADD","UPD",void 0,"REM"];if(a)return"";a="";for(var c in this._dirtyGeomRecords)for(var h in this._dirtyGeomRecords[c]){var f=this._dirtyGeomRecords[c][h];if(f){0<a.length&&(a+="\n");a+=c+"."+h;var p=[],u;for(u in f){var t=f[u][1];p[t]||(p[t]=[]);p[t].push(f[u][0].geometry.id)}for(f=
0;f<p.length;f++)if(p[f])for(a+=" "+b[f-1]+": ",t=0;t<p[f].length;t++)a+=p[f][t]+", "}}return a};return a}()})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypesTs":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define(["require","exports","./gl-matrix"],function(B,r,f){var a=f.vec3d,b=f.mat4d;return function(){function c(b,c,h,l,q,f,z,w,u,C,E){this.shaderTransformationDirty=!0;this.data=
b.toRenderData();this.componentOffsets=b.componentOffsets;this.boundingInfo=c;this.material=h;this.origin=null;this.center=a.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=q;l&&this.updateTransformation(l,f);this.castShadow=z;this.singleUse=w;this.name=u;this.uniqueName=C;this.idx=E;this.canBeMerged=!0;this.instanceParameters={}}c.prototype.updateTransformation=function(a,b){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,
b,this.center)};c.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};c.prototype.getBoundingSphere=function(a,c,h){c=c||b.maxScale(a);b.multiplyVec3(a,this.boundingInfo.getCenter(),h);return this.boundingInfo.getBSRadius()*c};Object.defineProperty(c.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});c.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&
(this.shaderTransformation||(this.shaderTransformation=b.create()),b.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation};return c}()})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","./Util"],function(B,r,f){function a(a){return Math.abs(a*a*a)}function b(b,c,h,q){void 0===q&&(q=l);var f=h.parameters;h=h.paddingPixelsOverride;q.scale=
Math.min(f.divisor/(c-f.offset),1);q.factor=a(b);q.minPixelSize=f.minPixelSize;q.paddingPixels=h;return q}function c(a,b){return Math.max(f.lerp(a*b.scale,a,b.factor),b.minPixelSize*(1+2*b.paddingPixels/a))}function t(a,h,l){a=b(a,h,l);a.minPixelSize=0;a.paddingPixels=0;return c(1,a)}Object.defineProperty(r,"__esModule",{value:!0});r.getSettings=function(a){return new p(a,r.defaultDescription)};r.getLabelSettings=function(a){var b=r.defaultDescription.curvatureDependent;return new p(a,{curvatureDependent:{min:{curvature:b.min.curvature,
tiltAngle:b.min.tiltAngle,scaleFallOffFactor:h.curvatureDependent.min.scaleFallOffFactor},max:{curvature:b.max.curvature,tiltAngle:b.max.tiltAngle,scaleFallOffFactor:h.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r.defaultDescription.scaleStart,scaleFallOffRange:r.defaultDescription.scaleFallOffRange,minPixelSize:h.minPixelSize})};r.perspectiveFactor=a;r.scaleFactor=b;r.applyScaleFactor=c;r.applyScaleFactorVec2=function(a,b,c){void 0===c&&(c=[0,0]);var h=Math.min(Math.max(b.scale,b.minPixelSize*
(1+2*b.paddingPixels/a[1])/a[1]),1);c[0]=f.lerp(a[0]*h,a[0],b.factor);c[1]=f.lerp(a[1]*h,a[1],b.factor);return c};r.precomputeScale=t;r.precomputeScaleFactor=function(a,b,c,h){h.scale=t(a,b,c);h.factor=0;h.minPixelSize=c.parameters.minPixelSize;h.paddingPixels=c.paddingPixelsOverride;return h};r.applyPrecomputedScaleFactorVec2=function(a,b,c){void 0===c&&(c=[0,0]);b=Math.min(Math.max(b.scale,b.minPixelSize*(1+2*b.paddingPixels/a[1])/a[1]),1);c[0]=a[0]*b;c[1]=a[1]*b;return c};r.scale=function(a,h,
l,q){return c(a,b(h,l,q))};var p=function(){function a(a,b,c,h){void 0===c&&(c={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=b;this.parameters=c;this._paddingPixelsOverride=h;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=
this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(b){return b!==this.paddingPixelsOverride?new a(this.viewingMode,
this.description,this.parameters,b):this};a.prototype.calculateParameters=function(a,b){var c=this.description,h=c.scaleStart,l=c.scaleFallOffRange,c=c.minPixelSize,n=a.fovY,q=a.distance,f=this.calculateCurvatureDependentParameters(a),u=this.coverageCompensation(a,f),p=f.tiltAngle,f=f.scaleFallOffFactor,q=Math.sin(p)*q,p=.5*Math.PI-p-n*(.5-h*u),h=q/Math.cos(p),l=(h-q/Math.cos(p+n*l*u)*f)/(1-f);b.camera.fovY=a.fovY;b.camera.distance=a.distance;b.offset=l;b.divisor=h-l;b.minPixelSize=c;return b};a.prototype.calculateCurvatureDependentParametersLocal=
function(a,b){void 0===b&&(b=q);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return b};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,b){void 0===b&&(b=q);var c=this.description.curvatureDependent;a=1+a.distance/y;var h=[c.min.curvature,c.max.curvature],l=h[0];a=f.clamp((Math.sqrt(a*a-1)-l)/(h[1]-l),0,1);h=[c.min,c.max];c=h[0];h=h[1];b.tiltAngle=f.lerp(c.tiltAngle,h.tiltAngle,a);b.scaleFallOffFactor=
f.lerp(c.scaleFallOffFactor,h.scaleFallOffFactor,a);return b};a.prototype.surfaceCoverageCompensationLocal=function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,b){var c=y*y;b=b.tiltAngle+.5*Math.PI;var h=a.fovY;a=a.distance;a=a*a+c-2*Math.cos(b)*a*y;var l=Math.sqrt(a);return(Math.acos(Math.sqrt(a-c)/l)-Math.asin(y/(l/Math.sin(b)))+.5*h)/h};return a}();r.defaultDescription={curvatureDependent:{min:{curvature:f.deg2rad(10),tiltAngle:f.deg2rad(12),
scaleFallOffFactor:.5},max:{curvature:f.deg2rad(70),tiltAngle:f.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var h={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};r.copyParameters=function(a,b){b.camera.distance=a.camera.distance;b.camera.fovY=a.camera.fovY;b.divisor=a.divisor;b.offset=a.offset;b.minPixelSize=a.minPixelSize;return b};var l={scale:0,factor:0,minPixelSize:0,paddingPixels:0},q={tiltAngle:0,scaleFallOffFactor:0},
y=6378137})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error"],function(B,r,f,a){return function(){function b(){}b.vertexCount=function(a,f){return a.vertexBuffers[f].size/b.getStride(a.layout[f])};b.getStride=function(a){return a[0].stride};b.getBytesPerElement=function(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");
}};b.addDescriptor=function(a,f,p,h,l,q){var c=b.getBytesPerElement(h);if(0<a.length){var t=a[0].stride,w=t+c*p;a.forEach(function(a){return a.stride=w});a.push({name:f,count:p,type:h,offset:t,stride:w,normalized:l,divisor:q})}else a.push({name:f,count:p,type:h,offset:0,stride:c*p,normalized:l,divisor:q})};b.assertCompatibleVertexAttributeLocations=function(a,b){(a=a.locations===b.locations)||console.error("VertexAttributeLocations are incompatible");return a};b.hasAttribute=function(a,b){for(var c=
0;c<a.length;c++)if(a[c].name===b)return!0;return!1};b.findAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null};b.copyFramebufferToTexture=function(a,b,f,h,l){void 0===l&&(l=0);var c=a.getBoundFramebufferObject(),p=a.getBoundTexture(0);a.bindFramebuffer(b);a.bindTexture(f,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,l,f.descriptor.pixelFormat,h[0],h[1],h[2],h[3],0);a.gl.flush();a.bindFramebuffer(c);a.bindTexture(p,0)};b.assert=function(b,f){if(!b)throw new a(f);};
b.setBaseInstanceOffset=function(a,b){var c={},h;for(h in a)c[h]=a[h].map(function(a){return a.divisor?f({},a,{baseInstance:b}):a});return c};return b}()})},"esri/views/3d/support/aaBoundingBox":function(){define(["require","exports","./aaBoundingRect","../../../geometry/Extent"],function(B,r,f,a){function b(a){return a[0]>=a[3]?0:a[3]-a[0]}function c(a){return a[1]>=a[4]?0:a[4]-a[1]}function t(a){return a[2]>=a[5]?0:a[5]-a[2]}function p(a){return 6===a.length}Object.defineProperty(r,"__esModule",
{value:!0});r.create=function(a){void 0===a&&(a=r.ZERO);return[a[0],a[1],a[2],a[3],a[4],a[5]]};r.fromExtent=function(a){return[a.xmin,a.ymin,a.zmin,a.xmax,a.ymax,a.zmax]};r.toExtent=function(b,c){return isFinite(b[2])||isFinite(b[5])?new a({xmin:b[0],xmax:b[3],ymin:b[1],ymax:b[4],zmin:b[2],zmax:b[5],spatialReference:c}):new a({xmin:b[0],xmax:b[3],ymin:b[1],ymax:b[4],spatialReference:c})};r.fromMinMax=function(a,b){return[a[0],a[1],a[2],b[0],b[1],b[2]]};r.expand=function(a,b,c){void 0===c&&(c=a);var h=
b.declaredClass;"esri.geometry.Extent"===h?(c[0]=Math.min(a[0],b.xmin),c[1]=Math.min(a[1],b.ymin),c[3]=Math.max(a[3],b.xmax),c[4]=Math.max(a[4],b.ymax),b.hasZ&&(c[2]=Math.min(a[2],b.zmin),c[5]=Math.max(a[5],b.zmax))):"esri.geometry.Point"===h?(c[0]=Math.min(a[0],b.x),c[1]=Math.min(a[1],b.y),c[3]=Math.max(a[3],b.x),c[4]=Math.max(a[4],b.y),b.hasZ&&(c[2]=Math.min(a[2],b.z),c[5]=Math.max(a[5],b.z))):p(b)?(c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[2]=Math.min(a[2],b[2]),c[3]=Math.max(a[3],b[3]),
c[4]=Math.max(a[4],b[4]),c[5]=Math.max(a[5],b[5])):f.is(b)?(c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[3]=Math.max(a[3],b[2]),c[4]=Math.max(a[4],b[3])):Array.isArray(b)&&(2===b.length?(c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[3]=Math.max(a[3],b[0]),c[4]=Math.max(a[4],b[1])):3===b.length&&(c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[2]=Math.min(a[2],b[2]),c[3]=Math.max(a[3],b[0]),c[4]=Math.max(a[4],b[1]),c[5]=Math.max(a[5],b[2])));return c};r.expandBuffer=function(a,b,c,
f,p){void 0===p&&(p=a);var h=a[0],l=a[1],q=a[2],t=a[3],y=a[4];a=a[5];for(var n=0;n<f;n++)h=Math.min(h,b[c+3*n]),l=Math.min(l,b[c+3*n+1]),q=Math.min(q,b[c+3*n+2]),t=Math.max(t,b[c+3*n]),y=Math.max(y,b[c+3*n+1]),a=Math.max(a,b[c+3*n+2]);p[0]=h;p[1]=l;p[2]=q;p[3]=t;p[4]=y;p[5]=a;return p};r.allFinite=function(a){for(var b=0;6>b;b++)if(!isFinite(a[b]))return!1;return!0};r.width=b;r.depth=c;r.height=t;r.center=function(a,l){void 0===l&&(l=[0,0,0]);l[0]=a[0]+b(a)/2;l[1]=a[1]+c(a)/2;l[2]=a[2]+t(a)/2;return l};
r.size=function(a,l){void 0===l&&(l=[0,0,0]);l[0]=b(a);l[1]=c(a);l[2]=t(a);return l};r.containsPoint=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[0]<=a[3]&&b[1]<=a[4]&&b[2]<=a[5]};r.containsPointWithMargin=function(a,b,c){return b[0]>=a[0]-c&&b[1]>=a[1]-c&&b[2]>=a[2]-c&&b[0]<=a[3]+c&&b[1]<=a[4]+c&&b[2]<=a[5]+c};r.contains=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[3]<=a[3]&&b[4]<=a[4]&&b[5]<=a[5]};r.intersects=function(a,b){return Math.max(b[0],a[0])<=Math.min(b[3],a[3])&&
Math.max(b[1],a[1])<=Math.min(b[4],a[4])&&Math.max(b[2],a[2])<=Math.min(b[5],a[5])};r.offset=function(a,b,c,f,p){void 0===p&&(p=a);p[0]=a[0]+b;p[1]=a[1]+c;p[2]=a[2]+f;p[3]=a[3]+b;p[4]=a[4]+c;p[5]=a[5]+f;return p};r.setMin=function(a,b,c){void 0===c&&(c=a);c[0]=b[0];c[1]=b[1];c[2]=b[2];c!==a&&(c[3]=a[3],c[4]=a[4],c[5]=a[5]);return c};r.setMax=function(a,b,c){void 0===c&&(c=a);c[3]=b[0];c[4]=b[1];c[5]=b[2];c!==a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);return a};r.set=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=
b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};r.toRect=function(a,b){b||(b=f.create());b[0]=a[0];b[1]=a[1];b[2]=a[3];b[3]=a[4];return b};r.fromRect=function(a,b){a[0]=b[0];a[1]=b[1];a[3]=b[2];a[4]=b[3];return a};r.is=p;r.isPoint=function(a){return 0===b(a)&&0===c(a)&&0===t(a)};r.equals=function(a,b,c){if(null==a||null==b)return a===b;if(!p(a)||!p(b))return!1;if(c)for(var h=0;h<a.length;h++){if(!c(a[h],b[h]))return!1}else for(h=0;h<a.length;h++)if(a[h]!==b[h])return!1;return!0};r.POSITIVE_INFINITY=
[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];r.NEGATIVE_INFINITY=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];r.ZERO=[0,0,0,0,0,0]})},"esri/views/3d/support/aaBoundingRect":function(){define(["require","exports"],function(B,r){function f(a){return a[0]>=a[2]?0:a[2]-a[0]}function a(a){return a[1]>=a[3]?0:a[3]-a[1]}function b(a){return 4===a.length}Object.defineProperty(r,"__esModule",{value:!0});r.create=function(a){void 0===a&&(a=r.ZERO);return[a[0],a[1],a[2],a[3]]};r.fromExtent=
function(a){return[a.xmin,a.ymin,a.xmax,a.ymax]};r.expand=function(a,f,p){void 0===p&&(p=a);var c=f.declaredClass;"esri.geometry.Extent"===c?(p[0]=Math.min(a[0],f.xmin),p[1]=Math.min(a[1],f.ymin),p[2]=Math.max(a[2],f.xmax),p[3]=Math.max(a[3],f.ymax)):"esri.geometry.Point"===c?(p[0]=Math.min(a[0],f.x),p[1]=Math.min(a[1],f.y),p[2]=Math.max(a[2],f.x),p[3]=Math.max(a[3],f.y)):b(f)?(p[0]=Math.min(a[0],f[0]),p[1]=Math.min(a[1],f[1]),p[2]=Math.max(a[2],f[2]),p[3]=Math.max(a[3],f[3])):!Array.isArray(f)||
2!==f.length&&3!==f.length||(p[0]=Math.min(a[0],f[0]),p[1]=Math.min(a[1],f[1]),p[2]=Math.max(a[2],f[0]),p[3]=Math.max(a[3],f[1]));return p};r.allFinite=function(a){for(var b=0;4>b;b++)if(!isFinite(a[b]))return!1;return!0};r.width=f;r.height=a;r.center=function(b,t){void 0===t&&(t=[0,0]);t[0]=b[0]+f(b)/2;t[1]=b[1]+a(b)/2;return t};r.containsPoint=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};r.containsPointWithMargin=function(a,b,f){return b[0]>=a[0]-f&&b[1]>=a[1]-f&&b[0]<=a[2]+
f&&b[1]<=a[3]+f};r.intersects=function(a,b){return Math.max(b[0],a[0])<=Math.min(b[2],a[2])&&Math.max(b[1],a[1])<=Math.min(b[3],a[3])};r.offset=function(a,b,f,h){void 0===h&&(h=a);h[0]=a[0]+b;h[1]=a[1]+f;h[2]=a[2]+b;h[3]=a[3]+f;return h};r.setMin=function(a,b,f){void 0===f&&(f=a);f[0]=b[0];f[1]=b[1];f!==a&&(f[2]=a[2],f[3]=a[3]);return f};r.setMax=function(a,b,f){void 0===f&&(f=a);f[2]=b[0];f[3]=b[1];f!==a&&(f[0]=a[0],f[1]=a[1]);return a};r.set=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];
return a};r.is=b;r.isPoint=function(b){return(0===f(b)||!isFinite(b[0]))&&(0===a(b)||!isFinite(b[1]))};r.equals=function(a,f,p){if(null==a||null==f)return a===f;if(!b(a)||!b(f))return!1;if(p)for(var c=0;c<a.length;c++){if(!p(a[c],f[c]))return!1}else for(c=0;c<a.length;c++)if(a[c]!==f[c])return!1;return!0};r.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];r.NEGATIVE_INFINITY=[Infinity,Infinity,-Infinity,-Infinity];r.ZERO=[0,0,0,0]})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require",
"exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.Default3D={position:0,normal:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12}})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports"],function(B,r){return function(){function f(a,b,c,t,p){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=
!1;this._context=a;this._layout=c;this._buffers=t;this._locations=b;p&&(this._indexBuffer=p);this._id=f._nextId++}Object.defineProperty(f.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"indexBuffer",{get:function(){return this._indexBuffer},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});f.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var b=this._context.extensions.vao;b&&this._glName&&(b.deleteVertexArrayOES(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);
if(a){for(var c in this._buffers)this._buffers[c].dispose(),delete this._buffers[c];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};f.prototype.initialize=function(){if(!this._initialized){var a=this._context.extensions.vao;if(a){var b=a.createVertexArrayOES();a.bindVertexArrayOES(b);this._bindLayout();a.bindVertexArrayOES(null);this._glName=b}this._initialized=!0}};f.prototype.bind=function(){this.initialize();var a=this._context.extensions.vao;a?a.bindVertexArrayOES(this.glName):
(this._context.bindVAO(null),this._bindLayout())};f.prototype._bindLayout=function(){var a=this._buffers,b=this._context.extensions.vao,c=this._layout,f=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var p=this._context.gl,h,l,q=0,y;for(y in a)for((h=a[y])||console.error("Vertex buffer is uninitialized!"),(l=c[y])||console.error("Vertex element descriptor is empty!"),this._context.bindBuffer(h),q=0;q<l.length;++q){h=l[q];var z=this._locations[h.name],w=h.baseInstance?h.baseInstance*
h.stride:0;void 0===z&&console.error("There is no location for vertex attribute '"+h.name+"' defined.");h.baseInstance&&!h.divisor&&console.error("Vertex attribute '"+h.name+"' uses baseInstanceOffset without divisor.");if(4>=h.count){if(p.enableVertexAttribArray(z),p.vertexAttribPointer(z,h.count,h.type,h.normalized,h.stride,h.offset+w),h.divisor&&0<h.divisor){var u=this._context.extensions.angleInstancedArrays;u&&u.vertexAttribDivisorANGLE(z,h.divisor)}}else if(16===h.count&&5126===h.type)for(var C=
0;4>C;C++)p.enableVertexAttribArray(z+C),p.vertexAttribPointer(z+C,4,h.type,h.normalized,h.stride,h.offset+16*C+w),h.divisor&&0<h.divisor&&(u=this._context.extensions.angleInstancedArrays)&&u.vertexAttribDivisorANGLE(z+C,h.divisor);else console.error("Unsupported vertex attribute element count: "+h.count)}f&&(b?p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,f.glName):this._context.bindBuffer(f))};f.prototype.unbind=function(){this.initialize();var a=this._context.extensions.vao;a?a.bindVertexArrayOES(null):
this._unbindLayout()};f.prototype._unbindLayout=function(){var a=this._buffers,b=this._layout,c=this._locations,f=this._context;a||console.error("Vertex buffer dictionary is empty!");var p=f.gl,h,l,q,y=0,z=0,w;for(w in a){(h=a[w])||console.error("Vertex buffer is uninitialized!");l=b[w];y=0;for(z=l.length;y<z;++y)q=l[y],p.disableVertexAttribArray(c[q.name]);f.unbindBuffer(h.bufferType)}(a=this._indexBuffer)&&f.unbindBuffer(a.bufferType)};f._nextId=0;return f}()})},"esri/views/webgl/BufferObject":function(){define(["require",
"exports"],function(B,r){return function(){function f(a,b,c,t,p){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=a;this._bufferType=b;this._usage=c;this._id=f._nextId++;this._glName=this._context.gl.createBuffer();t&&this.setData(t,p)}f.createIndex=function(a,b,c,t){return new f(a,34963,b,c,t)};f.createVertex=function(a,b,c){return new f(a,34962,b,c)};Object.defineProperty(f.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});f.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};f.prototype.setData=function(a,b){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),
34963===this._bufferType&&b)switch(this._indexType=b,this._size=a,b){case 5123:a*=2;break;case 5125:a*=4}}else b=a.byteLength,a instanceof Uint16Array&&(b/=2,this._indexType=5123),a instanceof Uint32Array&&(b/=4,this._indexType=5125),this._size=b;b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(b)}};f.prototype.setSubData=function(a,b,c,f){void 0===b&&(b=0);void 0===c&&(c=0);if(a){(0>
b||b>=this._size)&&console.error("offset is out of range!");var p=b,h=c,l=f,q=a.byteLength;a instanceof Uint16Array&&(q/=2,p*=2,h*=2,l*=2);a instanceof Uint32Array&&(q/=4,p*=4,h*=4,l*=4);void 0===f&&(f=q-1);c>=f&&console.error("end must be bigger than start!");b+c-f>this._size&&console.error("An attempt to write beyond the end of the buffer!");b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferSubData(this._bufferType,p,(a instanceof ArrayBuffer?
a:a.buffer).slice(h,l));this._context.bindVAO(b)}};f._nextId=0;return f}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.BASE_TEXTURE_UNIT=33984})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define(["./GeometryData","./BufferVectorMath","./Util","./gl-matrix"],function(B,r,f,a){function b(a,b,h,l,f){if(Math.abs(c.dot(b,a))>f)return!1;c.cross(a,b,h);c.normalize(h);c.cross(h,a,l);c.normalize(l);return!0}
var c=a.vec3,t=a.vec4,p=a.vec3d,h=f.VertexAttrConstants,l=r.Vec3Compact,q=p.create(),y=p.create(),z={createSphereGeometry:function(a,b,l,q,p,n,t){a=a||50;q=void 0!==q?q:-Math.PI;p=void 0!==p?p:2*Math.PI;n=void 0!==n?n:.5*-Math.PI;t=void 0!==t?t:Math.PI;var u=Math.max(3,Math.floor(b)||8),w=Math.max(2,Math.floor(l)||6),y=(u+1)*(w+1);l=new Float32Array(3*y);b=new Float32Array(3*y);var y=new Float32Array(2*y),C,z,A=[],E=c.create(),r=0;for(z=0;z<=w;z++){var G=[],O=z/w,T=n+O*t,U=Math.cos(T);for(C=0;C<=
u;C++){var W=C/u,k=q+W*p,ca=Math.cos(k)*U*a,V=Math.sin(T)*a,k=-Math.sin(k)*U*a;l[3*r]=ca;l[3*r+1]=V;l[3*r+2]=k;c.set3(ca,V,k,E);c.normalize(E);b[3*r]=E[0];b[3*r+1]=E[1];b[3*r+2]=E[2];y[2*r]=W;y[2*r+1]=O;G.push(r);++r}A.push(G)}a=new Uint32Array(2*u*(w-1)*3);for(z=r=0;z<w;z++)for(C=0;C<u;C++)q=A[z][C],p=A[z][C+1],n=A[z+1][C+1],t=A[z+1][C],0===z?(a[r++]=q,a[r++]=n,a[r++]=t):z===w-1?(a[r++]=q,a[r++]=p,a[r++]=n):(a[r++]=q,a[r++]=p,a[r++]=n,a[r++]=n,a[r++]=t,a[r++]=q);f.assert(r===a.length);u={};u[h.POSITION]=
a;u[h.NORMAL]=a;u[h.UV0]=a;w={};w[h.POSITION]={size:3,data:l};w[h.NORMAL]={size:3,data:b};w[h.UV0]={size:2,data:y};return new B(w,u)},createPolySphereGeometry:function(a,b,c){function f(b,c){b>c&&(b=c+(c=b,0));var h=b.toString()+"."+c.toString();if(u[h])return u[h];var k=n.length;n.length+=3;l.add(n,3*b,n,3*c,n,k);l.scale(n,k,a/l.length(n,k));k/=3;return u[h]=k}var q,n;c?(n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],c=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(c=a*(1+Math.sqrt(5))/2,n=[-a,
c,0,a,c,0,-a,-c,0,a,-c,0,0,-a,c,0,a,c,0,-a,-c,0,a,-c,c,0,-a,c,0,a,-c,0,-a,-c,0,a],c=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(q=0;q<n.length;q+=3)l.scale(n,q,a/l.length(n,q));var u={};for(q=0;q<b;q++){for(var p=c.length,w=new Uint32Array(4*p),t=0;t<p;t+=3){var y=c[t],C=c[t+1],z=c[t+2],r=f(y,C),S=f(C,z),P=f(z,y),O=4*t;w[O]=y;w[O+1]=r;w[O+2]=P;w[O+3]=C;w[O+4]=S;w[O+5]=r;w[O+6]=z;w[O+7]=P;w[O+8]=S;w[O+9]=r;
w[O+10]=S;w[O+11]=P}c=w;u={}}b=new Float32Array(n);for(q=0;q<b;q+=3)l.normalize(b,q);n=new Float32Array(n);q={};q[h.POSITION]=c;q[h.NORMAL]=c;c={};c[h.POSITION]={size:3,data:n};c[h.NORMAL]={size:3,data:b};return new B(c,q)},createPointGeometry:function(a,b,c,l,f,n,q){var u=new Float32Array(3);u[0]=b?b[0]:0;u[1]=b?b[1]:0;u[2]=b?b[2]:0;b=new Float32Array(3);b[0]=a?a[0]:0;b[1]=a?a[1]:0;b[2]=a?a[2]:1;if(null==n)a=new Float32Array(2),a[0]=0,a[1]=0;else{a=new Float32Array(n.length);for(var p=0;p<n.length;p++)a[p]=
n[p]}n=new Uint8Array(4);n[0]=c?255*c[0]:255;n[1]=c?255*c[1]:255;n[2]=c?255*c[2]:255;n[3]=c&&3<c.length?255*c[3]:255;c=new Float32Array(2);c[0]=null!=l&&2==l.length?l[0]:1;c[1]=null!=l&&2==l.length?l[1]:1;if(null!=f){var w=new Float32Array(4);w[0]=f[0];w[1]=f[1];w[2]=f[2];w[3]=f[3]}if(null!=q){var t=new Float32Array(4);t[0]=q[0];t[1]=q[1];t[2]=q[2];t[3]=q[3]}p=new Uint32Array(1);p[0]=0;l={};l[h.POSITION]=p;l[h.NORMAL]=p;l[h.UV0]=p;l[h.COLOR]=p;l[h.SIZE]=p;null!=f&&(l[h.AUXPOS1]=p);null!=q&&(l[h.AUXPOS2]=
p);p={};p[h.POSITION]={size:3,data:u};p[h.NORMAL]={size:3,data:b};p[h.UV0]={size:a.length,data:a};p[h.COLOR]={size:4,data:n};p[h.SIZE]={size:2,data:c};null!=f&&(p[h.AUXPOS1]={size:4,data:w});null!=q&&(p[h.AUXPOS2]={size:4,data:t});return new B(p,l,B.DefaultOffsets,"point")},createPointArrayGeometry:function(a,b){for(var c=new Float32Array(3*a.length),l=new Float32Array(b?3*a.length:3),f=new Uint32Array(a.length),n=new Uint32Array(a.length),q=0;q<a.length;q++)c[3*q]=a[q][0],c[3*q+1]=a[q][1],c[3*q+
2]=a[q][2],b&&(l[3*q]=b[q][0],l[3*q+1]=b[q][1],l[3*q+2]=b[q][2]),f[q]=q,n[q]=0;b||(l[0]=0,l[1]=1,l[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;q={};q[h.POSITION]=f;q[h.NORMAL]=b?f:n;q[h.UV0]=n;b={};b[h.POSITION]={size:3,data:c};b[h.NORMAL]={size:3,data:l};b[h.UV0]={size:2,data:a};return new B(b,q,B.DefaultOffsets,"point")},createTriangleGeometry:function(){var a=new Float32Array(9);a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=100;a[6]=100;a[7]=0;a[8]=0;var b=new Uint32Array(3);b[0]=0;b[1]=1;b[2]=2;var c=
new Float32Array(3);c[0]=0;c[1]=1;c[2]=0;var l=new Uint32Array(3);l[0]=0;l[1]=0;l[2]=0;var f=new Float32Array(2);f[0]=0;f[1]=0;var n=new Uint32Array(3);n[0]=0;n[1]=0;n[2]=0;var q={};q[h.POSITION]=b;q[h.NORMAL]=l;q[h.UV0]=n;b={};b[h.POSITION]={size:3,data:a};b[h.NORMAL]={size:3,data:c};b[h.UV0]={size:2,data:f};return new B(b,q)},createSquareGeometry:function(a){var b,c,l=new Float32Array(12);if(a)for(b=0;4>b;b++)for(c=0;3>c;c++)l[3*b+c]=a[b][c];else l[0]=-1,l[1]=-1,l[2]=0,l[3]=1,l[4]=-1,l[5]=0,l[6]=
1,l[7]=1,l[8]=0,l[9]=-1,l[10]=1,l[11]=0;c=new Uint32Array(6);c[0]=0;c[1]=1;c[2]=2;c[3]=2;c[4]=3;c[5]=0;a=new Float32Array(3);a[0]=0;a[1]=0;a[2]=1;var f=new Uint32Array(6);for(b=0;6>b;b++)f[b]=0;b=new Float32Array(8);b[0]=0;b[1]=0;b[2]=1;b[3]=0;b[4]=1;b[5]=1;b[6]=0;b[7]=1;var n=new Uint8Array(4);n[0]=255;n[1]=255;n[2]=255;n[3]=255;var q={};q[h.POSITION]=c;q[h.NORMAL]=f;q[h.UV0]=c;q[h.COLOR]=f;c={};c[h.POSITION]={size:3,data:l};c[h.NORMAL]={size:3,data:a};c[h.UV0]={size:2,data:b};c[h.COLOR]={size:4,
data:n};return new B(c,q)},createBoxGeometry:function(){var a,b,c=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],l=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],f=[0,0,1,0,1,1,0,1],n=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],q=Array(36);for(a=0;6>a;a++)for(b=0;6>b;b++)q[6*a+b]=a;var p=Array(36);for(a=0;6>a;a++)p[6*a+0]=0,p[6*a+1]=1,p[6*a+2]=2,p[6*a+3]=2,p[6*a+4]=3,p[6*a+5]=0;return function(a){var b;Array.isArray(a)||
(a=[a,a,a]);var u=new Float32Array(24);for(b=0;8>b;b++)u[3*b]=c[b][0]*a[0],u[3*b+1]=c[b][1]*a[1],u[3*b+2]=c[b][2]*a[2];a={};a[h.POSITION]=new Uint32Array(n);a[h.NORMAL]=new Uint32Array(q);a[h.UV0]=new Uint32Array(p);b={};b[h.POSITION]={size:3,data:u};b[h.NORMAL]={size:3,data:new Float32Array(l)};b[h.UV0]={size:2,data:new Float32Array(f)};return new B(b,a)}}(),createDiamondGeometry:function(){var a=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],b=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,
1,-1,0,0,-1,1,-1,-1,0],c=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],l=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];return function(f){var n;Array.isArray(f)||(f=[f,f,f]);var q=new Float32Array(18);for(n=0;6>n;n++)q[3*n]=a[n][0]*f[0],q[3*n+1]=a[n][1]*f[1],q[3*n+2]=a[n][2]*f[2];f={};f[h.POSITION]=new Uint32Array(c);f[h.NORMAL]=new Uint32Array(l);n={};n[h.POSITION]={size:3,data:q};n[h.NORMAL]={size:3,data:new Float32Array(b)};return new B(n,f)}}(),createTetrahedronGeometry:function(){var a=
c.createFrom(-.5,0,-.5),b=c.createFrom(.5,0,-.5),l=c.createFrom(0,0,.5),f=c.createFrom(0,.5,0),q=c.create(),n=c.create(),p=c.create(),t=c.create(),y=c.create();c.subtract(a,f,q);c.subtract(a,b,n);c.cross(q,n,p);c.normalize(p,p);c.subtract(b,f,q);c.subtract(b,l,n);c.cross(q,n,t);c.normalize(t,t);c.subtract(l,f,q);c.subtract(l,a,n);c.cross(q,n,y);c.normalize(y,y);var z=[a,b,l,f],r=[0,-1,0,p[0],p[1],p[2],t[0],t[1],t[2],y[0],y[1],y[2]],N=[0,1,2,3,1,0,3,2,1,3,0,2],M=[0,0,0,1,1,1,2,2,2,3,3,3];return function(a){var b;
Array.isArray(a)||(a=[a,a,a]);var c=new Float32Array(12);for(b=0;4>b;b++)c[3*b]=z[b][0]*a[0],c[3*b+1]=z[b][1]*a[1],c[3*b+2]=z[b][2]*a[2];a={};a[h.POSITION]=new Uint32Array(N);a[h.NORMAL]=new Uint32Array(M);b={};b[h.POSITION]={size:3,data:c};b[h.NORMAL]={size:3,data:new Float32Array(r)};return new B(b,a)}}(),createConeGeometry:function(a,b,l,f){var q=0,n=c.createFrom(0,q,0),u=c.createFrom(0,q+a,0),p=c.createFrom(0,-1,0),t=c.createFrom(0,1,0);f&&(q=a,u=c.createFrom(0,0,0),n=c.createFrom(0,q,0),p=c.createFrom(0,
1,0),t=c.createFrom(0,-1,0));var n=[u,n],p=[p,t],t=l+2,w=0,u=Math.sqrt(a*a+b*b);if(f)for(f=l-1;0<=f;f--)w=2*Math.PI/l*f,y=c.createFrom(Math.cos(w)*b,q,Math.sin(w)*b),n.push(y),w=c.createFrom(a*Math.cos(w)/u,-b/u,a*Math.sin(w)/u),p.push(w);else for(f=0;f<l;f++){var w=2*Math.PI/l*f,y=c.createFrom(Math.cos(w)*b,q,Math.sin(w)*b);n.push(y);w=c.createFrom(a*Math.cos(w)/u,b/u,a*Math.sin(w)/u);p.push(w)}a=new Uint32Array(6*(l+2));l=new Uint32Array(6*(l+2));q=b=0;for(f=3;f<n.length;f++)a[b++]=1,a[b++]=f-1,
a[b++]=f,l[q++]=0,l[q++]=0,l[q++]=0;a[b++]=n.length-1;a[b++]=2;a[b++]=1;l[q++]=0;l[q++]=0;l[q++]=0;for(f=3;f<n.length;f++)a[b++]=f,a[b++]=f-1,a[b++]=0,l[q++]=f,l[q++]=f-1,l[q++]=1;a[b++]=0;a[b++]=2;a[b++]=n.length-1;l[q++]=1;l[q++]=2;l[q++]=p.length-1;q=1;Array.isArray(q)||(q=[q,q,q]);b=new Float32Array(3*t);for(f=0;f<t;f++)b[3*f]=n[f][0]*q[0],b[3*f+1]=n[f][1]*q[1],b[3*f+2]=n[f][2]*q[2];n=new Float32Array(3*t);for(f=0;f<t;f++)n[3*f]=p[f][0],n[3*f+1]=p[f][1],n[3*f+2]=p[f][2];p={};p[h.POSITION]=a;p[h.NORMAL]=
l;t={};t[h.POSITION]={size:3,data:b};t[h.NORMAL]={size:3,data:n};return new B(t,p)},createCylinderGeometry:function(a,b,l,f,q,n){f||(f=c.createFrom(1,0,0));q||(q=c.createFrom(0,0,0));n=void 0===n?!0:n;var u=c.create();c.normalize(f,u);f=c.create();c.scale(u,Math.abs(a),f);var p=c.create();c.scale(f,-.5,p);c.add(p,q);var t=c.createFrom(0,1,0);Math.abs(.2>1-c.dot(u,t))&&c.set3(0,0,1,t);var w=c.create();c.cross(u,t,w);c.normalize(w);c.cross(w,u,t);var y=2*l+(n?2:0),z=l+(n?2:0);q=new Float32Array(3*y);
a=new Float32Array(3*z);var C=new Float32Array(2*y),E=new Uint32Array(3*l*(n?4:2)),r=new Uint32Array(3*l*(n?4:2));n&&(q[3*(y-2)+0]=p[0],q[3*(y-2)+1]=p[1],q[3*(y-2)+2]=p[2],C[2*(y-2)]=0,C[2*(y-2)+1]=0,q[3*(y-1)+0]=q[3*(y-2)+0]+f[0],q[3*(y-1)+1]=q[3*(y-2)+1]+f[1],q[3*(y-1)+2]=q[3*(y-2)+2]+f[2],C[2*(y-1)]=1,C[2*(y-1)+1]=1,a[3*(z-2)+0]=-u[0],a[3*(z-2)+1]=-u[1],a[3*(z-2)+2]=-u[2],a[3*(z-1)+0]=u[0],a[3*(z-1)+1]=u[1],a[3*(z-1)+2]=u[2]);var u=function(a,b,c){E[a]=b;r[a]=c},G,O,T=0,U=c.create(),W=c.create();
for(G=0;G<l;G++)O=2*Math.PI/l*G,c.scale(t,Math.sin(O),U),c.scale(w,Math.cos(O),W),c.add(U,W),a[3*G+0]=U[0],a[3*G+1]=U[1],a[3*G+2]=U[2],c.scale(U,b),c.add(U,p),q[3*G+0]=U[0],q[3*G+1]=U[1],q[3*G+2]=U[2],C[2*G+0]=G/l,C[2*G+1]=0,q[3*(G+l)+0]=q[3*G+0]+f[0],q[3*(G+l)+1]=q[3*G+1]+f[1],q[3*(G+l)+2]=q[3*G+2]+f[2],C[2*(G+l)+0]=G/l,C[2*G+1]=1,O=(G+1)%l,u(T++,G,G),u(T++,G+l,G),u(T++,O,O),u(T++,O,O),u(T++,G+l,G),u(T++,O+l,O);if(n){for(G=0;G<l;G++)O=(G+1)%l,u(T++,y-2,z-2),u(T++,G,z-2),u(T++,O,z-2);for(G=0;G<l;G++)O=
(G+1)%l,u(T++,G+l,z-1),u(T++,y-1,z-1),u(T++,O+l,z-1)}b={};b[h.POSITION]=E;b[h.NORMAL]=r;b[h.UV0]=E;l={};l[h.POSITION]={size:3,data:q};l[h.NORMAL]={size:3,data:a};l[h.UV0]={size:2,data:C};return new B(l,b)},createTubeGeometry:function(a,b,c,h,l){c=c||10;h=null!=h?h:!0;f.assert(1<a.length);for(var n=[],q=[],u=0;u<c;u++){n.push([0,-u-1,-((u+1)%c)-1]);var p=u/c*2*Math.PI;q.push([Math.cos(p)*b,Math.sin(p)*b])}return z.createPathExtrusionGeometry(q,a,[[0,0,0]],n,h,l)},createPathExtrusionGeometry:function(a,
l,q,y,z,n){var u,w=a.length,C=new Float32Array(l.length*w*3+(6*q.length||0)),E=new Float32Array(l.length*w+(2*q.length||0)),r=new Float32Array(l.length*w*3+(q?6:0)),G=0,M=0,Q=0,S=(l.length-1)*w*6+6*y.length,P=new Uint32Array(S),S=new Uint32Array(S),O=0,T=0,U=c.create(),W=c.create(),k=c.create(),ca=c.create();c.create();var V=c.create();c.create();c.create();var e=c.create(),d=c.create(),g=c.create(),m=c.create(),v=c.create();c.create();c.create();var D=c.create(),L=c.create(),R=c.create(),Z=t.create();
c.set3(0,1,0,m);c.subtract(l[1],l[0],W);c.normalize(W);z?(c.add(l[0],n,g),c.normalize(g,k)):c.set3(0,0,1,k);b(W,k,V,k,.99619469809)||b(W,m,V,k,.99619469809)||b(W,m,V,k,.99619469809);c.set(k,ca);c.set(V,L);for(u=0;u<q.length;u++)c.scale(V,q[u][0],e),c.scale(k,q[u][2],g),c.add(e,g),c.add(e,l[0]),C[G++]=e[0],C[G++]=e[1],C[G++]=e[2],E[Q++]=0;r[M++]=-W[0];r[M++]=-W[1];r[M++]=-W[2];for(u=0;u<y.length;u++)P[O++]=0<y[u][0]?y[u][0]:-y[u][0]-1+q.length,P[O++]=0<y[u][1]?y[u][1]:-y[u][1]-1+q.length,P[O++]=0<
y[u][2]?y[u][2]:-y[u][2]-1+q.length,S[T++]=0,S[T++]=0,S[T++]=0;var ba=q.length;u=q.length-1;for(var ja,aa=0;aa<l.length;aa++){ja=!1;if(0<aa){c.set(W,U);aa<l.length-1?(c.subtract(l[aa+1],l[aa],W),c.normalize(W)):ja=!0;c.add(U,W,v);c.normalize(v);c.add(l[aa-1],ca,D);Z[0]=v[0];Z[1]=v[1];Z[2]=v[2];Z[3]=-p.dot(v,l[aa]);if(f.rayPlane(D,U,Z,g))c.subtract(g,l[aa]),c.normalize(g,k),c.cross(v,k,V),c.normalize(V);else{var ea=v,ha=L,ga=m,ma=V,fa=k;b(ea,ca,ma,fa,.99619469809)||b(ea,ha,ma,fa,.99619469809)||b(ea,
ga,ma,fa,.99619469809)}c.set(k,ca);c.set(V,L)}z&&(c.add(l[aa],n,g),c.normalize(g,R));for(ea=0;ea<w;ea++)if(c.scale(V,a[ea][0],e),c.scale(k,a[ea][1],g),c.add(e,g),c.normalize(e,d),r[M++]=d[0],r[M++]=d[1],r[M++]=d[2],z?E[Q++]=c.dot(e,R):E[Q++]=e[2],c.add(e,l[aa]),C[G++]=e[0],C[G++]=e[1],C[G++]=e[2],!ja)for(ha=(ea+1)%w,P[O++]=ba+ea,P[O++]=ba+w+ea,P[O++]=ba+ha,P[O++]=ba+ha,P[O++]=ba+w+ea,P[O++]=ba+w+ha,ha=0;6>ha;ha++)S[T++]=P[O-6+ha]-u;ba+=w}ja=l[l.length-1];for(u=0;u<q.length;u++)c.scale(V,q[u][0],e),
c.scale(k,q[u][1],g),c.add(e,g),c.add(e,ja),C[G++]=e[0],C[G++]=e[1],C[G++]=e[2],E[Q++]=0;a=M/3;r[M++]=W[0];r[M++]=W[1];r[M++]=W[2];w=ba-w;for(u=0;u<y.length;u++)P[O++]=0<=y[u][0]?ba+y[u][0]:-y[u][0]-1+w,P[O++]=0<=y[u][2]?ba+y[u][2]:-y[u][2]-1+w,P[O++]=0<=y[u][1]?ba+y[u][1]:-y[u][1]-1+w,S[T++]=a,S[T++]=a,S[T++]=a;y={};y[h.POSITION]=P;y[h.NORMAL]=S;P={};P[h.POSITION]={size:3,data:C};P.zOffset={size:1,data:E};P[h.NORMAL]={size:3,data:r};return new B(P,y)},createPolylineGeometry:function(a){f.assert(1<
a.length,"createPolylineGeometry(): polyline needs at least 2 points");f.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");for(var b=new Float32Array(3*a.length),c=new Uint32Array(2*(a.length-1)),l=0,q=0,n=0;n<a.length;n++){for(var p=0;3>p;p++)b[l++]=a[n][p];0<n&&(c[q++]=n-1,c[q++]=n)}a={};l={};a[h.POSITION]=c;l[h.POSITION]={size:3,data:b};return new B(l,a,B.DefaultOffsets,"line")},addVertexColors:function(a,b,c){var l,f,n;if(c){var q={};c=a.getVertexAttr();for(n in c)q[n]=c[n];
a=a.getFaces();c=Array(a.length);for(f=0;f<a.length;f++){l={};for(n in a[f].indices)l[n]=a[f].indices[n];c[f]={type:a[f].type,indices:l,positionKey:a[f].positionKey}}a=new B(c,q)}b=b||[1,1,1,1];n=new Uint8Array(4);n[0]=255*b[0];n[1]=255*b[1];n[2]=255*b[2];n[3]=255*(3<b.length?b[3]:1);a.getVertexAttr()[h.COLOR]={size:4,data:n};c=a.getFaces();for(f=0;f<c.length;f++)b=c[f],l=new Uint32Array(b.indices[b.positionKey].length),b.indices[h.COLOR]=l;return a},addNormals:function(a){var b=a.getVertexAttr();
a=a.getFaces();for(var c=r.Vec3Compact.subtract,h=a.map(function(a){return a.indices.position.length/3}).reduce(function(a,b){return a+b}),h=new Float32Array(3*h),l=b.position.data,n=0,f=0;f<a.length;f++){for(var t=a[f].indices.position,w=new Uint32Array(t.length),z=0;z<t.length;z+=3){c(l,3*t[z],l,3*t[z+2],y,0);c(l,3*t[z],l,3*t[z+1],q,0);p.cross(q,y);p.normalize(q);var J=n/3;h[n++]=q[0];h[n++]=q[1];h[n++]=q[2];w[z]=J;w[z+1]=J;w[z+2]=J}a[f].indices.normal=w}b.normal={size:3,data:h}},cgToGIS:function(a){var b=
a.getVertexAttr();a=b.position.data;var b=b.normal.data,c,h;if(b)for(c=0;c<b.length;c+=3)h=b[c+1],b[c+1]=-b[c+2],b[c+2]=h;if(a)for(c=0;c<a.length;c+=3)h=a[c+1],a[c+1]=-a[c+2],a[c+2]=h}};return z})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./Util","./ComponentUtils"],function(B,r,f,a){function b(a,b){var c=a.reduce(function(a,c){c=c.indices[b];return a+(null==c?0:c.length)},0),h=new Uint32Array(c),l=0,f=0;a.forEach(function(a){var c=a.indices[b];if(null!=
c){var q=c.length,u=c.byteLength;h.set(c,l);a.indices[b]=new Uint32Array(h.buffer,f,q);l+=q;f+=u}});return h}function c(a){var b={},c;c=f.getFirstObjectValue(a);c=c.data.length/c.size;if(c>t||null==p){for(;c>t;)t*=2;p=new Uint32Array(t);for(var h=0;h<t;h++)p[h]=h}c=new Uint32Array(p.buffer,0,c);for(var z in a)b[z]=c;return b}var t=1,p=null;return function(){function h(l,q,p,t){void 0===q&&(q=h.DefaultIndices);void 0===p&&(p=h.DefaultOffsets);void 0===t&&(t="triangle");var w=[],u={},y={},z=Array.isArray(l);
z?(w=l,y=q):(y=l,u=q,u===h.DefaultIndices&&(u=c(y)));if(z)if(1<w.length&&(p=w.map(function(a){return a.componentRange[0]}),p.push(w[w.length-1].componentRange[1]+1),p=new Uint32Array(p)),1===w.length){q=w[0];for(var r in y)l=q.indices,u[r]=l[r]}else for(r in y)u[r]=b(w,r);else{l=f.getFirstObjectValue(u).length;z=q=void 0;p===h.DefaultOffsets?(q=0,z=l):(q=p[0],z=p[p.length-1]);var n=z-q,A=q*Uint32Array.BYTES_PER_ELEMENT;l={};for(r in u)l[r]=new Uint32Array(u[r].buffer,A,n);w.push({type:t,positionKey:"position",
indices:l,componentRange:[q,z-1]})}this._id=h.getNewId();this._faces=w;this._vertexAttributes=y;this._indices=u;this._componentOffsets=a.createOffsets(p);this._primitiveType=t}Object.defineProperty(h.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"faces",{get:function(){return this._faces},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,
configurable:!0});Object.defineProperty(h.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"indexCount",{get:function(){return this._indices.position.length},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"positionKey",{get:function(){return"position"},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});h.prototype.toRenderData=function(){return{id:this._id.toString(),faces:this._faces[0],vertexAttr:this._vertexAttributes}};h.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices.position&&(a+=12*this._indices.position.length);this._indices.normal&&(a+=12*this._indices.normal.length);this._indices.uv0&&(a+=8*this._indices.uv0.length);this._indices.color&&(a+=4*
this._indices.color.length);return a};h.prototype.getId=function(){return this.id};h.prototype.getFaces=function(){return this.faces};h.prototype.getVertexAttr=function(){return this.vertexAttributes};h.getNewId=function(){return h._id++};h._id=0;h.AxisOrder={CG:0,GIS:1};h.DefaultIndices={};h.DefaultOffsets=new Uint32Array(0);return h}()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});(function(f){f.length=
function(a,b){var c=a[b],f=a[b+1];a=a[b+2];return Math.sqrt(c*c+f*f+a*a)};f.normalize=function(a,b){var c=a[b],f=a[b+1],p=a[b+2],c=1/Math.sqrt(c*c+f*f+p*p);a[b]*=c;a[b+1]*=c;a[b+2]*=c};f.scale=function(a,b,c){a[b]*=c;a[b+1]*=c;a[b+2]*=c};f.add=function(a,b,c,f,p,h){void 0===h&&(h=b);p=p||a;p[h]=a[b]+c[f];p[h+1]=a[b+1]+c[f+1];p[h+2]=a[b+2]+c[f+2]};f.subtract=function(a,b,c,f,p,h){void 0===h&&(h=b);p=p||a;p[h]=a[b]-c[f];p[h+1]=a[b+1]-c[f+1];p[h+2]=a[b+2]-c[f+2]}})(r.Vec3Compact||(r.Vec3Compact={}))})},
"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ./IdGen ./Util ./DDSUtil ./gl-matrix ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),function(B,r,f,a,b,c,t,p,h,l,q,y,z,w){function u(b,c,h,l,f,q,u){u=!1!==u;var n=new Image;n.onerror=function(){q(null);n.onerror=void 0;n.onload=void 0};n.onload=
function(){a.assert(1<=n.width&&1<=n.height);h.samplingMode=u?9987:9729;h.hasMipmap=u;if(!u&&33071===h.wrapMode||a.isPowerOfTwo(n.width)&&a.isPowerOfTwo(n.height))h.width=n.width,h.height=n.height,c=new p(b,h,n);else var c=C(b,n,h,l,f);b.bindTexture(c);q(c);n.onerror=void 0;n.onload=void 0};n.src=c}function C(b,c,f,u,y){var n=a.nextHighestPowerOfTwo(c.width),C=a.nextHighestPowerOfTwo(c.height);a.assert(n!==c.width||C!==c.height);f.width=n;f.height=C;var x=new p(b,f),A=t.createWithAttachments(b,x,
{colorTarget:0,depthStencilTarget:0});c=new p(b,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!f.flipped,maxAnisotropy:8,preMultiplyAlpha:f.preMultiplyAlpha},c);b.bindFramebuffer(A);void 0===y&&(y=b.getViewport(),y=[y.x,y.y,y.width,y.height]);b.setViewport(0,0,n,C);u=u.get("texOnly");n=E.identity();b.bindProgram(u);u.setUniformMatrix4fv("model",n);u.setUniformMatrix4fv("view",n);u.setUniformMatrix4fv("proj",n);u.setUniform4f("color",1,1,1,1);u.setUniform1i("tex",
0);u=new l(b,w.Default3D,{geometry:z.Pos3Tex},{geometry:q.createVertex(b,35044,a.createQuadVertexUvBuffer())});b.bindTexture(c,0);b.bindVAO(u);b.setDepthTestEnabled(!1);b.setBlendingEnabled(!1);b.drawArrays(5,0,h.vertexCount(u,"geometry"));b.setDepthTestEnabled(!0);b.bindFramebuffer(null);b.setViewport(y[0],y[1],y[2],y[3]);u.dispose(!0);c.dispose();b.bindFramebuffer(null);A.detachColorTexture();A.dispose();f.hasMipmap&&x.generateMipmap();return x}var E=c.mat4d;return function(){function c(a,b,h){this.data=
a;this.id=c.idGen.gen(b);this.unloadFunc=void 0;this.params=h||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.estimatedTexMemRequiredMB=c.estimateTexMemRequiredMB(this.data,this.params)}c.estimateTexMemRequiredMB=function(a,b){return null==a?0:a instanceof ArrayBuffer||a instanceof Uint8Array?a.byteLength/1E6:a instanceof Image||a instanceof
ImageData||a instanceof HTMLCanvasElement?1.3*a.width*a.height*4/1E6:1.3*b.width*b.height*4/1E6||0};c.prototype.getId=function(){return this.id};c.prototype.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB};c.prototype.dispose=function(){this.data=void 0};c.prototype.deferredLoading=function(){return"string"===typeof this.data};c.prototype.getWidth=function(){return this.params.width};c.prototype.getHeight=function(){return this.params.height};c.prototype.initializeThroughUpload=
function(h,l,f,q,t){var n=this.data;l.flipped=!this.params.noUnpackFlip;l.samplingMode=this.params.mipmap?9987:9729;l.hasMipmap=this.params.mipmap;l.wrapMode=this.params.wrapClamp?33071:10497;l.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof n)u(h,n,l,f,q,t,this.params.mipmap);else{if(n instanceof Image||n instanceof ImageData||n instanceof HTMLCanvasElement)this.params.width=n.width,this.params.height=n.height,!this.params.mipmap&&this.params.wrapClamp||a.isPowerOfTwo(n.width)&&
a.isPowerOfTwo(n.height)?(l.width=n.width,l.height=n.height,l=new p(h,l,n)):l=C(h,n,l,f,q);else if(n instanceof ArrayBuffer&&this.params.encoding===c.DDS_ENCODING)l=b.createDDSTexture(h,l,n,this.params.mipmap);else if(n instanceof Uint8Array&&this.params.encoding===c.DDS_ENCODING)l=b.createDDSTexture(h,l,n.buffer,this.params.mipmap);else if(n instanceof Uint8Array)a.assert(0<this.params.width&&0<this.params.height),l.pixelFormat=1===this.params.components?6409:6408,l.width=this.params.width,l.height=
this.params.height,l=new p(h,l,n);else{if(null!==n)throw console.warn("Unsupported image data"),Error("Unsupported image data");l=new p(h,l,null)}h.bindTexture(l);t(l)}this.data=void 0};c.prototype.setUnloadFunc=function(a){this.unloadFunc=a};c.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};c.idGen=new f;c.DDS_ENCODING="image/vnd-ms.dds";return c}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../webgl/Texture",
"../../../webgl/enums"],function(B,r,f,a){function b(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}Object.defineProperty(r,"__esModule",{value:!0});var c=b("DXT1"),t=b("DXT3"),p=b("DXT5");r.createDDSTexture=function(a,b,q,y){var h=new Int32Array(q,0,31);if(542327876!==h[0])return console.error("Invalid magic number in DDS header"),null;if(!(h[20]&4))return console.error("Unsupported format, must contain a FourCC code"),null;var l=h[21],u;switch(l){case c:l=
8;u=33776;break;case t:l=16;u=33778;break;case p:l=16;u=33779;break;default:return console.error("Unsupported FourCC code:",String.fromCharCode(l&255,l>>8&255,l>>16&255,l>>24&255)),null}var C=1;h[2]&131072&&!1!==y&&(C=Math.max(1,h[7]));y=h[4];var E=h[3],r=h[1]+4,n,A;b.samplingMode=1<C?9987:9729;b.hasMipmap=1<C;b.width=h[4];b.height=h[3];b=new f(a,b);a.bindTexture(b);for(h=0;;++h){h<C&&(A=Math.floor((y+3)/4)*Math.floor((E+3)/4)*l,n=new Uint8Array(q,r,A));a.gl.compressedTexImage2D(a.gl.TEXTURE_2D,h,
u,y,E,0,n);r+=A;if(1===y&&1===E||1===C)break;y=Math.max(1,y>>1);E=Math.max(1,E>>1)}return b}})},"esri/views/webgl/Texture":function(){define(["require","exports"],function(B,r){return function(){function f(a,b,c){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=a;this._desc={pixelFormat:b.pixelFormat,internalFormat:b.internalFormat,dataType:b.dataType,target:b.target?b.target:3553,samplingMode:b.samplingMode?
b.samplingMode:9729,wrapMode:b.wrapMode?b.wrapMode:10497,maxAnisotropy:b.maxAnisotropy,flipped:void 0!==b.flipped?b.flipped:!1,hasMipmap:void 0!==b.hasMipmap?b.hasMipmap:!1,level:void 0!==b.level?b.level:0,unpackAlignment:b.unpackAlignment?b.unpackAlignment:4,width:b.width,height:b.height,preMultiplyAlpha:void 0!==b.preMultiplyAlpha?b.preMultiplyAlpha:!1};this._id=++f._nextId;this.setData(c)}Object.defineProperty(f.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});f.prototype.dispose=function(){var a=this;if(this._context){if(this._glName){var b=this._context.gl;this._boundToUnits.forEach(function(b){a._context.bindTexture(null,b)});b.deleteTexture(this._glName);this._glName=null}this._context=null}};f.prototype.resize=function(a,b){var c=this._desc;if(c.width!==a||c.height!==
b)c.width=a,c.height=b,this.setData(null)};f.prototype.setData=function(a){var b=this._context.gl;this._glName||(this._glName=b.createTexture());void 0===a&&(a=null);null===a&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var c=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var t=this._desc;f._validateTexture(t);b.pixelStorei(b.UNPACK_ALIGNMENT,t.unpackAlignment);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,t.flipped?1:0);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
t.preMultiplyAlpha);a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?(t.width&&t.height&&console.assert(a.width===t.width&&a.height===t.height),b.texImage2D(b.TEXTURE_2D,t.level,t.internalFormat?t.internalFormat:t.pixelFormat,t.pixelFormat,t.dataType,a),void 0===this._desc.width&&(this._desc.width=a.width),void 0===this._desc.height&&(this._desc.height=a.height)):(null!=t.width&&null!=t.height||console.error("Width and height must be specified!"),
b.texImage2D(b.TEXTURE_2D,t.level,t.internalFormat?t.internalFormat:t.pixelFormat,t.width,t.height,0,t.pixelFormat,t.dataType,a));t.hasMipmap&&this.generateMipmap();f._applySamplingMode(b,this._desc);f._applyWrapMode(b,this._desc);f._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(c,0)};f.prototype.updateData=function(a,b,c,f,p,h){h||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");
var l=this._context.gl,q=this._desc,t=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>b||0>c||f>q.width||p>q.height||b+f>q.width||c+p>q.height)&&console.error("An attempt to update out of bounds of the texture!");h instanceof ImageData||h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement?(console.assert(h.width===f&&h.height===p),l.texSubImage2D(l.TEXTURE_2D,a,b,c,q.pixelFormat,q.dataType,h)):l.texSubImage2D(l.TEXTURE_2D,a,b,c,f,p,q.pixelFormat,
q.dataType,h);this._context.bindTexture(t,0)};f.prototype.generateMipmap=function(){var a=this._desc;a.hasMipmap||(a.hasMipmap=!0,f._validateTexture(a));9729===a.samplingMode?(this._samplingModeDirty=!0,a.samplingMode=9985):9728===a.samplingMode&&(this._samplingModeDirty=!0,a.samplingMode=9984);a=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var b=this._context.gl;b.generateMipmap(b.TEXTURE_2D);this._context.bindTexture(a,0)};f.prototype.setSamplingMode=function(a){a!==this._desc.samplingMode&&
(this._desc.samplingMode=a,f._validateTexture(this._desc),this._samplingModeDirty=!0)};f.prototype.setWrapMode=function(a){a!==this._desc.wrapMode&&(this._desc.wrapMode=a,f._validateTexture(this._desc),this._wrapModeDirty=!0)};f.prototype.applyChanges=function(){var a=this._context.gl,b=this._desc;this._samplingModeDirty&&(f._applySamplingMode(a,b),this._samplingModeDirty=!1);this._wrapModeDirty&&(f._applyWrapMode(a,b),this._wrapModeDirty=!1)};f.prototype.setBoundToUnit=function(a,b){b?this._boundToUnits.add(a):
this._boundToUnits.delete(a)};f._isPowerOfTwo=function(a){return 0===(a&a-1)};f._validateTexture=function(a){(0>a.width||0>a.height)&&console.error("Negative dimension parameters are not allowed!");f._isPowerOfTwo(a.width)&&f._isPowerOfTwo(a.height)||(33071!==a.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),a.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};f._applySamplingMode=function(a,b){var c=b.samplingMode;if(9985===c||9987===
c)c=9729;else if(9984===c||9986===c)c=9728;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b.samplingMode)};f._applyWrapMode=function(a,b){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode)};f._applyAnisotropicFilteringParameters=function(a,b){if(null!=b.maxAnisotropy){var c=a.extensions.textureFilterAnisotropic;c&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY_EXT,
b.maxAnisotropy))}};f._nextId=0;return f}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","./Texture"],function(B,r,f){return function(){function a(b,c,t,p){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=b;this._desc={colorTarget:c.colorTarget,depthStencilTarget:c.depthStencilTarget,width:c.width,height:c.height,multisampled:c.multisampled};this._id=a._nextId++;t&&(b=void 0,t instanceof
f?(this._colorAttachment=t,b=t.descriptor):(b=t,this._colorAttachment=new f(this._context,b)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),a._validateTextureDimensions(b,this._desc));p&&(this._context.extensions.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),t=void 0,p instanceof
f?(this._depthStencilTexture=p,t=this._depthStencilTexture.descriptor):(t=p,this._depthStencilTexture=new f(this._context,t)),a._validateTextureDimensions(t,this._desc))}a.create=function(b,c){return new a(b,c)};a.createWithAttachments=function(b,c,f,p){return new a(b,f,c,p)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof f?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&this._glName&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._context.gl.deleteFramebuffer(this._glName),this._glName=null)};a.prototype.attachColorTexture=function(b){if(b){a._validateTextureDimensions(b.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,
c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b.glName,0)}this._colorAttachment=b}};a.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof f){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;this._context.gl.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};a.prototype.attachDepthStencilTexture=function(b){if(b){var c=b.descriptor;34041!==c.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
34042!==c.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.extensions.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");a._validateTextureDimensions(c,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferTexture2D(c.FRAMEBUFFER,
c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,b.glName,0));this._depthStencilTexture=b}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;this._context.gl.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};a.prototype.copyToTexture=function(a,c,f,p,h,l,q){(0>a||0>c||0>h||0>l)&&console.error("Offsets cannot be negative!");
(0>=f||0>=p)&&console.error("Copy width and height must be greater than zero!");var b=this._desc,t=q.descriptor;3553!==q.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+f>b.width||c+p>b.height||h+f>t.width||l+p>t.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");b=this._context;b.bindTexture(q);b.bindFramebuffer(this);b.gl.copyTexSubImage2D(3553,0,h,l,a,c,f,p)};a.prototype.readPixels=function(a,c,f,p,h,l,q){(0>=
f||0>=p)&&console.error("Copy width and height must be greater than zero!");q||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,c,f,p,h,l,q)};a.prototype.resize=function(b,c){var t=this._desc;if(t.width!==b||t.height!==c)if(this._initialized)t.width=b,t.height=c,this._colorAttachment instanceof f?(p=this._colorAttachment,t=p.descriptor,t.width=b,t.height=c,this._colorAttachment.dispose(),this._colorAttachment=new f(this._context,
t),a._validateTextureDimensions(p.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(t=this._depthStencilTexture.descriptor,t.width=b,t.height=c,this._depthStencilTexture.dispose(),this._depthStencilTexture=new f(this._context,t)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._initialized=!1;else{t.width=b;t.height=c;if(this._colorAttachment instanceof f){var p=this._colorAttachment;p.resize(b,
c)}this._depthStencilTexture&&this._depthStencilTexture.resize(b,c)}};a.prototype.initialize=function(){if(this._initialized)return!1;var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var c=a.createFramebuffer(),t=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,c);if(!this._colorAttachment)if(0===t.colorTarget)this._colorAttachment=new f(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height});else{var p=a.createRenderbuffer();
a.bindRenderbuffer(a.RENDERBUFFER,p);a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,t.width,t.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,p);this._colorAttachment=p}this._colorAttachment instanceof f&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);switch(t.depthStencilTarget){case 1:case 3:p=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,p);var h=1===t.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT;
a.renderbufferStorage(a.RENDERBUFFER,1===t.depthStencilTarget?a.DEPTH_COMPONENT16:a.DEPTH_STENCIL,t.width,t.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,h,a.RENDERBUFFER,p);this._depthAttachment=p;break;case 2:p=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,p);a.renderbufferStorage(a.RENDERBUFFER,a.STENCIL_INDEX8,t.width,t.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,p);this._stencilAttachment=p;break;case 4:this._depthStencilTexture||(this._context.extensions.depthTexture||
console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new f(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height})),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");
this._glName=c;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof f){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,c=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),c.framebufferRenderbuffer(c.FRAMEBUFFER,
c.COLOR_ATTACHMENT0,c.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,null)}a.deleteRenderbuffer(this._depthAttachment);this._depthAttachment=
null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferRenderbuffer(c.FRAMEBUFFER,c.STENCIL_ATTACHMENT,c.RENDERBUFFER,null)),a.deleteRenderbuffer(this._stencilAttachment),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a=this._context.gl,a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=
null)};a._validateTextureDimensions=function(a,c){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==c.width&&0<=c.width&&void 0!==c.height&&0<=c.height?c.width===a.width&&c.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):(c.width=a.width,c.height=a.height)};a._nextId=0;return a}()})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(B,
r){Object.defineProperty(r,"__esModule",{value:!0});r.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];r.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];r.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];r.Pos3TexCol=[{name:"position",count:3,type:5126,offset:0,stride:24,normalized:!1},
{name:"uv0",count:2,type:5126,offset:12,stride:24,normalized:!1},{name:"color",count:4,type:5121,offset:20,stride:24,normalized:!1}];r.Pos3TexRegion=[{name:"position",count:3,type:5126,offset:0,stride:28,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:28,normalized:!1},{name:"region",count:4,type:5123,offset:20,stride:28,normalized:!1}];r.Pos3TexRegionCol=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:44,normalized:!1},
{name:"region",count:4,type:5123,offset:32,stride:44,normalized:!1},{name:"color",count:4,type:5121,offset:40,stride:44,normalized:!1}];r.Pos3Norm=[{name:"position",count:3,type:5126,offset:0,stride:24,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:24,normalized:!1}];r.Pos3NormTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];
r.Pos3NormCol=[{name:"position",count:3,type:5126,offset:0,stride:28,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:28,normalized:!1},{name:"color",count:4,type:5121,offset:24,stride:28,normalized:!1}];r.Pos3NormTexCol=[{name:"position",count:3,type:5126,offset:0,stride:36,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:36,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:36,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:36,normalized:!1}];
r.Pos3NormTexRegion=[{name:"position",count:3,type:5126,offset:0,stride:40,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:40,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:40,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:40,normalized:!1}];r.Pos3NormTexRegionCol=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:44,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:44,
normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:44,normalized:!1},{name:"color",count:4,type:5121,offset:40,stride:44,normalized:!1}];r.Pos3NormSymcol=[{name:"position",count:3,type:5126,offset:0,stride:28,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:28,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:24,stride:28,normalized:!1}];r.Pos3NormTexSymcol=[{name:"position",count:3,type:5126,offset:0,stride:36,normalized:!1},{name:"normal",count:3,type:5126,
offset:12,stride:36,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:36,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:32,stride:36,normalized:!1}];r.Pos3NormColSymcol=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"color",count:4,type:5121,offset:24,stride:32,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:28,stride:32,normalized:!1}];r.Pos3NormTexColSymcol=[{name:"position",
count:3,type:5126,offset:0,stride:40,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:40,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:40,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:40,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:36,stride:40,normalized:!1}];r.Pos3NormTexRegionSymcol=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:44,normalized:!1},{name:"uv0",
count:2,type:5126,offset:24,stride:44,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:44,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:40,stride:44,normalized:!1}];r.Pos3NormTexRegionColSymcol=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:48,normalized:!1},{name:"color",
count:4,type:5121,offset:40,stride:48,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:44,stride:48,normalized:!1}];r.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];r.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];r.Model=[{name:"model",count:16,type:5126,offset:0,stride:128,normalized:!1,divisor:1},{name:"modelNormal",count:16,type:5126,offset:64,stride:128,normalized:!1,
divisor:1}];r.ModelCol=[{name:"model",count:16,type:5126,offset:0,stride:144,normalized:!1,divisor:1},{name:"modelNormal",count:16,type:5126,offset:64,stride:144,normalized:!1,divisor:1},{name:"instanceColor",count:4,type:5126,offset:128,stride:144,normalized:!1,divisor:1}]})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define("require exports ./Util ../../../../core/Logger ../../../webgl/Texture ../../../webgl/enums".split(" "),function(B,r,f,a,b,c){var t=a.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),
p=function(){function a(a){this._glTexture=null;this._refCount=0;this._glTexture=a}a.prototype.incRefCnt=function(){++this._refCount};a.prototype.decRefCnt=function(){--this._refCount;f.assert(0<=this._refCount)};a.prototype.getRefCnt=function(){return this._refCount};a.prototype.setGLTexture=function(a){this._glTexture=a};a.prototype.getGLTexture=function(){return this._glTexture};return a}();return function(){function a(a,b,c,h){this.NUM_PARALLEL=8;this.textures=a;this._programRepository=b;this.getViewportToRestore=
c;this._rctx=h;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=h.extensions.textureFilterAnisotropic)?h.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=255,this._fallbackTextureTransparentData[a]=
0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}a.prototype.resetNeedsRender=function(){this._needsRender=!1};a.prototype.needsRender=function(){return this._needsRender};a.prototype.aquire=function(a,c,h,z){var l=this,q=this.id2textureRef[a];if(null==q){c=this.textures[a];f.assert(void 0!==c);c.setUnloadFunc(this._unload.bind(this));h=!0===h;var y=this._createGLTextureDescription(c),q=new p(h?new b(this._rctx,
this._fallbackTextureDesc,this._fallbackTextureTransparentData):new b(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));f.assert(null==this.id2textureRef[a]);this.id2textureRef[a]=q;if(c.initializeThroughRender)a=c.initializeThroughRender(this._rctx,y),q.setGLTexture(a),z&&z(q);else if(c.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(a,y,z):this._queue.push([a,y,z]);else try{c.initializeThroughUpload(this._rctx,y,this._programRepository,this.getViewportToRestore(),
function(a){q.setGLTexture(a);l._needsRender=!0;z&&z(q)})}catch(E){t.error("#aquire","Error loading texture: "+E.toString()),q=new p(new b(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData))}this._needsRender=!0}q.incRefCnt();return q};a.prototype.release=function(a){a=this.id2textureRef[a];void 0!==a&&(a.decRefCnt(),f.assert(0<=a.getRefCnt()))};a.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};a.prototype.getIsLoaded=function(a){if(null==this.id2textureRef[a]||
void 0!==this.loading[a])return!1;for(var b=0;b<this._queue.length;++b)if(this._queue[b][0]===a)return!1;return!0};a.prototype.addTextureListener=function(a){f.assert(-1===this.listeners.indexOf(a));this.listeners.push(a)};a.prototype.removeTextureListener=function(a){a=this.listeners.indexOf(a);f.assert(-1!==a);this.listeners.splice(a,1)};a.prototype.getTexture=function(a){return this.textures[a]};a.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};a.prototype._unload=function(a){var b=
this.id2textureRef[a];void 0!==b&&(b.getGLTexture().dispose(),delete this.id2textureRef[a]);this.next(a)};a.prototype._createGLTextureDescription=function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&a.params&&a.params.mipmap&&!a.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrapClamp?33071:void 0}};a.prototype.next=function(a){if(a in this.loading){delete this.loading[a];var b=Object.keys(this.id2textureRef),c=Object.keys(this.loading);
this.listeners.forEach(function(h){h(a,b,c)});this.processQueue()}};a.prototype._loadImage=function(a,b,c){var h=this;f.assert(null==this.loading[a]);this.loading[a]=!0;var l=this.textures[a];f.assert(void 0!==l);setTimeout(function(){var f=h.id2textureRef[a];f&&f.getRefCnt()&&l.initializeThroughUpload(h._rctx,b,h._programRepository,h.getViewportToRestore(),function(b){h.next(a);h._needsRender=!0;f&&f.getRefCnt()&&(f.setGLTexture(b),c&&c(f))})},0)};a.prototype.processQueue=function(){for(var a=[],
b=0;b<this._queue.length;++b){var c=this._queue[b][0],h=this.id2textureRef[c];void 0!==h&&(0===h.getRefCnt()?(h.getGLTexture().dispose(),delete this.id2textureRef[c]):a.push(this._queue[b]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(b=0;b<a;++b)this._loadImage(this._queue[b][0],this._queue[b][1],this._queue[b][2]);this._queue.splice(0,a)};return a}()})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["require","exports"],function(B,
r){var f;B=f||(f={});B[B.MATERIAL=0]="MATERIAL";B[B.MATERIAL_DEPTH=1]="MATERIAL_DEPTH";B[B.MATERIAL_NORMAL=2]="MATERIAL_NORMAL";B[B.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP";B[B.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT";B[B.MAX_PASS=5]="MAX_PASS";return f})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["require","exports"],function(B,r){var f;B=f||(f={});B[B.BACKGROUND=0]="BACKGROUND";B[B.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL";B[B.STENCIL_MATERIAL=2]="STENCIL_MATERIAL";
B[B.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN";B[B.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL";B[B.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL";B[B.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL";B[B.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL";B[B.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN";B[B.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";B[B.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT";B[B.POSTPROCESSING_ATMOSPHERE=11]="POSTPROCESSING_ATMOSPHERE";B[B.HUDMATERIAL1=12]="HUDMATERIAL1";B[B.HUDMATERIAL2=13]="HUDMATERIAL2";
B[B.LINE_CALLOUTS=14]="LINE_CALLOUTS";B[B.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH";B[B.MAX_SLOTS=16]="MAX_SLOTS";return f})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define([],function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/webgl/Program":function(){define(["require","exports","dojo/has"],function(B,r,f){return function(){function a(b,c,f,p,h){void 0===h&&(h={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4=
{};b||console.error("RenderingContext isn't initialized!");0===c.length&&console.error("Shaders source should not be empty!");this._context=b;this._vertexShaderSource=c;this._fragmentShaderSource=f;if(Array.isArray(h))for(b=0;b<h.length;b++)this._defines[h[b]]="1";else this._defines=h;this._id=a._nextId++;this._locations=p}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.getDefine=function(a){return this._defines[a]};a.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};a.prototype.initialize=
function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,c=a.createProgram();a.attachShader(c,this._vShader);a.attachShader(c,this._fShader);for(var f in this._locations)a.bindAttribLocation(c,this._locations[f],f);a.linkProgram(c);a.getProgramParameter(c,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(c,
a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(c));this._glName=c;this._initialized=!0}};a.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};a.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};a.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&
(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};a.prototype.setUniform1i=function(a,c){var b=this._nameToUniform1[a];if(void 0===b||c!==b)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),c),this._nameToUniform1[a]=c};a.prototype.setUniform1f=function(a,c){var b=this._nameToUniform1[a];if(void 0===b||c!==b)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),
c),this._nameToUniform1[a]=c};a.prototype.setUniform1fv=function(b,c){var f=this._nameToUniform2[b];void 0!==f&&a._arraysEqual(c,f)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(b),c),void 0===f?this._nameToUniform2[b]=new Float32Array(c):f.set(c))};a.prototype.setUniform2f=function(a,c,f){var b=this._nameToUniform2[a];if(void 0===b||c!==b[0]||f!==b[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),c,f),void 0===b?this._nameToUniform2[a]=
new Float32Array([c,f]):(b[0]=c,b[1]=f)};a.prototype.setUniform2fv=function(b,c){var f=this._nameToUniform2[b];void 0!==f&&a._arraysEqual(c,f)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(b),c),void 0===f?this._nameToUniform2[b]=new Float32Array(c):f.set(c))};a.prototype.setUniform3f=function(a,c,f,p){var b=this._nameToUniform3[a];if(void 0===b||c!==b[0]||f!==b[1]||p!==b[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),
c,f,p),void 0===b?this._nameToUniform3[a]=new Float32Array([c,f,p]):(b[0]=c,b[1]=f,b[2]=p)};a.prototype.setUniform3fv=function(b,c){var f=this._nameToUniform3[b];void 0!==f&&a._arraysEqual(c,f)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(b),c),void 0===f?this._nameToUniform3[b]=new Float32Array(c):f.set(c))};a.prototype.setUniform4f=function(a,c,f,p,h){var b=this._nameToUniform4[a];if(void 0===b||c!==b[0]||f!==b[1]||p!==b[2]||h!==b[3])this._context.bindProgram(this),
this._context.gl.uniform4f(this.getUniformLocation(a),c,f,p,h),void 0===b?this._nameToUniform4[a]=new Float32Array([c,f,p,h]):(b[0]=c,b[1]=f,b[2]=p,b[3]=h)};a.prototype.setUniform4fv=function(b,c){var f=this._nameToUniform4[b];void 0!==f&&a._arraysEqual(c,f)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(b),c),void 0===f?this._nameToUniform4[b]=new Float32Array(c):f.set(c))};a.prototype.setUniformMatrix3fv=function(b,c,f){void 0===f&&(f=!1);var p=this._nameToUniformMatrix3[b];
void 0!==p&&(9===p.length?a._matrix3Equal(p,c):a._arraysEqual(c,p))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(b),f,c),void 0===p?this._nameToUniformMatrix3[b]=new Float32Array(c):p.set(c))};a.prototype.setUniformMatrix4fv=function(b,c,f){void 0===f&&(f=!1);var p=this._nameToUniformMatrix4[b];void 0!==p&&(16===p.length?a._matrix4Equal(p,c):a._arraysEqual(c,p))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(b),
f,c),void 0===p?this._nameToUniformMatrix4[b]=new Float32Array(c):p.set(c))};a._padToThree=function(a){var b=a.toString();1E3>a&&(b=("  "+a).slice(-3));return b};a.prototype._addLineNumbers=function(b){var c=2;return b.replace(/\n/g,function(){return"\n"+a._padToThree(c++)+":"})};a.prototype._loadShader=function(a){var b=35633===a?this._vertexShaderSource:this._fragmentShaderSource,f="",p;for(p in this._defines)f+="#define "+p+" "+this._defines[p]+"\n";b=f+b;f=this._context.gl;a=f.createShader(a);
f.shaderSource(a,b);f.compileShader(a);f.getShaderParameter(a,f.COMPILE_STATUS)||(console.error(f.getShaderInfoLog(a)),console.error(this._addLineNumbers(b)));return a};a._matrix4Equal=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]};a._matrix3Equal=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&
a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]};a._arraysEqual=function(a,c){if(a.length!==c.length)return!1;for(var b=0;b<a.length;++b)if(a[b]!==c[b])return!1;return!0};a._nextId=0;return a}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("dojo/text!./materials/RealisticAtmosphereMaterial.xml ../../../core/watchUtils ../../../core/HandleRegistry ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/OffscreenRenderingHelper ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w){var u=q.earthRadius,C=b.vec3d,E=b.vec2d,G=b.vec4d;b=.02*Math.PI;q=.004*Math.PI;var n=C.createFrom(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),A=C.create(n);C.scale(A,b);C.add(A,C.createFrom(q,q,q));var x=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5;a=a.createSubclass({declaredClass:"esri.views.3d.environment.RealisticAtmosphere",properties:{view:{},planar:{value:!1,set:function(a){a=!!a;a!==this.planar&&this._update();this._set("planar",a)}},needsRender:{value:!1}},
constructor:function(){this._handles=new f;this._lowerElevationBoundRadius=0;this._earthRadius=u;this._renderer=this._skyPlanarProgram=this._skyProgram=this._hazePlanarProgram=this._hazeProgram=null;this._renderData={texDepth:E.create(),v3CameraPos:C.create(),v3CameraUp:C.create(),v3CameraRight:C.create(),v3CameraDir:C.create(),v3CameraCenter:C.create(),halfSizeNearPlane:E.create(),v2CameraCenterOffset:E.create(),v4SphereComp:G.create(),v4AtmosParams1:G.create(),v4AtmosParams2:G.create(),v4AtmosParams3:G.create(),
v3InvWavelength:n,v3InvWavelengthScaled:A,v4Radii:G.create(),fScale:0,fScaleDepth:.25,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:.05,fOneOverScaleDepthBlue:20,fScaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,fMiePhaseCoefficients:x,showTest:0,nearFar:E.create()};this._updateRadius(u);this._hazeSlot=h.POSTPROCESSING_ATMOSPHERE;this._skySlot=h.BACKGROUND},destroy:function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&
(this._hazeProgram.dispose(),this._hazeProgram=null);this._hazePlanarProgram&&(this._hazePlanarProgram.dispose(),this._hazePlanarProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._skyPlanarProgram&&(this._skyPlanarProgram.dispose(),this._skyPlanarProgram=null)},setup:function(a){var b=t.createSquareGeometry(),h={faces:b.getFaces()[0],vertexAttr:b.getVertexAttr()},b=this.renderContext.rctx;this._renderer=new c(h,z.Pos3Tex,null,b);var l=this._update.bind(this);
this._handles.add(r.on(this,"view.navigation","currentViewChanged",function(a){l(a.camera)},function(){l()},null,!0));var h=this._updateElevation.bind(this),f=this._updateVisibleElevationBounds.bind(this);this._handles.add(r.on(this,"view.basemapTerrain","elevation-change",h,h));this._handles.add(r.on(this,"view.basemapTerrain","elevation-bounds-change",f,f));a.shaderSnippets.fsRealisticAtmosphere||a.shaderSnippets._parse(B);this._hazeProgram=new y(b,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,
w.Default3D,["HAZE"]);this._skyProgram=new y(b,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,w.Default3D);this._hazePlanarProgram=new y(b,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,w.Default3D,["HAZE","PLANAR"]);this._skyPlanarProgram=new y(b,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,w.Default3D,["PLANAR"])},render:function(a){if(!(a.slot!=this._hazeSlot&&a.slot!=this._skySlot||a.pass!=p.MATERIAL||
a.slot==this._hazeSlot&&a.options.earlyOcclusionPixelDraw)){var b,c=this.renderContext.rctx,h=c.gl,l=a.offscreenRenderingHelper,f=!1;if(a.slot==this._hazeSlot){b=this.planar?this._hazePlanarProgram:this._hazeProgram;c.bindProgram(b);c.setBlendFunctionSeparate(h.ONE,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);l.detachDepthTextureFromBuffer();var f=!0,n=l.getDepthTexture();c.bindTexture(n,0);b.setUniform1i("tDepth",0);b.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp)}a.slot==this._skySlot&&(b=this.planar?
this._skyPlanarProgram:this._skyProgram,c.bindProgram(b),c.setBlendFunctionSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA),b.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp),b.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3));b.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);b.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);b.setUniform3fv("v3LightDir",a.lightingData.direction);b.setUniform3fv("v3CameraPos",
this._renderData.v3CameraPos);b.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);b.setUniform3fv("v3CameraRight",this._renderData.v3CameraRight);b.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);b.setUniform2fv("nearFar",this._renderData.nearFar);b.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);b.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);b.setUniform4fv("v4Radii",this._renderData.v4Radii);b.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1);
b.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);b.setUniform1f("showTest",this._renderData.showTest);c.setDepthTestEnabled(!1);c.setBlendingEnabled(!0);this._renderer.render(b);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);c.setBlendFunctionSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);f&&l.restoreDepthTextureToBuffer();return!0}},_setEnableTestImage:function(a){this._renderData.showTest=a?1:0;this.needsRender=!0},_adjustRadiusForTesselation:function(a){return a*
Math.cos(Math.PI/Math.pow(2,4)/16)},_normalizeRadius:function(a){a=this._adjustRadiusForTesselation(a);return Math.max(u-1E4,Math.min(a,u))},_updateElevation:function(){if(this.get("view.basemapTerrain.ready")){var a=this._adjustRadiusForTesselation(u+this.view.basemapTerrain.rootTiles[0].elevationBounds[0]);a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds())}},_updateVisibleElevationBounds:function(){var a=this._adjustRadiusForTesselation(u+
this.view.basemapTerrain.getElevationBounds()[0]);return 0>this._earthRadius||a<this._earthRadius?this._updateRadius(a):!1},_updateRadius:function(a){this._earthRadius=a;var b=a*a,c=a/10*10.25,h=c*c,l=1/(c-a),f=l/.25,n=l/.05,q=.3*(c-a)+a,u=1/(c-q),p=this._renderData;G.set4(l,.25,f,4,p.v4AtmosParams1);G.set4(-.99999,.05,n,20,p.v4AtmosParams2);G.set4(-.99999*-.99999,x,q,u,p.v4AtmosParams3);G.set4(a,b,c,h,p.v4Radii);p.fScale=l;p.fLowerAlphaBlendBound=q;p.fScaleOverScaleDepth=f;p.fScaleOverScaleDepthBlue=
n;this._update();return!0},_update:function(a){if(a=a||this.get("view.navigation.currentCamera")){C.negate(a.viewForward,this._renderData.v3CameraDir);C.set(a.viewUp,this._renderData.v3CameraUp);C.set(a.viewRight,this._renderData.v3CameraRight);if(this.planar){var b=this.view.renderCoordsHelper;this._renderData.fCameraHeight=b.getAltitude(a.eye)/b.unitInMeters+u}else this._renderData.fCameraHeight=C.length(a.eye);this._renderData.fCameraHeight2=this._renderData.fCameraHeight*this._renderData.fCameraHeight;
this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3];this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1];this._renderData.v4SphereComp=G.createFrom(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur);C.set(a.eye,this._renderData.v3CameraPos);C.set(a.center,this._renderData.v3CameraCenter);E.set2(Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight),this._renderData.halfSizeNearPlane);
E.set2((a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5,this._renderData.v2CameraCenterOffset);E.set2(a.near,a.far,this._renderData.nearFar);this.needsRender=!0}}});a.isSupported=function(a){return l.supportsDepthTexture(a.rctx.extensions)};return a})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./Util dojo/text!../materials/internal/offscreen.xml ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/Util ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z){var w={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},u={target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0};return function(){function q(a,b){this._hudVisibilityTexture=null;this._enabled=!1;this.height=this.width=0;this._programRep=a;this._rctx=b;this.height=this.width=null}q.prototype.enable=function(){if(!this.getEnableState()){var a=this._rctx;this._enabled=!0;this.framebuffer=
b.createWithAttachments(a,w,{colorTarget:0,depthStencilTarget:a.extensions.depthTexture?4:3});this.quadVAO=this.createQuadVAO(a)}};q.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this.framebuffer.dispose(),this.quadVAO.dispose(!0),this._depthStencilTextureCached=this.quadVAO=this.framebuffer=null)};q.prototype.createQuadVAO=function(a){var b=new Float32Array([-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,1,1,1]);return new t(a,z.Default3D,{geometry:y.Pos2Tex},{geometry:p.createVertex(a,
35044,b)})};q.prototype.setEnableState=function(a){a?this.enable():this.disable()};q.prototype.getEnableState=function(){return this._enabled};q.prototype.getColorTexture=function(){return this.framebuffer.colorTexture};q.prototype.getDepthTexture=function(){return q.supportsDepthTexture(this._rctx.extensions)?this.framebuffer.depthStencilTexture||this._depthStencilTextureCached:null};q.prototype.getHUDVisibilityTexture=function(){return this._hudVisibilityTexture};q.supportsDepthTexture=function(a){return!!a.depthTexture};
q.prototype.initializeFrame=function(a){f.assert(this.getEnableState());var b=this._rctx,c=b.gl;a=a.fullViewport;this.width=a[2];this.height=a[3];this.framebuffer.resize(this.width,this.height);b.bindFramebuffer(this.framebuffer);b.setStencilWriteMask(255);b.setClearStencil(0);b.setClearColor(0,0,0,1);b.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)};q.prototype.renderHUDVisibility=function(a){var b=this._rctx,h=b.gl;this._hudVisibilityTexture||(this._hudVisibilityTexture=new c(b,
u));this._hudVisibilityTexture.resize(this.width,this.height);var l=this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(this._hudVisibilityTexture);b.bindFramebuffer(this.framebuffer);b.setClearColor(0,0,0,1);b.clear(h.COLOR_BUFFER_BIT);a();h.flush();this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(l)};q.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};q.prototype.getFramebuffer=function(){return this.framebuffer};q.prototype.detachDepthTextureFromBuffer=
function(){this._depthStencilTextureCached=this.framebuffer.depthStencilTexture;this.framebuffer.detachDepthStencilTexture()};q.prototype.restoreDepthTextureToBuffer=function(){this.framebuffer.attachDepthStencilTexture(this._depthStencilTextureCached);this._depthStencilTextureCached=null};q.prototype.drawQuad=function(a){f.assert(this.getEnableState());a=this._rctx;var b=a.gl,c=this._programRep.get("offscreenProgram");a.bindFramebuffer();a.setDepthTestEnabled(!1);a.clear(b.COLOR_BUFFER_BIT);a.bindProgram(c);
c.setUniform1i("tex",1);a.bindTexture(this.framebuffer.colorTexture,1);a.bindVAO(this.quadVAO);a.drawArrays(5,0,l.vertexCount(this.quadVAO,"geometry"));a.setDepthTestEnabled(!0)};q.loadShaders=function(b,c,l,f){b._parse(a);b=new h(f,b.vsOffscreenRenderer,b.fsOffscreenRenderer,z.Default3D);l.add("offscreenProgram",b)};return q}()})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../../../core/watchUtils ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u){var C=z.earthRadius,E=b.vec3d,G=b.vec2d,n=b.mat4d,A=p.VertexAttrConstants,x=(C-1E4)/C,I=(C+3E5)/C,K=-1E4/3E5,J=1-K;return a.createSubclass({declaredClass:"esri.views.3d.environment.SimpleAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:q.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={texV:G.create(),silCircleCenter:E.create(),silCircleV1:E.create(),silCircleV2:E.create()};this._textureRep=
this._texture=null},initialize:function(){this._textureDfd=new r;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._currentViewChangedHandle&&(this._currentViewChangedHandle.remove(),this._currentViewChangedHandle=null);this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),
this._textureDfd=null)},initializeRenderContext:function(a){this._textureRep=new h({SimpleAtmosphere:new t(y,"SimpleAtmosphere",{wrapClamp:!0})},a.programRep,function(){return this.view._stage.getCamera().viewport}.bind(this),a.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,void 0,function(a){this._texture=a.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(a){var b=this._createRibbonGeometryData();this._renderer=new c(b,[{name:"position",
count:3,type:5126,offset:0,stride:12,normalized:!1}],null,a.rctx);this._currentViewChangedHandle=f.on(this,"view.navigation","currentViewChanged",function(a){this._update(a.camera)}.bind(this),function(){this._update(this.get("view.navigation.currentCamera"))}.bind(this),null,!0);a.shaderSnippets.vsSimpleAtmosphere||a.shaderSnippets._parse(B);this._program=new w(a.rctx,a.shaderSnippets.vsSimpleAtmosphere,a.shaderSnippets.fsSimpleAtmosphere,u.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==
l.MATERIAL)return!1;var b=this.renderContext.rctx,c=b.gl,h=this._program;b.bindProgram(h);h.setUniform4f("color",1,1,1,1);h.setUniformMatrix4fv("proj",a.camera.projectionMatrix);h.setUniformMatrix4fv("view",a.camera.viewMatrix);h.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);h.setUniform3fv("silCircleV1",this._renderData.silCircleV1);h.setUniform3fv("silCircleV2",this._renderData.silCircleV2);h.setUniform2fv("texV",this._renderData.texV);b.bindTexture(this._texture,0);h.setUniform1i("tex",
0);h.setUniform3fv("lightDirection",a.lightingData.direction);b.setDepthFunction(c.LEQUAL);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);this._renderer.render(h);b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(c.LESS);return!0},_update:function(a){var b=E.create(),c=E.create(),h=E.create(),l=this.view.renderCoordsHelper.getAltitude(a.eye);E.scale(a.eye,(C+50)/E.length(a.eye),h);this._computeSilhouetteCircle(h,a.center,a.up,C);E.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,
b);E.scale(b,I,c);var h=this._computeScreenRimWidth(h,a.up,b,c),f=0,n=1,q=1;50>l?(f=.001953125,n=.1015625):500>l?(q=(l-50)/450,f=.001953125*(1-q)+.001953125*q,n=.1015625*(1-q)+.21875*q):5E3>l?(q=(l-500)/4500,f=.001953125*(1-q)+.001953125*q,n=.21875*(1-q)+.51171875*q):5E4>l&&(q=(l-5E3)/45E3,f=.001953125*(1-q)+.001953125*q,n=.51171875*(1-q)+.4140625*q);l=K+f*J;q=K+h*n*J;50<E.length(a.eye)-C&&(this._computeSilhouetteCircle(a.eye,a.center,a.up,C),E.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,
b),E.scale(b,I,c),a=this._computeScreenRimWidth(a.eye,a.up,b,c),a=p.clamp((a-1.5)/(h-1.5),0,1),l=K+a*f*J,q=K+p.lerp(1,h*n,a)*J);G.set2(l,q,this._renderData.texV);this.needsRender=!0},_computeSilhouetteCircle:function(a,b,c,h){var l=E.length(a),f=h*Math.sqrt(l*l-h*h)/l,n=this._renderData.silCircleV1,q=this._renderData.silCircleV2;E.scale(a,Math.sqrt(h*h-f*f)/l,this._renderData.silCircleCenter);E.cross(a,b,n);1>E.length2(n)&&E.cross(a,c,n);E.scale(n,f/E.length(n));E.cross(n,a,q);E.scale(q,f/E.length(q));
return f},_computeScreenRimWidth:function(a,b,c,h){var l=n.create();n.lookAt(a,c,b,l);a=this.view.navigation.currentCamera;p.project(c,l,a.projectionMatrix,a.viewport);p.project(h,l,a.projectionMatrix,a.viewport);return E.dist(c,h)/a.height},_createRibbonGeometryData:function(){for(var a=new Float32Array(768),b=new Uint32Array(768),c=0;128>c;c++){var h=6*c;a[h+0]=c;a[h+1]=x;a[h+2]=0;a[h+3]=c;a[h+4]=I;a[h+5]=1;var l=2*c,f=127===c?0:l+2;b[h+0]=l;b[h+1]=l+1;b[h+2]=f+1;b[h+3]=f+1;b[h+4]=f;b[h+5]=l}c=
{};c[A.POSITION]=b;b={};b[A.POSITION]={size:3,data:a};return{faces:{type:"triangle",indices:c,positionKey:A.POSITION},vertexAttr:b}}})})},"esri/views/3d/environment/Stars":function(){define("dojo/text!./materials/StarMaterial.xml require ../../../request ../../../core/watchUtils ../../../core/promiseUtils ../../../core/Error ../../../core/Logger ../lib/glMatrix ../support/ExternalRenderer ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Util".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E){var G=p.mat4d;p=p.mat3d;var n=q.VertexAttrConstants,A="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),x=t.getLogger("esri.views.3d.environment.Stars"),I=p.toMat4(p.createFrom(1,0,0,0,.9174771405229186,.39778850739794974,0,-.39778850739794974,.9174771405229186)),K=p.toMat4(p.createFrom(1,0,0,0,.9174771405229186,-.39778850739794974,
0,.39778850739794974,.9174771405229186)),J=null;return h.createSubclass({properties:{view:{},numBinaryFloats:{value:2},numBinaryUInt8:{value:1},bytesPerStar:{value:9},needsRender:{value:!1},slot:{value:w.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={model:G.identity()};this.slot=w.BACKGROUND;this._vertexBufferLayout=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:20,
normalized:!1},{name:"size",count:1,type:5126,offset:16,stride:20,normalized:!1}]},initialize:function(){this._loadDataPromise=this._loadBrightStarCatalogue();this.addResolvingPromise(this._loadDataPromise)},destroy:function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel("Atmosphere has been removed.");this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null)},setup:function(b){this._numStars=this._starData.byteLength/
this.bytesPerStar;var c=new Float32Array(this._starData,0,this._numStars*this.numBinaryFloats),h=new Uint8Array(this._starData,this._numStars*this.numBinaryFloats*4,this._numStars*this.numBinaryUInt8),c=this._createStarGeometryData(c,h);this._renderer=new l(c,this._vertexBufferLayout,this._fillInterleaved,b.rctx);this._renderer.enablePointRendering(!0);this._dateHandle=a.init(this,"view.environment.lighting.date",this._update.bind(this));b.shaderSnippets.vertexShaderStar||b.shaderSnippets._parse(B);
this._program=new u(b.rctx,b.shaderSnippets.vertexShaderStar,b.shaderSnippets.fragmentShaderStar,C.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==z.MATERIAL)return!1;var b=this.renderContext.rctx,c=b.gl,h=this._program;b.bindProgram(h);h.setUniformMatrix4fv("view",a.camera.viewMatrix);h.setUniformMatrix4fv("proj",a.camera.projectionMatrix);h.setUniform4fv("viewport",a.camera.fullViewport);h.setUniformMatrix4fv("model",this._renderData.model);b.setDepthFunction(c.LEQUAL);b.setBlendingEnabled(!0);
b.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);b.setDepthWriteEnabled(!1);this._renderer.render(h);b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(c.LESS);return!0},_fillInterleaved:function(a,b,c,h,l,f,q){var u=E.getStride(l);c=u/4;var p=y.fill,k=a.faces.indices[n.POSITION],t=a.vertexAttr[n.POSITION].data;h=q+E.findAttribute(l,"position").offset/4;for(var w=0;w<k.length;++w){var e=3*k[w];p(t,e,f,h,b,3);h+=c}b=a.faces.indices[n.COLOR];
k=a.vertexAttr[n.COLOR].data;h=q+E.findAttribute(l,"color").offset;t=new Uint8Array(f.buffer);for(w=0;w<b.length;++w)e=4*b[w],p(k,e,t,h,null,4),h+=u;u=a.faces.indices[n.SIZE];a=a.vertexAttr[n.SIZE].data;h=q+E.findAttribute(l,"size").offset/4;for(w=0;w<u.length;++w)f[h]=a[u[w]],h+=c},_computeDayDuration:function(a){var b=new Date(a.getFullYear(),0,1,11,58,56),c=new Date(a.getFullYear()+1,0,1,11,58,55);return(a-b)/(c-b)},_update:function(a){if(a){var b=a.getHours()/12,c=a.getMinutes()/60*(2/24),h=a.getSeconds()/
60*(2/1440),b=(b+c+h-.9972222)%2;a=2*this._computeDayDuration(a);c=G.create(K);G.rotateZ(c,-a*Math.PI);G.multiply(I,c,c);G.rotateZ(c,-b*Math.PI);this._renderData.model=c;this.needsRender=!0}},_hexToRGB:function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]},_unpackUint8Attributes:function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]},_createStarGeometryData:function(a,
b){for(var c=new Float32Array(3*this._numStars),h=new Uint8Array(4*this._numStars),l=new Float32Array(this._numStars),f=new Uint32Array(this._numStars),q=0;q<this._numStars;q++){var u=2*q,p=3*q,k=4*q,t=a[u+0],u=a[u+1];c[p+0]=-Math.cos(t)*Math.sin(u);c[p+1]=-Math.sin(t)*Math.sin(u);c[p+2]=-Math.cos(u);p=this._unpackUint8Attributes(b[q]);t=this._hexToRGB(A[p[1]]);h[k+0]=255*t[0];h[k+1]=255*t[1];h[k+2]=255*t[2];h[k+3]=255;l[q]=p[0];f[q]=q}a={};a[n.POSITION]=f;a[n.NORMAL]=f;a[n.UV0]=f;a[n.COLOR]=f;a[n.SIZE]=
f;f={};f[n.POSITION]={size:3,data:c};f[n.COLOR]={size:4,data:h};f[n.SIZE]={size:1,data:l};return{faces:{type:"point",indices:a,positionKey:n.POSITION},vertexAttr:f}},_verifyStartData:function(a){if(!a)throw new c("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new c("stars:invalid-data","Failed to create stars because star catalogue data is invalid");},_loadBrightStarCatalogue:function(){return J?
(this._starData=J,b.resolve()):f(r.toUrl("./resources/stars.wsv"),{responseType:"array-buffer",failOk:!0}).then(function(a){a=a.data;this._verifyStartData(a);this._starData=J=a}.bind(this)).otherwise(function(a){x.error("loadBrightStarCatalogue",a.message);throw a;})}})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../lib/glMatrix"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});var a=f.vec3d;B=function(){return function(b,c,f){void 0===
b&&(b=a.create());void 0===c&&(c=a.createFrom(.57735,.57735,.57735));void 0===f&&(f=!0);this.intensity=b;this.direction=c;this.castShadows=f}}();r.MainLight=B;B=function(){return function(b,c){void 0===b&&(b=a.create());void 0===c&&(c=a.createFrom(.57735,.57735,.57735));this.intensity=a.create();this.direction=a.create();this.intensity=b;this.direction=c}}();r.FillLight=B;B=function(){return function(b){void 0===b&&(b=a.create());this.intensity=b}}();r.AmbientLight=B;B=function(){return function(){this.sh=
{r:[0],g:[0],b:[0]}}}();r.SphericalHarmonicsLight=B})},"esri/views/3d/constraints/SceneViewConstraints":function(){define(["../../../core/Accessor","./SceneViewAltitudeConstraint","./SceneViewClipDistanceConstraint","./SceneViewTiltConstraint","./SceneViewCollisionConstraint"],function(B,r,f,a,b){return B.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewConstraints",properties:{tilt:a,altitude:r,clipDistance:f,collision:b},getDefaults:function(a){var b={};a.tilt||(b.tilt={});a.altitude||
(b.altitude={});a.clipDistance||(b.clipDistance={});a.collision||(b.collision={});return b},scale:function(a){this.tilt.scale(a);this.altitude.scale(a);this.clipDistance.scale(a)}})})},"esri/views/3d/constraints/SceneViewAltitudeConstraint":function(){define(["../../../core/Accessor","../support/earthUtils"],function(B,r){var f=-r.earthRadius;r=4*r.earthRadius;B=B.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewAltitudeConstraint",properties:{mode:{value:"auto"},min:{value:f,
set:function(a){this._set("min",a);this._get("max")<a&&this._set("max",a);this.mode="manual"}},max:{value:r,set:function(a){this._set("max",a);this._get("min")>a&&this._set("min",a);this.mode="manual"}}},autoUpdate:function(a,b){"auto"===this.mode&&(this._get("min")!==a&&this._set("min",a),this._get("max")!==b&&this._set("max",b))},scale:function(a){this._set("max",this._get("max")*a);this._set("min",this._get("min")*a)}});B.MIN_DEFAULT=f;B.MAX_DEFAULT=r;return B})},"esri/views/3d/constraints/SceneViewClipDistanceConstraint":function(){define(["../../../core/Accessor"],
function(B){return B.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewClipDistanceConstraint",properties:{near:{value:0,cast:function(r){return Math.max(1E-8,r)},set:function(r){this._set("near",r);r>=this._get("far")&&(this.far=r+1E-9);this.mode="manual"}},far:{value:0,cast:function(r){return Math.max(1E-8,r)},set:function(r){this._set("far",r);r<=this._near&&(this.near=r-1E-9);this.mode="manual"}},mode:{value:"auto"}},autoUpdate:function(r,f){"auto"===this.mode&&(this._get("near")!==
r&&this._set("near",r),this._get("far")!==f&&this._set("far",f))},scale:function(r){this._set("near",this._get("near")*r);this._set("far",this._get("far")*r)}})})},"esri/views/3d/constraints/SceneViewTiltConstraint":function(){define(["../../../core/Accessor","../support/mathUtils"],function(B,r){B=B.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewTiltConstraint",properties:{mode:{value:"auto"},max:{value:.5,cast:function(f){return r.clamp(f,.5,179.5)},set:function(f){this._set("max",
f);this.mode="manual"}}},autoUpdate:function(f){"auto"===this.mode&&this._get("max")!==f&&this._set("max",f)},scale:function(f){}});B.MAX_DEFAULT=.5;B.MIN_DEFAULT=179.5;return B})},"esri/views/3d/constraints/SceneViewCollisionConstraint":function(){define(["../../../core/Accessor"],function(B){return B.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewCollisionConstraint",properties:{enabled:!0}})})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/watchUtils ../../../core/Accessor ../../../core/HandleRegistry ../../../core/accessorSupport/decorators ../../input/InputManager ../../input/BrowserEventSource ../../input/ViewEvents ../../input/handlers/PreventContextMenu ./handlers/pinch/PinchNavigationGlobal ./handlers/pinch/PinchNavigationLocal ./handlers/DoubleClickZoom ./handlers/DragPan ./handlers/DragRotate ./handlers/DragZoom ./handlers/KeyPan ./handlers/MouseWheelZoom ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/PointerDownCancelAnimation ./handlers/TwoFingerTilt ./NavigationHelper".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N){B=function(c){function r(){var a=null!==c&&c.apply(this,arguments)||this;a._handles=new t;return a}f(r,c);r.prototype.initialize=function(){var a=this;this.viewEvents=new q.ViewEvents(this.view);this._handles.add([b.whenNot(this.view,"ready",function(){return a._disconnect()}),b.when(this.view,"ready",function(){return a._connect()})])};r.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};
Object.defineProperty(r.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});r.prototype._disconnect=
function(){this.viewEvents.disconnect();this._source&&(this._source.destroy(),this._source=null);this._inputManager&&(this._inputManager.destroy(),this._inputManager=null)};r.prototype._connect=function(){var a=this.view;this._source=new l.BrowserEventSource(this.view.canvas);var b=new h.InputManager(this._source);this._inputManager=b;b.installHandlers("prevent-context-menu",[new y.PreventContextMenu]);this._modeDragPan=new C.DragPan(a,"primary");this._modeDragRotate=new E.DragRotate(a,"secondary",
"center");this._modeDragZoom=new G.DragZoom(a,"tertiary");this._pinchNavigation="global"===this.view.viewingMode?new z.PinchNavigationGlobal(a,new N.NavigationHelper(a.navigation.picker)):new w.PinchNavigationLocal(a,new N.NavigationHelper(a.navigation.picker));b.installHandlers("navigation",[new K.PointerDownCancelAnimation(a),new u.DoubleClickZoom(a),new n.KeyPan(a,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j"}),new A.MouseWheelZoom(a),new I.SingleKeyResetTilt(a,
"p"),new x.SingleKeyResetHeading(a,"n"),this._pinchNavigation,new J.TwoFingerTilt(a),new E.DragRotate(a,"primary","eye",["b"]),new E.DragRotate(a,"secondary","center",["b"]),new C.DragPan(a,"tertiary",["b"]),this._modeDragPan,this._modeDragRotate,this._modeDragZoom]);this.viewEvents.connect(b);this._updateMode()};r.prototype._updateMode=function(){var a=this.primaryDragAction,a=M.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerType=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerType=
a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerType=a.zoom)};a([p.property()],r.prototype,"view",void 0);a([p.property({value:"pan"})],r.prototype,"primaryDragAction",null);a([p.property({value:"default"})],r.prototype,"mode",null);a([p.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],r.prototype,"latestPointerType",void 0);a([p.property()],r.prototype,"_inputManager",void 0);return r=a([p.subclass("esri.views.3d.input.SceneInputManager")],r)}(p.declared(c));var M=new Map;
r=new Map;c=new Map;r.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});r.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});c.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});c.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});M.set("default",r);M.set("pro",c);return B})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/now ./keys ./recognizers ../../core/Logger ./handlers/LatestPointerType".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q){Object.defineProperty(r,"__esModule",{value:!0});var y=l.getLogger("esri.views.input.InputManager");B=function(c){function l(a,b){a=c.call(this)||this;a._pointerCaptures=new Map;a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=p.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}f(l,c);l.prototype.normalizeCtorArgs=function(a,b){this._browserEvents=
a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=b;this._recognizers||(this._recognizers=h.defaults.map(function(a){return new a}));return{}};l.prototype.destroy=function(){for(var a=0,b=Object.keys(this._nameToGroup);a<b.length;a++)this.uninstallHandlers(b[a])};l.prototype.installHandlers=function(a,b){var c=this;if(this._nameToGroup[a])y.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===b.length)y.error("Can't register a group of zero handlers");
else{var h={name:a,handlers:b.map(function(a,b){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=h;a=function(a){var b=h.handlers[a];l._handlers.push(b);b.handler.onInstall({updateDependencies:function(){c.updateDependencies()},emit:function(a,h,l,f){c._emitInputEvent(b.priorityIndex,a,h,l,f)},setPointerCapture:function(a,l){c._setPointerCapture(h,b,a,l)},setEventCallback:function(a){b.eventCallback=a},setUninstallCallback:function(a){b.uninstallCallback=
a}})};var l=this;for(b=h.handlers.length-1;0<=b;b--)a(b);this.updateDependencies()}};l.prototype.uninstallHandlers=function(a){var b=this._nameToGroup[a];b?(b.handlers.forEach(function(a){a.removed=!0;a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):y.error("There is no InputHandler group registered under the name `"+a+"`")};l.prototype.hasHandlers=function(a){return void 0!==
this._nameToGroup[a]};l.prototype.updateDependencies=function(){var a=new Set,b=new Set;this._handlersPriority=[];for(var c=this._handlers.length-1;0<=c;c--){var h=this._handlers[c];h.priorityIndex=c;this._handlersPriority.push(h)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(c=this._handlersPriority.length-1;0<=c;c--){h=this._handlersPriority[c];h.priorityIndex=c;var l=h.handler.hasSideEffects;if(!l)for(var f=0,q=h.handler.outgoingEventTypes;f<q.length;f++)if(a.has(q[f])){l=
!0;break}if(l)for(f=0,q=h.handler.incomingEventMatches;f<q.length;f++){var u=q[f];a.add(u.eventType);for(var t=0,u=u.keyModifiers;t<u.length;t++){var w=u[t];p.isSystemModifier(w)||b.add(w)}}h.active=l}this._sourceEvents=a;this._keyModifiers=b;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};l.prototype._setLatestPointerType=
function(a){this._set("latestPointerType",a)};l.prototype._onEventReceived=function(a,b){"pointer-capture-lost"===a&&this._pointerCaptures.delete(b.native.pointerId);this._updateKeyModifiers(a,b);this._emitInputEventFromSource(a,b,b.native.timestamp)};l.prototype._updateKeyModifiers=function(a,b){var c=this;if(b){var h=!1,l=function(){if(!h){var a=new Set;c._activeKeyModifiers.forEach(function(b){a.add(b)});c._activeKeyModifiers=a;h=!0}},f=function(a,b){b&&!c._activeKeyModifiers.has(a)?(l(),c._activeKeyModifiers.add(a)):
!b&&c._activeKeyModifiers.has(a)&&(l(),c._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var q=b.key;this._keyModifiers.has(q)&&f(q,"key-down"===a)}a=b.native;f("Alt",!(!a||!a.altKey));f("Ctrl",!(!a||!a.ctrlKey));f("Shift",!(!a||!a.shiftKey));f("Meta",!(!a||!a.metaKey));f("Primary",this._activeKeyModifiers.has(this.primaryKey))}};l.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new q.LatestPointerType(function(b){return a._setLatestPointerType(b)});
0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};l.prototype._setPointerCapture=function(a,b,c,h){a=a.name+"-"+b.priorityIndex;b=this._pointerCaptures.get(c.pointerId)||new Set;this._pointerCaptures.set(c.pointerId,b);h?(b.add(a),1===b.size&&this._browserEvents&&this._browserEvents.setPointerCapture(c,!0)):(b.delete(a),0===b.size&&(this._pointerCaptures.delete(c.pointerId),this._browserEvents&&
this._browserEvents.setPointerCapture(c,!1)))};l.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()};l.prototype._emitInputEventFromSource=function(a,b,c){this._emitInputEvent(0,a,b,c)};l.prototype._emitInputEvent=function(a,b,c,h,l){h=void 0!==h?h:this._currentPropagation?this._currentPropagation.timestamp:t();b=new z(b,c,h,l||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(b):
this._doNewPropagation(a,b)};l.prototype._doNewPropagation=function(a,b){for(a=this._currentPropagation={events:[b],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,timestamp:b.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{b=a.events;var c=[];a.addedEvents=[];for(var h=0;h<b.length;h++){var l=b[h];a.currentHandler.active&&a.currentHandler.eventCallback(l);l.shouldStopPropagation()||c.push(l)}a.events=c.concat(a.addedEvents)}a.currentHandler=
this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};l.prototype._compareHandlerPriority=function(a,b){if(a.handler.hasSideEffects!==b.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var c=0,h=a.handler.incomingEventMatches;c<h.length;c++)for(var l=h[c],f=function(a){if(l.eventType!==a.eventType)return"continue";var b=l.keyModifiers.filter(function(b){return-1!==a.keyModifiers.indexOf(b)});
if(b.length===l.keyModifiers.length!==(b.length===a.keyModifiers.length))return{value:l.keyModifiers.length>a.keyModifiers.length?-1:1}},q=0,u=b.handler.incomingEventMatches;q<u.length;q++){var p=f(u[q]);if("object"===typeof p)return p.value}return a.priorityIndex>b.priorityIndex?-1:1};l.prototype._sortHandlersPriority=function(a){for(var b=[],c=0;c<a.length;c++){for(var h=a[c],l=0;l<b.length&&0<=this._compareHandlerPriority(h,b[l]);)l++;b.splice(l,0,h)}return b};a([b.property({readOnly:!0})],l.prototype,
"latestPointerType",void 0);return l=a([b.subclass("esri.views.input.InputManager")],l)}(b.declared(c));r.InputManager=B;var z=function(){function a(a,b,c,h){this.type=a;this.data=b;this.timestamp=c;this.modifiers=h;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=function(){return this._stopPropagation};return a}()})},"esri/views/input/keys":function(){define(["require","exports","../../core/sniff"],function(B,r,f){Object.defineProperty(r,
"__esModule",{value:!0});r.primaryKey=f("mac")?"Meta":"Ctrl";var a={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(B=48;58>B;B++)a[B]=String.fromCharCode(B);for(B=1;25>B;B++)a[111+B]="F"+B;for(B=65;91>B;B++)a[B]=[String.fromCharCode(B+32),String.fromCharCode(B)];var b={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown"};r.eventKey=function(c){if(void 0!==
c.key)return b[c.key]||c.key;var f=a[c.keyCode];return Array.isArray(f)?c.shiftKey?f[1]:f[0]:f};r.isSystemModifier=function(a){switch(a){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),function(B,r,f,a,b,c){Object.defineProperty(r,"__esModule",{value:!0});r.defaults=
[a.PointerClickHoldAndDrag,b.SingleAndDoubleClick,f.Drag,c.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../InputHandler ./support ../../../core/now".split(" "),function(B,r,f,a,b,c){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function p(){var b=a.call(this,"recognizers.Drag",!1)||this;b._startStateModifiers=new Set;b._activePointers=[];b._activePointerMap=new Map;b._isDragging=!1;b._drag=b.registerOutgoing("drag");
b.registerIncoming("pointer-drag",b._handlePointerDrag.bind(b));b.registerIncoming("pointer-down",b._handlePointerDown.bind(b));b.registerIncoming("pointer-up",b._handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b._handlePointerUpAndPointerLost.bind(b));return b}f(p,a);p.prototype._createPayload=function(a,b){return{action:a,pointers:this._activePointers.map(function(a){return a.data}),startState:this._startState,previousState:this._previousState,currentState:b}};p.prototype._fitCircleLSQ=
function(){var a=this._activePointers.map(function(a){return a.data.currentEvent});return b.fitCircleLSQ(a)};p.prototype._createDragState=function(){for(var a=this._fitCircleLSQ(),b=0,f=0,p=this._activePointers;f<p.length;f++){for(var t=p[f],w=this._pointerAngle(t,a),w=w-t.lastAngle;w>Math.PI;)w-=2*Math.PI;for(;w<-Math.PI;)w+=2*Math.PI;w=t.lastAngle+w;t.lastAngle=w;b+=w-t.initialAngle}b/=this._activePointers.length;return{angle:b,radius:a.radius,center:a.center,timestamp:c()}};p.prototype._updateMultiPointer=
function(a){var b=a.startEvent.native.pointerId,c=this._activePointerMap.get(b),h=!c;h?(c={data:null,initialAngle:0,lastAngle:0},this._activePointers.push(c),this._activePointerMap.set(b,c),c.data={startEvent:a.startEvent,previousEvent:a.previousEvent,currentEvent:a.currentEvent},a=this._fitCircleLSQ(),c.initialAngle=this._pointerAngle(c,a),c.lastAngle=c.initialAngle):c.data={startEvent:c.data.startEvent,previousEvent:a.previousEvent,currentEvent:a.currentEvent};h&&this._isDragging&&this._updateInitialAngles();
return c};p.prototype._pointerAngle=function(a,b){a=a.data.currentEvent;return Math.atan2(a.y-b.center.y,a.x-b.center.x)};p.prototype._updateInitialAngles=function(){for(var a=this._createDragState(),b=0,c=this._activePointers;b<c.length;b++){var f=c[b];f.initialAngle=this._pointerAngle(f,a)}};p.prototype._emitStart=function(a){this._updateInitialAngles();var b=this._createDragState();this._previousState=this._startState=b;this._startStateModifiers=a.modifiers;this._isDragging=!0;for(var c=0,h=this._activePointers;c<
h.length;c++){var f=h[c];f.data={previousEvent:f.data.currentEvent,startEvent:f.data.currentEvent,currentEvent:f.data.currentEvent}}this._drag.emit(this._createPayload("start",b),a.timestamp)};p.prototype._emitUpdate=function(a){a=this._createDragState();this._drag.emit(this._createPayload("update",a),void 0,this._startStateModifiers);this._previousState=a};p.prototype._emitEnd=function(){var a=this._createDragState();this._drag.emit(this._createPayload("end",a),void 0,this._startStateModifiers);
this._startState=this._previousState=null;this._isDragging=!1};p.prototype._handlePointerDown=function(a){a=a.data;this._isDragging&&this._emitEnd();this._updateMultiPointer({startEvent:a,previousEvent:a,currentEvent:a})};p.prototype._removeMultiPointer=function(a){var b=a.native.pointerId,c=this._activePointerMap.get(b);c&&(this._isDragging&&(this._updateMultiPointer({startEvent:c.data.startEvent,previousEvent:c.data.currentEvent,currentEvent:a}),this._emitEnd()),this._activePointerMap.delete(b),
a=this._activePointers.indexOf(c),this._activePointers.splice(a,1),this._isDragging&&this._updateInitialAngles())};p.prototype._handlePointerUpAndPointerLost=function(a){this._removeMultiPointer(a.data)};p.prototype._handlePointerDrag=function(a){var b=a.data;switch(b.action){case "start":this._isDragging||this._emitStart(a);break;case "update":this._isDragging||this._emitStart(a),this._updateMultiPointer(b),this._emitUpdate(a)}};return p}(a.InputHandler);r.Drag=B})},"esri/views/input/InputHandler":function(){define(["require",
"exports","./EventMatch","../../core/Logger"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});var b=a.getLogger("esri.views.input.InputHandler");B=function(){function a(a,b){this._manager=null;this._incoming={};this._outgoing={};this._outgoingEventTypes=this._incomingEventTypes=this._incomingEventMatches=null;this._name=a;this._hasSideEffects=b}Object.defineProperty(a.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches){this._incomingEventMatches=[];
for(var a in this._incoming)for(var b=0,c=this._incoming[a];b<c.length;b++)this._incomingEventMatches.push(c[b].match)}return this._incomingEventMatches},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"incomingEventTypes",{get:function(){this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(function(a){return a.eventType}));return this._incomingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"outgoingEventTypes",{get:function(){this._outgoingEventTypes||
(this._outgoingEventTypes=Object.keys(this._outgoing));return this._outgoingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasSideEffects",{get:function(){return this._hasSideEffects},enumerable:!0,configurable:!0});a.prototype.onInstall=function(a){var c=this;this._manager?b.error("This InputHandler has already been registered with an InputManager"):(a.setEventCallback(function(a){return c._handleEvent(a)}),a.setUninstallCallback(function(){return c._onUninstall()}),
this._manager=a)};a.prototype.onUninstall=function(){};a.prototype.registerIncoming=function(a,b,q){var h=this;"function"===typeof b?(q=b,b=[]):b=b||[];a="string"===typeof a?new f.EventMatch(a,b):a;var l=function(){h._incomingEventTypes=null;h._incomingEventMatches=null};b=function(a){var b=h._incoming[a.match.eventType];b&&(a=b.indexOf(a),b.splice(a,1),l(),h._manager&&h._manager.updateDependencies())};q=new c(a,q,{onPause:b,onRemove:b,onResume:function(a){var b=h._incoming[a.match.eventType];b&&
-1===b.indexOf(a)&&(b.push(a),l(),h._manager&&h._manager.updateDependencies())}});b=this._incoming[a.eventType];b||(b=[],this._incoming[a.eventType]=b);b.push(q);l();this._manager&&this._manager.updateDependencies();return q};a.prototype.registerOutgoing=function(a){var b=this;if(this._outgoing[a])throw Error("There is already a callback registered for this outgoing InputEvent: "+a);var c=new t(a,{onEmit:function(a,c,h,l){b._manager.emit(a.eventType,c,h,l)},onRemove:function(a){delete b._outgoing[a.eventType];
b._manager.updateDependencies()}});this._outgoing[a]=c;this._outgoingEventTypes=null;this._manager&&this._manager.updateDependencies();return c};a.prototype.startCapturingPointer=function(a){this._manager.setPointerCapture(a,!0)};a.prototype.stopCapturingPointer=function(a){this._manager.setPointerCapture(a,!1)};a.prototype._onUninstall=function(){this._manager?(this.onUninstall(),this._manager=null):b.error("This InputHandler is not registered with an InputManager")};a.prototype._handleEvent=function(a){var b=
this._incoming[a.type];if(b)for(var c=0;c<b.length;c++){var h=b[c];if(h.match.matches(a)&&(h.callback(a),a.shouldStopPropagation()))break}};return a}();r.InputHandler=B;var c=function(){function a(a,b,c){this.match=a;this._callback=b;this._handler=c}a.prototype.pause=function(){this._handler.onPause(this)};a.prototype.resume=function(){this._handler.onResume(this)};a.prototype.remove=function(){this._handler.onRemove(this)};Object.defineProperty(a.prototype,"callback",{get:function(){return this._callback},
enumerable:!0,configurable:!0});return a}(),t=function(){function a(a,b){this.eventType=a;this._removed=!1;this._handler=b}a.prototype.emit=function(a,b,c){if(!this._removed)this._handler.onEmit(this,a,b,c)};a.prototype.remove=function(){this._removed=!0;this._handler.onRemove(this)};return a}()})},"esri/views/input/EventMatch":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function f(a,b){void 0===b&&(b=[]);this.eventType=a;this.keyModifiers=
b}f.prototype.matches=function(a){if(a.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;a=a.modifiers;for(var b=0,c=this.keyModifiers;b<c.length;b++)if(!a.has(c[b]))return!1;return!0};return f}();r.EventMatch=B})},"esri/views/input/recognizers/support":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.manhattanDistance=function(f,a){return Math.abs(a.x-f.x)+Math.abs(a.y-f.y)};r.fitCircleLSQ=function(f,a){a?(a.radius=0,a.center.x=
0,a.center.y=0):a={radius:0,center:{x:0,y:0}};if(0===f.length)return a;if(1===f.length)return a.center.x=f[0].x,a.center.y=f[0].y,a;if(2===f.length){var b=f[0];f=f[1];var c=[f.x-b.x,f.y-b.y],t=c[0],c=c[1];a.radius=Math.sqrt(t*t+c*c)/2;a.center.x=(b.x+f.x)/2;a.center.y=(b.y+f.y)/2;return a}for(var p=0,h=0,l=0;l<f.length;l++)p+=f[l].x,h+=f[l].y;for(var p=p/f.length,h=h/f.length,q=f.map(function(a){return a.x-p}),y=f.map(function(a){return a.y-h}),z=b=a=0,w=0,u=t=0,l=c=0;l<q.length;l++){var C=q[l],E=
y[l],r=C*C,n=E*E;a+=r;b+=n;z+=C*E;w+=r*C;t+=n*E;u+=C*n;c+=E*r}l=a;q=z;y=b;w=.5*(w+u);t=.5*(t+c);c=l*y-z*q;u=(w*y-t*q)/c;t=(l*t-z*w)/c;return{radius:Math.sqrt(u*u+t*t+(a+b)/f.length),center:{x:u+p,y:t+h}}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});r.DefaultParameters={maximumClickDelay:300,movementUntilDrag:1.5,
holdDelay:500};B=function(a){function c(b,c,l){void 0===b&&(b=r.DefaultParameters.maximumClickDelay);void 0===c&&(c=r.DefaultParameters.movementUntilDrag);void 0===l&&(l=r.DefaultParameters.holdDelay);var h=a.call(this,"recognizers.PointerClickHoldAndDrag",!1)||this;h.maximumClickDelay=b;h.movementUntilDrag=c;h.holdDelay=l;h._pointerState=new Map;h._modifiers=new Set;h._pointerDrag=h.registerOutgoing("pointer-drag");h._pointerClick=h.registerOutgoing("pointer-click");h._pointerHold=h.registerOutgoing("hold");
h.registerIncoming("pointer-down",h._handlePointerDown.bind(h));h.registerIncoming("pointer-up",h._handlePointerUpOrLost.bind(h));h.registerIncoming("pointer-capture-lost",h._handlePointerUpOrLost.bind(h));h._moveHandle=h.registerIncoming("pointer-move",h._handlePointerMove.bind(h));h._moveHandle.pause();return h}f(c,a);c.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.holdTimeout&&(clearTimeout(a.holdTimeout),a.holdTimeout=0)});a.prototype.onUninstall.call(this)};c.prototype._handlePointerDown=
function(a){var b=this,c=a.data,f=c.native.pointerId,p=0;0===this._pointerState.size&&(p=setTimeout(function(){var c=b._pointerState.get(f);c&&(c.isDragging||(b._pointerHold.emit(c.previousEvent,void 0,a.modifiers),c.holdEmitted=!0),c.holdTimeout=0)},this.holdDelay));1===this._pointerState.size&&this._pointerState.forEach(function(a){0!==a.holdTimeout&&(clearTimeout(a.holdTimeout),a.holdTimeout=0)});this._pointerState.set(f,{startEvent:c,previousEvent:c,startTimestamp:a.timestamp,totalMovement:0,
isDragging:!1,downButton:c.native.button,holdTimeout:p});this.startCapturingPointer(c.native);this._moveHandle.resume()};c.prototype._createPointerDragData=function(a,b,c){return{action:a,startEvent:b.startEvent,previousEvent:b.previousEvent,currentEvent:c}};c.prototype._handlePointerMove=function(a){var c=a.data,l=this._pointerState.get(c.native.pointerId);l&&(l.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",l,c),void 0,this._modifiers):(l.totalMovement+=b.manhattanDistance(c,
l.previousEvent),l.totalMovement>this.movementUntilDrag&&(l.isDragging=!0,l.previousEvent=l.startEvent,this._modifiers=a.modifiers,0!==l.holdTimeout&&clearTimeout(l.holdTimeout),this._pointerDrag.emit(this._createPointerDragData("start",l,l.startEvent),l.startTimestamp),this._pointerDrag.emit(this._createPointerDragData("update",l,c)))),l.previousEvent=c)};c.prototype._handlePointerUpOrLost=function(a){var b=a.data,c=b.native.pointerId,f=this._pointerState.get(c);f&&(0!==f.holdTimeout&&clearTimeout(f.holdTimeout),
f.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",f,b),void 0,this._modifiers):f.downButton===b.native.button&&a.timestamp-f.startTimestamp<=this.maximumClickDelay&&!f.holdEmitted&&this._pointerClick.emit(b),this._pointerState.delete(c),this.stopCapturingPointer(b.native),0===this._pointerState.size&&this._moveHandle.pause())};return c}(a.InputHandler);r.PointerClickHoldAndDrag=B})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../InputHandler","./support"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function c(b,c,l){void 0===b&&(b=250);void 0===c&&(c=10);void 0===l&&(l=35);var h=a.call(this,"recognizers.SingleAndDoubleClick",!1)||this;h.maximumDoubleClickDelay=b;h.maximumDoubleClickDistance=c;h.maximumDoubleTouchDistance=l;h._pointerState=new Map;h._click=h.registerOutgoing("click");h._doubleClick=h.registerOutgoing("double-click");h.registerIncoming("pointer-click",h._handlePointerClick.bind(h));
return h}f(c,a);c.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.doubleClickTimeout&&(clearTimeout(a.doubleClickTimeout),a.doubleClickTimeout=0)})};c.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};c.prototype._handlePointerClick=function(a){var c=a.data,l=this._pointerId(c),f=this._pointerState.get(l);if(f){clearTimeout(f.doubleClickTimeout);f.doubleClickTimeout=0;var p="touch"===c.native.pointerType?
this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;b.manhattanDistance(f.event.data,c)>p?(this._doubleClickTimeoutExceeded(l),this._startClick(a)):(this._doubleClick.emit(c,void 0,f.event.modifiers),this._pointerState.delete(l))}else this._startClick(a)};c.prototype._startClick=function(a){var b=this,c=this._pointerId(a.data);this._pointerState.set(c,{event:a,doubleClickTimeout:setTimeout(function(){return b._doubleClickTimeoutExceeded(c)},this.maximumDoubleClickDelay)})};c.prototype._doubleClickTimeoutExceeded=
function(a){var b=this._pointerState.get(a);this._click.emit(b.event.data,void 0,b.event.modifiers);b.doubleClickTimeout=0;this._pointerState.delete(a)};return c}(a.InputHandler);r.SingleAndDoubleClick=B})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function b(b,c){void 0===b&&(b=20);void 0===c&&(c=40);var h=a.call(this,
"recognizers.VerticalTwoFingerDrag",!1)||this;h._threshold=b;h._maxDelta=c;h._failed=!1;h._active=!1;h._vertical=h.registerOutgoing("vertical-two-finger-drag");h._artificalDragEnd=h.registerOutgoing("drag");h.registerIncoming("drag",h._handleDrag.bind(h));return h}f(b,a);Object.defineProperty(b.prototype,"failed",{get:function(){return this._failed},enumerable:!0,configurable:!0});b.prototype._handleDrag=function(a){if(2===a.data.pointers.length)switch(a.data.action){case "start":this._handleDragStart(a);
break;case "update":this._handleDragUpdate(a);break;case "end":this._handleDragEnd(a)}};b.prototype._handleDragStart=function(a){this._failed=!1;this._dragStartCenter=a.data.currentState.center};b.prototype._handleDragUpdate=function(a){this._failed||(this._active?(this._vertical.emit({delta:a.data.currentState.center.y-this._thresholdReachedCenter.y,action:"update"}),a.stopPropagation()):(this._failed=!this._checkDeltaConstraint(a.data),!this._failed&&this._checkThresholdReached(a.data)&&(this._active=
!0,this._thresholdReachedCenter=a.data.currentState.center,this._artificalDragEnd.emit({action:"end",currentState:a.data.currentState,previousState:a.data.previousState,startState:a.data.startState,pointers:a.data.pointers}),this._vertical.emit({delta:a.data.currentState.center.y-this._thresholdReachedCenter.y,action:"begin"}),a.stopPropagation())))};b.prototype._handleDragEnd=function(a){this._active&&(this._vertical.emit({delta:a.data.currentState.center.y-this._thresholdReachedCenter.y,action:"end"}),
a.stopPropagation());this._active=!1};b.prototype._checkDeltaConstraint=function(a){var b=Math.abs(a.pointers[0].startEvent.x-a.pointers[1].startEvent.x),c=Math.abs(a.pointers[0].startEvent.y-a.pointers[1].startEvent.y),l=Math.abs(a.pointers[0].currentEvent.y-a.pointers[1].currentEvent.y),f=Math.abs(a.pointers[0].currentEvent.x-a.pointers[1].currentEvent.x);return Math.abs(a.currentState.center.x-a.startState.center.x)<this._threshold&&Math.abs(f-b)<=this._maxDelta&&Math.abs(l-c)<=this._maxDelta};
b.prototype._checkThresholdReached=function(a){return Math.min(Math.abs(a.pointers[0].currentEvent.y-a.pointers[0].startEvent.y),Math.abs(a.pointers[1].currentEvent.y-a.pointers[1].startEvent.y),Math.abs(a.currentState.center.y-a.startState.center.y))>=this._threshold};return b}(a.InputHandler);r.VerticalTwoFingerDrag=B})},"esri/views/input/handlers/LatestPointerType":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(B,r,f,a){Object.defineProperty(r,
"__esModule",{value:!0});B=function(a){function b(b){var c=a.call(this,"LatestPointerInteraction",!0)||this;c._onChange=b;c._value="mouse";c.registerIncoming("pointer-down",function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler=c.registerIncoming("pointer-move",function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler.pause();return c}f(b,a);b.prototype._setValue=function(a){a!==this._value&&("touch"===a?this._moveHandler.resume():
this._moveHandler.pause(),this._value=a,this._onChange(a))};return b}(a.InputHandler);r.LatestPointerType=B})},"esri/views/input/BrowserEventSource":function(){define(["require","exports","./keys","../../core/libs/pep/pep","dojo/sniff"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});var c=b("trident"),t=b("edge"),p=b("chrome"),h=b("ff"),l=b("safari");B=function(){function b(b){this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._element=b;a.applyLocal(b);
b.getAttribute("tabindex")||b.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointerDown,"pointer-move":this._handlePointer,"pointer-up":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=b.style.touchAction;b.style.touchAction="none"}b.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(b){a._element.releasePointerCapture(b)});
this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction};Object.defineProperty(b.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"activeEvents",{set:function(a){var b=this,c;for(c in this._active)a&&a.has(c)||(this._element.removeEventListener(q[c],this._active[c]),delete this._active[c]);a&&a.forEach(function(a){if(!b._active[a]&&q[a]){var c=(b._eventHandlers[a]||b._handleDefault).bind(b,
a);b._element.addEventListener(q[a],c);b._active[a]=c}})},enumerable:!0,configurable:!0});b.prototype.setPointerCapture=function(a,b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._element.releasePointerCapture(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};b.prototype._updateNormalizedPointerLikeEvent=function(a,b){var c=this._element.getBoundingClientRect();b.x=a.clientX-Math.round(c.left);b.y=a.clientY-Math.round(c.top);return b};
b.prototype._handleKey=function(a,b){var c=f.eventKey(b);c&&"key-up"===a&&this._keyDownState.delete(c);b={native:b,key:c,repeat:c&&this._keyDownState.has(c)};c&&"key-down"===a&&this._keyDownState.add(b.key);this._callback(a,b)};b.prototype._handlePointerDown=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0});this._callback(a,b)};b.prototype._handlePointer=function(a,b){var c=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0});b.preventDefault();this._callback(a,
c)};b.prototype._handleMouseWheel=function(a,b){b.preventDefault();var f=b.deltaY;switch(b.deltaMode){case 0:if(c||t)f=f/document.documentElement.clientHeight*600;break;case 1:f*=30;break;case 2:f*=900}c||t?f*=.7:p||l?f*=.6:h&&(f*=1.375);var q=Math.abs(f);100<q&&(f=f/q*200/(1+Math.exp(-.02*(q-100))));b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,deltaY:f});this._callback(a,b)};b.prototype._handlePointerCaptureLost=function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,
b)};b.prototype._handleDefault=function(a,b){var c={native:b};b.preventDefault();this._callback(a,c)};return b}();r.BrowserEventSource=B;var q={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu"}})},"esri/core/libs/pep/pep":function(){define(function(){function B(a,d){d=d||Object.create(null);
var e=document.createEvent("Event");e.initEvent(a,d.bubbles||!1,d.cancelable||!1);a=2;for(var b;a<l.length;a++)b=l[a],e[b]=d[b]||q[a];e.buttons=d.buttons||0;a=0;a=d.pressure?d.pressure:e.buttons?.5:0;e.x=e.clientX;e.y=e.clientY;e.pointerId=d.pointerId||0;e.width=d.width||0;e.height=d.height||0;e.pressure=a;e.tiltX=d.tiltX||0;e.tiltY=d.tiltY||0;e.pointerType=d.pointerType||"";e.hwTimestamp=d.hwTimestamp||0;e.isPrimary=d.isPrimary||!1;return e}function r(){this.array=[];this.size=0}function f(a,d,e,
b){this.addCallback=a.bind(b);this.removeCallback=d.bind(b);this.changedCallback=e.bind(b);K&&(this.observer=new K(this.mutationWatcher.bind(this)))}function a(a){return"body /shadow-deep/ "+b(a)}function b(a){return'[touch-action\x3d"'+a+'"]'}function c(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}function t(){if(Q){N.forEach(function(d){String(d)===d?(M+=b(d)+c(d)+"\n",S&&(M+=a(d)+c(d)+"\n")):(M+=d.selectors.map(b)+c(d.rule)+"\n",S&&(M+=d.selectors.map(a)+
c(d.rule)+"\n"))});var d=document.createElement("style");d.textContent=M;document.head.appendChild(d)}}function p(a){if(!E.pointermap.has(a))throw a=Error("InvalidPointerId"),a.name="InvalidPointerId",a;}function h(a){if(!a.ownerDocument.contains(a))throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var l="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),q=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,
0,null,0,0],y=window.Map&&window.Map.prototype.forEach?Map:r;r.prototype={set:function(a,d){if(void 0===d)return this.delete(a);this.has(a)||this.size++;this.array[a]=d},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,d){return this.array.forEach(function(e,b){a.call(d,e,b,this)},this)}};var z="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
w=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],u={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},C="undefined"!==typeof SVGElementInstance,E={pointermap:new y,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,d){var e=d.events;e&&(e.forEach(function(a){d[a]&&(this.eventMap[a]=d[a].bind(d))},this),this.eventSources[a]=d,this.eventSourceList.push(d))},register:function(a){for(var d=
this.eventSourceList.length,e=0,b;e<d&&(b=this.eventSourceList[e]);e++)b.register.call(b,a)},unregister:function(a){for(var d=this.eventSourceList.length,e=0,b;e<d&&(b=this.eventSourceList[e]);e++)b.unregister.call(b,a)},contains:function(a,d){try{return a.contains(d)}catch(ja){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var d=a.type;(d=this.eventMap&&
this.eventMap[d])&&d(a);a._handledByPE=!0}},listen:function(a,d){d.forEach(function(d){this.addEvent(a,d)},this)},unlisten:function(a,d){d.forEach(function(d){this.removeEvent(a,d)},this)},addEvent:function(a,d){a.addEventListener(d,this.boundHandler)},removeEvent:function(a,d){a.removeEventListener(d,this.boundHandler)},makeEvent:function(a,d){this.captureInfo[d.pointerId]&&(d.relatedTarget=null);a=new B(a,d);d.preventDefault&&(a.preventDefault=d.preventDefault);a._target=a._target||d.target;return a},
fireEvent:function(a,d){a=this.makeEvent(a,d);return this.dispatchEvent(a)},cloneEvent:function(a){for(var d=Object.create(null),e,b=0;b<z.length;b++)e=z[b],d[e]=a[e]||w[b],C&&("target"===e||"relatedTarget"===e)&&d[e]instanceof SVGElementInstance&&(d[e]=d[e].correspondingUseElement);a.preventDefault&&(d.preventDefault=function(){a.preventDefault()});return d},getTarget:function(a){var d=this.captureInfo[a.pointerId];if(!d)return a._target;if(a._target===d||!(a.type in u))return d},propagate:function(a,
d,e){for(var b=a.target,c=[];!b.contains(a.relatedTarget)&&b!==document;)c.push(b),b=b.parentNode;e&&c.reverse();c.forEach(function(e){a.target=e;d.call(this,a)},this)},setCapture:function(a,d){this.captureInfo[a]&&this.releaseCapture(a);this.captureInfo[a]=d;var e=new B("gotpointercapture");e.pointerId=a;this.implicitRelease=this.releaseCapture.bind(this,a);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);e._target=d;this.asyncDispatchEvent(e)},
releaseCapture:function(a){var d=this.captureInfo[a];if(d){var e=new B("lostpointercapture");e.pointerId=a;this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);e._target=d;this.asyncDispatchEvent(e)}},dispatchEvent:function(a){var d=this.getTarget(a);if(d)return d.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};E.boundHandler=E.eventHandler.bind(E);
var G={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var d=a.olderShadowRoot;!d&&(a=a.querySelector("shadow"))&&(d=a.olderShadowRoot);return d},allShadows:function(a){var d=[];for(a=this.shadow(a);a;)d.push(a),a=this.olderShadow(a);return d},searchRoot:function(a,d,e){if(a){var b=a.elementFromPoint(d,e),c;for(c=this.targetingShadow(b);c;){if(a=
c.elementFromPoint(d,e))return b=this.targetingShadow(a),this.searchRoot(b,d,e)||a;c=this.olderShadow(c)}return b}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var d=a.clientX,e=a.clientY;a=this.owner(a.target);a.elementFromPoint(d,e)||(a=document);return this.searchRoot(a,d,e)}},n=Array.prototype.forEach.call.bind(Array.prototype.forEach),A=Array.prototype.map.call.bind(Array.prototype.map),
x=Array.prototype.slice.call.bind(Array.prototype.slice),I=Array.prototype.filter.call.bind(Array.prototype.filter),K=window.MutationObserver||window.WebKitMutationObserver,J={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};f.prototype={watchSubtree:function(a){this.observer&&G.canTarget(a)&&this.observer.observe(a,J)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},
installNewSubtree:function(a){n(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,d){this.changedCallback(a,d)},concatLists:function(a,d){return a.concat(x(d))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},
isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var d=A(a,this.findElements,this);d.push(I(a,this.isElement));return d.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,this)):"attributes"===a.type&&this.elementChanged(a.target,
a.oldValue)}};var N=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],M="",Q=window.PointerEvent||window.MSPointerEvent,S=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,P=E.pointermap,O=[1,4,2,8,16],T=!1;try{T=1===(new MouseEvent("test",{buttons:1})).buttons}catch(Z){}var U={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){E.listen(a,this.events)},unregister:function(a){E.unlisten(a,
this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var d=this.lastTouches,e=a.clientX;a=a.clientY;for(var b=0,c=d.length,g;b<c&&(g=d[b]);b++){var k=Math.abs(a-g.y);if(25>=Math.abs(e-g.x)&&25>=k)return!0}},prepareEvent:function(a){var d=E.cloneEvent(a),e=d.preventDefault;d.preventDefault=function(){a.preventDefault();e()};d.pointerId=this.POINTER_ID;d.isPrimary=!0;d.pointerType=this.POINTER_TYPE;return d},prepareButtonsForMove:function(a,d){var e=P.get(this.POINTER_ID);a.buttons=0!==
d.which&&e?e.buttons:0;d.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var d=P.get(this.POINTER_ID),e=this.prepareEvent(a);T||(e.buttons=O[e.button],d&&(e.buttons|=d.buttons),a.buttons=e.buttons);P.set(this.POINTER_ID,a);d&&0!==d.buttons?E.move(e):E.down(e)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var d=this.prepareEvent(a);T||this.prepareButtonsForMove(d,a);d.button=-1;P.set(this.POINTER_ID,a);E.move(d)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var d=
P.get(this.POINTER_ID),e=this.prepareEvent(a);if(!T){var b=O[e.button];e.buttons=d?d.buttons&~b:0;a.buttons=e.buttons}P.set(this.POINTER_ID,a);e.buttons&=~O[e.button];0===e.buttons?E.up(e):E.move(e)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var d=this.prepareEvent(a);T||this.prepareButtonsForMove(d,a);d.button=-1;P.set(this.POINTER_ID,a);E.enterOver(d)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var d=this.prepareEvent(a);T||this.prepareButtonsForMove(d,a);d.button=
-1;E.leaveOut(d)}},cancel:function(a){a=this.prepareEvent(a);E.cancel(a);this.deactivateMouse()},deactivateMouse:function(){P.delete(this.POINTER_ID)}},W=E.captureInfo,k=G.findTarget.bind(G),ca=G.allShadows.bind(G),V=E.pointermap,e,d={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){e.enableOnSubtree(a)},unregister:function(a){},elementAdded:function(a){var d=a.getAttribute("touch-action"),e=this.touchActionToScrollType(d);e&&(a._scrollType=e,E.listen(a,this.events),
ca(a).forEach(function(a){a._scrollType=e;E.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;E.unlisten(a,this.events);ca(a).forEach(function(a){a._scrollType=void 0;E.unlisten(a,this.events)},this)},elementChanged:function(a,d){var e=a.getAttribute("touch-action"),b=this.touchActionToScrollType(e);d=this.touchActionToScrollType(d);b&&d?(a._scrollType=b,ca(a).forEach(function(a){a._scrollType=b},this)):d?this.elementRemoved(a):b&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",
XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var d=this.scrollTypes;if("none"===a)return"none";if(a===d.XSCROLLER)return"X";if(a===d.YSCROLLER)return"Y";if(d.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===V.size||1===V.size&&V.has(1))this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=
!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var d=0;if("touchstart"===a||"touchmove"===a)d=1;return d},touchToPointer:function(a){var d=this.currentTouchEvent,
e=E.cloneEvent(a),b=e.pointerId=a.identifier+2;e.target=W[b]||k(e);e.bubbles=!0;e.cancelable=!0;e.detail=this.clickCount;e.button=0;e.buttons=this.typeToButtons(d.type);e.width=a.radiusX||a.webkitRadiusX||0;e.height=a.radiusY||a.webkitRadiusY||0;e.pressure=a.force||a.webkitForce||.5;e.isPrimary=this.isPrimaryTouch(a);e.pointerType=this.POINTER_TYPE;e.altKey=d.altKey;e.ctrlKey=d.ctrlKey;e.metaKey=d.metaKey;e.shiftKey=d.shiftKey;var c=this;e.preventDefault=function(){c.scrolling=!1;c.firstXY=null;d.preventDefault()};
return e},processTouches:function(a,d){var e=a.changedTouches;this.currentTouchEvent=a;a=0;for(var b;a<e.length;a++)b=e[a],d.call(this,this.touchToPointer(b))},shouldScroll:function(a){if(this.firstXY){var d;d=a.currentTarget._scrollType;if("none"===d)d=!1;else if("XY"===d)d=!0;else{a=a.changedTouches[0];var e="Y"===d?"X":"Y";d=Math.abs(a["client"+d]-this.firstXY[d])>=Math.abs(a["client"+e]-this.firstXY[e])}this.firstXY=null;return d}},findTouch:function(a,d){for(var e=0,b=a.length,c;e<b&&(c=a[e]);e++)if(c.identifier===
d)return!0},vacuumTouches:function(a){var d=a.touches;if(V.size>=d.length){var e=[];V.forEach(function(a,b){1===b||this.findTouch(d,b-2)||e.push(a.out)},this);e.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){V.set(a.pointerId,{target:a.target,out:a,outTarget:a.target});E.enterOver(a);E.down(a)},touchmove:function(a){this.scrolling||
(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var d=V.get(a.pointerId);if(d){var e=d.out,b=d.outTarget;E.move(a);e&&b!==a.target&&(e.relatedTarget=a.target,a.relatedTarget=b,e.target=b,a.target?(E.leaveOut(e),E.enterOver(a)):(a.target=b,a.relatedTarget=null,this.cancelOut(a)));d.out=a;d.outTarget=a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||
(E.up(a),E.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){E.cancel(a);E.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){V.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var d=U.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},d.push(a),d=function(a,d){d=a.indexOf(d);-1<d&&a.splice(d,1)}.bind(null,d,a),setTimeout(d,2500))}};e=new f(d.elementAdded,
d.elementRemoved,d.elementChanged,d);var g=E.pointermap,m=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,v={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){E.listen(a,this.events)},unregister:function(a){E.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var d=a;m&&(d=E.cloneEvent(a),d.pointerType=
this.POINTER_TYPES[a.pointerType]);return d},cleanup:function(a){g.delete(a)},MSPointerDown:function(a){g.set(a.pointerId,a);a=this.prepareEvent(a);E.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);E.move(a)},MSPointerUp:function(a){var d=this.prepareEvent(a);E.up(d);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);E.leaveOut(a)},MSPointerOver:function(a){a=this.prepareEvent(a);E.enterOver(a)},MSPointerCancel:function(a){var d=this.prepareEvent(a);E.cancel(d);this.cleanup(a.pointerId)},
MSLostPointerCapture:function(a){a=E.makeEvent("lostpointercapture",a);E.dispatchEvent(a)},MSGotPointerCapture:function(a){a=E.makeEvent("gotpointercapture",a);E.dispatchEvent(a)}},D,L;window.navigator.msPointerEnabled?(D=function(a){p(a);h(this);0!==E.pointermap.get(a).buttons&&this.msSetPointerCapture(a)},L=function(a){p(a);this.msReleasePointerCapture(a)}):(D=function(a){p(a);h(this);0!==E.pointermap.get(a).buttons&&E.setCapture(a,this)},L=function(a){p(a);E.releaseCapture(a,this)});var R=window.PointerEvent||
window.MSPointerEvent;return{dispatcher:E,Installer:f,PointerEvent:B,PointerMap:y,targetFinding:G,applyGlobal:function(){t();window.PointerEvent||(window.PointerEvent=B,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,enumerable:!0}),E.registerSource("ms",v)):(E.registerSource("mouse",U),void 0!==window.ontouchstart&&E.registerSource("touch",d)),E.register(document));window.Element&&!Element.prototype.setPointerCapture&&
Object.defineProperties(Element.prototype,{setPointerCapture:{value:D},releasePointerCapture:{value:L}})},applyLocal:function(a){R||(window.PointerEvent||(window.navigator.msPointerEnabled?E.registerSource("ms",v):(E.registerSource("mouse",U),void 0!==window.ontouchstart&&E.registerSource("touch",d)),E.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=D.bind(a),a.releasePointerCapture=L.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action",
"none"))}}})},"esri/views/input/ViewEvents":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./InputHandler","../../geometry/ScreenPoint"],function(B,r,f,a,b){function c(a){return!!p[a]}function t(a){for(var b=0;b<a.length;b++)if(!c(a[b]))return!1;return!0}Object.defineProperty(r,"__esModule",{value:!0});var p={click:!0,"double-click":!0,hold:!0,drag:!0,"key-down":!0,"key-up":!0,"pointer-down":!0,"pointer-move":!0,"pointer-up":!0,"mouse-wheel":!0},h;(function(a){a[a.Left=
0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(h||(h={}));B=function(){function a(a){this.handlers=new Map;this.counter=0;this.view=a;this.inputManager=null}a.prototype.connect=function(a){var b=this;a&&this.disconnect();this.inputManager=a;this.handlers.forEach(function(a,c){return b.inputManager.installHandlers(c,[a])})};a.prototype.disconnect=function(){var a=this;this.inputManager&&this.handlers.forEach(function(b,c){return a.inputManager.uninstallHandlers(c)});this.inputManager=null};
a.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=null};a.prototype.register=function(a,b,h){var f=this;a=Array.isArray(a)?a:a.split(",");if(!t(a))return a.some(c)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;var q=Array.isArray(b)?b:[];h=Array.isArray(b)?h:b;var p=this.createUniqueGroupName();b=new l(this.view,a,q,h);this.handlers.set(p,b);this.inputManager&&this.inputManager.installHandlers(p,
[b]);return{remove:function(){return f.removeHandler(p)}}};a.prototype.removeHandler=function(a){this.handlers.has(a)&&this.handlers.delete(a);this.inputManager&&this.inputManager.uninstallHandlers(a)};a.prototype.createUniqueGroupName=function(){this.counter+=1;return"viewEvents_"+this.counter};return a}();r.ViewEvents=B;var l=function(a){function c(b,c,h,l){var f=a.call(this,"esri.views.input.ViewEventHandler",!0)||this;f.view=b;for(b=0;b<c.length;b++)switch(c[b]){case "click":f.registerIncoming("click",
h,function(a){return l(f.wrapClick(a))});break;case "double-click":f.registerIncoming("double-click",h,function(a){return l(f.wrapDoubleClick(a))});break;case "hold":f.registerIncoming("hold",h,function(a){return l(f.wrapHold(a))});break;case "drag":f.registerIncoming("drag",h,function(a){return l(f.wrapDrag(a))});break;case "key-down":f.registerIncoming("key-down",h,function(a){return l(f.wrapKeyDown(a))});break;case "key-up":f.registerIncoming("key-up",h,function(a){return l(f.wrapKeyUp(a))});break;
case "pointer-down":f.registerIncoming("pointer-down",h,function(a){return l(f.wrapPointer(a,"pointer-down"))});break;case "pointer-move":f.registerIncoming("pointer-move",h,function(a){return l(f.wrapPointer(a,"pointer-move"))});break;case "pointer-up":f.registerIncoming("pointer-up",h,function(a){return l(f.wrapPointer(a,"pointer-up"))});break;case "mouse-wheel":f.registerIncoming("mouse-wheel",h,function(a){return l(f.wrapMouseWheel(a))})}return f}f(c,a);c.prototype.wrapClick=function(a){var c=
a.data.x,h=a.data.y;return{type:"click",button:"touch"===a.data.native.pointerType?0:a.data.native.button,x:c,y:h,native:a.data.native,timestamp:a.timestamp,screenPoint:new b(c,h),mapPoint:this.view.toMap(c,h),stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapDoubleClick=function(a){var b=a.data.x,c=a.data.y;return{type:"double-click",button:"touch"===a.data.native.pointerType?0:a.data.native.button,x:b,y:c,native:a.data.native,timestamp:a.timestamp,mapPoint:this.view.toMap(b,
c),stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapHold=function(a){var b=a.data.x,c=a.data.y;return{type:"hold",button:"touch"===a.data.native.pointerType?0:a.data.native.button,x:b,y:c,native:a.data.native,timestamp:a.timestamp,mapPoint:this.view.toMap(b,c),stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapDrag=function(a){return{type:"drag",action:a.data.action,x:a.data.currentState.center.x,y:a.data.currentState.center.y,origin:{x:a.data.startState.center.x,
y:a.data.startState.center.y},native:a.data.pointers[0].currentEvent.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapKeyDown=function(a){return{type:"key-down",key:a.data.key,repeat:a.data.repeat,native:a.data.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapKeyUp=function(a){return{type:"key-up",key:a.data.key,native:a.data.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};
c.prototype.wrapPointer=function(a,b){return{type:b,x:a.data.x,y:a.data.y,pointerId:a.data.native.pointerId,pointerType:a.data.native.pointerType,native:a.data.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapMouseWheel=function(a){return{type:"mouse-wheel",x:a.data.x,y:a.data.y,deltaY:a.data.deltaY,native:a.data.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};return c}(a.InputHandler)})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function b(){var b=a.call(this,"PreventContextMenu",!0)||this;b.registerIncoming("context-menu",function(a){a.data.native.preventDefault()});return b}f(b,a);return b}(a.InputHandler);r.PreventContextMenu=B;r.default=B})},"esri/views/3d/input/handlers/pinch/PinchNavigationGlobal":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../util ./PinchNavigationBase ./MomentumNavigationGlobal".split(" "),
function(B,r,f,a,b,c,t){Object.defineProperty(r,"__esModule",{value:!0});var p;(function(a){a[a.Horizontal=0]="Horizontal";a[a.Vertical=1]="Vertical"})(p=r.PanMode||(r.PanMode={}));var h=a.vec3d.create(),l=16/180*Math.PI;B=function(c){function q(h,l){var f=c.call(this,h,l)||this;f.view=h;f._rotation={axis:a.vec3d.create(),valueSmooth:new b.ExponentialFalloff(.05)};f._panning={axis:a.vec3d.create(),plane:{distance:0,normal:a.vec3d.create()},planarCenterScene:a.vec3d.create()};f._scaling={valueSmooth:new b.ExponentialFalloff(.05),
centerScreen:a.vec2.create()};f._beginScenePoints={points:[],center:a.vec3d.create()};f._panMode=p.Horizontal;f._navigationSphereRadius=0;f._tmpN=a.vec3d.create();f._tmp2d=a.vec2.create();f._tmpPickPointScreen=a.vec2.create();f._tmpPickPointScene=a.vec3d.create();f._tmpCurrentPoints=[];f._tmpCurrentCenter=a.vec3d.create();f._tmpD=a.vec3d.create();f._horizonPointScreen=a.vec3d.create();f._horizonPointScene=a.vec3d.create();f._momentumNavigation=new t.MomentumNavigationGlobal(f,l);return f}f(q,c);Object.defineProperty(q.prototype,
"momentum",{get:function(){return this._momentumNavigation},enumerable:!0,configurable:!0});q.prototype.onNavigationBegin=function(b){var c=this._tmpPickPointScreen,h=this._tmpPickPointScene,f=this._helper;this._rotation.valueSmooth.reset();this._scaling.valueSmooth.reset();a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,c);f.picker.pickPointInScreen(c,h)?this._navigationSphereRadius=a.vec3d.length(h):(this._navigationSphereRadius=Math.max(a.vec3d.length(this.beginCamera.center),
.9*f.earthUtils.earthRadius),this._helper.spherical.makeRenderCoordSpherePoint(this._navigationSphereRadius,this.beginCamera,c,h));this._panMode=p.Horizontal;3E4>this.view.renderCoordsHelper.getAltitude(this.beginCamera.eye)&&(this._navigationSphereRadius>a.vec3d.length(this.beginCamera.eye)?this._panMode=p.Vertical:(a.vec3d.normalize(h,this._tmpN),Math.abs(.5*Math.PI-Math.acos(a.vec3d.dot(this.beginCamera.viewForward,this._tmpN)))<l&&(this._panMode=p.Vertical)));if(this._panMode===p.Horizontal)this._computeSpherePoints(b,
"startEvent",this._navigationSphereRadius,this.beginCamera,this._beginScenePoints.points),f.spherical.computePointCenter(this._beginScenePoints.points,this._navigationSphereRadius,this._beginScenePoints.center);else{a.vec3d.set(this.beginCamera.viewForward,this._panning.plane.normal);a.vec3d.normalize(this._panning.plane.normal);a.vec3d.negate(this._panning.plane.normal);var q=a.vec3d.dot(h,this._panning.plane.normal),t=this._horizonPointScreen;a.vec3d.set3(c[0],this.view.height,0,t);var n=this._horizonPointScene,
y=a.vec3d.length(this.beginCamera.eye),z=this._navigationSphereRadius;this._helper.spherical.makeRenderCoordSpherePoint(y<z?y-100:z,this.beginCamera,t,n);this.beginCamera.projectPoint(n,t);c[1]=Math.min(c[1],.9*t[1]);f.picker.pickPointInScreen(c,h)&&(q=a.vec3d.dot(h,this._panning.plane.normal));this._panning.plane.distance=q;a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,this._tmp2d);this._helper.planar.intersectPlaneFromScreenPoint(this._panning.plane,this.beginCamera,
this._tmp2d,this._panning.planarCenterScene)}};q.prototype.onNavigationUpdate=function(b,c){var l=this._helper,f=b.data.pointers.length,q=1<f;if(this._panMode===p.Horizontal){var t=this._navigationSphereRadius;if(q){var n=b.data.startState.radius/b.data.currentState.radius,w=.001875*Math.min(Math.max(b.data.currentState.radius,40),120);this._scaling.valueSmooth.gain=w;this._scaling.valueSmooth.update(n);l.spherical.applyZoom(t,this.view,c,this._scaling.valueSmooth.value);a.vec2.set2(b.data.currentState.center.x,
this.view.height-b.data.currentState.center.y,this._scaling.centerScreen);this.momentum.addScaleValue(b.timestamp,this._scaling.valueSmooth.value)}n=this._tmpCurrentPoints;w=this._tmpCurrentCenter;this._computeSpherePoints(b,"currentEvent",t,c,n);l.spherical.computePointCenter(n,t,w);var n=this._panning.axis,y=l.spherical.rotationFromPoints(t,this._beginScenePoints.center,w,n);l.applyRotation(c,h,n,y);y=this._tmp2d;a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,
y);this.momentum.addPanValue(b.timestamp,y,w,n);if(q){q=this._rotation.axis;n=this._tmpCurrentPoints;a.vec3d.normalize(this._beginScenePoints.center,q);this._computeSpherePoints(b,"currentEvent",t,c,n);t=0;if(2===f)t=l.rotationFromPointsAroundAxis(n[0],this._beginScenePoints.points[0],q);else{for(w=0;w<f;w++)t+=l.rotationFromPointsAroundAxis(n[w],this._beginScenePoints.points[w],q);t/=f}f=this._rotation.valueSmooth.value;t=l.normalizeRotationDelta(t-f);w=.00125*Math.min(Math.max(b.data.currentState.radius,
40),120);this._rotation.valueSmooth.gain=w;this._rotation.valueSmooth.update(f+t);f=this._rotation.valueSmooth.value;this.momentum.addRotationValue(b.timestamp,f);l.applyRotation(c,h,q,f)}}else f=this._panning.plane,q&&(n=b.data.startState.radius/b.data.currentState.radius,w=.001875*Math.min(Math.max(b.data.currentState.radius,40),120),this._scaling.valueSmooth.gain=w,this._scaling.valueSmooth.update(n),this.momentum.addScaleValue(b.timestamp,this._scaling.valueSmooth.value),this.momentum.setVerticalParameters(f,
this._panning.planarCenterScene),l.planar.applyZoom(f,this.view,c,this._panning.planarCenterScene,this._scaling.valueSmooth.value)),w=this._tmpCurrentCenter,a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,this._tmp2d),this._helper.planar.intersectPlaneFromScreenPoint(f,c,this._tmp2d,w),f=this._tmpD,a.vec3d.subtract(w,this._panning.planarCenterScene,f),a.vec3d.subtract(c.eye,f),a.vec3d.subtract(c.center,f),c.markViewDirty(),y=this._tmp2d,a.vec2.set2(b.data.currentState.center.x,
this.view.height-b.data.currentState.center.y,y),this.momentum.addPanValue(b.timestamp,y,w,f),q&&(q=this._rotation.axis,a.vec3d.set(this._panning.planarCenterScene,q),t=b.data.currentState.angle,f=this._rotation.valueSmooth.value,t=l.normalizeRotationDelta(t-f),w=.00125*Math.min(Math.max(b.data.currentState.radius,40),120),this._rotation.valueSmooth.gain=w,this._rotation.valueSmooth.update(f+t),f=this._rotation.valueSmooth.value,this.momentum.addRotationValue(b.timestamp,f),l.applyRotation(c,h,q,
f));c.markViewDirty()};q.prototype.onNavigationEnd=function(a){this._panMode===p.Horizontal?this.momentum.setParameters(this._navigationSphereRadius,this._scaling.centerScreen,this._beginScenePoints.center,this._panMode):this.momentum.setParameters(this._navigationSphereRadius,this._scaling.centerScreen,this._panning.planarCenterScene,this._panMode)};q.prototype._computeSpherePoints=function(b,c,h,l,f){f.length=b.data.pointers.length;for(var q=this._tmp2d,n=0;n<f.length;n++){var u=b.data.pointers[n];
q[0]=u[c].x;q[1]=this.view.height-u[c].y;void 0===f[n]&&(f[n]=a.vec3d.create());this._helper.spherical.makeRenderCoordSpherePoint(h,l,q,f[n])}return f};return q}(c.PinchNavigationBase);r.PinchNavigationGlobal=B})},"esri/views/3d/input/util":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function f(a){this._gain=a}f.prototype.reset=function(a){this._value=a};Object.defineProperty(f.prototype,"gain",{set:function(a){this._gain=a},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});f.prototype.update=function(a){this._value=void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};return f}();r.ExponentialFalloff=B})},"esri/views/3d/input/handlers/pinch/PinchNavigationBase":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../input/InputHandler ../../../lib/glMatrix ../../../webgl-engine/lib/Camera".split(" "),
function(B,r,f,a,b,c){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function p(h,l){var f=a.call(this,"esri.views.3d.input.handlers.PinchTest",!0)||this;f.view=h;f._helper=l;f._lastEndTimestamp=0;f._dragNavigationActive=!1;f._beginCamera=new c;f._tmpvec2d=b.vec2.create();f.registerIncoming("drag",function(a){return f._handleDrag(a)});f.registerIncoming("pointer-down",function(a){return f.stopMomentumNavigation()});f.registerIncoming("two-finger-drag-vertical",function(a){return f.stopMomentumNavigation()});
return f}f(p,a);p.prototype.stopMomentumNavigation=function(){this.momentum&&this.momentum.stop()};p.prototype.destroy=function(){this.momentum&&this.momentum.destroy()};p.prototype.applyNavigationConstraints=function(){var a=this.view.navigation;a.fixTargetUpVector();a.constrainTargetEyeByElevationAndMoveLookAt();a.targetAndCurrentChanged()};Object.defineProperty(p.prototype,"beginCamera",{get:function(){return this._beginCamera},enumerable:!0,configurable:!0});p.prototype.computePlanePoints=function(a,
c,f,p,t){t.length=a.data.pointers.length;for(var h=this._tmpvec2d,l=0;l<t.length;l++){var q=a.data.pointers[l];h[0]=q[c].x;h[1]=this.view.height-q[c].y;void 0===t[l]&&(t[l]=b.vec3d.create());this._helper.planar.intersectPlaneFromScreenPoint(f,p,h,t[l])}return t};p.prototype._handleDrag=function(a){if(1!==a.data.pointers.length||"mouse"!==a.data.pointers[0].currentEvent.native.pointerType){var b=a.timestamp-this._lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":if(b)break;
this._navigationBegin(a);break;case "update":if(b)break;this._dragNavigationActive?this._navigationUpdate(a):this._navigationBegin(a);break;case "end":this._dragNavigationActive&&(this._lastEndTimestamp=a.timestamp,this._navigationEnd(a))}a.stopPropagation()}};p.prototype._navigationBegin=function(a){var b=this.view.navigation;this.stopMomentumNavigation();this._dragNavigationActive=!0;this.beginCamera.copyFrom(b.currentCamera);b.begin(this);this.onNavigationBegin(a)};p.prototype._navigationUpdate=
function(a){if(!(.002>(a.data.currentState.timestamp-a.data.previousState.timestamp)/1E3)){var b=this.view.navigation.targetCamera;b.eye=this.beginCamera.eye;b.center=this.beginCamera.center;b.up=this.beginCamera.up;this.onNavigationUpdate(a,b);this.applyNavigationConstraints()}};p.prototype._navigationEnd=function(a){this.onNavigationEnd(a);this._dragNavigationActive=!1;this.momentum&&this.momentum.initiate();this.view.navigation.end(this)};return p}(a.InputHandler);r.PinchNavigationBase=B})},"esri/views/3d/webgl-engine/lib/Camera":function(){define(["require",
"exports","./Util","./gl-matrix"],function(B,r,f,a){function b(a,b){var c=b[0]-a[0],h=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return c*c+h*h+f*f+a*a}function c(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function t(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}var p=a.vec3d,h=a.vec4d,l=a.mat4d;B=function(){function a(a,b,c){this._viewUp=p.create();this._viewForward=p.create();this._viewRight=p.create();this._viewport=h.create();this._padding=h.create();this._fov=55/180*Math.PI;this._near=
0;this._far=1E3;this._viewDirty=!0;this._viewMatrix=l.create();this._projectionDirty=!0;this._projectionMatrix=l.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=l.create();this._frustumPlanesDirty=!0;this._frustumPlanes=[h.create(),h.create(),h.create(),h.create(),h.create(),h.create()];this._fullViewport=null;this.aboveGround=!0;this._eye=p.create(a);this._center=p.create(b);this._up=void 0!==c?p.create(c):p.create([0,0,1]);this._padding=h.create()}Object.defineProperty(a.prototype,
"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewMatrix",{get:function(){this._ensureViewClean();
return this._viewMatrix},set:function(a){l.set(a,this._viewMatrix);this._viewDirty=!1;this._frustumPlanesDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this._viewport[1]},
set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){a-=this._padding[1]+this._padding[3];this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._viewport[3]},
set:function(a){a-=this._padding[0]+this._padding[2];this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=h.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"padding",{get:function(){return this._padding},
set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),h.set(a,this._padding),this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=
this.width,b=this.height,c=this.near*Math.tan(this.fovY/2),h=c*this.aspect;l.frustum(-h*(1+2*this._padding[3]/a),h*(1+2*this._padding[1]/a),-c*(1+2*this._padding[2]/b),c*(1+2*this._padding[0]/b),this.near,this.far,this._projectionMatrix);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){l.set(a,this._projectionMatrix);this._projectionDirty=!1;this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fov",{get:function(){return this._fov},
set:function(a){this._fov=a;this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fovX",{get:function(){return f.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=f.fovx2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fovY",{get:function(){return f.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=
f.fovy2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"distance",{get:function(){return p.dist(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"frustumPlanes",{get:function(){this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),
this._frustumPlanesDirty=!1);return this._frustumPlanes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=l.create()),l.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),l.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0});a.prototype.copyFrom=function(a){p.set(a._eye,this._eye);p.set(a._center,this._center);p.set(a._up,this._up);h.set(a._viewport,this._viewport);h.set(a._padding,this._padding);this._near=a._near;this._far=a._far;this._fov=a._fov;this.aboveGround=a.aboveGround;a._viewDirty?this._viewDirty=!0:(l.set(a._viewMatrix,this._viewMatrix),p.set(a._viewRight,
this._viewRight),p.set(a._viewUp,this._viewUp),p.set(a._viewForward,this._viewForward),this._viewDirty=!1);a._projectionDirty?this._projectionDirty=!0:(l.set(a._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1);a._frustumPlanesDirty?this._frustumPlanesDirty=!0:(a.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?l.set(a._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):
this._viewInverseTransposeMatrix=l.create(a._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?h.set(a._fullViewport,this._fullViewport):this._fullViewport=h.create(a._fullViewport):this._fullViewport=null;return this};a.prototype.copy=function(){var b=new a;b.copyFrom(this);return b};a.prototype.equals=function(a){return c(this._eye,a._eye)&&c(this._center,a._center)&&c(this._up,a._up)&&t(this._viewport,a._viewport)&&t(this._padding,a._padding)&&
this._near===a._near&&this._far===a._far&&this._fov===a._fov};a.prototype.almostEquals=function(a,c){c=p.dist(this._eye,this._center)*(c||5E-4);c*=c;return p.dist2(a._eye,this._eye)<c&&p.dist2(a._center,this._center)<c&&.001>Math.abs(a._fov-this._fov)&&.5>b(a._padding,this._padding)&&.5>b(a._viewport,this._viewport)};a.prototype.markViewDirty=function(){this._frustumPlanesDirty=this._viewDirty=!0};a.prototype.computePixelSizeAt=function(a){return 2*p.dist(a,this._eye)*Math.tan(this.fovX/2)/this.width};
a.prototype.computePixelSizeAtDist=function(a){return 2*a*Math.tan(this.fovX/2)/this.width};a.prototype.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};a.prototype.copyFrustumPlanes=function(a){if(!a){a=Array(6);for(var b=0;6>b;++b)a[b]=h.create()}for(var c=this.frustumPlanes,b=0;6>b;b++)h.set(c[b],a[b]);return a};a.prototype.computeFrustumPoints=function(a){if(!a){a=Array(8);for(var b=0;8>b;++b)a[b]=p.create()}f.matrix2frustum(this.viewMatrix,
this.projectionMatrix,a);return a};a.prototype.setGLViewport=function(a){var b=this.viewport,c=this.padding;a.setViewport(b[0]-c[3],b[1]-c[2],b[2]+c[1]+c[3],b[3]+c[0]+c[2])};a.prototype.applyProjection=function(a,b,c){void 0===c&&(c=!1);a!==q&&p.set(a,q);q[3]=1;c&&(b[2]=-q[2]);l.multiplyVec4(this.projectionMatrix,q);p.scale(q,1/Math.abs(q[3]));a=this.fullViewport;b[0]=f.lerp(0,a[0]+a[2],.5+.5*q[0]);b[1]=f.lerp(0,a[1]+a[3],.5+.5*q[1]);c||(b[2]=.5*(q[2]+1));return b};a.prototype.projectPoint=function(a,
b,c){void 0===c&&(c=!1);l.multiplyVec3(this.viewMatrix,a,q);return this.applyProjection(q,b,c)};a.prototype.unprojectPoint=function(a,b,c){void 0===c&&(c=!1);if(c)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;l.multiply(this.projectionMatrix,this.viewMatrix,y);if(!l.inverse(y))return null;c=this.fullViewport;q[0]=2*(a[0]-c[0])/c[2]-1;q[1]=2*(a[1]-c[1])/c[3]-1;q[2]=2*a[2]-1;q[3]=1;l.multiplyVec4(y,q);if(0===q[3])return null;b[0]=q[0]/q[3];b[1]=q[1]/q[3];b[2]=
q[2]/q[3];return b};a.prototype.computeUpOnSphere=function(){p.subtract(this.center,this.eye,z);var a=p.length(this.center);1>a?p.set3(0,0,1,this.up):Math.abs(p.dot(z,this.center))>.9999*p.length(z)*a||(p.cross(z,this.center,this.up),p.cross(this.up,z,this.up),p.normalize(this.up))};a.prototype._compareAndSetView=function(a,b){c(a,b)||(p.set(a,b),this._frustumPlanesDirty=this._viewDirty=!0)};a.prototype._computeFrustumPlanes=function(a){if(!a){a=Array(6);for(var b=0;6>b;++b)a[b]=h.create()}f.matrix2frustumPlanes(this.viewMatrix,
this.projectionMatrix,a);return a};a.prototype._ensureViewClean=function(){this._viewDirty&&(l.lookAt(this._eye,this._center,this._up,this._viewMatrix),p.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),p.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),p.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return a}();var q=h.create(),y=l.create(),
z=p.create();return B})},"esri/views/3d/input/handlers/pinch/MomentumNavigationGlobal":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ./MomentumNavigationBase ./PinchNavigationGlobal".split(" "),function(B,r,f,a,b,c){Object.defineProperty(r,"__esModule",{value:!0});var t=a.vec3d.create();B=function(b){function h(c,h){c=b.call(this,c,h)||this;c._panAxisOrDirection=a.vec3d.create();c._centerOnScreen=a.vec2.create();c._centerOnSphere=a.vec3d.create();
c._tmpSphereCenter=a.vec3d.create();c._tmpScaleAxis=a.vec3d.create();c._verticalPlane={distance:0,normal:a.vec3d.create()};c._verticalCenter=a.vec3d.create();return c}f(h,b);h.prototype.setParameters=function(b,c,h,f){this._radius=b;a.vec2.set(c,this._centerOnScreen);a.vec3d.set(h,this._centerOnSphere);this._mode=f};h.prototype.addPanValue=function(b,c,h,f){this.pan.estimator.add(c[0],c[1],h,.001*b);a.vec3d.set(f,this._panAxisOrDirection)};h.prototype.addRotationValue=function(a,b){this.rotation.estimator.add(b,
.001*a)};h.prototype.addScaleValue=function(a,b){this.zoom.estimator.add(b,.001*a)};h.prototype.setVerticalParameters=function(b,c){a.vec3d.set(c,this._verticalCenter);a.vec3d.set(b.normal,this._verticalPlane.normal);this._verticalPlane.distance=b.distance};h.prototype.onUpdate=function(b,h,f){var l=this._radius,q=this._centerOnScreen,p=this._centerOnSphere;if(this.zoom.momentum){var y=this.zoom.momentum.valueDelta(b,h);this._mode===c.PanMode.Horizontal?(this.helper.spherical.applyZoom(l,this.view,
f,y),this.helper.spherical.makeRenderCoordSpherePoint(l,f,q,this._tmpSphereCenter),l=this.helper.spherical.rotationFromPoints(l,p,this._tmpSphereCenter,this._tmpScaleAxis),this.helper.applyRotation(f,t,this._tmpScaleAxis,l)):this.helper.planar.applyZoom(this._verticalPlane,this.view,f,this._verticalCenter,y)}this.pan.momentum&&(this._mode===c.PanMode.Horizontal?(l=this.helper.spherical.rotationFromPoints(this._radius,this.pan.momentum.dataOldest,this.pan.momentum.dataNewest,this._panAxisOrDirection),
l/=this.pan.momentum.dataTimeDelta,l*=this.pan.momentum.velocityFactor(b),this.helper.applyRotation(f,t,this._panAxisOrDirection,l*h)):(l=a.vec3d.dist(this.pan.momentum.dataOldest,this.pan.momentum.dataNewest),l/=this.pan.momentum.dataTimeDelta,l*=this.pan.momentum.velocityFactor(b),a.vec3d.normalize(this._panAxisOrDirection),a.vec3d.scale(this._panAxisOrDirection,l*h),a.vec3d.subtract(f.eye,this._panAxisOrDirection),a.vec3d.subtract(f.center,this._panAxisOrDirection),f.markViewDirty()));this.rotation.momentum&&
(b=this.rotation.momentum.valueDelta(b,h),this.helper.applyRotation(f,t,p,b))};return h}(b.MomentumNavigationBase);r.MomentumNavigationGlobal=B})},"esri/views/3d/input/handlers/pinch/MomentumNavigationBase":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../../navigation/Momentum"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function b(b,f){this.pinchNavigation=b;this._helper=f;this.zoom={momentum:null,estimator:new a.ZoomMomentumEstimator(.05),
enabled:!0};this.rotation={momentum:null,estimator:new a.RotationMomentumEstimator(.05,3,.05,.95),enabled:!0};this.pan={momentum:null,estimator:new a.ScreenspaceMomentumEstimator(.05,600,6,.82),enabled:!0};this._elapsedTime=0;this._active=!1}b.prototype.destroy=function(){this.stop()};Object.defineProperty(b.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0});b.prototype.doFrameUpdate=function(a){this._onUpdate(.001*a)};b.prototype.stop=function(){this.pan.estimator.reset();
this.rotation.estimator.reset();this.zoom.estimator.reset();this._active=!1};b.prototype.initiate=function(){this._active||(this._elapsedTime=0,this.pan.momentum=null,this.zoom.momentum=null,this.rotation.momentum=null,this.zoom.enabled&&(this.zoom.momentum=this.zoom.estimator.evaluateMomentum()),!this.zoom.momentum&&this.rotation.enabled&&(this.rotation.momentum=this.rotation.estimator.evaluateMomentum()),this.zoom.momentum||this.rotation.momentum||!this.pan.enabled||(this.pan.momentum=this.pan.estimator.evaluateMomentum()),
this._active=null!=(this.zoom.momentum||this.rotation.momentum||this.pan.momentum))};Object.defineProperty(b.prototype,"helper",{get:function(){return this._helper},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"view",{get:function(){return this.pinchNavigation.view},enumerable:!0,configurable:!0});b.prototype._onUpdate=function(a){this.active&&(this.zoom.momentum&&this.zoom.momentum.isFinished(this._elapsedTime)&&(this.zoom.momentum=null),this.rotation.momentum&&this.rotation.momentum.isFinished(this._elapsedTime)&&
(this.rotation.momentum=null),this.pan.momentum&&this.pan.momentum.isFinished(this._elapsedTime)&&(this.pan.momentum=null),this.zoom.momentum||this.rotation.momentum||this.pan.momentum?(this.view.navigation.targetCamera.copyFrom(this.view.navigation.currentCamera),this.onUpdate(this._elapsedTime,a,this.view.navigation.targetCamera),this.pinchNavigation.applyNavigationConstraints(),this._elapsedTime+=a):this.stop())};return b}();r.MomentumNavigationBase=B})},"esri/views/navigation/Momentum":function(){define(["require",
"exports","../../core/tsSupport/extendsHelper","./ValueHistory","../3d/lib/glMatrix"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function a(a,b,c){this._initialVelocity=a;this._stopVelocity=b;this._friction=c;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=
function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){a=Math.min(a,this.duration);var b=1-this._friction;return this._initialVelocity*(Math.pow(b,a)-1)/Math.log(b)};a.prototype.valueDelta=function(a,b){var c=this.value(a);return this.value(a+b)-c};return a}();r.Momentum=c;B=function(){function b(b,c,h,f){void 0===b&&(b=.05);this._minimumInitialVelocity=c;this._stopVelocity=
h;this._friction=f;this._history=new a.ValueHistory(1E3*b)}b.prototype.add=function(a,b){void 0!==b&&(b*=1E3);this._history.add(a,b)};b.prototype.reset=function(){this._history.reset()};Object.defineProperty(b.prototype,"stopVelocity",{get:function(){return this._stopVelocity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});b.prototype.evaluateMomentum=function(){var a=this._evaluateVelocity();return null!==
a?new c(a,this._stopVelocity,this._friction):null};b.prototype._evaluateVelocity=function(){var a=this._history,b=a.oldest,a=a.newest;if(b&&a){var c=(a.timeStamp-b.timeStamp)/1E3;if(0<c&&(b=(a.value-b.value)/c,Math.abs(b)>=this._minimumInitialVelocity))return b}return null};return b}();r.MomentumEstimator=B;var t=function(a){function b(b,c,h){return a.call(this,b,c,h)||this}f(b,a);b.prototype.value=function(b){b=a.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,
c){var h=a.prototype.value.call(this,b);b=a.prototype.value.call(this,b+c);return Math.exp(b-h)};return b}(c);r.ZoomMomentum=t;var p=function(a){function b(b,c,h,f){void 0===b&&(b=.05);void 0===c&&(c=4);void 0===h&&(h=.01);void 0===f&&(f=.95);return a.call(this,b,c,h,f)||this}f(b,a);b.prototype.add=function(b,c){a.prototype.add.call(this,Math.log(b),c)};b.prototype.evaluateMomentum=function(){var a=this._evaluateVelocity();return null!==a?new t(a,this.stopVelocity,this.friction):null};return b}(B);
r.ZoomMomentumEstimator=p;B=function(a){function b(b,c,h,f){void 0===b&&(b=.05);void 0===c&&(c=4);void 0===h&&(h=.01);void 0===f&&(f=.95);return a.call(this,b,c,h,f)||this}f(b,a);b.prototype.add=function(b,c){var h=this._history.newest;if(h){h=h.value;for(b-=h;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=h+b}a.prototype.add.call(this,b,c)};return b}(B);r.RotationMomentumEstimator=B;var h=function(a){function b(b,c,h,f,l,q){b=a.call(this,b,c,h)||this;b.dataOldest=f;b.dataNewest=l;b.dataTimeDelta=
q;return b}f(b,a);b.prototype.velocityFactor=function(a){a=Math.min(a,this.duration);return Math.pow(1-this.friction,a)};b.prototype.valueFromInitialVelocity=function(a,b){b=Math.min(b,this.duration);var c=1-this.friction;return a*(Math.pow(c,b)-1)/Math.log(c)};return b}(c);r.ScreenspaceMomentum=h;B=function(){function c(b,c,h,f){void 0===b&&(b=.05);this._minimumInitialVelocity=c;this._stopVelocity=h;this._friction=f;this._entryPool=[];this._history=new a.ValueHistory(1E3*b)}c.prototype.add=function(a,
c,h,f){void 0!==f&&(f*=1E3);var l;0!==this._entryPool.length?(l=this._entryPool.pop(),l.x=a,l.y=c,b.vec3d.set(h,l.data)):l={x:a,y:c,data:b.vec3d.create(h)};this._history.add(l,f)};c.prototype.reset=function(){for(var a=0,b=this._history.values;a<b.length;a++)this._entryPool.push(b[a].value);this._history.reset()};Object.defineProperty(c.prototype,"stopVelocity",{get:function(){return this._stopVelocity},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"friction",{get:function(){return this._friction},
enumerable:!0,configurable:!0});c.prototype.evaluateMomentum=function(){var a=this._evaluateVelocity(),b=this._history.oldest,c=this._history.newest;return null!==a?new h(a,this._stopVelocity,this._friction,b.value.data,c.value.data,.001*(c.timeStamp-b.timeStamp)):null};c.prototype._evaluateVelocity=function(){var a=this._history,b=a.oldest,c=a.newest;if(b&&c&&(a=.001*(c.timeStamp-b.timeStamp),0<a)){var h=c.value.x-b.value.x,b=c.value.y-b.value.y,b=Math.sqrt(h*h+b*b)/a;if(Math.abs(b)>=this._minimumInitialVelocity)return b}return null};
return c}();r.ScreenspaceMomentumEstimator=B})},"esri/views/navigation/ValueHistory":function(){define(["require","exports","../../core/now"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function a(a){this._maximumAge=a;this._values=[]}Object.defineProperty(a.prototype,"values",{get:function(){return this._values},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._values=[]};a.prototype.add=function(a,c){c=void 0!==c?c:f();this._values.push({value:a,
timeStamp:c});this._cleanup(c)};Object.defineProperty(a.prototype,"newest",{get:function(){var a=this._values.length;if(0<a)return this._values[a-1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"oldest",{get:function(){if(0<this._values.length)return this._values[0]},enumerable:!0,configurable:!0});a.prototype._cleanup=function(a){for(;0<this._values.length;)if(this._values[0].timeStamp+this._maximumAge<a)this._values.shift();else break};return a}();r.ValueHistory=B})},"esri/views/3d/input/handlers/pinch/PinchNavigationLocal":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../util ./PinchNavigationBase ./MomentumNavigationLocal".split(" "),
function(B,r,f,a,b,c,t){Object.defineProperty(r,"__esModule",{value:!0});var p;(function(a){a[a.Horizontal=0]="Horizontal";a[a.Vertical=1]="Vertical"})(p=r.PanMode||(r.PanMode={}));var h=20/180*Math.PI,l=a.vec3d.createFrom(0,0,1);B=function(c){function q(h,f){var l=c.call(this,h,f)||this;l.view=h;l._rotation={valueSmooth:new b.ExponentialFalloff(.05)};l._scaling={valueSmooth:new b.ExponentialFalloff(.05)};l._planeHorizontal={normal:a.vec3d.create(),distance:0};l._planeVertical={normal:a.vec3d.create(),
distance:0};l._beginCenterHorizontal=a.vec3d.create();l._beginCenterVertical=a.vec3d.create();l._tmpPoints=[];l._tmpPickPointScreen=a.vec2.create();l._tmpPickPointScene=a.vec3d.create();l._tmpBwd=a.vec3d.create();l._tmpUp=a.vec3d.create();l._tmpD=a.vec3d.create();l._tmpC3=a.vec3d.create();l._tmpC2=a.vec2.create();l._momentumNavigation=new t.MomentumNavigationLocal(l,f);return l}f(q,c);Object.defineProperty(q.prototype,"momentum",{get:function(){return this._momentumNavigation},enumerable:!0,configurable:!0});
q.prototype.onNavigationBegin=function(b){var c=this._helper,f=this._tmpPickPointScreen,q=this._tmpPickPointScene;this._rotation.valueSmooth.reset();this._scaling.valueSmooth.reset();a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,f);this._planeHorizontal.distance=0;a.vec3d.set(l,this._planeHorizontal.normal);c.picker.pickPointInScreen(f,q)||c.picker.pickFreePointInScreen(f,q);f=this._tmpBwd;a.vec3d.negate(this.beginCamera.viewForward,f);var t=this._tmpUp;a.vec3d.set(l,
t);var y=a.vec3d.dot(f,t);this._mode=Math.asin(0>y?-y:y)>=h?p.Horizontal:p.Vertical;this._planeHorizontal.distance=a.vec3d.dot(this._planeHorizontal.normal,q);0>a.vec3d.dot(this._planeHorizontal.normal,this.beginCamera.eye)-this._planeHorizontal.distance&&(a.vec3d.negate(this._planeHorizontal.normal),this._planeHorizontal.distance*=-1);this._mode===p.Vertical&&(a.vec3d.scale(t,y),a.vec3d.subtract(f,t,this._planeVertical.normal),a.vec3d.normalize(this._planeVertical.normal),this._planeVertical.distance=
a.vec3d.dot(this._planeVertical.normal,q),this.computePlanePoints(b,"currentEvent",this._planeVertical,this.beginCamera,this._tmpPoints),c.planar.computePointCenter(this._tmpPoints,this._beginCenterVertical));this.computePlanePoints(b,"currentEvent",this._planeHorizontal,this.beginCamera,this._tmpPoints);c.planar.computePointCenter(this._tmpPoints,this._beginCenterHorizontal)};q.prototype.onNavigationUpdate=function(b,c){var h=this._helper,f=1<b.data.pointers.length,l=this._mode===p.Horizontal?this._planeHorizontal:
this._planeVertical,q=this._mode===p.Horizontal?this._beginCenterHorizontal:this._beginCenterVertical;if(f){var n=b.data.startState.radius/b.data.currentState.radius,t=.001875*Math.min(Math.max(b.data.currentState.radius,40),120);this._scaling.valueSmooth.gain=t;this._scaling.valueSmooth.update(n);h.planar.applyZoom(l,this.view,c,q,this._scaling.valueSmooth.value);this.momentum.addScaleValue(b.timestamp,this._scaling.valueSmooth.value,l,q)}t=this._tmpC3;this.computePlanePoints(b,"currentEvent",l,
c,this._tmpPoints);h.planar.computePointCenter(this._tmpPoints,t);l=this._tmpD;a.vec3d.subtract(t,q,l);a.vec3d.subtract(c.eye,l);a.vec3d.subtract(c.center,l);c.markViewDirty();n=this._tmpC2;a.vec2.set2(b.data.currentState.center.x,b.data.currentState.center.y,n);this.momentum.addPanValue(b.timestamp,n,t,l);f&&(f=this._planeHorizontal.normal,a.vec3d.set(this._planeHorizontal.normal,f),t=b.data.currentState.angle,l=this._rotation.valueSmooth.value,n=h.normalizeRotationDelta(t-l),t=.00125*Math.min(Math.max(b.data.currentState.radius,
40),120),this._rotation.valueSmooth.gain=t,this._rotation.valueSmooth.update(l+n),t=this._rotation.valueSmooth.value,this.momentum.addRotationValue(b.timestamp,q,f,t),h.applyRotation(c,q,f,t))};q.prototype.onNavigationEnd=function(a){};return q}(c.PinchNavigationBase);r.PinchNavigationLocal=B})},"esri/views/3d/input/handlers/pinch/MomentumNavigationLocal":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../lib/glMatrix","./MomentumNavigationBase"],function(B,
r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(b){function c(c,h){c=b.call(this,c,h)||this;c._scaleState={plane:{distance:0,normal:a.vec3d.create()},center:a.vec3d.create()};c._rotationState={center:a.vec3d.create(),axis:a.vec3d.create()};c._panState={direction:a.vec3d.create()};c.pan.enabled=!1;return c}f(c,b);c.prototype.addPanValue=function(b,c,f,q){this.pan.estimator.add(c[0],c[1],f,.001*b);a.vec3d.set(q,this._panState.direction);a.vec3d.normalize(this._panState.direction)};
c.prototype.addRotationValue=function(b,c,f,q){this.rotation.estimator.add(q,.001*b);a.vec3d.set(c,this._rotationState.center);a.vec3d.set(f,this._rotationState.axis)};c.prototype.addScaleValue=function(b,c,f,q){this.zoom.estimator.add(c,.001*b);this._scaleState.plane.distance=f.distance;a.vec3d.set(f.normal,this._scaleState.plane.normal);a.vec3d.set(q,this._scaleState.center)};c.prototype.onUpdate=function(b,c,f){if(this.zoom.momentum){var h=this.zoom.momentum.valueDelta(b,c);this.helper.planar.applyZoom(this._scaleState.plane,
this.view,f,this._scaleState.center,h)}this.pan.momentum&&(a.vec3d.normalize(this._panState.direction),h=a.vec3d.dist(this.pan.momentum.dataOldest,this.pan.momentum.dataNewest),h/=this.pan.momentum.dataTimeDelta,h*=this.pan.momentum.velocityFactor(b),a.vec3d.scale(this._panState.direction,h*c),a.vec3d.subtract(f.eye,this._panState.direction),a.vec3d.subtract(f.center,this._panState.direction),f.markViewDirty());this.rotation.momentum&&(b=this.rotation.momentum.valueDelta(b,c),this.helper.applyRotation(f,
this._rotationState.center,this._rotationState.axis,b))};return c}(b.MomentumNavigationBase);r.MomentumNavigationLocal=B})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","../../../input/handlers/support"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function c(b,c){var h=a.call(this,"esri.views.3d.input.handlers.DoubleClickZoom",!0)||this;h.view=b;
h.registerIncoming("double-click",c,function(a){return h._handleDoubleClick(a)});return h}f(c,a);c.prototype._handleDoubleClick=function(a){var c=a.data;b.eventMatchesPointerType(c.native,"primary")&&(this.view.navigation.zoom.stepScreen(Math.log(.5)/Math.log(.6),[c.x,this.view.height-c.y]),a.stopPropagation())};return c}(a.InputHandler);r.DoubleClickZoom=B})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});
r.eventMatchesPointerType=function(f,a){switch(a){case "primary":return"touch"===f.pointerType||0===f.button;case "secondary":return"touch"!==f.pointerType&&2===f.button;case "tertiary":return"touch"!==f.pointerType&&1===f.button}}})},"esri/views/3d/input/handlers/DragPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","./support"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function c(b,c,f){var h=
a.call(this,"esri.views.3d.input.handlers.DragPan",!0)||this;h.view=b;h.pointerType=c;h.registerIncoming("drag",f,function(a){return h._handleDrag(a)});return h}f(c,a);c.prototype._handleDrag=function(a){var c=a.data;if(!(1<c.pointers.length)){var f=c.pointers[0];if(b.eventMatchesPointerType(f.startEvent.native,this.pointerType)){var f=[f.currentEvent.x,this.view.height-f.currentEvent.y],q=this.view.navigation.pan;switch(c.action){case "start":q.begin(f,a.timestamp);break;case "update":q.update(f,
a.timestamp);break;case "end":q.end(f,a.timestamp)}a.stopPropagation()}}};return c}(a.InputHandler);r.DragPan=B})},"esri/views/3d/input/handlers/support":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.eventMatchesPointerType=function(f,a){switch(a){case "primary":return"touch"===f.pointerType||0===f.button;case "secondary":return"touch"!==f.pointerType&&2===f.button;case "tertiary":return"touch"!==f.pointerType&&1===f.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/InputHandler ./support ../../navigation/NavigationConstants".split(" "),
function(B,r,f,a,b,c){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function p(b,f,q,p){var h=a.call(this,"esri.views.3d.input.handlers.DragRotate",!0)||this;h.view=b;h.pointerType=f;h.pivotPoint=q;h.registerIncoming("drag",p,function(a){return h._handleDrag(a)});switch(q){case "center":h._navigationPivot=c.Rotate.PivotPoint.POI;break;case "eye":h._navigationPivot=c.Rotate.PivotPoint.EYE}return h}f(p,a);p.prototype._handleDrag=function(a){var c=a.data;if(!(1<c.pointers.length)){var h=
c.pointers[0];if(b.eventMatchesPointerType(h.startEvent.native,this.pointerType)){var h=[h.currentEvent.x,this.view.height-h.currentEvent.y],f=this.view.navigation.rotate;switch(c.action){case "start":f.begin(h,this._navigationPivot);break;case "update":f.update(h,this._navigationPivot);break;case "end":f.end(h)}a.stopPropagation()}}};return p}(a.InputHandler);r.DragRotate=B})},"esri/views/3d/navigation/NavigationConstants":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,
"__esModule",{value:!0});r.Pan={Direction:{LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32},Mode:{HORIZONTAL:0,VERTICAL:1},Momentum:{DURATION_SHORT:1,DURATION_LONG:3,DURATION_LONG_VEL:8,INPUT_FILTER:.2,BUFFER_SIZE:5,MINIMUM_VELOCITY:300},Vertical:{ELEVATION_THRESHOLD:3E4,ANGLE_THRESHOLD:8/180*Math.PI}};r.Rotate={PivotPoint:{POI:1,EYE:2}}})},"esri/views/3d/input/handlers/DragZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","./support"],
function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function c(b,c,f){var h=a.call(this,"esri.views.3d.input.handlers.DragZoom"+c,!0)||this;h.view=b;h.pointerType=c;h.registerIncoming("drag",f,function(a){return h._handleDrag(a)});return h}f(c,a);c.prototype._handleDrag=function(a){var c=a.data;if(!(1<c.pointers.length)){var f=c.pointers[0];if(b.eventMatchesPointerType(f.startEvent.native,this.pointerType)){var f=[f.currentEvent.x,this.view.height-f.currentEvent.y],
q=this.view.navigation.zoom;switch(c.action){case "start":q.begin(f);break;case "update":q.update(f);break;case "end":q.end(f)}a.stopPropagation()}}};return c}(a.InputHandler);r.DragZoom=B})},"esri/views/3d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","../../navigation/NavigationConstants"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});var c=b.Pan.Direction;B=function(a){function b(b,f,
q){var h=a.call(this,"esri.views.3d.input.handlers.KeyPan",!0)||this;h.view=b;h.keys=f;h._keyToDirection=(l={},l[f.left]=c.LEFT,l[f.right]=c.RIGHT,l[f.forward]=c.FORWARD,l[f.backward]=c.BACKWARD,l[f.up]=c.UP,l[f.down]=c.DOWN,l);h.registerIncoming("key-down",q,function(a){return h._handleKeyDown(a)});h.registerIncoming("key-up",q,function(a){return h._handleKeyUp(a)});return h;var l}f(b,a);b.prototype._handleKeyDown=function(a){a.data.repeat||this._handleKey(a,!0)};b.prototype._handleKeyUp=function(a){this._handleKey(a,
!1)};b.prototype._handleKey=function(a,b){var c=this._keyToDirection[a.data.key];null!=c&&(b?this.view.navigation.pan.beginContinuous(c):this.view.navigation.pan.endContinuous(c),a.stopPropagation())};return b}(a.InputHandler);r.KeyPan=B})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function b(b,c){var h=
a.call(this,"esri.views.3d.input.handlers.MouseWheelZoom",!0)||this;h.view=b;h.registerIncoming("mouse-wheel",c,function(a){return h._handleMouseWheel(a)});return h}f(b,a);b.prototype._handleMouseWheel=function(a){var b=a.data;this.view.navigation.zoom.stepScreen(-1/60*b.deltaY,[b.x,this.view.height-b.y]);a.stopPropagation()};return b}(a.InputHandler);r.MouseWheelZoom=B})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function b(b,c,h){h=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",c,h)||this;h.view=b;h.key=c;return h}f(b,a);b.prototype.activate=function(){this.view.goTo({heading:0})};return b}(a.SingleKey);r.SingleKeyResetHeading=B})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(B,
r,f,a){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function b(b,c,h){var f=a.call(this,b,!0)||this;f.key=c;f.registerIncoming("key-down",h,function(a){return f._handleKeyDown(a)});return f}f(b,a);b.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return b}(a.InputHandler);r.SingleKey=B})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function b(b,c,h){h=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",c,h)||this;h.view=b;h.key=c;return h}f(b,a);b.prototype.activate=function(){this.view.goTo({tilt:0})};return b}(a.SingleKey);r.SingleKeyResetTilt=B})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(B,r,f,a){Object.defineProperty(r,
"__esModule",{value:!0});B=function(a){function b(b,c){var h=a.call(this,"esri.views.3d.input.handlers.PointerDownCancelAnimation",!0)||this;h.view=b;h.registerIncoming("pointer-down",c,function(a){return h._handlePointerDown(a)});return h}f(b,a);b.prototype._handlePointerDown=function(a){this.view.navigation.stop()};return b}(a.InputHandler);r.PointerDownCancelAnimation=B})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"../../../input/InputHandler","../../navigation/NavigationConstants"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function c(b,c){void 0===c&&(c=!1);var h=a.call(this,"esri.views.3d.input.handlers.TwoFingerTilt",!0)||this;h.view=b;h._invert=c;h.registerIncoming("vertical-two-finger-drag",function(a){return h._handleTwoFinger(a)});return h}f(c,a);c.prototype._handleTwoFinger=function(a){var c=this.view,f=[0,-a.data.delta*(this._invert?-1:1)];switch(a.data.action){case "begin":c.navigation.rotate.begin(f,
b.Rotate.PivotPoint.POI);break;case "update":c.navigation.rotate.update(f,b.Rotate.PivotPoint.POI);break;case "end":c.navigation.rotate.end(f)}};return c}(a.InputHandler);r.TwoFingerTilt=B})},"esri/views/3d/input/NavigationHelper":function(){define("require exports ../lib/glMatrix ../support/earthUtils ../webgl-engine/lib/Util ../support/mathUtils".split(" "),function(B,r,f,a,b,c){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function b(b){this.picker=b;this.earthUtils=a;this._axisTmp1=
f.vec3d.create();this._axisTmp2=f.vec3d.create();this._axisTmp3=f.vec3d.create();this._tmpTransform2=f.mat4d.create();this.spherical=new p(this);this.planar=new t(this)}b.prototype.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};b.prototype.rotationFromPointsAroundAxis=function(a,b,c){var h=this._axisTmp1,l=this._axisTmp2,q=this._axisTmp3;f.vec3d.set(a,l);f.vec3d.set(b,q);a=f.vec3d.dot(l,c);b=f.vec3d.dot(q,c);f.vec3d.scale(c,a,h);f.vec3d.subtract(l,
h);f.vec3d.normalize(l);f.vec3d.scale(c,b,h);f.vec3d.subtract(q,h);f.vec3d.normalize(q);a=f.vec3d.dot(l,q);f.vec3d.cross(c,l,h);c=f.vec3d.dot(q,h);return Math.atan2(c,a)};b.prototype.applyRotation=function(a,b,c,h){var l=this._tmpTransform2;f.mat4d.identity(l);f.mat4d.rotate(l,h,c);f.vec3d.subtract(a.eye,b);f.mat4d.multiplyVec3(l,a.eye,a.eye);f.vec3d.add(a.eye,b);f.vec3d.subtract(a.center,b);f.mat4d.multiplyVec3(l,a.center,a.center);f.vec3d.add(a.center,b);f.mat4d.multiplyVec3(l,a.up,a.up);a.markViewDirty()};
return b}();r.NavigationHelper=B;var t=function(){function a(a){this._helper=a;this._tmpForward=f.vec3d.create();this._tmpP0=f.vec3d.create();this._tmpP1=f.vec3d.create()}a.prototype.applyZoom=function(a,b,c,h,p){a=this._tmpForward;p=1-p;f.vec3d.subtract(h,c.eye,a);var l=f.vec3d.length(a),q=l*(1-p);0<=p&&4>q&&(q=4);q=b.navigation.limitAltitude(q,h,a);1E-6>Math.abs(l-q)||(p=-(q-l)/l,f.vec3d.scale(a,p),f.vec3d.add(c.eye,a),f.vec3d.lerp(c.center,h,p),b.navigation.fixTargetUpVector(),c.markViewDirty())};
a.prototype.intersectPlaneFromScreenPoint=function(a,b,c,h){var l=this._tmpP0,q=this._tmpP1;this._helper.picker.createPickRay(c,null,b.viewMatrix,l,q);f.vec3d.subtract(q,l);b=f.vec3d.dot(a.normal,q);if(0===b)return!1;a=f.vec3d.dot(a.normal,l)-a.distance;f.vec3d.add(l,f.vec3d.scale(q,-a/b,h),h);return!0};a.prototype.computePointCenter=function(a,b){f.vec3d.set3(0,0,0,b);for(var c=0;c<a.length;c++)f.vec3d.add(b,a[c]);f.vec3d.scale(b,1/a.length)};return a}(),p=function(){function a(a){this._helper=a;
this._tmpForward=f.vec3d.create();this._tmpP0=f.vec3d.create();this._tmpP1=f.vec3d.create();this._tmpAxis=f.vec3d.create();this._tmpTransform=f.mat4d.create()}a.prototype.applyZoom=function(a,b,c,h){var l=this._tmpForward;f.vec3d.subtract(c.center,c.eye,l);a/=f.vec3d.length(c.center);var q=1-a,p=f.vec3d.length(l),t;t=b.navigation.limitAltitude(p*h,c.center,l);h=t/p;1E-6>Math.abs(p-t)||(f.vec3d.scale(c.center,a+q*h),f.vec3d.scale(l,h),f.vec3d.subtract(c.center,l,c.eye),c.markViewDirty(),b.navigation.applyConstraints(c))};
a.prototype.makeRenderCoordSpherePoint=function(a,b,c,h){this._helper.picker.createPickRay(c,null,b.viewMatrix,this._tmpP0,this._tmpP1);f.vec3d.subtract(this._tmpP1,b.eye);this.intersect(a,b.eye,this._tmpP1,h)||this.closestPointOnSilhouette(a,b.eye,this._tmpP0,h)};a.prototype.intersect=function(a,c,h,f){return b.raySphere(c,h,null,a,f)};a.prototype.closestPointOnSilhouette=function(a,b,h,p){var l=this._tmpAxis,q=this._tmpTransform;f.vec3d.cross(b,h,l);f.vec3d.cross(l,b,p);f.vec3d.scale(p,1/f.vec3d.length(p)*
a);a=-c.asin(a/f.vec3d.length(b));f.mat4d.identity(q);f.mat4d.rotate(q,a,l);f.mat4d.multiplyVec3(q,p)};a.prototype.rotationFromPoints=function(a,b,c,h){f.vec3d.cross(b,c,h);return-Math.acos(1-f.vec3d.dist2(b,c)/(2*a*a))};a.prototype.computePointCenter=function(a,b,c){f.vec3d.set3(0,0,0,c);for(var h=0;h<a.length;h++)f.vec3d.add(c,a[h]);f.vec3d.normalize(c);f.vec3d.scale(c,b)};return a}()})},"esri/views/3d/support/cameraUtils":function(){define("dojo/_base/lang ../../../geometry/SpatialReference ../../../config ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../../Camera ../lib/glMatrix ./mathUtils ./earthUtils ./projectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y){function z(a,b){return"global"===a.viewingMode?y[b]:q[b]}function w(b,h,f){var n=b.renderSpatialReference,q=A.set(h.viewForward,K),q=G(b,h.eye,q,h.up,J);b=b.spatialReference||r.WGS84;l.vectorToVector(h.eye,n,x,b)||(b=r.WGS84,l.vectorToVector(h.eye,n,x,b));return f?(f.position.x=x[0],f.position.y=x[1],f.position.z=x[2],f.position.spatialReference=b,f.heading=q.heading,f.tilt=q.tilt,f.fov=p.rad2deg(h.fov),f):new c(new a(x,b),q.heading,q.tilt,p.rad2deg(h.fov))}function u(a,
b,c){var h=a.navigation.currentCamera,l=h.fovX,h=h.width/2;"global"===a.viewingMode&&null!=c&&(b*=Math.cos(p.deg2rad(c)));b/=a.renderCoordsHelper.unitInMeters;return h/(39.37*f.screenDPI/b)/Math.tan(l/2)}function C(a,b,c){var h=a.navigation.currentCamera;b=39.37*f.screenDPI/(h.width/2/(b*Math.tan(h.fovX/2)));"global"===a.viewingMode&&(b/=Math.cos(p.deg2rad(c)));return b*=a.renderCoordsHelper.unitInMeters}function E(a,b,h,f,q,p){var u=a.renderSpatialReference;b=n(a,f.heading,f.tilt,b,h,q);a=l.vectorToPoint(b.eye,
u,a.spatialReference||r.WGS84);if(!a)return null;if(!p)return new c(a,b.heading,b.tilt,f.fov);p.position=a;p.heading=b.heading;p.tilt=b.tilt;p.fov=f.fov;return p}function G(a,b,c,h,f){return z(a,"directionToHeadingTilt")(b,c,h,f)}function n(b,c,h,f,q,p){var u=A.create(),k=b.renderSpatialReference;if(f&&f instanceof a){var t=f;l.pointToVector(t,u,b.renderSpatialReference);null==t.z&&("global"===b.viewingMode?b._pickRay([0,0,0],u):b._pickRay([u[0],u[1]-1,u[2]],u),null!=b.basemapTerrain&&(t=b.basemapTerrain.getElevation(t),
null!=t&&b.renderCoordsHelper.setAltitude(t,u)))}else f?A.set(f,u):A.set(b.navigation.currentCamera.center,u);f&&f instanceof a||(f=l.vectorToPoint(u,k,b.spatialReference||r.WGS84));q=Math.max(q,b.navigation.minPoiDist);k=h;h=q;if(!(t=p&&p.noReset))var w=f,t=b.engineToScreen(b.navigation.currentCamera.center),e=b.toScreen(w),w=t.x-e.x,t=t.y-e.y,t=!(Math.sqrt(w*w+t*t)>5*Math.max(b.width,b.height));t?(k=z(b,"eyeTiltToLookAtTilt")(u,h,k),k=b.navigation.constraints.tilt.apply(k,h),k=z(b,"lookAtTiltToEyeTilt")(u,
h,k)):(c=0,k=b.navigation.constraints.tilt.min(h));h=k;c=z(b,"eyeForCenterWithHeadingTilt")(u,q,c,h);c.center=u;return p&&p.noReset||"global"!==b.viewingMode||(u=b.renderCoordsHelper.fromRenderCoords(c.eye,N,b.spatialReference)?b.basemapTerrain&&(b.basemapTerrain.getElevation(N)||0)>N.z-1:!1,!u)?c:(u=b.navigation.constraints.tilt.min(q),n(b,0,u,f,q,B.mixin({},p,{noReset:!0})))}var A=t.vec3d,x=A.create(),I=A.create(),K=A.create(),J={heading:0,tilt:0},N=new a,M=new p.Cyclical(-2.0037508342788905E7,
2.0037508342788905E7);return{externalToInternal:function(a,b){var c=a.renderSpatialReference,h=z(a,"headingTiltToDirectionUp"),f=A.create();return l.pointToVector(b.position,f,c)?(c=h(f,b.heading,b.tilt),A.add(c.direction,f),a=a.navigation.getCameraIntersectTerrain(f,c.direction,c.up),a.fov=p.deg2rad(b.fov),a):null},internalToExternal:w,scaleToDistance:u,distanceToScale:C,fromExtent:function(f,q,p,u,t){u instanceof c&&(t=u,u={});var w="global"===f.viewingMode,y=f.renderSpatialReference,k=f.spatialReference||
r.WGS84,x=r.WebMercator,C=q.spatialReference||x,e,d=0;null!=q.zmax&&null!=q.zmin&&(e=(q.zmax+q.zmin)/2,d=q.zmax-q.zmin);if(w){var w=new a(q.xmin,q.ymin,C),g=new a(q.xmax,q.ymax,C),w=b.project(w,x),g=b.project(g,x);if(null===w||null===g)return;q=new a(M.center(w.x,g.x),(g.y+w.y)/2,x);null!=e&&(q.z=e);e=h.getGreatCircleSpanAt(q,w,g);x=e.lon;C=e.lat;M.diff(w.x,g.x)>M.range/2&&(x+=h.halfEarthCircumference);x=Math.min(x,h.halfEarthCircumference);C=Math.min(C,h.halfEarthCircumference)}else b.canProject(q,
k)&&(q=b.project(q,k)),x=q.xmax-q.xmin,C=q.ymax-q.ymin,q=new a({x:q.xmin+.5*x,y:q.ymin+.5*C,z:e,spatialReference:k});e=f.navigation.currentCamera;p=n(f,p.heading,p.tilt,q,Math.max(1/Math.tan(e.fovX/2)*x*.5,1/Math.tan(e.fovY/2)*C*.5,1/Math.tan(e.fov/2)*d*.5)/1,u);y=l.vectorToPoint(p.eye,y,k);if(!y)return null;t||(t=new c);t.position=y;t.heading=p.heading;t.tilt=p.tilt;t.fov=f.camera.fov;return t},toExtent:function(a,b,c,f,n){var p;p=a.renderSpatialReference;b||(c||(c=a.navigation.currentCamera),b=
w(a,c,n));if(c)n=l.vectorToPoint(c.center,p,a.spatialReference||r.WGS84),p=c.distance;else{n=a.toMap(a.screenCenter);if(!n)return null;p=h.computeCarthesianDistance(b.position,n)}c||(c=a.navigation.currentCamera);b=2*p*Math.tan(c.fovX/2)*1;c=2*p*Math.tan(c.fovY/2)*1;return"global"===a.viewingMode?y.toExtent(a,n,b,c,f):q.toExtent(a,n,b,c,f)},fromCenterScale:function(a,b,c,h,f,l){c=u(a,c,b.latitude);return E(a,b,c,h,f,l)},fromCenterDistance:E,directionToHeadingTilt:G,eyeHeadingTiltForCenterPointAtDistance:n,
scaleToZoom:function(a,b){return(a=a.get("basemapTerrain.tilingScheme"))?a.levelAtScale(b):void 0},zoomToScale:function(a,b){return(a=a.get("basemapTerrain.tilingScheme"))?a.scaleAtLevel(b):void 0},computeScale:function(a,b,c){var h=a.renderSpatialReference;b||(b=a.navigation.currentCamera);var f;f=r.WGS84;b.center?(l.vectorToVector(b.center,h,I,f),f=I[1],b=b.distance):(f=b.position.latitude,l.pointToVector(b.position,x,h),l.pointToVector(c,I,h),b=A.dist(x,I));return C(a,b,f)}}})},"esri/views/3d/support/projectionUtils":function(){define("../../../geometry/SpatialReference ../../../geometry/Point ./mathUtils ./earthUtils ../lib/glMatrix ../webgl-engine/lib/BufferVectorMath".split(" "),
function(B,r,f,a,b,c){var t=b.vec3d,p=b.mat4d,h=c.Vec3Compact,l=t.create(),q=t.create(),y=t.create(),z=f.deg2rad(1),w=f.rad2deg(1),u,C,E,G,n=new B({wkt:'\r\n      GEOCCS["Spherical geocentric",\r\n        DATUM["Not specified",\r\n          SPHEROID["Sphere",'+a.earthRadius+',0]],\r\n        PRIMEM["Greenwich",0.0,\r\n          AUTHORITY["EPSG","8901"]],\r\n        UNIT["m",1.0],\r\n        AXIS["Geocentric X",OTHER],\r\n        AXIS["Geocentric Y",EAST],\r\n        AXIS["Geocentric Z",NORTH]\r\n      ]\r\n    '}),
A=a.earthRadius,x=function(a){return a===n?1:a.isWGS84?2:a.isWebMercator?3:0};B=function(a,b,c,h){c[h++]=a[b++];c[h++]=a[b++];c[h]=a[b]};var I=function(a,b,c,h){var l=.4999999*Math.PI,n=z*a[b+1],n=f.clamp(n,-l,l),l=Math.sin(n);c[h++]=z*a[b]*A;c[h++]=A/2*Math.log((1+l)/(1-l));c[h]=a[b+2]},K=function(a,b,c,h){var f=A+a[b+2],l=z*a[b+1];a=z*a[b];b=Math.cos(l);c[h++]=Math.cos(a)*b*f;c[h++]=Math.sin(a)*b*f;c[h]=Math.sin(l)*f},J=[void 0,K,B,I],N=[void 0,function(a,b,c,l){var n=h.length(a,b),q=f.asin(a[b+
2]/n);a=(0<a[b+1]?1:-1)*f.acos(a[b]/(Math.cos(q)*n));c[l++]=w*a;c[l++]=w*q;c[l]=n-A},B,function(a,b,c,h){c[h++]=w*(a[b++]/A);c[h++]=w*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/A)));c[h]=a[b]}];return{SphericalRenderSpatialReference:n,vectorToVector:function(a,b,c,h){2===a.length?(l[0]=a[0],l[1]=a[1],l[2]=0,a=l):a===c&&(t.set(a,l),a=l);return this.bufferToBuffer(a,b,0,c,h,0,1)},pointToVector:function(a,b,c){l[0]=a.x;l[1]=a.y;var h=a.z;l[2]=void 0!==h?h:0;return this.bufferToBuffer(l,a.spatialReference,
0,b,c,0,1)},vectorToPoint:function(a,b,c,h){"esri.SpatialReference"===c.declaredClass?(h=c,c=new r({spatialReference:h})):h=h||c.spatialReference;return this.bufferToBuffer(a,b,0,l,h,0,1)?(c.x=l[0],c.y=l[1],c.z=l[2],c.spatialReference=h,c):null},xyzToVector:function(a,b,c,h,f,n){l[0]=a;l[1]=b;l[2]=c;return this.bufferToBuffer(l,h,0,f,n,0,1)},bufferToBuffer:function(a,b,c,h,f,l,n){n=n||1;u!==b&&(C=x(b),u=b);E!==f&&(G=x(f),E=f);n=c+3*n;if(C!==G||0===C&&!b.equals(f))if(0<C&&0<G)if(2!==G){var p=J[G];
if(2!==C)for(f=N[C];c<n;c+=3,l+=3)f(a,c,q,0,b.wkid),p(q,0,h,l);else for(;c<n;c+=3,l+=3)p(a,c,h,l)}else for(f=N[C];c<n;c+=3,l+=3)f(a,c,h,l,b.wkid);else return!1;else if(h!==a||c!==l)for(;c<n;c++,l++)h[l]=a[c];return!0},computeLinearTransformation:function(a,b,c,h){var f=x(a),l=x(h);if(f===l&&(0!==f||a.equals(h)))return p.identity(c),p.translate(c,b),!0;if(1===l){if(h=N[f])return h(b,0,q,0,a.wkid),K(q,0,y,0),h=z*q[0],b=z*q[1],a=Math.sin(h),h=Math.cos(h),f=Math.sin(b),b=Math.cos(b),c[0]=-a,c[4]=-f*h,
c[8]=b*h,c[12]=y[0],c[1]=h,c[5]=-f*a,c[9]=b*a,c[13]=y[1],c[2]=0,c[6]=b,c[10]=f,c[14]=y[2],c[3]=0,c[7]=0,c[11]=0,c[15]=1,!0}else if(3===l&&(2===f||1===f))return N[f](b,0,q,0,a.wkid),a=z*q[1],I(q,0,y,0),p.identity(c),p.translate(c,y),a=1/Math.cos(a),p.scale(c,[a,a,1]),!0;return!1},mbsToMbs:function(a,b,c,h){var f=x(b),l=x(h);if(f===l&&(0!==f||b.equals(h)))return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],!0;if(1===l){if(h=N[f])return h(a,0,q,0,b.wkid),K(q,0,c,0),c[3]=a[3],!0}else if(3===l&&(2===f||1===
f))return N[f](a,0,q,0,b.wkid),b=z*q[1],b=Math.abs(b)+Math.asin(a[3]/(A+a[2])),I(q,0,c,0),c[3]=b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3],!0;return!1},extentToBoundingBox:function(a,b,c){if(null==a)return!1;var h;l[0]=null!=a.xmin?a.xmin:0;l[1]=null!=a.ymin?a.ymin:0;l[2]=null!=a.zmin?a.zmin:0;h=this.bufferToBuffer(l,a.spatialReference,0,b,c,0,1);l[0]=null!=a.xmax?a.xmax:0;l[1]=null!=a.ymax?a.ymax:0;l[2]=null!=a.zmax?a.zmax:0;h=h&&this.bufferToBuffer(l,a.spatialReference,0,b,c,3,1);null==
a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return h},extentToBoundingRect:function(a,b,c){if(null==a)return!1;var h;l[0]=null!=a.xmin?a.xmin:0;l[1]=null!=a.ymin?a.ymin:0;l[2]=null!=a.zmin?a.zmin:0;h=this.bufferToBuffer(l,a.spatialReference,0,l,c,0,1);b[0]=l[0];b[1]=l[1];l[0]=null!=a.xmax?a.xmax:0;l[1]=null!=a.ymax?a.ymax:0;l[2]=null!=a.zmax?a.zmax:0;h=h&&this.bufferToBuffer(l,
a.spatialReference,0,l,c,0,1);b[2]=l[0];b[3]=l[1];null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return h},webMercator:{x2lon:function(a){return a/A},y2lat:function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/A))},lon2x:function(a){return a*A},lat2y:function(a){a=Math.sin(a);return A/2*Math.log((1+a)/(1-a))}}}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define(["../../../geometry/Extent","./mathUtils","./projectionUtils",
"../lib/glMatrix","./cameraUtilsInternal"],function(B,r,f,a,b){function c(a,b,c){a=p.create();var f=p.create();h.identity(y);h.rotateZ(y,-r.deg2rad(b));h.rotateX(y,r.deg2rad(c));h.multiplyVec3(y,q,a);p.scale(a,-1);h.multiplyVec3(y,l,f);return{direction:a,up:f}}var t={headingTiltToDirectionUp:c,directionToHeadingTilt:function(a,c,h,f){return b.directionToHeadingTilt(c,h,f,q,l)},eyeForCenterWithHeadingTilt:function(a,b,h,f){var l=c(a,h,f);a=p.add(p.scale(l.direction,-b,p.create()),a);return{up:l.up,
eye:a,heading:h,tilt:f}},lookAtTiltToEyeTilt:function(a,b,c){return r.rad2deg(c)},eyeTiltToLookAtTilt:function(a,b,c){return r.deg2rad(c)},toExtent:function(a,b,c,h,l){var n=a.renderSpatialReference;a=a.map&&a.spatialReference||b.spatialReference;f.pointToVector(b,z,n);f.pointToVector(b,w,n);z[0]-=c/2;w[0]+=c/2;z[1]-=h/2;w[1]+=h/2;f.vectorToVector(z,n,z,a);f.vectorToVector(w,n,w,a);l?(l.xmin=z[0],l.ymin=z[1],l.xmax=w[0],l.ymax=w[1],l.spatialReference=a):l=new B(z[0],z[1],w[0],w[1],a);return l}},p=
a.vec3d,h=a.mat4d,l=p.createFrom(0,1,0),q=p.createFrom(0,0,1),y=h.create(),z=p.create(),w=p.create();return t})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["./mathUtils","../lib/glMatrix"],function(B,r){var f=r.vec3d,a=f.create(),b=f.create();return{directionToHeadingTilt:function(c,t,p,h,l){var q=a;f.normalize(c,q);var y=f.dot(q,h),z=0<y,y=Math.abs(y);.99<y&&(y=Math.abs(f.dot(t,h)),.99>y?(f.set(t,q),z&&f.scale(q,-1)):q=null);t=0;q&&(f.scale(h,f.dot(h,q),b),f.subtract(q,b),t=f.dot(q,
l)/(f.length(q)*f.length(l)),f.cross(q,l,b),t=(0<f.dot(b,h)?1:-1)*B.rad2deg(B.acos(t)));c=B.rad2deg(B.acos(-f.dot(h,c)/f.length(c)));return p?(p.heading=t,p.tilt=c,p):{heading:t,tilt:c}}}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/support/webMercatorUtils ./mathUtils ./earthUtils ../lib/glMatrix ./cameraUtilsInternal".split(" "),function(B,r,f,a,b,c,t){function p(b,c,h){var f=y.create(),l=y.create();
y.cross(b,w,G);0===y.dot(G,G)&&y.cross(b,u,G);z.identity(E);z.rotate(E,-a.deg2rad(c),b);z.rotate(E,-a.deg2rad(h),G);y.cross(G,b,l);y.normalize(l);z.multiplyVec3(E,l);y.normalize(b,f);z.multiplyVec3(E,y.negate(f));return{direction:f,up:l}}function h(a){var b=a[1];a[1]=-a[2];a[2]=b}function l(a,b){b=p(b,a.heading,a.tilt);a.up=b.up;return a}var q={headingTiltToDirectionUp:p,directionToHeadingTilt:function(a,b,c,h){var f=G,l=n;y.normalize(a,f);y.cross(f,w,n);0===y.dot(n,n)&&y.cross(f,u,n);y.cross(n,f,
l);return t.directionToHeadingTilt(b,c,h,f,l)},eyeForCenterWithHeadingTilt:function(b,c,f,n){var q={eye:y.create(),tilt:n,heading:f},p=G;p[0]=b[0];p[1]=b[2];p[2]=-b[1];f=a.deg2rad(f);var u=a.deg2rad(n);n=Math.sin(f);f=Math.cos(f);var t=Math.sin(u),w=Math.cos(u),x=y.length(p);if(1E-8>Math.abs(u))u=c+x;else var z=x/t,C=a.asin(c/z),u=z*Math.sin(Math.PI-u-C);var z=t*c,w=w*c,C=f*z,A=u-w,r=A*A,k=c*c*t*t,t=f*f*k,k=n*n*k,E=p[1]*A,I=t*(t+r-p[1]*p[1]);if(0>I)return y.scale(p,u/x,q.eye),q.tilt=0,q;var e=Math.sqrt(I),
I=t+r,E=0<f?-e+E:e+E;if(1E-8>Math.abs(I))return 1E-8>x?(q.eye[0]=0,q.eye[1]=0,q.eye[2]=c):y.scale(p,u/x,q.eye),q.tilt=0,h(q.eye),l(q,b);q.eye[1]=E/I;I=q.eye[1]*q.eye[1];c=1-I;E=Math.sqrt(c);C=t*I+k-2*C*q.eye[1]*E*A+c*r;if(1E-8>Math.abs(C))return y.scale(p,u/x,q.eye),q.tilt=0,h(q.eye),l(q,b);q.eye[0]=(c*(u*p[0]-w*p[0])-z*E*(p[0]*q.eye[1]*f+p[2]*n))/C;q.eye[2]=(c*(u*p[2]-w*p[2])-z*E*(p[2]*q.eye[1]*f-p[0]*n))/C;y.scale(q.eye,u);h(q.eye);return l(q,b)},lookAtTiltToEyeTilt:function(b,c,h){b=y.length(b);
c=a.asin(c/(Math.sqrt(c*c+b*b-2*c*b*Math.cos(Math.PI-h))/Math.sin(h)));return a.rad2deg(h-c)},eyeTiltToLookAtTilt:function(b,c,h){h=a.deg2rad(h);b=y.length(b);return a.asin(c/(b/Math.sin(h)))+h},toExtent:function(c,h,l,n,q){var p;p=h.latitude;h=h.longitude;var u=b.getLonDeltaForDistance(h,p,l)/2;l=h-u;h+=u;p=a.deg2rad(p);u=b.earthRadius;p=(1+Math.sin(p))/(1-Math.sin(p));var t=(p+1)*Math.tan(n/u/2);p=1.5*Math.PI-2*Math.atan(.5*(t+Math.sqrt(4*p+t*t)));n=p+n/u;u=function(b){var c=Math.PI/2;b=a.cyclical2PI.normalize(b,
-c);b>c&&(b=Math.PI-b);return b};p=u(p);n=u(n);n<p&&(u=n,n=p,p=u);p=Math.max(a.rad2deg(p),-90);n=Math.min(a.rad2deg(n),90);h=C.monotonic(l,h);180<h-l&&(u=(h-l-180)/2,l+=u,h-=u);q?(q.xmin=l,q.ymin=p,q.xmax=h,q.ymax=n,q.spatialReference=B.WGS84):q=new r(l,p,h,n,B.WGS84);c.spatialReference&&c.spatialReference.isWebMercator&&f.geographicToWebMercator(q,!1,q);return q}},y=c.vec3d,z=c.mat4d,w=y.createFrom(0,0,1),u=y.normalize(y.createFrom(1,1,1)),C=new a.Cyclical(-180,180),E=z.create(),G=y.create(),n=y.create();
return q})},"esri/views/3d/support/viewpointUtils":function(){define("../../../geometry/SpatialReference ../../../geometry/Geometry ../../../geometry/Point ../../../geometry/Extent ../../../geometry/support/webMercatorUtils ../../../core/Error ../../../core/promiseUtils ../../../Camera ../../../Viewpoint ../../../Graphic ../lib/glMatrix ./mathUtils ./projectionUtils ./cameraUtils ./aaBoundingBox ./aaBoundingRect ./intersectionUtils".split(" "),function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E){function G(a){return 360-
y.cyclicalDeg.normalize(a)}function n(a){return y.cyclicalDeg.normalize(360-a)}function A(a,d,e){if(!d)return null;var c=a.spatialReference||B.WGS84,g;if(d.camera){g=d.get("camera.position.spatialReference");if(!b.canProject(g,c))return null;d=d.camera.clone();g.equals(c)||(a=b.project(d.position,c),d.position=a);return d}if((g=d.get("targetGeometry.spatialReference"))&&!b.canProject(g,c))return null;var k=a.navigation.currentCamera;g=w.internalToExternal(a,k);var h={noReset:!1};null!=d.rotation&&
(g.heading=G(d.rotation),h.noReset=!0);null!=e&&(g.tilt=e);if(d.targetGeometry instanceof f){var m=d.targetGeometry;e=d.targetGeometry.clone();d=null!=d.scale?w.scaleToDistance(a,d.scale,m.latitude):k.distance;d=w.eyeHeadingTiltForCenterPointAtDistance(a,g.heading,g.tilt,e,d,h);a=z.vectorToPoint(d.eye,a.renderSpatialReference,c);return new p(a,d.heading,d.tilt,g.fov)}return w.fromExtent(a,d.targetGeometry.extent,g,h)}function x(a,d,b,e){var c=b.scale;null==c&&null!=b.zoom&&(c=w.zoomToScale(a,b.zoom));
null==c&&null!=b.distance&&(d=d.center||d,c=w.distanceToScale(a,b.distance,d.latitude));null==c&&e&&(c="function"===typeof e?e():e);return c}function I(a,b,c,h,m){if(!(b&&c.position||b&&c.direction||c.position&&c.direction))return!1;var l=a.spatialReference||B.WGS84,q=a.renderSpatialReference,p=c.direction;b&&c.position&&(p=null);c.position&&z.pointToVector(c.position,e,q);b&&z.pointToVector(b,d,q);if(p){var u=new f(c.position||b);u.x+=p[0];u.y+=p[1];2<p.length&&(u.z+=p[2]);z.pointToVector(u,g,q);
k.subtract(g,c.position?e:d)}c.position&&p?(m.camera.position=new f(c.position),w.directionToHeadingTilt(a,e,g,h.up,m.camera),k.add(e,g,d),a.navigation.getCenterIntersectTerrain(e,d,d),m.targetGeometry=z.vectorToPoint(d,q,l),m.scale=w.distanceToScale(a,k.dist(e,d),m.targetGeometry.latitude)):b&&p?(m.targetGeometry=new f(b),m.scale=x(a,m.targetGeometry,c,function(){return w.computeScale(a,h)}),b=w.scaleToDistance(a,m.scale,b.latitude),k.scale(g,b/k.length(g),e),k.add(e,d),m.camera.position=z.vectorToPoint(e,
q,l),w.directionToHeadingTilt(a,e,g,h.up,m.camera)):(m.targetGeometry=new f(b),m.camera.position=new f(c.position),k.subtract(d,e,g),w.directionToHeadingTilt(a,e,g,h.up,m.camera),m.scale=w.distanceToScale(a,k.dist(e,d),m.targetGeometry.latitude));m.rotation=n(m.camera.heading);return!0}function K(a,d){var b=!1;null!=d.heading?(a.heading=d.heading,b=!0):null!=d.rotation&&(a.heading=G(d.rotation),b=!0);null!=d.tilt&&(a.tilt=d.tilt,b=!0);null!=d.fov&&(a.fov=d.fov);return b}function J(a,d,b){var e=a.spatialReference||
B.WGS84;d=d||w.externalToInternal(a,b.camera);b.targetGeometry=z.vectorToPoint(d.center,a.renderSpatialReference,e);b.scale=w.computeScale(a,d);b.rotation=n(b.camera.heading);return b}function N(a,d,b){if(d){var e=[];if(!d.hasZ&&a.basemapTerrain){var c;c=d.isInstanceOf(f)?d:d.centroid||d.center;v[2]=c?a.basemapTerrain.getElevation(c)||0:0}ja[d.declaredClass](d,function(a){e.push(a[0],a[1],a[2])},v);var g=e.length/3;if(0!==g&&(c=Array(e.length),z.bufferToBuffer(e,d.spatialReference,0,c,a.spatialReference,
0,g)))for(d.hasZ&&(b.hasZ=!0),a=0;a<c.length;a+=3)d.hasZ?(v[0]=c[a+0],v[1]=c[a+1],v[2]=c[a+2]):(v[0]=c[a+0],v[1]=c[a+1]),u.expand(b.boundingBox,v)}}function M(a,d,b){return a.whenViewForGraphic(d).then(function(a){if(a&&a.whenGraphicBounds)return a.whenGraphicBounds(d)}).then(function(a){var d=a.boundingBox;u.expand(b.boundingBox,d);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){b.screenSpaceObjects.push(a)});isFinite(d[2])&&(b.hasZ=!0)}).otherwise(function(){N(a,d.geometry,b)})}function Q(a,
d,b){if(Array.isArray(d)&&2===d.length&&"number"===typeof d[0]&&"number"===typeof d[1])ba.x=d[0],ba.y=d[1],ba.z=void 0,ba.spatialReference=B.WGS84,N(a,ba,b);else{if(d&&d.forEach)return t.eachAlways(d.map(function(d){return Q(a,d,b)}));if(d instanceof r)N(a,d,b);else if(d instanceof l)return M(a,d,b)}return t.resolve()}function S(a,d,b,e){if(d.camera)return P(a,b,d.camera,e);e.scale=d.scale;e.rotation=d.rotation;e.targetGeometry=d.targetGeometry?d.targetGeometry.clone():null;e.camera=null;null!=b.heading?
e.rotation=n(b.heading):null!=b.rotation&&(e.rotation=b.rotation);d=x(a,e.targetGeometry,b);null!=d&&(e.scale=d);e.camera=A(a,e,b.tilt);return e}function P(a,d,e,c){c.camera=e.clone();c.camera.fov=a.camera.fov;d=a.spatialReference;e=c.camera.position.spatialReference;if(!b.canProject(e,d))return null;e.equals(d)||(d=b.project(c.camera.position,d),c.camera.position=d);return J(a,null,c)}function O(a,d,b,e){if(!b)return null;e.targetGeometry=b.clone();var c=a.navigation.getCameraIntersectTerrain();
if(I(a,e.targetGeometry,d,c,e))return e;w.internalToExternal(a,c,e.camera);var g={noReset:!1};K(e.camera,d)&&(g.noReset=!0);e.scale=x(a,e.targetGeometry,d);null==e.scale&&(z.pointToVector(b,v,a.renderSpatialReference),E.frustumPoint(c.frustumPlanes,v)?e.scale=w.distanceToScale(a,k.dist(c.eye,v),b.latitude):e.scale=w.computeScale(a,c));return w.fromCenterScale(a,e.targetGeometry,e.scale,e.camera,g,e.camera)?e:null}function T(a,d,b,e){e.targetGeometry=b.clone();var c=a.navigation.getCameraIntersectTerrain();
w.internalToExternal(a,c,e.camera);c={noReset:!1};K(e.camera,d)&&(c.noReset=!0);return w.fromExtent(a,b,e.camera,c,e.camera)?e:null}function U(a,d){if(!d||!a.spatialReference)return null;a={};if(null!=d.declaredClass||Array.isArray(d))a.target=d;else{for(var b in d)a[b]=d[b];d.center&&!a.target&&(a.target=d.center)}return a}function W(a){a&&(a.rotation=n(a.camera.heading));return t.resolve(a)}var k=q.vec3d,ca=q.mat3d,V=q.mat4d,e=k.create(),d=k.create(),g=k.create(),m={heading:0,tilt:0},v=k.create(),
D=V.create(),L=ca.create(),R=u.create(),Z=C.create(),ba=new f;q=function(a,d,b){for(var e=a.hasZ,c=0;c<a.rings.length;c++)for(var g=a.rings[c],k=0;k<g.length;k++)b[0]=g[k][0],b[1]=g[k][1],e&&(b[2]=g[k][2]),d(b)};var ja={"esri.geometry.Point":function(a,d,b){b[0]=a.x;b[1]=a.y;a.hasZ&&(b[2]=a.z);d(b)},"esri.geometry.Polygon":q,"esri.geometry.Circle":q,"esri.geometry.Polyline":function(a,d,b){for(var e=a.hasZ,c=0;c<a.paths.length;c++)for(var g=a.paths[c],k=0;k<g.length;k++)b[0]=g[k][0],b[1]=g[k][1],
e&&(b[2]=g[k][2]),d(b)},"esri.geometry.Multipoint":function(a,d,b){var e=a.points;a=a.hasZ;for(var c=0;c<e.length;c++)b[0]=e[c][0],b[1]=e[c][1],a&&(b[2]=e[c][2]),d(b)},"esri.geometry.Extent":function(a,d,b){a.hasZ?(d(k.set3(a.xmin,a.ymin,a.zmin,b)),d(k.set3(a.xmax,a.ymin,a.zmin,b)),d(k.set3(a.xmin,a.ymax,a.zmin,b)),d(k.set3(a.xmax,a.ymax,a.zmin,b)),d(k.set3(a.xmin,a.ymin,a.zmax,b)),d(k.set3(a.xmax,a.ymin,a.zmax,b)),d(k.set3(a.xmin,a.ymax,a.zmax,b)),d(k.set3(a.xmax,a.ymax,a.zmax,b))):(d(k.set3(a.xmin,
a.ymin,b[2],b)),d(k.set3(a.xmax,a.ymin,b[2],b)),d(k.set3(a.xmin,a.ymax,b[2],b)),d(k.set3(a.xmax,a.ymax,b[2],b)))}},aa={create:function(d,b){var e=U(d,b);if(!e)return t.reject(new c("viewpointutils-create:no-target","Missing target for creating viewpoint"));var l=new h({camera:new p({fov:d.camera.fov})}),n=null!=e.scale||null!=e.zoom||null!=e.distance;if(e.target instanceof h)return W(S(d,e.target,e,l));if(e.target instanceof p)return W(P(d,e,e.target,l));if(e.target instanceof a)return b=e.target.xmin===
e.target.xmax||e.target.ymin===e.target.ymax,n||b?W(O(d,e,e.target.center,l)):W(T(d,e,e.target,l));var q={boundingBox:u.create(u.NEGATIVE_INFINITY),spatialReference:d.spatialReference,hasZ:!1,screenSpaceObjects:[]};return Q(d,e.target,q).then(function(){if(isFinite(q.boundingBox[0])){u.center(q.boundingBox,v);ba.x=v[0];ba.y=v[1];ba.z=v[2];ba.spatialReference=d.spatialReference;var a;isFinite(ba.z)&&q.hasZ?a=u.isPoint(q.boundingBox):(ba.z=void 0,a=C.isPoint(u.toRect(q.boundingBox,Z)));if(n||a)return O(d,
e,ba,l);a=q.boundingBox;var b;b=q.screenSpaceObjects;var c=aa.DEFAULT_FRAME_COVERAGE;if(b.length){for(var h=Number.NEGATIVE_INFINITY,p=0;p<b.length;p++)var t=b[p].screenSpaceBoundingRect,h=Math.max(h,Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2]),Math.abs(t[3]));b=c-h/Math.min(d.width,d.height)*2}else b=c;p=ba;c=b;l.targetGeometry=p.clone();b=d.navigation.getCameraIntersectTerrain();h=0;p.hasZ?h=p.z:d.basemapTerrain&&(h=d.basemapTerrain.getElevation(p));k.set3(p.x,p.y,h,v);z.computeLinearTransformation(d.spatialReference,
v,D,d.renderSpatialReference);V.toMat3(D,L);ca.transpose(L);u.set(R,u.NEGATIVE_INFINITY);p=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(t=0;t<p.length;t++){var y=p[t],x=a[y[2]];isFinite(x)||(x=h);k.set3(a[y[0]],a[y[1]],x,v);z.vectorToVector(v,d.spatialReference,v,d.renderSpatialReference);u.expand(R,ca.multiplyVec3(L,v))}a=u.width(R);h=u.height(R);p=u.depth(R);t=1/Math.tan(b.fovY/2);a=Math.max(.5*Math.sqrt(a*a+p*p)*Math.max(t,1/Math.tan(b.fovX/2))+.5*h,.5*h*t+.5*Math.max(a,
p))/c;w.internalToExternal(d,b,l.camera);b={noReset:!1};K(l.camera,e)&&(b.noReset=!0);l.scale=w.distanceToScale(d,a,l.targetGeometry.latitude);a=w.fromCenterScale(d,l.targetGeometry,l.scale,l.camera,b,l.camera)?l:null;return a}a=d.navigation.getCameraIntersectTerrain();I(d,null,e,a,l)?a=l:e.position?(k.set(a.viewForward,g),w.directionToHeadingTilt(d,a.eye,g,a.up,m),l.camera.position=new f(e.position),a=l.camera,b=m.heading,c=e.heading,null==c&&null!=e.rotation&&(c=G(e.rotation)),null==c&&b&&(c="function"===
typeof b?b():b),a.heading=c,a=l.camera,b=m.tilt,b=null!=e.tilt?e.tilt:null!=b?"function"===typeof b?b():b:void 0,a.tilt=b,a=J(d,null,l)):(a=z.vectorToPoint(a.center,d.renderSpatialReference,ba,d.spatialReference),a=O(d,e,a,l));return a}).then(function(a){return W(a)})},rotationToHeading:G,headingToRotation:n,toCamera:A,fromCamera:function(a,d,b){b||(b=new h);b.camera=d.clone();return J(a,null,b)},fromInternalCamera:function(a,d,b){b||(b=new h({camera:new p}));w.internalToExternal(a,d,b.camera);return J(a,
d,b)},DEFAULT_FRAME_COVERAGE:.66};return aa})},"esri/views/3d/support/intersectionUtils":function(){define(["../lib/glMatrix"],function(B){function r(b,c,h,f){f.clip[0]=0;f.clip[1]=h?f.len:Number.MAX_VALUE;for(h=0;h<b.length;h++){var l;var p=b[h],t=c;l=f;var w=a.dot(p,l.dir),t=-a.dot(t,p)-p[3];0>t&&0<=w?l=!1:-1E-6<w&&1E-6>w?l=!0:!(0>t||0>w)||0>t&&0>w?(t/=w,0<w?t<l.clip[1]&&(l.clip[1]=t):t>l.clip[0]&&(l.clip[0]=t),l=l.clip[0]<=l.clip[1]):l=!0;if(!l)return!1}return!0}function f(c,f,h,l){c?(h&&l&&(b.len=
a.dist(f,h)),a.set(c,b.dir)):l?(b.len=a.dist(f,h),a.scale(a.subtract(h,f,b.dir),1/b.len)):a.normalize(a.subtract(h,f,b.dir));return b}var a=B.vec3d;B=B.vec2d;var b={dir:a.create(),len:0,clip:B.create()},c={planeSphere:function(a,b,c){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]<c},frustumSphere:function(a,b,h){for(var f=0;6>f;f++)if(!c.planeSphere(a[f],b,h))return!1;return!0},frustumRay:function(a,b,c,l){c=f(l,b,c,!1);return r(a,b,null,c)},frustumPoint:function(b,c){for(var h=0;6>h;h++){var f=b[h];if(0>
-a.dot(c,f)-f[3])return!1}return!0},frustumLineSegment:function(a,b,c,l){l=f(l,b,c,!0);return r(a,b,c,l)}};return c})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ./parts/Model ./parts/View ./lib/Selector ./lib/Camera ./lib/gl-matrix ./lib/Util ./lib/ModelContentType ./lighting/Lightsources".split(" "),function(B,r,f,a,b,c,t,p,h,l){B=t.vec2d;r=t.vec2;var q=t.vec3d;t=function(){function u(c,h,p){this._intersectTolerance=b.DEFAULT_TOLERANCE;this._viewContent=[];this._externalIntersectionHandlers=
[];this.container=h;this.viewingMode=c;this.model=new f;this.view=new a(h,this,this.model.getDirtySet(),p);this._validateHUDSelector=new b(this.viewingMode);this._validateHUDSelector.enableHUDSelection=!1;this.view.setLighting({lights:[new l.MainLight(q.createFrom(.7,.7,.7)),new l.AmbientLight(q.createFrom(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}u.prototype.setNeedsRender=function(){this.view.setNeedsRender()};u.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};
u.prototype.frame=function(a,b){void 0===b&&(b=0);var h=Math.max(1E-6,a.getBSRadius());b=Math.max(2,b+2);b*=h;var h=this.getCamera(),f=q.create(h.viewForward);q.scale(f,-(1.5*b/Math.tan(h.fov)));q.set(a.getCenter(),h.center);q.add(h.center,f,h.eye);h=new c(h.eye,h.center,h.up);this.setCamera(h)};u.prototype.beginMod=function(){u.DebugSettings.fineGrainedContentValidation&&this.model.validateContent()};u.prototype.endMod=function(a){void 0===a&&(a=!1);u.DebugSettings.fineGrainedContentValidation&&
!a&&this.model.validateContent()};u.prototype.add=function(a,b){this.model.add(a,b);"function"===typeof b.addParentStage&&b.addParentStage(this)};u.prototype.remove=function(a,b){a=this.model.remove(a,b);"function"===typeof a.removeParentStage&&a.removeParentStage(this);return a};u.prototype.notifyDirty=function(a,b,c,h){this.model.notifyDirty(a,b,c,h)};u.prototype.processDirty=function(){var a=this.model.getDirtySet(),b=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||b){u.DebugSettings.endFrameContentValidation&&
this.model.validateContent();u.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var c=a.getAddRemoveUpdateListFilteredByLayers(this._viewContent,!0);(0<c[0].length+c[1].length+c[2].length||b)&&this.view.modify(c[0],c[1],c[2],b);u.DebugSettings.logDirtySet&&(console.log("RGs add: "+c[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+c[1].map(function(a){return a.uniqueName})));a.getAddRemoveUpdateList(!0);a.clearDirtyMaterials();
this.view.setNeedsRender()}};u.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),c=b.getDirtyMaterials();a=b.getAddRemoveUpdateListFilteredByLayers([a],!0);(0<a[0].length+a[1].length+a[2].length||c)&&this.view.modify(a[0],a[1],a[2],c);b.clearDirtyMaterials();this.view.setNeedsRender()};u.prototype.get=function(a,b){return this.model.get(a,b)};u.prototype.getAll=function(a){return this.model.getAll(a)};u.prototype.addTextureListener=function(a){this.view.addTextureListener(a)};
u.prototype.removeTextureListener=function(a){this.view.removeTextureListener(a)};u.prototype.getContainer=function(){return this.container};u.prototype.getCamera=function(){return this.view.getCamera()};u.prototype.setCamera=function(a){this.view.setCamera(a)};u.prototype.getViewParams=function(a){return this.view.getViewParams(a)};u.prototype.setViewParams=function(a){this.view.setViewParams(a)};u.prototype.getLayers=function(){return this.model.getAll(h.LAYER)};u.prototype.setLighting=function(a){this.view.setLighting(a)};
u.prototype.getCanvas=function(){return this.view.getCanvas()};u.prototype.setRenderParams=function(a){this.view.setRenderParams(a)};u.prototype.getRenderParams=function(){return this.view.getRenderParams()};u.prototype.has=function(a){return this.view.has(a)};u.prototype.getViewContent=function(){return this._viewContent.slice(0)};u.prototype.setViewContent=function(a){var b=p.array2object(this._viewContent),c=p.array2object(a),h=p.subtractObjects(c,b),b=p.subtractObjects(b,c);this.processDirty();
c=this.model.getDirtySet();h=c.getResidentRenderGeometriesFilteredByLayers(p.object2array(h));b=c.getResidentRenderGeometriesFilteredByLayers(p.object2array(b));this.view.modify(h,b,[]);this._viewContent=a.slice(0)};u.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.view.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,
b))};u.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,h=[],f=0;f<a.length;f++){var l=c.indexOf(a[f]);-1<l&&(c[l]=c[c.length-1],c.pop(),h.push(a[f]))}a=b.getResidentRenderGeometriesFilteredByLayers(h);this.view.modify([],a,[])};u.prototype.getViewFrustumObjects=function(){return this.view.getFrustumObjects()};u.prototype.getLocalOrigin=function(a,b,c){return this.model.getOrigin(a,b,c)};u.prototype.getFrameTask=function(){return this.view.getFrameTask()};
u.prototype.requestScreenCapture=function(a,b){this.view.requestScreenCapture(a,b)};u.prototype.getAllTexturesLoaded=function(){return this.view.getAllTexturesLoaded()};u.prototype.getTextureLoaded=function(a){return this.view.getTextureLoaded(a)};u.prototype.addExternalRenderer=function(a,b){"function"===typeof b.intersect&&this._externalIntersectionHandlers.push(b);return this.view.addExternalRenderer(a,b)};u.prototype.removeExternalRenderer=function(a){var b=this._externalIntersectionHandlers.indexOf(a);
-1<b&&this._externalIntersectionHandlers.splice(b,1);return this.view.removeExternalRenderer(a)};u.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};u.prototype.getRenderStats=function(){return this.view.getCombinedStats()};u.prototype.getRenderStatString=function(a){var b=this.getRenderStats(),c="";if(a){var c=c+"\x3ctable\x3e",h;for(h in b)c+="\x3ctr\x3e\x3ctd\x3e"+h+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(b[h])+"\x3c/td\x3e\x3c/tr\x3e";c+=
"\x3c/table\x3e"}else for(h in b)c+=h+": "+b[h]+"\n";return c};u.prototype.pick=function(a,b,c,h){var f=q.create(),l=q.create();this.view.getPickRay(a,f,l);return this.pickRay(f,l,a,a,b,c,h)};u.prototype.pickRayWithBeginPoint=function(a,b,c,h,f){this.view.pickRayWithBeginPoint(a,b,c,h,f)};u.prototype.pickRay=function(a,c,h,l,p,u,t){l=this.view.getCamera();h||(h=y,l.projectPoint(c,h));var n;if(p){n=Array(p.length);for(var x=0;x<n.length;x++)n[x]=this.model.get(f.ContentType.LAYER,p[x])}else{n=[];p=
this.getViewContent();for(var C=this.model.getAll(f.ContentType.LAYER),x=0;x<p.length;x++){var A=C[p[x]];A&&"VISIBLE"===A.getState()&&n.push(A)}}t?t.init(n,a,c,h,l,this._intersectTolerance,u):t=new b(this.viewingMode,n,a,c,h,l,this._intersectTolerance,u);for(x=0;x<this._externalIntersectionHandlers.length;x++)this._externalIntersectionHandlers[x].intersect(t,a,c,h);if(t.getHudResults().length){x=t.getHudResults();x.sort(function(a,b){return b.dist-a.dist});c=x[x.length-1];h=z;l.projectPoint(c.center,
h);h[0]=Math.round(h[0]);h[1]=Math.round(h[1]);p=w;this.view.getPickRay(h,a,p);C=q.dist(c.center,a)/q.dist(a,p)*.99;this._validateHUDSelector.init(n,a,p,h,l,this._intersectTolerance,u);for(x=0;x<this._externalIntersectionHandlers.length;x++)this._externalIntersectionHandlers[x].intersect(this._validateHUDSelector,a,p,h);if(null==this._validateHUDSelector.getMinResult().dist||C<=this._validateHUDSelector.getMinResult().dist)t.getMinResult().set(c.target,c.name,c.dist,c.normal,c.priority),t.getMinResult().setIntersector("stage")}return t};
u.prototype.getIntersectTolerance=function(){return this._intersectTolerance};u.prototype.setIntersectTolerance=function(a){void 0===a&&(a=1E-5);this._intersectTolerance=a};u.prototype.getTextureGraphicsRenderer=function(){return this.view.getTextureGraphicsRenderer()};u.DebugSettings={fineGrainedContentValidation:!1,endFrameContentValidation:!1,logDirtySet:!1};u.ModelContentType=h;return u}();var y=B.create(),z=r.create(),w=q.create();return t})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/Logger ../lib/GLTextureRep ../lib/GLMaterialRep ../lib/ShaderSnippets ../lib/GLSLShaderRep ../lib/TextureRenderer ../lib/gl-matrix ../lib/webgl-utils ./Model ./Viewport ../materials/repository ../lib/SSAOHelperObscurance ../lib/HighlightHelper ../lib/OffscreenRenderingHelper ../lib/tracer ../../../webgl/RenderingContext ../lib/ProgramRepository ../lighting/Lightsources ../../../support/screenshotUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x){var I=h.vec3d,K=h.vec4d,J=f.getLogger("esri.views.3d.webgl-engine.parts.View");return function(){function h(c,h,f,l){var n=this;this._backgroundColor=K.createFrom(1,1,1,1);this._lightDirection=I.createFrom(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._screenCaptureQueue=[];this._container=c;this._stage=h;this._initializeContext(l);this._initializeShaders(l);this._textureRep=new a(h.getAll(q.ContentType.TEXTURE),
this._programRepository,function(){return n._viewport.getCamera().viewport},this._rctx);this._materialRep=new b(this._textureRep,this._programRepository);this._viewport=new y(this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._textureRenderer=new p(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,f);this._initializeFrameTask()}h.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){E.begin();
a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clear(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&(a._didRender=!0,a._viewport.render(a._lightDirection,null))},postRender:function(){E.end()},update:function(){a._performScreenCaptures();a.resetNeedsRender()}}};h.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this._viewport.getCamera();
b.viewport[2]=a.width;b.viewport[3]=a.height;this._viewport.setCamera(b)};h.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var b=l.setupWebGL(this._canvas,{alpha:a.alpha||!1,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil});this._gl=E.instrumentContext(b[0]);this._rctx=new G(b[0],{disabledExtensions:a.deactivatedWebGLExtensions});!a.alpha&&
this._rctx.contextAttributes.alpha&&J.error("WebGL context has alpha channel even though no alpha channel was requested");this._container.appendChild(this._canvas)};h.prototype._initializeShaders=function(a){this._shaderSnippets=new c({fsprecisionf:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n",vsprecisionf:"\nprecision highp float;\nprecision highp sampler2D;\n",viewingMode:"global"===
a.viewingMode?"#define VIEWING_MODE_GLOBAL 1 \n":" #define VIEWING_MODE_LOCAL 1 \n"});this._shaderRep=new t;this._programRepository=new n;z.initializeShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx);u.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx);w.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx);C.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx)};h.prototype.dispose=
function(){this._viewport.dispose();this._viewport=null;this._textureRenderer.dispose();this._textureRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._gl=this._canvas=this._container=null};h.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};h.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=!0};h.prototype.resetNeedsRender=function(){this._didRender&&
(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};h.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()};h.prototype.getFrameTask=function(){return this._frameTask};h.prototype.setLighting=function(a){I.set3(0,0,0,this._lightDirection);for(var b=0,c=a.lights;b<c.length;b++){var h=c[b];if(h instanceof A.MainLight){I.negate(h.direction,this._lightDirection);
break}}this._viewport.setLighting(a);this._needsRender=!0};h.prototype.getMainLightDirection=function(){return this._lightDirection};h.prototype.getViewParams=function(a){var b=this._viewport.getViewParams(a);if(!a||a.backgroundColor)b.backgroundColor=this._backgroundColor;return b};h.prototype.setViewParams=function(a){this._needsRender=!0;a.backgroundColor&&(this._backgroundColor=a.backgroundColor);this._viewport.setViewParams(a)};h.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==
a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};h.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(h.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});h.prototype.has=function(a){return"s3tc"===a?!!this._rctx.extensions.compressedTextureS3TC:"standardDerivatives"===a?
!!this._rctx.extensions.standardDerivatives:"shaderTextureLOD"===a?!!this._rctx.extensions.shaderTextureLOD:"angleInstancedArrays"===a?!!this._rctx.extensions.angleInstancedArrays:!1};h.prototype.getFrustumObjects=function(){return this._viewport.getFrustumObjects()};h.prototype.modify=function(a,b,c,h){this._viewport.modify(a,b,c,h)};h.prototype.setCamera=function(a){this._viewport.setCamera(a)};h.prototype.getCamera=function(){return this._viewport.getCamera()};h.prototype.getPickRay=function(a,
b,c){this._viewport.getPickRay(a,b,c)};h.prototype.pickRayWithBeginPoint=function(a,b,c,h,f){this._viewport.pickRayWithBeginPoint(a,b,c,h,f)};h.prototype.getCanvas=function(){return this._canvas};h.prototype.getTextureGraphicsRenderer=function(){return this._textureRenderer};h.prototype.requestScreenCapture=function(a,b){this._screenCaptureQueue.push({settings:a||{},callback:b});this._needsRender=!0};h.prototype.getAllTexturesLoaded=function(){return 0===this._textureRep.getLoadingCount()};h.prototype.getTextureLoaded=
function(a){return this._textureRep.getIsLoaded(a)};h.prototype.addTextureListener=function(a){this._textureRep.addTextureListener(a)};h.prototype.removeTextureListener=function(a){this._textureRep.removeTextureListener(a)};h.prototype.addExternalRenderer=function(a,b){return this._viewport.addExternalRenderer(a,b)?(b.initializeRenderContext({rctx:this._rctx,gl:this._rctx.gl,shaderSnippets:this._shaderSnippets,shaderRep:this._shaderRep,programRep:this._programRepository,textureRep:this._textureRep}),
!0):!1};h.prototype.removeExternalRenderer=function(a){return this._viewport.removeExternalRenderer(a)?(a.uninitializeRenderContext({rctx:this._rctx,gl:this._rctx.gl}),!0):!1};h.prototype._performScreenCaptures=function(){if(0!==this._screenCaptureQueue.length){for(var a=0;a<this._screenCaptureQueue.length;a++){var b=this._screenCaptureQueue[a],c=0,h=0,f=this._canvas.width,l=this._canvas.height,n=this._canvas.width,q=this._canvas.height,k=b.settings.area;k&&(c=k.x,h=k.y,f=k.width,l=k.height);void 0!==
b.settings.width&&void 0!==b.settings.height?(k=b.settings.width/b.settings.height,l*k<f?(k*=l,c+=Math.floor((f-k)/2),f=Math.floor(k)):(k=f/k,h+=Math.floor((l-k)/2),l=Math.floor(k)),n=b.settings.width,q=b.settings.height):(n=f,q=l);var p=this._canvas,k=null;if(0!==c||0!==h||f!==this._canvas.width||l!==this._canvas.height||n!==this._canvas.width||q!==this._canvas.height){this._resizeCanvas||(this._resizeCanvas=document.createElement("canvas"));this._resizeCanvas.width=n;this._resizeCanvas.height=q;
var u=this._resizeCanvas.getContext("2d"),k=new Uint8Array(f*l*4);this._gl.readPixels(c,this._canvas.height-(h+l),f,l,6408,5121,k);c=u.getImageData(0,0,n,q);x.resampleHermite(k,f,l,c.data,n,q,!0);u.putImageData(c,0,0);p=this._resizeCanvas;u=null}f={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"}[b.settings.format?b.settings.format.toLowerCase():"png"];l=1;void 0!==b.settings.quality&&(l=b.settings.quality/100);f={dataURL:p.toDataURL(f,l),x:0,y:0,width:n,height:q};b.settings.returnByteBuffer&&
(f.data=k);b.callback(f)}this._screenCaptureQueue=[]}};return h}()})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","./Util"],function(B,r,f){var a=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;f.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function b(a,
b){this.textureRep=a;this.programRep=b;this.id2glMaterialRef={}}b.prototype.aquire=function(a){return this.aquireExt(a,"color")};b.prototype.aquireDepthShadowMap=function(a){return this.aquireExt(a,"depthShadowMap")};b.prototype.aquireDepth=function(a){return this.aquireExt(a,"depth")};b.prototype.aquireNormal=function(a){return this.aquireExt(a,"normal")};b.prototype.aquireHighlight=function(a){return this.aquireExt(a,"highlight")};b.prototype.aquireExt=function(b,f){var c;c=b.getId()+"_"+f;var h=
this.id2glMaterialRef[c];null==h?(b=(h=b.getGLMaterials()[f])?new h(b,this.programRep,this.textureRep):void 0,h=new a(b),this.id2glMaterialRef[c]=h):b=h.getGLMaterial();h.incRefCnt();b&&this.increaseProgramReferences(b);return b};b.prototype.release=function(a){this.releaseExt(a,"color")};b.prototype.releaseDepth=function(a){this.releaseExt(a,"depth")};b.prototype.releaseNormal=function(a){this.releaseExt(a,"normal")};b.prototype.releaseDepthShadowMap=function(a){this.releaseExt(a,"depthShadowMap")};
b.prototype.releaseHighlight=function(a){this.releaseExt(a,"highlight")};b.prototype.releaseExt=function(a,b){a=a+"_"+b;b=this.id2glMaterialRef[a];b.decRefCnt();if(0===b.getRefCnt()){if(b=b.getGLMaterial())this.decreaseProgramReferences(b),void 0!==b.dispose&&b.dispose();delete this.id2glMaterialRef[a]}};b.prototype.updateMaterialParameters=function(a){var b=this.id2glMaterialRef[a+"_color"];b&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depth"])&&b.getGLMaterial()&&
this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depthShadowMap"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_normal"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(a=this.id2glMaterialRef[a+"_highlight"])&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())};b.prototype.updateParamsForMat=function(a){a.updateParameters&&a.updateParameters()};b.prototype.increaseProgramReferences=function(a){if(a.getAllPrograms){a=
a.getAllPrograms();for(var b=0;b<a.length;b++)this.programRep.increaseRefCount(a[b])}else this.programRep.increaseRefCount(a.getProgram())};b.prototype.decreaseProgramReferences=function(a){if(a.getAllPrograms){a=a.getAllPrograms();for(var b=0;b<a.length;b++)this.programRep.decreaseRefCount(a[b])}else this.programRep.decreaseRefCount(a.getProgram())};return b}()})},"esri/views/3d/webgl-engine/lib/ShaderSnippets":function(){define(["require","exports","./Util","dojox/xml/parser"],function(B,r,f,a){return function(){function b(a){var b=
f.VertexAttrConstants,c;for(c in b)this[b[c]]=f.VertexAttrConstants[c];if(a)for(var h in a)this[h]=a[h]}b.prototype._parse=function(b){b=a.parse(b).getElementsByTagName("snippet");for(var c=/\$[a-zA-Z0-9]+[ \t]*/,p=/[\$\s]+/g,h=0;h<b.length;h++){var l=b[h].getAttribute("name");f.assert(null==this[l]);for(var q=b[h].textContent;;){var y=q.match(c);if(null==y)break;var z=this[y[0].replace(p,"")];f.assert(void 0!==z);q=q.replace(y[0],z)}this[l]=q}};return b}()})},"dojox/xml/parser":function(){define(["dojo/_base/kernel",
"dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(B){B.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(r,f){var a=B.doc,b;f=f||"text/xml";if(r&&B.trim(r)&&"DOMParser"in B.global){b=(new DOMParser).parseFromString(r,f);r=b.documentElement;if("parsererror"==r.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==r.namespaceURI){if(a=r.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0])a=a.firstChild.data;
throw Error("Error parsing text "+r.firstChild.data+" \n"+a);}return b}if("ActiveXObject"in B.global){a=function(a){return"MSXML"+a+".DOMDocument"};a=["Microsoft.XMLDOM",a(6),a(4),a(3),a(2)];B.some(a,function(a){try{b=new ActiveXObject(a)}catch(p){return!1}return!0});if(r&&b&&(b.async=!1,b.loadXML(r),r=b.parseError,0!==r.errorCode))throw Error("Line: "+r.line+"\nCol: "+r.linepos+"\nReason: "+r.reason+"\nError Code: "+r.errorCode+"\nSource: "+r.srcText);if(b)return b}else if(a.implementation&&a.implementation.createDocument){if(r&&
B.trim(r)&&a.createElement){f=a.createElement("xml");f.innerHTML=r;var c=a.implementation.createDocument("foo","",null);B.forEach(f.childNodes,function(a){c.importNode(a,!0)});return c}return a.implementation.createDocument("","",null)}return null};dojox.xml.parser.textContent=function(r,f){if(1<arguments.length)return dojox.xml.parser.replaceChildren(r,(r.ownerDocument||B.doc).createTextNode(f)),f;if(void 0!==r.textContent)return r.textContent;var a="";r&&B.forEach(r.childNodes,function(b){switch(b.nodeType){case 1:case 5:a+=
dojox.xml.parser.textContent(b);break;case 3:case 2:case 4:a+=b.nodeValue}});return a};dojox.xml.parser.replaceChildren=function(r,f){var a=[];B.isIE&&B.forEach(r.childNodes,function(b){a.push(b)});dojox.xml.parser.removeChildren(r);B.forEach(a,B.destroy);B.isArray(f)?B.forEach(f,function(a){r.appendChild(a)}):r.appendChild(f)};dojox.xml.parser.removeChildren=function(r){for(var f=r.childNodes.length;r.hasChildNodes();)r.removeChild(r.firstChild);return f};dojox.xml.parser.innerXML=function(r){return r.innerXML?
r.innerXML:r.xml?r.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(r):null};return dojox.xml.parser})},"esri/views/3d/webgl-engine/lib/GLSLShaderRep":function(){define(["require","exports","./Util"],function(B,r,f){return function(){function a(){this.shaders={}}a.prototype.add=function(a,c){f.assert(null==this.shaders[a]);this.shaders[a]=c};a.prototype.get=function(a){f.assert(void 0!==this.shaders[a]);return this.shaders[a]};return a}()})},"esri/views/3d/webgl-engine/lib/TextureRenderer":function(){define("require exports ./Renderer ./Camera ./Util ./gl-matrix ../materials/internal/TexOnlyGLMaterial ./ModelDirtyTypesTs ./RenderPass ./HighlightUtils ./ComponentUtils ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/Texture ../../support/debugFlags ../lighting/Lightsources ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x){var I=c.vec3d,K=c.vec4d,J=c.mat4d;B=function(){function a(a,b,c,h,l,n){var k=this;this._acquiredTextures={};this._clearColor=K.createFrom(0,0,0,0);this._id2origin={};this._uniqueIdx=0;this._rctx=a;this._canvas=b;this._programRep=c;this._materialRep=h;this._textureRep=l;this._modelDirtySet=n;this._renderer=new f(c,h,l,this._rctx,!0);this._renderer.onHasHighlightsChanged=function(a){if(k.onHasHighlightsChanged)k.onHasHighlightsChanged(a)};this._renderer.setLighting({lights:[new G.AmbientLight(I.createFrom(1,
1,1))],groundLightingFactor:1,globalFactor:0})}a.prototype.dispose=function(){for(var a in this._acquiredTextures)this._acquiredTextures[a].fbo.dispose(),this._textureRep.release(a);this._acquiredTextures=null;this._renderer.dispose();this._renderer=null};a.prototype.addRenderGeometries=function(a){var b=this;a.forEach(function(a){null==a.origin&&(a.origin=b.getOrigin(a.center,a.bsRadius));a.idx=b._uniqueIdx++});this._renderer.modify(a,[])};a.prototype.removeRenderGeometries=function(a){this._renderer.modify([],
a)};a.prototype.updateRenderGeometries=function(a,b){a=a.map(function(a){return{renderGeometry:a,updateType:b}});this._renderer.modify([],[],a,{})};a.prototype.updateRenderOrder=function(a){0<Object.keys(a).length&&this._renderer.modifyRenderOrder(a)};a.prototype.setBackgroundColor=function(a){this._clearColor=a};a.prototype.addRenderGeometryHighlight=function(a,b){var c=a.instanceParameters,h=l.generateHighlightId();c.componentHighlights=q.addHighlight(c.componentHighlights,null,b,h);this.updateRenderGeometries([a],
32);return h};a.prototype.removeRenderGeometryHighlight=function(a,b){var c=a.instanceParameters;c.componentHighlights=q.removeHighlight(c.componentHighlights,b);this.updateRenderGeometries([a],32)};a.prototype.isEmpty=function(){return this._renderer.isEmpty()};a.prototype.processDirtyMaterials=function(){var a=this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},
enumerable:!0,configurable:!0});a.prototype.draw=function(a,b){return this.drawPass(h.MATERIAL,a,b)};a.prototype.drawHighlights=function(a,b){return this.drawPass(h.MATERIAL_HIGHLIGHT,a,b)};a.prototype.drawPass=function(a,b,c){if(this.isEmpty()&&!E.OVERLAY_DRAW_TEST_TEXTURE)return!1;this.processDirtyMaterials();if(a===h.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;var f=b.getId(),l,n=this._rctx,k=n.gl;if(this._acquiredTextures[f])l=this._acquiredTextures[f].fbo;else{l=this._textureRep.aquire(f).getGLTexture();
l=y.createWithAttachments(this._rctx,l,{colorTarget:0,depthStencilTarget:0});var q=Object.keys(this._acquiredTextures).length;this._acquiredTextures[f]={texture:b,fbo:l,idx:q}}b=c.width;q=c.height;if(l.width!==b||l.height!==q)l.resize(b,q),l.colorTexture.setSamplingMode(9729);M.near=1;M.far=1E4;n.bindFramebuffer(l);n.setDepthTestEnabled(!1);n.setBlendFunctionSeparate(770,771,1,771);n.setClearColor.apply(n,this._clearColor);n.clear(k.COLOR_BUFFER_BIT);this._renderer.setPixelRatio(c.pixelRatio||1);
for(k=0;k<c.views.length;k++)l=c.views[k],M.viewport=l.viewport,J.ortho(0,l.extent[2]-l.extent[0],0,l.extent[3]-l.extent[1],M.near,M.far,M.projectionMatrix),J.identity(M.viewMatrix),J.translate(M.viewMatrix,[-l.extent[0],-l.extent[1],0]),M.setGLViewport(this._rctx),E.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(b,q,N[this._acquiredTextures[f].idx%N.length]),this._renderer.renderGeometryPass(a,M);n.setDepthTestEnabled(!0);n.setBlendFunctionSeparate(770,771,1,771);n.bindFramebuffer(null);n.setViewport(0,
0,this._canvas.width,this._canvas.height);return!0};a.prototype._drawTestTexture=function(a,b,c){var h=this._rctx,f=h.gl;if(!this._testPatternMat){for(var l=new Uint8Array(a*b*4),k=0,n=0;n<b;n++)for(var q=0;q<a;q++){var e=Math.floor(q/10),d=Math.floor(n/10);2>e||2>d||10*e>a-20||10*d>b-20?(l[k++]=255,l[k++]=255,l[k++]=255,l[k++]=255):(l[k++]=255,l[k++]=255,l[k++]=255,e&1&&d&1?l[k++]=q&1^n&1?0:255:l[k++]=e&1^d&1?0:128)}a=new C(h,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,
height:b},l);this._testPatternMat=new t(this._programRep,a,[1,1,1,1],!0,f.ALWAYS);this._testPatternBindParams={proj:J.identity(),view:J.identity(),nearFar:[-1,1],origin:[0,0,0]};f=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);this._quadVAO=new z(h,x.Default3D,{geometry:A.Pos3Tex},{geometry:w.createVertex(h,35044,f)})}this._testPatternMat.setColor([c[0],c[1],c[2],1]);this._testPatternMat.bind(h,this._testPatternBindParams);this._testPatternMat.bindView(h,this._testPatternBindParams);
h.bindVAO(this._quadVAO);h.drawArrays(5,0,u.vertexCount(this._quadVAO,"geometry"));this._testPatternMat.release(h)};a.prototype.getOrigin=function(a,c){var h=0;c=10*c/1E4;1<c&&(h=Math.ceil(b.logWithBase(c,2)));c=1E4*Math.pow(2,h);var f=Math.round(a[0]/c),l=Math.round(a[1]/c);a=Math.round(a[2]/c);var h=h+"_"+f+"_"+l+"_"+a,n=this._id2origin[h];null==n&&(n={vec3:I.createFrom(f*c,l*c,a*c),id:h},this._id2origin[h]=n);return n};return a}();var N=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],M=new a;return B})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ./IntervalUtilities ./ModelDirtyTypesTs ./Float32ArrayList ./InstanceBufferData ../lighting/SceneLighting ../materials/internal/SimpleGLMaterial ./LinearDepthTextureHelper ./NormalTextureHelper ./HighlightTextureHelper ./RenderPass ./RenderSlot ./RenderContext ./ExternalRendererContainer ./StencilRenderingHelper ./Util ./gl-matrix ./ComponentUtils ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ./FxaaRenderPass ./SmaaRenderPass ../../../webgl/enums ./DefaultVertexAttributeLocations ../../../webgl/Profiling ../materials/HUDMaterial".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q,S,P){var O=E.assert,T=E.objectEmpty,U=E.getFirstObjectValue,W=E.setMatrixTranslation3;B=G.vec2d;var k=G.vec4d,ca=G.mat4d,V=E.VertexAttrConstants,e=ca.identity();E=function(){function a(a,b,e,c,g){this._lighting=new t.SceneLighting;this._mat2dataMerged={};this._mat2dataInstanced={};this._renderOrder=[];this._externalRenderers=new u;this._renderContext=new w;this._framesRendered=0;this._isRendering=!1;this._highlights=[];this._pixelRatio=
1;this._threshold=1535;this._needsRender=!0;this._fallbackDepthStencilTexture=null;this._stats=new d;this.ssaoEnabled=!1;this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1};this._programRep=a;this._materialRep=b;this._textureRep=e;this._orderedRendering=g;this._rctx=c;b=c.gl;this._fxaaPass=new J(c);this._smaaPass=new N(c);this._selectionMaterial=new p(a,k.createFrom(.1,.2,.9,.4),b.EQUAL);this._selectionMaterialLines=new p(a,k.createFrom(.1,.2,.9,.4),b.EQUAL,b.LINES);this._renderContext.lightingData=
this._lighting.getOld();c.setDepthTestEnabled(!0);c.setFaceCullingEnabled(!0);c.setBlendingEnabled(!1);c.setBlendFunctionSeparate(770,771,1,771);this._bindParameters={view:null,proj:null,viewInvTransp:null,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,instanceParameters:null,depthFBO:null,normalFBO:null,extensions:{angleInstancedArrays:c.extensions.angleInstancedArrays}};this._linearDepthTextureHelper=new h(c);this._normalTextureHelper=
new l(c);this._highlightTextureHelper=new q(c);this._stencilRenderingHelper=new C(c);this._initializeFramebufferTexture()}a.prototype._initializeFramebufferTexture=function(){var a=this._rctx.gl,a=this._rctx.contextAttributes.alpha?a.RGBA:a.RGB,b=new A(this._rctx,{target:3553,pixelFormat:a,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:a,texture:b}};a.prototype.dispose=function(){for(var a in this._mat2dataMerged){this._releaseMaterials(a);var b=this._mat2dataMerged[a],
d;for(d in b.origin2data)b.origin2data[d].vao.dispose(!0)}this._mat2dataMerged=null;for(a in this._mat2dataInstanced)for(d in this._releaseMaterials(a),b=this._mat2dataInstanced[a],b.origin2data)b.origin2data[d].vao.dispose(!0);this._mat2dataInstanced=null;this._framebuffer.texture.dispose();this._framebuffer.texture=null;this._linearDepthTextureHelper.getEnableState()&&this._linearDepthTextureHelper.disable();this._normalTextureHelper.getEnableState()&&this._normalTextureHelper.disable();this._highlightTextureHelper.getEnableState()&&
this._highlightTextureHelper.setEnableState(!1);this._stencilRenderingHelper.getEnableState()&&this._stencilRenderingHelper.setEnableState(!1);this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null)};a.prototype.setLighting=function(a){this._lighting.set(a)};a.prototype.setPixelRatio=function(a){this._pixelRatio=a;this._needsRender=!0};a.prototype.getPixelRatio=function(){return this._pixelRatio};a.prototype.addExternalRenderer=function(a,
b){this._externalRenderers.addRenderer(a,b);return!0};a.prototype.removeExternalRenderer=function(a){this._externalRenderers.removeRenderer(a);return!0};a.prototype.getExternalRenderers=function(){return this._externalRenderers};a.prototype.resetNeedsRender=function(){this._needsRender=!1;this._externalRenderers.resetNeedsRender()};a.prototype.needsRender=function(){return this._needsRender||this._externalRenderers.needsRender()};a.prototype.getCombinedStats=function(){this._stats.VBOallocatedSize=
0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;for(var a in this._mat2dataInstanced){var b=this._mat2dataInstanced[a],d;for(d in b.origin2data){var e=b.origin2data[d];this._stats.VBOallocatedSize+=e.buffer.getArray().length;this._stats.VBOusedSize+=e.buffer.getSize();this._stats.VBOoptimalSize+=e.optimalCount}}for(a in this._mat2dataMerged)for(d in b=this._mat2dataMerged[a],b.origin2data)e=b.origin2data[d],this._stats.VBOallocatedSize+=e.buffer.getArray().length,this._stats.VBOusedSize+=
e.buffer.getSize(),this._stats.VBOoptimalSize+=e.optimalCount;this._stats.VBOallocatedSize*=.00390625;this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};a.prototype._addHighlight=function(a){var b=this._getInstance(a,!0)||this._getInstance(a,!1);if(null===b)console.error("No instance found for RenderGeometry {name: '"+a.name+"', uniqueName: '"+a.uniqueName+"'}");else if(this._highlights.push(b),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=
!0,this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights)};a.prototype._removeHighlight=function(a){var b=this._highlights.length;this._highlights=this._highlights.filter(function(b){return b.uniqueName!==a.uniqueName});if(b!==this._highlights.length){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights);this._needsRender=!0}};Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return 0<this._highlights.length},enumerable:!0,configurable:!0});
a.prototype._renderHUDVisibility=function(a){var b=this,d=P.shouldRenderVisibilityDuringRenderPass(a.pass),e=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.getEnableState();d&&e&&a.offscreenRenderingHelper.renderHUDVisibility(function(){b._renderInternalSlot(z.OCCLUSION_PIXELS,a)})};a.prototype.renderGeometrySlots=function(a){this._externalRenderers.render(z.INTERNAL_MATERIAL,a);this._renderInternalSlot(z.STENCIL_MATERIAL,a);this._externalRenderers.render(z.OPAQUE_TERRAIN,a);this._renderInternalSlot(z.OPAQUE_MATERIAL,
a);this._externalRenderers.render(z.OPAQUE_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderInternalSlot(z.TRANSPARENT_MATERIAL,a);this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(a),this._renderInternalSlot(z.LINE_CALLOUTS,this._renderContext));this._externalRenderers.render(z.TRANSPARENT_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._externalRenderers.render(z.TRANSPARENT_TERRAIN,a)};a.prototype._renderHighlights=function(a,
b,d){var e=!!d&&d.getEnableState()&&(this.hasHighlights||this._externalRenderers.needsHighlight());this._highlightTextureHelper.setEnableState(e);if(e){e=null;d.profilingCallback&&(e=S.startMeasurement(this._renderContext.rctx));this._highlightTextureHelper.setupFBOs(a);this._highlightTextureHelper.prepareHighlightPass();this.renderGeometryPass(y.MATERIAL_HIGHLIGHT,a,null,null);this._rctx.clear(this._rctx.gl.DEPTH_BUFFER_BIT);this._renderInternalSlot(z.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);
this._renderInternalSlot(z.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(z.HUDMATERIAL2,this._renderContext);this._highlightTextureHelper.finish(b);var c=this._highlightTextureHelper.getHighlightFBO();d.render(a,b,c);null!==e&&d.profilingCallback&&e.stop(function(a){d.profilingCallback&&d.profilingCallback(a)})}};a.prototype._renderUnordered=function(a,b,d,e,c,g){var k=this._rctx;this._isRendering=!0;this._stats.reset();this._updateGlobalUniforms(a.projectionMatrix);this._renderContext.pass=
y.MATERIAL;this._renderContext.camera=a;this._renderContext.shadowMap=b;this._renderContext.ssaoHelper=d;this._renderContext.offscreenRenderingHelper=c;this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper;this._renderContext.depth=this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._renderContext.highlight=this._highlightTextureHelper.getHighlightFBO();this._renderContext.options=this.renderOptions;this._renderContext.rctx=
this._rctx;this._renderContext.lightingData=this._lighting.getOld();c.setEnableState(!0);c.initializeFrame(a);this._externalRenderers.render(z.BACKGROUND,this._renderContext);this.renderGeometrySlots(this._renderContext);this._externalRenderers.render(z.POSTPROCESSING_ATMOSPHERE,this._renderContext);this.renderOptions.earlyOcclusionPixelDraw||(this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(z.LINE_CALLOUTS,this._renderContext));switch(this.renderOptions.antialiasing){case "none":b=
a.viewport;b=ca.ortho(b[0],b[2],b[1],b[3],-1,1);c.drawQuad(b);this._fxaaPass.disable();this._smaaPass.disable();break;case "fxaa":this._smaaPass.disable();this._fxaaPass.render({colorTexture:c.getColorTexture()},null);break;case "smaa":this._fxaaPass.disable(),this._smaaPass.render({colorTexture:c.getColorTexture()},null)}k.bindFramebuffer(null);this._renderContext.framebufferTex=c.getColorTexture();this._renderInternalSlot(z.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);this._renderInternalSlot(z.HUDMATERIAL1,
this._renderContext);this._renderInternalSlot(z.HUDMATERIAL2,this._renderContext);this._renderHighlights(a,e,g);this._framesRendered++;this._isRendering=!1};a.prototype._renderGeometryPassOrderedHighlight=function(a){this._renderInternalHighlights(this._highlights)};a.prototype._renderGeometryPassOrderedMaterial=function(a){for(var b=null,d=0;d<this._renderOrder.length;d++){var c=this._renderOrder[d][1];if(c.instanced){var g=c.instanced||c.merged,k=g[a.pass];!k||k.isVisible&&!k.isVisible()||(this._renderInternalInstanced(g,
k,this._bindParameters,Infinity),b=null)}c.merged&&(g=c.merged,!(k=g[a.pass])||k.isVisible&&!k.isVisible()||(c=k.getProgram(),c!==b&&(c.setUniformMatrix4fv("model",e),c.hasUniform("modelNormal")&&c.setUniformMatrix4fv("modelNormal",e)),b=c,this._renderInternalMerged(g,k,this._bindParameters,Infinity)))}};a.prototype._renderGeometryPassOrdered=function(a){var b=a.camera;this._bindParameters.view=b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;
m[0]=b.near;m[1]=b.far;this._bindParameters.nearFar=m;this._bindParameters.lightingData=this._lighting.getOld();this._bindParameters.viewport=b.fullViewport;this._bindParameters.framebufferTex=this._framebuffer.texture;this._bindParameters.pixelRatio=this._pixelRatio;this._bindParameters.instanceParameters=void 0;this._bindParameters.depthFBO=this._linearDepthTextureHelper.getDepthFBO();this._bindParameters.normalFBO=this._normalTextureHelper.getNormalFBO();a.isHighlightPass?this._renderGeometryPassOrderedHighlight(a):
this._renderGeometryPassOrderedMaterial(a)};a.prototype._renderOrdered=function(a,b){this._stats.reset();this.renderGeometryPass(a,b);this._framesRendered++};a.prototype.render=function(a,b,d,e,c,g){this._orderedRendering?this._renderOrdered(y.MATERIAL,a):this._renderUnordered(a,b,d,e,g,c)};a.prototype.renderAuxiliaryBuffers=function(a,b,d,e,c){c=this.ssaoEnabled;this._linearDepthTextureHelper.setEnableState(c);c&&(this._linearDepthTextureHelper.setupFBOs(a),this._linearDepthTextureHelper.prepareDepthPass(),
this.renderGeometryPass(y.MATERIAL_DEPTH,a,b,d),this._linearDepthTextureHelper.finish(e));this._normalTextureHelper.setEnableState(this.ssaoEnabled);this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(a),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(y.MATERIAL_NORMAL,a,b,d),this._normalTextureHelper.finish(e));this.ssaoEnabled&&d.computeSSAO(a,e,this._linearDepthTextureHelper.getDepthFBO(),this._normalTextureHelper.getNormalFBO());d.bindAll(this._programRep)};a.prototype.renderGeometryPass=
function(a,b,d,e){this._isRendering=!0;this._updateGlobalUniforms(b.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=b;this._renderContext.shadowMap=d;this._renderContext.ssaoHelper=e;this._renderContext.depth=this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._renderContext.rctx=this._rctx;this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext);
this._isRendering=!1};a.prototype._renderGeometryPassUnordered=function(a){this.renderGeometrySlots(a)};a.prototype._renderInternalHighlights=function(a,b){void 0===b&&(b=null);for(var d=0;d<a.length;++d){var e=a[d],c=e.matData[y.MATERIAL_HIGHLIGHT];!c||null!==b&&!c.beginSlot(b)||c.isVisible&&!c.isVisible()||this._renderInternalHighlight(e,this._bindParameters,y.MATERIAL_HIGHLIGHT)}};a.prototype._renderInternalSlotMaterial=function(a,b){for(var d in this._mat2dataInstanced){var c=this._mat2dataInstanced[d],
g=c[b.pass];g&&g.beginSlot(a)&&(!g.isVisible||g.isVisible())&&this._renderInternalInstanced(c,g,this._bindParameters,a)}for(var c=this._programRep.getProgramsUsingUniform("model"),g=this._programRep.getProgramsUsingUniform("modelNormal"),k=0;k<c.length;k++){var h=c[k];h.setUniformMatrix4fv("model",e);-1<g.indexOf(h)&&h.setUniformMatrix4fv("modelNormal",e)}for(d in this._mat2dataMerged)c=this._mat2dataMerged[d],(g=c[b.pass])&&g.beginSlot(a)&&(!g.isVisible||g.isVisible())&&this._renderInternalMerged(c,
g,this._bindParameters,a);a===z.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish()};a.prototype._renderInternalSlotHighlights=function(a,b){this._renderInternalHighlights(this._highlights,a)};a.prototype._renderInternalSlot=function(a,b){this._bindParameters.view=b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;
this._bindParameters.poiDistance=b.camera.distance;m[0]=b.camera.near;m[1]=b.camera.far;var d=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=m;this._bindParameters.lightingData=this._lighting.getOld();this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.framebufferTex=d?d.getColorTexture():null;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.getEnableState();this._bindParameters.ssaoEnabled=
!!b.ssaoHelper&&b.ssaoHelper.getEnableState();this._bindParameters.pixelRatio=this._pixelRatio;this._bindParameters.instanceParameters=void 0;this._bindParameters.depthFBO=this._linearDepthTextureHelper.getDepthFBO();this._bindParameters.hudVisibilityTexture=d?d.getHUDVisibilityTexture():null;b.isHighlightPass?this._renderInternalSlotHighlights(a,b):this._renderInternalSlotMaterial(a,b)};a.prototype._renderInternalInstanced=function(a,b,d,e){var c=this._rctx,g=c.gl,k=!1,h=b.getDrawMode(c),f=this._bindParameters.extensions.angleInstancedArrays,
m;for(m in a.origin2data){var l=a.origin2data[m];d.origin=l.origin;e===z.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());var n=!1;if(b.instanced)for(var q in l.perGeometryDataInfo){var p=l.perGeometryDataInfo[q];k||(b.bind(c,d),k=!0);c.bindVAO(p.vao);var u=b.getProgram();K.assertCompatibleVertexAttributeLocations(p.vao,u);n||(b.bindView(c,d),n=!0);var u=p.to-p.from,t=p.refCount;h===g.TRIANGLES&&(this._stats.trianglesRendered+=
t*u/3);f.drawArraysInstancedANGLE(h,p.from,u,t);this._stats.drawCallsAngleInstanced++;this._stats.instancesDrawnAngle+=t}else{var p=l.instances,w;for(w in p)u=p[w],t=u.displayedIndexRange,t&&0===t.length||(k||(b.bind(c,d),k=!0),n||(c.bindVAO(l.vao),b.bindView(c,d),n=!0),b.bindInstance(c,u),this._stats.drawCallsInstanced++,h===g.TRIANGLES&&(this._stats.trianglesRendered+=(u.to-u.from)/3),t?this._drawArraysFaceRange(t,u.from,h):c.drawArrays(h,u.from,u.to-u.from))}}c.bindVAO(null);k&&b.release(c,d)};
a.prototype._renderInternalHighlight=function(a,b,d){var c=this._rctx,g=c.gl;d=a.matData[d];var k=d.getDrawMode(c),h=a.instance,f=h.highlightedIndexRange,m=this._renderContext.offscreenRenderingHelper,m=(m?m.getDepthTexture():null)||this._getFallbackDepthTexture(),l=d.getProgram(),n=this._bindParameters.extensions.angleInstancedArrays;b.origin=a.originData.origin;if(d.instanced&&"instanced"===a.type){var q=a.instancedVAO;d.bind(c,b);c.bindVAO(q);K.assertCompatibleVertexAttributeLocations(q,l);d.bindView(c,
b);for(a=0;a<f.length;a++){var p=f[a],q=p.range?p.range[0]+h.from:h.from,p=p.range?p.range[1]-p.range[0]+1:h.to-h.from;c.bindTexture(m,5);l.setUniform1i("depthTex",5);l.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);n.drawArraysInstancedANGLE(k,q,p,1);k===g.TRIANGLES&&(this._stats.trianglesRendered+=1*p/3);this._stats.drawCallsHighlight++}}else if("merged"===a.type||"instanced"===a.type&&!d.instanced)for(q=a.originData.vao,d.bind(c,
b),c.bindVAO(q),d.bindView(c,b),"instanced"===a.type?d.bindInstance(c,h):l.setUniformMatrix4fv("model",e),a=0;a<f.length;a++)p=f[a],q=p.range?p.range[0]+h.from:h.from,p=p.range?p.range[1]-p.range[0]+1:h.to-h.from,c.bindTexture(m,5),d.getProgram().setUniform1i("depthTex",5),l.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),c.drawArrays(k,q,p),k===g.TRIANGLES&&(this._stats.trianglesRendered+=p/3),this._stats.drawCallsHighlight++;else console.error("_renderInternalHighlight: incompatible istance type");
c.bindVAO(null);d.release(c,b)};a.prototype._drawArraysFaceRange=function(a,b,d){for(var e=this._rctx,c=0;c<a.length;c++){var g=a[c];e.drawArrays(d,g[0]+b,g[1]-g[0]+1)}this._stats.drawCallsFragmented+=a.length-1};a.prototype._renderInternalMerged=function(a,b,d,e){var c=this._rctx,g=c.gl,k=!1,h;for(h in a.origin2data){var f=a.origin2data[h];d.origin=f.origin;e===z.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());if(!f.displayedIndexRange||
0!==f.displayedIndexRange.length){k||(b.bind(c,d),k=!0);var m=b.getProgram();c.bindVAO(f.vao);K.assertCompatibleVertexAttributeLocations(f.vao,m);b.bindView(c,d);this._stats.drawCallsMerged++;m=b.getDrawMode(c);m===g.TRIANGLES&&(this._stats.trianglesRendered+=f.vao.vertexBuffers.geometry.size/3);f.displayedIndexRange?this._drawArraysFaceRange(f.displayedIndexRange,0,m):c.drawArrays(m,0,K.vertexCount(f.vao,"geometry"))}}k&&b.release(c,d)};a.prototype._updateGlobalUniforms=function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),
d=0;d<b.length;d++)b[d].setUniformMatrix4fv("proj",a);if(this._lighting){b=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(d=0;d<b.length;d++)this._lighting.setUniforms(b[d]);b=this._programRep.getProgramsUsingUniform("lightDirection");for(d=0;d<b.length;d++)this._lighting.setUniforms(b[d])}};a.prototype.print=function(){var a=Object.keys(this._mat2dataMerged).length,b=Object.keys(this._mat2dataInstanced).length;console.log("number of materials (merged/instanced): "+a+"/"+b);
var a=0,d;for(d in this._mat2dataMerged){var b=this._mat2dataMerged[d],e;for(e in b.origin2data)a+=Object.keys(b.origin2data[e].instances).length}var c=0;for(d in this._mat2dataInstanced)for(e in b=this._mat2dataInstanced[d],b.origin2data)c+=Object.keys(b.origin2data[e].instances).length;console.log("number of instances (merged/instanced): "+a+"/"+c)};a.prototype.isEmpty=function(){for(var a in this._mat2dataInstanced){var b=this._mat2dataInstanced[a],d;for(d in b.origin2data)if(!T(b.origin2data[d].instances))return!1}for(a in this._mat2dataMerged)for(d in b=
this._mat2dataMerged[a],b.origin2data)if(!T(b.origin2data[d].instances))return!1;return!0};a.prototype.modify=function(a,b,d,e){this._isRendering&&console.warn("Renderer.modify called while rendering");var c=[],g=[];this._mergedOrInstanced(a,c,g);a=[];var k=[];this._mergedOrInstanced(b,a,k);var h={};d&&this._performUpdates(d,h);d=[];this._modifyMerged(c,a,d,h);this._modifyInstanced(g,k,d);this._updateMergedFaceranges(h);this._releaseMaterials(d);c=this._highlights.length;if(b&&0<b.length&&0<c&&(this._highlights=
this._highlights.filter(function(a){return!b.some(function(b){return b.uniqueName===a.uniqueName})}),c!==this._highlights.length&&this.onHasHighlightsChanged))this.onHasHighlightsChanged(this.hasHighlights);this._updateHighlightVAOs();this._modifyMaterials(e);this._needsRender=!0};a.prototype._isInstanced=function(a){var b=!1,d=U(a.data.faces.indices).length,b=(b=(b=b||!1===a.material.canBeMerged)||a.material.instanced)||a.material.isBackdrop;return a.singleUse?b:b=b||d>this._threshold};a.prototype._mergedOrInstanced=
function(a,b,d){for(var e=0;e<a.length;++e)1>U(a[e].data.faces.indices).length||(this._isInstanced(a[e])?d.push(a[e]):b.push(a[e]))};a.prototype._performUpdates=function(a,b){for(var d=0;d<a.length;d++){var e=a[d],c=e.renderGeometry,g=this._isInstanced(c),e=e.updateType;e&2&&this._updateFaceranges(c,g,b);if(e&32){var k=this._getInstance(c,g);k&&this._updateHighlightFaceranges(c,k.instance)}e&4||!g&&e&16?this._updateVertexAttributes(c,g):g&&e&16?this._updateInstanceTransformation(c,g):e&8&&this._updateColorAttributes(c)}};
a.prototype._updateFaceranges=function(a,b,d){var e=a.material.getId(),c=a.origin.id,g=(b?this._mat2dataInstanced:this._mat2dataMerged)[e].origin2data[c],k=g.instances[a.uniqueName];k&&(k.displayedIndexRange=n.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets),b||(d[this._modifiedMergedFacerangesKey(e,c)]=g),this._updateHighlightFaceranges(a,k))};a.prototype._updateHighlightFaceranges=function(a,b){if(b){var d=b.highlightedIndexRange,e;e=n.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,
a.instanceParameters.componentHighlights,a.componentOffsets);(b.highlightedIndexRange=e)&&!d?this._addHighlight(a):!e&&d&&this._removeHighlight(a)}};a.prototype._updateMergedFaceranges=function(a){for(var b in a){var d=a[b];d.displayedIndexRange=[];var e=d.instances,c=!0,g;for(g in e){var k=e[g];k.displayedIndexRange?(d.displayedIndexRange.push.apply(d.displayedIndexRange,f.offsetIntervals(k.displayedIndexRange,k.from)),c=!1):d.displayedIndexRange.push([k.from,k.to-1])}d.displayedIndexRange=c?null:
f.mergeIntervals(d.displayedIndexRange)}};a.prototype._updateVertexAttributes=function(a,b){var d=a.material,e=d.getId(),e=(b?this._mat2dataInstanced:this._mat2dataMerged)[e].origin2data[a.origin.id],c=e.instances[a.uniqueName],g,k;b||(g=a.origin.vec3,W(v,-g[0],-g[1],-g[2]),ca.multiply(v,a.transformation,D),ca.inverse(D,L),ca.transpose(L),g=D,k=L);b=K.getStride(d.getVertexBufferLayout());var h=b/4;O(c.from+d.getOutputAmount(U(a.data.faces.indices).length)/h===c.to,"material VBO layout has changed");
d.fillInterleaved(a.data,g,k,a.instanceParameters,e.buffer.getArray(),c.from*h);e.vao.vertexBuffers.geometry.setSubData(e.buffer.getArray(),c.from*b,c.from*b,c.to*b)};a.prototype._updateInstanceTransformation=function(a,b){var d=a.origin.vec3,e=(b?this._mat2dataInstanced:this._mat2dataMerged)[a.material.getId()].origin2data[a.origin.id];b=e.instances[a.uniqueName];W(v,-d[0],-d[1],-d[2]);ca.multiply(v,a.transformation,b.transformation);ca.inverse(b.transformation,b.transformationNormal);ca.transpose(b.transformationNormal,
b.transformationNormal);d=e.perGeometryDataInfo[a.data.id];if(e=d.instanceBufferData)a=e.getSlot(a.idx),e.fill(a,0,b.transformation),e.fill(a,16,b.transformationNormal),a=4*e.getOffset(a),b=K.getStride(d.vao.layout.instance),d.vao.vertexBuffers.instance.setSubData(e.getArray(),a,a,a+b)};a.prototype._updateColorAttributes=function(a){var b=a.material,d=b.getId(),e=a.origin.id,d=(this._isInstanced(a)?this._mat2dataInstanced:this._mat2dataMerged)[d].origin2data[e],e=d.instances[a.uniqueName],c=(g={},
g[V.COLOR]=!0,g[V.SYMBOLCOLOR]=!0,g),g=K.getStride(b.getVertexBufferLayout())/4;O(e.from+b.getOutputAmount(U(a.data.faces.indices).length)/g===e.to,"material VBO layout has changed");b.fillInterleaved(a.data,void 0,void 0,a.instanceParameters,d.buffer.getArray(),e.from*g,c);d.vao.vertexBuffers.geometry.setSubData(d.buffer.getArray(),e.from*g*4,e.from*g*4,e.to*g*4);var g};a.prototype._modifyMerged=function(a,d,e,c){var k=this._rctx;a=this._compMat2delta(a,d,!1);for(var h in a){d=a[h];for(var f in d){var m=
d[f],l=m.optimalCount,q=m.material,p=q.getVertexBufferLayout(),u=K.getStride(p)/4,t=this._mat2dataMerged[h];if(null==t){O(0<l);var w=q.getRenderPriority(),t={origin2data:{}};t[y.MATERIAL]=this._materialRep.aquire(q);t[y.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(q);t[y.MATERIAL_NORMAL]=this._materialRep.aquireNormal(q);t[y.MATERIAL_DEPTH]=this._materialRep.aquireDepth(q);t[y.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(q);this._mat2dataMerged[h]=t;this._orderedRendering&&
this._insertIntoRenderOrder(t,w,"merged")}w=t.origin2data[f];null==w&&(O(0<l),w={instances:{},vao:new x(k,Q.Default3D,{geometry:p},{geometry:I.createVertex(k,35044)}),buffer:new b(l),optimalCount:0,origin:m.origin},t.origin2data[f]=w);if(0<l){var p=w.buffer.getSize(),z=w.buffer.getArray(),t=l<m.sparseCount/2,C=w.buffer.resize(t?l:m.sparseCount),A=m.toRemove;if(t||C){for(var p=0,r=w.buffer.getArray(),t=0;t<A.length;++t)C=w.instances[A[t].uniqueName],w.optimalCount-=(C.to-C.from)*u,delete w.instances[A[t].uniqueName];
var t={},E;for(E in w.instances)C=w.instances[E],O(null==t[C.from]),t[C.from]=C;for(var J in t){var C=t[J],G=C.from*u,N=C.to*u;r.set(z.subarray(G,N),p);C.from=p/u;p+=N-G;C.to=p/u}O(p===w.optimalCount)}else for(t=0;t<A.length;++t)C=A[t].uniqueName,O(void 0!==w.instances[C]),G=w.instances[C].from*u,N=w.instances[C].to*u,w.buffer.erase(G,N),delete w.instances[C],w.optimalCount-=N-G;W(v,-m.origin[0],-m.origin[1],-m.origin[2]);z=m.toAdd;m=!1;for(t=0;t<z.length;++t)A=z[t],G=A.data,ca.multiply(v,A.transformation,
D),ca.inverse(D,L),ca.transpose(L),C=p,q.fillInterleaved(G,D,L,A.instanceParameters,w.buffer.getArray(),p),G=q.getOutputAmount(U(G.faces.indices).length),r=C+G,O(null==w.instances[A.uniqueName]),N=n.generateVisibleIndexRanges(A.instanceParameters.componentVisibilities,A.componentOffsets),C=new g(A.name,C/u,r/u,N,void 0,void 0,A.idx),w.instances[A.uniqueName]=C,this._updateHighlightFaceranges(A,C),N&&(m=!0),w.optimalCount+=G,p+=G;O(w.optimalCount===l);l=new Float32Array(w.buffer.getArray().buffer,
0,w.buffer.getSize());w.vao.vertexBuffers.geometry.setData(l);if(m||w.displayedIndexRange)c[this._modifiedMergedFacerangesKey(h,f)]=w}else O(0===l),w.vao.dispose(!0),w.vao=null,delete t.origin2data[f],0===Object.keys(t.origin2data).length&&(e.push(h),delete this._mat2dataMerged[h],this._orderedRendering&&this._removeFromRenderOrder(t,"merged"))}}};a.prototype._modifyInstanced=function(a,d,e){a=this._compMat2delta(a,d,!0);d=this._rctx;for(var k in a){var h=a[k],f;for(f in h){var m=h[f];if(0===m.optimalCount)m=
this._mat2dataInstanced[k],m.origin2data[f].vao.dispose(!0),delete m.origin2data[f],0===Object.keys(m.origin2data).length&&(e.push(k),delete this._mat2dataInstanced[k],this._orderedRendering&&this._removeFromRenderOrder(m,"instanced"));else{var l=m.material,q=this._mat2dataInstanced[k];if(null==q){var p=l.getRenderPriority(),q={origin2data:{}};q[y.MATERIAL]=this._materialRep.aquire(l);q[y.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(l);q[y.MATERIAL_NORMAL]=this._materialRep.aquireNormal(l);
q[y.MATERIAL_DEPTH]=this._materialRep.aquireDepth(l);q[y.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(l);this._mat2dataInstanced[k]=q;this._orderedRendering&&this._insertIntoRenderOrder(q,p,"instanced")}var u=l.getVertexBufferLayout(),t=q[y.MATERIAL].instanced?l.getInstanceBufferLayout():void 0,w=t&&K.findAttribute(t,"instanceColor"),z=t&&K.findAttribute(t,"instanceFeatureAttribute"),C=K.getStride(u)/4,p=q.origin2data[f];null==p&&(p={instances:{},vao:new x(d,Q.Default3D,{geometry:u},{geometry:I.createVertex(d,
35044)}),buffer:new b(m.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:m.origin},q.origin2data[f]=p);var q=p.buffer.getSize(),A=p.buffer.getArray(),r=m.optimalCount<m.sparseCount/2,E=p.buffer.resize(r?m.optimalCount:m.sparseCount),J;for(J in m.perGeometryDelta){var D=p.perGeometryDataInfo[J];if(D&&D.instanceBufferData){var G=m.perGeometryDelta[J].removeCount;0<G&&D.instanceBufferData.prepareFree(G)}}var N=m.toRemove;if(r||E){for(r=0;r<N.length;++r){E=N[r];delete p.instances[E.uniqueName];
J=E.data.id;var M=D=p.perGeometryDataInfo[J];0===--M.refCount&&null==m.dataId2refCount[J]?(p.optimalCount-=(M.to-M.from)*C,delete p.perGeometryDataInfo[J]):D.instanceBufferData&&D.instanceBufferData.free(E.idx)}var q=0,r=p.buffer.getArray(),E={},L;for(L in p.perGeometryDataInfo)M=p.perGeometryDataInfo[L],O(null==E[M.from]),E[M.from]=M;for(var B in E)M=E[B],G=M.from*C,D=M.to*C,r.set(A.subarray(G,D),q),M.from=q/C,q+=D-G,M.to=q/C;for(var P in p.instances)G=p.instances[P],G.from=p.perGeometryDataInfo[G.dataId].from,
G.to=p.perGeometryDataInfo[G.dataId].to}else for(r=0;r<N.length;++r)E=N[r],delete p.instances[E.uniqueName],J=E.data.id,D=p.perGeometryDataInfo[J],0===--D.refCount&&null==m.dataId2refCount[J]?(G=D.from*C,D=D.to*C,p.buffer.erase(G,D),p.optimalCount-=D-G,delete p.perGeometryDataInfo[J]):D.instanceBufferData&&D.instanceBufferData.free(E.idx);W(v,-m.origin[0],-m.origin[1],-m.origin[2]);for(J in m.perGeometryDelta)(D=p.perGeometryDataInfo[J])&&D.instanceBufferData&&(r=m.perGeometryDelta[J].addCount,0<
r&&D.instanceBufferData.prepareAllocate(r));A=m.toAdd;for(r=0;r<A.length;++r)if(E=A[r],G=E.data,J=G.id,D=p.perGeometryDataInfo[J],null==D?(l.fillInterleaved(G,void 0,void 0,void 0,p.buffer.getArray(),q),N=l.getOutputAmount(U(G.faces.indices).length),G=q/C,q+=N,D=q/C,p.optimalCount+=N,D={refCount:1,from:G,to:D,vao:null,instanceBufferData:null},t&&(G=K.getStride(t)/4,D.vao=new x(d,Q.Default3D,{geometry:u,instance:t},{geometry:p.vao.vertexBuffers.geometry,instance:I.createVertex(d,35044)}),D.instanceBufferData=
new c(G,m.perGeometryDelta[J].addCount)),p.perGeometryDataInfo[J]=D):++D.refCount,O(D.from*C<=p.buffer.getSize()&&D.to*C<=p.buffer.getSize()),G=ca.create(),ca.multiply(v,E.transformation,G),N=n.generateVisibleIndexRanges(E.instanceParameters.componentVisibilities,E.componentOffsets),G=new g(E.name,D.from,D.to,N,G,E.instanceParameters,E.idx,J),p.instances[E.uniqueName]=G,this._updateHighlightFaceranges(E,G),D=D.instanceBufferData)N=D.allocate(E.idx),D.fill(N,0,G.transformation),D.fill(N,16,G.transformationNormal),
w&&D.fill(N,w.offset/4,E.instanceParameters.color),z&&D.fill(N,z.offset/4,E.instanceParameters.featureAttribute);O(p.optimalCount===m.optimalCount);l=new Float32Array(p.buffer.getArray().buffer,0,p.buffer.getSize());p.vao.vertexBuffers.geometry.setData(l);for(J in p.perGeometryDataInfo)if(u=p.perGeometryDataInfo[J],u.vao&&(l=u.vao.vertexBuffers.instance))t=m.perGeometryDelta[J],0<t.addCount+t.removeCount&&(u=u.instanceBufferData.compact(),l.setData(u))}}}};a.prototype._compMat2delta=function(a,b,
d){var e={};this._updateMat2delta(a,!0,d,e);this._updateMat2delta(b,!1,d,e);return e};a.prototype._updateMat2delta=function(a,b,d,e){for(var c=0;c<a.length;++c){var g=a[c],k=g.origin,h=g.material,f=h.getId(),m=d?this._mat2dataInstanced[f]:this._mat2dataMerged[f],m=m&&m.origin2data[k.id],l=e[f];null==l&&(l={},e[f]=l);f=l[k.id];if(null==f){f={optimalCount:null==m?0:m.optimalCount,sparseCount:null==m?0:m.buffer.getSize(),material:h,toAdd:[],toRemove:[],perGeometryDelta:null,origin:k.vec3};if(d){var n=
{};if(void 0!==m)for(var q in m.perGeometryDataInfo)n[q]=m.perGeometryDataInfo[q].refCount;f.dataId2refCount=n;f.perGeometryDelta={}}l[k.id]=f}k=h.getOutputAmount(U(g.data.faces.indices).length);d?(h=g.data.id,m=f.perGeometryDelta[h],m||(m={addCount:0,removeCount:0},f.perGeometryDelta[h]=m),b?(m.addCount++,null==f.dataId2refCount[h]&&(f.dataId2refCount[h]=0),1===++f.dataId2refCount[h]&&(f.optimalCount+=k,f.sparseCount+=k),f.toAdd.push(g)):(m.removeCount++,0===--f.dataId2refCount[h]&&(delete f.dataId2refCount[h],
f.optimalCount-=k),f.toRemove.push(g))):b?(f.optimalCount+=k,f.sparseCount+=k,f.toAdd.push(g)):(f.optimalCount-=k,f.toRemove.push(g))}};a.prototype._modifiedMergedFacerangesKey=function(a,b){return a+"_"+b};a.prototype._insertIntoRenderOrder=function(a,b,d){for(var e=a[y.MATERIAL].getMaterialId(),c=this._renderOrder.length,g=0;g<c&&this._renderOrder[g][0]>=b;){var k=this._renderOrder[g][1];if(k.id===e){O(!k[d],"matData for type already exists");k[d]=a;return}g++}e={id:e,instanced:null,merged:null};
e[d]=a;this._renderOrder.splice(g,0,[b,e])};a.prototype._removeFromRenderOrder=function(a,b){var d=a[y.MATERIAL].getMaterialId();for(a=0;this._renderOrder[a][1].id!==d;)a++;d=this._renderOrder[a][1];d[b]=null;d.instanced||d.merged||this._renderOrder.splice(a,1)};a.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(a,b){a=a.matData[y.MATERIAL].getRenderPriority();b=b.matData[y.MATERIAL].getRenderPriority();return a>b?-1:b>a?1:0})};a.prototype._updateRenderOrder=function(a,
b){for(var d=b.length,e=0;e<d&&b[e][1].id!==a;)e++;if(e<d){a=b[e][1];a=(a.merged||a.instanced)[y.MATERIAL].getRenderPriority();var c=b[e][0];if(a!==b[e][0])for(b[e][0]=a,c=a>c?-1:1,e+=c;-1<e&&e<d&&c*b[e][0]>c*a;){var g=b[e];b[e]=b[e-c];b[e-c]=g;e+=c}}};a.prototype._modifyMaterials=function(a){for(var b in a)this._materialRep.updateMaterialParameters(b)};a.prototype.modifyRenderOrder=function(a){if(this._orderedRendering){for(var b in a)this._updateRenderOrder(b,this._renderOrder);this._sortHighlightsByRenderOrder();
this._needsRender=!0}};a.prototype._releaseMaterials=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._materialRep.release(a[b]),this._materialRep.releaseDepthShadowMap(a[b]),this._materialRep.releaseNormal(a[b]),this._materialRep.releaseDepth(a[b]),this._materialRep.releaseHighlight(a[b]);else this._materialRep.release(a),this._materialRep.releaseDepthShadowMap(a),this._materialRep.releaseNormal(a),this._materialRep.releaseDepth(a),this._materialRep.releaseHighlight(a)};a.prototype._getInstance=
function(a,b){var d=a.material.getId(),d=(b?this._mat2dataInstanced:this._mat2dataMerged)[d];if(!d)return null;var e=d.origin2data[a.origin.id];if(!e)return null;var c=e.instances[a.uniqueName];return c?{uniqueName:a.uniqueName,instance:c,matData:d,originData:e,type:b?"instanced":"merged",instancedVAO:null,instancedVAOBaseInstance:null}:null};a.prototype._createBaseInstanceVAO=function(a){var b=this._rctx,d=a.instance;if("instanced"===a.type&&a.originData.perGeometryDataInfo){var e=a.originData.perGeometryDataInfo[d.dataId],
c=e.instanceBufferData;c&&(e=e.vao,d=c.getSlot(d.idx),a.instancedVAOBaseInstance!==d&&(c=K.setBaseInstanceOffset(e.layout,d),a.instancedVAO=new x(b,e.locations,c,e.vertexBuffers,e.indexBuffer),a.instancedVAOBaseInstance=d))}};a.prototype._updateHighlightVAOs=function(){for(var a=0;a<this._highlights.length;++a)this._createBaseInstanceVAO(this._highlights[a])};a.prototype._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new A(this._rctx,{target:3553,
pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};return a}();var d=function(){function a(){this.reset()}a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0};return a}(),g=function(){return function(a,
b,d,e,c,g,k,h){this.name=a;this.from=b;this.to=d;this.displayedIndexRange=e;this.transformation=c;this.instanceParameters=g;this.idx=k;this.dataId=h;null!=c&&(this.transformationNormal=ca.create(),ca.set(c,this.transformationNormal),ca.inverse(this.transformationNormal,this.transformationNormal),ca.transpose(this.transformationNormal,this.transformationNormal))}}(),m=B.create(),v=ca.identity(),D=ca.create(),L=ca.create();return E})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require",
"exports"],function(B,r){return function(){function f(){}f.copyIntervals=function(a){for(var b=[],c=0;c<a.length;c++){var f=a[c];b.push([f[0],f[1]])}return b};f.convertFaceToIndexRange=function(a,b){for(var c=0;c<a.length;c++){var f=a[c];f[0]*=b;f[1]=f[1]*b+(b-1)}};f.sortIntervals=function(a){return a.sort(function(a,c){return a[0]===c[0]?a[1]>c[1]?1:a[1]<c[1]?-1:0:a[0]>c[0]?1:a[0]<c[0]?-1:0})};f.intersectIntervals=function(a,b){if(0>=a.length)return[];for(var c=[],f=0;f<a.length;f++){var p=a[f];
p[1]<b[0]||p[0]>b[1]||(p=[p[0],p[1]],p[0]<b[0]&&(p[0]=b[0]),p[1]>b[1]&&(p[1]=b[1]),c.push(p))}return c};f.mergeIntervals=function(a){if(0>=a.length)return[];var b=[];a=this.sortIntervals(a);b.push(a[0]);for(var c=1;c<a.length;c++){var f=b[b.length-1];f[1]+1<a[c][0]?b.push(a[c]):f[1]<a[c][1]&&(f[1]=a[c][1],b.pop(),b.push(f))}return b};f.invertIntervals=function(a,b){for(var c=[],f=0,p=0;p<a.length;p++){var h=a[p];h[0]>f&&c.push([f,h[0]-1]);f=h[1]+1}f<=b&&c.push([f,b]);return c};f.offsetIntervals=function(a,
b){for(var c=[],f=0;f<a.length;f++){var p=a[f];c.push([p[0]+b,p[1]+b])}return c};return f}()})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","./Util"],function(B,r,f){return function(){function a(a){null==a?a=16:65536>a&&(a=f.nextHighestPowerOfTwo(a));this.array=new Float32Array(a);this.size=0}a.prototype.resize=function(a,c){void 0===c&&(c=!1);this.size=a;var b;if(this.size>this.array.length){for(a=this.array.length||1;a<this.size;)a*=2;b=new Float32Array(a);
c&&b.set(this.array);this.array=b;return!0}if(this.size<=this.array.length/2){a=this.array.length;for(b=2*this.size;a>=b;)a=Math.floor(a/2);b=new Float32Array(a);c&&b.set(this.array.subarray(0,a));this.array=b;return!0}return!1};a.prototype.append=function(a){var b=this.size;this.resize(this.size+a.length,!0);this.array.set(a,b)};a.prototype.erase=function(a,c){for(;a<c;++a)this.array[a]=0};a.prototype.getArray=function(){return this.array};a.prototype.getSize=function(){return this.size};return a}()})},
"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","./Util"],function(B,r,f){return function(){function a(a,c){null==c&&(c=4);var b=f.nextHighestPowerOfTwo(c*a);this.array=new Float32Array(b);this.zeroItem=new Float32Array(a);this.endSlot=0;this.perInstanceDataSize=a;this.emptySlots=[];this.emptySlotsIdx=0;this.id2slot={};this.slot2id=Array(c)}a.prototype.prepareFree=function(a){this.emptySlots.length+=a};a.prototype.free=function(a){a=this.id2slot[a];null!=
a&&(this.emptySlots[this.emptySlotsIdx++]=a,this.slot2id[a]=void 0)};a.prototype.prepareAllocate=function(a){a-=this.emptySlotsIdx;0<a&&this._resizeArray((this.endSlot+a)*this.perInstanceDataSize)};a.prototype.allocate=function(a){var b;b=0<this.emptySlotsIdx?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++;this.id2slot[a]=b;this.slot2id[b]=a;return b};a.prototype.getSlot=function(a){return this.id2slot[a]};a.prototype.getOffset=function(a){return a*this.perInstanceDataSize};a.prototype.getArray=
function(){return this.array};a.prototype.fill=function(a,c,f){this.array.set(f,a*this.perInstanceDataSize+c)};a.prototype.compact=function(){if(0<this.emptySlotsIdx){this.emptySlots.length=this.emptySlotsIdx;for(this.emptySlots.sort(function(a,b){return a-b});0<this.emptySlotsIdx&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;0<this.emptySlotsIdx;){this.emptySlotsIdx--;var a=this.endSlot-1,c=this.emptySlots[this.emptySlotsIdx],f=a*this.perInstanceDataSize,
p=c*this.perInstanceDataSize;this.array.set(this.array.subarray(f,f+this.perInstanceDataSize),p);this.array.set(this.zeroItem,f);f=this.slot2id[a];this.slot2id[a]=void 0;this.slot2id[c]=f;this.id2slot[f]=c;this.endSlot--}}this._resizeArray(this.endSlot*this.perInstanceDataSize);this.emptySlots.length=0;return this.array};a.prototype._resizeArray=function(a){var b;if(a>this.array.length){for(b=this.array.length||1;b<a;)b*=2;a=new Float32Array(b);a.set(this.array);this.array=a}else if(a<=this.array.length/
2){b=this.array.length;for(a*=2;b>=a;)b/=2;a=new Float32Array(b);a.set(this.array.subarray(0,b));this.array=a}};return a}()})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","./SphericalHarmonics","../../lib/glMatrix"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});var b=a.vec3d,c=a.vec4d,t=b.create();B=function(){function a(){this._renderLighting={main:{intensity:b.create(),direction:b.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],
g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=b.create();this._oldSpecular=c.create();this._oldDiffuse=c.create();this._oldAmbient=c.create()}a.prototype.setUniforms=function(a,b){void 0===b&&(b=!1);b||a.getDefine("GROUND_NORMAL_SHADING")?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction);
a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);b=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",
b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",b.g[1],b.g[2],b.g[3],b.g[4]),a.setUniform4f("lightingAmbientSH_B1",b.b[1],b.b[2],b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],b.b[8]));a.setUniform3fv("lightDirection",this._oldDirection)};a.prototype.set=function(a){this._info=
a;f.combineLights(a.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);b.negate(this._renderLighting.main.direction,this._oldDirection);a=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*a;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*a;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*a;this._oldAmbient[3]=1;this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*a;
this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*a;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*a;this._oldDiffuse[3]=1;a=b.set(this._oldDiffuse,t);b.scale(a,.4*this._info.globalFactor);b.add(this._oldAmbient,a)};Object.defineProperty(a.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});a.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,
helper:this}};return a}();r.SceneLighting=B})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ./Lightsources ../lib/LongVectorMath ../../lib/glMatrix ../../support/mathUtils".split(" "),function(B,r,f,a,b,c){function t(a){return(a+1)*(a+1)}function p(a){return c.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function h(a,b,c){var h=a[0],f=a[1];a=a[2];c=c||[];c.length=t(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*h,c[2]=.4886025119*a,c[3]=.4886025119*f);
2<=b&&(c[4]=1.09254843059*h*f,c[5]=1.09254843059*f*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*h*a,c[8]=.54627421529*(h*h-f*f));return c}function l(a,b){a=t(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function q(b,c){for(var f=p(c.r.length),l=0;l<b.length;l++){var q=b[l];z.negate(q.direction,n);h(n,f,E);a.elementwiseProduct(E,A);a.scalarProduct(E,q.intensity[0],G);a.add(c.r,G);a.scalarProduct(E,q.intensity[1],G);a.add(c.g,G);
a.scalarProduct(E,q.intensity[2],G);a.add(c.b,G)}return c}function y(a,b){h(n,0,E);for(var c=0;c<a.length;c++){var f=a[c];b.r[0]+=E[0]*A[0]*f.intensity[0]*4*Math.PI;b.g[0]+=E[0]*A[0]*f.intensity[1]*4*Math.PI;b.b[0]+=E[0]*A[0]*f.intensity[2]*4*Math.PI}return b}Object.defineProperty(r,"__esModule",{value:!0});var z=b.vec3d;r.numberOfCoefficients=t;r.numberOfCoefficientsInBand=function(a){return 2*a+1};r.orderFromNumberOfCoefficients=p;r.computeCoefficients=h;r.initSHCoefficients=l;r.projectFillLights=
q;r.projectAmbientLights=y;r.combineLights=function(b,c,h,n){l(c,n.sh);z.set3(0,0,0,h.intensity);var p=!1,t=w,x=u;c=C;t.length=0;x.length=0;for(var A=c.length=0;A<b.length;A++){var r=b[A];r instanceof f.MainLight&&!p?(z.set(r.direction,h.direction),h.intensity[0]=r.intensity[0],h.intensity[1]=r.intensity[1],h.intensity[2]=r.intensity[2],h.castShadows=r.castShadows,p=!0):r instanceof f.MainLight||r instanceof f.FillLight?t.push(r):r instanceof f.AmbientLight?x.push(r):r instanceof f.SphericalHarmonicsLight&&
c.push(r)}q(t,n.sh);y(x,n.sh);for(b=0;b<c.length;b++)r=c[b],a.add(n.sh.r,r.sh.r),a.add(n.sh.g,r.sh.g),a.add(n.sh.b,r.sh.b)};var w=[],u=[],C=[],E=[0],G=[0],n=z.create(),A=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.dotProduct=function(f,a){for(var b=0,c=0;c<f.length;c++)b+=f[c]*a[c];return b};r.elementwiseProduct=
function(f,a,b){b=b||f;b.length=f.length;for(var c=0;c<f.length;c++)b[c]=f[c]*a[c];return b};r.scalarProduct=function(f,a,b){b=b||f;b.length=f.length;for(var c=0;c<f.length;c++)b[c]=f[c]*a;return b};r.add=function(f,a,b){b=b||f;b.length=f.length;for(var c=0;c<f.length;c++)b[c]=f[c]+a[c];return b}})},"esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial":function(){define("require exports dojo/text!./SimpleGLMaterial.xml ./MaterialUtil ../../lib/RenderSlot ../../../../webgl/Program ../../../../webgl/enums ../../lib/DefaultVertexAttributeLocations".split(" "),
function(B,r,f,a,b,c,t,p){return function(){function h(b,c,h,f){void 0===f&&(f=4);this.id=a.__GLMaterial_id++;this.program=b.get("simple");this.color=c;this.depthFunc=h;this.drawMode=f}h.prototype.getId=function(){return this.id};h.prototype.beginSlot=function(a){return a===b.INTERNAL_MATERIAL};h.prototype.getProgram=function(){return this.program};h.prototype.bind=function(b,c){b.bindProgram(this.program);this.program.setUniformMatrix4fv("model",a.IDENTITY);this.program.setUniformMatrix4fv("proj",
c.proj);this.program.setUniform4fv("color",this.color);b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(b.gl.SRC_ALPHA,b.gl.ONE_MINUS_SRC_ALPHA,b.gl.ONE,b.gl.ONE_MINUS_SRC_ALPHA);b.setDepthTestEnabled(!0);void 0!==this.depthFunc&&b.setDepthFunction(this.depthFunc)};h.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);a.setBlendingEnabled(!1)};h.prototype.bindView=function(b,c){a.bindView(c.origin,c.view,this.program)};h.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",
b.transformation)};h.prototype.getDrawMode=function(a){return this.drawMode};h.loadShaders=function(a,b,h,t){a._parse(f);a=new c(t,a.vertexShaderSimple,a.fragmentShaderSimple,p.Default3D);h.add("simple",a)};return h}()})},"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject","../../../webgl/enums"],function(B,r,f,a,b){return function(){function b(a){this._rctx=a;this._depthFBO=void 0;this.height=this.width=this.viewportToRestore=
null}b.prototype.setEnableState=function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};b.prototype.getEnableState=function(){return void 0!==this._depthFBO};b.prototype.getDepthFBO=function(){return this._depthFBO};b.prototype.enable=function(){f.assert(!this.getEnableState());this._depthFBO=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};b.prototype.disable=function(){f.assert(this.getEnableState());
this._depthFBO.dispose();this._depthFBO=void 0};b.prototype.setupFBOs=function(a){f.assert(this.getEnableState());this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};b.prototype.prepareDepthPass=function(){f.assert(this.getEnableState());var a=this._rctx,b=a.gl;this._depthFBO.resize(this.width,this.height);a.bindFramebuffer(this._depthFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};b.prototype.finish=
function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};return b}()})},"esri/views/3d/webgl-engine/lib/NormalTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject","../../../webgl/enums"],function(B,r,f,a,b){return function(){function b(a){this.rctx=a;this.normalFBO=void 0;this.height=this.width=this.viewportToRestore=null}b.prototype.setEnableState=
function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};b.prototype.getEnableState=function(){return void 0!==this.normalFBO};b.prototype.getNormalFBO=function(){return this.normalFBO};b.prototype.enable=function(){f.assert(!this.getEnableState());this.normalFBO=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};b.prototype.disable=function(){f.assert(this.getEnableState());
this.normalFBO.dispose();this.normalFBO=void 0};b.prototype.setupFBOs=function(a){f.assert(this.getEnableState());this.viewportToRestore=a=a.viewport;this.width=a[2];this.height=a[3];this.rctx.setViewport(0,0,this.width,this.height)};b.prototype.prepareNormalPass=function(){f.assert(this.getEnableState());var a=this.rctx,b=a.gl;this.normalFBO.resize(this.width,this.height);a.bindFramebuffer(this.normalFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};b.prototype.finish=
function(a){var b=this.rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject","../../../webgl/enums"],function(B,r,f,a,b){return function(){function b(a){this._rctx=a;this.height=this.width=this.viewportToRestore=this.fbo2=this.fbo=null}b.prototype.setEnableState=
function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};b.prototype.getEnableState=function(){return null!==this.fbo};b.prototype.getHighlightFBO=function(){return this.fbo};b.prototype.getBlurFBO=function(){return this.fbo2};b.prototype.enable=function(){f.assert(!this.getEnableState());this.fbo=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};b.prototype.disable=
function(){f.assert(this.getEnableState());this.fbo.dispose();this.fbo=null};b.prototype.setupFBOs=function(a){f.assert(this.getEnableState());this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};b.prototype.prepareHighlightPass=function(){f.assert(this.getEnableState());var a=this._rctx,b=a.gl;this.fbo.resize(this.width,this.height);a.bindFramebuffer(this.fbo);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};
b.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};return b}()})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports","./RenderSlot","./RenderPass"],function(B,r,f,a){return function(){function b(){this.normals=this.lightingData=this.highlight=this.depth=this.camera=null;this.pass=a.MATERIAL;this.shadowMap=null;this.slot=f.BACKGROUND;
this.options=this.rctx=this.framebufferTex=this.stencilRenderingHelper=this.offscreenRenderingHelper=this.ssaoHelper=null}Object.defineProperty(b.prototype,"isHighlightPass",{get:function(){return this.pass===a.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/webgl-engine/lib/ExternalRendererContainer":function(){define(["require","exports","./RenderSlot"],function(B,r,f){return function(){function a(){this.renderersChanged=!1;this.renderers=[];this.slots=[];for(var a=
0;a<f.MAX_SLOTS;++a)this.slots[a]=[]}a.prototype.addRenderer=function(a,c){this.renderers.push(c);for(var b=0;b<a.length;++b)this.slots[a[b]].push(c);this.renderersChanged=!0};a.prototype.removeRenderer=function(a){this.renderers=this.renderers.filter(function(b){return b!==a});for(var b=0;b<this.slots.length;++b)this.slots[b]=this.slots[b].filter(function(b){return b!==a});this.renderersChanged=!0};a.prototype.render=function(a,c){c.slot=a;var b=0;for(a=this.slots[a];b<a.length;b++){var f=a[b];f.render(c)&&
(f.didRender=!0)}};a.prototype.needsRender=function(){if(this.renderersChanged)return!0;for(var a=0,c=this.renderers;a<c.length;a++)if(c[a].needsRender)return!0;return!1};a.prototype.needsHighlight=function(){for(var a=0,c=this.renderers;a<c.length;a++)if(c[a].needsHighlight)return!0;return!1};a.prototype.resetNeedsRender=function(){this.renderersChanged=!1;for(var a=0,c=this.renderers;a<c.length;a++){var f=c[a];f.resetNeedsRender?f.resetNeedsRender():f.didRender&&(f.needsRender=!1,f.didRender=!1)}};
return a}()})},"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":function(){define(["require","exports","./Util","../../../webgl/enums"],function(B,r,f,a){return function(){function a(a){this._enabled=!1;this._rctx=a}a.prototype.enable=function(){this._enabled=!0;this._rctx.setStencilTestEnabled(!0)};a.prototype.disable=function(){this._enabled=!1;this._rctx.setStencilTestEnabled(!1)};a.prototype.getIsSupported=function(){return!!this._rctx.contextAttributes.stencil};a.prototype.setEnableState=
function(a){a?this.enable():this.disable()};a.prototype.getEnableState=function(){return this._enabled};a.prototype.prepareStencilWritePass=function(){f.assert(this.getEnableState());var a=this._rctx;a.setClearStencil(0);a.setStencilFunction(519,1,255);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255)};a.prototype.finish=function(){if(this.getEnableState()){var a=this._rctx;a.setStencilFunction(519,0,0);a.setStencilOp(7680,7680,7680);a.setStencilWriteMask(0)}};a.prototype.enableStencilRead=
function(){this.getEnableState()&&this._rctx.setStencilFunction(517,1,255)};a.prototype.disableStencilRead=function(){this.getEnableState()&&this._rctx.setStencilFunction(519,0,0)};return a}()})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums".split(" "),function(B,r,f,a,b,c){return function(){function c(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};
this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}c.prototype.enable=function(){if(!this.isEnabled){var c=this.rctx;this.program=new f(c,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);var h=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new a(c,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new b(c,34962,35044,h)});this.isEnabled=!0}};c.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};c.prototype.render=function(a,b){this.enable();var c=this.rctx;c.bindVAO(this.vao);c.bindFramebuffer(b);var h=0,f=0;null!=b?(h=b.descriptor.width,f=b.descriptor.height):
(h=c.gl.canvas.width,f=c.gl.canvas.height);c.bindProgram(this.program);c.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/h,1/f);c.setFaceCullingEnabled(!1);c.drawArrays(4,0,3)};return c}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/FramebufferObject ../../support/imageUtils ../../../webgl/enums".split(" "),
function(B,r,f,a,b,c,t,p,h){return function(){function h(a){this.isEnabled=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}h.prototype.enable=function(){if(!this.isEnabled){var c=this.rctx;this.programEdgeDetect=new f(c,"\n      #define SHADER_NAME SMAA::EdgeDetect\n      precision highp float;\n      precision highp int;\n\n      uniform vec4 uResolution;\n      attribute vec2 vPosition;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[3];\n\n      void SMAAEdgeDetectionVS( vec2 texcoord ) {\n        fOffset[0] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 ); // WebGL port note: Changed sign in W component\n        fOffset[1] \x3d texcoord.xyxy + uResolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component\n        fOffset[2] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 ); // WebGL port note: Changed sign in W component\n      }\n\n      void main() {\n        fTexCoord \x3d (vPosition + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(vPosition, 0, 1);\n        SMAAEdgeDetectionVS( fTexCoord );\n      }",
"\n      #define SHADER_NAME SMAA::EdgeDetect\n      precision highp float;\n      precision highp int;\n\n      #define SMAA_THRESHOLD 0.05\n      #define SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR 2\n      #define SMAA_USE_COLOR_EDGE_DETECTION 0\n\n      uniform sampler2D tColor;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[3];\n\n      vec4 SMAALumaEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {\n        // Calculate the threshold:\n        vec2 threshold \x3d vec2(SMAA_THRESHOLD, SMAA_THRESHOLD);\n\n        // Calculate lumas:\n        vec3 weights \x3d vec3(0.2126, 0.7152, 0.0722);\n        float L \x3d dot(texture2D(colorTex, texcoord).rgb, weights);\n\n        float Lleft \x3d dot(texture2D(colorTex, offset[0].xy).rgb, weights);\n        float Ltop  \x3d dot(texture2D(colorTex, offset[0].zw).rgb, weights);\n\n        // We do the usual threshold:\n        vec4 delta;\n        delta.xy \x3d abs(L - vec2(Lleft, Ltop));\n        vec2 edges \x3d step(threshold, delta.xy);\n\n        // Then discard if there is no edge:\n        if (dot(edges, vec2(1.0, 1.0)) \x3d\x3d 0.0) discard;\n\n        // Calculate right and bottom deltas:\n        float Lright \x3d dot(texture2D(colorTex, offset[1].xy).rgb, weights);\n        float Lbottom  \x3d dot(texture2D(colorTex, offset[1].zw).rgb, weights);\n        delta.zw \x3d abs(L - vec2(Lright, Lbottom));\n\n        // Calculate the maximum delta in the direct neighborhood:\n        vec2 maxDelta \x3d max(delta.xy, delta.zw);\n\n        // Calculate left-left and top-top deltas:\n        float Lleftleft \x3d dot(texture2D(colorTex, offset[2].xy).rgb, weights);\n        float Ltoptop \x3d dot(texture2D(colorTex, offset[2].zw).rgb, weights);\n        delta.zw \x3d abs(vec2(Lleft, Ltop) - vec2(Lleftleft, Ltoptop));\n\n        // Calculate the final maximum delta:\n        maxDelta \x3d max(maxDelta.xy, delta.zw);\n        float finalDelta \x3d max(maxDelta.x, maxDelta.y);\n\n        // Local contrast adaptation:\n        edges.xy *\x3d step(finalDelta, float(SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR) * delta.xy);\n\n        return vec4( edges, 0.0, 0.0 );\n      }\n\n      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {\n        vec2 threshold \x3d vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );\n\n        // Calculate color deltas:\n        vec4 delta;\n        vec3 C \x3d texture2D( colorTex, texcoord ).rgb;\n\n        vec3 Cleft \x3d texture2D( colorTex, offset[0].xy ).rgb;\n        vec3 t \x3d abs( C - Cleft );\n        delta.x \x3d max( max( t.r, t.g ), t.b );\n\n        vec3 Ctop \x3d texture2D( colorTex, offset[0].zw ).rgb;\n        t \x3d abs( C - Ctop );\n        delta.y \x3d max( max( t.r, t.g ), t.b );\n\n        // We do the usual threshold:\n        vec2 edges \x3d step( threshold, delta.xy );\n\n        // Then discard if there is no edge:\n        if ( dot( edges, vec2( 1.0, 1.0 ) ) \x3d\x3d 0.0 )\n            discard;\n\n        // Calculate right and bottom deltas:\n        vec3 Cright \x3d texture2D( colorTex, offset[1].xy ).rgb;\n        t \x3d abs( C - Cright );\n        delta.z \x3d max( max( t.r, t.g ), t.b );\n\n        vec3 Cbottom  \x3d texture2D( colorTex, offset[1].zw ).rgb;\n        t \x3d abs( C - Cbottom );\n        delta.w \x3d max( max( t.r, t.g ), t.b );\n\n        // Calculate the maximum delta in the direct neighborhood:\n        float maxDelta \x3d max( max( max( delta.x, delta.y ), delta.z ), delta.w );\n\n        // Calculate left-left and top-top deltas:\n        vec3 Cleftleft  \x3d texture2D( colorTex, offset[2].xy ).rgb;\n        t \x3d abs( C - Cleftleft );\n        delta.z \x3d max( max( t.r, t.g ), t.b );\n\n        vec3 Ctoptop \x3d texture2D( colorTex, offset[2].zw ).rgb;\n        t \x3d abs( C - Ctoptop );\n        delta.w \x3d max( max( t.r, t.g ), t.b );\n\n        // Calculate the final maximum delta:\n        maxDelta \x3d max( max( maxDelta, delta.z ), delta.w );\n\n        // Local contrast adaptation in action:\n        edges.xy *\x3d step( maxDelta, float(SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR) * delta.xy );\n\n        return vec4( edges, 0.0, 0.0 );\n      }\n\n      void main() {\n        #if SMAA_USE_COLOR_EDGE_DETECTION\n          gl_FragColor \x3d SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );\n        #else\n          gl_FragColor \x3d SMAALumaEdgeDetectionPS( fTexCoord, fOffset, tColor );\n        #endif\n      }",
this.vertexAttributeLocations);this.programBlendWeights=new f(c,"\n      #define SHADER_NAME SMAA::BlendWeights\n      precision highp float;\n      precision highp int;\n\n      #define SMAA_MAX_SEARCH_STEPS 8\n\n      uniform vec4 uResolution;\n      attribute vec2 vPosition;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[3];\n      varying vec2 fPixCoord;\n\n      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {\n        fPixCoord \x3d texcoord * uResolution.zw;\n        fOffset[0] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );\n        fOffset[1] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );\n        fOffset[2] \x3d vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * uResolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );\n      }\n\n      void main() {\n        fTexCoord \x3d (vPosition + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(vPosition, 0, 1);\n        SMAABlendingWeightCalculationVS( fTexCoord );\n      }",
"\n      #define SHADER_NAME SMAA::BlendWeights\n      precision highp float;\n      precision highp int;\n\n      #define SMAA_MAX_SEARCH_STEPS 8\n      #define SMAA_AREATEX_MAX_DISTANCE 16\n      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )\n      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )\n\n      #define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * uResolution.xy, 0.0 )\n\n      uniform sampler2D tEdges;\n      uniform sampler2D tArea;\n      uniform sampler2D tSearch;\n      uniform vec4 uResolution;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[3];\n      varying vec2 fPixCoord;\n\n      vec2 round( vec2 x ) {\n        return sign( x ) * floor( abs( x ) + 0.5 );\n      }\n\n      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {\n        e.r \x3d bias + e.r * scale;\n        return 255.0 * texture2D( searchTex, e, 0.0 ).r;\n      }\n\n      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n        vec2 e \x3d vec2( 0.0, 1.0 );\n        for ( int i \x3d 0; i \x3c SMAA_MAX_SEARCH_STEPS; i ++ ) {\n          e \x3d texture2D( edgesTex, texcoord, 0.0 ).rg;\n          texcoord -\x3d vec2( 2.0, 0.0 ) * uResolution.xy;\n          if ( ! ( texcoord.x \x3e end \x26\x26 e.g \x3e 0.8281 \x26\x26 e.r \x3d\x3d 0.0 ) ) break;\n        }\n        texcoord.x +\x3d 0.25 * uResolution.x;\n        texcoord.x +\x3d uResolution.x;\n        texcoord.x +\x3d 2.0 * uResolution.x;\n        texcoord.x -\x3d uResolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n        return texcoord.x;\n      }\n\n      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n        vec2 e \x3d vec2( 0.0, 1.0 );\n        for ( int i \x3d 0; i \x3c SMAA_MAX_SEARCH_STEPS; i ++ ) {\n          e \x3d texture2D( edgesTex, texcoord, 0.0 ).rg;\n          texcoord +\x3d vec2( 2.0, 0.0 ) * uResolution.xy;\n          if ( ! ( texcoord.x \x3c end \x26\x26 e.g \x3e 0.8281 \x26\x26 e.r \x3d\x3d 0.0 ) ) break;\n        }\n        texcoord.x -\x3d 0.25 * uResolution.x;\n        texcoord.x -\x3d uResolution.x;\n        texcoord.x -\x3d 2.0 * uResolution.x;\n        texcoord.x +\x3d uResolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n        return texcoord.x;\n      }\n\n      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n        vec2 e \x3d vec2( 1.0, 0.0 );\n        for ( int i \x3d 0; i \x3c SMAA_MAX_SEARCH_STEPS; i ++ ) {\n          e \x3d texture2D( edgesTex, texcoord, 0.0 ).rg;\n          texcoord +\x3d vec2( 0.0, 2.0 ) * uResolution.xy;\n          if ( ! ( texcoord.y \x3e end \x26\x26 e.r \x3e 0.8281 \x26\x26 e.g \x3d\x3d 0.0 ) ) break;\n        }\n        texcoord.y -\x3d 0.25 * uResolution.y;\n        texcoord.y -\x3d uResolution.y;\n        texcoord.y -\x3d 2.0 * uResolution.y;\n        texcoord.y +\x3d uResolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );\n        return texcoord.y;\n      }\n\n      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n        vec2 e \x3d vec2( 1.0, 0.0 );\n        for ( int i \x3d 0; i \x3c SMAA_MAX_SEARCH_STEPS; i ++ ) {\n          e \x3d texture2D( edgesTex, texcoord, 0.0 ).rg;\n          texcoord -\x3d vec2( 0.0, 2.0 ) * uResolution.xy;\n          if ( ! ( texcoord.y \x3c end \x26\x26 e.r \x3e 0.8281 \x26\x26 e.g \x3d\x3d 0.0 ) ) break;\n        }\n        texcoord.y +\x3d 0.25 * uResolution.y;\n        texcoord.y +\x3d uResolution.y;\n        texcoord.y +\x3d 2.0 * uResolution.y;\n        texcoord.y -\x3d uResolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );\n        return texcoord.y;\n      }\n\n      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {\n        vec2 texcoord \x3d float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;\n        texcoord \x3d SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );\n        texcoord.y +\x3d SMAA_AREATEX_SUBTEX_SIZE * offset;\n        return texture2D( areaTex, texcoord, 0.0 ).rg;\n      }\n\n      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {\n        vec4 weights \x3d vec4( 0.0, 0.0, 0.0, 0.0 );\n        vec2 e \x3d texture2D( edgesTex, texcoord ).rg;\n        if ( e.g \x3e 0.0 ) {\n          vec2 d;\n          vec2 coords;\n          coords.x \x3d SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );\n          coords.y \x3d offset[ 1 ].y;\n          d.x \x3d coords.x;\n          float e1 \x3d texture2D( edgesTex, coords, 0.0 ).r;\n          coords.x \x3d SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );\n          d.y \x3d coords.x;\n          d \x3d d * uResolution.z - pixcoord.x;\n          vec2 sqrt_d \x3d sqrt( abs( d ) );\n          coords.y -\x3d 1.0 * uResolution.y;\n          float e2 \x3d SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;\n          weights.rg \x3d SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );\n        }\n        if ( e.r \x3e 0.0 ) {\n          vec2 d;\n          vec2 coords;\n          coords.y \x3d SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );\n          coords.x \x3d offset[ 0 ].x;\n          d.x \x3d coords.y;\n          float e1 \x3d texture2D( edgesTex, coords, 0.0 ).g;\n          coords.y \x3d SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );\n          d.y \x3d coords.y;\n          d \x3d d * uResolution.w - pixcoord.y;\n          vec2 sqrt_d \x3d sqrt( abs( d ) );\n          coords.y -\x3d 1.0 * uResolution.y;\n          float e2 \x3d SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;\n          weights.ba \x3d SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );\n\n          // for some reason the following lines are necessary to prevent\n          // texture lookup precision issues on some Intel integrated graphics chips\n          vec4 dbg \x3d (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);\n          weights.r +\x3d 0.00000001 * dot(vec4(0,1,0,1),dbg);\n        }\n        return weights;\n      }\n\n      void main() {\n        gl_FragColor \x3d SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );\n      }",
this.vertexAttributeLocations);this.programBlur=new f(c,"\n      #define SHADER_NAME SMAA::NeighborhoodBlending\n      precision highp float;\n      precision highp int;\n\n      uniform vec4 uResolution;\n      attribute vec2 vPosition;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[2];\n\n      void SMAANeighborhoodBlendingVS( vec2 texcoord ) {\n        fOffset[0] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );\n        fOffset[1] \x3d texcoord.xyxy + uResolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );\n      }\n\n      void main() {\n        fTexCoord \x3d (vPosition + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(vPosition, 0, 1);\n\n        SMAANeighborhoodBlendingVS(fTexCoord);\n      }",
"\n      #define SHADER_NAME SMAA::NeighborhoodBlending\n      precision highp float;\n      precision highp int;\n\n      #define SMAA_DEBUG_SPLIT_VIEW 0\n\n      uniform sampler2D tBlendWeights;\n      uniform sampler2D tColor;\n      uniform vec4 uResolution;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[2];\n\n      vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {\n        vec4 a;\n        a.xz \x3d texture2D( blendTex, texcoord ).xz;\n        a.y \x3d texture2D( blendTex, offset[ 1 ].zw ).g;\n        a.w \x3d texture2D( blendTex, offset[ 1 ].xy ).a;\n\n        if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) \x3c 1e-5 ) {\n          return texture2D( colorTex, texcoord, 0.0 );\n        } else {\n          vec2 offset;\n          offset.x \x3d a.a \x3e a.b ? a.a : -a.b;\n          offset.y \x3d a.g \x3e a.r ? -a.g : a.r;\n\n          if ( abs( offset.x ) \x3e abs( offset.y )) {\n            offset.y \x3d 0.0;\n          } else {\n            offset.x \x3d 0.0;\n          }\n\n          vec4 C \x3d texture2D( colorTex, texcoord, 0.0 );\n          texcoord +\x3d sign( offset ) * uResolution.xy;\n          vec4 Cop \x3d texture2D( colorTex, texcoord, 0.0 );\n\n          float s \x3d abs( offset.x ) \x3e abs( offset.y ) ? abs( offset.x ) : abs( offset.y );\n          //C.xyz \x3d pow(C.xyz, vec3(2.2));\n          //Cop.xyz \x3d pow(Cop.xyz, vec3(2.2));\n          vec4 mixed \x3d mix(C, Cop, s);\n          //mixed.xyz \x3d pow(mixed.xyz, vec3(1.0 / 2.2));\n\n          return mixed;\n        }\n      }\n\n      void main() {\n        gl_FragColor \x3d SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );\n\n        #if SMAA_DEBUG_SPLIT_VIEW // split the view in the middle and display the unprocessed image on the right\n          // test stuff\n          if (fTexCoord.x \x3e 0.5) {\n            if (fTexCoord.x \x3c 0.5 + uResolution.x) {\n              gl_FragColor \x3d vec4(0, 0, 1, 1);\n            } else {\n              gl_FragColor \x3d texture2D(tColor, fTexCoord);\n            }\n          }\n        #endif // DEBUG\n      }",
this.vertexAttributeLocations);var h=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new a(c,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new b(c,34962,35044,h)});this.tmpFramebufferEdges=t.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=t.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,
wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII\x3d",
9729,6407);this.textureSearch=this.loadTextureFromBase64("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII\x3d",9728,6409);this.isEnabled=!0}};h.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),
this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};h.prototype.render=function(a,b){this.enable();var c=this.rctx,h=0,f=0;null!=b?(h=b.descriptor.width,f=b.descriptor.height):(h=c.gl.canvas.width,f=c.gl.canvas.height);c.bindVAO(this.vao);c.setFaceCullingEnabled(!0);c.setCullFace(1029);
c.setFrontFace(2305);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!1);c.setViewport(0,0,h,f);this.tmpFramebufferEdges.resize(h,f);c.bindFramebuffer(this.tmpFramebufferEdges);c.setClearColor(0,0,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programEdgeDetect);c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/h,1/f,h,f);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(h,f);c.bindFramebuffer(this.tmpFramebufferBlend);
c.setClearColor(0,0,1,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/h,1/f,h,f);c.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);c.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);
c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/h,1/f,h,f);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);c.drawArrays(4,0,3);c.setBlendingEnabled(!0);c.setDepthTestEnabled(!0)};h.prototype.loadTextureFromBase64=function(a,b,h){var f=new c(this.rctx,{pixelFormat:h,dataType:5121,wrapMode:33071,samplingMode:b},
null);p.dataUriToImage(a).then(function(a){f.resize(a.width,a.height);f.setData(a)});return f};return h}()})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","dojo/Deferred","../../../core/urlUtils","../../../request"],function(B,r,f,a,b){function c(a){var b=!1,c=new Image,l=new f(function(){b=!0;c.src=""}),q=function(){b||l.reject()};c.onload=function(){b||l.resolve(c)};c.onerror=q;c.onabort=q;c.src=a;return l.promise}Object.defineProperty(r,"__esModule",{value:!0});r.dataURItoBlob=
function(a){var b=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var c=new ArrayBuffer(b.length),f=new Uint8Array(c),q=0;q<b.length;q++)f[q]=b.charCodeAt(q);return new Blob([c],{type:a})};r.dataUriToImage=c;r.requestImage=function(f){return a.isDataProtocol(f)?c(f):b(f,{responseType:"image",allowImageDataAccess:!0}).then(function(a){return a.data})}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});
r.startMeasurement=function(a){if(!a.extensions.disjointTimerQuery)return null;var b=new f;b.start(a);return b};var f=function(){function a(){}a.prototype.start=function(a){this._rctx=a;a=a.extensions.disjointTimerQuery;this._query=a.createQueryEXT();a.beginQueryEXT(a.TIME_ELAPSED_EXT,this._query)};a.prototype.stop=function(a,c){void 0===c&&(c=50);this._cb=a;this._checkInterval=c;a=this._rctx.extensions.disjointTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT);this._checkQueryResult()};a.prototype._checkQueryResult=
function(){var a=this._rctx.extensions.disjointTimerQuery,c=a.getQueryObjectEXT(this._query,a.QUERY_RESULT_AVAILABLE_EXT),f=this._rctx.gl.getParameter(a.GPU_DISJOINT_EXT);c&&!f?(a=a.getQueryObjectEXT(this._query,a.QUERY_RESULT_EXT),this._cb(a/1E6)):f?this._cb(null):setTimeout(this._checkQueryResult.bind(this),this._checkInterval)};return a}()})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./HUDMaterial.xml ./internal/MaterialUtil ../lib/Util ../../../webgl/Util ./internal/MaterialBase ./internal/GLMaterialTextureBase ../lib/gl-matrix ../lib/RenderSlot ../lib/RenderPass ../lib/ShaderVariations ../lib/ComponentUtils ../../support/aaBoundingRect ../lib/screenSizePerspectiveUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C){function E(a,b){void 0===b&&(b=S);if(a.textureIsSignedDistanceField){var d=a.anchorPos;a=a.distanceFieldBoundingBox;var e=b;e[0]=d[0]*(a[2]-a[0])+a[0];e[1]=d[1]*(a[3]-a[1])+a[1]}else G.set(a.anchorPos,b);return b}var G=l.vec2d,n=l.vec3d,A=l.mat3d,x=l.mat4d,I={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},K=[{name:"position",count:3,type:5126,offset:0,stride:76,
normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:76,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:76,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:76,normalized:!1},{name:"size",count:2,type:5126,offset:36,stride:76,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:44,stride:76,normalized:!1},{name:"auxpos2",count:4,type:5126,offset:60,stride:76,normalized:!1}],J={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,
color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,anchorPos:I.center,shaderPolygonOffset:1E-5,polygonOffset:!1,
textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1};B=function(h){function l(a,d){d=h.call(this,d)||this;d._textureDirty=!1;d.params=b.copyParameters(a,J);"string"===typeof d.params.anchorPos&&(d.params.anchorPos=I[d.params.anchorPos]);return d}f(l,h);l.prototype.dispose=function(){};l.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,texCoordScale:a.texCoordScale,polygonOffset:a.polygonOffset,anchorPos:a.anchorPos,screenOffset:a.screenOffset,verticalOffset:a.verticalOffset,
screenSizePerspective:a.screenSizePerspective,screenSizePerspectiveAlignment:a.screenSizePerspectiveAlignment,shaderPolygonOffset:a.shaderPolygonOffset,textureIsSignedDistanceField:a.textureIsSignedDistanceField,outlineColor:a.outlineColor,outlineSize:a.outlineSize,distanceFieldBoundingBox:a.distanceFieldBoundingBox,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,
vvColorColors:a.vvColorColors,textureId:a.textureId,occlusionTest:a.occlusionTest,binaryHighlightOcclusion:a.binaryHighlightOcclusion,centerOffsetUnits:a.centerOffsetUnits,debugDrawBorder:a.debugDrawBorder,drawInSecondSlot:a.drawInSecondSlot}};l.prototype.setParameterValues=function(a){for(var b in a)"textureId"===b&&c.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[b]=a[b];this.notifyDirty("matChanged")};l.prototype.getParams=function(){return this.params};
l.prototype.getOutputAmount=function(a){return 114*a};l.prototype.getInstanceBufferLayout=function(){};l.prototype.getVertexBufferLayout=function(){return K};l.prototype.fillInterleaved=function(a,d,e,g,k,h){var f=4*h,m=a.faces.indices[c.VertexAttrConstants.POSITION],l=a.vertexAttr[c.VertexAttrConstants.POSITION].data,n=h+t.findAttribute(K,c.VertexAttrConstants.POSITION).offset/4;for(g=0;g<m.length;++g){var q=3*m[g];b.fill(l,q,k,n,d,3);n+=19;b.fill(l,q,k,n,d,3);n+=19;b.fill(l,q,k,n,d,3);n+=19;b.fill(l,
q,k,n,d,3);n+=19;b.fill(l,q,k,n,d,3);n+=19;b.fill(l,q,k,n,d,3);n+=19}d=a.faces.indices[c.VertexAttrConstants.NORMAL];l=a.vertexAttr[c.VertexAttrConstants.NORMAL].data;n=h+t.findAttribute(K,c.VertexAttrConstants.NORMAL).offset/4;for(g=0;g<d.length;++g)q=3*d[g],b.fill(l,q,k,n,e,3),n+=19,b.fill(l,q,k,n,e,3),n+=19,b.fill(l,q,k,n,e,3),n+=19,b.fill(l,q,k,n,e,3),n+=19,b.fill(l,q,k,n,e,3),n+=19,b.fill(l,q,k,n,e,3),n+=19;g=a.vertexAttr[c.VertexAttrConstants.UV0].data;null==g||3>=g.length?(e=q=0,d=this.params.texCoordScale[0],
l=this.params.texCoordScale[1]):(q=a.vertexAttr[c.VertexAttrConstants.UV0].data[0],e=a.vertexAttr[c.VertexAttrConstants.UV0].data[1],d=a.vertexAttr[c.VertexAttrConstants.UV0].data[2],l=a.vertexAttr[c.VertexAttrConstants.UV0].data[3]);d=Math.min(1.99999,d+1);l=Math.min(1.99999,l+1);n=h+t.findAttribute(K,c.VertexAttrConstants.UV0).offset/4;for(g=0;g<m.length;++g)k[n]=q,k[n+1]=e,n+=19,k[n]=d,k[n+1]=e,n+=19,k[n]=d,k[n+1]=l,n+=19,k[n]=d,k[n+1]=l,n+=19,k[n]=q,k[n+1]=l,n+=19,k[n]=q,k[n+1]=e,n+=19;m=a.faces.indices[c.VertexAttrConstants.COLOR];
e=a.vertexAttr[c.VertexAttrConstants.COLOR].data;f+=t.findAttribute(K,c.VertexAttrConstants.COLOR).offset;d=new Uint8Array(k.buffer);for(g=0;g<m.length;++g)q=4*m[g],b.fill(e,q,d,f,null,4),f+=76,b.fill(e,q,d,f,null,4),f+=76,b.fill(e,q,d,f,null,4),f+=76,b.fill(e,q,d,f,null,4),f+=76,b.fill(e,q,d,f,null,4),f+=76,b.fill(e,q,d,f,null,4),f+=76;q=a.faces.indices[c.VertexAttrConstants.SIZE];f=a.vertexAttr[c.VertexAttrConstants.SIZE].data;m=h+t.findAttribute(K,c.VertexAttrConstants.SIZE).offset/4;for(g=0;g<
q.length;++g)e=f[2*q[g]],d=f[2*q[g]+1],k[m]=e,k[m+1]=d,m+=19,k[m]=e,k[m+1]=d,m+=19,k[m]=e,k[m+1]=d,m+=19,k[m]=e,k[m+1]=d,m+=19,k[m]=e,k[m+1]=d,m+=19,k[m]=e,k[m+1]=d,m+=19;if(null!=a.faces.indices[c.VertexAttrConstants.AUXPOS1]&&null!=a.vertexAttr[c.VertexAttrConstants.AUXPOS1])for(f=a.faces.indices[c.VertexAttrConstants.AUXPOS1],m=a.vertexAttr[c.VertexAttrConstants.AUXPOS1].data,e=h+t.findAttribute(K,"auxpos1").offset/4,g=0;g<f.length;++g)q=4*f[g],b.fill(m,q,k,e,null,4),e+=19,b.fill(m,q,k,e,null,
4),e+=19,b.fill(m,q,k,e,null,4),e+=19,b.fill(m,q,k,e,null,4),e+=19,b.fill(m,q,k,e,null,4),e+=19,b.fill(m,q,k,e,null,4),e+=19;if(null!=a.faces.indices[c.VertexAttrConstants.AUXPOS2]&&null!=a.vertexAttr[c.VertexAttrConstants.AUXPOS2])for(f=a.faces.indices[c.VertexAttrConstants.AUXPOS2],a=a.vertexAttr[c.VertexAttrConstants.AUXPOS2].data,h+=t.findAttribute(K,"auxpos2").offset/4,g=0;g<f.length;++g)q=4*f[g],b.fill(a,q,k,h,null,4),h+=19,b.fill(a,q,k,h,null,4),h+=19,b.fill(a,q,k,h,null,4),h+=19,b.fill(a,
q,k,h,null,4),h+=19,b.fill(a,q,k,h,null,4),h+=19,b.fill(a,q,k,h,null,4),h+=19};l.prototype.intersect=function(a,b,k,h,f,m,l,q){if(h.isSelection&&h.enableHUDSelection&&!w.isAllHidden(b.componentVisibilities,a.data.componentOffsets)){b=this.params;m=f=1;q&&(m=q(e),f=m[0],m=m[5]);q=a.getData().getVertexAttr()[c.VertexAttrConstants.POSITION];var p=a.getData().getVertexAttr()[c.VertexAttrConstants.SIZE];a=a.getData().getVertexAttr()[c.VertexAttrConstants.NORMAL];c.assert(3<=q.size);for(var u=h.point,t=
h.camera,y=E(b),v=0;v<q.data.length/q.size;v++){var z=v*q.size;n.set3(q.data[z],q.data[z+1],q.data[z+2],P);x.multiplyVec3(k,P,P);z=v*p.size;g[0]=p.data[z]*f;g[1]=p.data[z+1]*m;x.multiplyVec3(t.viewMatrix,P);z=v*a.size;n.set3(a.data[z],a.data[z+1],a.data[z+2],O);this.applyVerticalOffsetTransformation(P,O,k,t,Q);t.applyProjection(P,T);if(-1<T[0]){var z=Math.floor(T[0]),A=Math.floor(T[1]);C.applyPrecomputedScaleFactorVec2(g,Q.factor,g);var z=z-d-(0<y[0]?g[0]*y[0]:0),r=z+g[0]+2*d,A=A-d-(0<y[1]?g[1]*y[1]:
0),J=A+g[1]+2*d;if(b.textureIsSignedDistanceField)var D=b.outlineSize/2,I=b.distanceFieldBoundingBox,z=z+g[0]*I[0],A=A+g[1]*I[1],r=r-g[0]*(1-I[2]),J=J-g[1]*(1-I[3]),z=z-D,r=r+D,A=A-D,J=J+D;u[0]>z&&u[0]<r&&u[1]>A&&u[1]<J&&(r=h.p0,A=h.p1,x.multiplyVec3(x.inverse(t.viewMatrix,ca),P,W),T[0]=u[0],T[1]=u[1],t.unprojectPoint(T,P),z=n.negate(h.getDirection(),n.create()),r=n.dist(r,P)/n.dist(r,A),l(r,z,-1,1,!0,W))}}}};l.prototype.normalAndViewAngle=function(a,b,d,e){void 0===e&&(e=V);A.multiplyVec3(x.toMat3(b,
k),a,e.normal);x.multiplyVec3(d.viewInverseTransposeMatrix,e.normal);e.cosAngle=n.dot(U,m);return e};l.prototype.updateScaleInfo=function(a,b,d){b=this.params;b.screenSizePerspective?a.factor=C.precomputeScaleFactor(V.cosAngle,d,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);b.screenSizePerspectiveAlignment?(a.scaleAlignment=C.precomputeScale(V.cosAngle,d,b.screenSizePerspectiveAlignment),a.minPixelSizeAlignment=b.screenSizePerspectiveAlignment.parameters.minPixelSize):
(a.scaleAlignment=a.factor.scale,a.minPixelSizeAlignment=a.factor.minPixelSize)};l.prototype.applyVerticalOffsetTransformation=function(a,d,e,c,g,k){var h=this.params;if(!h.verticalOffset||!h.verticalOffset.screenLength)return g&&(h.screenSizePerspective||h.screenSizePerspectiveAlignment)?(c=this.normalAndViewAngle(d,e,c),h=n.length(a),this.updateScaleInfo(g,c.cosAngle,h)):g&&(g.factor.scale=1,g.scaleAlignment=1),k?n.set(a,k):a;d=this.normalAndViewAngle(d,e,c);e=n.length(a);c=b.verticalOffsetAtDistance(c,
e,h.verticalOffset,d.cosAngle,h.screenSizePerspectiveAlignment||h.screenSizePerspective);g&&this.updateScaleInfo(g,d.cosAngle,e);return n.add(a,n.scale(d.normal,c),k)};l.prototype.getGLMaterials=function(){return{color:N,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:M}};l.prototype.getAllTextureIds=function(){return[this.params.textureId]};l.prototype.setTextureDirty=function(){this._textureDirty=!0};l.prototype.calculateRelativeScreenBounds=function(a,b,d){void 0===d&&(d=u.create());
var e=this.params,c=d;void 0===c&&(c=S);G.set(e.anchorPos,c);c[0]*=-a[0];c[1]*=-a[1];c[0]+=e.screenOffset[0]*b;c[1]+=e.screenOffset[1]*b;d[2]=d[0]+a[0];d[3]=d[1]+a[1];return d};l.prototype.calculateAnchorPosForRendering=function(a){return E(this.params,a)};l.loadShaders=function(b,d,e,c){b._parse(a);var g=function(a){a.addDefine("OcclTest","OCCL_TEST");a.addDefine("SDF","SIGNED_DISTANCE_FIELD");a.addDefine("vvSize","VV_SIZE");a.addDefine("vvColor","VV_COLOR");a.addDefine("verticalOffset","VERTICAL_OFFSET");
a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");a.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN")},k=new z("hud",["vertexShaderHUD","fragmentShaderHUD"],null,e,d,b,c);g(k);k.addDefine("debugDrawBorder","DEBUG_DRAW_BORDER");e.addShaderVariations("hud-material-shader-variations",k);k=new z("hudHighlight",["vertexShaderHUD","fragmentShaderHUDHighlight"],null,e,d,b,c);g(k);k.addDefine("binaryHighlightOcclusion","BINARY_HIGHLIGHT_OCCLUSION");e.addShaderVariations("hud-material-highlight-shader-variations",
k);b=new z("hudOcclusionTestPixel",["vertexShaderOcclusionTestPixel","fragmentShaderSimple"],null,e,d,b,c);b.addDefine("verticalOffset","VERTICAL_OFFSET");b.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");e.addShaderVariations("hud-material-occlusion-test-pixel-shader-variations",b)};l.shouldRenderVisibilityDuringRenderPass=function(a){return a===y.MATERIAL||y.MATERIAL_HIGHLIGHT};return l}(p.MaterialBase);h=function(a){function d(d,
e,c){c=a.call(this,d,d.getParams(),e,c)||this;c.programRep=e;c.params=b.copyParameters(d.getParams());c.selectProgram();c.selectSlot();return c}f(d,a);d.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?q.HUDMATERIAL2:q.HUDMATERIAL1};d.prototype.beginSlot=function(a){return a===this.mainSlot};d.prototype.getProgram=function(){return this.program};d.prototype.getAllPrograms=function(){return[this.program]};d.prototype.updateParameters=function(){var a=this.material.getParams(),
b=this.params;b.color=a.color;b.texCoordScale=a.texCoordScale;b.polygonOffset=a.polygonOffset;b.anchorPos=a.anchorPos;b.screenOffset=a.screenOffset;b.verticalOffset=a.verticalOffset;b.screenSizePerspective=a.screenSizePerspective;b.screenSizePerspectiveAlignment=a.screenSizePerspectiveAlignment;b.shaderPolygonOffset=a.shaderPolygonOffset;b.textureIsSignedDistanceField=a.textureIsSignedDistanceField;b.outlineColor=a.outlineColor;b.outlineSize=a.outlineSize;b.vvSizeEnabled=a.vvSizeEnabled;b.vvSizeMinSize=
a.vvSizeMinSize;b.vvSizeMaxSize=a.vvSizeMaxSize;b.vvSizeOffset=a.vvSizeOffset;b.vvSizeFactor=a.vvSizeFactor;b.vvColorEnabled=a.vvColorEnabled;b.vvColorValues=a.vvColorValues;b.vvColorColors=a.vvColorColors;this.updateTexture(a.textureId);this.selectProgram();this.selectSlot()};d.prototype.bindRender=function(a,b){var d=this.params,e=this.getProgram();this.bindTexture(a,e);e.setUniform1i("hudVisibilityTexture",1);a.bindTexture(b.hudVisibilityTexture,1);a.setActiveTexture(0);e.setUniform4fv("overrideColor",
d.color);e.setUniform1f("pixelRatio",b.pixelRatio);d.textureIsSignedDistanceField&&(e.setUniform4fv("outlineColor",d.outlineColor),e.setUniform1f("outlineSize",d.outlineSize));d.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",d.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",d.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",d.vvSizeOffset),e.setUniform3fv("vvSizeFactor",d.vvSizeFactor));d.vvColorEnabled&&(e.setUniform1fv("vvColorValues",d.vvColorValues),e.setUniform4fv("vvColorColors",d.vvColorColors));
e.setUniform2fv("texScale",d.texCoordScale);e.setUniform2f("screenOffset",2*d.screenOffset[0],2*d.screenOffset[1]);e.setUniform2fv("anchorPos",E(d));d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setBlendingEnabled(!0);a.setBlendFunction(1,771)};d.prototype.bindProjection=function(a,d){this.material._textureDirty&&(this.renderTexture(a),this.material._textureDirty=!1);var e=d.cameraAboveGround?1:-1,c=this.getProgram(),g=this.params;a.bindProgram(c);c.setUniform1f("cameraGroundRelative",
e);c.setUniform1f("polygonOffset",g.shaderPolygonOffset);c.setUniform4fv("viewport",d.viewport);b.bindVerticalOffset(g.verticalOffset,d,c);c.setUniformMatrix4fv("viewNormal",d.viewInvTransp);g.screenSizePerspective&&(b.bindScreenSizePerspective(g.screenSizePerspective,c,"screenSizePerspective"),b.bindScreenSizePerspective(g.screenSizePerspectiveAlignment||g.screenSizePerspective,c,"screenSizePerspectiveAlignment"))};d.prototype.releaseRender=function(a){a.setPolygonOffsetFillEnabled(!1);a.setBlendFunction(770,
771);a.setBlendingEnabled(!1)};d.prototype.bindView=function(a,d){a=d.origin;var e=this.getProgram();b.bindView(a,d.view,e);b.bindCamPos(a,d.viewInvTransp,e)};d.prototype.bindInstance=function(a,b){a=this.getProgram();a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};d.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return d}(h.GLMaterialTextureBase);var N=function(a){function b(b,d,e){b=a.call(this,b,d,e)||this;b.isOcclusionSlot=
!1;return b}f(b,a);b.prototype.selectProgram=function(){var a=this.params;this.programOcclusionTestPixel=this.programRep.getShaderVariationsProgram("hud-material-occlusion-test-pixel-shader-variations",[!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits]);this.program=this.programRep.getShaderVariationsProgram("hud-material-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===
a.centerOffsetUnits,!!a.debugDrawBorder])};b.prototype.getDrawMode=function(a){a=a.gl;return this.isOcclusionSlot?a.POINTS:a.TRIANGLES};b.prototype.release=function(a){a.setDepthFunction(a.gl.LESS);this.isOcclusionSlot||this.releaseRender(a)};b.prototype.bind=function(a,b){var d=a.gl;this.bindProjection(a,b);var e=this.getProgram();a.setDepthFunction(d.LEQUAL);this.isOcclusionSlot?e.setUniform4f("color",1,1,1,1):(this.bindRender(a,b),this.bindTexture(a,e))};b.prototype.getProgram=function(){return this.isOcclusionSlot?
this.programOcclusionTestPixel:this.program};b.prototype.getAllPrograms=function(){return[this.programOcclusionTestPixel,this.program]};b.prototype.beginSlot=function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=a===q.OCCLUSION_PIXELS,a===q.OCCLUSION_PIXELS||a===this.mainSlot;this.isOcclusionSlot=!1;return a===this.mainSlot};return b}(h),M=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.prototype.selectProgram=function(){var a=this.params;this.program=
this.programRep.getShaderVariationsProgram("hud-material-highlight-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,a.binaryHighlightOcclusion])};b.prototype.bind=function(a,b){this.bindProjection(a,b);this.bindRender(a,b)};b.prototype.release=function(a){this.releaseRender(a)};return b}(h),Q={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},
S=[0,0],P=n.create(),O=n.create(),T=n.create(),U=n.create(),W=n.create(),k=A.create(),ca=x.create(),V={normal:U,cosAngle:0},e=x.create();x.identity(e);var d=1,g=[0,0],m=[0,0,1];return B})},"esri/views/3d/webgl-engine/materials/internal/MaterialBase":function(){define(["require","exports","./MaterialUtil","../../lib/ModelContentType"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function b(a){this.visible=!0;this.renderPriority=0;this.parentStage=null;this.id=f.__Material_idGen.gen(a)}
b.prototype.getId=function(){return this.id};b.prototype.getParentStage=function(){return this.parentStage};b.prototype.addParentStage=function(a){this.parentStage=a};b.prototype.removeParentStage=function(a){this.parentStage=null};b.prototype.setVisible=function(a){this.visible!==a&&(this.visible=a,this.notifyDirty("matChanged"))};b.prototype.isVisible=function(){return this.visible};b.prototype.notifyDirty=function(b){this.parentStage&&this.parentStage.notifyDirty(a.MATERIAL,this,b)};b.prototype.setRenderPriority=
function(a){this.renderPriority=a;this.notifyDirty("matChanged")};b.prototype.getRenderPriority=function(){return this.renderPriority};return b}();r.MaterialBase=B;r.default=B})},"esri/views/3d/webgl-engine/materials/internal/GLMaterialTextureBase":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","./GLMaterialBase","./MaterialUtil"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(a){function c(c,h,f,q,t){void 0===t&&(t=!1);c=a.call(this,
c,f,q)||this;c.params=h;c.textureRep=q;c.initTransparent=t;c.glTextureRef=b.aquireIfNotUndefined(h.textureId,h.initTexture,q,t);return c}f(c,a);c.prototype.updateTexture=function(a){var c=this.params;c.textureId!==a&&(b.releaseIfNotUndefined(c.textureId,this.textureRep),c.textureId=a,this.glTextureRef=b.aquireIfNotUndefined(c.textureId,c.initTexture,this.textureRep,this.initTransparent))};c.prototype.renderTexture=function(a){(a=this.textureRep.getTexture(this.params.textureId))&&a.dirty&&a.redraw&&
a.redraw()};c.prototype.bindTexture=function(a,b){null!=this.glTextureRef&&(b.setUniform1i("tex",0),a.bindTexture(this.glTextureRef.getGLTexture()))};c.prototype.bindTextureSize=function(a,b){null!=this.glTextureRef&&(a=this.glTextureRef.getGLTexture(),b.setUniform2f("texSize",a.descriptor.width,a.descriptor.height))};c.prototype.dispose=function(){b.releaseIfNotUndefined(this.params.textureId,this.textureRep)};return c}(a.default);r.GLMaterialTextureBase=B;r.default=B})},"esri/views/3d/webgl-engine/materials/internal/GLMaterialBase":function(){define(["require",
"exports","./MaterialUtil"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function a(a,c,t){this.id=f.__GLMaterial_id++;this.material=a}a.prototype.getId=function(){return this.id};a.prototype.getMaterialId=function(){return this.material.getId()};a.prototype.isVisible=function(){return this.material.isVisible()};a.prototype.getRenderPriority=function(){return this.material.getRenderPriority()};return a}();r.GLMaterialBase=B;r.default=B})},"esri/views/3d/webgl-engine/lib/ShaderVariations":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang ./Util ../../../webgl/Program ./DefaultVertexAttributeLocations".split(" "),
function(B,r,f,a,b,c,t){return function(){function f(a,c,f,p,t,w,u){this.variables=[];this.sealed=!1;this.programCache={};b.assert(2===c.length,"you must specify shader snippet prefixes for vertex and fragment shaders");this.programNamePrefix=a;this.shaderSnippetPrefixes=c;this.baseDefines=f;this.programRep=p;this.shaderRep=t;this.snippets=w;this.rctx=u;this.baseDefines=f?f.slice():[]}f.prototype.addDefine=function(a,c,f,p){b.assert(!this.sealed,"you cannot add another variable after the first program has been generated");
b.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderNameSuffixes:p||a,defineStr:c,affectsShaderTypes:f||[!0,!0]})};f.prototype.addBinaryShaderSnippetSuffix=function(a,c,f){b.assert(!this.sealed,"you cannot add another variable after the first program has been generated");b.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderSnippetSuffixes:["",c],affectsShaderTypes:f||[!0,!0]})};f.prototype.addNaryShaderSnippetSuffix=
function(a,c){b.assert(!this.sealed,"you cannot add another variable after the first program has been generated");var h=a.map(function(a){b.assert(null!=a.value,"value must always be specified");return a.value});this.variables.push({values:h,programNameSuffixes:a.map(function(a,b){return null!=a.programNameSuffix?a.programNameSuffix:h[b]}),shaderSnippetSuffixes:a.map(function(a,b){return null!=a.shaderSnippetSuffix?a.shaderSnippetSuffix:h[b]}),affectsShaderTypes:c||[!0,!0]})};f.prototype.getShaderVariation=
function(c){b.assert(c.length===this.variables.length,"you must specify a value for each variable");for(var h=this.programNamePrefix,f=a.clone(this.shaderSnippetPrefixes),p=a.clone(this.shaderSnippetPrefixes),t=a.clone(this.baseDefines),w=0;w<this.variables.length;w++){var u=this.variables[w],C=c[w],r=void 0;u.values?(r=u.values.indexOf(C.toString()),b.assert(0<=r,"invalid value "+C+" for variable "+w)):r=C?1:0;h+=u.programNameSuffixes[r];for(C=0;2>C;C++)u.affectsShaderTypes[C]&&(u.shaderSnippetSuffixes&&
(f[C]+=u.shaderSnippetSuffixes[r],p[C]+=u.shaderSnippetSuffixes[r]),u.defineStr&&r&&(t.push(u.defineStr),p[C]+=u.shaderNameSuffixes))}return{programName:h,shaderSnippetNames:f,shaderNames:p,defines:t}};f.prototype.getProgram=function(a,f,q){void 0===f&&(f=this.snippets);void 0===q&&(q=this.rctx);this.sealed=!0;var h=a.reduce(function(a,b){return a+b.toString()},"");if(this.programCache[h])return this.programCache[h];a=this.getShaderVariation(a);var l=this.programRep.get(a.programName);if(l)return l;
var p=a.shaderSnippetNames[0],l=f[p];b.assert(null!=l,"shader snippet '"+p+"' does not exist");p=a.shaderSnippetNames[1];f=f[p];b.assert(null!=f,"shader snippet '"+p+"' does not exist");l=new c(q,l,f,t.Default3D,a.defines);this.programCache[h]=l;this.programRep.add(a.programName,l);return l};return f}()})},"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":function(){define("require exports dojo/text!./TexOnlyGLMaterial.xml ./MaterialUtil ../../lib/RenderSlot ../../lib/gl-matrix ../../../../webgl/Program ../../../../webgl/enums ../../lib/DefaultVertexAttributeLocations".split(" "),
function(B,r,f,a,b,c,t,p,h){var l=c.vec4d.createFrom(1,1,1,1);return function(){function c(b,c,h,f,l){this.id=a.__GLMaterial_id++;this.program=b.get("texOnly");this.color=h;this.depthFunc=l;this.blend=f;this.texGLName=c}c.prototype.getId=function(){return this.id};c.prototype.beginSlot=function(a){return a===b.INTERNAL_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.setColor=function(a){this.color=a};c.prototype.bind=function(b,c){b.bindProgram(this.program);this.program.setUniformMatrix4fv("model",
a.IDENTITY);this.program.setUniformMatrix4fv("proj",c.proj);this.program.setUniform4fv("color",void 0!==this.color?this.color:l);this.program.setUniform1i("tex",0);b.bindTexture(this.texGLName,0);this.blend&&(b.setBlendingEnabled(!0),b.setBlendFunctionSeparate(b.gl.SRC_ALPHA,b.gl.ONE_MINUS_SRC_ALPHA,b.gl.ONE,b.gl.ONE_MINUS_SRC_ALPHA));b.setDepthTestEnabled(!0);void 0!==this.depthFunc&&b.setDepthFunction(this.depthFunc)};c.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);
this.blend&&a.setBlendingEnabled(!1)};c.prototype.bindView=function(b,c){a.bindView(c.origin,c.view,this.program)};c.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};c.loadShaders=function(a,b,c,l){a._parse(f);a=new t(l,a.vertexShaderTexOnly,a.fragmentShaderTexOnly,h.Default3D);c.add("texOnly",a)};return c}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports",
"./IdGen"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});var a=new f;r.generateHighlightId=function(){return a.gen("highlight")}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor".split(" "),function(B,r,f,a,b,c){return new (function(c){function p(){var a=null!==c&&c.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_SELECTOR=
!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_TEST_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;return a}f(p,c);a([b.property()],p.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0);a([b.property()],p.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);a([b.property()],p.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);a([b.property()],
p.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);a([b.property()],p.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);a([b.property()],p.prototype,"DECONFLICTOR_SHOW_GRID",void 0);a([b.property()],p.prototype,"LABELS_SHOW_BORDER",void 0);a([b.property()],p.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);a([b.property()],p.prototype,"OVERLAY_SHOW_CENTER",void 0);return p=a([b.subclass()],p)}(b.declared(c)))})},"esri/views/3d/webgl-engine/lib/webgl-utils":function(){define([],function(){var B=function(r,
f){for(var a=["webgl","experimental-webgl","webkit-3d","moz-webgl"],b=null,c=0;c<a.length;++c){try{b=r.getContext(a[c],f)}catch(t){}if(b)break}return b};return{create3DContext:B,setupWebGL:function(r,f){function a(a){var b=r.parentNode;b&&(b.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}
if(!window.WebGLRenderingContext)return a('This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),[null,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'];f=B(r,f);return f?[f]:(a('It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'),
[null,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'])},detectWebGL:function(){var r;try{r=window.WebGLRenderingContext}catch(a){r=[!1,0]}var f;try{f=B(document.createElement("canvas"))}catch(a){f=[!1,1]}r?f?(r=f,r=[!0,{VERSION:r.getParameter(r.VERSION),SHADING_LANGUAGE_VERSION:r.getParameter(r.SHADING_LANGUAGE_VERSION),VENDOR:r.getParameter(r.VENDOR),RENDERER:r.getParameter(r.RENDERER),
EXTENSIONS:r.getSupportedExtensions(),MAX_TEXTURE_SIZE:r.getParameter(r.MAX_TEXTURE_SIZE),MAX_RENDERBUFFER_SIZE:r.getParameter(r.MAX_RENDERBUFFER_SIZE),MAX_VERTEX_TEXTURE_IMAGE_UNITS:r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}]):r=[!1,1]:r=[!1,0];return r}}})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports dojo/has ../lib/PerformanceTimer ../lib/Camera ../lib/Util ../lib/gl-matrix ./Visualizer".split(" "),function(B,r,f,a,b,c,t,p){var h=t.vec3;B=t.vec4d;var l=
t.mat4d,q=[0,0],y=l.create(),z=[B.create(),B.create(),B.create(),B.create(),B.create(),B.create()];return function(){function a(a,c,f,l){this._content={};this._frustumCullingEnabled=!0;this._maxFarNearRatio=2E4;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null};this._needsRender=!0;this._rctx=l;this._gl=l.gl;this._visualizer=new p(a,c,f,this._rctx);this._camera=new b(h.createFrom(0,100,-100),h.createFrom(0,0,0))}a.prototype.getCombinedStats=
function(){var a={},b=this._visualizer.getCombinedStats(),c;for(c in b)a[c]=b[c];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var b=
this._gl.getUsedTextureMemoryStats(),h;for(h in b)a["texMem type: "+h]=b[h]}return a};a.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null};a.prototype.setLighting=function(a){this._visualizer.setLighting(a)};a.prototype.getViewParams=function(a){var b=this._visualizer.getViewParams(a);if(!a||a.frustumCullingEnabled)b.frustumCullingEnabled=this._frustumCullingEnabled;if(!a||a.maxFarNearRatio)b.maxFarNearRatio=this._maxFarNearRatio;return b};a.prototype.setViewParams=function(a){void 0!==
a.frustumCullingEnabled&&(this._frustumCullingEnabled=a.frustumCullingEnabled);void 0!==a.maxFarNearRatio&&(this._maxFarNearRatio=-1===a.maxFarNearRatio?2E4:a.maxFarNearRatio);this._visualizer.setViewParams(a);this._needsRender=!0};a.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)};a.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};a.prototype.getFrustumObjects=function(){var a={},b;for(b in this._content)a[this._content[b].name]=1;return a};
a.prototype.modify=function(a,b,c,h){this._visualizer.modify(a,b,c,h);this._content=this._visualizer.getContent()};a.prototype.getContent=function(){return this._content};a.prototype.setCamera=function(a){this._camera.copyFrom(a);this._updateNearFar();this._needsRender=!0};a.prototype.getCamera=function(){return this._camera};a.prototype.getPickRay=function(a,b,c){return this.pickRayWithBeginPoint(a,void 0,this._camera.viewMatrix,b,c)};a.prototype.pickRayWithBeginPoint=function(a,b,c,h,f){return this._visualizer.getPickRay(a,
b,this._camera,c,h,f)};a.prototype.addExternalRenderer=function(a,b){return this._visualizer.addExternalRenderer(a,b)};a.prototype.removeExternalRenderer=function(a){return this._visualizer.removeExternalRenderer(a)};a.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()};a.prototype.render=function(a,b){this._updateNearFar();this._visualizer.render(this._camera,a,b)};a.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};
a.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()};a.prototype._updateNearFar=function(){if(this._frustumCullingEnabled||0<this._maxFarNearRatio)q[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,q),0<this._maxFarNearRatio&&0<q[1]&&(this._camera.far=q[1],this._camera.near=Math.max(q[0],this._camera.far/this._maxFarNearRatio))};a.prototype._computeFrustumCullingAndNearFar=function(a,b){l.perspective(this._camera.fovY,this._camera.aspect,1,10,y);
c.matrix2frustumPlanes(this._camera.viewMatrix,y,z);this._stats.renderGeometriesTotal=0;this._stats.renderGeometriesVisible=0;a=-Number.MAX_VALUE;var h=-Number.MAX_VALUE,f=z[0][0],n=z[0][1],q=z[0][2],p=z[0][3],u=z[1][0],t=z[1][1],w=z[1][2],C=z[1][3],r=z[2][0],B=z[2][1],S=z[2][2],P=z[2][3],O=z[3][0],T=z[3][1],U=z[3][2],W=z[3][3],k=z[4][0],ca=z[4][1],V=z[4][2],e=z[4][3],d=z[5][3],g;for(g in this._content){var m=this._content[g];this._stats.renderGeometriesTotal++;if(!m.material.isBackdrop){var v=m.center,
D=v[0],L=v[1],v=v[2],m=m.bsRadius;if(f*D+n*L+q*v+p>m)continue;if(u*D+t*L+w*v+C>m)continue;if(r*D+B*L+S*v+P>m)continue;if(O*D+T*L+U*v+W>m)continue;L=k*D+ca*L+V*v;D=L+m;L=-L+m;D>a&&(a=D);L>h&&(h=L)}this._stats.renderGeometriesVisible++}g=a!==-Number.MAX_VALUE;0<this._stats.renderGeometriesVisible&&g&&(b[0]=.99*Math.max(1-(a+e),2),b[1]=1.01*Math.max(10+(h+d),b[0]+1))};return a}()})},"esri/views/3d/webgl-engine/lib/PerformanceTimer":function(){define(["require","exports","./Util"],function(B,r,f){return function(){function a(a){this._filterSampleIndex=
0;this._lastTime=NaN;this._numMeasurements=this._totalTime=0;this._filterSamples=Array(a);this.reset();this._filterSize=a}a.prototype.reset=function(){for(var a=this._filterSampleIndex=0;a<this._filterSize;a++)this._filterSamples[a]=NaN};a.prototype.start=function(){this._tsStart=f.performance.now()};a.prototype.stop=function(){this._lastTime=f.performance.now()-this._tsStart;this._totalTime+=this._lastTime;this._numMeasurements++;this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,
this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize);return this._lastTime};a.prototype.getLast=function(){return this._lastTime};a.prototype.getLastFiltered=function(){for(var a=0,c=0;c<this._filterSamples.length;c++)a+=this._filterSamples[c];return a/this._filterSamples.length};a.prototype.getAverage=function(){return this._totalTime/this._numMeasurements};a.prototype.getTotal=function(){return this._totalTime};a.prototype.getNumMeasurements=function(){return this._numMeasurements};
return a}()})},"esri/views/3d/webgl-engine/parts/Visualizer":function(){define("require exports ../lib/Renderer ../lib/SSAOHelperObscurance ../lib/ShadowMap ../lib/NearFarCalc ../lib/Util ../lib/gl-matrix ../lib/RenderPass ../lib/HighlightHelper ../lib/OffscreenRenderingHelper".split(" "),function(B,r,f,a,b,c,t,p,h,l,q){var y=p.vec3d,z=p.mat4d,w=t.assert;return function(){function p(h,p,u,n){this._drawSSAOMapDebugQuad=this._drawShadowMapDebugQuad=!1;this._needsRender=!0;this._content={};this._rctx=
n;this._renderer=new f(h,p,u,this._rctx,!1);this._programRep=h;this._shadowMap=new b(h,this._rctx);this._ssaoHelper=new a(h,u,this._rctx,this.setNeedsRender.bind(this));this._nearFarCalc=new c;this._highlightHelper=new l(h,u,this._rctx);this._offscreenRenderingHelper=new q(h,this._rctx)}p.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()};p.prototype.dispose=function(){this._renderer.dispose();this._shadowMap.getEnableState()&&this._shadowMap.setEnableState(!1);this._shadowMap.dispose();
this._ssaoHelper.getEnableState()&&this._ssaoHelper.setEnableState(!1);this._ssaoHelper.dispose();this._highlightHelper.getEnableState()&&this._highlightHelper.setEnableState(!1);this._offscreenRenderingHelper.getEnableState()&&this._offscreenRenderingHelper.setEnableState(!1)};p.prototype.setLighting=function(a){this._renderer.setLighting(a)};p.prototype.getViewParams=function(a){var b=a||{};if(!a||a.pixelRatio)b.pixelRatio=this._renderer.getPixelRatio();return b};p.prototype.setViewParams=function(a){null!=
a.pixelRatio&&this._renderer.setPixelRatio(a.pixelRatio)};p.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._shadowMap.getEnableState()&&this._shadowMap.setTextureResolution(a.shadowMapResolution);void 0!==a.shadowMap&&a.shadowMap!==this._shadowMap.getEnableState()&&this._shadowMap.setEnableState(a.shadowMap);void 0!==a.shadowMapMaxCascades&&this._shadowMap.setMaxNumCascades(a.shadowMapMaxCascades);!0!==this._highlightHelper.getEnableState()&&this._highlightHelper.setEnableState(!0);
void 0!==a.ssao&&a.ssao!==this._ssaoHelper.getEnableState()&&this._ssaoHelper.setEnableState(a.ssao);void 0!==a.ssaoAttenuation&&this._ssaoHelper.setAttenuation(a.ssaoAttenuation);void 0!==a.ssaoRadius&&this._ssaoHelper.setRadius(a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&this._ssaoHelper.setSamples(a.ssaoSamples);void 0!==a.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=a.drawShadowMapDebugQuad);
void 0!==a.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=a.drawSSAODebugQuad);this._ssaoHelper.getEnableState()?this._renderer.ssaoEnabled=!0:this._renderer.ssaoEnabled=!1;void 0!==a.offscreenRendering&&a.offscreenRendering!==this._offscreenRenderingHelper.getEnableState()&&this._offscreenRenderingHelper.setEnableState(a.offscreenRendering);void 0!==a.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=
a.earlyOcclusionPixelDraw);void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);this._needsRender=!0};p.prototype.getRenderParams=function(){var a={};this._shadowMap.getIsSupported()&&(a.shadowMap=this._shadowMap.getEnableState(),a.shadowMapResolution=this._shadowMap.getTextureResolution(),a.shadowMapMaxCascades=this._shadowMap.getMaxNumCascades());this._ssaoHelper.getIsSupported()&&(a.ssao=this._ssaoHelper.getEnableState(),a.ssaoAttenuation=this._ssaoHelper.getAttenuation(),
a.ssaoRadius=this._ssaoHelper.getRadius(),a.ssaoFilterRadius=this._ssaoHelper.getFilterRadius(),a.ssaoSamples=this._ssaoHelper.getSamples());return a};p.prototype.modify=function(a,b,c,h){this._renderer.modify(a,b,c,h);for(h=0;h<b.length;++h)delete this._content[b[h].uniqueName];for(h=0;h<a.length;++h)this._content[a[h].uniqueName]=a[h];for(h=0;h<c.length;++h)w(this._content[c[h].renderGeometry.uniqueName]===c[h].renderGeometry)};p.prototype.getContent=function(){return this._content};p.prototype.getPickRay=
function(a,b,c,h,f,l){y.unproject(y.createFrom(a[0],a[1],0),h,c.projectionMatrix,c.fullViewport,f);y.unproject(y.createFrom(a[0],a[1],1),h,c.projectionMatrix,c.fullViewport,l)};p.prototype.getProjectionMatrix=function(a,b,c,h,f){b=t.fovx2fovy(b,a[2],a[3]);z.perspective(180*b/Math.PI,a[2]/a[3],c,h,f)};p.prototype.addExternalRenderer=function(a,b){return this._renderer.addExternalRenderer(a,b)};p.prototype.removeExternalRenderer=function(a){return this._renderer.removeExternalRenderer(a)};p.prototype.getExternalRenderers=
function(){return this._renderer.getExternalRenderers()};p.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderer.resetNeedsRender()};p.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};p.prototype.setNeedsRender=function(){this._needsRender=!0};p.prototype.render=function(a,b,c){var f=a.viewport,l;if(this._shadowMap.getEnableState()){l=this._nearFarCalc.calculateSceneNearFar(a,this._content);this._shadowMap.prepare(a,b,this._content,l);b=
this._shadowMap.getCascades();for(l=0;l<b.length;++l){var q=b[l];q.camera.setGLViewport(this._rctx);this._renderer.renderGeometryPass(h.MATERIAL_DEPTH_SHADOWMAP,q.camera)}this._shadowMap.finish(c);a.setGLViewport(this._rctx)}this._shadowMap.bindAll(this._programRep);this._renderer.renderAuxiliaryBuffers(a,this._shadowMap,this._ssaoHelper,c,this._offscreenRenderingHelper);this._renderer.render(a,this._shadowMap,this._ssaoHelper,c,this._highlightHelper,this._offscreenRenderingHelper);this._drawShadowMapDebugQuad&&
this._shadowMap.getEnableState()&&(a=z.ortho(f[0],f[2],f[1],f[3],-1,1),this._shadowMap.drawDebugQuad(a));this._drawSSAOMapDebugQuad&&this._ssaoHelper.getEnableState()&&(a=z.ortho(f[0],f[2],f[1],f[3],-1,1),this._ssaoHelper.drawQuad(a))};return p}()})},"esri/views/3d/webgl-engine/lib/SSAOHelperObscurance":function(){define("require exports ../../../../core/Logger ./Util ./gl-matrix dojo/text!../materials/internal/ssao.xml ../../../webgl/Program ../../../webgl/Texture ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../support/imageUtils ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C){var E=b.vec3d,G=b.vec4d,n=f.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelperObscurance");B=function(){function b(a,b,c,h){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=G.create();this._rctx=c;this._programRep=a;this._textureRep=b;this._requestRender=h;this._emptyTexture=new p(c,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:4,height:4},null)}b.prototype.dispose=function(){this._emptyTexture.dispose();
this._emptyTexture=null};b.prototype.getIsSupported=function(){var a=this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),c=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return a.extensions.standardDerivatives&&!(b||c)};b.prototype.setEnableState=function(a){a?this.enable():this.disable()};b.prototype.getEnableState=function(){return this._enabled};b.prototype.enable=function(){var a=this;if(!this.getEnableState())if(this.getIsSupported()){this._enabled=!0;var b={target:3553,
pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=h.createWithAttachments(this._rctx,b,c);this._blur0FBO=h.createWithAttachments(this._rctx,b,c);this._blur1FBO=h.createWithAttachments(this._rctx,b,c);z.dataUriToImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAqf0lEQVR42gTBB5ydB2EY8G/v8b7v7Xnv9mmcdFp3WpasZUuWFzZgDJgkhgwoSdM2JbTNjzZA06ZNgaRJWtKSEgjDGNuA8UYeWpZkbZ10uj3efu977317j/7/4De/8ef9vCow2VUGGHzRhuQ+t08GvhZb+jy85wOu/68JzwtQSCZedpsvC8SL6NJNNwZoHMaZiMoCrjrPATpGJFxvRCYMKqTCBsyVw8h5B6ROArU3+8HOGLe3Ay+UABow3D4wEcfOakDbjh2h594mikMNcI62ISNzIius0bfeN+QHrv+L7M53FHq1XC29breFgmCjwPHQ/fo88OIg9kvDdQPhB93G8yk6DtRYFT64fR/jQn0NIcIgYHylyFjVHPBboCB7HQ5sXuoZqQCHqKUjtvKNpvxkivqlZe514DOA/Keethib6OkOw204MMTjY3HX8VIGFeITgBEApGRFY3hyKyPeRWK/NNa2huJeLKzBJAimiY7ZQbAh0HwPEP9jxHhs6he37z8+KWqdeD7TCttNwgHftJpfzCq/iOJbKrxap2Ymet8zwVEoNReE7T4aI6t2mBuO4Meyh3vHAeK2+KvLzWHEgSCJpgR5EvP7QPFLyeDWWrqc1iVz6LwPI7GEpOEExCwzVZwtKtDGyzRW5tGyz5WA7HLtfrOIHp9T9kXQB1z7E10eYMytTs5QOuci8E+YIk9W/roj5nxvjVVLaM+30x/09CPGIdQlfsOe/WqxoS9Sf5bVv+drIqyP6uNrQMxFGDPSt1PurVE/UcuV9ci35bmCPTiIjsuZZjZCePj01iMbKBYa7UyVIDI+MDMSAV7sw6CSjKEG0IqwXhEkVtFwFJQ9D3q9q2RE8xEzuxvCN0Bq0pAFH7IMZEW3/zQU6rQ8Dw1bqPE2XCxtht8B/Hsg/yzu3CUcGdb6PW6QCVRs7bYKDwDQfYefmmJO2O/d4LyOzns2kA3kt7Bxrn1ZZ4hlYFs+uYpAnNDyDI36VE+6wLadkEwTwQIdYovCIM8SEVS24D+ktuqjWIT4yWFEN/zEfsqIWkFfKQsW8DNVyLEDKWwZ6ew8x5ojpAmh7DbTuiCGFcW/DXl5hO7Y/BztDCbwqtMaxcanBq59oBYuVIAM2o2twXHduUpDjChd7xinXHoB5OKsvd/jlrN+SnHoir0dn1hWWSbrDzj0Nd6x3PUb1LYyVIpv9AHW9sPW+aEhU8peULyaAG12TddDnq0zVg5S+vfnVLQBwjt3PcU9k0feDfAkCjohqkfBRgeVfcx1xYcTzRYoNbVPbCQ/mmC66x3pMpN7IPDeT7a2+TYYDYj41QNoEoGVQhPLlIPb8k2yMZlM2gNIiEu4nfIZFKeDW08qY9ds2wLoLWIt2yJuYrXnWhNbytRVs1sHIw6qhoE/sYJsJArzFLNdUzxalSOyF3oIBU2ttqZFumoEj6XoZVOHKWSJDoGe+WGZmObQuA4f+uap/u15hOEW1LveusgkSWNvivQRRg7bAQWcd+wUcmN/DTkr6XeHmX/pVnYkebSt/RBNP8PhsXnqFhfUu/ozIH++g98KYa+EnqoRZtFucB/WVPy5MoJEyH+RgSeFoTuDS3Rjpi7Iog/+N2aD7N9oJkprVsWpNOqZ5JsMfDKSID//tUCyQrANUm4Q/czDP1mKVTo2lrM6uuJh9RV3pMc1ylB/5zpYs3EWgR87+hDYZY06VIzFYd+HxTY9FyARG0RytMQAJujsU3Pz/qPlwVVI99+KBosYv4qQOzQP4WWCfPVd5eSjvPMmAkY0LFL9lX5vMfDKgtMADu3pCrNLctVht8XYBr6KRvBkWte8jafxscvmLE7tITB4IxDf4GJ/7YdtklZdgOO6z62Bj4ADitP0UfcQAiwSnoEgw44j+mCCpjb7zL2IcBSOYLS5ArdRgU/EJrsgnLhuAgv6ylO+fTYJZMPiFVUt4bafDNpq8gW2/+Wc1LSVejMjel0a5Yg2kUT1DzSmbB3aGVsieORVfXAq7vYkeQUZKUHxZlufMOFKsneeaJYoxjH4j6q2BObSoPx+o2RkzKti/lyb2uC7h60bB4z9maJ4tnFpvw/fQ8zfJ3IAAiSE6G2X40l/PFI+xGgcAjM+/31BL8p1KGRn8kFaztzEFxsAfOxjR910VTxaqsh6/z5RGNebzyWtoossscYHUPKL91d9BhtQTclREMGf6PoMnmDJ6orHxKl7RZO9DwAIBqRCqlbTHs8hf0fa/1ZcPuxk/I42xYnbafCqgGGatSnGPUaE/1azHhdzw/rok76dX+vslH00lkxaRKfW/wwn3mJTQOH5bu/vzgMJNnTuAvJMFL3p9f90ttxSrfnxNusCI0spKhX0O7XBAHcouivCT56YhuFE+A4vrQr7VfSfeXbsbpt4rbhpwuNPNBagcd8A6DO4PgSzeDQ6lGlIevQ2yGyG3fn49mPgnTNJZqVuLwC8E3FFyBozgL47rtOWlrXOd1s/dRPjgYmLAzl2dWFOGk+bW+PStap2Xm/ERvzJdDYd4fd16N3x3ooL/FzJ8PEPT4H4WRk5ygiRK97yrjHU5p/69gdFfUdLiDlYG0NeFYyjRmZNdLM6mDPgwceejmpR8ek2Pm02WQ3ZqW5nCDTpL9931LtJdladOI0oZjCwoGICD1xZV4cYZxIgzhjekCf9wh4+jDU5IjvsdEm/12T6e0aJ5YqnS7ROWkWBX3FAnboqd7c6kAcAxZwBS3bSAZcH0F6pV/7AkfvSEzW3fzrp1VvQjkL3wetuK7N/CV692ve/zNVq5KYktPLl/CMDhNzFjT6ZOIK3RgxqBaLxgL8Aoc+F8MeP7gFuRpXbCDtlAbL10NvMh/tsocPBVQx9SFIIiN0CNzcipYWwz5GmjGWiarABr7U30U+uUNtF9/saPWDaKnox3JOtzsKvq1INHtwgug+a9C8U+XIiPGGIWaCNg7RE1WFxot+t3g22M6JFGzGOpSzmpS+ODP4Q6RwuwVKDW0f8olQHYv4Iwf51NAr0mmJoXL1TpxX/Jwq9m3b+wiCKtLfiNrWV4I/5xBkDPvnpZ+Q8EN/Czdf1bA+T5A6JpRxP74kwUm8y12j7Jd+fsDMtag5nJvLUigJjbnooZikOBpxD6T+Nk7Ln0kFZlhujYcHz/L1UK05AHRt+gErP4E4f5gKsX+O8TCsbUG1hHj2+vX3Ng7bL0R3a5KytLaPmeay0xND+gBfUj9Phq/2xfYKS87H3ta1Qso4H9Ca6X0hoMdy/IXM7QuhIVg9ZbI2oBRhk6xpX8qoHNrL9POGnrNERY9igV1x61qKLAvFcGoiRcch1N+k7LK/5D0D3eIobCG4s2iADwB67+vJqtk0Tc1TMkgQLKKRG4Bl48I3u2FQq/lO3XbK9g21Br2Wrcyobb2DqyLVhQbWbiwX3JdQGgLjIbjStUiveYGF6IpjdMZj6eyO1pSwXCSByV38TzEY2/VEpeAXdtABk0qq9aZB+cGf+ukGgq26f4iAJfso+9b38L3dfnIImHIwH4TRyf4e78yxS+Uxq6TugN4xw5XDxOoluqXYDJhgyxre24BJr10njnXjpWcTtWbdv4aXNbXQq03s36vFSR1oz9oxk321YuwoQdbNCsfy3tHAmMcnpdcCnnvFu3ffTYs/Ph90bPfqToDdPLPaNcCKivoo0Rwkqbsk1bPVbJpYxGIKUfXH4pK6H8fghaPY13icA4JO+NLuCpoYlHDM9EB75+kNH/n6o9zE+TRnBkkL8xiqWY+Q9ZzaAg4+fLzZjhNfw3w/gUQRFiPz+fPeS0b8aFIJGPC+rr24QY6gIO9YVpEO6A2aaeyYdXRMVVLdKluURo78cBmBt9EtRzeNaKwWKt2E84X3D5pkIp/iAp5BlCgOpbCJAGniU3QBwNA46JmID4zirCmjDcPth6PehZa+zDdAvOqltgXj53q4T5ealBjQn4yoLHxl7ENmhUxeNvsVRYwtikoW6UeUxgr9EMFvwiR9UeuVRYKur4GLqMtLds4H9c7GxNSJGLKubjwZ8TGOXLmgCr4e5uEw7XWCj+lNk1wMUOZOC/mXXfhLtvOu24Kyd7Rq3dEnkuAFo8DA4pyLpJ0zioo44oRxXdESQO1rq81ulq3WDJXbt3ADVNIjWg2a/R+JYnI2PeepVLB6LPzi5eMUa2/jvGWrYA0pIsd2Ax6mPHbLgJuQbN3uQNGGu19WDg/3b6lAnBRn9N3KlQsrLj5LkBOCnwk7P3pLX1ljdnh8cnPPerTvbJmSkWHISCPCTNYii/Dg4JrjaCNS+3DAPRwm9DyJkalkLQz4YsGNLFveiCyw6cE4MzvjUgRAl0jAQclYHdAaYaFVABepI4sP/oeepxPi9oGlSi3tpWIX0FzAOuE71y02MAmdQrbkGPmClGtJGKw+fOHi4cTrPd5qF/4KGkWmwqPqRP9fyB03ZL2FMBtc/W3/43eT17zGJUY+tBegRFjLJktlYf8TKpkmzJai8GvczudWw+UeEPcTZGuLLoFGDpv5YDH7ZFo4P1jmZ3TCjEotNcBqm155Pjm3NzFEKWKF7KcVY72eG4IF507vbNnbj9CwxsimhPW5KBT/cwpfvy/YzvJdcA+6n/B0d85Em9Jpj0SJ6LewBcL7Fw//+NzPSGw1uSqy9jfTmcJuyMzyA57DcJ7BZOkbPIcUXsDPjoMXY/keYYLd0Rax9ZOgJqJzTsb8onXqy1r3kKf8mbdIKVceTSXiiGi4/HR7Pt5tt27+BzW2VM1tj6lqIToB4087XR9bgOfSFKyGf5eeM2J0YhpmrH9/Uu2+28qDSL1av08BUz/i2dTounIci36M4SXJfQvpHifh6TOnD1lTMejVlfZUXf66md5FwdmEaOG1150HxOMK+gQNbgOZs0N1/lb7CJLdA8ILbK7RYCYPhDrXAb+xLMG4f8mFkDpBeyS5+tXLxfxPxJxjk++79i5TfpbnAivqN+HcMfaKsuVEQwkWRTQ6/a5BboYuIP2CsCo3BHucNjYkXfHt7YLxqKU/w4c/bdMrAM0RpawTOtWVdL3+l+Mr9a6KGHjzCdL+Pcs82YJuhXDZ2rh2NZcStekK3eqM4bjnwp/7yMa1OFl1OV3t6QPCo35w0tr2V7Copy7J1Es2x8Vv/HFIPufBxivtOv7nfIH2UelqlYzTdYMRhlOaizWtwONQqix3wIN5egwKRjEqW/h7rM7j0/YG2BRMfQkYeQJUQeo9nCmVps09F9focPDhOOXQUQMjU5dVeslBdgwfdev4kpssy+ovCLglTwJ6SUOXLRMTn3S0pz10x5bTC15u11cl30Nk9Jrzr0xP8nKHV48h0J54cVJqaeI9qlm1gjOB1k0QhXwFP2ObcgC+t0r1ti6P/KzA/SXo/IN0SMFjq9ZuIrLr9A1akw429QOUM5B5UEmUvRmTAe60bM1yWrYMPpCFXI/q4RWB0CWq9rGRvUP6uaKQ/IG34bkpJkt3ViM6N0IEnJx4orp2D+v9I4duJatlZ7BHsJdqYiWJ5E3tNwoeEVCoY2xmtrCoYT1IXAPjUwBP+UKQvs1zFNa06XEMiWsMnUtTlALgZWDlM1hWo28GbMfiUPvgdt/o7pfRflcM/cqANpekRiR1c1GDZum7sabObAKJGAiHtLqegHQC9DUL/UQuHsMQHtHGasfv6lruN/s+g4LNBZ8IJFEA+CQPYmvAjW3wuu8Em2BOLwXwZlFGfMPA9gYvg7ivh8mmQV+jMZCwMKS/nJW8SwW8HazdipRdLct7AJkj40MeOWg3QPwIrXSSc0ovjYScZv/py9VCo137HQyowz7J1BdefseFZXLWQTNmHRNUYHKOArrc1Ld3Tuhw9+iusRlGgUILvkENzEP00tfai71AkRVocwA0+urjxvsVO2au4HpYHBLzTXC5UGH9S7qA+0j8DO6I9fVCSn0La27FII/Qbem53DIga6BQMqMD2zzG2vQobkLxi4skm+av45lv9+w+7UIYVvifAu/74qdQWePGbEC300M0D1rtJrtekESHiIQhLqFk1c20F3oyQ/1MLh3NF2TCvWlpMoB11+RF/m885P9EFQfa2INC4bf0oSDykNB1c7ThJKog6qH/NiRykcxtxc2BiNWPBGQs03Gqy95X23pK3XS3Id6JoO1j/fb+rDEHXOWYCdF5p3D/MD/9Mrf9+0tmM5+43b29zk5/TG88Wc7/BuItg64CzAGDFRsPDYMwC4GPHTsRewpMoEvw7U5wNabW1NhdM5YstTBJvmeCl7EufAXYGheRUrgK3lAcnaBjUtvX7A1YCYrVzG4BI+Fs3u211IAOjITr3qxz1iQhYAzxcC97nqQcC/gNJ/ksGu21JMSvl4BgZhY+tDS2kbAZC/0+j2RmMSIBqxviUr8mBMw5m0irMJ0A6wqp4q7OS54rtv3SYfwE31V4hYBefEWo9yP7E3S6Ry/zAdvd68APdrcHzIBj1kQVNtfTmSN4Y1lvHcX/BxRMGVgizNziT1a+NL4f1ZGrBBLkAbTppStCqqHPLZhyPiDx3SKmtw205TO2WxMEQqkULr7vCn91BzmndvbHWFAu8GiSrgAZyZNMScbS5iAArlhrh5G4HedwL/wH2E6v+bbD1O455A4uBvlNoAUNKwqPsjk9+loTuhkiXwuigelze5UHCb/AJNKw2cc+G4CfE/Z0ZwVsDXSAOfr9R/gpL/ghGMJOL8BA2mOuKNInxFF6AW/7uErMW8sNkEBOBtXXXEbm30CCTJbxe6EOIbec+RTjqvdUflOP7AfgnkC8nhSIm3neEOmts61kCO/o2RP02eqWjJjzYn3A/WgFSoyAwj64gKr0H3nFCK7pZt2FDmwwcSqB3YBMgY3HXWDAoBqr9PHSGIeh/l/QZXZpL2wpO7AylAwZ87Pce3z6xUVvn4SNt0I8zpte4alIJpNWn8cjfSE4UKTvooupk8qPXRvFrmj6smvX17qSIX9baO7HYIjg6IqOvJIEg3tVQ9qyR25F2fx7JpzrMHwCdjgkYRexElPxR1RDICwMQssAVuoCZADE5CJ9ZJS8LV/rUdEFDlFhrI1yQ+/EEZmII9DDLO54bQvrj5cmbQPfa7cH/UOQXdKzucZ2IOklamgTnaRQuwQ/+x1PS39leFqUqIMbQ9x6YH8xs9TiGTviU6lvwehYNuM1i85I+gNg8DiEuTIIk2iOce93t0LQ0udyF6JpSw2dw9G1nJVmKfxT36xJryH6PzgQR9qRD1Mm5e37Mygzm/LbTyeGse9tUbxKBlqB2FtLmQgRT0XuwlEeSNxcWvzw98AE28vXwWr2FlIrAWsXu9Qf2Q3c/wgIo6RZJ5GQlejmceYZfebOaO8nDj/iTnf8s2C9IEEsxD0K57+JXP2Utf9NInQAnGuzKs458w4LXRbgQ9GaWxz4G11+LwAVYeMNM7iHu6gv4qVhtn2OYKeKRJRdJHF61unu1ms8j/2aR7OYTz6aWX1mXRDFnB7aepsLG4BHvkkwVYqa/DYsRNiB3CDPZ2q5Kr5L8oC6j5ULS3/jzu6tf88tQ1tTXmBhfdwgUwXDbbt33gD8woaq7sVQiLnSMXLTtZzY89fkny98x1N8pSu8ETpNAIhg/T8GIQvlae9NA9hx0Nc/krzNurU+PlTodk7+HO9MBugPzcYk8hFtQfN/X7klPxXMLqKf25wcIYKZhb/Htf+L1Uc18kw5jZOGML5c98ZDc5yHfzmVjvWqAh2URb7rTpwH7Z5Z+n7SJeCIdOVzgdwzy80P8Hd9okBHiZ/rd9S+Vrvw4zFlirKiTK6TcVpw1zP5HqVhBXt6RhPfu3IsNMMHfNPSZVSonE3UuRpsMiGM3OJSv93QnDntYsYtdGVuljAmJA47Bndeazv44WQHWORbVjGCIspejDdhnQEoI5OYlcXg5yt52/BHhWJF2Rgxn5H7RStg/JEAf9XnV5j1UAfm2Iy+qgJmEmxTPRFm9jxx0wK5FwlHNEHBPdTZ53Mfs/p00dG2Ren4MbqsBCHPX40CcaD98IfZyAX/LGkYN+CRygtyrER/0WGlb84sVrjlknK7HuCRx0us3BOkONLiBYUCABPNb+cChaP1nBEzlW6DhhQp4wS7EaP8jKzkYuZbKviVem6ZHQsCk7QpfziL22v/or/9J1/1wUns39AYhbg+CwWbwRuSzsQTe07J0eMfvMWHVtaiDsBwCaUJapcqMVu/+bgG9YOOvJ0rvKPZQBrhYhc4Z5hMKxupj1xvFyWmg1W5N56lDJHzoDx/cuAshRzC4RgMiLb4Q2pN8r9bnJc+XUvwe3YZ5fcMVHyusfcuXdpv27i51WA0lbuZsfK3s5de9lWW9zXCCmTWIWhI18QtJZ9RNj1RbAC/ACLbCUo/Cit3JZCjjtKR+f5zdBJtOH2uWGr47tDtauNpKbom3Vu6n4oxtJhFDmzaT2pc62ZPu0gKZ4cnId/Bp195CRRtJRKMX3+4KNbD9NDEARUw+Dj82NV0k8VggVL8EZM8rwKmwWWb4ZiA9mmtNR/6rbulcqybAyYcAajMrvmsCHZJlu0CItUtWhsU38uDA04ET8wqzujLFgSgRRzt+kXEaAKwDm59pL/0Y4byu6kKl7cTK+UR9vb7pvG1tF02qxaRg1uiHnx+g7wOFJdw86CMbIvQEdeeHfeLxFBSPJn5VXZvyXLVsJVZjFpf/G5N9TGEn4xIAIx1aZlnqNx48+fxpszhYt1rUyHKHyqS/reuRCO8KEKE/+p90d4cP7dOZGBZrAe4Q2Cr6VoWFGp7KU8jzB6QbTf++mX28Qt7b0RpHxG638hMdZDlOSXXCsLeIhHkEgDBnDc48xzage9HPIxbGocP0yslbVL0Ed92bnx3d/O9vKImgbfPx20LzQCP7f6r+b/H2tmDTlvc+6g0PHKeaeAe5lUU2I63NVlYI5Hba+5RBXfNRT+s/tQ4/PTEt6013TMhfYY1q4O1CPEUaPZSt/QOqj9rMG3KYH1yhRG/UXcb6yZcW8U+k+wPZPCgBlgpNu8Kf+VLERKyNT9vbszywFAMfMpx9lkOsgwtg4j67egVCDgb+ZEV+Y3qxbUuniUxWX3sxPzIPegZS/ka7kue5Y0IwTZu5WqyB9RSCfE3Uwk57704/vV7o8av3lyOVAoQ+jppahwoMNvpxOGpVqrkEMMvAXy4/1nLZ7CXbF+Kq4DobenxfVH8/pClZz8kcJjJSt/V/IWS/l38JjraIQDwVzDZtH9eDrv81QfiKDZ1jLt12E1ftzmRWhx30rpGsWMCynxugBxI8c3BRcxANJ0r34OFhMkV49Gt40u53T1vkZujkMataE3APzs1g0F8IXsmQDntQsdKFNf6iGH8VLQGmiW3JPBuidQduZTq7OqgW5JykjNnmiYjhbLj8+P7cqCWZYZRrkQTaRDf45QL5RUW9XKQDYn5MF6gY8ryV/nXW3qQrGXcQEKwbvgo4z6HJe/l20BOgwI4GgQJQVMNVFiLM3ZsX3olzj1B2we3+Guo/EO8csQZWY33MdXWPW08uYR5nM+10sH+4/+NzncE/GNbn6voapCiKV4hwCWxfwQ78q7g/B6aP81fbEJ+wCzml/1fZcKYdX5lgUa+LB/huzhEU6bsC/HuPnLhb8Wg6ni/HtV9Ygzwe4IyOGaVdivTDbEOW8wcpQLHx/7eC3Zi8sy8oXu5DhE+kw1u06LV7AqFiBTzxumkfMOCJAaDW1i2H8GXwYpRK1uBaofc2xGWoiG1SfQOZZd0xdeJz8d58GK/YijySB0J9Q+cPTWd/fav6mWhmSO8Q1NbxYhNAcb578XuSsC1uvGTGXkoqnwE2LrPE4WXsNmR+dr37NhPqTXwkhI99/qiruLWDhPRfke3BzfdO0Ym4QFzArH8aMPeu75kh1CseVwnsv8eZgrp91VD2VNU2J07EI+ZuhsZro1D0FpfMsrN9T7l9p9GKTy9r7nBy5t7G3PJk57ic3KRV0fbnLkfXYjF0cMEtFJzX6tUctEsk76FuiYm6EKzekXpHANhG2gts8KgF2qDT9Ady9p3FJLXcvD25D//CQrhEA4ctzFtu/O1u7KgeZ1Lgehq0AnjThaOUIIg7oyTm6DQFQGxYkfvTSD5z57MAe02y8MhnHbc3kWCVWgQS5KFidDa1hijkDgK9HylNiIkH7XUrO8mGx+CxPLJ6RBdr/s20MPBsaIkt9iU5tym3LEP0dJx732kMJwDPoVwVGRLds0r/XgQ5tHsywG8kAgXM0DB7PeFzbWyWa93IoiNSjCBLB+zoOu2+108JuNch6SnYLid74PzEj7llBoIHpx7hDqyxHrF/GasXOcNsJUiWOCPPptVgZcrbrM+/gYSTsRQGWXfwbi+2QpryYDX91ZRFe+c74jbKkPWQeYJdeasX+669/9kssmTPRZwQeXKLpE1E+wMyRDnkcUh+wZGLtPCR7U1wokVAtb7GMvgxlM9qyhlaafSIiZSV2vD+PkAeQIjhlvNRwBAevJgfJOo8qbpPQ2lV3ymUV1TQolwR8JBjKHETgw/91SRAJYKWvUwY46fq3dmcPUTKvlFYHq4cWmVrkV/zqAmy8WLPDahcp4/cpPwdQXMEimgoAXgeHsB/4wcD4WgpYL2kvse//ZIdm06Q86YrrHN/K2SfRJ33m8q3c8ZOC98HW3tg6JanGyYpF7dQgLGiKVfQ9BSfnsWrmyqiJkSrmImzcgVGKVKYrTVWN7tf6d09g6JtyFuSLqhgFsKE9Fy0wFs608u58BMfHhXUar/Ce5muvzisF6JoXe2fcbJTln4mpowiRCwa1bKE6YQTUT9l2z2PjQjcg7OFOC2z8RtLwKey7nwpOL7UIOmIcqMA0iv93CeLhhdhHK4m+WVcKc6sqRqPbXLI16EKsbTpOrc4BMRmvPYq2zwSQVf6zmEllfa8DyVodxwKuwDoOxBniJSY0GaSTDsOqaQq/TpWPIHx64a5xoLT7VUtdG8H8OA3t0HiED0CijKwqttKb740UfZbUfUqGDsNpefiSl7rr/f83Q50h3RzmP+FgiNLqYstIw1HsxCxO+NEcqIwD1RLyafv9PRS1ILpg6J3x9QLGncu4++SB34Fv9pKDJ2lVkflsOoIdszZhLGgK6yT3sT6qIAYAGSBuEik+gu6XOLEgRo4G9MPE8n3jPXHO7aczYZ1+58G+f9MLf5MHd1ldxDeLWLZJoN9pgofnfxs6YhJmWY95DHASjIJ7z4lgpx/SPVFkL0J+49CDoRHdmCHKHKzSLUtPev6OAMuUMQEEHouvSjVNk/k3u7co8aJ+6ADVeEupccQgcHC7UHvmhdNBOLdkMUixyPyK5y5ExMa1LU8oJ3sOnIx+RekN9rAOLaHYPY+Mg+Y7XM8dkgU5p0NAOF36Npi5F2nrS0C9fUadVLAZStsYtK4z94LmF/r8P5vHAT/Fou9Tm8cbjNGvPSpfGe9jhgGmhEpo965JlCczvY8rexaSSe7OVjwZnN2Ob0XkI0+vIwpbCs8lTFWA3WPBZ+j2YdrQXUIbCB4f3E+ES1oGFtWgKXRWKbVP8KnH6tCcoS3ie6H7TTq8e/HEl2l9buU/IptFZByo+5URfMLrQ3UGn29p2sMOyh5u9PYYuA+tOC9Dtsn0O61GrW8Vd1aH6ESfgC5Jg/P8EeGoNSrO1RuOKZ6QOKuKyDdGpj3XS1dR40xjXig7TSGmF9BUEK49IG27ZCocDx5yYHgIKBh8yjbftWO9QPkIibON4Mkgr6TQvea8SNccZVMwuqhXXh1GcPOknL/us4J3nxgC/7gSJD6ZPnuEYD5h5xabgNFEADolRV4z8cp5UeJB0vLK0bCTjKuGoBUQPwToZ9JDn5+w5NxIp4QtgLQBtgfDq1Oc+biHviY+Jm56YXtd9rtk2tlOP76Fb93EUwCcuET2W7HdYPAfxuz11rhA9bgJiSxErg86pGuTrrkL8nelqi1o1VcikcTFPFpXBsQkF9hrfTG5MedxuuME2ltj2r/X8zXK+ZOiW1l5EdKm0wYA6zzCzH/b+cGOyASKNKByGzhU+dk/DSiX2v6GbD0sUznKsJdgSIpDB5vsOUmpSXMKxhQJdBh2zQB9Uga2d7mF1i5Z8Pb/mg0GVkuNZFeFdf6/sQsRJ50cShX0xvFi14EdTAyK5xklct0uG9dU9Ly1BB7e4OdFA2kzjJ4+m4cGSTZsV7nWyCf6oBZWxqinVt+YsTvf6sQA1rUNjuKCtq0KP8EGoOrnXterJwiZH5WDOMJ9wiaTF4E1V6uuU/1KwyzJ+H1nMWLaG9MzrZDB0QJOUnUSxKEth9LU1tb7gYILPvJutypcbbUg/cb8KOPnEjRaCOkwJVQYECuiICK6u6V6FnMA4Qdf4LKiO9CPrEHjf0QCB60rN/YDmrSfSJweSDouFYaper4DVl9KMj8Qq4nhIkrzSCV1VtB8Pv6oXTxphryWz16RTVKqPbbKq9zbQasDtcKWRE9WvP3FNcsICp2kRWQCpSzS+z4+Er1rJgNglbTAWRqrATd8ElRNLkfMfFJWHPwNMPW7vUSOpc9im7UGfizlYOdvT787XWsxMF36s1xPyQov0uMDNuh7HVeyHWziyzKJnJFH1zyJG7twS5yiydQvr+9XtYK/mjNWUEdhgM3TJsWQEK3aaE+HqwUhLE1b65h42a1E3HMqoXuC4BzlnNuEIgryVdgYucd4NsTHd+tf+jBWV+6h6kT2CgOBmdI7gEfBrIYkOCO9tZGY+K770tcEjoG+l/rLT2tDByN06xhRUokM4Ltw8U/fNh/ydTjO4JddSFJ0n6Z9SMiz3lreKURYDM2Z+Szp9+zXvKr6SE29NRrJAGbmRjkSxi3sOErHFrB10tJ2uuT+/tem+j2qexl1P1B2DlgxMa8kS4WHKFWv0vqTQxY7YqnQN8jE+lmv3woeUknMmJciOh8HaLQ2A4uHN+oXYqBkyrckpNz2iLo5vZD/nuEEs/JWzZsCcp2U8YtsPcGQNdIOqvcZRD40+RjBs4WmDr7pU77XhyaIrC93dqsR+qa8BHQOWj4Bu7/Ha59bpCbhRoXY5nTHcgXGvNW2VGXpouirMtJDL3cggbY4AV6rYdtSbnCb2FR0Z3oEVYPa38SZH/o+79XTKl48AVc9BeBWAJbggJXJboVa3PUkSLquk/t1LtVD19MizUfx5LVJ+bJeSq5krVfq1glKB5TIifOV/Do4YI96WDkPPZoWbriIDEdfqy828yhXsnn3/Q6xwJvxVRu4ckHYGnN8zaBRAdlIQwaphWujvdJ4yQCnsPlge7wXDKQuPB5N5wTIyBk/4aw/x/R8SmxQAIM6p4hOxgaYEqGMRpnHcImrDOAMzoXe5VuTKeSPwTmd9FAoKsDOcbGwJsRslfufhCPDSOeWxn4MGty5kg1UIKiP9KtE0xsFPeMLKY0a93YsRVF6su0Tt99uEIYYhogYODAIeFhKqEoyScLyLpjtsnsKTisrwea2HklEPbCjoHgxYi/aPGvA4ZvW8U1dmnMPBgKzwPWT0KUDrRhLPZrT5vB4pMbfon/pNjubIqSAql2YwbQQ66PYVPKvacgMpbKeSS7HSboMBqsLqOFLRlY6bT9QfjaHB7bGfcHQrij1HeGzjphnmbYO359jhvWcLnotM4nsaKU84N3l6nyqRVAQ2K1lrzE659W4Y8ff/hhirkxkgauyvgHNf5Azu8xxk+geLrsjEjx7wK9Z5DodQgqFhp5dO0L4xmvV4M0Y0SFL0OEAVJhhZCKKOnUEM+8TXV/ijaeWGRfwFcNXeQQ4Y7jPytH+ZKzujr6KtApadQaVPlBtAUtg9thT+0kGoo/CvMwOHLTWLuQAvZKzCXc2eFg388gR0yblNUY5JXJ0oFq8N6Et7LKFG367qbWxTUnt3vgemDfAeCT3iMX9+ixihTYoJQGQduFd2K61cIwIDy42PwyyfBAlB69X7pGJWNsTubeIzIBLt1b4a6OQB8ptWFIGIquvVlHu0wqhWx6QJPCQW+8z2h0mDaBT+D9Wddq+oAV60yhIgprTSh7klj8n15U6kkIEZluuJjvLpLZU1QoduLnoIodg37XTJlN/Y0gfKIMzYFZ03d5Wt7iluXVifzY6pDCEoLJ9wOz5Hy6CR/+zuPZFZd4t60NpSxXp6rd3nWq2NfD+YRwSdCNRPK6Lu8LkjZpvlgn+wl0xjLLDD1ixtN0kEMsMAhr8NFsCh6wXAOvrUOc0oEDDrlq9fZH0o8qXnYcv+cXGJweDpW6T2+Lt5q9nFKfv5/JnuxsfcdFm4RMa+wwv/5WLaaPCuv93AxVUQE4R4hKhMQ0H+TkXrcoWciBXUUSWJatVI4SzzvRkzb5PRI+wBz2lOju72rUh1j7mdyWptDkPB/q48dgfBzSCRDyLK/iwy+4+Ndx/I5XmXXV5dlkcnObFaHFJvI5aKgJzGYQ6qpcZ4zooB37BkE9QnAQ5rfxPDVE0hJ2oN6rBryoUXU3OiuuHV/IygkyxwkqeK+YUcsBo5CdWKXw1IC1oZd3U4uKEx93sE1J80d0cKwYmHeqt4jBHVC3p84ObsRrrlbAlJtJcKYXRdj/HwATFUYLcKM1oAAAAABJRU5ErkJggg\x3d\x3d").then(function(b){a._noiseTexture=
new p(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:N,height:N},b);a._requestRender()})}else n.warn("SSAO is not supported for this browser or hardware")};b.prototype.getQuadVAO=function(){if(!this._quadVAO){var a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._quadVAO=new l(this._rctx,C.Default3D,{geometry:u.Pos2},{geometry:q.createVertex(this._rctx,35044,a)})}return this._quadVAO};b.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this._quadVAO&&this._quadVAO.dispose(!0),
this._noiseTexture&&this._noiseTexture.dispose(),this._blur1FBO.dispose(),this._blur0FBO.dispose(),this._ssaoFBO.dispose(),this._ssaoFBO=this._blur0FBO=this._blur1FBO=this._noiseTexture=this._quadVAO=null)};b.prototype.setAttenuation=function(a){this._attenuation=a};b.prototype.getAttenuation=function(){return this._attenuation};b.prototype.setRadius=function(a){this._radius=a};b.prototype.getRadius=function(){return this._radius};b.prototype.getFilterRadius=function(){return 4};b.prototype.setSamples=
function(a){this._samples=a};b.prototype.getSamples=function(){return this._samples};b.prototype.computeSSAO=function(b,c,h,f){if(this._noiseTexture){a.assert(this.getEnableState());var l=this._rctx,k=h.width,n=h.height,q=k/this._BLUR_F,e=n/this._BLUR_F;this._ssaoFBO.resize(k,n);this._blur0FBO.resize(q,e);this._blur1FBO.resize(q,e);q=1*k;e=1*n;l.bindFramebuffer(this._ssaoFBO);G.set(b.fullViewport,this._viewportToRestore);l.setViewport(0,0,k,n);var d=this._programRep.get(8>=this._samples?"ssao8":16>=
this._samples?"ssao16":32>=this._samples?"ssao32":"ssao64"),g=this._programRep.get("blur"),m=b.projectionMatrix;A[0]=-2/(q*m[0]);A[1]=-2/(e*m[5]);A[2]=(1-m[2])/m[0];A[3]=(1+m[6])/m[5];m=0===m[11];d.setUniform2f("rnmScale",k/N,n/N);d.setUniform3fv("pSphere",8>=this._samples?x:16>=this._samples?I:32>=this._samples?K:J);l.bindProgram(d);d.setUniform1f("numSpiralTurns",this._samples<M.length?M[this._samples]:5779);d.setUniform4fv("projInfo",new Float32Array(A));k=1/b.computePixelSizeAtDist(1);d.setUniform1f("projScale",
1*k);d.setUniform2f("screenDimensions",q,e);m?(d.setUniform2f("nearFar",b.near,b.far),d.setUniform2f("zScale",0,-1)):(d.setUniform2f("nearFar",b.near,b.far),d.setUniform2f("zScale",1,0));var p=2*this._radius,n=E.dist(b.eye,b.center),p=20*b.computePixelSizeAtDist(n),p=Math.max(.1,p);d.setUniform1f("radius",p);d.setUniform1f("intensity",4*this._attenuation/Math.pow(p,6));d.setUniform1i("rnm",0);d.setUniform1i("normalMap",1);d.setUniform1i("depthMap",2);l.bindTexture(this._noiseTexture,0);l.bindTexture(f.colorTexture,
1);l.bindTexture(h.colorTexture,2);h=this.getQuadVAO();l.bindVAO(h);l.drawArrays(5,0,y.vertexCount(h,"geometry"));l.bindTexture(this._ssaoFBO.colorTexture,0);l.setViewport(0,0,q/this._BLUR_F,e/this._BLUR_F);l.bindFramebuffer(this._blur0FBO);g.setUniform2f("screenDimensions",q,e);g.setUniform1i("tex",0);g.setUniform1i("normalMap",1);g.setUniform1i("depthMap",2);g.setUniform2f("blurSize",0,1*this._BLUR_F/e);g.setUniform1i("radius",4);g.setUniform1f("g_BlurFalloff",.08);g.setUniform2f("nearFar",b.near,
b.far);5E4<n&&(k=Math.max(0,k-(n-5E4)));g.setUniform1f("projScale",k);m?g.setUniform2f("zScale",0,-1):g.setUniform2f("zScale",1,0);l.drawArrays(5,0,y.vertexCount(h,"geometry"));g.setUniform2f("blurSize",1*this._BLUR_F/q,0);l.bindFramebuffer(this._blur1FBO);l.bindTexture(this._blur0FBO.colorTexture,0);l.drawArrays(5,0,y.vertexCount(h,"geometry"));l.bindFramebuffer(c);l.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};b.prototype.setUniforms=
function(a){var b=this.getEnableState()&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};b.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};
b.prototype.drawQuad=function(b){a.assert(this.getEnableState());var c=this._programRep.get("showDepth");this._debugQuadVAO||(this._debugQuadVAO=new l(this._rctx,C.Default3D,{geometry:u.Pos2Tex},{geometry:q.createVertex(this._rctx,35044,Q)}));var h=this._rctx;h.setDepthTestEnabled(!1);c.setUniformMatrix4fv("proj",new Float32Array(b));c.setUniform1i("depthTex",0);h.bindTexture(this._ssaoFBO.colorTexture,0);h.bindVAO(this._debugQuadVAO);h.drawArrays(5,0,y.vertexCount(this._debugQuadVAO,"geometry"));
h.setDepthTestEnabled(!0)};b.loadShaders=function(b,h,f,l){a.assert(null==b.samples);b._parse(c);h=new t(l,b.vertexShaderShowDepth,b.fragmentShaderShowDepth,C.Default3D);var n=b.createFsSSAOSrcObscurance,k=new t(l,b.vsUVQuad,n,C.Default3D,{NUM_TAP_SAMPLES:"8"}),q=new t(l,b.vsUVQuad,n,C.Default3D,{NUM_TAP_SAMPLES:"16"}),p=new t(l,b.vsUVQuad,n,C.Default3D,{NUM_TAP_SAMPLES:"32"}),n=new t(l,b.vsUVQuad,n,C.Default3D,{NUM_TAP_SAMPLES:"64"});b=new t(l,b.vsUVQuad,b.fsBlurEdgeAware,C.Default3D,{RADIUS:(4).toString()});
f.add("showDepth",h);f.add("ssao8",k);f.add("ssao16",q);f.add("ssao32",p);f.add("ssao64",n);f.add("blur",b)};return b}();var A=G.create(),x=new Float32Array([.186937,0,0,.677503,0,0,-.782832,.128424,.557187,.248064,.460317,-.659755,.062892,.918659,.312829,-.241031,-.814826,.224206,-.642866,.132138,-.45016,.145727,-.590568,-.626141,.005017,-.002234,.012668]),I=new Float32Array([.186937,0,0,.700542,0,0,-.864858,-.481795,-.111713,-.624773,.102853,-.730153,-.387172,.260319,.007229,-.222367,-.642631,-.707697,
-.01336,-.014956,.169662,.122575,.1544,-.456944,-.177141,.85997,-.42346,-.131631,.814545,.524355,-.779469,.007991,.624833,.308092,.209288,.35969,.359331,-.184533,-.377458,.192633,-.482999,-.065284,.233538,.293706,-.055139,.417709,-.386701,.442449,-.301656,-.836426,.408344]),K=new Float32Array([.837372,0,0,.723531,-.467287,.034157,.169582,-.31169,-.881801,.696236,.455215,-.204568,-.304514,.528086,.626381,-.053116,.222507,.037523,.199755,.311291,.916799,-.681552,-.516264,.501792,-.37127,.021088,.737477,
-.029503,.209188,-.95298,-.573731,.009962,-.154202,-.257345,-.905958,.282747,.370779,.527867,-.669424,-.601758,-.191278,-.708243,.271796,.782684,.535565,-.006867,-.015312,-.017276,.419958,.265628,.233036,-.543898,.554747,-.174055,-.079242,.053475,-.099539,.372042,-.339267,-.357362,.015781,-.011352,.042707,-.340564,-.272507,-.067725,.799249,-.127948,.586808,.450015,.01965,-.416454,-.506524,.323229,.206546,-.087316,-.311097,.466049,.146374,-.34528,-.045904,-.152614,-.926686,-.287529,-.665726,-.032904,
.246643,.248703,.637193,-.062541,-.073706,.495925,-.315143,.05946,-.116042,.075586]),J=new Float32Array([.186937,0,0,.605726,-.313457,-.097616,.003541,.781245,.283011,-.225029,-.373279,.274442,-.047511,.04992,-.226365,.627629,-.623617,-.463628,.133094,-.318299,.528128,.262035,.100234,-.09012,.178335,-.426972,-.666048,-.27306,-.207352,.05514,-.613649,-.063395,.060608,-.283391,-.41382,-.087565,.136768,.506126,.484137,-.593808,-.344603,.453164,.675326,.124799,-.697865,-.33502,.411337,-.09337,-.15271,
.002908,-.063582,.366733,-.699739,.401148,-.519536,-.585625,-.508413,.106482,-.428709,-.260221,.012847,-.118806,.016962,-.188182,.49945,.452364,.586617,.722539,-.23302,.111295,.202827,.066695,-.036503,.315842,.896467,-.039109,-.270116,-.080062,.613435,.508787,.538656,-.352275,.566869,-.666275,.887876,-.138341,-.434135,-.444711,.269156,.119506,-.029457,-.077316,.754474,.274125,-.13876,-.37082,-.73268,.332723,.568545,-.203992,.878922,-.430778,.541154,-.546752,.11786,-3.93E-4,-.083318,.059333,-.341406,
-.117017,-.318568,-.262425,-.457913,.848753,.89229,-.30157,.322416,.742328,.032262,.643827,.048091,-.078044,-.49908,.064858,.549944,-.796252,-.230688,.88978,-.010153,.397241,-.27645,.405666,-.46593,.131187,-.600166,.333834,-.078219,.73837,-.870169,-.411658,-.222175,-.492421,.741454,.293757,-.591244,.389112,-.388324,.792346,.578552,.088459,-.121858,-.437241,-.472535,-.374835,.302427,.721264,.057485,.204085,-.126575,.510325,.481492,-.579888,-.29411,-.82136,.156404,-.819717,-.042466,.456573,.079884,
.07019,.179002,.220279,.970222,-.088025,-.299911,-.234627,-.820794,.912112,.243306,.317869,.241336,.161841,-.721568,.301135,-.635993,-.0939,-.514731,-.089673,.850964,-.905087,.314604,-.098397]),N=64,M=[1,1,1,2,3,2,5,2,3,2,3,3,5,5,3,4,7,5,5,7,9,8,5,5,7,7,7,8,5,8,11,12,7,10,13,8,11,8,7,14,11,11,13,12,13,19,17,13,11,18,19,11,11,14,17,21,15,16,17,18,13,17,11,17,19,18,25,18,19,19,29,21,19,27,31,29,21,18,17,29,31,31,23,18,25,26,25,23,19,34,19,27,21,25,39,29,17,21,27,29],Q=new Float32Array([0,0,0,0,512,
0,1,0,0,512,0,1,512,512,1,1]);return B})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("./Camera ./Util ./gl-matrix ../../../../core/Logger ../../../webgl/Texture ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(B,r,f,a,b,c,t,p,h,l,q){var y=f.vec2d,z=f.vec3d,w=f.vec4d,u=f.mat3d,C=f.mat4d,E=f.mat4,G=a.getLogger("esri.views.3d.webgl-engine.lib.ShadowMap");
return function(a,f){function n(a,b){z.set3(a[b],a[b+3],a[b+6],Aa);return Aa}var A=f.gl,K,J=4096,N,M=new b(f,{target:A.TEXTURE_2D,pixelFormat:A.RGBA,dataType:A.UNSIGNED_BYTE,samplingMode:A.NEAREST,width:4,height:4}),Q=1,S=2,P=[0,0,0,0,0];this.dispose=function(){M.dispose();M=null};var O=function(){this.camera=new B;this.lightMat=C.create()},T=[],U,W,k;for(U=0;4>U;++U)T[U]=new O;this.getIsSupported=function(){return f.extensions.standardDerivatives};this.setTextureResolution=function(a){J=a};this.getTextureResolution=
function(){return J};this.setMaxNumCascades=function(a){S=r.clamp(Math.floor(a),1,4)};this.getMaxNumCascades=function(){return S};this.setEnableState=function(a){a?this.enable():this.disable()};this.getEnableState=function(){return void 0!==K};this.getDepthTexture=function(){return K};this.enable=function(){this.getEnableState()||(this.getIsSupported()?(K=new b(f,{target:A.TEXTURE_2D,pixelFormat:A.RGBA,dataType:A.UNSIGNED_BYTE,wrapMode:A.CLAMP_TO_EDGE,samplingMode:A.NEAREST,flipped:!0,width:J,height:J}),
N=c.createWithAttachments(f,K,{colorTarget:0,depthStencilTarget:1,width:J,height:J})):G.warn("Shadow maps are not supported for this browser or hardware"))};this.disable=function(){this.getEnableState()&&N&&(N.dispose(),K=N=void 0)};var ca=C.create(),V=C.create(),e=w.create(),d=Array(8);for(U=0;8>U;++U)d[U]=w.create();var g=z.create(),m=z.create(),v=y.create(),D=y.create(),L=y.create(),R=y.create(),Z=y.create(),ba=C.create(),ja=z.create();this.prepare=function(a,b,c,h){r.assert(this.getEnableState());
C.multiply(a.projectionMatrix,a.viewMatrix,ca);var l=h[0],q=h[1];2>l&&(l=2);2>q&&(q=2);l>=q&&(l=2,q=4);Q=Math.min(1+Math.floor(r.logWithBase(q/l,4)),S);c=Math.pow(q/l,1/Q);for(h=0;h<Q+1;++h)P[h]=l*Math.pow(c,h);C.inverse(ca,V);C.lookAt([0,0,0],[-b[0],-b[1],-b[2]],[0,1,0],ba);c=a.viewMatrix;a=a.projectionMatrix;for(h=0;h<Q;++h){var p=T[h],l=-P[h],q=-P[h+1],l=(a[10]*l+a[14])/Math.abs(a[11]*l+a[15]),q=(a[10]*q+a[14])/Math.abs(a[11]*q+a[15]);r.assert(l<q);for(W=0;8>W;++W)for(w.set4(0===W%4||3==W%4?-1:
1,0===W%4||1==W%4?-1:1,4>W?l:q,1,e),C.multiplyVec4(V,e,d[W]),k=0;3>k;++k)d[W][k]/=d[W][3];z.negate(d[0],ja);C.translate(ba,ja,p.camera.viewMatrix);for(W=0;8>W;++W)C.multiplyVec3(p.camera.viewMatrix,d[W]);z.set(d[0],g);z.set(d[0],m);for(W=1;8>W;++W)for(k=0;3>k;++k)g[k]=Math.min(g[k],d[W][k]),m[k]=Math.max(m[k],d[W][k]);g[2]-=200;m[2]+=200;p.camera.near=-m[2];p.camera.far=-g[2];l=1/d[0][3];q=1/d[4][3];r.assert(l<q);var u=l+Math.sqrt(l*q),t=Math.sin(Math.acos(c[2]*b[0]+c[6]*b[1]+c[10]*b[2])),u=u/t,l=
d,x=u,E=t,t=v,I=D,K=L,G=R,u=Z;y.set2(0,0,fa);for(var M=void 0,M=0;4>M;++M)y.add(fa,l[M],fa);y.scale(fa,.25);y.set2(0,0,Y);for(M=4;8>M;++M)y.add(Y,l[M],Y);y.scale(Y,.25);y.lerp(l[4],l[5],.5,wa[0]);y.lerp(l[5],l[6],.5,wa[1]);y.lerp(l[6],l[7],.5,wa[2]);y.lerp(l[7],l[4],.5,wa[3]);for(var B=0,U=y.dist2(wa[0],fa),M=1;4>M;++M){var O=y.dist2(wa[M],fa);O<U&&(U=O,B=M)}y.subtract(wa[B],l[B+4],oa);M=oa[0];oa[0]=-oa[1];oa[1]=M;y.subtract(Y,fa,ta);y.lerp(oa,ta,E);y.normalize(oa);B=E=void 0;E=B=y.dot(y.subtract(l[0],
fa,F),oa);for(M=1;8>M;++M)U=y.dot(y.subtract(l[M],fa,F),oa),U<E?E=U:U>B&&(B=U);y.set(fa,t);y.scale(oa,E-x,F);y.add(t,F,t);for(var O=-1,aa=1,M=x=U=0;8>M;++M){y.subtract(l[M],t,la);y.normalize(la);var ea=oa[0]*la[1]-oa[1]*la[0];0<ea?ea>O&&(O=ea,U=M):ea<aa&&(aa=ea,x=M)}r.verify(0<O,"leftArea");r.verify(0>aa,"rightArea");y.scale(oa,E,ua);y.add(ua,fa,ua);y.scale(oa,B,ya);y.add(ya,fa,ya);ra[0]=-oa[1];ra[1]=oa[0];I=r.rayRay2D(t,l[x],ya,y.add(ya,ra,F),1,I);K=r.rayRay2D(t,l[U],ya,F,1,K);G=r.rayRay2D(t,l[U],
ua,y.add(ua,ra,F),1,G);l=r.rayRay2D(t,l[x],ua,F,1,u);r.verify(I,"rayRay");r.verify(K,"rayRay");r.verify(G,"rayRay");r.verify(l,"rayRay");K=v;l=D;t=R;G=Z;u=p.camera.projectionMatrix;y.scale(y.subtract(t,G,qa),.5);da[0]=qa[0];da[1]=qa[1];da[2]=0;da[3]=qa[1];da[4]=-qa[0];da[5]=0;da[6]=qa[0]*qa[0]+qa[1]*qa[1];da[7]=qa[0]*qa[1]-qa[1]*qa[0];da[8]=1;da[6]=-y.dot(n(da,0),K);da[7]=-y.dot(n(da,1),K);K=y.dot(n(da,0),t)+da[6];I=y.dot(n(da,1),t)+da[7];M=y.dot(n(da,0),G)+da[6];G=y.dot(n(da,1),G)+da[7];K=-(K+M)/
(I+G);da[0]+=da[1]*K;da[3]+=da[4]*K;da[6]+=da[7]*K;K=1/(y.dot(n(da,0),t)+da[6]);I=1/(y.dot(n(da,1),t)+da[7]);da[0]*=K;da[3]*=K;da[6]*=K;da[1]*=I;da[4]*=I;da[7]*=I;da[2]=da[1];da[5]=da[4];da[8]=da[7];da[7]+=1;K=y.dot(n(da,1),l)+da[7];I=y.dot(n(da,2),l)+da[8];M=y.dot(n(da,1),t)+da[7];G=y.dot(n(da,2),t)+da[8];K=-.5*(K/I+M/G);da[1]+=da[2]*K;da[4]+=da[5]*K;da[7]+=da[8]*K;K=y.dot(n(da,1),l)+da[7];I=y.dot(n(da,2),l)+da[8];M=-I/K;da[1]*=M;da[4]*=M;da[7]*=M;u[0]=da[0];u[1]=da[1];u[2]=0;u[3]=da[2];u[4]=da[3];
u[5]=da[4];u[6]=0;u[7]=da[5];u[8]=0;u[9]=0;u[10]=1;u[11]=0;u[12]=da[6];u[13]=da[7];u[14]=0;u[15]=da[8];p.camera.projectionMatrix[10]=2/(g[2]-m[2]);p.camera.projectionMatrix[14]=-(g[2]+m[2])/(g[2]-m[2]);C.multiply(p.camera.projectionMatrix,p.camera.viewMatrix,p.lightMat);l=J/2;p.camera.viewport[0]=0===h%2?0:l;p.camera.viewport[1]=0===Math.floor(h/2)?0:l;p.camera.viewport[2]=l;p.camera.viewport[3]=l}ga=void 0;P[Q]=100*q;f.bindFramebuffer(N);f.bindTexture(null,7);f.setClearColor(1,1,1,1);f.clear(A.COLOR_BUFFER_BIT|
A.DEPTH_BUFFER_BIT);f.setBlendingEnabled(!1)};var aa=[];this.getCascades=function(){for(var a=0;a<Q;++a)aa[a]=T[a];aa.length=Q;return aa};this.finish=function(a){r.assert(this.getEnableState());f.bindFramebuffer(a)};this.bind=function(a){var b=this.getEnableState();f.bindTexture(b?K:M,7);f.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",b?.5/J:-1);a.setUniform1i("shadowMapNum",Q);a.setUniform4f("shadowMapDistance",P[0],P[1],P[2],P[3])};this.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");
for(var b=0;b<a.length;b++)this.bind(a[b])};var ea=E.create(),ha=new Float32Array(64),ga;this.bindView=function(a,b){if(this.getEnableState()){if(!ga||ga[0]!==b[0]||ga[1]!==b[1]||ga[2]!==b[2]){var d;ga=ga||z.create();z.set(b,ga);for(W=0;W<Q;++W)for(E.translate(T[W].lightMat,b,ea),d=0;16>d;++d)ha[16*W+d]=ea[d]}a.setUniformMatrix4fv("shadowMapMatrix",ha)}};O=new Float32Array(16);O[0]=0;O[1]=0;O[2]=0;O[3]=0;O[4]=256;O[5]=0;O[6]=1;O[7]=0;O[8]=0;O[9]=256;O[10]=0;O[11]=1;O[12]=256;O[13]=256;O[14]=1;O[15]=
1;var ma=new t(f,h.Default3D,{geometry:l.Pos2Tex},{geometry:p.createVertex(f,A.STATIC_DRAW,O)});this.drawDebugQuad=function(b){r.assert(this.getEnableState());var d=a.get("showDepth");f.setDepthTestEnabled(!1);f.bindProgram(d);d.setUniformMatrix4fv("proj",b);d.setUniform1i("depthTex",0);f.bindTexture(K,0);f.bindVAO(ma);q.assertCompatibleVertexAttributeLocations(ma,d);f.drawArrays(A.TRIANGLE_STRIP,0,q.vertexCount(ma,"geometry"));f.setDepthTestEnabled(!0)};var fa=y.create(),Y=y.create(),wa=[y.create(),
y.create(),y.create(),y.create()],oa=y.create(),ta=y.create(),F=y.create(),la=y.create(),ua=y.create(),ya=y.create(),ra=y.create(),Aa=z.create(),qa=y.create(),da=u.create()}})},"esri/views/3d/webgl-engine/lib/NearFarCalc":function(){define(["require","exports","./Util","./gl-matrix","./ComponentUtils"],function(B,r,f,a,b){B=a.vec3d;var c=a.vec4d,t=a.mat4d;a=function(){function a(){this._context={content:[],near:[],far:[],nearSpecial:[],farSpecial:[],bestNear:0,bestFar:0,bestNear2:0,bestFar2:0};this._boundingInfoHelper=
new p}a.prototype._resetContext=function(){var a=this._context;a.content.length=0;a.near.length=0;a.far.length=0;a.nearSpecial.length=0;a.farSpecial.length=0;a.bestNear=Number.MAX_VALUE;a.bestFar=-Number.MAX_VALUE;return this._context};a.prototype.calculateSceneNearFar=function(a,c){var h=this._resetContext(),f=a.viewMatrix,l=f[2],n=f[6],p=f[10],u=f[14],t=0,w;for(w in c)if(f=c[w],!b.isAllHidden(f.instanceParameters.componentVisibilities,f.componentOffsets)&&f.castShadow){var y=void 0,z=void 0;f.hasShaderTransformation?
(y=f.getBoundingSphere(f.getShaderTransformation(),null,q),z=q):(y=f.bsRadius,z=f.center);var r=l*z[0]+n*z[1]+p*z[2]+u,z=r-y,y=r+y;h.content[t]=f;h.near[t]=-y;h.far[t]=-z;++t}if(0===t)return[h.bestNear,h.bestFar];for(c=0;c<t;++c)h.near[c]>h.bestFar&&(h.bestFar=h.near[c]),2<h.near[c]&&h.far[c]<h.bestNear&&(h.bestNear=h.far[c]);h.bestNear2=Math.max(.5*h.bestNear,2);h.bestFar2=2*h.bestFar;for(c=n=l=0;c<t;++c)h.near[c]<h.bestNear&&(h.near[c]>=h.bestNear2?h.bestNear=h.near[c]:h.nearSpecial[l++]=c),h.far[c]>
h.bestFar&&(h.far[c]<=h.bestFar2?h.bestFar=h.far[c]:h.farSpecial[n++]=c);if(0===l&&0===n)return[h.bestNear,h.bestFar];h.nearSpecial.length=l;h.farSpecial.length=n;h.nearSpecial.sort(function(a,b){return h.near[a]<h.near[b]?-1:h.near[a]>h.near[b]?1:0});h.farSpecial.sort(function(a,b){return h.far[a]<h.far[b]?1:h.far[a]>h.far[b]?-1:0});this._boundingInfoHelper.init(a,h);for(c=0;c<l;++c)h.near[h.nearSpecial[c]]<h.bestNear&&(f=h.content[h.nearSpecial[c]],a=f.boundingInfo,this._boundingInfoHelper.includeNearBoundingInfoRec(a,
f.getShaderTransformation()));for(c=0;c<n;++c)h.far[h.farSpecial[c]]>h.bestFar&&(f=h.content[h.farSpecial[c]],a=f.boundingInfo,this._boundingInfoHelper.includeFarBoundingInfoRec(a,f.getShaderTransformation()));return[h.bestNear,h.bestFar]};return a}();var p=function(){function a(){this._clippingHelper=new h;this._planes=[c.create(),c.create(),c.create(),c.create(),c.create(),c.create()];this._viewProj=t.create();this._view=t.create()}a.prototype.init=function(a,b){this._context=b;t.set(a.viewMatrix,
this._view);t.multiply(a.projectionMatrix,this._view,this._viewProj);a.copyFrustumPlanes(this._planes);this._clippingHelper.init(b)};a.prototype.includeNearBoundingInfoRec=function(a,b){var c=a.getBSRadius(),h=a.getCenter();t.multiplyVec3(b,h,q);var h=q[0],f=q[1],l=q[2],c=c*Math.sqrt(Math.max(Math.max(b[0]*b[0]+b[4]*b[4]+b[8]*b[8],b[1]*b[1]+b[5]*b[5]+b[9]*b[9]),b[2]*b[2]+b[6]*b[6]+b[10]*b[10]));if(!(this._planes[0][0]*h+this._planes[0][1]*f+this._planes[0][2]*l+this._planes[0][3]>c||this._planes[1][0]*
h+this._planes[1][1]*f+this._planes[1][2]*l+this._planes[1][3]>c||this._planes[2][0]*h+this._planes[2][1]*f+this._planes[2][2]*l+this._planes[2][3]>c||this._planes[3][0]*h+this._planes[3][1]*f+this._planes[3][2]*l+this._planes[3][3]>c||(h=this._view[2]*h+this._view[6]*f+this._view[10]*l+this._view[14],f=h+c,2>-(h-c)||-f>=this._context.bestNear)))if(-f>this._context.bestNear2)this._context.bestNear=-f;else{if(100<c&&(c=a.getChildren(),void 0!==c)){for(a=0;8>a;++a)void 0!==c[a]&&this.includeNearBoundingInfoRec(c[a],
b);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,b,a.getBBMin(),a.getBBMax())}};a.prototype.includeFarBoundingInfoRec=function(a,b){var c=a.getBSRadius(),h=a.getCenter();t.multiplyVec3(b,h,q);var h=q[0],f=q[1],l=q[2],c=c*Math.sqrt(Math.max(Math.max(b[0]*b[0]+b[4]*b[4]+b[8]*b[8],b[1]*b[1]+b[5]*b[5]+b[9]*b[9]),b[2]*b[2]+b[6]*b[6]+b[10]*b[10]));if(!(this._planes[0][0]*h+this._planes[0][1]*f+this._planes[0][2]*l+this._planes[0][3]>c||this._planes[1][0]*h+this._planes[1][1]*f+this._planes[1][2]*
l+this._planes[1][3]>c||this._planes[2][0]*h+this._planes[2][1]*f+this._planes[2][2]*l+this._planes[2][3]>c||this._planes[3][0]*h+this._planes[3][1]*f+this._planes[3][2]*l+this._planes[3][3]>c||(h=this._view[2]*h+this._view[6]*f+this._view[10]*l+this._view[14]-c,-h<=this._context.bestFar)))if(-h<this._context.bestFar2)this._context.bestFar=-h;else{if(100<c&&(c=a.getChildren(),void 0!==c)){for(a=0;8>a;++a)void 0!==c[a]&&this.includeFarBoundingInfoRec(c[a],b);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,
b,a.getBBMin(),a.getBBMax())}};return a}(),h=function(){function a(){this._clipP=Array(8);for(var a=0;8>a;++a)this._clipP[a]=c.create()}a.prototype.init=function(a){this._context=a};a.prototype.intersectFrustumAABB=function(a,b,c,h){t.multiply(a,b,y);for(a=0;8>a;++a){b=this._clipP[a];var f=0===a||3===a||4===a||7===a?c[0]:h[0],n=0===a||1===a||4===a||5===a?c[1]:h[1],q=4>a?c[2]:h[2];b[0]=y[0]*f+y[4]*n+y[8]*q+y[12];b[1]=y[1]*f+y[5]*n+y[9]*q+y[13];b[2]=y[2]*f+y[6]*n+y[10]*q+y[14];b[3]=y[3]*f+y[7]*n+y[11]*
q+y[15]}for(a=0;12>a;++a){c=this._clipTriangle(this._clipP[l[a][0]],this._clipP[l[a][1]],this._clipP[l[a][2]]);h=!0;for(b=0;b<c.length;++b)if(f=c[b][3],2<=f){h=!1;break}if(!h)for(b=0;b<c.length;++b)f=c[b][3],f<this._context.bestNear&&(this._context.bestNear=f),f>this._context.bestFar&&(this._context.bestFar=f)}};a.prototype._inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];f.assert(!1)};a.prototype._intersect=function(a,
b,h){var f=0;0===h?f=(-a[3]-a[0])/(b[0]-a[0]+b[3]-a[3]):1===h?f=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===h?f=(a[3]-a[0])/(b[0]-a[0]-b[3]+a[3]):3===h&&(f=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return c.lerp(a,b,f,c.create())};a.prototype._clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var h=0;h<c.length;++h){var f=c[h],l=c[(h+1)%c.length];this._inside(l,b)?(this._inside(f,b)||a.push(this._intersect(f,l,b)),a.push(l)):this._inside(f,b)&&a.push(this._intersect(f,l,b))}}return a};return a}(),
l=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],q=B.create(),y=t.create();return a})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ./Util ./gl-matrix dojo/text!../materials/internal/highlight.xml ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations ../../support/debugFlags".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w){var u=a.vec4d;return function(){function a(a,b,c){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=c;this.viewportToRestore=u.create();this.programRep=a;this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05}}a.prototype._gridUpdateResources=
function(a,b){var f=this._rctx,l=this._grid,q=!1;null===l.coverageMipmap&&(l.coverageMipmap=[a],q=!0);if(l.viewportWidth!==a.width||l.viewportHeight!==a.height)q=!0,l.viewportWidth=a.width,l.viewportHeight=a.height;l.coverageMipmap[0]=a;l.cellPixelSize!==b&&(l.cellPixelSize=b,q=!0);if(q){for(b=1;b<l.coverageMipmap.length;b++)l.coverageMipmap[b].dispose();l.mipmapLevels=Math.ceil(Math.log(l.cellPixelSize)*Math.LOG2E);l.coverageMipmap.length=l.mipmapLevels+1;for(b=0;b<l.mipmapLevels;b++)q=l.coverageMipmap[b],
q=c.createWithAttachments(f,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(q.width/2),height:Math.ceil(q.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(q.width/2),height:Math.ceil(q.height/2)}),l.coverageMipmap[b+1]=q}var q=Math.ceil(a.height/l.cellPixelSize),u=Math.ceil(a.width/l.cellPixelSize);if(!l.vao||l.verticalCellCount!==q||l.horizontalCellCount!==u){l.verticalCellCount=q;l.horizontalCellCount=u;a=q+1;b=u+1;for(var q=1/q,u=1/u,
t=new Float32Array(24*a*b),w=0,r=0;r<a;r++)for(var C=0;C<b;C++)t[w+0]=(C-.5)*u*2-1,t[w+1]=(r-.5)*q*2-1,t[w+2]=C*u,t[w+3]=r*q,t[w+4]=(C+.5)*u*2-1,t[w+5]=(r-.5)*q*2-1,t[w+6]=C*u,t[w+7]=r*q,t[w+8]=(C-.5)*u*2-1,t[w+9]=(r+.5)*q*2-1,t[w+10]=C*u,t[w+11]=r*q,t[w+12]=(C-.5)*u*2-1,t[w+13]=(r+.5)*q*2-1,t[w+14]=C*u,t[w+15]=r*q,t[w+16]=(C+.5)*u*2-1,t[w+17]=(r-.5)*q*2-1,t[w+18]=C*u,t[w+19]=r*q,t[w+20]=(C+.5)*u*2-1,t[w+21]=(r+.5)*q*2-1,t[w+22]=C*u,t[w+23]=r*q,w+=24;l.vao&&l.vao.dispose(!0);l.vao=new p(f,z.Default3D,
{geometry:y.Pos2Tex},{geometry:h.createVertex(f,35044,t)})}};a.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.programRep.get("conservative-downsample");a.bindVAO(this.quadVAO);for(var h=0;h<b.mipmapLevels;h++){a.bindFramebuffer(b.coverageMipmap[h+1]);a.bindTexture(b.coverageMipmap[h].colorTexture,0);var f=b.coverageMipmap[h+1].width,q=b.coverageMipmap[h+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/f,1/q);a.setViewport(0,0,f,
q);a.drawArrays(5,0,l.vertexCount(this.quadVAO,"geometry"))}};a.prototype.createQuadVAO=function(){var a=this._rctx,b=new Float32Array([-1,-1,1,-1,-1,1,1,1]);return new p(a,z.Default3D,{geometry:y.Pos2},{geometry:h.createVertex(a,35044,b)})};Object.defineProperty(a.prototype,"profilingCallback",{get:function(){return w.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});a.prototype.getIsSupported=function(){return!0};a.prototype.setEnableState=function(a){a?
this.enable():this.disable()};a.prototype.getEnableState=function(){return null!==this.blur0Fbo};a.prototype.enable=function(){this.quadVAO=this.createQuadVAO();var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=c.createWithAttachments(this._rctx,b,a);this.blur1Fbo=c.createWithAttachments(this._rctx,b,a)};a.prototype.disable=function(){this.getEnableState()&&(this.quadVAO.dispose(!0),
this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};a.prototype.getHighlightFBO=function(){return this.blur0Fbo};a.prototype.render=function(a,b,c){var h=!w.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,n=w.HIGHLIGHTS_VISUALIZE_BLOCKS,q=this._rctx;f.assert(this.getEnableState());u.set(a.fullViewport,this.viewportToRestore);a=Math.ceil(c.width/1);var p=Math.ceil(c.height/1);this.blur0Fbo.resize(a,p);this.blur1Fbo.resize(a,p);q.bindVAO(this.quadVAO);q.setDepthWriteEnabled(!1);
q.setDepthTestEnabled(!1);q.setBlendingEnabled(!1);var t=null,y=t=null,z=null;if(h){var r=this._grid;this._gridUpdateResources(c,32);this._gridComputeMipmap();y=r.vao;z=4;t=this.programRep.get("highlight-blur-grid-5");q.bindProgram(t);q.bindTexture(r.coverageMipmap[r.mipmapLevels].colorTexture,1);t.setUniform1i("coverageTex",1)}else y=this.quadVAO,z=5,t=this.programRep.get("highlight-blur-5"),q.bindProgram(t);q.bindVAO(y);q.bindFramebuffer(this.blur0Fbo);q.setViewport(0,0,a,p);q.setClearColor(0,0,
0,0);q.clear(q.gl.COLOR_BUFFER_BIT);t.setUniform1i("tex",0);q.bindTexture(c.colorTexture,0);t.setUniform2f("blurSize",1/a,0);q.drawArrays(z,0,l.vertexCount(y,"geometry"));q.bindFramebuffer(this.blur1Fbo);q.clear(q.gl.COLOR_BUFFER_BIT);q.bindTexture(this.blur0Fbo.colorTexture,0);t.setUniform2f("blurSize",0,1/p);q.drawArrays(z,0,l.vertexCount(y,"geometry"));q.bindFramebuffer(b);q.setBlendingEnabled(!0);q.setBlendFunctionSeparate(770,771,1,771);q.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],
this.viewportToRestore[2],this.viewportToRestore[3]);h?(t=this.programRep.get(n?"highlight-apply-grid-debug":"highlight-apply-grid"),q.bindProgram(t),t.setUniform1i("coverageTex",2),q.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(t=this.programRep.get("highlight-apply"),q.bindProgram(t));t.setUniform1i("tex",0);q.bindTexture(this.blur1Fbo.colorTexture,0);t.setUniform1i("origin",1);q.bindTexture(c.colorTexture,1);t.setUniform4fv("color",this.defaultOptions.color);
t.setUniform1f("outlineSize",8.6);t.setUniform1f("blurSize",.4);t.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);q.drawArrays(z,0,l.vertexCount(y,"geometry"));q.bindVAO(null);q.setDepthWriteEnabled(!0);q.setDepthTestEnabled(!0);q.setBlendingEnabled(!1)};a.prototype.setDefaultOptions=function(a){this.defaultOptions=a};a.loadShaders=function(a,c,h,f){a._parse(b);c=0;for(var l=["3",
"5","7","9"];c<l.length;c++){var n=l[c];h.add("highlight-blur-"+n,new t(f,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,z.Default3D,{GAUSSIAN_SAMPLES:n}));h.add("highlight-blur-grid-"+n,new t(f,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,z.Default3D,{GAUSSIAN_SAMPLES:n,GRID_OPTIMIZATION:"true"}))}h.add("highlight-apply",new t(f,a.vsHighlightApply,a.fsHighlightApply,z.Default3D));h.add("highlight-apply-grid",new t(f,a.vsHighlightApply,a.fsHighlightApply,z.Default3D,["GRID_OPTIMIZATION"]));
h.add("highlight-apply-grid-debug",new t(f,a.vsHighlightApply,a.fsHighlightApply,z.Default3D,["GRID_OPTIMIZATION","GRID_DEBUG"]));h.add("conservative-downsample",new t(f,a.vsConservativeDownsample,a.fsConservativeDownsample,z.Default3D))};return a}()})},"esri/views/3d/webgl-engine/materials/repository":function(){define("dojo/text!./internal/util.xml dojo/text!./internal/hud.xml ./BillboardMaterial ./ColorMaterial ./HUDMaterial ./LineCalloutMaterial ./LeafCardMaterial ./Material ./RibbonLineMaterial ./WaterMaterial ./internal/SimpleGLMaterial ./internal/TexOnlyGLMaterial ./internal/BlendLayers".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z){return{initializeShaders:function(w,u,C,E){w._parse(B);w._parse(r);q.loadShaders(w,u,C,E);y.loadShaders(w,u,C,E);p.loadShaders(w,u,C,E);f.loadShaders(w,u,C,E);b.loadShaders(w,u,C,E);c.loadShaders(w,u,C,E);t.loadShaders(w,u,C,E);h.loadShaders(w,u,C,E);l.loadShaders(w,u,C,E);z.loadShaders(w,u,C,E);a.loadShaders(w,u,C,E)}}})},"esri/views/3d/webgl-engine/materials/BillboardMaterial":function(){define("dojo/text!./BillboardMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),
function(B,r,f,a,b,c,t){var p=function(a,b){r.basicMaterialConstructor(this,b);var f=c.Pos3NormTex;this.getSize=function(){return 1.05};this.dispose=function(){};this.getTextureId=function(){return a};this.getOutputAmount=function(a){var b=t.getStride(f)/4;return a*b*6};this.getVertexBufferLayout=function(){return f};this.fillInterleaved=function(a,b,c,h,f,l){h=r.fill;var n=a.faces.indices.va,q=a.vertexAttr.va.data,p=a.vertexAttr.tc4.data,u=a.vertexAttr.n0.data,t=a.vertexAttr.n1.data,w=a.vertexAttr.n2.data;
a=a.vertexAttr.n3.data;for(var y=0;y<n.length;++y){var z=4*n[y],A=3*n[y];l+=h(q,z,f,l,b,3);l+=h(u,A,f,l,c,3);f[l++]=p[z];f[l++]=p[z+1];l+=h(q,z,f,l,b,3);l+=h(t,A,f,l,c,3);f[l++]=p[z+2]+1;f[l++]=p[z+1];l+=h(q,z,f,l,b,3);l+=h(w,A,f,l,c,3);f[l++]=p[z+2]+1;f[l++]=p[z+3]+1;l+=h(q,z,f,l,b,3);l+=h(w,A,f,l,c,3);f[l++]=p[z+2]+1;f[l++]=p[z+3]+1;l+=h(q,z,f,l,b,3);l+=h(a,A,f,l,c,3);f[l++]=p[z];f[l++]=p[z+3]+1;l+=h(q,z,f,l,b,3);l+=h(u,A,f,l,c,3);f[l++]=p[z];f[l++]=p[z+1]}};this.intersect=function(){};this.getGLMaterials=
function(){return{color:h,depthShadowMap:q,normal:void 0,depth:l,highlight:void 0}};this.getAllTextureIds=function(){return[a]}},h=function(a,b,c){r.basicGLMaterialConstructor(this,a);var h=f.TRANSPARENT_MATERIAL,l=b.get("billboard");r.singleTextureGLMaterialConstructor(this,c,{textureId:a.getTextureId()});this.beginSlot=function(a){return h===a};this.getProgram=function(){return l};this.bind=function(a,b){a.bindProgram(l);this.bindTexture(a,l);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,
a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,b){r.bindView(b.origin,b.view,l)};this.bindInstance=function(a,b){l.setUniformMatrix4fv("model",b.transformation);l.setUniformMatrix4fv("modelNormal",b.transformationNormal)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},l=function(a,b,c,h){r.basicGLMaterialConstructor(this,a);var l=f.TRANSPARENT_MATERIAL,q=null==h?b.get("billboardDepth"):b.get("billboardDepthShadowMap");
r.singleTextureGLMaterialConstructor(this,c,{textureId:a.getTextureId()});this.beginSlot=function(a){return l===a};this.getProgram=function(){return q};this.bind=function(a,b){a.bindProgram(q);this.bindTexture(a,q);q.setUniform2fv("nearFar",b.nearFar)};this.release=function(a){};this.bindView=function(a,b){r.bindView(b.origin,b.view,q)};this.bindInstance=function(a,b){q.detUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},q=function(a,b,c){l.call(this,
a,b,c,!0)};p.loadShaders=function(c,h,f,l){c._parse(B);var q=new a(l,c.vertexShaderBillboard,c.fragmentShaderBillboard,b.Default3D),p=h.get("fsDepthTextured");h=h.get("fsDepthTexturedShadowMap");p=new a(l,c.vertexShaderBillboardDepth,p.source,b.Default3D,p.defines);c=new a(l,c.vertexShaderBillboardDepth,h.source,b.Default3D,h.defines);f.add("billboard",q);f.add("billboardDepth",p);f.add("billboardDepthShadowMap",c)};return p})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("dojo/_base/lang dojo/text!./ColorMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../lib/Util ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),
function(B,r,f,a,b,c,t,p,h){b=function(a,b){f.basicMaterialConstructor(this,b);a=a||{};a.color=a.color||[1,1,1,1];a.polygonOffset=a.polygonOffset||!1;a.vertexColors=a.vertexColors||!1;var c=p.Pos3Col;this.getParams=function(){return a};this.setColor=function(b){a.color=b;this.notifyDirty("matChanged")};this.getColor=function(){return a.color};this.setTransparent=function(b){a.transparent=b;this.notifyDirty("matChanged")};this.getTransparent=function(b){return a.transparent};this.dispose=function(){};
this.getOutputAmount=function(a){var b=h.getStride(c)/4;return a*b};this.getVertexBufferLayout=function(){return c};this.fillInterleaved=function(a,b,h,l,n,q,p){f.fillInterleaved(a,b,h,l,c,n,q,p)};this.intersect=f.intersectTriangleGeometry;this.getGLMaterials=function(){return{color:l,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:q}};this.getAllTextureIds=function(){return[]}};var l=function(b,c,h){f.basicGLMaterialConstructor(this,b);var l=B.clone(b.getParams()),q=c.get("colorMaterial"),
p=b.getColor();this.beginSlot=function(b){return b===(1>p[3]?a.TRANSPARENT_MATERIAL:a.OPAQUE_MATERIAL)};this.getProgram=function(){return q};this.updateParameters=function(){l.color=b.getColor();l.transparent=b.getTransparent()};this.bind=function(a,b){a.bindProgram(q);q.setUniform4fv("eColor",l.color);a.setFaceCullingEnabled(!1);l.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1));l.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,
a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0)};this.release=function(a){a.setPolygonOffsetFillEnabled(!1);l.transparent&&a.setBlendingEnabled(!1)};this.bindView=function(a,b){f.bindView(b.origin,b.view,q)};this.bindInstance=function(a,b){q.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},q=function(b,c,h){f.basicGLMaterialConstructor(this,b);var l=B.clone(b.getParams()),q=c.get("colorMaterial"),p=[1,1,1,1];this.beginSlot=function(b){return b===
(1>p[3]?a.TRANSPARENT_MATERIAL:a.OPAQUE_MATERIAL)};this.getProgram=function(){return q};this.updateParameters=function(){l.color=b.getColor();l.transparent=b.getTransparent()};this.bind=function(a,b){a.bindProgram(q);q.setUniform4fv("eColor",l.color);a.setFaceCullingEnabled(!1);l.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1))};this.release=function(a){a.setPolygonOffsetFillEnabled(!1)};this.bindView=function(a,b){f.bindView(b.origin,b.view,q)};this.bindInstance=function(a,
b){q.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}};b.programs=null;b.loadShaders=function(a,b,h,f){a._parse(r);a=new c(f,a.vertexShaderColorMaterial,a.fragmentShaderColorMaterial,t.Default3D);h.add("colorMaterial",a)};return b})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./LineCalloutMaterial.xml ./internal/MaterialUtil ../lib/Util ../../../webgl/Util ./internal/MaterialBase ./internal/GLMaterialBase ../lib/RenderSlot ../lib/ShaderVariations".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q){function y(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}var z=c.VertexAttrConstants,w=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:32,stride:48,normalized:!1}],u={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,
0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world"};B=function(c){function h(a,f){f=c.call(this,f)||this;f.params=b.copyParameters(a,u);f._uniqueMaterialIdentifier=h.uniqueMaterialIdentifier(f.params);return f}f(h,c);Object.defineProperty(h.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});h.prototype.dispose=function(){};h.prototype.getGLMaterials=function(){return{color:C,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};h.prototype.getAllTextureIds=function(){return[]};h.prototype.fillAttributeData=function(a,c,h,f,l,n){var q=a.faces.indices[c];a=a.vertexAttr[c].data;if(q&&a)for(c=h+t.findAttribute(w,c).offset/4,h=0;h<q.length;h++)for(var p=f*q[h],u=0;6>u;u++)b.fill(a,p,n,c,l,f),c+=12};h.prototype.fillInterleaved=function(a,b,c,h,f,l,n){this.fillAttributeData(a,z.POSITION,l,3,b,f);this.fillAttributeData(a,z.NORMAL,l,3,c,f);this.fillAttributeData(a,
z.AUXPOS1,l,4,null,f);a=l+t.findAttribute(w,z.UV0).offset/4;b=0;for(c=E;b<c.length;b++)h=c[b],f[a+0]=h[0],f[a+1]=h[1],a+=12};h.prototype.getOutputAmount=function(a){return 288*a};h.prototype.getInstanceBufferLayout=function(){};h.prototype.getVertexBufferLayout=function(){return w};h.prototype.intersect=function(a,b,c,h,f,l,n,q){};h.prototype.getParameterValues=function(){var a=this.params;return{verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,screenOffset:a.screenOffset,
centerOffsetUnits:a.centerOffsetUnits,color:[a.color[0],a.color[1],a.color[2],a.color[3]],size:a.size,borderColor:a.borderColor,occlusionTest:a.occlusionTest,shaderPolygonOffset:a.shaderPolygonOffset,depthHUDAlignStart:a.depthHUDAlignStart}};h.prototype.setParameterValues=function(a){var b=!1,c;for(c in a){var f=a[c];void 0!==f&&(b=!0,Array.isArray(f)?this.params[c]=f.slice():this.params[c]=f)}b&&(this._uniqueMaterialIdentifier=h.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};
h.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};h.loadShaders=function(b,c,h,f){b._parse(a);b=new q("lineCallout",["vertexShaderLineCallout","fragmentShaderLineCallout"],null,h,c,b,f);b.addDefine("occlTest","OCCL_TEST");b.addDefine("verticalOffset","VERTICAL_OFFSET");b.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addDefine("depthHud","DEPTH_HUD");b.addDefine("depthHudAlignStart","DEPTH_HUD_ALIGN_START");
b.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");h.addShaderVariations("line-callout-material-shader-variations",b)};return h}(p.MaterialBase);var C=function(a){function c(b,c,h){b=a.call(this,b,c,h)||this;b.isRenderSlot=!0;b.programRep=c;b.updateParameters();return b}f(c,a);c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};c.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",
[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!1,!!a.depthHUDAlignStart,"screen"===a.centerOffsetUnits]);this.depthProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!0,!!a.depthHUDAlignStart,"screen"===a.centerOffsetUnits])};c.prototype.beginSlot=function(a){switch(a){case l.LINE_CALLOUTS:return this.isRenderSlot=!0;case l.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,
!0}return!1};Object.defineProperty(c.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0});c.prototype.getAllPrograms=function(){return[this.renderProgram,this.depthProgram]};c.prototype.getProgram=function(){return this.program};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};c.prototype.bind=function(a,c){var h=c.cameraAboveGround?1:-1,f=this.program,l=this.params;a.bindProgram(f);f.setUniform1f("cameraGroundRelative",
h);f.setUniform1f("polygonOffset",l.shaderPolygonOffset);f.setUniform4fv("viewport",c.viewport);f.setUniformMatrix4fv("viewNormal",c.viewInvTransp);f.setUniform1i("hudVisibilityTexture",0);a.bindTexture(c.hudVisibilityTexture,0);y(f,"color",l.color);f.setUniform2f("screenOffset",l.screenOffset[0],l.screenOffset[1]);this.bindBorder(a,c);b.bindVerticalOffset(l.verticalOffset,c,f);this.bindSizing(a,c);b.bindScreenSizePerspective(l.screenSizePerspective,f);this.isRenderSlot?this.bindRender(a,c):this.bindHUDDepth(a,
c)};c.prototype.bindRender=function(a,b){a.setBlendFunctionSeparate(1,771,770,771);a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1)};c.prototype.bindHUDDepth=function(a,b){a.setColorMask(!1,!1,!1,!1);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};c.prototype.bindView=function(a,c){a=this.program;b.bindView(c.origin,c.view,a);b.bindCamPos(c.origin,c.viewInvTransp,a)};c.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);
a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};c.prototype.release=function(a,b){this.isRenderSlot?this.releaseRender(a,b):this.releaseHUDDepth(a,b)};c.prototype.releaseRender=function(a,b){a.setBlendingEnabled(!1);a.setBlendFunction(770,771);a.setDepthWriteEnabled(!0)};c.prototype.releaseHUDDepth=function(a,b){a.setColorMask(!0,!0,!0,!0)};c.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",
Math.ceil(c.size))};c.prototype.bindBorder=function(a,b){a=this.program;b=this.params;null!==b.borderColor?(y(a,"borderColor",b.borderColor),a.setUniform1f("borderSize",1)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return c}(h.GLMaterialBase),E=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]];return B})},"esri/views/3d/webgl-engine/materials/LeafCardMaterial":function(){define("dojo/text!./LeafCardMaterial.xml ./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../../../webgl/Util".split(" "),
function(B,r,f,a,b,c,t,p){function h(){C=(9301*C+49297)%233280;return C/233280}var l=a.vec3,q=a.mat4,y=a.mat4d;a=function(a,b,c,t,x,C){r.basicMaterialConstructor(this,C);var n=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:4,type:5126,offset:12,stride:44,normalized:!1},{name:"uv0",count:4,type:5126,offset:28,stride:44,normalized:!1}],A=p.getStride(n)/4;this.getAmbient=function(){return b};this.getDiffuse=function(){return c};this.getSpecular=function(){return t};
this.getShininess=function(){return x};this.dispose=function(){};this.getTextureId=function(){return a};this.getOutputAmount=function(a){var b=0,c;for(c=0;c<a/6;c++)0===c%1&&(b+=6);a=b;for(c=b=0;c<a/6;c++)0===c%1&&(b+=6);return b*A};this.getVertexBufferLayout=function(){return n};this.reduce=function(a,b){var c=a.position,h=a.normal;a=a.uv0;for(var f=[],l=[],n=[],q=0,p=0;p<c.length/6;p++)if(0===p%b)for(var k=0;6>k;k++)f[q]=c[6*p+k],l[q]=h[6*p+k],n[q]=a[6*p+k],q++;return{position:f,normal:l,uv0:n}};
this.fillInterleaved=function(a,b,c,n,p,u){n=r.fill;var t=this.reduce(a.faces.indices,1),t=this.reduce(t,1),w=this.getOutputAmount(a.faces.indices.position.length);f.assert(w===t.position.length*A);var z=t.position,k=t.normal,x=t.uv0,t=a.vertexAttr.position.data,C=a.vertexAttr.normal.data,e=a.vertexAttr.uv0.data,d=l.create();a=z.length/6;for(var w=u,g=l.createFrom(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),m=l.createFrom(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=0;v<a;++v){for(var J=
l.create(),E=l.create(),I=[100,100,-100,-100],K=l.create(),G=0;6>G;++G){var N=6*v+G,M=3*z[N],B=3*k[N],N=2*x[N];J[0]+=t[M+0];J[1]+=t[M+1];J[2]+=t[M+2];E[0]+=C[B+0];E[1]+=C[B+1];E[2]+=C[B+2];B=e[N+0];N=e[N+1];I[0]=Math.min(I[0],B);I[1]=Math.min(I[1],N);I[2]=Math.max(I[2],B);I[3]=Math.max(I[3],N);0===G&&l.set3(t[M+0],t[M+1],t[M+2],K)}J[0]/=6;J[1]/=6;J[2]/=6;E[0]/=6;E[1]/=6;E[2]/=6;J[0]+=.1*(2*h()-1);J[1]+=.1*(2*h()-1);J[2]+=.1*(2*h()-1);void 0!==b&&(y.multiplyVec3(b,K,K),y.multiplyVec3(b,J,J),y.multiplyVec3(c,
E,E));l.add(J,d,d);l.max(g,J,g);l.min(m,J,m);I[0]+=.01;I[1]+=.01;I[2]-=.01;I[3]-=.01;for(G=0;4>G;G++)I[G]=Math.min(I[G],.99999);G=2*h()*Math.PI;K=1.41*l.dist(K,J);u+=n(J,0,p,u,void 0,3);u+=n(E,0,p,u,void 0,3);p[u++]=0;p[u++]=I[0];p[u++]=I[1];p[u++]=G;p[u++]=K;u+=n(J,0,p,u,void 0,3);u+=n(E,0,p,u,void 0,3);p[u++]=0;p[u++]=I[2]+1;p[u++]=I[1];p[u++]=G;p[u++]=K;u+=n(J,0,p,u,void 0,3);u+=n(E,0,p,u,void 0,3);p[u++]=0;p[u++]=I[2]+1;p[u++]=I[3]+1;p[u++]=G;p[u++]=K;u+=n(J,0,p,u,void 0,3);u+=n(E,0,p,u,void 0,
3);p[u++]=0;p[u++]=I[2]+1;p[u++]=I[3]+1;p[u++]=G;p[u++]=K;u+=n(J,0,p,u,void 0,3);u+=n(E,0,p,u,void 0,3);p[u++]=0;p[u++]=I[0];p[u++]=I[3]+1;p[u++]=G;p[u++]=K;u+=n(J,0,p,u,void 0,3);u+=n(E,0,p,u,void 0,3);p[u++]=0;p[u++]=I[0];p[u++]=I[1];p[u++]=G;p[u++]=K}d[0]/=a;d[1]/=a;d[2]/=a;b=l.create();l.add(g,m,b);l.scale(b,.5,b);u=l.create();l.subtract(g,m,u);u[0]=Math.abs(u[0])/2;u[1]=Math.abs(u[1])/2;u[2]=Math.abs(u[2])/2;z=l.create(d);z[1]-=(g[1]-m[1])/3;g=l.create();m=l.create();t=l.create();k=[l.create(),
l.create(),l.create(),l.create()];d=[0,0,0,0];x=q.create();for(v=0;v<a;++v){l.set3(p[w],p[w+1],p[w+2],t);l.subtract(t,z,g);l.normalize(g,g);m=l.subtract(t,b,m);l.normalize(m,m);e=Math.abs(l.dot(m,[1,0,0]));G=Math.abs(l.dot(m,[0,1,0]));C=Math.abs(l.dot(m,[0,0,1]));e=e*Math.abs(b[0]-t[0])/u[0];e+=G*Math.abs(b[1]-t[1])/u[1];e+=C*Math.abs(b[2]-t[2])/u[2];for(G=0;4>G;G++)q.identity(x),q.rotate(x,.8*(2*h()-1),[0,1,0],x),q.rotate(x,.8*(2*h()-1),[1,0,0],x),q.multiplyVec3(x,g,k[G]),d[G]=.5+.5*e-.2*(2*h()-
1);C=.8+.3*(2*h()-1);for(G=0;6>G;++G){var Q;switch(G){case 0:Q=0;break;case 1:Q=1;break;case 2:Q=2;break;case 3:Q=2;break;case 4:Q=3;break;case 5:Q=0}w+=3;w+=n(k[Q],0,p,w,c,3);p[w++]=d[Q];w+=3;p[w++]*=C}}};this.intersect=function(){};this.getGLMaterials=function(){return{color:z,depthShadowMap:u,normal:void 0,depth:w,highlight:void 0}};this.getAllTextureIds=function(){return[a]}};var z=function(a,c,h){r.basicGLMaterialConstructor(this,a);var f=b.TRANSPARENT_MATERIAL,l=c.get("leafCard");r.singleTextureGLMaterialConstructor(this,
h,{textureId:a.getTextureId()});this.beginSlot=function(a){return f===a};this.getProgram=function(){return l};var n=a.getAmbient(),q=a.getDiffuse(),p=a.getSpecular(),u=a.getShininess();this.bind=function(a,b){a.bindProgram(l);this.bindTexture(a,l);l.setUniform3fv("ambient",n);l.setUniform3fv("diffuse",q);l.setUniform3fv("specular",p);l.setUniform1f("shininess",u);l.setUniform1f("trafoScale",1);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,
b){r.bindView(b.origin,b.view,l);r.bindCamPos(b.origin,b.viewInvTransp,l)};this.bindInstance=function(a,b){l.setUniformMatrix4fv("model",b.transformation);l.setUniformMatrix4fv("modelNormal",b.transformationNormal);a=b.transformation;l.setUniform1f("trafoScale",(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},w=function(a,c,h,f){r.basicGLMaterialConstructor(this,a);
var l=b.TRANSPARENT_MATERIAL,n=null==f?c.get("leafCardDepth"):c.get("leafCardDepthShadowMap");r.singleTextureGLMaterialConstructor(this,h,{textureId:a.getTextureId()});this.beginSlot=function(a){return l===a};this.getProgram=function(){return n};this.bind=function(a,b){a.bindProgram(n);this.bindTexture(a,n);n.setUniform2fv("nearFar",b.nearFar)};this.release=function(a){};this.bindView=function(a,b){r.bindView(b.origin,b.view,n)};this.bindInstance=function(a,b){n.setUniformMatrix4fv("model",b.transformation);
a=b.transformation;n.setUniform1f("trafoScale",(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},u=function(a,b,c){w.call(this,a,b,c,!0)};a.loadShaders=function(a,b,h,f){a._parse(B);var l=new c(f,a.vertexShaderLeafCard,a.fragmentShaderLeafCard,t.Default3D),n=b.get("fsDepthTextured");b=b.get("fsDepthTexturedShadowMap");n=new c(f,a.vertexShaderLeafCardDepth,n.source,
t.Default3D,n.defines);a=new c(f,a.vertexShaderLeafCardDepth,b.source,t.Default3D,b.defines);h.add("leafCard",l);h.add("leafCardDepth",n);h.add("leafCardDepthShadowMap",a)};var C=1234;return a})},"esri/views/3d/webgl-engine/materials/Material":function(){define("dojo/text!./Material.xml ./internal/MaterialUtil ../../../webgl/Program ../lib/ShaderVariations ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util ../../layers/graphics/graphicUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q){function y(a,b){var d=b.vvSizeEnabled;b.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor)):d&&a.setUniform3fv("vvSizeValue",b.vvSizeValue);d&&(a.setUniform3fv("vvSymbolAnchor",b.vvSymbolAnchor),q.computeObjectRotation(b.vvSymbolRotation[2],b.vvSymbolRotation[0],b.vvSymbolRotation[1],n.identity(K)),a.setUniformMatrix3fv("vvSymbolRotation",
n.toMat3(K,I)));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors))}function z(a,b){a.vvSizeEnabled=b.vvSizeEnabled;a.vvSizeMinSize=b.vvSizeMinSize;a.vvSizeMaxSize=b.vvSizeMaxSize;a.vvSizeOffset=b.vvSizeOffset;a.vvSizeFactor=b.vvSizeFactor;a.vvSizeValue=b.vvSizeValue;a.vvSymbolAnchor=b.vvSymbolAnchor;a.vvSymbolRotation=b.vvSymbolRotation}function w(a,b){E.set(a,x);return E.multiply(b,x)}var u=b.assert,C=c.vec3,E=c.vec4,G=c.mat3,n=c.mat4,
A,x=E.create(),I=G.create(),K=n.create(),J=C.create(),N=C.create(),M=C.createFrom(0,0,1),Q=C.create(),S=C.create(),P=C.create(),O=C.create();b=function(a,b){r.basicMaterialConstructor(this,b);a=a||{};a.ambient=a.ambient||[.2,.2,.2];a.diffuse=a.diffuse||[.8,.8,.8];a.specular=a.specular||[0,0,0];a.externalColor=a.externalColor||[1,1,1,1];a.colorMixMode=a.colorMixMode||"multiply";a.shininess=a.shininess||10;a.opacity=void 0!==a.opacity?a.opacity:1;a.layerOpacity=void 0!==a.layerOpacity?a.layerOpacity:
1;a.blendModeOneOne=a.blendModeOneOne||!1;a.inverseWindingOrder=a.inverseWindingOrder||!1;a.vertexColors=a.vertexColors||!1;a.symbolColors=a.symbolColors||!1;a.flipV=a.flipV||!1;a.doubleSided=a.doubleSided||!1;a.cullFace=a.cullFace||void 0;a.instanced=a.instanced||!1;this.instanced=!!a.instanced;a.groundNormalShading=a.groundNormalShading||!1;a.writeStencil=a.writeStencil||!1;a.textureId||(a.reflTextureId=void 0);a.receiveSSAO=void 0!==a.receiveSSAO?a.receiveSSAO:!0;a.castShadows=void 0!==a.castShadows?
a.castShadows:!0;a.verticalOffset=a.verticalOffset||null;a.screenSizePerspective=a.screenSizePerspective||null;a.vvSizeEnabled=a.vvSizeEnabled||!1;a.vvSizeMinSize=a.vvSizeMinSize||[1,1,1];a.vvSizeMaxSize=a.vvSizeMaxSize||[100,100,100];a.vvSizeOffset=a.vvSizeOffset||[0,0,0];a.vvSizeFactor=a.vvSizeFactor||[1,1,1];a.vvSizeValue=a.vvSizeValue||[1,1,1];a.vvColorEnabled=a.vvColorEnabled||!1;a.vvColorValues=a.vvColorValues||[0,0,0,0,0,0,0,0];a.vvColorColors=a.vvColorColors||[1,0,0,0,1,0,0,0,1,0,0,0,1,0,
0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];a.vvSymbolAnchor=a.vvSymbolAnchor||[0,0,0];a.vvSymbolRotation=a.vvSymbolRotation||[0,0,0];b="Pos3";a.groundNormalShading||(b+="Norm");a.textureId&&(b=a.atlasRegions?b+"TexRegion":b+"Tex");a.vertexColors&&(b+="Col");a.symbolColors&&(b+="Symcol");var c=h[b],g=null;a.instanced&&(g=[],l.addDescriptor(g,"model",16,5126,!1,1),l.addDescriptor(g,"modelNormal",16,5126,!1,1),-1<a.instanced.indexOf("color")&&l.addDescriptor(g,"instanceColor",4,5126,!1,1),-1<a.instanced.indexOf("featureAttribute")&&
l.addDescriptor(g,"instanceFeatureAttribute",4,5126,!1,1));var f=this.isVisible.bind(this);this.isVisible=function(){return f()&&0<a.opacity&&0<a.layerOpacity};this.dispose=function(){};this.getParams=function(){return a};this.getParameterValues=function(){var b={ambient:a.ambient,diffuse:a.diffuse,specular:a.specular,externalColor:a.externalColor,colorMixMode:a.colorMixMode,shininess:a.shininess,opacity:a.opacity,layerOpacity:a.layerOpacity,transparent:a.transparent,polygonOffset:a.polygonOffset,
reflectivity:a.reflectivity,atlasRegions:a.atlasRegions,flipV:a.flipV,doubleSided:a.doubleSided,cullFace:a.cullFace,writeStencil:a.writeStencil,receiveSSAO:a.receiveSSAO,castShadows:a.castShadows,verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvSizeValue:a.vvSizeValue,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,
vvColorColors:a.vvColorColors,groundNormalShading:a.groundNormalShading,vvSymbolAnchor:a.vvSymbolAnchor,vvSymbolRotation:a.vvSymbolRotation};a.textureId&&(b.textureId=a.textureId,b.initTexture=a.initTexture);return b};this.setParameterValues=function(b){for(var d in b)"textureId"===d&&u(a.textureId,"Can only change texture of material that already has a texture"),"castShadows"===d&&u(b.castShadows===a.castShadows,"Can not change shadow casting behavior."),a[d]=b[d];this.notifyDirty("matChanged")};
this.getOutputAmount=function(a){var b=l.getStride(c)/4;return a*b};this.getVertexBufferLayout=function(){return c};this.getInstanceBufferLayout=function(){return g};this.fillInterleaved=function(a,b,d,e,g,k,h){r.fillInterleaved(a,b,d,e,c,g,k,h)};this.intersect=function(b,d,e,c,g,k,h,f){if(null!=a.verticalOffset){f=c.camera;C.set3(e[12],e[13],e[14],P);var l=C.subtract(P,f.eye,O),m=C.length(l),n=C.scale(l,1/m),q=null,l=null;switch(c.viewingMode){case "global":l=C.normalize(P,Q);break;case "local":l=
C.set(M,Q)}a.screenSizePerspective&&(q=C.dot(l,n));f=r.verticalOffsetAtDistance(f,m,a.verticalOffset,q,a.screenSizePerspective);C.scale(l,f);G.multiplyVec3(c.transformInverseRotation,l,S);g=C.subtract(g,S,J);k=C.subtract(k,S,N)}r.intersectTriangleGeometry(b,d,e,c,g,k,h)};this.getGLMaterials=function(){return{color:k,depthShadowMap:a.castShadows?V:null,normal:e,depth:ca,highlight:d}};this.getAllTextureIds=function(){var b=[];a.textureId&&b.push(a.textureId);a.reflTextureId&&b.push(a.reflTextureId);
return b}};b.paramsFromOldConstructor=function(a,b,d,e,c,k,h,f,l,n,q,p,u){return{textureId:a,transparent:b,ambient:d,diffuse:e,specular:c,shininess:k,opacity:h,polygonOffset:f,initTexture:l,reflTextureId:n,reflectivity:q,flipV:p,doubleSided:u,cullFace:void 0}};var T=function(a,b){var d=a.gl;(b.cullFace?"none"===b.cullFace:b.transparent)?a.setFaceCullingEnabled(!1):(a.setFaceCullingEnabled(!0),"front"===b.cullFace&&a.setCullFace(d.FRONT))},U=function(a,b){var d=a.gl;(b.cullFace?"none"===b.cullFace:
b.transparent)?a.setFaceCullingEnabled(!0):(a.setFaceCullingEnabled(!1),"front"===b.cullFace&&a.setCullFace(d.BACK))},W=function(a,b){return a?t.TRANSPARENT_MATERIAL:b?t.STENCIL_MATERIAL:t.OPAQUE_MATERIAL},k=function(a,b,d){r.basicGLMaterialConstructor(this,a);var e=r.copyParameters(a.getParams()),c=W(e.transparent,e.writeStencil);r.singleTextureGLMaterialConstructor(this,d,e);var g=r.aquireIfNotUndefined(e.reflTextureId,e.reflInitTexture,d);g&&(g=g.getGLTexture());u(!(e.atlasRegions&&e.reflTextureId),
"Atlas texture with reflection is not yet supported");var k=e.textureId?e.atlasRegions?"AtlasTextured":"Textured":"none";this.instanced=A&&e.instanced;var h=!!this.instanced&&-1<this.instanced.indexOf("color"),f=!A&&e.instanced&&-1<e.instanced.indexOf("color"),l=[[null,null],[null,null]],m,n=null;this._loadPrograms=function(){l[0][0]=this._loadProgram(!1,!1);l[1][0]=this._loadProgram(!0,!1);e.receiveSSAO?(l[0][1]=this._loadProgram(!1,!0),l[1][1]=this._loadProgram(!0,!0),m=l[0].concat(l[1])):(l[0][1]=
l[0][0],l[1][1]=l[1][0],m=[l[0][0],l[1][0]])};this._loadProgram=function(a,d){return b.getShaderVariationsProgram("material",[k,!!e.reflTextureId,e.vertexColors,e.symbolColors,e.flipV,e.doubleSided,!!this.instanced,h,a,d,!!e.vvSizeEnabled,!!e.vvColorEnabled,null!=e.verticalOffset,null!=e.screenSizePerspective,e.groundNormalShading])};this._loadPrograms();var q="AtlasTextured"===k,p=this.dispose;this.dispose=function(){p();r.releaseIfNotUndefined(e.reflTextureId,d)};this.beginSlot=function(a){return c===
a};this.getProgram=function(){return n||l[0][0]};this.getAllPrograms=function(){return m};this.updateParameters=function(){var b=a.getParams();e.ambient=b.ambient;e.diffuse=b.diffuse;e.specular=b.specular;e.externalColor=b.externalColor;e.colorMixMode=b.colorMixMode;e.shininess=b.shininess;e.opacity=b.opacity;e.layerOpacity=b.layerOpacity;e.polygonOffset=b.polygonOffset;e.reflectivity=b.reflectivity;e.flipV=b.flipV;e.doubleSided=b.doubleSided;e.cullFace=b.cullFace;e.receiveSSAO=b.receiveSSAO;e.castShadows=
b.castShadows;e.verticalOffset=b.verticalOffset;e.screenSizePerspective=b.screenSizePerspective;z(e,b);e.vvColorEnabled=b.vvColorEnabled;e.vvColorValues=b.vvColorValues;e.vvColorColors=b.vvColorColors;e.transparent!=b.transparent&&(c=W(b.transparent),e.transparent=b.transparent);e.groundNormalShading=b.groundNormalShading;e.initTexture=b.initTexture;this.updateTexture(b.textureId);b.atlasRegions&&(e.atlasRegions=b.atlasRegions);e.blendModeOneOne=b.blendModeOneOne;e.inverseWindingOrder=b.inverseWindingOrder;
this._loadPrograms()};this.bind=function(a,b){var d=a.gl;n=l[b.shadowMappingEnabled?1:0][b.ssaoEnabled?1:0];a.bindProgram(n);n.setUniform3fv("ambient",e.ambient);n.setUniform3fv("diffuse",e.diffuse);n.setUniform3fv("specular",e.specular);n.setUniform4fv("externalColor",e.externalColor);n.setUniform1i("colorMixMode",r.colorMixModes[e.colorMixMode]);n.setUniform1f("shininess",e.shininess);n.setUniform1f("opacity",e.opacity);n.setUniform1f("layerOpacity",e.layerOpacity);r.bindVerticalOffset(e.verticalOffset,
b,n);r.bindScreenSizePerspective(e.screenSizePerspective,n);y(n,e);this.bindTexture(a,n);q&&this.bindTextureSize(a,n);a.setBlendFunctionSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);void 0!==g&&(n.setUniform1i("reflTex",1),a.bindTexture(g,1),n.setUniform1f("reflectivity",e.reflectivity));e.inverseWindingOrder&&a.setFrontFace(d.CW);e.transparent?(a.setBlendingEnabled(!0),e.blendModeOneOne?(a.setBlendFunction(d.ONE,d.ONE),a.setDepthWriteEnabled(!1)):a.setBlendFunctionSeparate(d.SRC_ALPHA,
d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA)):a.setBlendingEnabled(!1);e.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));T(a,e);a.setDepthTestEnabled(!0)};this.release=function(a,b){b=a.gl;a.setPolygonOffsetFillEnabled(!1);U(a,e);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);a.setDepthWriteEnabled(!0);a.setFrontFace(b.CCW)};this.bindView=function(a,b){n=l[b.shadowMappingEnabled?1:0][b.ssaoEnabled?
1:0];a=b.origin;r.bindView(a,b.view,n);r.bindCamPos(a,b.viewInvTransp,n);b.shadowMappingEnabled&&b.shadowMap.bindView(n,a)};this.bindInstance=function(a,b){n.setUniformMatrix4fv("model",b.transformation);n.setUniformMatrix4fv("modelNormal",b.transformationNormal);b.instanceParameters&&f&&(a=b.instanceParameters.color)&&n.setUniform4fv("externalColor",w(a,e.externalColor))};this.getDrawMode=function(a){return a.gl.TRIANGLES}},ca=function(a,b,d,e){r.basicGLMaterialConstructor(this,a);var c=r.copyParameters(a.getParams());
this.instanced=A&&c.instanced;var g=l.hasAttribute(a.getVertexBufferLayout(),"uv0")?"Textured":"none",k=b.getShaderVariationsProgram("material-depth",[g,c.flipV,!!this.instanced,!!e,!!c.vvSizeEnabled,null!=c.verticalOffset,null!=c.screenSizePerspective]),h=W(c.transparent,c.writeStencil);r.singleTextureGLMaterialConstructor(this,d,c);this.beginSlot=function(a){return h===a};this.getProgram=function(){return k};this.updateParameters=function(){var b=a.getParams();c.initTexture=b.initTexture;c.cullFace=
b.cullFace;c.inverseWindingOrder=b.inverseWindingOrder;c.flipV=b.flipV;z(c,b);this.updateTexture(b.textureId)};this.bind=function(a,b){var d=a.gl;a.bindProgram(k);k.setUniform2fv("nearFar",b.nearFar);c.inverseWindingOrder&&a.setFrontFace(d.CW);r.bindVerticalOffset(c.verticalOffset,b,k);r.bindScreenSizePerspective(c.screenSizePerspective,k);y(k,c);this.bindTexture(a,k);T(a,c);a.setDepthTestEnabled(!0)};this.release=function(a){var b=a.gl;U(a,c);c.inverseWindingOrder&&a.setFrontFace(b.CCW)};this.bindView=
function(a,b){r.bindView(b.origin,b.view,k);c.screenSizePerspective&&r.bindCamPos(b.origin,b.viewInvTransp,k)};this.bindInstance=function(a,b){k.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},V=function(a,b,d){ca.call(this,a,b,d,!0)},e=function(a,b,d){r.basicGLMaterialConstructor(this,a);var e=r.copyParameters(a.getParams()),c=l.hasAttribute(a.getVertexBufferLayout(),"uv0")?"Textured":"none";this.instanced=A&&e.instanced;var g=b.getShaderVariationsProgram("material-normal",
[c,e.flipV,!!this.instanced,!!e.vvSizeEnabled,null!=e.verticalOffset,null!=e.screenSizePerspective]),k=W(e.transparent,e.writeStencil);r.singleTextureGLMaterialConstructor(this,d,e);this.beginSlot=function(a){return k===a};this.getProgram=function(){return g};this.updateParameters=function(){var b=a.getParams();e.initTexture=b.initTexture;e.cullFace=b.cullFace;e.inverseWindingOrder=b.inverseWindingOrder;e.flipV=b.flipV;z(e,b);this.updateTexture(b.textureId)};this.bind=function(a,b){var d=a.gl;a.bindProgram(g);
this.bindTexture(a,g);g.setUniformMatrix4fv("viewNormal",b.viewInvTransp);r.bindVerticalOffset(e.verticalOffset,b,g);r.bindScreenSizePerspective(e.screenSizePerspective,g);y(g,e);T(a,e);e.inverseWindingOrder&&a.setFrontFace(d.CW);a.setDepthTestEnabled(!0)};this.release=function(a){var b=a.gl;U(a,e);e.inverseWindingOrder&&a.setFrontFace(b.CCW)};this.bindView=function(a,b){r.bindView(b.origin,b.view,g);e.screenSizePerspective&&r.bindCamPos(b.origin,b.viewInvTransp,g)};this.bindInstance=function(a,b){g.setUniformMatrix4fv("model",
b.transformation);g.setUniformMatrix4fv("modelNormal",b.transformationNormal)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},d=function(a,b,d,e){r.basicGLMaterialConstructor(this,a);var c=r.copyParameters(a.getParams());e=l.hasAttribute(a.getVertexBufferLayout(),"uv0")?"Textured":"none";this.instanced=A&&c.instanced;var g=b.getShaderVariationsProgram("material-highlight",[e,c.flipV,!!this.instanced,!!c.vvSizeEnabled,null!=c.verticalOffset,null!=c.screenSizePerspective]),k=W(c.transparent,c.writeStencil);
r.singleTextureGLMaterialConstructor(this,d,c);this.beginSlot=function(a){return k===a};this.getProgram=function(){return g};this.updateParameters=function(){var b=a.getParams();c.initTexture=b.initTexture;c.cullFace=b.cullFace;c.inverseWindingOrder=b.inverseWindingOrder;c.flipV=b.flipV;z(c,b);this.updateTexture(b.textureId)};this.bind=function(a,b){var d=a.gl;a.bindProgram(g);this.bindTexture(a,g);r.bindVerticalOffset(c.verticalOffset,b,g);r.bindScreenSizePerspective(c.screenSizePerspective,g);y(g,
c);T(a,c);c.inverseWindingOrder&&a.setFrontFace(d.CW);a.setDepthTestEnabled(!0)};this.release=function(a){var b=a.gl;U(a,c);c.inverseWindingOrder&&a.setFrontFace(b.CW)};this.bindView=function(a,b){r.bindView(b.origin,b.view,g);c.screenSizePerspective&&r.bindCamPos(b.origin,b.viewInvTransp,g)};this.bindInstance=function(a,b){g.setUniformMatrix4fv("model",b.transformation);g.setUniformMatrix4fv("modelNormal",b.transformationNormal)};this.getDrawMode=function(a){return a.gl.TRIANGLES}};b.loadShaders=
function(b,d,e,c){b._parse(B);A=c.extensions.angleInstancedArrays;c.extensions.shaderTextureLOD;c.extensions.standardDerivatives;var g=new a("phong",["vsPhong","fsPhong"],null,e,d,b,c);g.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);g.addBinaryShaderSnippetSuffix("Refl","Refl",[!1,!0]);g.addDefine("Color","VERTEXCOLORS");g.addDefine("symbolColor","SYMBOLVERTEXCOLORS");g.addDefine("FlipV","FLIPV");g.addDefine("DoubleSided",
"DOUBLESIDED");g.addDefine("Instanced","INSTANCED");g.addDefine("InstColor","INSTANCEDCOLOR");g.addDefine("ReceiveShadows","RECEIVE_SHADOWS");g.addDefine("ReceiveSSAO","RECEIVE_SSAO");g.addDefine("vvSize","VV_SIZE");g.addDefine("vvColor","VV_COLOR");g.addDefine("VerticalOffset","VERTICAL_OFFSET");g.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");g.addDefine("groundNormalShading","GROUND_NORMAL_SHADING");e.addShaderVariations("material",g);g=new a("depth",["vsDepth","fsDepth"],null,e,
d,b,c);g.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);g.addDefine("FlipV","FLIPV");g.addDefine("Instanced","INSTANCED");g.addDefine("ShadowMap","BIAS_SHADOWMAP");g.addDefine("vvSize","VV_SIZE");g.addDefine("VerticalOffset","VERTICAL_OFFSET");g.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addShaderVariations("material-depth",g);g=new a("normal",["vsNormal","fsNormal"],null,e,d,b,c);g.addNaryShaderSnippetSuffix([{value:"none",
programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);g.addDefine("FlipV","FLIPV");g.addDefine("Instanced","INSTANCED");g.addDefine("vvSize","VV_SIZE");g.addDefine("VerticalOffset","VERTICAL_OFFSET");g.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addShaderVariations("material-normal",g);g=new a("highlight",["vsHighlight","fsHighlight"],null,e,d,b,c);g.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},
{value:"AtlasTextured"}]);g.addDefine("FlipV","FLIPV");g.addDefine("Instanced","INSTANCED");g.addDefine("vvSize","VV_SIZE");g.addDefine("VerticalOffset","VERTICAL_OFFSET");g.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addShaderVariations("material-highlight",g);var g=new f(c,b.vsDepth,b.fsDepth,p.Default3D,["BIAS_SHADOWMAP 1"]),k=new f(c,b.vsDepthTextured,b.fsDepthTextured,p.Default3D,["BIAS_SHADOWMAP 1"]),h=new f(c,b.vsDepth,b.fsDepth,p.Default3D),l=new f(c,b.vsDepthTextured,b.fsDepthTextured,
p.Default3D),m=new f(c,b.vsNormal,b.fsNormal,p.Default3D),n=new f(c,b.vsNormalTextured,b.fsNormalTextured,p.Default3D),q=new f(c,b.vsHighlight,b.fsHighlight,p.Default3D);c=new f(c,b.vsHighlightTextured,b.fsHighlightTextured,p.Default3D);e.add("depthShadowMap",g);e.add("depthTexturedShadowMap",k);e.add("depth",h);e.add("depthTextured",l);e.add("normal",m);e.add("normalTextured",n);e.add("highlight",q);e.add("highlightTextured",c);d.add("fsDepth",{source:b.fsDepth});d.add("fsDepthTextured",{source:b.fsDepthTextured});
d.add("fsDepthShadowMap",{source:b.fsDepthShadowMap,defines:["BIAS_SHADOWMAP 1"]});d.add("fsDepthTexturedShadowMap",{source:b.fsDepthTextured,defines:["BIAS_SHADOWMAP 1"]});d.add("vsDepth",{source:b.vsDepth});d.add("fsNormal",{source:b.fsNormal})};return b})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry/SpatialReference ../../../../geometry/Point ../../../../geometry/support/webMercatorUtils ../../lib/glMatrix".split(" "),function(B,r,f,a,b,
c){function t(a,c){var h=a.spatialReference;h.equals(c)||(h.isWebMercator&&c.wkid===f.WGS84.wkid?b.webMercatorToGeographic(a,!1,a):c.isWebMercator&&h.wkid===f.WGS84.wkid&&b.geographicToWebMercator(a,!1,a))}function p(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!p(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(r,"__esModule",{value:!0});var h=c.vec4d,l=c.mat4d,q=[1,1,1];r.computeCentroid=function(b,c){if("extent"===b.type)return b.center;if("polygon"===b.type)return b.centroid;
for(var h=0,f=0,l=0,q=b.hasZ,p=0,n=0,y=b.paths;n<y.length;n++){for(var z=y[n],r=0,K=z;r<K.length;r++){var J=K[r],h=h+J[0],f=f+J[1];q&&(l+=J[2])}p+=z.length}b=new a({x:h/p,y:f/p,z:q?l/p:void 0,spatialReference:b.spatialReference});c&&t(b,c);return b};r.convertToSR=t;r.enlargeExtent=function(a,b,c){if(a){b||(b=h.create());var f=.5*a.width*(c-1);c=.5*a.height*(c-1);a.width<1E-7*a.height?f+=c/20:a.height<1E-7*a.width&&(c+=f/20);h.set4(a.xmin-f,a.ymin-c,a.xmax+f,a.ymax+c,b);return b}return null};r.updateVertexAttributeAuxpos1w=
function(a,b){for(var c=0;c<a.geometries.length;++c){var h=a.geometries[c].data.vertexAttributes.auxpos1;h&&h.data[3]!==b&&(h.data[3]=b,a.geometryVertexAttrsUpdated(c))}};r.mixinColorAndOpacity=function(a,b){var c=[1,1,1,1];null!=a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);null!==b&&void 0!==b?c[3]=b:null!=a&&3<a.length&&(c[3]=a[3]);return c};r.overrideColor=function(a,b,c,h,f){f=f.slice();for(var l=0;3>l;++l)a&&null!=a[l]?f[l]=a[l]:c&&null!=c[l]&&(f[l]=c[l]);null!=b?f[3]=b:null!=h&&(f[3]=h);return f};r.computeObjectScale=
function(a,b,c,h){void 0===a&&(a=q);void 0===h&&(h=1);var f=Array(3);if(null==b||null==c)f[0]=1,f[1]=1,f[2]=1;else{for(var l=void 0,p=0,n=2;0<=n;n--){var u=a[n],t=void 0,w=null!=u,y=0===n&&!l&&!w,z=c[n];"symbolValue"===u||y?t=0!==z?b[n]/z:1:w&&"proportional"!==u&&isFinite(u)&&(t=0!==z?u/z:1);null!=t&&(l=f[n]=t,p=Math.max(p,Math.abs(t)))}for(n=2;0<=n;n--)null==f[n]?f[n]=l:0===f[n]&&(f[n]=.001*p)}for(n=2;0<=n;n--)f[n]/=h;return f};r.computeSizeWithResourceSize=function(a,b){var c=b.width,h=b.depth,
f=b.height;b=b.isPrimitive?10:1;if(null==c&&null==f&&null==h)return[b*a[0],b*a[1],b*a[2]];for(var c=[c,h,f],l,h=0;3>h;h++)if(f=c[h],null!=f){l=f/a[h];break}for(h=0;3>h;h++)null==c[h]&&(c[h]=a[h]*l);return c};r.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return p(a)?null:"Symbol sizes may not be negative values"};r.computeObjectRotation=function(a,b,c,h){void 0===h&&(h=l.identity());a=a||0;b=b||0;c=c||0;0!==a&&l.rotateZ(h,-a/180*Math.PI,h);0!==b&&l.rotateX(h,
b/180*Math.PI,h);0!==c&&l.rotateY(h,c/180*Math.PI,h);return h}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("dojo/_base/lang dojo/text!./RibbonLineMaterial.xml ./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/ComponentUtils ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(B,r,f,a,b,c,t,p,h,l,q){var y=[255,255,255,255],z=[0,0,0,0],w=b.vec3d,u=b.vec2d,
C=b.mat4d,E=w.create(),G=w.create(),n=w.create(),A=w.create(),x=u.create(),I=u.create(),K=w.create(),J=w.create();b=function(b,c){f.basicMaterialConstructor(this,c);var h=a.VertexAttrConstants;b=b||{};b.color=b.color||[1,1,1,1];b.width=b.width||0;b.type=b.type||"screen";b.join=b.join||"miter";b.miterLimit="miter"===b.join?b.miterLimit||5:b.miterLimit;var p="wall"===b.type?2:4,u=l.Pos3Tex;"wall"!==b.type&&(u=[{name:"position",count:3,type:5126,offset:0,stride:64,normalized:!1},{name:"uv0",count:2,
type:5126,offset:12,stride:64,normalized:!1},{name:"auxpos1",count:3,type:5126,offset:20,stride:64,normalized:!1},{name:"auxpos2",count:3,type:5126,offset:32,stride:64,normalized:!1},{name:"color",count:4,type:5126,offset:44,stride:64,normalized:!1},{name:"size",count:1,type:5126,offset:60,stride:64,normalized:!1}]);this.canBeMerged=!1;this.getParams=function(){return b};this.getParameterValues=function(){var a={color:b.color,width:b.width,type:b.type,join:b.join,polygonOffset:b.polygonOffset};"miter"===
b.join&&(a.miterLimit=b.miterLimit);return a};this.setParameterValues=function(c){for(var h in c)c.hasOwnProperty(h)&&(a.assert("type"!==h,"RibbonLineMaterial: type cannot be changed after creation"),b[h]=c[h]);this.notifyDirty("matChanged")};this.dispose=function(){};this.getOutputAmount=function(a){return((a/2+1-2)*p+4)*q.getStride(u)/4};this.getVertexBufferLayout=function(){return u};this.fillInterleaved=function(a,c,k,f,l,e){k=a.vertexAttr[h.POSITION].data;f=a.vertexAttr[h.COLOR]?a.vertexAttr[h.COLOR].data:
y;var d=a.vertexAttr[h.SIZE]?a.vertexAttr[h.SIZE].data:z;(a=a.faces&&a.faces.indices&&a.faces.indices.position)&&a.length!=2*(k.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");if("wall"===b.type){f=e;d=k.length/3;e=0;a=k[0];for(var g=k[1],m=k[2],n,q,p,u=0;u<d;u++){var t=3*u;n=a;q=g;p=m;a=k[t];g=k[t+1];m=k[t+2];c&&(a=c[0]*a+c[4]*g+c[8]*m+c[12],g=c[1]*a+c[5]*g+c[9]*m+c[13],m=c[2]*a+c[6]*g+c[10]*m+c[14]);e+=Math.sqrt((a-n)*(a-n)+(g-q)*(g-q)+(m-p)*(m-p));l[f++]=a;l[f++]=g;l[f++]=
m;l[f++]=e;l[f++]=-1;l[f++]=a;l[f++]=g;l[f++]=m;l[f++]=e;l[f++]=1}}else{a=k.length/3;g=k[0];m=k[1];n=k[2];q=0;c&&(g=c[0]*g+c[4]*m+c[8]*n+c[12],m=c[1]*g+c[5]*m+c[9]*n+c[13],n=c[2]*g+c[6]*m+c[10]*n+c[14]);p=g;var u=m,t=n,w=k[3],x=k[4],r=k[5];c&&(w=c[0]*w+c[4]*x+c[8]*r+c[12],x=c[1]*w+c[5]*x+c[9]*r+c[13],r=c[2]*w+c[6]*x+c[10]*r+c[14]);for(var A=0;A<a;A++){var C=3*A;A<a-1&&(w=k[C+3],x=k[C+4],r=k[C+5],c&&(w=c[0]*w+c[4]*x+c[8]*r+c[12],x=c[1]*w+c[5]*x+c[9]*r+c[13],r=c[2]*w+c[6]*x+c[10]*r+c[14]));q+=Math.sqrt((p-
g)*(p-g)+(u-m)*(u-m)+(t-n)*(t-n));l[e++]=p;l[e++]=u;l[e++]=t;l[e++]=q;l[e++]=0===A?-1.2:-1;l[e++]=g;l[e++]=m;l[e++]=n;l[e++]=w;l[e++]=x;l[e++]=r;l[e++]=f[0];l[e++]=f[1];l[e++]=f[2];l[e++]=f[3];l[e++]=d[0];l[e++]=p;l[e++]=u;l[e++]=t;l[e++]=q;l[e++]=0===A?1.2:1;l[e++]=g;l[e++]=m;l[e++]=n;l[e++]=w;l[e++]=x;l[e++]=r;l[e++]=f[0];l[e++]=f[1];l[e++]=f[2];l[e++]=f[3];l[e++]=d[0];0<A&&A<a-1&&(l[e++]=p,l[e++]=u,l[e++]=t,l[e++]=q,l[e++]=-1.2,l[e++]=g,l[e++]=m,l[e++]=n,l[e++]=w,l[e++]=x,l[e++]=r,l[e++]=f[0],
l[e++]=f[1],l[e++]=f[2],l[e++]=f[3],l[e++]=d[0],l[e++]=p,l[e++]=u,l[e++]=t,l[e++]=q,l[e++]=1.2,l[e++]=g,l[e++]=m,l[e++]=n,l[e++]=w,l[e++]=x,l[e++]=r,l[e++]=f[0],l[e++]=f[1],l[e++]=f[2],l[e++]=f[3],l[e++]=d[0]);g=p;m=u;n=t;p=w;u=x;t=r}}};this.intersect=function(c,f,k,l,q,e,d){if(l.isSelection&&!t.isAllHidden(f.componentVisibilities,c.data.componentOffsets)){f=c.getData().getVertexAttr(h.position).position.data;c=c.getData().getVertexAttr(h.SIZE).size;c=(c&&c.data[0])+b.width;q=Number.MAX_VALUE;var g,
m;e=l.camera;for(var p=l.point,u=0;u<f.length-5;u+=3){E[0]=f[u];E[1]=f[u+1];E[2]=f[u+2];C.multiplyVec3(k,E);G[0]=f[u+3];G[1]=f[u+4];G[2]=f[u+5];C.multiplyVec3(k,G);e.projectPoint(E,x);e.projectPoint(G,I);if(0>x[2]&&0<I[2])w.subtract(E,G,n),g=e.frustumPlanes,m=-(w.dot(g[4],E)+g[4][3]),g=m/w.dot(n,g[4]),w.scale(n,g,n),w.add(E,n,E),e.projectPoint(E,x);else if(0<x[2]&&0>I[2])w.subtract(G,E,n),g=e.frustumPlanes,m=-(w.dot(g[4],G)+g[4][3]),g=m/w.dot(n,g[4]),w.scale(n,g,n),w.add(G,n,G),e.projectPoint(G,I);
else if(0>x[2]&&0>I[2])continue;g=a.pointLineSegmentDistance2D(x,I,p);g<q&&(q=g,w.set(E,K),w.set(G,J))}k=l.p0;l=l.p1;q<c/2+4&&(f=a.lineSegmentLineSegmentDistance3D(K,J,k,l),c=Number.MAX_VALUE,f[0]&&(w.subtract(f[2],k,A),c=w.length(A)/w.dist(k,l)),d(c,A))}};this.getGLMaterials=function(){return{color:N,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:M}};this.getAllTextureIds=function(){return[]}};var N=function(a,b){f.basicGLMaterialConstructor(this,a);var h=B.clone(a.getParams());h.miterLimit=
"miter"===h.join?h.miterLimit:0;delete h.join;var l=b.get("ribbonLine_"+h.type);this.updateParameters=function(){var b=a.getParams();h.polygonOffset=b.polygonOffset;h.color=b.color;h.width=b.width;h.miterLimit="miter"===b.join?b.miterLimit:0};this.beginSlot=function(a){return a===c.TRANSPARENT_MATERIAL};this.getProgram=function(){return l};this.bind=function(a,b){a.bindProgram(l);l.setUniform4fv("eColor",h.color);l.setUniform1f("miterLimit",h.miterLimit);l.setUniform1f("nearPlane",b.nearFar[0]);"screen"===
h.type?(l.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),l.setUniform1f("extLineWidth",h.width*b.pixelRatio)):l.setUniform1f("extLineWidth",h.width);h.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=h.color[3])};this.release=function(a){h.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);
a.setBlendingEnabled(!1);a.setDepthWriteEnabled(!0)};this.bindView=function(a,b){f.bindView(b.origin,b.view,l)};this.bindInstance=function(a,b){l.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP}},M=function(a,b){f.basicGLMaterialConstructor(this,a);var h=B.clone(a.getParams());h.miterLimit="miter"===h.join?h.miterLimit:0;delete h.join;var l=b.get("ribbonLineHighlight_"+h.type);this.updateParameters=function(){var b=a.getParams();h.polygonOffset=
b.polygonOffset;h.color=b.color;h.width=b.width;h.miterLimit="miter"===b.join?b.miterLimit:0};this.beginSlot=function(a){return a===c.OPAQUE_MATERIAL};this.getProgram=function(){return l};this.bind=function(a,b){a.bindProgram(l);l.setUniform4fv("eColor",h.color);l.setUniform1f("miterLimit",h.miterLimit);l.setUniform1f("nearPlane",b.nearFar[0]);"screen"===h.type?(l.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),l.setUniform1f("extLineWidth",h.width*b.pixelRatio)):l.setUniform1f("extLineWidth",
h.width);h.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=h.color[3])};this.release=function(a){h.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setDepthWriteEnabled(!0)};this.bindView=function(a,b){f.bindView(b.origin,b.view,l)};this.bindInstance=function(a,b){l.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP}};b.loadShaders=function(a,
b,c,f){a._parse(r);b=new p(f,a.vsRibbonLine,a.fsRibbonLine,h.Default3D,["SCREENSCALE"]);var l=new p(f,a.vsRibbonLine,a.fsRibbonLineHighlight,h.Default3D,["SCREENSCALE"]),n=new p(f,a.vsRibbonLine,a.fsRibbonLine,h.Default3D),q=new p(f,a.vsRibbonLine,a.fsRibbonLineHighlight,h.Default3D),k=new p(f,a.vsRibbonLine,a.fsRibbonLine,h.Default3D,["WALL"]);a=new p(f,a.vsRibbonLine,a.fsRibbonLineHighlight,h.Default3D,["WALL"]);c.add("ribbonLine_screen",b);c.add("ribbonLineHighlight_screen",l);c.add("ribbonLine_strip",
n);c.add("ribbonLineHighlight_strip",q);c.add("ribbonLine_wall",k);c.add("ribbonLineHighlight_wall",a)};return b})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("dojo/text!./WaterMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(B,r,f,a,b,c,t){var p=function(a,b,f,p,w,u){r.basicMaterialConstructor(this,u);var l=c.Pos3;this.dispose=
function(){};this.getNoiseTextureId=function(){return a};this.getReflTextureId=function(){return b};this.getColor=function(){return f};this.getScale=function(){return p};this.getSpeed=function(){return w};this.getOutputAmount=function(a){return a*t.getStride(l)/4};this.getVertexBufferLayout=function(){return l};this.fillInterleaved=function(a,b,c,h,f,q,p){r.fillInterleaved(a,b,c,h,l,f,q,p)};this.intersect=r.intersectTriangleGeometry;this.getGLMaterials=function(){return{color:h,depthShadowMap:void 0,
normal:void 0,depth:void 0,highlight:void 0}};this.getAllTextureIds=function(){return[a,b]}},h=function(a,b,c){r.basicGLMaterialConstructor(this,a);var h=f.TRANSPARENT_MATERIAL,l=b.get("water");b={noiseTextureId:a.getNoiseTextureId(),reflTextureId:a.getReflTextureId()};r.multiTextureGLMaterialConstructor(this,c,b,[["noiseTextureId",void 0,"noiseTex"],["reflTextureId",void 0,"reflTex"]]);var q=a.getColor(),p=a.getScale(),t=a.getSpeed(),y=Date.now();this.beginSlot=function(a){return h===a};this.getProgram=
function(){return l};this.bind=function(a,b){a.bindProgram(l);this.bindTextures(a,l);l.setUniform3fv("color",q);l.setUniform1f("scale",p);a=(Date.now()-y)/1E5*t;a-=Math.floor(a);l.setUniform1f("speed",a);b.shadowMappingEnabled||l.setUniform1f("depthHalfPixelSz",-1)};this.release=function(a){};this.bindView=function(a,b){a=b.origin;r.bindView(a,b.view,l);r.bindCamPos(a,b.viewInvTransp,l);b.shadowMappingEnabled&&b.shadowMap.bindView(l,a)};this.bindInstance=function(a,b){l.setUniformMatrix4fv("model",
b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}};p.loadShaders=function(c,h,f,p){c._parse(B);c=new a(p,c.vertexShaderWater,c.fragmentShaderWater,b.Default3D);f.add("water",c)};return p})},"esri/views/3d/webgl-engine/materials/internal/BlendLayers":function(){define(["dojo/text!./BlendLayers.xml","../../../../webgl/Program","../../lib/DefaultVertexAttributeLocations"],function(B,r,f){return{loadShaders:function(a,b,c,t){a._parse(B);a=new r(t,a.vertexShaderBlendLayers,a.fragmentShaderBlendLayers,
f.Default3D);c.add("blendLayers",a)}}})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});var a=null,b=[];r.enabled=!1;r.begin=function(){r.enabled&&(a=[])};r.trace=function(b){r.enabled&&null!=a&&a.push(b)};r.end=function(){if(r.enabled){var c=a;a=null;c&&(b.forEach(function(a){return a(c)}),b.length=0);return c}};r.instrumentContext=function(b){return r.enabled?f.makeDebugContext(b,void 0,
function(b,c){r.enabled&&a&&a.push("gl."+b+"("+f.glFunctionArgsToString(b,c)+")")}):b};r.request=function(a){b.push(a)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function B(a){if(null==h){h={};l={};for(var b in a)"number"==typeof a[b]&&(h[a[b]]=b,l[b]=a[b])}}function r(){if(null==h)throw"WebGLDebugUtils.init(ctx) not called";}function f(a){r();var b=h[a];return void 0!==b?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function a(a,b,c,h){a=p[a];if(void 0!==
a&&(a=a[b],void 0!==a&&a[c])){if("object"===typeof a[c]&&void 0!==a[c].enumBitwiseOr){b=a[c].enumBitwiseOr;c=0;a=[];for(var q=0;q<b.length;++q){var t=l[b[q]];0!==(h&t)&&(c|=t,a.push(f(t)))}return c===h?a.join(" | "):f(h)}return f(h)}return null===h?"null":void 0===h?"undefined":h.toString()}function b(a,b,c){a.__defineGetter__(c,function(){return b[c]});a.__defineSetter__(c,function(a){b[c]=a})}function c(h,l,p,t){function q(a,b){return function(){p&&p(b,arguments);var c=a[b].apply(a,arguments),h=
t.getError();0!=h&&(w[h]=!0,l(h,b,arguments));return c}}t=t||h;B(h);l=l||function(b,c,h){for(var l="",n=h.length,q=0;q<n;++q)l+=(0==q?"":", ")+a(c,n,q,h[q]);b="WebGL error "+f(b)+" in "+c+"("+l+")";window.console&&window.console.error?window.console.error(b):window.console&&window.console.log&&window.console.log(b)};var w={},y={},z;for(z in h)if("function"==typeof h[z])if("getExtension"!=z)y[z]=q(h,z);else{var n=q(h,z);y[z]=function(){var a=n.apply(h,arguments);return c(a,l,p,t)}}else b(y,h,z);y.getError=
function(){for(var a in w)if(w.hasOwnProperty(a)&&w[a])return w[a]=!1,a;return h.NO_ERROR};return y}function t(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var h=0;h<b;++h)a.disableVertexAttribArray(h),a.vertexAttribPointer(h,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(h,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(h=0;h<b;++h)a.activeTexture(a.TEXTURE0+h),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);
a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);
a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,
4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var p={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},
bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,
1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,
1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},h=null,l=null;return{init:B,mightBeEnum:function(a){r();return void 0!==h[a]},
glEnumToString:f,glFunctionArgToString:a,glFunctionArgsToString:function(b,c){for(var h="",f=c.length,l=0;l<f;++l)h+=(0==l?"":", ")+a(b,f,l,c[l]);return h},makeDebugContext:c,makeLostContextSimulatingCanvas:function(a){function c(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function h(){for(var a=Object.keys(P),b=0;b<a.length;++b)delete P[a]}function f(){++B;K||N==B&&a.loseContext()}function l(a,b){var c=a[b];return function(){f();if(!K)return c.apply(a,arguments)}}function q(a){return{statusMessage:a,
preventDefault:function(){Q=!0}}}function p(a){for(var c in a)"function"==typeof a[c]?n[c]=l(a,c):b(n,a,c);n.getError=function(){f();if(!K)for(var a;a=r.getError();)P[a]=!0;for(a in P)if(P[a])return delete P[a],a;return n.NO_ERROR};var h="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(c=0;c<h.length;++c){var q=h[c];n[q]=function(b){return function(){f();if(K)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=I;J.push(c);
return c}}(a[q])}h="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(c=0;c<h.length;++c)q=h[c],n[q]=function(b){return function(){f();return K?null:b.apply(a,arguments)}}(n[q]);h="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");
for(c=0;c<h.length;++c)q=h[c],n[q]=function(b){return function(){f();return K?!1:b.apply(a,arguments)}}(n[q]);n.checkFramebufferStatus=function(b){return function(){f();return K?n.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(n.checkFramebufferStatus);n.getAttribLocation=function(b){return function(){f();return K?-1:b.apply(a,arguments)}}(n.getAttribLocation);n.getVertexAttribOffset=function(b){return function(){f();return K?0:b.apply(a,arguments)}}(n.getVertexAttribOffset);n.isContextLost=function(){return K};
return n}var r,n,A=[],x=[];n={};var I=1,K=!1,J=[],N=0,B=0,Q=!1,S=0,P={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=r){if(r)throw"got different context";r=c;n=p(r)}return n}return c}}(a.getContext);(function(a){var b=a.addEventListener;a.addEventListener=function(h,f,k){switch(h){case "webglcontextlost":A.push(c(f));break;case "webglcontextrestored":x.push(c(f));break;default:b.apply(a,arguments)}}})(a);a.loseContext=function(){if(!K){K=
!0;N=0;for(++I;r.getError(););h();P[r.CONTEXT_LOST_WEBGL]=!0;var b=q("context lost"),c=A.slice();setTimeout(function(){for(var h=0;h<c.length;++h)c[h](b);0<=S&&setTimeout(function(){a.restoreContext()},S)},0)}};a.restoreContext=function(){K&&x.length&&setTimeout(function(){if(!Q)throw"can not restore. webglcontestlost listener did not call event.preventDefault";for(var a=0;a<J.length;++a){var b=J[a];b instanceof WebGLBuffer?r.deleteBuffer(b):b instanceof WebGLFramebuffer?r.deleteFramebuffer(b):b instanceof
WebGLProgram?r.deleteProgram(b):b instanceof WebGLRenderbuffer?r.deleteRenderbuffer(b):b instanceof WebGLShader?r.deleteShader(b):b instanceof WebGLTexture&&r.deleteTexture(b)}t(r);K=!1;B=0;Q=!1;for(var a=x.slice(),b=q("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(K)throw"You can not ask a lost contet to be lost";N=B+a};a.getNumCalls=function(){return B};a.setRestoreTimeout=function(a){S=a};return a},resetToInitialState:t}})},"esri/views/webgl/RenderingContext":function(){define(["require",
"exports","./enums","./Extensions"],function(B,r,f,a){return function(){function b(b,f){this.gl=null;this._extensions=void 0;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=
!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=
this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this.gl=b;this._extensions=new a(b,f);f=b.getParameter(b.VIEWPORT);this._viewport={x:f[0],y:f[1],width:f[2],height:f[3]};f=this.extensions.textureFilterAnisotropic;this._parameters={versionString:b.getParameter(b.VERSION),maxVertexTextureImageUnits:b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:b.getParameter(b.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:f?b.getParameter(f.MAX_TEXTURE_MAX_ANISOTROPY_EXT):
void 0,maxTextureImageUnits:b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS)};this.enforceState()}Object.defineProperty(b.prototype,"extensions",{get:function(){return this._extensions},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this.bindVAO(null);
this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};b.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a)};b.prototype.setBlendColor=function(a,b,f,h){if(a!==this._blendColorState.r||b!==this._blendColorState.g||f!==this._blendColorState.b||h!==this._blendColorState.a)this.gl.blendColor(a,b,f,h),this._blendColorState.r=a,this._blendColorState.g=b,this._blendColorState.b=
f,this._blendColorState.a=h};b.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b};b.prototype.setBlendFunctionSeparate=function(a,b,f,h){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==f||this._blendFunctionState.dstRGB!==b||this._blendFunctionState.dstAlpha!==
h)this.gl.blendFuncSeparate(a,b,f,h),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=f,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=h};b.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a)};b.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==b)this.gl.blendEquationSeparate(a,
b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b};b.prototype.setColorMask=function(a,b,f,h){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==f||this._colorMaskState.a!==h)this.gl.colorMask(a,b,f,h),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=f,this._colorMaskState.a=h};b.prototype.setClearColor=function(a,b,f,h){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==f||this._clearColor.a!==h)this.gl.clearColor(a,
b,f,h),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=f,this._clearColor.a=h};b.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a)};b.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a)};b.prototype.setPolygonOffset=
function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b)};b.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a)};b.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a)};b.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),
this._scissorTestEnabled=a)};b.prototype.setScissorRect=function(a,b,f,h){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==f||this._scissorRect.height!==h)this.gl.scissor(a,b,f,h),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=f,this._scissorRect.height=h};b.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a)};b.prototype.setClearDepth=
function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};b.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a)};b.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a)};b.prototype.setDepthRange=function(a,b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=b};b.prototype.setStencilTestEnabled=
function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a)};b.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};b.prototype.setStencilFunction=function(a,b,f){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==f)this.gl.stencilFunc(a,b,f),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=
b,this._stencilFunction.mask=f};b.prototype.setStencilFunctionSeparate=function(a,b,f,h){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==f||this._stencilFunction.mask!==h)this.gl.stencilFuncSeparate(a,b,f,h),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=f,this._stencilFunction.mask=h};b.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a)};b.prototype.setStencilOp=
function(a,b,f){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==f)this.gl.stencilOp(a,b,f),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=f};b.prototype.setStencilOpSeparate=function(a,b,f,h){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==f||this._stencilOperation.zPass!==h)this.gl.stencilOpSeparate(a,b,f,h),this._stencilOperation.face=
a,this._stencilOperation.face=a,this._stencilOperation.fail=b,this._stencilOperation.zFail=f,this._stencilOperation.zPass=h};b.prototype.setLineWidth=function(a){var b=this._lineWidth;this._lineWidth!==a&&(this.gl.lineWidth(a),this._lineWidth=a);return b};b.prototype.setActiveTexture=function(a){var b=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(f.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return b};b.prototype.clear=function(a){a&&this.gl.clear(a)};b.prototype.drawArrays=
function(a,b,f){this.gl.drawArrays(a,b,f)};b.prototype.drawElements=function(a,b,f,h){5123===f?this.gl.drawElements(a,b,f,h):5125===f&&this._extensions.elementIndexUint?this.gl.drawElements(a,b,f,h):console.warn("Data type is uint however extension OES_Element_index_unit is not supported therefore this draw call cannot be made")};b.prototype.drawArraysInstanced=function(a,b,f,h){this._extensions.angleInstancedArrays?this._extensions.angleInstancedArrays.drawArraysInstancedANGLE(a,b,f,h):console.error("Extension ANGLE_instanced_arrays isn't supported!")};
b.prototype.drawElementsInstanced=function(a,b,f,h,l){this._extensions.angleInstancedArrays?5125!==f||this._extensions.elementIndexUint?this._extensions.angleInstancedArrays.drawElementsInstancedANGLE(a,b,f,h,l):console.error("Extension OES_Element_index_unit is not supported!"):console.error("Extension ANGLE_instanced_arrays isn't supported!")};b.prototype.setViewport=function(a,b,f,h){var c=this._viewport;if(c.x!==a||c.y!==b||c.width!==f||c.height!==h)c.x=a,c.y=b,c.width=f,c.height=h,this.gl.viewport(a,
b,f,h)};b.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};b.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};b.prototype.bindTexture=function(a,f){void 0===f&&(f=0);-1===b._MAX_TEXTURE_IMAGE_UNITS&&(b._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));
(f>=b._MAX_TEXTURE_IMAGE_UNITS||0>f)&&console.error("Input texture unit is out of range of available units!");var c=this._textureUnitMap[f];this.setActiveTexture(f);null==a||null==a.glName?(null!=c&&(this.gl.bindTexture(c.descriptor.target,null),c.setBoundToUnit(f,!1)),this._textureUnitMap[f]=null):c&&c.id===a.id?a.applyChanges():(this.gl.bindTexture(a.descriptor.target,a.glName),a.setBoundToUnit(f,!0),a.applyChanges(),this._textureUnitMap[f]=a)};b.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==
a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};b.prototype.bindBuffer=function(a){a&&(34962===a.bufferType?this._activeVertexBuffer=b._bindBuffer(this.gl,a,a.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=b._bindBuffer(this.gl,a,a.bufferType,this._activeIndexBuffer))};b.prototype.unbindBuffer=function(a){34962===a?this._activeVertexBuffer=b._bindBuffer(this.gl,
null,a,this._activeVertexBuffer):this._activeIndexBuffer=b._bindBuffer(this.gl,null,a,this._activeIndexBuffer)};b.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};b.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};b.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};
b.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};b.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);
this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,
this.gl.canvas.height)};b.prototype.enforceState=function(){var a=this.gl,b=this._extensions.vao;b&&b.bindVertexArrayOES(null);for(var p=0;p<this.parameters.maxVertexAttributes;p++)a.disableVertexAttribArray(p);this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(b&&this._activeVertexArrayObject){if(b=
this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(b)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,
this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);
a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,
this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(b=
0;b<this.parameters.maxTextureImageUnits;b++)a.activeTexture(f.BASE_TEXTURE_UNIT+b),a.bindTexture(3553,null),(p=this._textureUnitMap[b])&&a.bindTexture(p.descriptor.target,p.glName);a.activeTexture(f.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};b._bindBuffer=function(a,b,f,h){if(!b)return a.bindBuffer(f,null),null;if(h===b)return h;a.bindBuffer(f,b.glName);return b};b._MAX_TEXTURE_IMAGE_UNITS=-1;return b}()})},
"esri/views/webgl/Extensions":function(){define(["require","exports"],function(B,r){return function(){function f(a,b){this._colorBufferFloatInit=this._textureFloatLinearInit=this._textureFloatInit=this._disjointTimerQueryInit=this._compressedTextureS3TCInit=this._shaderTextureLODInit=this._textureFilterAnisotropicInit=this._depthTextureInit=this._elementIndexUintInit=this._standardDerivativesInit=this._angleInstancedArraysInit=this._vaoInit=!1;this._gl=a;b&&b.disabledExtensions&&(a=b.disabledExtensions,
a.vao&&(this._vao=null,this._vaoInit=!0),a.angleInstancedArrays&&(this._angleInstancedArrays=null,this._angleInstancedArraysInit=!0),a.standardDerivatives&&(this._standardDerivatives=null,this._standardDerivativesInit=!0),a.elementIndexUint&&(this._elementIndexUint=null,this._elementIndexUintInit=!0),a.depthTexture&&(this._depthTexture=null,this._depthTextureInit=!0),a.textureFilterAnisotropic&&(this._textureFilterAnisotropic=null,this._textureFilterAnisotropicInit=!0),a.compressedTextureS3TC&&(this._compressedTextureS3TC=
null,this._compressedTextureS3TCInit=!0),a.shaderTextureLOD&&(this._shaderTextureLOD=null,this._shaderTextureLODInit=!0),a.disjointTimerQuery&&(this._disjointTimerQuery=null,this._disjointTimerQueryInit=!0),a.textureFloat&&(this._textureFloat=null,this._textureFloatInit=!0),a.textureFloatLinear&&(this._textureFloatLinear=null,this._textureFloatLinearInit=!0),a.colorBufferFloat&&(this._colorBufferFloat=null,this._colorBufferFloatInit=!0))}Object.defineProperty(f.prototype,"vao",{get:function(){this._vaoInit||
(this._vao=this._gl.getExtension("OES_vertex_array_object")||this._gl.getExtension("MOZ_OES_vertex_array_object")||this._gl.getExtension("WEBKIT_OES_vertex_array_object"),this._vaoInit=!0);return this._vao},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"angleInstancedArrays",{get:function(){this._angleInstancedArraysInit||(this._angleInstancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._angleInstancedArraysInit=!0);return this._angleInstancedArrays},enumerable:!0,
configurable:!0});Object.defineProperty(f.prototype,"standardDerivatives",{get:function(){this._standardDerivativesInit||(this._standardDerivatives=this._gl.getExtension("OES_standard_derivatives"),this._standardDerivativesInit=!0);return this._standardDerivatives},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"elementIndexUint",{get:function(){this._elementIndexUintInit||(this._elementIndexUint=this._gl.getExtension("OES_element_index_uint"),this._elementIndexUintInit=!0);return this._elementIndexUint},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"depthTexture",{get:function(){this._depthTextureInit||(this._depthTexture=this._gl.getExtension("WEBGL_depth_texture")||this._gl.getExtension("MOZ_WEBGL_depth_texture")||this._gl.getExtension("WEBKIT_WEBGL_depth_texture"),this._depthTextureInit=!0);return this._depthTexture},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"textureFilterAnisotropic",{get:function(){this._textureFilterAnisotropicInit||(this._textureFilterAnisotropic=
this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._textureFilterAnisotropicInit=!0);return this._textureFilterAnisotropic},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"shaderTextureLOD",{get:function(){this._shaderTextureLODInit||(this._shaderTextureLOD=this._gl.getExtension("EXT_shader_texture_lod"),this._shaderTextureLODInit=!0);return this._shaderTextureLOD},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"compressedTextureS3TC",{get:function(){this._compressedTextureS3TCInit||(this._compressedTextureS3TC=this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._compressedTextureS3TCInit=!0);return this._compressedTextureS3TC},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"disjointTimerQuery",{get:function(){this._disjointTimerQueryInit||(this._disjointTimerQuery=this._gl.getExtension("EXT_disjoint_timer_query"),
this._disjointTimerQueryInit=!0);return this._disjointTimerQuery},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"textureFloat",{get:function(){this._textureFloatInit||(this._textureFloat=this._gl.getExtension("OES_texture_float"),this._textureFloatInit=!0);return this._textureFloat},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"textureFloatLinear",{get:function(){this._textureFloatLinearInit||(this._textureFloatLinear=this._gl.getExtension("OES_texture_float_linear"),
this._textureFloatLinearInit=!0);return this._textureFloatLinear},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"colorBufferFloat",{get:function(){this._colorBufferFloatInit||(this._colorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this._colorBufferFloatInit=!0);return this._colorBufferFloat},enumerable:!0,configurable:!0});return f}()})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util"],function(B,r,f){return function(){function a(){this.shaderVariators=
{};this._nextId=0;this._programsByName={};this._namesById=[];this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}a.prototype.dispose=function(){for(var a in this._programsByName)this._programsByName[a].dispose();this._programRefCount=this._namesById=this._programsByName=null};a.prototype.add=function(a,c){f.assert(null==this._programsByName[a]);this._programsByName[a]=c;this._namesById[c.id]=
a};a.prototype.get=function(a){return this._programsByName[a]};a.prototype.addShaderVariations=function(a,c){this.shaderVariators[a]=c};a.prototype.getShaderVariations=function(a){return this.shaderVariators[a]};a.prototype.getShaderVariationsProgram=function(a,c,f,p){return(a=this.getShaderVariations(a))&&a.getProgram(c,f,p)};a.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};a.prototype.increaseRefCount=function(a){var b=a.id;this._programRefCount[b]?this._programRefCount[b]++:
(this._programRefCount[b]=1,this._findCommonUniforms(a))};a.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?this._programRefCount[b]--:(this._forgetCommonUniforms(a),this._programRefCount[b]=0)};a.prototype._getNextId=function(){return this._nextId++};a.prototype._findCommonUniforms=function(a){for(var b in this._commonUniforms)a.hasUniform(b)&&(f.assert(-1===this._commonUniforms[b].indexOf(a),"common uniforms of program have already been determined"),this._commonUniforms[b].push(a))};
a.prototype._forgetCommonUniforms=function(a){for(var b in this._commonUniforms){var f=this._commonUniforms[b],p=f.indexOf(a);-1<p&&(f[p]=f[f.length-1],f.pop())}};return a}()})},"esri/views/3d/webgl-engine/lib/Selector":function(){define("require exports dojo/has ./PerformanceTimer ./gl-matrix ./Object3D".split(" "),function(B,r,f,a,b,c){var t=b.vec3d.create(),p=b.vec3d.create();B=function(){function a(a,c,f,q,p,t,r,n){void 0===n&&(n=!1);this.dir=b.vec3d.create();this.normalDir=null;this.minResult=
new h;this.maxResult=new h;this.transform=b.mat4d.create();this._transformInverse=new l({value:this.transform},b.mat4d.inverse,b.mat4d.create);this._transformInverseTranspose=new l(this._transformInverse,b.mat4d.transpose,b.mat4d.create);this._transformTranspose=new l({value:this.transform},b.mat4d.transpose,b.mat4d.create);this._transformInverseRotation=new l({value:this.transform},b.mat4d.toInverseMat3,b.mat3d.create);this.enableTerrain=this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;
this.enableBackfacesTerrain=!0;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.viewingMode=a||"global";this.intersectObject=this.intersectObject.bind(this);this.init(c,f,q,p,t,r,n)}a.prototype.init=function(a,c,h,f,l,q,p){c&&h&&b.vec3d.subtract(h,c,this.dir);this.minResult.init(c,h);this.maxResult.init(c,h);this.numObjectsTested=0;this.point=f;this.camera=l;this.isSelection=p;this.layers=a;this.p0=c;this.p1=h;this.hudResults=[];null==q&&(q=1E-5);this.tolerance=q;if(this.layers)for(a=
0;a<this.layers.length;++a)if(c=this.layers[a],h=c.getSpatialQueryAccelerator?c.getSpatialQueryAccelerator():void 0)h.forEachAlongRay(this.p0,this.dir,this.intersectObject);else for(c=c.getObjects(),h=0;h<c.length;++h)this.intersectObject(c[h])};Object.defineProperty(a.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});a.prototype.getDirection=function(){this.normalDir||(this.normalDir=b.vec3d.create(),b.vec3d.normalize(this.dir,this.normalDir));return this.normalDir};a.prototype.intersectObject=
function(a){var c=this;this.numObjectsTested++;for(var f=a.getId(),l=a.getGeometryRecords(),q=a.objectTransformation,y,r=0;r<l.length;r++){var n=l[r],A=n.geometry,x=n.materials,I=n.instanceParameters;y=A.getId();b.mat4d.set(q,this.transform);b.mat4d.multiply(this.transform,n.getShaderTransformation());this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate();b.mat4d.multiplyVec3(this.transformInverse,
this.p0,t);b.mat4d.multiplyVec3(this.transformInverse,this.p1,p);x[0].intersect(A,I,this.transform,this,t,p,function(b,l,n,q,p,u){0<=b&&(p?(p=new h,p.set(a,f,b,l,q,u,y,n),c.hudResults.push(p)):((null==c.minResult.priority||q>=c.minResult.priority)&&(null==c.minResult.dist||b<c.minResult.dist)&&c.minResult.set(a,f,b,l,q,null,y,n),(null==c.maxResult.priority||q>=c.maxResult.priority)&&(null==c.maxResult.dist||b>c.maxResult.dist)&&c.maxResult.set(a,f,b,l,q,null,y,n)))},n.customTransformation)}};a.prototype.getMinResult=
function(){return this.minResult};a.prototype.getMaxResult=function(){return this.maxResult};a.prototype.getHudResults=function(){return this.hudResults};a.DEFAULT_TOLERANCE=1E-5;return a}();var h=function(){function a(a,c){this.normal=b.vec3d.create();this.init(a,c)}a.prototype.getIntersectionPoint=function(a){if(null==this.dist)return!1;b.vec3d.lerp(this.p0,this.p1,this.dist,a);return!0};a.prototype.set=function(a,h,f,l,q,p,t,n){this.dist=f;b.vec3d.set(l,this.normal);this.targetType=a?a instanceof
c?"StageObject":"StagePoint":"None";this.target=a;this.name=h;this.priority=q;this.center=p?b.vec3d.create(p):null;this.geometryId=t;this.triangleNr=n};a.prototype.setIntersector=function(a){this.intersector=a};a.prototype.init=function(a,b){this.dist=void 0;this.targetType="None";this.priority=this.name=this.target=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="stage";this.p0=a;this.p1=b};return a}(),l=function(){function a(a,b,c){this.original=a;this.update=b;this.dirty=
!0;this.transform=c()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1);return this.transform},enumerable:!0,configurable:!0});return a}();return B})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ./IdGen ./Util ./gl-matrix ./ComponentUtils ./HighlightUtils ./ModelContentType ./GeometryRecord".split(" "),function(B,r,f,a,b,c,t,p,h){var l=
a.assert,q=b.mat4d,y=b.vec3d;B=function(){function a(b){void 0===b&&(b={});this._bvObjectSpace=new z;this._bvWorldSpace=new z;this._bvDirty=!0;this._hasVolatileTransformation=!1;this.id=a._idGen.gen(b.idHint);this.name=b.name;this.castShadow=null!=b.castShadow?b.castShadow:!0;this.metadata=b.metadata;this.objectTransformation=q.identity();this._initializeGeometryRecords(b.geometries,b.materials,b.transformations)}a.prototype._initializeGeometryRecords=function(a,b,c){if(Array.isArray(a)){l(b.length===
a.length,"Object3D: materials don't match geometries");l(c.length===a.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(a.length);this.geometries=a.slice();for(var f=0;f<a.length;f++)l(Array.isArray(b[f]),"Object3D: materials parameter must be array of array"),this.geometryRecords[f]=new h(a[f],b[f].slice(),q.create(c[f]),{});this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=[]};a.prototype.getId=function(){return this.id};Object.defineProperty(a.prototype,
"parentLayer",{get:function(){return this._parentLayer},set:function(a){l(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});a.prototype.getParentLayer=function(){return this.parentLayer};a.prototype.addParentLayer=function(a){this.parentLayer=a};a.prototype.removeParentLayer=function(a){this.parentLayer=null};a.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};a.prototype.getFirstGeometryIndex=
function(a){a=this.geometries.indexOf(a);l(-1<a,"Object3D.getFirstGeometryIndex: geometry not found");return a};a.prototype.findGeometryRecords=function(a){for(var b=[],c=0;c<this.geometries.length;c++)this.geometries[c]===a&&b.push(this.geometryRecords[c]);return b};a.prototype.getGeometryRecord=function(a){l(0<=a&&a<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[a]};a.prototype.getGeometryRecords=function(){return this.geometryRecords};
a.prototype.addGeometry=function(a,b,c,f,n,p){l(Array.isArray(b),"Object3D.addGeometry: materials must be array");this.geometries.push(a);a=new h(a,b.slice(),q.create(c),f||{},n,p);this.geometryRecords.push(a);this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();return a};a.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};a.prototype.removeGeometry=function(a){var b=
this.geometryRecords.splice(a,1)[0];this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",b);this._invalidateBoundingVolume();return b};a.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()};a.prototype.geometryColorAttrsUpdated=function(a){this._notifyDirty("colorAttrsUpdated",this.geometryRecords[a])};
a.prototype.isAllHidden=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var h=b[a],f=h.instanceParameters.componentVisibilities,h=h.geometry.getData().componentOffsets;if(!c.isAllHidden(f,h))return!1}return!0};a.prototype.isAllVisible=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var h=b[a],f=h.instanceParameters.componentVisibilities,h=h.geometry.getData().componentOffsets;if(!c.isAllVisible(f,h))return!1}return!0};a.prototype.hasComponents=function(){for(var a=!1,b=
0;b<this.geometries.length&&!(a=this.geometries[b].getData(),a=c.hasComponents(a.componentOffsets));b++);return a};a.prototype.setComponentVisibility=function(a,b,h){var f=a.instanceParameters.componentVisibilities,l=a.geometry.getData().componentOffsets;b=c.updateVisibility(f,l,b,h);a.instanceParameters.componentVisibilities=b;this._notifyDirty("componentVisibilityChanged",a)};a.prototype.getComponentVisibility=function(a,b){return c.getVisibility(a.instanceParameters.componentVisibilities,b)};a.prototype.hideAllComponents=
function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var h=b[a],f=c.hideAllComponents(h.instanceParameters.componentVisibilities);h.instanceParameters.componentVisibilities=f}this._notifyDirty("componentVisibilityChanged")};a.prototype.unhideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var h=b[a],f=c.unhideAllComponents(h.instanceParameters.componentVisibilities);h.instanceParameters.componentVisibilities=f}this._notifyDirty("componentVisibilityChanged")};a.prototype._setComponentHighlight=
function(a,b,h,f){b=c.addHighlight(a.instanceParameters.componentHighlights,b,h,f);a.instanceParameters.componentHighlights=b};a.prototype.setComponentHighlight=function(a,b,c){var h=t.generateHighlightId();this._setComponentHighlight(a,b,c,h);this._notifyDirty("componentHighlightChanged");return h};a.prototype.highlightAllComponents=function(a){for(var b=t.generateHighlightId(),c=0,h=this.geometryRecords;c<h.length;c++)this._setComponentHighlight(h[c],null,a,b);this._notifyDirty("componentHighlightChanged");
return b};a.prototype.removeHighlights=function(a){for(var b=0,h=this.geometryRecords;b<h.length;b++){var f=h[b].instanceParameters,l=c.removeHighlight(f.componentHighlights,a);f.componentHighlights=l}this._notifyDirty("componentHighlightChanged")};a.prototype.getFaceRangeIndexFromTriangleNr=function(a){var b=this.metadata.faceRanges;if(null!=b)for(var c=0;c<b.length;c++)if(b[c][0]<=a&&b[c][1]>=a)return c};a.prototype.getFaceRangeFromTriangleNr=function(a){a=this.getFaceRangeIndexFromTriangleNr(a);
var b=this.metadata.faceRanges;return a?[b[a]]:null};a.prototype.setGeometryTransformation=function(a,b){l(0<=a&&a<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var c=this.geometryRecords[a];b=new h(c.geometry,c.materials,q.create(b),c.instanceParameters);this.geometryRecords[a]=b;this._notifyDirty("objGeometryReplaced",[c,b]);this._invalidateBoundingVolume()};a.prototype.getObjectTransformation=function(){return q.create(this.objectTransformation)};a.prototype.setObjectTransformation=
function(a){q.set(a,this.objectTransformation);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")};a.prototype.getCombinedStaticTransformation=function(a,b){b=b||q.create();q.multiply(this.objectTransformation,a.getStaticTransformation(),b);return b};a.prototype.getCombinedShaderTransformation=function(a,b){b=b||q.create();q.multiply(this.objectTransformation,a.getShaderTransformation(),b);return b};a.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};
a.prototype.getCastShadow=function(){return this.castShadow};a.prototype.setCastShadow=function(a){this.castShadow=a};a.prototype.getMetadata=function(){return this.metadata};a.prototype.getName=function(){return this.name};a.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};a.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};a.prototype.getCenter=function(a){this._validateBoundingVolume();
return a?this._bvObjectSpace.center:this._bvWorldSpace.center};a.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};a.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a)for(var b=this.geometries[a],c=this.geometryRecords[a],h=b.getNumGroups(),f=0;f<h;++f){var l=b.getBoundingInfo(f);
this._calculateTransformedBoundingVolume(l,this._bvObjectSpace,c.getShaderTransformation());this._calculateTransformedBoundingVolume(l,this._bvWorldSpace,this.getCombinedShaderTransformation(c))}y.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center);y.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);for(var c=y.create(),p=y.create(),t=this._getScaleFactor(this.objectTransformation),a=0;a<this.geometryRecords.length;++a)for(var b=
this.geometries[a],w=this.geometryRecords[a].getShaderTransformation(),r=this._getScaleFactor(w),h=b.getNumGroups(),f=0;f<h;++f){l=b.getBoundingInfo(f);q.multiplyVec3(w,l.getCenter(),c);var z=y.dist(c,this._bvObjectSpace.center),l=l.getBSRadius()*r;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,z+l);q.multiplyVec3(this.objectTransformation,c,p);z=y.dist(p,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,z+l*t)}this._bvDirty=!1}};a.prototype._calculateTransformedBoundingVolume=
function(a,b,c){var h=a.getBBMin();a=a.getBBMax();for(var f=y.create(),l=y.create(),p=-1;3>p;++p){y.set(h,f);y.set(a,l);-1<p&&(f[p]=a[p],l[p]=h[p]);q.multiplyVec3(c,f);q.multiplyVec3(c,l);for(var u=0;3>u;++u)b.bbMin[u]=Math.min(b.bbMin[u],f[u],l[u]),b.bbMax[u]=Math.max(b.bbMax[u],f[u],l[u])}};a.prototype._getScaleFactor=function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))};a.prototype._invalidateBoundingVolume=
function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace)};a.prototype._notifyDirty=function(a,b,c,h){this._parentLayer&&(c=c||p.OBJECT,this._parentLayer.notifyDirty(a,b,c,h||this))};a._idGen=new f;return a}();var z=function(){function a(){this.bbMin=y.create();this.bbMax=y.create();this.center=y.create();this.bsRadius=0}a.prototype.init=function(){y.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin);y.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,
-Number.MAX_VALUE,this.bbMax);y.set3(0,0,0,this.center);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};return a}();return B})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(B,r,f){return function(){function a(b,c,f,p,h,l){this.id=a._idGen.gen(b.getId());this.geometry=b;this.materials=c;this.transformation=f;this.instanceParameters=p;this.origin=h;this.customTransformation=
l}a.prototype.getId=function(){return this.id};a.prototype.getStaticTransformation=function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation};a._idGen=new f;return a}()})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ./Evented".split(" "),
function(B,r,f,a,b,c,t){return function(c){function h(a){var b=c.call(this)||this;b.providers={im:[],ground:[],scene:[]};b.handles=new Map;b.elevationChange=function(a){b.emit("elevation-change",a)};return b}f(h,c);h.prototype.getElevation=function(a,b){var c=-Infinity,h=!1;if("scene"===b)for(var f=0,l=this.providers.im;f<l.length;f++){var q=l[f],q=q.getElevation(a,b);null!=q&&(c=Math.max(q,c),!h&&isFinite(c)&&(h=!0))}if(!h)for(h=0,f=this.providers.ground;h<f.length;h++)q=f[h],q=q.getElevation(a,
b),null!=q&&(c=Math.max(q,c));if("scene"===b)for(h=0,f=this.providers.scene;h<f.length;h++)q=f[h],q=q.getElevation(a,b),null!=q&&(c=Math.max(q,c));return isFinite(c)?c:null};h.prototype.register=function(a,b){this.handles.set(b,b.on("elevation-change",this.elevationChange));this.providers[a].push(b)};h.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var h=c[b],f=this.providers[h].indexOf(a);
-1<f&&this.providers[h].splice(f,1)}};a([b.property({constructOnly:!0})],h.prototype,"view",void 0);a([b.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],h.prototype,"spatialReference",void 0);return h=a([b.subclass("esri.views.3d.support.CombinedElevationProvider")],h)}(b.declared(c,t.Evented))})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function f(){this._listeners={}}
f.prototype.hasEventListener=function(a){return null!=this._listeners[a]&&0<this._listeners[a].size};f.prototype.on=function(a,b){var c=this;null==this._listeners[a]&&(this._listeners[a]=new Map);var f={};this._listeners[a].set(f,b);return{remove:function(){return c._listeners[a].delete(f)}}};f.prototype.emit=function(a,b){null!=this._listeners[a]&&this._listeners[a].forEach(function(a){return a(b)})};return f}();r.Evented=B})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../Color".split(" "),
function(B,r,f,a,b,c,t){return function(c){function h(){var a=null!==c&&c.apply(this,arguments)||this;a.color=new t([0,255,255]);a.haloOpacity=1;a.fillOpacity=.25;return a}f(h,c);h.toEngineOptions=function(a){return{color:new Float32Array(t.toUnitRGBA(a.color)),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};a([b.property({type:t})],h.prototype,"color",void 0);a([b.property()],h.prototype,"haloOpacity",void 0);a([b.property()],
h.prototype,"fillOpacity",void 0);return h=a([b.subclass()],h)}(b.declared(c))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry/support/scaleUtils ../lib/glMatrix ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/BufferVectorMath ../webgl-engine/lib/Util".split(" "),function(B,r,f,a,b,c,t,p,h,l,q,y){B=function(){function c(a){this.spatialReference=
a}c.prototype.toRenderCoords=function(a,c,h){return a instanceof b?l.pointToVector(a,c,this.spatialReference):l.vectorToVector(a,c,h,this.spatialReference)};c.prototype.fromRenderCoords=function(c,h,f){return h instanceof b||h instanceof a?l.vectorToPoint(c,this.spatialReference,h,f):l.vectorToVector(c,this.spatialReference,h,f)};c.prototype.viewAngle=function(a,b){this.worldUpAtPosition(a,z);t.vec3d.subtract(b,a,u);a=t.vec3d.length(u);return 0===a?0:h.acos(t.vec3d.dot(u,z)/a)};return c}();(function(a){var b=
function(a){function b(b){b=a.call(this,b||l.SphericalRenderSpatialReference)||this;b.unitInMeters=1;return b}f(b,a);b.prototype.getAltitude=function(a,c){void 0===c&&(c=0);return b.getAltitude(a,c)};b.prototype.setAltitude=function(a,c,h){void 0===h&&(h=0);b.setAltitude(a,c,h)};b.prototype.setAltitudeOfTransformation=function(a,c){b.setAltitudeOfTransformation(a,c)};b.prototype.worldUpAtPosition=function(a,c){return b.worldUpAtPosition(a,c)};b.prototype.intersectManifold=function(a,c,h,f){return b.intersectManifold(a,
c,h,f)};b.getAltitude=function(a,b){void 0===b&&(b=0);return q.Vec3Compact.length(a,b)-p.earthRadius};b.setAltitude=function(a,b,c){void 0===c&&(c=0);c=c||0;a=(a+p.earthRadius)/q.Vec3Compact.length(b,c);q.Vec3Compact.scale(b,c,a)};b.setAltitudeOfTransformation=function(a,c){b.setAltitude(a,c,12)};b.worldUpAtPosition=function(a,b){return t.vec3d.normalize(a||[0,0,0],b||z)};b.intersectManifold=function(a,b,c,h){void 0===h&&(h=t.vec3d.create());return y.raySphere(a,b,null,p.earthRadius+c,h)};return b}(a);
a.Spherical=b;b=function(a){function b(b){var h=a.call(this,b)||this;h.unitInMeters=c.getMetersPerUnitForSR(b);return h}f(b,a);b.prototype.getAltitude=function(a,c){void 0===c&&(c=0);return b.getAltitude(a,c)};b.prototype.setAltitude=function(a,c,h){void 0===h&&(h=0);b.setAltitude(a,c,h)};b.prototype.setAltitudeOfTransformation=function(a,c){b.setAltitudeOfTransformation(a,c)};b.prototype.worldUpAtPosition=function(a,c){return b.worldUpAtPosition(a,c)};b.prototype.intersectManifold=function(a,c,h,
f){return b.intersectManifold(a,c,h,f)};b.getAltitude=function(a,b){return b?a[b+2]:a[2]};b.setAltitude=function(a,b,c){c?b[c+2]=a:b[2]=a};b.setAltitudeOfTransformation=function(a,c){b.setAltitude(a,c,12)};b.worldUpAtPosition=function(a,c){return c?t.vec3d.set(b.worldUp,c):b.worldUp};b.intersectManifold=function(a,c,h,f){void 0===f&&(f=t.vec3d.create());t.vec4d.set4(b.worldUp[0],b.worldUp[1],b.worldUp[2],-h,w);return!y.rayPlane(a,c,w,f)||0>t.vec3d.dot(t.vec3d.subtract(f,a,u),c)?!1:!0};b.worldUp=[0,
0,1];return b}(a);a.Planar=b})(B||(B={}));var z=t.vec3d.create(),w=t.vec4d.create(),u=t.vec3d.create();return B})},"esri/views/3d/support/MapCoordsHelper":function(){define("dojo/Evented dojo/Deferred ../../../core/declare ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry/support/scaleUtils".split(" "),function(B,r,f,a,b,c,t,p){return f(B,{unitInMeters:1,spatialReference:null,constructor:function(b,
c,f){this.spatialReference=c;this.unitInMeters=p.getMetersPerUnitForSR(this.spatialReference);(this.geometryService=f)||a.create(b&&b.portalItem).then(function(a){this.geometryService=a}.bind(this)).otherwise(function(){})},toGeographic:function(a){var h=new r,f=!0,p=this.spatialReference;if(!this.geometryService)return h.reject("Must specify geometryService in esri/config"),h;Array.isArray(a[0])&&"number"!==typeof a[0]||(a=[a],f=!1);a.forEach(function(b,c){b instanceof t||(a[c]=new t(b,p))});var z=
new b({geometries:a,outSR:c.WGS84});this.geometryService.project(z).then(function(a){try{a=a.map(function(a){return[a.x,a.y]}),h.resolve(f?a:a[0])}catch(u){h.reject(u)}},function(a){h.reject(a)});return h.promise},canProject:function(){return!!this.geometryService}})})},"esri/views/3d/support/ResourceController":function(){define("../../../core/declare ../../../core/Scheduler ../../../core/HandleRegistry ../../../core/watchUtils ./StreamDataSupplier ./StreamDataLoader ./PreallocArray ../webgl-engine/lib/Util".split(" "),
function(B,r,f,a,b,c,t,p){function h(a){this.budget=this.begin=0;this.performance=a;this.enabled=!0}var l=p.assert,q={TERRAIN:"terrain",SCENE:"scene",SYMBOLOGY:"symbols"},y=new t(20);h.prototype.now=function(){return this.performance.now()};h.prototype.reset=function(a){this.begin=this.now();this.budget=this.enabled?a:Number.MAX_VALUE};h.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget};h.prototype.remaining=function(){return Math.max(this.budget-this.elapsed(),0)};h.prototype.elapsed=
function(){return this.now()-this.begin};B=B(null,{constructor:function(b,l,t){t=t||p.performance;this._clients=[];this._frameWorker=null;this._budget=new h(t);this._idleFrameWorkers=[];this._idleFrameWorkerRobin=0;this._idleUpdatesStartFired=!1;this._targetReached=!0;this._lastTargetChangeTime=t.now();this.navigationTimeout=300;this.animatingFrameTimeBudget=10;this.idleFrameWorkerBudget=30;this.idleFrameTimeBudget=50;t={};for(var u in q)t[q[u]]=0;t[q.TERRAIN]=15;t[q.SCENE]=20;t[q.SYMBOLOGY]=5;this._maxGpuMemory=
500;this.streamDataLoader=new c(t);this._cameraListeners=new f;this._cameraListeners.add([a.on(b,"navigation","currentViewReachedTarget",this._currentViewReachedTargetHandler.bind(this)),a.on(b,"navigation","targetViewChanged",this._targetViewChangedHandler.bind(this))]);l||(l=r);this._frameTask=l.addFrameTask({update:this._frameUpdate.bind(this)});this._view=b;this.stats={frameUpdateTime:new z,idleUpdateTime:new z};this.frameUpdateNavigation=null},destroy:function(){this._frameTask.remove();this._frameTask=
null;this._cameraListeners.remove();this.streamDataLoader.destroy();this.streamDataLoader=null},setEnableBudget:function(a){this._budget.enabled=!!a},registerClient:function(a,c,h){this._clients.push({client:a,type:c});"function"===typeof a.setMaxGpuMemory&&a.setMaxGpuMemory(this._maxGpuMemory);return new b(c,this.streamDataLoader,h)},deregisterClient:function(a){for(var b=0;b<this._clients.length;b++)if(this._clients[b].client===a){this._clients[b]=this._clients[this._clients.length-1];this._clients.pop();
return}console.warn("deregistering an unregistered client.")},setMaxGpuMemory:function(a){this._maxGpuMemory=a;for(var b=0;b<this._clients.length;b++){var c=this._clients[b].client;"function"===typeof c.setMaxGpuMemory&&c.setMaxGpuMemory(a)}},registerIdleFrameWorker:function(a,b){var c=this._idleFrameWorkers.some(function(b){return b.client===a});l(!c,"Can only register idle frame workers once per client/layer");l(!b.idleFrame||b.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");
this._idleFrameWorkers.push({client:a,callbacks:b});this._isIdle()&&this._idleUpdatesStartFired&&b.idleBegin&&b.idleBegin.call(a)},deregisterIdleFrameWorker:function(a){for(var b=this._idleFrameWorkers,c=0;c<b.length;c++){var h=b[c];if(h.client===a){this._idleUpdatesStartFired&&h.callbacks.idleEnd&&h.callbacks.idleEnd.call(a);b[c]=b[b.length-1];b.pop();break}}},registerFrameWorker:function(a){l(!this._frameWorker,"Only one (non-idle) per-frame worker supported at the moment");this._frameWorker=a},
deregisterFrameWorker:function(){this._frameWorker=null},_targetViewChangedHandler:function(a){this._lastTargetChangeTime=this._budget.now();this._targetReached=!1;this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._callWorkersNoScheduling("idleEnd"))},_currentViewReachedTargetHandler:function(a){this._targetReached=!0},_frameUpdate:function(a){var b=this._isIdle()?this.idleFrameWorkerBudget:this.animatingFrameTimeBudget;this._budget.reset(b-a.spendInFrame);this._view.navigation&&this._view.navigation.step(a.deltaTime);
this._view.inputManager&&this._view.inputManager._pinchNavigation&&this._view.inputManager._pinchNavigation.momentum.doFrameUpdate(a.deltaTime);this._frameWorker&&(this._frameWorker(this._budget),this.stats.frameUpdateTime.addSample(this._budget.elapsed()));this._isIdle()&&(this._idleUpdatesStartFired||(this._callWorkersNoScheduling("idleBegin"),this._idleUpdatesStartFired=!0),this._budget.reset(this.idleFrameTimeBudget-this._budget.elapsed()),3<this._budget.remaining()&&(this._callWorkersStrictScheduling("idleFrame",
this._budget),this.stats.idleUpdateTime.addSample(this._budget.elapsed())))},_isIdle:function(){return this._budget.now()-this._lastTargetChangeTime>this.navigationTimeout&&this._targetReached},_callWorkersNoScheduling:function(a){for(var b=this._idleFrameWorkers,c=0;c<b.length;c++){var h=b[c];h.callbacks[a]&&h.callbacks[a].call(h.client)}},_callWorkersStrictScheduling:function(a,b){var c=this._idleFrameWorkers,h=c.length,f,l,q;y.clear();l=0;for(q=this._idleFrameWorkerRobin;l<h;l++)f=c[q++%h],f.callbacks.needsUpdate&&
f.callbacks.needsUpdate.call(f.client)&&(0===y.length&&(this._idleFrameWorkerRobin=q),y.push(f));f=b.now();for(c=f+b.remaining();0<y.length&&f<c;)b.reset((c-f)/y.length),f=y.pop(),f.callbacks[a].call(f.client,b),f=b.now()}});B.ClientType=q;var z=function(){this.addSample=function(a){this.min=Math.min(this.min,a);this.max=Math.max(this.max,a);this.total+=a;this.numSamples++};this.getAverage=function(){return this.total/this.numSamples};this.reset=function(){this.numSamples=this.total=0;this.min=Number.MAX_VALUE;
this.max=-Number.MAX_VALUE};this.reset()};return B})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(B,r){return function(){function f(a,b,c){this._clientType=a;this._loader=b;this._activeRequests=null;this._addUrlToken=c&&c.addUrlToken;c&&c.trackRequests&&(this._activeRequests=new Map)}f.prototype.request=function(a,b,c){var f=this;b=this._loader.request(a,b,this._clientType,c,this._addUrlToken);this._activeRequests&&(this._activeRequests.set(a,b),c=function(){f._activeRequests.delete(a)},
b.then(c,c));return b};f.prototype.isRequested=function(a){return this._loader.isRequested(a)};f.prototype.cancelRequest=function(a){this._loader.cancel(a)};f.prototype.cancelAll=function(){var a=this;this._activeRequests&&(this._activeRequests.forEach(function(b){a._loader.cancel(b)}),this._activeRequests.clear())};f.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()};return f}()})},"esri/views/3d/support/StreamDataLoader":function(){define("../../../core/declare ../../../request ../../../core/urlUtils ./PromiseLightweight ./AsyncQuotaRoundRobinQueue ../webgl-engine/lib/Util".split(" "),
function(B,r,f,a,b,c){var t=c.assert,p={QUEUED:1,DOWNLOADING:2,CANCELLED:4};B=B(null,{constructor:function(a){this.alreadyLoading={};this.loadQueue=new b(l,this._doneLoadingCallback,this,a);this._urlInfo={hasSameOrigin:{},canUseXhr:{}}},destroy:function(){for(var a in this.alreadyLoading){for(var b=this.alreadyLoading[a],c=0;c<b.clientPromises.length;c++){var h=b.clientPromises[c];h.isRejected()||h.reject(b.url.url,null,b.docType,b.clientMetadata[c])}this._cancelTask(b)}this.loadQueue.clear();this.alreadyLoading=
this.loadQueue=null},request:function(b,c,h,f,l){f=f||{};var q=new a.Promise(function(){this.cancel(q)}.bind(this));q.requestURL=b;var u=this.alreadyLoading[b];u?(u.clientPromises.push(q),u.clientMetadata.push(f.metadata)):(u={url:{url:null,normalized:null,normalizedWithToken:null,hasSameOrigin:!1,canUseXhr:!1},docType:c,clientType:h,status:p.QUEUED,clientMetadata:[f.metadata],clientPromises:[q],downloadObj:null,_cancelledInQueue:!1},this._prepareUrl(u,b,l),this.alreadyLoading[b]=u,this.loadQueue.push(u));
return q},isRequested:function(a){return void 0!==this.alreadyLoading[a]},cancel:function(a){var b=this.alreadyLoading[a.requestURL];b&&this._removeRequestPromiseFromTask(b,a)},hasPendingDownloads:function(){return!c.objectEmpty(this.alreadyLoading)},_prepareUrl:function(a,b,c){a.url.url=b;a.url.isData=f.isDataProtocol(b);if(a.url.isData||"image"!==a.docType)a.url.normalized=b,!a.url.isData&&c&&(a.url.normalizedWithToken=c(b));else{b=f.normalize(b);a.url.normalized=b;var h=f.getOrigin(b);c&&(a.url.normalizedWithToken=
c(b));b=this._urlInfo.hasSameOrigin[h];void 0!==b?a.url.hasSameOrigin=b:(a.url.hasSameOrigin=f.hasSameOrigin(h,window.location.href),this._urlInfo.hasSameOrigin[h]=a.url.hasSameOrigin);a.url.hasSameOrigin||(b=this._urlInfo.canUseXhr[h],void 0!==b?a.url.canUseXhr=b:(a.url.canUseXhr=f.canUseXhr(h),this._urlInfo.canUseXhr[h]=a.url.canUseXhr))}},_removeRequestPromiseFromTask:function(a,b){var c=a.clientPromises.length;1<c?(b=a.clientPromises.indexOf(b),t(-1<b,"request to be cancelled is already cancelled or invalid"),
a.clientPromises[b]=a.clientPromises[c-1],a.clientPromises.pop(),a.clientMetadata[b]=a.clientMetadata[c-1],a.clientMetadata.pop()):(t(a.clientPromises[0]===b,"request to be cancelled is already cancelled or invalid"),this._cancelTask(a))},_cancelTask:function(a){if(a.status===p.DOWNLOADING){this.loadQueue.workerCancelled(a);if("image"===a.docType&&a.url.isData){var b=a.downloadObj;b.removeAttribute("onload");b.removeAttribute("onerror");b.removeAttribute("src")}else a.status=p.CANCELLED,a.downloadObj.cancel();
a.downloadObj=null}a.status=p.CANCELLED;a.clientPromises=void 0;a.clientMetadata=void 0;delete this.alreadyLoading[a.url.url]},_doneLoadingCallback:function(a,b){var c;t(a.status===p.DOWNLOADING);delete this.alreadyLoading[a.url.url];if(b)for(c=0;c<a.clientPromises.length;c++)a.clientPromises[c].isRejected()||a.clientPromises[c].reject(a.url.url,b,a.docType,a.clientMetadata[c]);else for(c=0;c<a.clientPromises.length;c++)a.clientPromises[c].done(a.url.url,a.result,a.docType,a.clientMetadata[c])}});
var h=function(a,b,c){a.onload=function(){b.status!==p.CANCELLED&&(b.result=a,a.removeAttribute("onload"),a.removeAttribute("onerror"),c(b))};a.onerror=function(){b.status!==p.CANCELLED&&(a.removeAttribute("onload"),a.removeAttribute("onerror"),c(b,{status:404}))}},l=function(a,b){if(a.status===p.CANCELLED)return!1;a.status=p.DOWNLOADING;if("image"===a.docType&&a.url.isData){var f=new Image;h(f,a,b);f.src=a.url.normalized;a.downloadObj=f;return!0}var l;switch(a.docType){case "binary":l="array-buffer";
f=0;break;case "image":l="image";break;default:l="json"}a.downloadObj=r(a.url.normalizedWithToken||a.url.normalized,{responseType:l,timeout:f,failOk:!0,crossOrigin:!a.url.hasSameOrigin||a.url.canUseXhr,allowImageDataAccess:"image"===a.docType});a.downloadObj.then(function(h){a.duration=c.performance.now()-a.startTime;a.size=0;a.result=h.data;b(a)},function(c){a.downloadObj.isCanceled()||b(a,c)});return!0};B.TaskStatus=p;return B})},"esri/views/3d/support/PromiseLightweight":function(){(function(B){function r(a){this._callbacks=
[];this._errbacks=[];this._cancelCallback=a;this._iserr=this._isdone=this._iscancelled=!1}function f(a,c){var b=new r;0===a.length?b.done.apply(b,c):a[0].apply(null,c).then(function(){a.splice(0,1);f(a,arguments).then(function(){b.done.apply(b,arguments)})});return b}r.prototype.cancel=function(a){this._callbacks=[];this._errbacks=[];this._iscancelled=!0;this._cancelCallback&&this._cancelCallback(a)};r.prototype.then=function(a,c,f){var b;if(!this._iscancelled)return this._isdone?b=a.apply(f,this.result):
this._iserr&&c?b=c.apply(f,this.result):(this._callbacks.push(function(){return a.apply(f,arguments)}),c&&this._errbacks.push(function(){return c.apply(f,arguments)})),b};r.prototype.done=function(){this.result=arguments;this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=[]};r.prototype.resolve=r.prototype.done;r.prototype.reject=function(){if(!this._iscancelled){this.result=arguments;this._iserr=!0;for(var a=0;a<this._errbacks.length;a++)this._errbacks[a].apply(null,
arguments);this._callbacks=[];this._errbacks=[]}};r.prototype.isRejected=function(){return this._iserr};r.prototype.isFulfilled=function(){return this._isdone||this._iserr};r.prototype.isResolved=function(){return this._isdone};r.prototype.isCancelled=function(){return this._iscancelled};var a={Promise:r,join:function(a){function b(a,b){return function(){b&&(q=!0);h+=1;l[a]=Array.prototype.slice.call(arguments);h===p&&(q?f.reject():f.done(l))}}for(var f=new r,p=a.length,h=0,l=[],q=!1,y=0;y<p;y++)a[y].then(b(y,
!1),b(y,!0));0===a.length&&f.done();return f},chain:f};"function"===typeof define&&define.amd?define(function(){return a}):B.promise=a})(this)},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["../../../core/arrayUtils","../webgl-engine/lib/Util"],function(B,r){return function(f,a,b,c,t){function p(){return"workers: "+y+", queues: "+q.map(function(a){return a.length})}var h=0,l={},q=[],y=[],z=[],w=[],u=0,C=0,E;for(E in c)q[h]=[],y[h]=0,w[h]={requests:0,size:0,duration:0,speed:0},
z[h]=c[E],l[E]=h++,C+=c[E];var G=q.length,h=0;this.setWorkerQuota=function(a){r.assert(B.equals(Object.keys(this.typeWorkerAllication),Object.keys(a)));this.typeWorkerAllication=a;C=0;for(var b in a)z[l[b]]=a[b],C+=a[b]};this.setWorkerFunc=function(a){f=a};this.push=function(a){var b=l[a.clientType];u<C?(y[b]++,u++,t&&console.log("queue start type "+b+", "+p()),f(a,x)):(q[b].push(a),t&&console.log("queue push type "+b+", "+p()))};this._getStatsForType=function(a){a=l[a];return{quota:z[a],workers:y[a],
queueSize:q[a].length,requestStats:w[a]}};this.removeTasks=function(a,b){for(var c=[],h=q[l[b]],f=0;f<h.length;f++){var n=h[f];-1<a.indexOf(n)||c.push(n)}q[l[b]]=c};this.workerCancelled=function(a){n(a);a._cancelledInQueue=!0};this.clear=function(){for(var a=0;a<q.length;a++)q[a]=[]};var n=function(a){var b=l[a.clientType];y[b]--;u--;w[b].requests++;w[b].size+=a.size||0;w[b].duration+=a.duration||0;w[b].speed=0<w[b].duration?w[b].size/w[b].duration:0;r.assert(0<=y[b]);a=h;b=!1;do y[a]<z[a]&&A(a)&&
(b=!0),a=(a+1)%G;while(!b&&a!=h);if(!b){do A(a)&&(b=!0),a=(a+1)%G;while(!b&&a!=h)}!b&&t&&console.log("queue sink, "+p());h=a},A=function(a){for(;0<q[a].length;){if(f(q[a].shift(),x))return t&&console.log("queue startqueued clientType "+a+", "+p()),y[a]++,u++,!0;t&&console.log("queue task cancelled, "+p())}return!1},x=function(c){c._cancelledInQueue||(a.apply(b,arguments),n(c))}}})},"esri/views/3d/support/PreallocArray":function(){define(["../../../core/declare","./HeapSort"],function(B,r){return B([],
{constructor:function(f,a){this.data=Array(f);this.length=0;if(a){for(var b=0;b<f;b++)this.data[b]=a(b);this._allocator=a;this._hasAllocator=!0}else this._allocator=this._nullAllocator,this._hasAllocator=!1},_nullAllocator:function(){return null},grow:function(f){for(;this.data.length<f;)this.data.push(this._allocator(this.data.length))},next:function(){if(!this._hasAllocator)return null;this.data.length===this.length&&this.grow(2*this.length);return this.data[this.length++]},swap:function(f,a){var b=
this.data[f];this.data[f]=this.data[a];this.data[a]=b},push:function(f){this.data.length===this.length&&this.grow(2*this.length);this.data[this.length++]=f},pushArray:function(f){var a=this.length+f.length;a>=this.data.length&&this.grow(Math.max(2*this.length,a));for(a=0;a<f.length;a++)this.data[this.length++]=f[a]},pushEither:function(f){Array.isArray(f)?this.pushArray(f):this.push(f)},pop:function(){if(0===this.length)return null;var f=this.data[--this.length];this._hasAllocator||(this.data[this.length]=
null);return f},slice:function(f,a){void 0===a&&(a=this.length);return this.data.slice(f,a)},clear:function(){if(!this._hasAllocator)for(var f=0;f<this.length;f++)this.data[f]=null;this.length=0},peek:function(){return 0===this.length?null:this.data[this.length-1]},sort:function(f){r.sort(this.data,0,this.length,f);return this}})})},"esri/views/3d/support/HeapSort":function(){define([],function(){function B(f,a,b,c){for(var t=a,p=b>>>1,h=f[t-1];a<=p;){a=t<<1;a<b&&0>c(f[a-1],f[a])&&++a;var l=f[a-1];
if(0>=c(l,h))break;f[t-1]=l;t=a}f[t-1]=h}function r(f,a){return f<a?-1:f>a?1:0}return{sort:function(f,a,b,c){void 0===a&&(a=0);void 0===b&&(b=f.length);void 0===c&&(c=r);for(var t=b>>>1;t>a;t--)B(f,t,b,c);for(var p=a+1,t=b-1;t>a;t--)b=f[a],f[a]=f[t],f[t]=b,B(f,p,t,c);return f}}})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/sniff"],function(B,r,f){var a={low:{sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},
pointCloud:{lodFactor:.5}},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,gpuMemoryLimit:200},high:{sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1}},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:500}};return function(){function b(){}b.isValidProfile=function(b){return b in a};b.getDefaultProfile=function(){return f("trident")||f("safari")||f("esri-mobile")?"low":"high"};b.apply=
function(b,f){b=a[b];f.qualitySettings.sceneService["3dObject"].lodFactor=b.sceneService["3dObject"].lodFactor;f.qualitySettings.sceneService.point.lodFactor=b.sceneService.point.lodFactor;f.qualitySettings.sceneService.integratedMesh.lodFactor=b.sceneService.integratedMesh.lodFactor;f.qualitySettings.sceneService.pointCloud.lodFactor=b.sceneService.pointCloud.lodFactor;f.qualitySettings.tiledSurface.lodBias=b.tiledSurface.lodBias;f.qualitySettings.tiledSurface.angledSplitBias=b.tiledSurface.angledSplitBias;
f.qualitySettings.antialiasingEnabled=b.antialiasingEnabled;f.qualitySettings.gpuMemoryLimit=b.gpuMemoryLimit};return b}()})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/typescript ../../../core/Accessor".split(" "),function(B,r,f,a,b,c){var t=function(c){function h(){return null!==c&&c.apply(this,arguments)||this}f(h,c);a([b.property({value:1})],h.prototype,"lodFactor",
void 0);return h=a([b.subclass()],h)}(c),p=function(c){function h(){return null!==c&&c.apply(this,arguments)||this}f(h,c);h.prototype.getDefaults=function(){return{"3dObject":new t,point:new t,integratedMesh:new t,pointCloud:new t}};a([b.property()],h.prototype,"3dObject",void 0);a([b.property()],h.prototype,"point",void 0);a([b.property()],h.prototype,"integratedMesh",void 0);a([b.property()],h.prototype,"pointCloud",void 0);return h=a([b.subclass()],h)}(c),h=function(c){function h(){return null!==
c&&c.apply(this,arguments)||this}f(h,c);a([b.property({value:0})],h.prototype,"lodBias",void 0);a([b.property({value:1})],h.prototype,"angledSplitBias",void 0);return h=a([b.subclass()],h)}(c);return function(c){function l(){return null!==c&&c.apply(this,arguments)||this}f(l,c);l.prototype.getDefaults=function(){return{sceneService:new p,tiledSurface:new h,antialiasingEnabled:!0}};a([b.property()],l.prototype,"sceneService",void 0);a([b.property()],l.prototype,"tiledSurface",void 0);a([b.property()],
l.prototype,"antialiasingEnabled",void 0);a([b.property()],l.prototype,"gpuMemoryLimit",void 0);return l=a([b.subclass()],l)}(c)})},"esri/core/accessorSupport/typescript":function(){define(["../declare","../typescript","../JSONSupport","dojo/_base/lang"],function(B,r,f,a){function b(a,f){if(!a)return f;if(!f)return a;for(var c in f){var h=a[c],l=f[c];Array.isArray(l)&&Array.isArray(h)?a[c]=h.concat(l):a[c]="object"===typeof l&&"object"===typeof h?b(h,l):l}return a}return{subclass:function(c,t){return function(p){p=
r.declareDefinition(p,c);h&&(p.instanceMembers.properties=b(h,p.instanceMembers.properties));var h=p.instanceMembers.properties;if(h)for(var l in h){var q=h[l];q&&!q.reader&&q.type&&(q.type===Date?q.reader=function(a){return null!=a?new Date(a):null}:-1!==q.type._meta.bases.indexOf(f)&&(q.reader=function(a){return function(b){return a.fromJSON(b)}}(q.type)))}return a.mixin(B(p.bases,p.instanceMembers),p.classMembers)}},shared:r.shared,property:function(a){return function(b,c){var h=Object.getPrototypeOf(b),
h=h&&h.properties;b.properties&&b.properties!==h||(b.properties={});b.properties=b.properties||{};b.properties[c]=a||{}}}}})},"esri/core/typescript":function(){define(["./declare","dojo/_base/lang"],function(B,r){var f={declareDefinition:function(a,b){var c=[],f=Object.getPrototypeOf(a.prototype),p;if(f!==Object.prototype){var h=f.constructor;p=h.prototype;c.push(h)}b&&(c=c.concat(b));b={};for(var h=Object.getOwnPropertyNames(a.prototype),l=0;l<h.length;l++){var q=h[l];if("constructor"!==q){var y=
q;"dojoConstructor"===q&&(y="constructor");p&&a.prototype[q]===p[q]||(b[y]=a.prototype[q])}}h=Object.getOwnPropertyNames(a);f=Object.getOwnPropertyNames(f.constructor);p={};for(l=0;l<h.length;l++)q=h[l],-1===f.indexOf(q)&&(p[q]=a[q]);return{bases:c,instanceMembers:b,classMembers:p}},subclass:function(a){return function(b){b=f.declareDefinition(b,a);return r.mixin(B(b.bases,b.instanceMembers),b.classMembers)}},shared:function(a){return function(b,c){b[c]=a}}};return f})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports dojo/io-query ./TextureCollection ./ResourceController ../../../kernel ../../../core/watchUtils ../../../core/HandleRegistry ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(B,r,f,a,b,c,t,p,h){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function q(c){var f=this;this.streamDataSupplier=this.textures=null;this.tokens={};this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;var l=b.ClientType.SYMBOLOGY;this.stage=c.stage;this.pointsOfInterest=c.pointsOfInterest;this.resourceController=c.resourceController;this.streamDataSupplier=this.resourceController.registerClient(this,l,{addUrlToken:function(a){return f.addUrlToken(a)}});this.textures=
new a(this.streamDataSupplier,c.stage,{preMultiplyAlpha:!0,wrapClamp:!0});this.screenSizePerspectiveSettings=h.getSettings(c.viewingMode);this.screenSizePerspectiveSettingsLabels=h.getLabelSettings(c.viewingMode)}q.prototype.destroy=function(){this.resourceController.deregisterClient(this);this.streamDataSupplier=this.textures=null};q.prototype.addGraphicsOwner=function(a){var b=this;this.graphicsOwners.push(a);var c=null;a.layerView&&(c=t.init(a.layerView,"layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}));
return{remove:function(){c&&(c.remove(),c=null,b.updateScreenSizePerspectiveEnabled())}}};q.prototype.updateScreenSizePerspectiveEnabled=function(){var a=this,b=this.graphicsOwners.some(function(a){return a.layerView&&!0===a.layerView.get("layer.screenSizePerspectiveEnabled")});b&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new p,b=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",
b,!0),this.pointsOfInterest.events.on("camera-parameters-changed",b)]),this.updateScreenSizePerspectiveSettings()):!b&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};q.prototype.updateScreenSizePerspectiveSettings=function(){var a=this.pointsOfInterest;l.distance=a.centerOnSurfaceInfrequent.distance;l.fovY=a.camera.fovY;this.screenSizePerspectiveSettings.update(l);this.screenSizePerspectiveSettingsLabels.update(l);this.stage.setNeedsRender()};
q.prototype.addUrlToken=function(a){if(0===a.indexOf("data:"))return a;var b=a.match(/^(((?:https?:)?\/\/[^\/]+).*?)(?:\?(.*))?$/);if(!b)return a;var h=b[1],l=b[2],b=f.queryToObject(b[3]||"");"token"in b||(null==this.tokens[l]&&(a=c.id&&c.id.findCredential(a),this.tokens[l]=a&&a.token||""),this.tokens[l]&&(b.token=this.tokens[l]));return(l=f.objectToQuery(b))?h+"?"+l:h};return q}();r.SharedSymbolResources=B;var l={distance:0,fovY:0};r.default=B})},"esri/views/3d/support/TextureCollection":function(){define("../../../core/declare ../../../core/urlUtils dojo/Deferred dojo/_base/lang ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),
function(B,r,f,a,b,c,t){var p=t.assert;return B(null,{constructor:function(a,b,c){this._streamDataSupplier=a;this._stage=b;this._textureRecords={};this._loadedHandler=this._loadedHandler.bind(this);this._errorHandler=this._errorHandler.bind(this);this._textureOptions=c||{}},acquire:function(a,c,q){var h;if(h=this._textureRecords[a])return h.referenceCount++,h.texture||h.clientDfd;if(c)return q=c(a),this._stage.add(b.ModelContentType.TEXTURE,q),h={texture:q,referenceCount:1},this._textureRecords[a]=
h,q;h=new f;c=this._streamDataSupplier.request(a,"image");this._textureRecords[a]={clientDfd:h,loaderDfd:c,texture:null,size:Math.ceil(q||0),referenceCount:1};c.then(this._loadedHandler,this._errorHandler);return h.promise},release:function(a){var c=this._textureRecords[a];c?(1>c.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),c.referenceCount--,1>c.referenceCount&&(c.texture?(this._stage.remove(b.ModelContentType.TEXTURE,c.texture.getId()),c.texture=null):this._streamDataSupplier.cancelRequest(c.loaderDfd),
delete this._textureRecords[a])):console.warn("TextureCollection: texture doesn't exist: "+a)},isInUse:function(a){a=this._textureRecords[a];p(!a||0<a.referenceCount,"texture record with zero reference count");return!!a},_loadedHandler:function(h,f,q){q=this._textureRecords[h];p(q&&!q.texture);if(r.isSVG(h)&&(q.size||0===f.width&&0===f.height)){h=f.width?f.height/f.width:1;var l=q.size||64;1<h?(f.width=Math.round(l/h),f.height=l):(f.width=l,f.height=Math.round(l*h))}h=a.mixin({width:f.width,height:f.height},
this._textureOptions);f=new c(f,"symbol",h);this._stage.add(b.ModelContentType.TEXTURE,f);q.texture=f;q.clientDfd.resolve(f)},_errorHandler:function(a){a=this._textureRecords[a];p(a&&!a.texture);a.clientDfd.reject()}})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/HandleRegistry ../../../../core/Accessor ../../../../geometry/Point ../../lib/glMatrix ../Evented ./CenterOnSurface ./ViewState ./PropertiesPool ./disposeMembers ./SurfaceGeometryUpdates ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Selector".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E){Object.defineProperty(r,"__esModule",{value:!0});B=function(t){function r(a){a=t.call(this,a)||this;a.handles=new c;a.lastSeenCameraParameters=new C;a.surfaceAltitudeAtCenter=0;a.surfaceAltitudeAtCenterDirty=!0;a.surfaceAltitudeAtCenterWithContent=0;a.surfaceAltitudeAtCenterWithContentDirty=!0;a.propertiesPool=new z.default({pointOfView:p,renderPointOfView:Array},a);a.updateSurfaceAltitudeFrequentInterval=A;a.updateSurfaceAltitudeInfrequentInterval=x;a.events=
new l.Evented;a.renderPointOfView=[0,0,0];return a}f(r,t);r.prototype.normalizeCtorArgs=function(a){var b={viewState:new y.default({view:a.view}),surface:a.view.basemapTerrain,renderCoordsHelper:a.view.renderCoordsHelper,pickRay:a.view._stage.pickRay.bind(a.view._stage)};null!=a.updateSurfaceAltitudeFrequentInterval&&(b.updateSurfaceAltitudeFrequentInterval=a.updateSurfaceAltitudeFrequentInterval);null!=a.updateSurfaceAltitudeInfrequentInterval&&(b.updateSurfaceAltitudeInfrequentInterval=a.updateSurfaceAltitudeInfrequentInterval);
return b};r.prototype.initialize=function(){var a=this;this.surfaceSelector=new E(this.viewState.mode);this.surfaceSelector.enableBackfacesTerrain="global"===this.viewState.mode?!1:!0;this.surfaceSelector.enableInvisibleTerrain=!1;this.contentSelector=new E(this.viewState.mode);this.contentSelector.enableTerrain=!1;var b=this.viewState,c=this.surface,h=this.renderCoordsHelper,f=this.estimateSurfaceAltitudeAtCenter.bind(this);this._set("centerOnSurfaceInfrequent",new q.default({viewState:b,surface:c,
renderCoordsHelper:h,estimateSurfaceAltitudeAtCenter:f,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new q.default({viewState:b,surface:c,renderCoordsHelper:h,estimateSurfaceAltitudeAtCenter:f,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new q.default({viewState:b,surface:c,renderCoordsHelper:h,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),
altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("surfaceGeometryUpdates",new u.default({viewState:b,surface:c,renderCoordsHelper:h,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this.handles.add(this.viewState.watch("camera",function(b){return a.cameraChanged(b)},!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.surface.watch("extent",
function(){return a.updateCenterPointsOfInterest()}));this.cameraChanged(this.viewState.camera);this.forceUpdate()};r.prototype.destroy=function(){w.default(this,"handles","viewState","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","centerOnContent","propertiesPool")};Object.defineProperty(r.prototype,"pointOfView",{get:function(){var a=this.propertiesPool.get("pointOfView");this.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.viewState.spatialReference);return a},enumerable:!0,
configurable:!0});r.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.centerOnContent.forceUpdate()};r.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.centerOnSurfaceFrequent.hasPendingUpdates()};r.prototype.estimateSurfaceAltitudeAtCenterWithContent=
function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.viewState.camera;this.pickRay(a.eye,a.center,null,null,null,!1,this.contentSelector);this.contentSelector.minResult.getIntersectionPoint(n)?this.surfaceAltitudeAtCenterWithContent=this.renderCoordsHelper.getAltitude(n):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};
r.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.surface)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.viewState.camera;this.surfaceSelector.init(null,a.eye,a.center,null,a,null,!1);this.surface.intersect(this.surfaceSelector,a.eye,a.center);this.surfaceSelector.minResult.getIntersectionPoint(n)&&(this.surfaceAltitudeAtCenter=this.renderCoordsHelper.getAltitude(n));return this.surfaceAltitudeAtCenter};
r.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);this.cameraParametersChanged(this.lastSeenCameraParameters,a)&&(this.lastSeenCameraParameters.copyFrom(a),G.camera=a,this.events.emit("camera-parameters-changed",G));a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===a[2]||this._set("renderPointOfView",h.vec3d.set(a,this.propertiesPool.get("renderPointOfView")))};r.prototype.updateCenterPointsOfInterest=function(a){void 0===
a&&(a=this.viewState.camera);this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);this.centerOnContent.update(a)};r.prototype.cameraParametersChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||
a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};a([b.property({constructOnly:!0})],r.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);a([b.property({constructOnly:!0})],r.prototype,"updateSurfaceAltitudeInfrequentInterval",void 0);a([b.property({readOnly:!0,aliasOf:"viewState.camera"})],r.prototype,"camera",void 0);a([b.property({readOnly:!0})],r.prototype,"centerOnContent",void 0);a([b.property({readOnly:!0})],r.prototype,"centerOnSurfaceFrequent",void 0);a([b.property({readOnly:!0})],
r.prototype,"centerOnSurfaceInfrequent",void 0);a([b.property({readOnly:!0})],r.prototype,"events",void 0);a([b.property({readOnly:!0,dependsOn:["renderPointOfView"]})],r.prototype,"pointOfView",null);a([b.property({constructOnly:!0})],r.prototype,"renderCoordsHelper",void 0);a([b.property({readOnly:!0})],r.prototype,"renderPointOfView",void 0);a([b.property({constructOnly:!0})],r.prototype,"surface",void 0);a([b.property({readOnly:!0})],r.prototype,"surfaceGeometryUpdates",void 0);a([b.property({constructOnly:!0})],
r.prototype,"viewState",void 0);a([b.property({constructOnly:!0})],r.prototype,"pickRay",void 0);return r=a([b.subclass("esri.views.3d.support.PointsOfInterest")],r)}(b.declared(t));r.PointsOfInterest=B;var G={camera:null},n=h.vec3d.create(),A=200,x=3E3;r.default=B})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/throttle ../../../../geometry/Point ../../lib/glMatrix ../earthUtils ../mathUtils ./PointOfInterest ./PropertiesPool".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y){Object.defineProperty(r,"__esModule",{value:!0});B=function(q){function u(a){a=q.call(this,a)||this;a.propertiesPool=new y.default({location:t,renderLocation:Array},a);a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=[0,0,0];return a}f(u,q);r=u;u.prototype.initialize=function(){this.measureSurfaceAltitudeThrottle=c.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude()};Object.defineProperty(u.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.viewState.spatialReference);return a},enumerable:!0,configurable:!0});u.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();this.updateCenterOnSurface()};u.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCenterOnSurface()};u.prototype.hasPendingUpdates=
function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()};Object.defineProperty(u.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});u.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface()};u.prototype.updateCenterOnSurface=function(){var a=z,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),c=this.currentSurfaceAltitude!==
this.latestSurfaceAltitude;!b&&c&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);c=w;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,c)&&(p.vec3d.set(c,a),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=p.vec3d.dist(this.viewState.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.viewState.camera,p.vec3d.add(p.vec3d.scale(b.viewForward,this._get("distance"),a),b.eye));b=
this._get("renderLocation");b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]||this._set("renderLocation",p.vec3d.set(a,this.propertiesPool.get("renderLocation")))};u.prototype.calculateSurfaceIntersection=function(a,b){var c=this.viewState.camera;if(!this.renderCoordsHelper.intersectManifold(c.eye,c.viewForward,a,b))return!1;if(this.viewState.isGlobal){a=h.earthRadius+a;var f=p.vec3d.length2(c.eye),n=f<a*a,q=p.vec3d.dist(c.eye,b);n&&q>h.earthRadius/4&&p.vec3d.add(p.vec3d.scale(c.viewForward,a-Math.sqrt(f),b),
c.eye)}else if(c=this.surface.ready&&this.surface.extent)b[0]=l.clamp(b[0],c[0],c[2]),b[1]=l.clamp(b[1],c[1],c[3]);return!0};u.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var c=this.viewState.camera.eye;a=p.vec3d.dist(c,a);b=p.vec3d.dist(c,b);if(Math.abs(b-a)/a>r.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};u.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=
.05;a([b.property({constructOnly:!0})],u.prototype,"altitudeEstimationInterval",void 0);a([b.property({readOnly:!0})],u.prototype,"distance",void 0);a([b.property({constructOnly:!0})],u.prototype,"estimateSurfaceAltitudeAtCenter",void 0);a([b.property({readOnly:!0,dependsOn:["renderLocation"]})],u.prototype,"location",null);a([b.property({readOnly:!0})],u.prototype,"renderLocation",void 0);return u=r=a([b.subclass("esri.views.3d.support.CenterOnSurface")],u);var r}(b.declared(q.PointOfInterest));
r.CenterOnSurface=B;var z=p.vec3d.create(),w=p.vec3d.create();r.default=B})},"esri/core/throttle":function(){define(["require","exports"],function(B,r){function f(a,b,c,f){var p=null,h=1E3;"number"===typeof b?(h=b,f=c):(p=b,h=c);var l=0,q,t=function(){l=0;a.apply(f,q)};b=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];p&&p.apply(f,a);q=a;h?l||(l=setTimeout(t,h)):t()};b.remove=function(){l&&(clearTimeout(l),l=0)};b.forceUpdate=function(){l&&(clearTimeout(l),t())};b.hasPendingUpdates=
function(){return!!l};return b}Object.defineProperty(r,"__esModule",{value:!0});r.throttle=f;r.default=f})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/HandleRegistry ../../../../core/Accessor ./disposeMembers".split(" "),function(B,r,f,a,b,c,t,p){Object.defineProperty(r,"__esModule",{value:!0});B=function(h){function l(a){a=
h.call(this)||this;a.handles=new c;return a}f(l,h);l.prototype.destroy=function(){p.default(this,"handles")};a([b.property({constructOnly:!0})],l.prototype,"renderCoordsHelper",void 0);a([b.property({constructOnly:!0})],l.prototype,"surface",void 0);a([b.property({constructOnly:!0})],l.prototype,"viewState",void 0);return l=a([b.subclass("esri.views.3d.support.PointOfInterest")],l)}(b.declared(t));r.PointOfInterest=B;r.default=B})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require",
"exports","../../../../core/Accessor"],function(B,r,f){function a(a){for(var b=[],t=1;t<arguments.length;t++)b[t-1]=arguments[t];if(a instanceof f&&a.destroyed)try{throw Error("instance is already destroyed");}catch(l){console.warn(l.stack)}else for(t=0;t<b.length;t++){var p=b[t];if(!(p in a))throw Error("Property '"+p+"' does not exist and cannot be disposed");var h=a[p];h&&("function"===typeof h.destroy?h.destroy():"function"===typeof h.dispose?h.dispose():"function"===typeof h.remove&&h.remove());
a instanceof f&&p in a.__accessor__.metadatas?a._set(p,null):a[p]=null}}Object.defineProperty(r,"__esModule",{value:!0});r.disposeMembers=a;r.default=a})},"esri/views/3d/support/pointsOfInterest/PropertiesPool":function(){define(["require","exports","../../../../core/ObjectPool","../../../../core/Scheduler","./disposeMembers"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function c(a,b){this.owner=b;this.properties={};this.scheduleHandle=null;for(var c in a)b=
new f(a[c],null,null,2,2),this.properties[c]={pool:b,acquired:[]}}c.prototype.destroy=function(){b.default(this,"scheduleHandle");this.owner=null};c.prototype.get=function(b){var c=this,h=this.owner._get(b);b=this.properties[b];var f=b.pool.acquire();for(b.acquired.push(f);f===h;)b.acquired.push(f),f=b.pool.acquire();this.scheduleHandle||(this.scheduleHandle=a.schedule(function(){return c.release()}));return f};c.prototype.release=function(){this.scheduleHandle=null;for(var a in this.properties){for(var b=
this.properties[a],c=0,f=b.acquired;c<f.length;c++)b.pool.release(f[c]);b.acquired.length=0}};return c}();r.PropertiesPool=B;r.default=B})},"esri/views/3d/support/pointsOfInterest/ViewState":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/Accessor ./PropertiesPool ./disposeMembers ../../webgl-engine/lib/Camera".split(" "),function(B,r,f,a,b,c,t,p,h){Object.defineProperty(r,
"__esModule",{value:!0});B=function(c){function l(a){a=c.call(this,a)||this;a.propertiesPool=new t.default({camera:h},a);return a}f(l,c);l.prototype.normalizeCtorArgs=function(a){var b=this;this.cameraChangeHandle=a.view.navigation.on("currentViewChanged",function(a){return b.currentViewChangedHandler(a.camera)});this.camera=a.view.navigation.currentCamera.copy();return{mode:a.view.viewingMode,spatialReference:a.view.spatialReference}};l.prototype.initialize=function(){};l.prototype.destroy=function(){p.default(this,
"cameraChangeHandle","propertiesPool")};Object.defineProperty(l.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});l.prototype.currentViewChangedHandler=function(a){this.camera.equals(a)||(this.camera=this.propertiesPool.get("camera").copyFrom(a))};a([b.property()],l.prototype,"camera",void 0);a([b.property({dependsOn:["isLocal"]})],l.prototype,
"isGlobal",null);a([b.property({dependsOn:["mode"]})],l.prototype,"isLocal",null);a([b.property({constructOnly:!0})],l.prototype,"mode",void 0);a([b.property({constructOnly:!0})],l.prototype,"spatialReference",void 0);return l=a([b.subclass()],l)}(b.declared(c));r.ViewState=B;r.default=B})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/HandleRegistry ../../../../core/Scheduler ../../lib/glMatrix ../Evented ../aaBoundingRect".split(" "),
function(B,r,f,a,b,c,t){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function b(a){var b=this;this.handles=new f;this.tileGeometryUpdateExtent=t.create(t.NEGATIVE_INFINITY);this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new c.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.viewState=a.viewState;this.handles.add(a.surface.on("tile-geometry-change",function(a){return b.tileGeometryChangeHandler(a)}))}
b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",p),this.hasPendingTileGeometryChanges=!1)};b.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};b.prototype.tileGeometryChangeHandler=function(b){var c=this;this.tileGeometryUpdateSpatialReference=
b.spatialReference;t.expand(this.tileGeometryUpdateExtent,b.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(a.schedule(function(){return c.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};b.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(b.UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.events.emit("request-update",p):this.hasPendingTileGeometryChanges=
!0);t.set(this.tileGeometryUpdateExtent,t.NEGATIVE_INFINITY)};b.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],b=1;b<this.centerOnSurfaceInstances.length;b++){var c=this.centerOnSurfaceInstances[b];c.distance>a.distance&&(a=c)}return a};b.prototype.centerIntersectsExtent=function(a,b){var c=this.viewState.camera.eye,f=q,p=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(c,h,b);this.renderCoordsHelper.fromRenderCoords(p.renderLocation,
l,b);h[0]<l[0]?(f[0]=h[0],f[2]=l[0]):(f[0]=l[0],f[2]=h[0]);h[1]<l[1]?(f[1]=h[1],f[3]=l[1]):(f[1]=l[1],f[3]=h[1]);return t.intersects(f,a)};b.UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!0;return b}();r.SurfaceGeometryUpdates=B;var p={},h=b.vec3d.create(),l=b.vec3d.create(),q=t.create(t.NEGATIVE_INFINITY);r.default=B})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/ObjectPool ../../../core/Logger ../../../core/watchUtils ../../../geometry/Point ../lib/glMatrix ../support/aaBoundingRect ../support/Evented ../support/mathUtils ../support/PreallocArray ../support/projectionUtils ../support/PromiseLightweight ../support/ResourceController ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q,S,P,O,T,U){function W(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function k(a){return a&&("cancel"===a||"cancel"===a.dojoType)}function ca(a){a.remove()}var V=z.vec3d,e=z.vec4d,d=z.mat4d,g=S.weakAssert,m=l.getLogger("esri.views.3d.terrain.TerrainSurface");B=function(c){function l(){var a=c.call(this)||this;a.defaultTileBackground=M.DEFAULT_TILE_BACKGROUND;a.hideSkirtsDistanceFromExtentMargin=v;a.hideSkirtsMinimumCameraTilt=D;a._clippingExtent=
null;a._dataExtent=null;a._elevationBounds=[0,0];a._rootExtent=[0,0,0,0];a._iteratorPool=new h(U.IteratorPreorder);a._postorderIterator=new U.IteratorPostorder;a.visible=!1;a.suspended=!1;a._pendingUpdates=!1;a._lvPendingUpdates=!1;a._updateNextFrame=0;a._vectorTileLayerRequests=0;a._curOverlayOpacity=1;a._curEyePos=V.create();a._curSplitLimits=[0,0,0,0,0,0];a._curFrustumPlanes=Array(6);a._viewProjectionMatrix=d.identity();a.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,
fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};a._layerViews=[[],[]];a._layerIndexByLayerViewId=[{},{}];a._basemapLayerViewHandles={};a._layerViewChangesHandle=null;a._viewChangeListenerHandles=[];a._frameUpdateLowerPrio=new E(500);a._topLevelTilemapOnlyTiles=Array(M.TILEMAP_SIZE_EXP+1);a.loaded=!1;a.maxTextureScale=1.2;a.rootTiles=null;for(var b=0;b<a._topLevelTilemapOnlyTiles.length;b++)a._topLevelTilemapOnlyTiles[b]=new O([b-M.TILEMAP_SIZE_EXP,
0,0]);for(b=0;6>b;b++)a._curFrustumPlanes[b]=e.create();return a}f(l,c);l.prototype.normalizeCtorArgs=function(a,b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};l.prototype.initialize=function(){var a=this;this.tilePool="planar"===this.manifold?I.Pool:K.Pool;this._renderer=new Q(this.manifold,null,this._view.pointsOfInterest);this._renderer.loaded=this._setLoaded.bind(this);this._renderer.updateTileBackground(this.tileBackground);this._renderer.install(this._view._stage);this._set("overlayManager",
new x({terrainSurface:this,view:this._view}));this.watch("overlayManager.hasHighlights",this._handleHasHighlights.bind(this));var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?new J.SurfaceExtentHelperGlobal(b):new J.SurfaceExtentHelperLocal(b);q.init(this.extentHelper,"stencilEnabledExtents",function(b){a._renderer.setStencilEnabledLayerExtents(b)});b=this._view.defaultsFromMap?new p({root:this._view.map,
rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new N({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0);this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0);this._updateTilingSchemeAndExtent();
this._streamDataSupplier=this._view.resourceController.registerClient(this,A.ClientType.TERRAIN);b={needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate};this._view.resourceController.registerFrameWorker(this._frameUpdate.bind(this));this._view.resourceController.registerIdleFrameWorker(this,b);this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._viewChangeListenerHandles.push(this._view.on("resize",this._viewChangeUpdate));this._viewChangeListenerHandles.push(q.on(this._view,"navigation",
"currentViewChanged",this._viewChangeUpdate));this._viewChangeListenerHandles.push(this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate));this._layerViewChangesHandle=this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this));this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[]});this._clippingChangedHandle=this._view.watch("clippingArea",this._clippingChanged.bind(this));this._updateClippingExtent();this.notifyChange("extent")};
l.prototype.destroy=function(){this._removeAllTiles();this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._view.resourceController.deregisterFrameWorker();this._view.resourceController.deregisterIdleFrameWorker(this);this._view.resourceController.deregisterClient(this);this._viewChangeListenerHandles.forEach(ca);this._layerViewChangesHandle.remove();
this._clippingChangedHandle.remove();this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._renderer.uninstall(this._stage);this._streamDataSupplier=this._stage=this._view=this._renderer=null};Object.defineProperty(l.prototype,"cullBackFaces",{set:function(a){this._renderer.setCullBackFaces(a);this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,
configurable:!0});Object.defineProperty(l.prototype,"frontMostTransparent",{set:function(a){this._renderer.setFrontMostTransparent(a);this._set("frontMostTransparent",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"opacity",{set:function(a){this._renderer.setOpacity(a);this._set("opacity",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"renderOrder",
{set:function(a){this._renderer.setRenderOrder(a);this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"skirts",{set:function(a){this._renderer.setDrawSkirts(a);this._set("skirts",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"tileBackground",{set:function(a){a!==this.tileBackground&&this._renderer.updateTileBackground(a);this._set("tileBackground",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"velvetOverground",
{set:function(a){a!==this.velvetOverground&&this._renderer.setVelvetOverground(a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);this._set("wireframe",a);this._view._stage.setRenderParams({earlyOcclusionPixelDraw:a})},enumerable:!0,configurable:!0});l.prototype.setVisibility=function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())};
l.prototype.isVisible=function(){return this.visible&&this.ready};l.prototype.isSeeThrough=function(){return this._renderer.isTransparent()};l.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};l.prototype.intersect=function(a,b,d){this._renderer.intersect(a,b,d)};l.prototype.getElevation=function(a){if(!this.ready)return null;var b=M.LayerClass.ELEVATION,d=this.rootTiles,e=d[0].layerInfo[b].length;if(0===e)return null;ha.length<e&&(ha.length=e);if(a instanceof
y){if(!G.pointToVector(a,ja,this.tilingScheme.spatialReference))return m.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;a=ja}for(var c=0;c<d.length;c++){var g=d[c];if(T.isPosWithinTile(g,a)){do{c=g.layerInfo[b];for(d=0;d<e;d++)null!=c[d].data&&(ea[d]=c[d].data);d=0;a[0]>.5*(g.extent[0]+g.extent[2])&&(d+=1);a[1]<.5*(g.extent[1]+g.extent[3])&&(d+=2);g=g.children[d]}while(null!=g);break}}for(d=0;d<e;d++)ha[d]=ea[d]?ea[d].samplerData:null;
b=P.elevationSampler(a[0],a[1],ha);for(d=0;d<e;d++)ha[d]=void 0;return b};l.prototype.getElevationBounds=function(){return this._elevationBounds};l.prototype.getScale=function(a){if(this.tilingScheme){if(!G.pointToVector(a,ja,this.spatialReference))return m.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(this.rootTiles)for(var b=0;b<this.rootTiles.length;b++)if(a=this.rootTiles[b],T.isPosWithinTile(a,ja)){for(;a.children[0];)b=0,ja[0]>
a.children[0].extent[2]&&(b+=1),ja[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};l.prototype.queryVisibleScaleRange=function(a,b,d,e){b=b?this.tilingScheme.levelAtScale(b):0;d=d?this.tilingScheme.levelAtScale(d):Infinity;var c=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+c,d+c,e)};l.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};l.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,
b=this.tilingSchemeLogic.tilingScheme,d=!1;a&&!w.equals(a,this._dataExtent)&&(d=!0,this._dataExtent?w.set(this._dataExtent,a):this._dataExtent=w.create(a));b!==this.tilingScheme&&(g(!!b,"tiling scheme cannot be reset to undefined"),d=!0,this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",b),this._updateClippingExtent(),b&&(this._updateTiledLayers(),this._renderer.setTileSize(b.pixelSize[0]),this.overlayManager.setSpatialReference(b.spatialReference,"spherical"===this.manifold)));d&&
this._updateRootTiles()};l.prototype._acquireTile=function(a,b,d,e){var c=this.tilePool.acquire();aa[0]=a;aa[1]=b;aa[2]=d;c.init(aa,e,this,this.tilingScheme);return c};l.prototype._releaseTile=function(a){a.dispose();a.parent=null;a.parentSurface=null;this.tilePool.release(a)};l.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,d=this.tilingScheme;if(b&&d){var c=ja,g=d.rootTilesInExtent(b,c,Infinity);if(this.rootTiles){if(g.length>R){m.warn(M.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);
return}var b=this.rootTiles.map(function(a){return a.lij}),k=t.difference(b,g,W);if(0<k.removed.length||0<k.added.length){var h=this.rootTiles.filter(function(b){return-1<t.findIndex(k.removed,W.bind(null,b.lij))?(a._purgeChildTiles(b),a._purgeTile(b),!1):!0});k.added.forEach(function(b){b=a._acquireTile(0,b[1],b[2],null);h.push(b);a._loadTile(b)});this._set("rootTiles",h);this._renderer.setRootTiles(this.rootTiles)}}else g.length>R&&(m.warn(M.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),g=d.rootTilesInExtent(b,
c,R)),this._set("rootTiles",g.map(function(b){b=a._acquireTile(0,b[1],b[2],null);a._loadTile(b);return b})),this._renderer.setRootTiles(this.rootTiles);t.equals(c,this._rootExtent)||(this._rootExtent=e.create(c),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();this.notifyChange("ready")}};l.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateOverlayOpacity(this._curEyePos),
this._updateTiles(this.rootTiles))};l.prototype._updateTiles=function(a){var b=this._iteratorPool.acquire();b.reset(a);var d=this._curSplitLimits,e=this._curFrustumPlanes,c=this._curEyePos,g;T.hasVisibleSiblings(a)?(a=this._elevationBounds[0],g=this._elevationBounds[1]):(a=Infinity,g=-Infinity);for(;!b.done;){var k=b.next();k.updateClippingStatus(this._clippingExtent);var h=!0;if(k.updateVisibility(e,c)){k.updateScreenDepth(this._viewProjectionMatrix);k.renderData&&(a=Math.min(k.elevationBounds[0],
a),g=Math.max(k.elevationBounds[1],g));var f=k.shouldSplit(d,c);f===ba.SPLIT?(k.pendingUpdates&=~ba.MERGE,k.renderData?(h=!1,k.pendingUpdates|=ba.SPLIT,b.skip()):h=!1):(k.pendingUpdates&=~ba.SPLIT,f===ba.VSPLITMERGE&&k.updateAgents(M.LayerClass.ELEVATION),b.skip())}else b.skip();if(h&&!k.renderData){k.pendingUpdates|=ba.MERGE;k.pendingUpdates&=~ba.SPLIT;h=this._iteratorPool.acquire();for(h.reset(k);!h.done;)f=h.next(),f.updateVisibility(e,c),f.visible&&f.updateScreenDepth(this._viewProjectionMatrix);
this._iteratorPool.release(h)}0!==k.pendingUpdates&&(this._pendingUpdates=!0)}this._iteratorPool.release(b);isFinite(a)&&isFinite(g)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==g)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=g,this.emit("elevation-bounds-change",null))};l.prototype._updateViewDependentParameters=function(){var a=this._view.navigation.currentCamera,b=Math.tan(.5*a.fovX),e=Math.tan(.5*a.fovY),c=this.tilingScheme.pixelSize,g=Math.pow(2,-this._getLodBias());this._curSplitLimits[0]=
b;this._curSplitLimits[1]=c[0]/a.width*this.maxTextureScale*g;this._curSplitLimits[2]=e;this._curSplitLimits[3]=c[1]/a.height*this.maxTextureScale*g;this._curSplitLimits[4]=this.tilingScheme.getMaxLod();this._curSplitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;a.copyFrustumPlanes(this._curFrustumPlanes);d.multiply(a.projectionMatrix,a.viewMatrix,this._viewProjectionMatrix);V.set(a.eye,this._curEyePos);S.autoUpdateSkirtsVisibility(this,this._curEyePos)};l.prototype._setLayerViewsUpdating=
function(){for(var a=0;a<M.LayerClass.LAYER_CLASS_COUNT;a++)for(var b=this._layerViews[a],d=0;d<b.length;d++)b[d]._evaluateUpdatingState(this._pendingUpdates)};l.prototype._frameUpdateTraversal=function(a){if(!this.suspended){this._frameUpdateLowerPrio.clear();var b=this._renderer.resourceCounter.numTileTexturesComposited,d=this._iteratorPool.acquire();d.reset(this.rootTiles);for(var e=!1,c=!1;!d.done&&(1<a.remaining()||!e)&&this._renderer.resourceCounter.numTileTexturesComposited-b<Z;){var g=d.next();
g.pendingUpdates&ba.MERGE?(this._mergeTile(g),g.pendingUpdates&=~ba.MERGE,e=!0,d.skip()):g.pendingUpdates&ba.SPLIT?(this._splitTile(g),g.pendingUpdates&=~ba.SPLIT,e=!0,d.skip()):0<g.pendingUpdates&&this._frameUpdateLowerPrio.push(g);0!==g.pendingUpdates&&(c=!0)}this._pendingUpdates=c||!d.done;this._iteratorPool.release(d);return e}};l.prototype._updateTileGeometry=function(a){this._renderer._updateTileGeometry(a);ga.spatialReference=this.spatialReference;ga.tile=a;this.emit("tile-geometry-change",
ga)};l.prototype._updateTileTexture=function(a){this._renderer.updateTileTexture(a)};l.prototype._frameUpdate=function(a){if(this.rootTiles){for(var b=this._frameUpdateTraversal(a);(1<a.remaining()||!b)&&0<this._frameUpdateLowerPrio.length;){var d=this._frameUpdateLowerPrio.pop();d.pendingUpdates&ba.DECODE_ELEVATION?(this._decodeElevation(d),d.pendingUpdates&=~ba.DECODE_ELEVATION,b=!0):d.pendingUpdates&ba.UPDATE_GEOMETRY?(this._renderer.updateTileGeometryNeedsUpdate(d),this._updateTileGeometry(d),
b=!0,d.pendingUpdates&=~ba.UPDATE_GEOMETRY):d.pendingUpdates&ba.UPDATE_TEXTURE&&(this._updateTileTexture(d),d.pendingUpdates&=~ba.UPDATE_TEXTURE,b=!0);0!==d.pendingUpdates&&(this._pendingUpdates=!0)}0<this._frameUpdateLowerPrio.length&&(this._pendingUpdates=!0);if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)this._pendingUpdates=!0;this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),
this._lvPendingUpdates=this._pendingUpdates,this._updateNextFrame=0)}};l.prototype._needsIdleUpdate=function(){return this.isVisible()&&this.overlayManager&&this.overlayManager.overlaysNeedUpdate()};l.prototype._idleUpdate=function(){this.overlayManager.updateOverlay();this._updateOverlayOpacity(this._curEyePos)};l.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=[0,0,0,0],b=null;G.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&(b=a);if(t.equals(b,
this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");return!0};l.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};l.prototype._getLodBias=function(){return Math.round(this._view.qualitySettings.tiledSurface.lodBias)};l.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=C.clamp(a-this._getLodBias(),0,b.length-1);return b[a].scale};l.prototype._cancelTilemapRequests=
function(a){for(var b=0;b<M.LayerClass.LAYER_CLASS_COUNT;b++){var d=a.layerInfo[b];if(d)for(var e=0;e<d.length;e++){var c=d[e];c.tilemapRequest&&(c.tilemapRequest.cancel(),c.tilemapRequest=null)}}};l.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){a._purgeChildTiles(b);a._purgeTile(b)}),this._set("rootTiles",null),this.notifyChange("ready"));for(var b=0;b<this._topLevelTilemapOnlyTiles.length;b++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[b]);
this.setVisibility(!1)};l.prototype._purgeChildTiles=function(a){var b=this._postorderIterator;for(b.reset(a);!b.done;){for(var d=b.next(),e=0;4>e;e++)d.children[e]=null;d!==a&&this._purgeTile(d)}};l.prototype._purgeTile=function(a){a.unload(this._renderer);this._cancelTilemapRequests(a);a.parent=null;this._releaseTile(a)};l.prototype._splitTile=function(a){var b=a.lij[0]+1,d=2*a.lij[1],e=2*a.lij[2];a.children[0]=this._createTile(b,d,e,a);a.children[1]=this._createTile(b,d,e+1,a);a.children[2]=this._createTile(b,
d+1,e,a);a.children[3]=this._createTile(b,d+1,e+1,a);a.unload(this._renderer);fa.spatialReference=this.spatialReference;fa.extent=a.extent;fa.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",fa)};l.prototype._createTile=function(a,b,d,e){g(!!e,"_createTile sanity check");a=this._acquireTile(a,b,d,e);a.updateClippingStatus(this._clippingExtent);a.updateVisibility(this._curFrustumPlanes,this._curEyePos);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._curSplitLimits,
this._curEyePos)===ba.SPLIT&&(a.pendingUpdates|=ba.SPLIT,this._pendingUpdates=!0));this._loadTile(a);return a};l.prototype._mergeTile=function(a){g(!a.renderData,"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);fa.spatialReference=this.spatialReference;fa.extent=a.extent;fa.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",fa)};l.prototype._loadTile=function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,
a.renderData,this._curOverlayOpacity);ga.tile=a;ga.spatialReference=this.tilingScheme.spatialReference;this.emit("tile-geometry-change",ga)};l.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};l.prototype._decodeElevation=function(a){var b=M.LayerClass.ELEVATION,d=a.layerInfo[b];if(d)for(var e=0;e<d.length;e++){var c=d[e];c.pendingUpdates&=~ba.DECODE_ELEVATION;if(c.rawData){var g=a.decodeElevationData(c.rawData);c.rawData=null;if(g){c.data=g;var c=a.lij[0],k=this._iteratorPool.acquire();
for(k.reset(a);!k.done;){var h=k.next();h.findElevationBoundsForLayer(e,c);h.computeElevationBounds()}this._iteratorPool.release(k);a.dataArrived(e,b,g);this._updateTiles(a);ma.spatialReference=this.spatialReference;ma.extent=a.extent;this._emitElevationChange(ma)}}}};l.prototype._handleLayerViewChanges=function(a){var b=this,d=!1;a.added.forEach(function(a){var e=a.layer;S.isTiledLayerView(a)?(b._registerTiledLayer(a),e.loaded&&(d=!0)):a.supportsDraping&&b.overlayManager&&b.overlayManager.registerLayerView(a)});
a.removed.forEach(function(a){S.isTiledLayerView(a)?(d=!0,b._unregisterTiledLayerView(a.uid)):a.supportsDraping&&b.overlayManager&&b.overlayManager.unregisterLayerView(a)});(d=d||0<a.moved.filter(S.isTiledLayerView).length)&&this._updateTiledLayers()};l.prototype._registerTiledLayer=function(a){var b=this,d=[];d.push(a.watch("suspended",function(){b._updateTiledLayers()}));d.push(a.watch("fullOpacity",function(){return b._updateTileTextures()}));a.on("data-changed",function(){var d=S.isElevationLayerView(a)?
M.LayerClass.ELEVATION:M.LayerClass.MAP,e=b._layerIndexByLayerViewId[d][a.uid];null!=e&&b._invalidateLayerData(e,d)});this._basemapLayerViewHandles[a.uid]=d};l.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles[a];if(b){for(var d=0;d<b.length;d++)b[d].remove();delete this._basemapLayerViewHandles[a]}};l.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme){var b=this._view.allLayerViews,d=[[],[]],e=M.LayerClass,c=null,g=w.create(w.NEGATIVE_INFINITY);
b.forEach(function(b){var k=b.layer;if(b.layer&&b&&!b.suspended&&S.isTiledLayerView(b)){var h=b.fullExtent;h?a.tilingScheme.compatibleWith(b.tileInfo)?(w.expand(g,h),S.isElevationLayerView(b)?d[e.ELEVATION].push(b):(Infinity!==b.maxDataLevel&&(null===c||b.maxDataLevel>c)&&(c=b.maxDataLevel),d[e.MAP].push(b))):m.warn("Terrain: tiling scheme of layer "+k.id+" is incompatible with other tiled layers, will not be drawn"):m.warn("Terrain: Map or elevation layer does not have fullExtent: "+k.id)}},this);
for(var b=function(a){var b=k._layerViews[a],c=d[a];c.reverse();var g=b.length!==c.length,h=c.length,f=Array(h),l=Array(b.length);k._layerIndexByLayerViewId[a]={};for(var m=0;m<h;m++){k._layerIndexByLayerViewId[a][c[m].uid]=m;var n=b.indexOf(c[m]);f[m]=n;m!==n&&(g=!0);-1<n&&(l[n]=m)}if(g){k._topLevelTilemapOnlyTiles.forEach(function(b){return b.modifyLayers(l,f,a)});b=k._postorderIterator;if(k.rootTiles)for(b.reset(k.rootTiles);!b.done;)b.next().modifyLayers(l,f,a);k._layerViews[a]=c;if(k.rootTiles){for(b.reset(k.rootTiles);!b.done;)c=
b.next(),c.restartAgents(a),a===e.ELEVATION&&c.computeElevationBounds();k._updateTiles(k.rootTiles)}a===e.ELEVATION&&k.tilingScheme&&(ma.spatialReference=k.tilingScheme.spatialReference,ma.extent=L,k._emitElevationChange(ma))}},k=this,h=0;h<e.LAYER_CLASS_COUNT;h++)b(h);this.tilingScheme.levels.length-1<c&&(this.tilingScheme.ensureMaxLod(c),this._viewChangeUpdate())}};l.prototype._emitElevationChange=function(a){this.emit("elevation-change",a)};l.prototype._hasFixedExtent=function(){return!!this._clippingExtent};
l.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};l.prototype.numLayers=function(a){return this._layerViews[a].length};l.prototype.numTotalLayers=function(){return this._layerViews.reduce(function(a,b){return b.length+a},0)};l.prototype._updateTileTextures=function(){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)a.next().updateTexture();this._iteratorPool.release(a)};l.prototype._invalidateLayerData=function(a,b){var d=this._iteratorPool.acquire();
for(d.reset(this.rootTiles);!d.done;)d.next().removeLayerAgent(a,b);for(d.reset(this.rootTiles);!d.done;)d.next().invalidateLayerData(a,b);this._iteratorPool.release(d)};l.prototype.requestTileData=function(a,b,d){var e=this;this.tilemapStats.tilesRequested++;var c=this.layerViewByIndex(b,d),g=c.layer;if(g.tilemapCache){var k=this.getTilemapTile(a),h=k.layerInfo[d][b];if(h.tilemap){if(!k.tileDataAvailable(a,b,d))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",d,
c,{notInTilemap:!0}),b=new n.Promise,b.reject(),b}else{h.tilemapRequest||(h.tilemapRequest=this.requestTilemap(k,b,d,c,g));var f,l=new n.Promise(function(){f&&f.cancel()});h.tilemapRequest.always(function(){h.tilemapRequest=null;if(!l.isCancelled()){var b=e._layerIndexByLayerViewId[d][c.uid];null!=b&&(k.tileDataAvailable(a,b,d)?(f=e._requestTileData(a,b,d,c),f.then(function(){return l.resolve()})):(e.tilemapStats.tilesNotPresent++,e._dispatchDataEvent(a,"dataMissing",d,c,{notInTilemap:!0}),l.reject()))}});
return l}}return this._requestTileData(a,b,d,c)};l.prototype._requestTileData=function(a,b,d,e){this.tilemapStats.tileRequestsSent++;return d===M.LayerClass.ELEVATION?this._requestElevationTileData(a,b,d,e):this._requestMapTileData(a,b,d,e)};l.prototype._requestElevationTileData=function(a,b,d,e){function c(b){var c=f._layerIndexByLayerViewId[d][e.uid];null!=c?(c=a.layerInfo[d][c],c.rawData=b,a.pendingUpdates|=ba.DECODE_ELEVATION,c.pendingUpdates|=ba.DECODE_ELEVATION,f._pendingUpdates=!0):m.warn("TerrainSurface: received data from unknown layer %d %s",
d,a.lij.toString())}function h(b){k(b)||(f.tilemapStats.tileRequestErrors++,f._dispatchDataEvent(a,"dataMissing",d,e,b))}var f=this,l;S.isElevationLayerView(e)?(b=e.layer,S.useFetchTileForLayer(b)?(l=b.fetchTile(a.lij[0],a.lij[1],a.lij[2],M.ELEVATION_NODATA_VALUE),l.then(function(a){return c(a)},h)):(b=e.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),l=this._streamDataSupplier.request(b,"binary"),l.then(function(a,b){b.url=a;c(b)},h))):g(!1,"_requestElevationTileData can only be called for elevation layer views");
return l};l.prototype._requestMapTileData=function(a,b,d,e){function c(b){h._dispatchDataEvent(a,"dataArrived",d,e,b)}function g(b){k(b)||(h._dispatchDataEvent(a,"dataMissing",d,e,b),h.tilemapStats.tileRequestErrors++)}var h=this;if(S.isVectorTileLayerView(e)){var f=e.tileHandler;b=e.schemeHelper.getCompatibleLevelRowCol(a.lij);b=f.getVectorTileWithLRC(b[0],b[1],b[2],0);b.then(c).otherwise(g).always(function(){h._vectorTileLayerRequests=f.ongoingRequestCount});this._vectorTileLayerRequests=f.ongoingRequestCount}else S.useFetchTileForLayer(e.layer)&&
S.isTileLayerView(e)?(b=e.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2]),b.then(c).otherwise(g)):(b=e.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),b=this._streamDataSupplier.request(b,"image"),b.then(function(a,b){return c(b)},g));return b};l.prototype.requestTilemap=function(a,b,d,e,c){var g=this,k=a.lij[0]+M.TILEMAP_SIZE_EXP,h=a.lij[1]<<M.TILEMAP_SIZE_EXP,f=a.lij[2]<<M.TILEMAP_SIZE_EXP;this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return c.tilemapCache.fetchTilemap(k,
h,f,{timeout:6E3}).then(function(c){g.tilemapStats.tilemapRequestsPending--;b=g._layerIndexByLayerViewId[d][e.uid];null!=b&&(a.layerInfo[d][b].tilemap=c)}).otherwise(function(a){g.tilemapStats.tilemapRequestsPending--;g.tilemapStats.tilemapRequestErrors++})};l.prototype.getTilemapTile=function(a){var b=a.lij[0];return b>M.TILEMAP_SIZE_EXP?T.getTileNLevelsUp(a,M.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[b]};l.prototype._dispatchDataEvent=function(a,b,d,e,c){e=this._layerIndexByLayerViewId[d][e.uid];
if(null!=e)a[b](e,d,c);else m.warn("TerrainSurface: received data from unknown layer")};l.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._curOverlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};l.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),
!isNaN(a))){if(a!==this._curOverlayOpacity&&this.rootTiles){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var d=b.next();d.renderData&&d.renderData.overlayTexId&&(d.renderData.overlayOpacity=a)}this._iteratorPool.release(b)}this._curOverlayOpacity=a;this._renderer.setNeedsRender()}};l.prototype.getStats=function(){var a=0,b=0,d=0,e=[],c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;){var g=c.next();a++;g.renderData&&(b++,g.visible&&(d++,g=g.lij[0],e[g]=
null!=e[g]?e[g]+1:1))}this._iteratorPool.release(c);return{numNodes:a,numLeaves:b,numVisible:d,numVisiblePerLevel:e}};l.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===b[1]&&a.lij[2]===b[2])return a}),null;var d=Math.pow(2,b[0]),e=Math.floor(b[1]/d),c=Math.floor(b[2]/d),k;this.rootTiles.some(function(a){return a.lij[1]===e&&a.lij[2]===c?(k=a,!0):!1});if(k){for(d=1<<b[0]-1;k.lij[0]<b[0];){var h=b[1]&d?2:
0;0<(b[2]&d)&&h++;if(!k.children[h])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+T.tile2str(k)),null;k=k.children[h];d>>=1}g(k.lij[0]===b[0]&&k.lij[1]===b[1]&&k.lij[2]===b[2],"not the right tile?");return k}return null};l.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(0<a.next().pendingUpdates)return this._iteratorPool.release(a),
!0;this._iteratorPool.release(a);return!1};l.prototype.setBorders=function(a){this._renderer.setBorders(a)};l.prototype.setDisableRendering=function(a){this._renderer.setDisableRendering(a)};a([b.property({value:!1})],l.prototype,"cullBackFaces",null);a([b.property({readOnly:!0})],l.prototype,"extent",null);a([b.property({value:!1})],l.prototype,"frontMostTransparent",null);a([b.property({readOnly:!0})],l.prototype,"loaded",void 0);a([b.property({value:1})],l.prototype,"opacity",null);a([b.property({readOnly:!0})],
l.prototype,"overlayManager",void 0);a([b.property({readOnly:!0})],l.prototype,"manifold",void 0);a([b.property()],l.prototype,"maxTextureScale",void 0);a([b.property({readOnly:!0})],l.prototype,"ready",null);a([b.property({value:1})],l.prototype,"renderOrder",null);a([b.property({readOnly:!0})],l.prototype,"rootTiles",void 0);a([b.property({value:!0})],l.prototype,"skirts",null);a([b.property({readOnly:!0,aliasOf:"tilingScheme.spatialReference"})],l.prototype,"spatialReference",void 0);a([b.property({value:M.DEFAULT_TILE_BACKGROUND})],
l.prototype,"tileBackground",null);a([b.property({readOnly:!0})],l.prototype,"tilingScheme",void 0);a([b.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],l.prototype,"tilingSchemeLocked",void 0);a([b.property({readOnly:!0})],l.prototype,"tilingSchemeLogic",void 0);a([b.property({value:!0})],l.prototype,"velvetOverground",null);a([b.property({value:!1})],l.prototype,"wireframe",null);return l=a([b.subclass("esri.views.3d.terrain.TerrainSurface")],l)}(b.declared(c,u.Evented));
var v=1.2,D=80/180*Math.PI,L=[-Infinity,-Infinity,Infinity,Infinity],R=M.MAX_ROOT_TILES,Z=12,ba=M.TileUpdateTypes,ja=e.create(),aa=[0,0,0],ea=Array(10),ha=Array(10),ga={spatialReference:null,tile:null},ma={spatialReference:null,extent:null},fa={spatialReference:null,extent:null,scale:0};return B})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/on ../../../core/Logger ../../../core/Accessor ../../../core/HandleRegistry ../../../core/accessorSupport/decorators ../../../geometry/Point ../lib/glMatrix ../support/mathUtils ../support/earthUtils ../support/projectionUtils ../support/aaBoundingRect ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Selector ../support/debugFlags ../../../symbols/SimpleMarkerSymbol ../../../Graphic".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x){var I=q.vec2d,K=q.vec3d,J=q.vec4d,N={width:0,height:0,pixelRatio:0,views:null},M=[{viewport:J.create(),extent:J.create()}],Q=[M[0],{viewport:J.create(),extent:J.create()}],S=J.create(),P=K.create(),O=[J.create(),J.create()],T=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],U=c.getLogger("esri.views.3d.OverlayManager"),W,k=function(c){function t(){var a=null!==c&&
c.apply(this,arguments)||this;a._handles=new p;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._dirty=!1;a._isSpherical=!1;a._latestOriginId=0;a.opacity=0;return a}f(t,c);Object.defineProperty(t.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});t.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getTextureGraphicsRenderer();this._renderer.onHasHighlightsChanged=
function(){return a.onHasHighlightsChanged()};this._initialEmptyTexture=new E(new Uint8Array([0,0,0,0]),"overlayEmpty",{width:1,height:1,wrapClamp:!0});this.groundSelector=new G(this.view.viewingMode);this.groundSelector.enableBackfacesTerrain=!0;this.groundSelector.enableInvisibleTerrain=!0;this.groundSelector.enableHUDSelection=!1;this._stage.add(C.ModelContentType.TEXTURE,this._initialEmptyTexture);this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location"],
function(){return a.setOverlayDirty()}))};t.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);this._disposeOverlays();this._stage.remove(C.ModelContentType.TEXTURE,this._initialEmptyTexture.getId());this._handles&&(this._handles.destroy(),this._handles=null)};t.prototype.onHasHighlightsChanged=function(){this.setOverlayDirty();this.notifyChange("hasHighlights")};t.prototype.hasOverlays=function(){return!!this._overlays};t.prototype.setSpatialReference=
function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new y.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):new y.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};t.prototype.registerLayerView=function(a){var d=this,e=a.layer.uid;if(this._connectedLayers[e])U.warn("[OverlayManager#registerLayerView]: Layer "+
e+" is already connected");else{var c=b(a,"draped-data-change",function(){return d.setOverlayDirty()});this._connectedLayers[e]={eventHandles:[c],layerView:a};if(a.setDrapingExtent&&this._overlays)for(e=0;e<this._overlays.length;e++)c=this._overlays[e],a.setDrapingExtent(e,c.extent,this._overlaySR,2048,c.renderLocalOrigin);this.setOverlayDirty()}};t.prototype.unregisterLayerView=function(a){for(var b in this._connectedLayers){var e=this._connectedLayers[b];if(e.layerView===a){if(e.eventHandles)for(var c=
0;c<e.eventHandles.length;c++)e.eventHandles[c].remove();delete this._connectedLayers[b];this.setOverlayDirty();a.destroyed||(a._overlayUpdating=!1,a._evaluateUpdatingState())}}};t.prototype.setOverlayDirty=function(){this._dirty||(this._setOverlayUpdating(!0),this._dirty=!0)};t.prototype._setOverlayUpdating=function(a){for(var b in this._connectedLayers){var e=this._connectedLayers[b].layerView;if(!a||!e.suspended&&e.hasDraped)e._overlayUpdating=a,e._evaluateUpdatingState()}if(b=this.view._graphicsView)b._overlayUpdating=
a,b._evaluateUpdatingState()};t.prototype.updateOverlay=function(){if(this._overlaySR){var a=this._computeOverlayExtents();if(a){this._overlays||this._initOverlays();for(var b=0;b<this._overlays.length;b++){var c=this._overlays[b],h;a:{h=a[b];for(var f=c.extent,l=k.EXTENTS_DIFFER_THRESHOLD*Math.max(h[2]-h[0],h[3]-h[1],f[2]-f[0],f[3]-f[1]),n=0;4>n;n++)if(Math.abs(f[n]-h[n])>l){h=!0;break a}h=!1}if(h){J.set(a[b],c.extent);c.renderLocalOrigin={id:"OV_"+this._latestOriginId++,vec3:u.center(c.extent,K.create())};
for(var q in this._connectedLayers)h=this._connectedLayers[q].layerView,h.setDrapingExtent&&h.setDrapingExtent(b,a[b],this._overlaySR,2048,c.renderLocalOrigin)}}this._setOverlayUpdating(!1);this._drawOverlays();this.terrainSurface._updateTileOverlayParams();this._dirty=!1}}};t.prototype.overlaysNeedUpdate=function(){return this._dirty&&!!this._overlaySR};t.prototype.updateOpacity=function(a){var b=1;if(this._overlays){var e=this._scale;a=this.view.renderCoordsHelper.getAltitude(a);3.5*a<e&&(b=Math.sqrt(y.clamp((a-
e/10)/(e/3.5-e/10),0,1)))}return b};t.prototype.setOverlayParamsOfTile=function(a,b,c){a=a.extent;var d=-1;this._rectInsideRect(a,this._overlays[0].extent)?d=0:this._rectanglesOverlap(a,this._overlays[1].extent)&&(d=1);if(0<=d){var e=this._overlays[d].extent;b.overlayTexScale[0]=(a[2]-a[0])/(e[2]-e[0]);b.overlayTexScale[1]=(a[3]-a[1])/(e[3]-e[1]);var g=a[0];if(this._longitudeCyclical){var g=this._longitudeCyclical.minimalMonotonic(e[0],g),k=this._longitudeCyclical.minimalMonotonic(e[0],a[2]);g>k&&
(g=k-(a[2]-a[0]))}I.set2((g-e[0])/(e[2]-e[0]),(a[1]-e[1])/(e[3]-e[1]),b.overlayTexOffset);b.overlayTexId=this._overlays[d].valid?this._overlays[d].texture.getId():this._initialEmptyTexture.getId();b.highlightOverlayTexId=this._overlays[d].highlightValid?this._overlays[d].highlightTexture.getId():this._initialEmptyTexture.getId();b.overlayOpacity=void 0!==c?c:1}else b.overlayTexId=null,b.highlightOverlayTexId=null};t.prototype.overlayPixelSizeInMapUnits=function(a){var b;this._overlays&&(this._overlays[0]&&
this._pointIsInExtent(a,this._overlays[0].extent)?b=this._overlays[0].extent:this._overlays[1]&&(b=this._overlays[1].extent));return b?(b[2]-b[0])/2048:0};t.prototype._createEmptyOverlay=function(){var a=new E(null,"overlay",{wrapClamp:!0,mipmap:!0});this._stage.add(C.ModelContentType.TEXTURE,a);var b=new E(null,"highlightOverlay",{wrapClamp:!0,mipmap:!0});this._stage.add(C.ModelContentType.TEXTURE,b);return{extent:J.create(),texture:a,valid:!1,highlightTexture:b,highlightValid:!1,renderLocalOrigin:{id:"O",
vec3:[0,0,0]}}};t.prototype._initOverlays=function(){this._overlays=[this._createEmptyOverlay(),this._createEmptyOverlay()]};t.prototype._disposeOverlays=function(){if(this._overlays){var a=this._stage;this._overlays.forEach(function(b){a.remove(C.ModelContentType.TEXTURE,b.texture.getId());a.remove(C.ModelContentType.TEXTURE,b.highlightTexture.getId())});this._overlays=null}};t.prototype._intersectGroundFromView=function(a,b,c,k){var d=K.createFrom(b*this.view.width,c*this.view.height,1);K.unproject(d,
a.viewMatrix,a.projectionMatrix,a.fullViewport,d);b=K.createFrom(b*this.view.width,c*this.view.height,0);K.unproject(b,a.viewMatrix,a.projectionMatrix,a.fullViewport,b);this.groundSelector.init([],b,d,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundSelector,b,d);return this.groundSelector.minResult.getIntersectionPoint(k)};t.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=K.create(a.eye);K.normalize(d);K.negate(d);b=K.length(b);
b=Math.asin(b/K.length(a.eye));var e=Math.acos(K.dot(a.viewForward,d)),d=y.clamp((b-(e-.5*a.fovY))/a.fovY,0,1);b=y.clamp((-b-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=q.mat4d.multiplyVec4(a.projectionMatrix,J.createFrom(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0))[1],d=y.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,c)?!0:!1};t.prototype._computeOverlayExtents=function(){var a=this.view.navigation.currentCamera,
b=this.terrainSurface.extent,c=K.create(),k=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;this._findHorizonBasedPointOfInterest(a,this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,c)||K.set(k,c);this._scale=this.view.renderCoordsHelper.getAltitude(a.eye);var h=K.dist(a.eye,c),k=this.view.renderCoordsHelper.viewAngle(k,a.eye),k=Math.PI/2-Math.abs(k-Math.PI/2);if(n.OVERLAY_SHOW_CENTER){var f=new A({color:[255,0,0],outline:{color:[255,255,255],width:2}}),q=new l;w.vectorToPoint(c,
this._renderSR,q,this._overlaySR);f=new x({geometry:q,symbol:f});void 0!==W&&this.view.graphics.remove(W);this.view.graphics.add(f);W=f}this._overlaySREqualsRenderSR||w.vectorToVector(c,this._renderSR,c,this._overlaySR);var h=1024*a.perPixelRatio*h*2,p=!1,f=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(h/=Math.cos(w.webMercator.y2lat(c[1])),f=this.terrainSurface.extent[3],f*=.999):(p=!0,h/=z.metersPerDegree,f=90),h>=f&&(h=f,c[1]=0,this._overlaySR.isWebMercator&&(c[0]=0)));q=1;p&&(q=
1/Math.max(.2,Math.cos(Math.abs(y.deg2rad(c[1])))),180<h*q&&(q=180/h));var u=h*q,t=O[0];t[0]=c[0]-u;t[1]=c[1]-h;t[2]=c[0]+u;t[3]=c[1]+h;this._isSpherical&&this._shiftExtentToFitBounds(t,Infinity,f);p=O[1];J.set(t,p);6*u>b[2]-b[0]?J.set(b,p):k<=.25*Math.PI?(p[0]-=u,p[1]-=h,p[2]+=u,p[3]+=h):(w.vectorToVector(a.eye,this._renderSR,P,this._overlaySR),I.subtract(c,P,S),a=-Math.atan2(S[1],S[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),J.scale(T[Math.floor(a/(.25*Math.PI))],2*h,S),S[0]*=q,S[2]*=q,J.add(p,S,p));this._isSpherical&&
(p[0]=this._longitudeCyclical.clamp(p[0]),p[2]=this._longitudeCyclical.clamp(p[2]),p[1]=Math.max(p[1],-f),p[3]=Math.min(p[3],f));this.opacity=1;return O};t.prototype._drawOverlays=function(){for(var a=this._overlays[0].extent[2]-this._overlays[0].extent[0],b=this._renderer,c=0;c<this._overlays.length;c++){var k=this._overlays[c].extent,h=this._longitudeCyclical?k[2]>this._longitudeCyclical.max:!1,f=this._longitudeCyclical?k[0]<this._longitudeCyclical.min:!1;if(h||f){N.views=Q;var f=void 0,f=h?this._longitudeCyclical.max-
k[0]:this._longitudeCyclical.min-k[0],f=Math.round(f/(k[2]-k[0])*2048),l=N.views[0];J.set4(0,0,f,2048,l.viewport);J.set4(k[0],k[1],this._longitudeCyclical.max,k[3],l.extent);h||(l.extent[0]+=this._longitudeCyclical.range);l=N.views[1];J.set4(f,0,2048-f,2048,l.viewport);J.set4(this._longitudeCyclical.min,k[1],k[2],k[3],l.extent);h&&(l.extent[2]-=this._longitudeCyclical.range)}else N.views=M,J.set(k,N.views[0].extent),J.set4(0,0,2048,2048,N.views[0].viewport);N.width=2048;N.height=2048;N.pixelRatio=
a/(k[2]-k[0]);this._overlays[c].valid=b.draw(this._overlays[c].texture,N);this._overlays[c].highlightValid=b.drawHighlights(this._overlays[c].highlightTexture,N)}};t.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):!(a[0]>b[2]||a[2]<b[0]||a[1]>b[3]||a[3]<b[1])};t.prototype._rectInsideRect=function(a,
b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:a[0]>b[0]&&a[2]<b[2]&&a[1]>b[1]&&a[3]<b[3]};t.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var d=a.x;a=a.y;return d>b[0]&&d<b[2]&&a>b[1]&&a<b[3]};t.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);
a[1]<-c?e=a[1]+c:a[3]>c&&(e=c-a[3]);u.offset(a,d,e)};t.EXTENTS_DIFFER_THRESHOLD=1E-5;a([h.property()],t.prototype,"view",void 0);a([h.property()],t.prototype,"terrainSurface",void 0);a([h.property({type:Boolean})],t.prototype,"hasHighlights",null);return t=a([h.subclass("esri.views.3d.terrain.OverlayManager")],t)}(h.declared(t));return k})},"esri/views/3d/terrain/PlanarTile":function(){define(["./TileBase","./TileGeometryFactory","../../../core/ObjectPool","../support/mathUtils","../lib/glMatrix"],
function(B,r,f,a,b){var c=b.vec3d.createFrom(0,0,1);b=function(a,b,h,f){B.call(this);this.tileUp=c;void 0!==a&&this.init(a,b,h,f)};b.prototype=new B;b.prototype.constructor=b;b.prototype.init=function(b,c,h,f){B.prototype.init.call(this,b,c,h,f);this.edgeLen=this.extent[2]-this.extent[0];this.curvatureHeight=0;this.centerAtSeaLevel[0]=a.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=a.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};
b.prototype.updateRadiusAndCenter=function(){B.prototype.updateRadiusAndCenter.call(this);var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(a*a+b*b)};b.prototype.isVisible=function(a){if(!this.intersectsClippingArea)return!1;var b=this.extent[0],c=this.extent[1],f=this.elevationBounds[0],q=this.extent[2],t=this.extent[3],r=this.elevationBounds[1];return 0<a[0][0]*(0<a[0][0]?b:q)+a[0][1]*(0<a[0][1]?c:t)+a[0][2]*(0<a[0][2]?
f:r)+a[0][3]||0<a[1][0]*(0<a[1][0]?b:q)+a[1][1]*(0<a[1][1]?c:t)+a[1][2]*(0<a[1][2]?f:r)+a[1][3]||0<a[2][0]*(0<a[2][0]?b:q)+a[2][1]*(0<a[2][1]?c:t)+a[2][2]*(0<a[2][2]?f:r)+a[2][3]||0<a[3][0]*(0<a[3][0]?b:q)+a[3][1]*(0<a[3][1]?c:t)+a[3][2]*(0<a[3][2]?f:r)+a[3][3]||0<a[4][0]*(0<a[4][0]?b:q)+a[4][1]*(0<a[4][1]?c:t)+a[4][2]*(0<a[4][2]?f:r)+a[4][3]||0<a[5][0]*(0<a[5][0]?b:q)+a[5][1]*(0<a[5][1]?c:t)+a[5][2]*(0<a[5][2]?f:r)+a[5][3]?!1:!0};b.prototype._numSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];b.prototype.createGeometry=
function(a,b,c){a.needsUpdate=!1;return r.createPlanarGlobeTile(a.numVertsPerRow,this.extent,a.samplerData,b,c,a.clippingArea)};b.Pool=new f(b);return b})},"esri/views/3d/terrain/TileBase":function(){define("./terrainUtils ./tileUtils ./TerrainConst ./ElevationData ./TilePerLayerInfo ./ElevationTileAgent ./MapTileAgent ../support/mathUtils ../lib/glMatrix ../../../core/arrayUtils".split(" "),function(B,r,f,a,b,c,t,p,h,l){var q=h.vec3d,y=h.vec2d,z=h.vec4d,w=h.mat4d,u=B.weakAssert,C=q.create(),E=z.create(),
G=z.create(),n=q.create(),A=t.AGENT_DONE,x=f.LayerClass.LAYER_CLASS_COUNT,I=f.LayerClass.MAP,K=f.LayerClass.ELEVATION,J=f.TileUpdateTypes;h=function(a,b,c){this.lij=[0,0,0];this.extent=z.create();this.extentWGS84Rad=z.create();this.centerAtSeaLevel=q.create();this.center=q.create();this.tileUp=n;this.elevationBounds=y.create();this.children=[null,null,null,null];this.layerInfo=Array(x);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this._maxTesselation=0};h.prototype.init=
function(a,c,h,l){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];l.getExtent(a[0],a[1],a[2],this.extent,this.extentWGS84Rad);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen=0;this.vlevel=a?a[0]:0;c&&c.elevationBounds?y.set(c.elevationBounds,this.elevationBounds):y.set2(0,0,this.elevationBounds);this.parent=c;for(a=0;4>a;a++)this.children[a]=null;this.pendingUpdates=0;this.renderData=null;this.renderOrder=this.screenDepth=0;this.visible=
!1;this.parentSurface=h;for(a=0;a<x;a++)if(h){c=h.numLayers(a);var n;this.layerInfo[a]?(n=this.layerInfo[a],n.length=c):(n=Array(c),this.layerInfo[a]=n);for(var q=0;q<c;q++)n[q]=b.makeEmptyLayerInfo(a,n[q]),a==K&&this.findElevationBoundsForLayer(q,-1)}else this.layerInfo[a]=null;this.computeElevationBounds();this._maxTesselation=Math.min(l.pixelSize[0],f.MAX_TILE_TESSELATION)};h.prototype.dispose=function(){for(var a=0;a<x;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++)b[c].dispose()};h.prototype.updateScreenDepth=
function(a){q.set(this.center,G);G[3]=1;w.multiplyVec4(a,G,G);this.screenDepth=G[2]/G[3]};h.prototype.shouldSplit=function(a,b){var c=this.lij[0];if(1>c)return J.SPLIT;q.subtract(this.center,b,C);var h=q.length(C),f=this.edgeLen/(a[0]*h*2),h=this.edgeLen/(a[2]*h*2),l=a[1],n=a[3],u=a[4];a=a[5];return f<l?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],J.VSPLITMERGE):J.NONE:c>=u?(b=c+Math.ceil(-p.log2(l/f)),b!==this.vlevel?(this.vlevel=b,J.VSPLITMERGE):J.NONE):6<c&&(q.scale(this.tileUp,q.dot(this.tileUp,
C),E),q.subtract(E,C),q.length2(E)>this.radius*this.radius&&(q.scale(E,this.radius/q.length(E)),q.add(E,this.center),q.subtract(b,E,E),b=this.elevationBounds[1]-this.elevationBounds[0],Math.min(1,(Math.abs(q.dot(E,this.tileUp))+.5*b+this.curvatureHeight)/q.length(E))*h<.1/a*n))?J.NONE:J.SPLIT};h.prototype.decodeElevationData=function(b){var c;if(b instanceof ArrayBuffer)try{c=a.createFromLERC(this.lij,this.extent,b,f.noDataValueOpt)}catch(Q){console.warn("Error decoding %s: %s",b.url,Q.message)}else c=
a.createFromFetchTileResult(this.lij,this.extent,b);return c};h.prototype.getWGS84Extent=function(){return this.extentWGS84Rad.map(p.rad2deg)};h.prototype.load=function(a){for(var b=0;b<x;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};h.prototype.unload=function(a){this.renderData&&a.unloadTile(this);for(a=0;a<x;a++)for(var b=this.layerInfo[a],h=0;h<b.length;h++){var l=b[h];l.loadingAgent&&l.loadingAgent!==A&&(l.loadingAgent.dispose(),(a===f.LayerClass.ELEVATION?c:t).Pool.release(l.loadingAgent),
l.loadingAgent=null);l.pendingUpdates=0}this.pendingUpdates&=~f.TileUpdateTypes.UPDATE_GEOMETRY;this.pendingUpdates&=~f.TileUpdateTypes.UPDATE_TEXTURE};h.prototype.updateClippingStatus=function(a){l.equals(a,this.clippingArea)||(a?(this.intersectsClippingArea=this.intersectsExtent(a),this.isWithinClippingArea=this.isWithinExtent(a)):this.isWithinClippingArea=this.intersectsClippingArea=!0,this.clippingArea=a,this.renderData&&this.updateGeometry())};h.prototype.updateVisibility=function(a,b,c){a=c||
this.isVisible(a,b)&&this.intersectsClippingArea;if(a!==this.visible)for(this.visible=a,b=this.layerInfo[0],c=0;c<b.length;c++){var h=b[c];h.loadingAgent&&h.loadingAgent!==A&&h.loadingAgent.setSuspension(!a)}return a};h.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};h.prototype.hasLayerData=function(a,b){return(a=this.layerInfo[b][a])&&a.data&&!a.dataInvalidated};h.prototype.tileDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],
a.lij[2]):!0};h.prototype.requestLayerData=function(a,b,c){f.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var h=this.layerInfo[b][a];if(-1<h.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;if(h.data&&!h.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",
this.lij.toString(),c.tile.lij.toString(),b,a),h.waitingAgents.push(c),setTimeout(c.dataArrived.bind(c,this),0),!0;if(h.pendingUpdates&J.DECODE_ELEVATION)return h.waitingAgents.push(c),!0;h.waitingAgents.push(c);if(!h.requestPromise){var l=this.parentSurface.requestTileData(this,a,b);if(l.isFulfilled())return!1;a=function(){h.requestPromise===l&&(h.requestPromise=null)};h.requestPromise=l;l.then(a,a);return!!l}return!0};h.prototype.descendants=function(a){a||(a=[]);for(var b=0;4>b;b++){var c=this.children[b];
c&&(c.descendants(a),a.unshift(this.children[b]))}return a};h.prototype.isLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]==a[2]};h.prototype.findByLij=function(a){if(this.isLij(a))return this;for(var b=0;4>b;b++){var c=this.children[b];if(c&&(c=c.findByLij(a)))return c}return null};h.prototype.unrequestLayerData=function(a,b,c){f.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var h=this.layerInfo[b][a],
l=h.waitingAgents;c=l.indexOf(c);u(-1<c,"agent has not requested this piece of map data");l[c]=l[l.length-1];l.length--;1>l.length&&(l=h.requestPromise,c=!1,b===I&&(c=this.parentSurface.layerViewByIndex(a,I),c=B.isVectorTileLayerView(c)),c||u(l||h.rawData,"no pending operations on layerInfo that agents were waiting for"),l&&!l.isFulfilled()&&(l.cancel(),h.requestPromise=null),f.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),b,a))};h.prototype.dataArrived=
function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0};h.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);a.waitingAgents.length=0};h.prototype.updateTexture=function(a){this.renderData&&(a?this.parentSurface._renderer.updateTileTexture(this):
(this.pendingUpdates|=f.TileUpdateTypes.UPDATE_TEXTURE,this.parentSurface._pendingUpdates=!0))};h.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};h.prototype.computeElevationBounds=function(){y.set2(Number.MAX_VALUE,-Number.MAX_VALUE,this.elevationBounds);for(var a=this.layerInfo[K],b=!1,c=0;c<a.length;c++){var h=a[c];h.elevationBounds&&(this.elevationBounds[0]=Math.min(this.elevationBounds[0],h.elevationBounds[0]),this.elevationBounds[1]=
Math.max(this.elevationBounds[1],h.elevationBounds[1]),b=!0)}b||y.set2(0,0,this.elevationBounds);this.updateRadiusAndCenter()};h.prototype.updateRadiusAndCenter=function(){q.scale(this.tileUp,.5*(this.elevationBounds[0]+this.elevationBounds[1]),E);q.add(this.centerAtSeaLevel,E,this.center)};h.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[K][a];if(!c.elevationBounds||c.elevationBounds[2]<b)if(b=this.parentSurface.layerViewByIndex(a,K),r.fallsWithinLayer(this,b.layer,!1)){b=
!1;if(c.data)y.set(c.data.bounds,E),E[2]=this.lij[0],b=!0;else{for(var h=this.parent,l=0,n=null,p=c.data;h&&(!p||l<f.ELEVATION_DESIRED_RESOLUTION_LEVEL);){l=this.vlevel-h.lij[0];n=p||n;p=h.layerInfo[K][a].data;if(!p&&n&&l>=f.ELEVATION_DESIRED_RESOLUTION_LEVEL)break;h=h.parent}if(p=p||n)p.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],E),Infinity!==E[0]&&(E[2]=p.level,b=!0)}b&&(c.elevationBounds?q.set(E,c.elevationBounds):c.elevationBounds=[E[0],E[1],E[2]])}};h.prototype.updateGeometry=function(){this.pendingUpdates|=
f.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface._pendingUpdates=!0};h.prototype.modifyLayers=function(a,h,l){for(var n=h.length,q=this.layerInfo[l],p=Array(n),u=0;u<q.length;u++){var w=q[u];w.loadingAgent&&w.loadingAgent!==A&&(w.loadingAgent.dispose(),(l===f.LayerClass.ELEVATION?c:t).Pool.release(w.loadingAgent),w.loadingAgent=null);w.waitingAgents.length=0}if(l===I)for(u=0;u<q.length;u++)void 0===a[u]&&q[u].dispose();for(u=0;u<n;u++)a=h[u],p[u]=-1<a?q[a]:b.makeEmptyLayerInfo(l);this.layerInfo[l]=
p};h.prototype.restartAgents=function(a){if(this.renderData)if(this._createOrUpdateAgents(0,a),a===K){this.updateGeometry();a=this.layerInfo[a];for(var b=0;b<a.length;b++)a[b].pendingUpdates|=f.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface._pendingUpdates=!0}else this.updateTexture(!0)};h.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var h=b[c];h.loadingAgent===A&&(h.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};h.prototype.removeLayerAgent=
function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==A&&a.loadingAgent.dispose();a.loadingAgent=null};h.prototype.agentDone=function(a,b){var c=this.layerInfo[b],h=c[a];h.loadingAgent=A;h.data||h.upsampleFromTile||a<c.length-1&&this._createOrUpdateAgents(a+1,b)};h.prototype._createOrUpdateAgents=function(a,b){var h;h=b===K?!1:!this.visible;for(var l=this.layerInfo[b];a<l.length;){var n=l[a],q=!1,p=this.parentSurface.layerViewByIndex(a,b);if(null!==n.loadingAgent&&n.loadingAgent!==
A)q=n.loadingAgent.update();else if(n.loadingAgent!==A&&r.fallsWithinLayer(this,p.layer,!1)){var u=b===f.LayerClass.ELEVATION?c:t,w=u.Pool.acquire();(q=w.init(this,a,b,h))?n.loadingAgent=w:(w.dispose(),u.Pool.release(w),n.loadingAgent=A)}if(q&&!p.isTransparent)break;a++}};h.prototype.geometryState=function(a){var b,c=this._getElevationInfo(a?a.samplerData:null),h=this.lij[0],n=!1;c.samplerData?(b=this.vlevel-h,b=Math.max(h-c.maxTileLevel,f.ELEVATION_DESIRED_RESOLUTION_LEVEL-b),h=this._maxTesselation,
b=p.clamp((h>>b)+1,2,h+1)):b=8>h?this._numSubdivisionsAtLevel[h]+1:2;h=this.clippingArea;if(!this.intersectsClippingArea||this.isWithinClippingArea)h=null;a?(a.numVertsPerRow!==b&&(a.numVertsPerRow=b,n=!0),c.changed&&(a.samplerData=c.samplerData,n=!0),l.equals(a.clippingArea,h)||(a.clippingArea=h,n=!0),a.needsUpdate=n):a={numVertsPerRow:b,samplerData:c.samplerData,needsUpdate:!0,clippingArea:h};return a};h.prototype._getElevationInfo=function(a){for(var b=this.layerInfo[K],c=b.length,h=Array(c),f=
0,l=0,n=!1,q=0;q<c;q++){var p=b[q];if(p.upsampleFromTile){var p=p.upsampleFromTile.tile,k=p.layerInfo[K][q].data;a&&a[f]===k.samplerData||(n=!0);h[f++]=k.samplerData;l=Math.max(l,p.lij[0])}else p.data&&(k=this.parentSurface.layerViewByIndex(q,K),r.fallsWithinLayer(this,k.layer,!1)&&(a&&a[f]===p.data.samplerData||(n=!0),h[f++]=p.data.samplerData,l=this.lij[0]))}a&&a.length!==f&&(n=!0);0<f?h.length=f:h=null;return{changed:n,samplerData:h,maxTileLevel:l}};h.prototype.isWithinExtent=function(a){var b=
this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};h.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return h})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ./terrainUtilsPlanar ./terrainUtilsSpherical ../../../layers/TiledLayer ../../../layers/TileLayer ../../../layers/BaseTileLayer ../../../layers/BaseElevationLayer ../../../layers/ElevationLayer ../../../layers/VectorTileLayer ../../../layers/WMTSLayer ../../../support/basemapDefinitions".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y){function z(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function w(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function u(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function C(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function E(){A={};for(var a in y)y[a].baseMapLayers.forEach(function(a){A[a.url]=19});A["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=
20}function G(a,b,c,h){return n["local"===h||"planar"===h?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(r,"__esModule",{value:!0});var n={planar:f,spherical:a};r.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};r.autoUpdateSkirtsVisibility=function(a,b){n[a.manifold].autoUpdateSkirtsVisibility(a,b)};r.isTiledLayer=function(a){return a&&(a.isInstanceOf(b)||a.isInstanceOf(t)||a.isInstanceOf(p)||a.isInstanceOf(q))};r.isVectorTileLayer=function(a){return a&&
a.isInstanceOf(l)};r.isTileLayerView=z;r.isVectorTileLayerView=w;r.isWMTSLayerView=u;r.isElevationLayerView=C;r.isTiledLayerView=function(a){return a&&(z(a)||C(a)||w(a)||u(a))};r.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===c.prototype.fetchTile||a.fetchTile===h.prototype.fetchTile)};var A=null;r.getKnownTiledServiceLevelCap=function(a){A||E();a=a&&a.replace(/https?:/,"");return a in A?A[a]:Infinity};r.prepareKnownTiledServiceLevelCaps=E;r.checkIfTileInfoSupportedForView=G;
r.getTiledLayerInfo=function(a,b,c){var h,f;if(a.isInstanceOf(q)){if(a=a.activeLayer){var n=a.tileMatrixSet;if(n)h=n.tileInfo,f=n.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==G(a.tileInfo,a.fullExtent,b,c)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else h=a.isInstanceOf(l)?a.compatibleTileInfo256:a.tileInfo,f=a.fullExtent;return h&&f&&null==G(h,f,b,c)?{tileInfo:h,fullExtent:f}:{tileInfo:null,fullExtent:null}}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ./TilingScheme ./TerrainConst ../../../core/Error ../support/aaBoundingRect ../lib/glMatrix".split(" "),
function(B,r,f,a,b,c,t){function p(a,b,c,h){l.set(c,q);q[h]=b[h];h=l.subtract(q,b);var f=l.subtract(a,b,y),f=l.dot(f,h),p=l.dot(h,h);b=0>=f?b:p<=f?c:l.add(b,l.scale(h,f/p),q);a=l.subtract(a,b,q);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*a[1]))}function h(a,b){var c=a.getElevationBounds();a=a.extent;c=.5*(c[0]+c[1]);z[0]=a[0];z[1]=a[1];z[2]=c;w[0]=a[2];w[1]=a[3];w[2]=c;a=c=Infinity;b[0]<z[0]?c=p(b,z,w,0):b[0]>w[0]&&(c=p(b,w,z,0));b[1]<z[1]?a=p(b,z,w,1):b[1]>w[1]&&(a=p(b,w,z,1));return Math.min(c,
a)}Object.defineProperty(r,"__esModule",{value:!0});var l=t.vec3d,q=l.create(),y=l.create(),z=l.create(),w=l.create();r.autoUpdateSkirtsVisibility=function(a,b){var f,l=!0,n=a.extent,q=c.containsPoint(n,b);q?f=a.getElevation(b):(f=a.getElevationBounds(),f=.5*(f[0]+f[1]));f>b[2]?l=!1:q||(c.containsPointWithMargin(n,b,a.hideSkirtsDistanceFromExtentMargin*Math.min(n[2]-n[0],n[3]-n[1]))?h(a,b)>a.hideSkirtsMinimumCameraTilt&&(l=!1):l=!1);l!==a.skirts&&(a.skirts=l)};r.tiltOnEdge=p;r.tiltToExtentEdge=h;
r.checkIfTileInfoSupportedForViewSR=function(h,l,q){if(h.spatialReference.isGeographic)return new b("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var p=f.checkUnsupported(h);if(p)return p;var n=h.lods,p=n[0].resolution*Math.pow(2,n[0].level),u=[p*h.size[0],p*h.size[1]],t=[h.origin.x,h.origin.y];l=c.fromExtent(l);var w=c.create();f.computeRowColExtent(l,u,t,w);u=(w[2]-w[0])*(w[3]-w[1]);u>a.MAX_ROOT_TILES?(n=n[0].scale*Math.pow(2,n[0].level),
p=Math.max((l[3]-l[1])/h.size[1],(l[2]-l[0])/h.size[0])*n/p,l=Math.floor(Math.log(p)/Math.log(10)),p=Math.ceil(p/Math.pow(10,l))*Math.pow(10,l),p=new b("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(n).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+p.toLocaleString()+".",{level0Scale:n,suggestedLevel0Scale:p,requiredNumRootTiles:u,allowedNumRootTiles:a.MAX_ROOT_TILES})):p=null;return p?p:q&&!h.spatialReference.equals(q)?new b("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/TilingScheme":function(){define(["../../../core/Error","../../../geometry/SpatialReference","../../../geometry/support/scaleUtils","../support/projectionUtils","../support/mathUtils"],function(B,r,f,a,b){var c=a.webMercator.x2lon,t=a.webMercator.y2lat,p=[0,0,0,0],h=function(a){var b=h._checkUnsupported(a);if(b)throw b;this.spatialReference=a.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;
this._isWGS84=this.spatialReference.isWGS84;this.origin=[a.origin.x,a.origin.y];this.pixelSize=[a.size[0],a.size[1]];var c=a.lods.reduce(function(a,b,c){b.level<a.min&&(a.min=b.level,a.minIndex=c);a.max=Math.max(a.max,b.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),f=a.lods[c.minIndex],l=Math.pow(2,f.level),b=f.resolution*l,f=f.scale*l;this.levels=Array(c.max+1);for(c=0;c<this.levels.length;c++)this.levels[c]={resolution:b,scale:f,tileSize:[b*a.size[0],b*a.size[1]]},b/=2,f/=2};h.prototype=
{getExtent:function(a,h,f,p,w){p=p||Array(4);var l=this.levels[a];a=l.tileSize[0];l=l.tileSize[1];p[0]=this.origin[0]+f*a;p[2]=p[0]+a;p[3]=this.origin[1]-h*l;p[1]=p[3]-l;w&&(this._isWebMercator?(w[0]=c(p[0]),w[1]=t(p[1]),w[2]=c(p[2]),w[3]=t(p[3])):this._isWGS84&&(w[0]=b.deg2rad(p[0]),w[1]=b.deg2rad(p[1]),w[2]=b.deg2rad(p[2]),w[3]=b.deg2rad(p[3])))},ensureMaxLod:function(a){for(;this.levels.length<=a;){var b=this.levels[this.levels.length-1],c=b.resolution/2;this.levels.push({resolution:c,scale:b.scale/
2,tileSize:[c*this.pixelSize[0],c*this.pixelSize[1]]})}},capMaxLod:function(a){this.levels.length>a+1&&(this.levels.length=a+1)},getMaxLod:function(){return this.levels.length-1},scaleAtLevel:function(a){return this.levels[0].scale/Math.pow(2,a)},levelAtScale:function(a){var b=this.levels[0].scale;return a>=b?0:Math.log(b/a)*Math.LOG2E},compatibleWith:function(a){if(!(a instanceof h)){if(h._checkUnsupported(a))return!1;a=new h(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize[0]!==
this.pixelSize[0]||a.pixelSize[1]!==this.pixelSize[1])return!1;var c=Math.min(this.levels.length,a.levels.length)-1,f=this.levels[c].resolution,l=b.floatEqualAbsolute,p=.5*f;if(!l(a.origin[0],this.origin[0],p)||!l(a.origin[1],this.origin[1],p))return!1;p=.5*f/Math.pow(2,c)/Math.max(this.pixelSize[0],this.pixelSize[1])*12;return l(f,a.levels[c].resolution,p)},rootTilesInExtent:function(a,b,c){var f=this.levels[0].tileSize;h.computeRowColExtent(a,f,this.origin,p);a=p[1];var l=p[3],q=p[0],t=p[2],y=t-
q,r=l-a;y*r>c&&(c=Math.floor(Math.sqrt(c)),r>c&&(a=a+Math.floor(.5*r)-Math.floor(.5*c),l=a+c),y>c&&(q=q+Math.floor(.5*y)-Math.floor(.5*c),t=q+c));c=Array((t-q)*(l-a));y=0;for(r=a;r<l;r++)for(var n=q;n<t;n++)c[y++]=[0,r,n];b&&(b[0]=this.origin[0]+q*f[0],b[1]=this.origin[1]-l*f[1],b[2]=this.origin[0]+t*f[0],b[3]=this.origin[1]-a*f[1]);return c}};h.computeRowColExtent=function(a,b,c,h){var f=.001*(a[2]-a[0]+(a[3]-a[1]));h[0]=Math.floor((a[0]+f-c[0])/b[0]);h[2]=Math.ceil((a[2]-f-c[0])/b[0]);h[1]=Math.floor((c[1]-
a[3]+f)/b[1]);h[3]=Math.ceil((c[1]-a[1]-f)/b[1])};h.isPowerOfTwo=function(a){a=a.lods;var c=a[0].resolution*Math.pow(2,a[0].level);return!a.some(function(a){return!b.floatEqualRelative(a.resolution,c/Math.pow(2,a.level))})};h.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,b){return a-b});for(var b=1;b<a.length;b++)if(a[b]!==a[0]+b)return!0;return!1};h.tileSizeSupported=function(a){var b=a.size[1];return b===a.size[0]&&0===(b&b-1)&&128<=b&&512>=b};h._checkUnsupported=
function(a){return a?1>a.lods.length?new B("tilingscheme:generic","Tiling scheme must have at least one level"):h.isPowerOfTwo(a)?null:new B("tilingscheme:power-of-two","Tiling scheme must be power of two"):new B("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};h.checkUnsupported=function(a){var b=h._checkUnsupported(a);return b?b:h.hasGapInLevels(a)?new B("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):h.tileSizeSupported(a)?
null:new B("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]")};h.fromExtent=function(a,b){var c=a[2]-a[0],l=a[3]-a[1],q=f.getMetersPerUnitForSR(b),p=1.2*Math.max(c,l);a=new h({size:[256,256],origin:{x:a[0]-.5*(p-c),y:a[3]+.5*(p-l)},lods:[{level:0,resolution:p/256,scale:1/(256/96*.0254/(p*q))}],spatialReference:b});a.ensureMaxLod(20);return a};h.WebMercatorAuxiliarySphereTileInfo={size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:r.WebMercator,
lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]};h.makeWebMercatorAuxiliarySphere=function(a){a=a||19;var b=new h(h.WebMercatorAuxiliarySphereTileInfo);b.ensureMaxLod(a);return b};h.WebMercatorAuxiliarySphere=h.makeWebMercatorAuxiliarySphere(19);h.makeWGS84WithTileSize=function(a,b){b=b||16;var c=256/a;a=new h({size:[a,a],origin:{x:-180,y:90},spatialReference:r.WGS84,lods:[{level:0,resolution:.703125*c,scale:2.95497598570834E8*c}]});a.ensureMaxLod(b);return a};return h})},
"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","./TilingScheme","../support/aaBoundingRect"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});(function(a){a[a.MAP=0]="MAP";a[a.ELEVATION=1]="ELEVATION";a[a.LAYER_CLASS_COUNT=2]="LAYER_CLASS_COUNT"})(r.LayerClass||(r.LayerClass={}));(function(a){a[a.NONE=0]="NONE";a[a.SPLIT=1]="SPLIT";a[a.VSPLITMERGE=2]="VSPLITMERGE";a[a.MERGE=4]="MERGE";a[a.DECODE_ELEVATION=8]="DECODE_ELEVATION";a[a.UPDATE_GEOMETRY=16]=
"UPDATE_GEOMETRY";a[a.UPDATE_TEXTURE=32]="UPDATE_TEXTURE"})(r.TileUpdateTypes||(r.TileUpdateTypes={}));r.TILE_LOADING_DEBUGLOG=!1;r.MAX_ROOT_TILES=64;r.MAX_TILE_TESSELATION=512;r.ELEVATION_NODATA_VALUE=3.40282347E38/10;r.noDataValueOpt={noDataValue:r.ELEVATION_NODATA_VALUE};r.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;r.TILEMAP_SIZE_EXP=5;r.TILEMAP_SIZE=1<<r.TILEMAP_SIZE_EXP;r.WEBMERCATOR_WORLD_EXTENT=a.create([0,0,0,0]);f.WebMercatorAuxiliarySphere.getExtent(0,0,0,r.WEBMERCATOR_WORLD_EXTENT);r.GEOGRAPHIC_WORLD_EXTENT=
a.create([-180,-90,180,90]);r.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";r.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";r.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC"})},
"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","./TilingScheme","../../../core/Error"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});r.autoUpdateSkirtsVisibility=function(a,c){};r.checkIfTileInfoSupportedForViewSR=function(b,c,t){c=b.lods.length-1;if(b.spatialReference.isWebMercator){if(!f.makeWebMercatorAuxiliarySphere(c).compatibleWith(b))return new a("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(b.spatialReference.isWGS84){if(!f.makeWGS84WithTileSize(b.size[1],
c).compatibleWith(b))return new a("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new a("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(t&&!b.spatialReference.equals(t))return new a("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},"esri/layers/BaseTileLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ScaleRangeLayer ./support/TileInfo ../core/accessorSupport/decorators".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y){var z={id:"0/0/0",level:0,row:0,col:0,extent:null};return function(h){function l(){var a=null!==h&&h.apply(this,arguments)||this;a.tileInfo=q.create({spatialReference:p.WebMercator,size:256});a.type="base-tile";a.fullExtent=new t(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,p.WebMercator);a.spatialReference=p.WebMercator;return a}f(l,h);l.prototype.getTileBounds=function(a,b,c,h){h=h||[0,0,0,0];z.level=a;z.row=b;z.col=c;z.extent=h;this.tileInfo.updateTileInfo(z);
z.extent=null;return h};l.prototype.getTileUrl=function(a,b,h){throw new c("basetilelayer:gettileurl-not-implemented","getTileUrl() is not implemented");};l.prototype.fetchTile=function(a,c,h,f){a=this.getTileUrl(a,c,h);return"string"===typeof a?b(a,{responseType:"image",allowImageDataAccess:f&&f.allowImageDataAccess||!1}).then(function(a){return a.data}):a.then(function(a){return b(a,{responseType:"image"})}).then(function(a){return a.data})};a([y.shared({"2d":"../views/2d/layers/TiledLayerView2D",
"3d":"../views/3d/layers/TileLayerView3D"})],l.prototype,"viewModulePaths",void 0);a([y.property({type:q})],l.prototype,"tileInfo",void 0);a([y.property({readOnly:!0,value:"base-tile"})],l.prototype,"type",void 0);a([y.property()],l.prototype,"fullExtent",void 0);a([y.property()],l.prototype,"spatialReference",void 0);return l=a([y.subclass("esri.layers.BaseTileLayer")],l)}(y.declared(h,l))})},"esri/layers/BaseElevationLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../geometry/Extent ../geometry/SpatialReference ./Layer ./support/TileInfo ../core/accessorSupport/decorators".split(" "),
function(B,r,f,a,b,c,t,p,h,l){var q={id:"0/0/0",level:0,row:0,col:0,extent:null};return function(p){function r(){var a=null!==p&&p.apply(this,arguments)||this;a.tileInfo=h.create({spatialReference:t.WebMercator,size:256});a.fullExtent=new c(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,t.WebMercator);a.spatialReference=t.WebMercator;a.type="base-elevation";return a}f(r,p);r.prototype.getTileBounds=function(a,b,c,h){h=h||[0,0,0,0];q.level=a;q.row=b;q.col=c;q.extent=h;this.tileInfo.updateTileInfo(q);
q.extent=null;return h};r.prototype.fetchTile=function(a,c,h,f){throw new b("BaseElevationLayer:fetchtile-not-implemented","fetchTile() is not implemented");};a([l.shared({"3d":"../views/3d/layers/ElevationLayerView3D"})],r.prototype,"viewModulePaths",void 0);a([l.property({type:h})],r.prototype,"tileInfo",void 0);a([l.property()],r.prototype,"fullExtent",void 0);a([l.property()],r.prototype,"spatialReference",void 0);a([l.property({readOnly:!0,value:"base-elevation"})],r.prototype,"type",void 0);
return r=a([l.subclass("esri.layers.BaseElevationLayer")],r)}(l.declared(p))})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang ../core/accessorSupport/decorators ../core/Error ../core/MultiOriginJSONSupport ../core/urlUtils ../core/promiseUtils ../core/lang ../request ../geometry/Extent ../geometry/SpatialReference ../portal/support/jsonContext ./TiledLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/ArcGISCachedService ./support/TileInfo ./support/vectorTileLayerLoader ../views/vectorTiles/style/StyleRepository ../views/vectorTiles/SchemaHelper".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J){return function(n){function p(a,b){a=n.call(this)||this;a.currentStyleInfo=null;a.fullExtent=null;a.operationalLayerType="VectorTileLayer";a.tileInfo=null;a.type="vector-tile";a.url=null;return a}f(p,n);p.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?b.mixin({},{url:a},c):a};p.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1}).then(function(){if(a.portalItem&&
a.portalItem.id){var b=a.portalItem.itemUrl+"/resources/styles/root.json";return y(b,{query:{f:"json"}}).then(function(c){c.data&&a.read({url:b},u.createForItem(a.portalItem))})}}).always(function(){return a.loadStyle()});this.addResolvingPromise(b);return this};Object.defineProperty(p.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&h.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,
"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});p.prototype.writeStyleUrl=function(a,b){a&&h.isProtocolRelative(a)&&
(a="https:"+a);a&&!q.endsWith(a,"root.json")&&(a=h.join(a,"root.json"));b.styleUrl=a};p.prototype.readTileIndexType=function(a,b){return b.type};p.prototype.readTileIndexUrl=function(a,b){return h.join(this.serviceUrl,b.tileMap)};p.prototype.readTileServers=function(a,b){var c=this;a=b.tiles;this.serviceUrl&&a.forEach(function(a,b,f){f[b]=h.join(c.serviceUrl,a)});return a};p.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};p.prototype.readCompatibleTileInfo256=
function(a,b){return x.fromJSON(J.create256x256CompatibleTileInfo(b.tileInfo))};p.prototype.readCompatibleTileInfo512=function(a,b){return x.fromJSON(J.create512x512CompatibleTileInfo(b.tileInfo))};p.prototype.loadStyle=function(a){a=a||this.url;if(this._loadingPromise&&"string"===typeof a&&this.url===a)return this._loadingPromise;var b=this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a);b&&!b.isFulfilled()&&b.cancel();return this._loadingPromise};p.prototype.getTileUrl=function(a,
b,c){var h=this.tileServers[b%this.tileServers.length];return h=h.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};p.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new t("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};p.prototype._getSourceAndStyle=function(a){var b=this;
return a?I.loadMetadata(a).then(function(a){b._set("currentStyleInfo",{serviceUrl:a.serviceUrl,styleUrl:a.styleUrl,spriteUrl:a.spriteUrl,glyphsUrl:a.glyphsUrl,style:a.style,layerDefinition:a.layerDefinition});b._set("styleRepository",new K(a.style,a));b.read(a.layerDefinition)}):l.reject(Error("invalid style!"))};p.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);
if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,f=["World_Basemap","World_Basemap_WGS84"];c<f.length;c++){var l=f[c];if(-1<l.toLowerCase().indexOf(a))return h.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+l)}};a([c.shared({"2d":"../views/2d/layers/VectorTileLayerView2D","3d":"../views/3d/layers/VectorTileLayerView3D"})],p.prototype,"viewModulePaths",void 0);a([c.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],p.prototype,"attributionDataUrl",null);a([c.property({readOnly:!0})],
p.prototype,"currentStyleInfo",void 0);a([c.property({type:z,readOnly:!0})],p.prototype,"fullExtent",void 0);a([c.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],p.prototype,"serviceUrl",null);a([c.property({type:w,dependsOn:["tileInfo"],readOnly:!0})],p.prototype,"spatialReference",null);a([c.property({readOnly:!0})],p.prototype,"styleRepository",void 0);a([c.property({readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0}}})],p.prototype,"styleUrl",null);a([c.writer("styleUrl")],
p.prototype,"writeStyleUrl",null);a([c.property({readOnly:!0})],p.prototype,"tileIndexType",void 0);a([c.reader("tileIndexType",["tileIndexType","type"])],p.prototype,"readTileIndexType",null);a([c.property({readOnly:!0})],p.prototype,"tileIndexUrl",void 0);a([c.reader("tileIndexUrl",["tileIndexUrl","tileMap"])],p.prototype,"readTileIndexUrl",null);a([c.property({readOnly:!0,type:x})],p.prototype,"tileInfo",void 0);a([c.property({readOnly:!0})],p.prototype,"tileServers",void 0);a([c.reader("tileServers",
["tiles"])],p.prototype,"readTileServers",null);a([c.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],p.prototype,"type",void 0);a([c.property({json:{origins:{webDocument:{read:{source:"styleUrl"}},portalItem:{read:{source:"url"}}},write:!1,read:!1}})],p.prototype,"url",void 0);a([c.property({readOnly:!0})],p.prototype,"version",void 0);a([c.reader("version",["version","currentVersion"])],p.prototype,"readVersion",null);a([c.property({readOnly:!0})],p.prototype,"compatibleTileInfo256",
void 0);a([c.reader("compatibleTileInfo256",["tileInfo"])],p.prototype,"readCompatibleTileInfo256",null);a([c.property({readOnly:!0})],p.prototype,"compatibleTileInfo512",void 0);a([c.reader("compatibleTileInfo512",["tileInfo"])],p.prototype,"readCompatibleTileInfo512",null);return p=a([c.subclass("esri.layers.VectorTileLayer")],p)}(c.declared(C,E,G,n,p,A))})},"esri/portal/support/jsonContext":function(){define(["require","exports","../Portal","../../core/urlUtils"],function(B,r,f,a){Object.defineProperty(r,
"__esModule",{value:!0});r.createForItem=function(b){return{origin:"portal-item",url:a.urlToObject(b.itemUrl),portal:b.portal||f.getDefault()}}})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports dojo/has dojo/_base/lang ../../core/promiseUtils ../../core/urlUtils ../../config ../../request".split(" "),function(B,r,f,a,b,c,t,p){function h(a){if(a){var b=c.getOrigin(a);c.canUseXhr(b)||-1!==u.indexOf(b)||u.push(b);return a}}function l(a,b,h){if(null!=b.sources){h&&-1!==
h.path.indexOf("root.json")&&(h.path=h.path.substr(0,h.path.indexOf("root.json")),a.styleUrl=h.path);var f=z(b,h),l=b.sprite||null,p=b.glyphs||null;f&&f.url&&(f=h&&h.path?h.path:f.url,b.sprite&&!c.isAbsolute(b.sprite)&&(l=c.normalize(c.join(f,b.sprite))),b.glyphs&&!c.isAbsolute(b.glyphs)&&(p=c.normalize(c.join(f,b.glyphs))));a.style=b;a.spriteUrl=l;a.glyphsUrl=p;return y(a,b,h)}if(b.hasOwnProperty("tileInfo"))return a.layerDefinition=b,a.serviceUrl=h.path,q(a,b,h)}function q(a,b,f){b=b.defaultStyles;
c.isAbsolute(b)?a.styleUrl=c.normalize(b):a.styleUrl=c.normalize(c.join(f.path,b));h(a.styleUrl);return p(c.join(a.styleUrl,"root.json"),{responseType:"json"}).then(function(b){var h=b.data.sprite||null,f=b.data.glyphs||null;h&&!c.isAbsolute(h)&&(h=c.normalize(c.join(a.styleUrl,h)));f&&!c.isAbsolute(f)&&(f=c.normalize(c.join(a.styleUrl,f)));a.spriteUrl=h;a.glyphsUrl=f;return a.style=b.data})}function y(a,f,l){(f=z(f,l))||b.reject("Source isn't available in the syle object!");if(f.url)return a.serviceUrl=
f.url,c.isAbsolute(a.serviceUrl)||(a.serviceUrl=c.join(l.path,a.serviceUrl)),h(a.serviceUrl),p(a.serviceUrl,{query:{f:"json"},responseType:"json"}).then(function(b){a.layerDefinition=w(b.data);return a});a.layerDefinition=w(f);return b.resolve(a)}function z(a,b){if(!a.sources)return null;var h=a.sources;a=null;if(h.esri)a=h.esri,b&&a.url&&!c.isAbsolute(a.url)&&(h=b.path.substring(0,b.path.lastIndexOf("/")),a.url=c.join(h,a.url));else{for(var f=0,l=Object.keys(h);f<l.length;f++)if(b=l[f],-1!==b.toLocaleLowerCase().indexOf("street")&&
"vector"===a.type){a=h[b];break}if(!a)for(f=0,l=Object.keys(h);f<l.length&&(b=l[f],a=h[b],"vector"!==a.type);f++);}return a}function w(a){if(a.hasOwnProperty("tileInfo"))return a;for(var b={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},c=(b.xmax-b.xmin)/512,f=[],l=a.hasOwnProperty("minzoom")?parseFloat(a.minzoom):0,q=a.hasOwnProperty("maxzoom")?parseFloat(a.maxzoom):16;l<q;l++){var p=c/Math.pow(2,l);f.push({level:l,
scale:Math.floor(3779.527559055118*p),resolution:p})}a.tiles.forEach(h);return{capabilities:"TilesOnly",initialExtent:b,fullExtent:b,minScale:f[0].scale,maxScale:f[f.length-1].scale,tiles:a.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:f,spatialReference:{wkid:102100}}}}Object.defineProperty(r,"__esModule",{value:!0});var u=t.defaults&&t.defaults.io.corsEnabledServers||t.request.corsEnabledServers;r.loadMetadata=function(f){if(!f)return b.reject("invalid input URL!");
var q={layerDefinition:null,parsedUrl:null,serviceUrl:null,style:null,styleUrl:null,url:null,spriteUrl:null,glyphsUrl:null};if("string"!==typeof f)return l(q,f,null).then(function(){return q});f=q.url=c.normalize(f);var u=q.parsedUrl=c.urlToObject(f);h(f);return p(u.path,{responseType:"json",query:a.mixin({f:"json"},u.query)}).then(function(a){return l(q,a.data,u)}).then(function(){return q})}})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require","exports","./StyleLayer",
"dojo/has"],function(B,r,f,a){return function(){function b(c,f){this.styleJSON=c;this.version=parseFloat(c.version);this.sprite=f?f.spriteUrl:c.sprite;this.glyphs=f?f.glyphsUrl:c.glyphs;if(a("stable-symbol-rendering")){var p=(c.layers||[]).filter(function(a){return a.layout&&a.layout["text-font"]})[0];p&&(c.layers||[]).forEach(function(a){a.layout&&a.layout["text-font"]&&(a.layout["text-font"]=p.layout["text-font"])})}this.layers=(c.layers||[]).map(b._create);this._identifyRefLayers()}b.prototype._identifyRefLayers=
function(){for(var a=[],b=[],f=0,h=this.layers;f<h.length;f++){var l=h[f];if(1===l.type){var q=l.sourceLayer,q=q+("|"+JSON.stringify(l.minzoom)),q=q+("|"+JSON.stringify(l.maxzoom)),q=q+("|"+JSON.stringify(l.filter));a.push({key:q,layer:l})}2===l.type&&(q=l.sourceLayer,q+="|"+JSON.stringify(l.minzoom),q+="|"+JSON.stringify(l.maxzoom),q+="|"+JSON.stringify(l.filter),q+="|"+JSON.stringify(l.layout&&l.layout["line-cap"]),q+="|"+JSON.stringify(l.layout&&l.layout["line-join"]),b.push({key:q,layer:l}))}this._assignRefLayers(a);
this._assignRefLayers(b)};b.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var b,c,h=a.length,f=0;f<h;f++){var q=a[f];if(q.key===b)q.layer.refLayerId=c;else if(b=q.key,c=q.layer.id,1===q.layer.type&&!q.layer.hasPaintProperty("fill-outline-color"))for(var r=f+1;r<h;r++){var z=a[r];if(z.key===b){if(z.layer.hasPaintProperty("fill-outline-color")){a[f]=z;a[r]=q;c=z.layer.id;break}}else break}}};b._create=function(a,b,p){b=1-1/(p.length+1)*(1+b);
switch(a.type){case "background":return new f.StyleLayer(0,a,b);case "fill":return new f.StyleLayer(1,a,b);case "line":return new f.StyleLayer(2,a,b);case "symbol":return new f.StyleLayer(3,a,b);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":throw Error("Unsupported vector tile circle layer");}throw Error("Unknown vector tile layer");};return b}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define(["require","exports","./StyleDefinition","./StyleProperty",
"./Filter"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function c(a,b,c){this.type=a;this.id=b.id;this.source=b.source;this.sourceLayer=b["source-layer"];this.minzoom=b.minzoom;this.maxzoom=b.maxzoom;this.filter=b.filter;this.layout=b.layout;this.paint=b.paint;this.z=c;switch(a){case 0:this._layoutDefinition=f.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=f.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=f.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=f.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=f.StyleDefinition.lineLayoutDefinition;this._paintDefinition=f.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=f.StyleDefinition.symbolLayoutDefinition,this._paintDefinition=f.StyleDefinition.symbolPaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}c.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?
this._featureFilter:this._featureFilter=b.createFilter(this.filter)};c.prototype.hasLayoutProperty=function(a){var b=this._layoutProperties;return b&&b[a]?!0:!1};c.prototype.hasPaintProperty=function(a){var b=this._paintProperties;return b?void 0!==b[a]:!1};c.prototype.getLayoutValue=function(a,b){var c,f=this._layoutProperties;f&&(f=f[a])&&(c=f.getValue(b));a=this._layoutDefinition[a];void 0===c&&(c=a["default"]);"enum"===a.type&&(c=a.values.indexOf(c));return c};c.prototype.getPaintValue=function(a,
b){var c,f=this._paintProperties;f&&(f=f[a])&&(c=f.getValue(b));a=this._paintDefinition[a];void 0===c&&(c=a["default"]);"enum"===a.type&&(c=a.values.indexOf(c));return c};c.prototype._parseLayout=function(b){var c={},h;for(h in b)c[h]=new a(this._layoutDefinition[h],b[h]);return c};c.prototype._parsePaint=function(b){var c={},h;for(h in b)c[h]=new a(this._paintDefinition[h],b[h]);return c};return c}();r.StyleLayer=B;B=function(){return function(a,b){this.cap=a.getLayoutValue("line-cap",b);this.join=
a.getLayoutValue("line-join",b);this.miterLimit=a.getLayoutValue("line-miter-limit",b);this.roundLimit=a.getLayoutValue("line-round-limit",b)}}();r.LineLayout=B;B=function(){return function(a,b,f){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",b);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",b);this.optional=a.getLayoutValue("icon-optional",b);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",b);this.size=a.getLayoutValue("icon-size",b);this.rotate=a.getLayoutValue("icon-rotate",
b);this.padding=a.getLayoutValue("icon-padding",b);this.keepUpright=a.getLayoutValue("icon-keep-upright",b);this.offset=a.getLayoutValue("icon-offset",b);2===this.rotationAlignment&&(this.rotationAlignment=f?0:1)}}();r.IconLayout=B;B=function(){return function(a,b,f){this.allowOverlap=a.getLayoutValue("text-allow-overlap",b);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",b);this.optional=a.getLayoutValue("text-optional",b);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",
b);this.font=a.getLayoutValue("text-font",b);this.maxWidth=a.getLayoutValue("text-max-width",b);this.lineHeight=a.getLayoutValue("text-line-height",b);this.letterSpacing=a.getLayoutValue("text-letter-spacing",b);this.justify=a.getLayoutValue("text-justify",b);this.anchor=a.getLayoutValue("text-anchor",b);this.maxAngle=a.getLayoutValue("text-max-angle",b);this.size=a.getLayoutValue("text-size",b);this.rotate=a.getLayoutValue("text-rotate",b);this.padding=a.getLayoutValue("text-padding",b);this.keepUpright=
a.getLayoutValue("text-keep-upright",b);this.transform=a.getLayoutValue("text-transform",b);this.offset=a.getLayoutValue("text-offset",b);2===this.rotationAlignment&&(this.rotationAlignment=f?0:1)}}();r.TextLayout=B})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function f(){}f.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"}};f.fillLayoutDefinition=
{visibility:{type:"enum",values:["visible","none"],"default":"visible"}};f.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"},"line-cap":{type:"enum",values:["butt","round","square"],"default":"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],"default":"miter"},"line-miter-limit":{type:"number","default":2},"line-round-limit":{type:"number","default":1.05}};f.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"},
"symbol-placement":{type:"enum",values:["point","line"],"default":"point"},"symbol-spacing":{type:"number",minimum:1,"default":250},"symbol-avoid-edges":{type:"boolean","default":!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean","default":!1},"icon-ignore-placement":{type:"boolean","default":!1},"icon-optional":{type:"boolean","default":!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],"default":"auto"},"icon-size":{type:"number",minimum:0,"default":1},
"icon-rotate":{type:"number","default":0},"icon-padding":{type:"number",minimum:0,"default":2},"icon-keep-upright":{type:"boolean","default":!1},"icon-offset":{type:"array",value:"number",length:2,"default":[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],"default":"auto"},"text-font":{type:"array",value:"string","default":["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,"default":16},"text-max-width":{type:"number",
minimum:0,"default":10},"text-line-height":{type:"number","default":1.2},"text-letter-spacing":{type:"number","default":0},"text-justify":{type:"enum",values:["left","center","right"],"default":"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),"default":"center"},"text-max-angle":{type:"number",minimum:0,"default":45},"text-rotate":{type:"number","default":0},"text-padding":{type:"number",minimum:0,"default":2},"text-keep-upright":{type:"boolean",
"default":!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],"default":"none"},"text-offset":{type:"array",value:"number",length:2,"default":[0,0]},"text-allow-overlap":{type:"boolean","default":!1},"text-ignore-placement":{type:"boolean","default":!1},"text-optional":{type:"boolean","default":!1}};f.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,"default":1},"background-color":{type:"color","default":[0,0,0,1]},"background-pattern":{type:"string"}};
f.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,"default":1},"fill-antialias":{type:"boolean","default":!0},"fill-color":{type:"color","default":[0,0,0,1]},"fill-outline-color":{type:"color","default":[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,"default":[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"fill-pattern":{type:"string"}};f.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,"default":1},
"line-color":{type:"color","default":[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,"default":[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"line-width":{type:"number",minimum:0,"default":1},"line-gap-width":{type:"number",minimum:0,"default":0},"line-offset":{type:"number","default":0},"line-blur":{type:"number",minimum:0,"default":0},"line-dasharray":{type:"array",value:"number","default":[]},"line-pattern":{type:"string"}};f.symbolPaintDefinition=
{"icon-opacity":{type:"number",minimum:0,maximum:1,"default":1},"icon-color":{type:"color","default":[0,0,0,1]},"icon-halo-color":{type:"color","default":[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,"default":0},"icon-halo-blur":{type:"number",minimum:0,"default":0},"icon-translate":{type:"array",value:"number",length:2,"default":[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"text-opacity":{type:"number",minimum:0,maximum:1,"default":1},"text-color":{type:"color",
"default":[0,0,0,1]},"text-halo-color":{type:"color","default":[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,"default":0},"text-halo-blur":{type:"number",minimum:0,"default":0},"text-translate":{type:"array",value:"number",length:2,"default":[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"}};f.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,"default":1},"raster-hue-rotate":{type:"number","default":0},"raster-brightness-min":{type:"number",
minimum:0,maximum:1,"default":0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,"default":1},"raster-saturation":{type:"number",minimum:-1,maximum:1,"default":0},"raster-contrast":{type:"number",minimum:-1,maximum:1,"default":0},"raster-fade-duration":{type:"number",minimum:0,"default":300}};f.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,"default":1},"circle-radius":{type:"number",minimum:0,"default":5},"circle-color":{type:"color","default":[0,0,0,1]},"circle-blur":{type:"number",
minimum:0,"default":0},"circle-translate":{type:"array",value:"number",length:2,"default":[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"}};return f}();r.StyleDefinition=B})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(B,r,f,a){return function(){function b(a,f){switch(a.type){case "number":a=!0;break;case "color":a=!0;f=b._parseColor(f);break;case "array":a="number"===a.value;
break;default:a=!1}this.getValue=a?this._interpolate(f):this._piecewise(f)}b.prototype._piecewise=function(a){var b=a.stops;return b?function(a){var c=b.length;if(0!==c){for(var f=0,q=0;q<c;q++)if(b[q][0]<=a)f=q;else break;return b[f][1]}}:function(){return a}};b.prototype._interpolate=function(b){var c=b.stops;if(c){var f=b.base||1;return function(b){for(var h,q,p=c.length,t=0;t<p;t++){var w=c[t];if(w[0]<=b)h=w;else{q=w;break}}if(h&&q){t=q[0]-h[0];b-=h[0];b=1===f?b/t:(Math.pow(f,b)-1)/(Math.pow(f,
t)-1);if(Array.isArray(h[1])){h=h[1];q=q[1];p=[];for(t=0;t<h.length;t++)p.push(a.interpolate(h[t],q[t],b));return p}return a.interpolate(h[1],q[1],b)}if(h)return h[1];if(q)return q[1]}}return function(){return b}};b._parseColor=function(a){if(Array.isArray(a))return a;if("string"===typeof a)return a=new f(a),f.toUnitRGBA(a);if(a&&a.stops)return a.stops=a.stops.map(function(a){return[a[0],b._parseColor(a[1])]}),a;throw Error("Incorrect color definition "+a);};return b}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require",
"exports"],function(B,r){function f(a,c){a%=c;return 0<=a?a:a+c}Object.defineProperty(r,"__esModule",{value:!0});r.C_INFINITY=Number.POSITIVE_INFINITY;r.C_PI=Math.PI;r.C_2PI=2*r.C_PI;r.C_PI_BY_2=r.C_PI/2;r.C_RAD_TO_256=128/r.C_PI;r.C_256_TO_RAD=r.C_PI/128;r.C_DEG_TO_256=256/360;r.C_DEG_TO_RAD=r.C_PI/180;r.C_SQRT2=1.414213562;r.C_SQRT2_INV=1/r.C_SQRT2;var a=1/Math.LN2;r.positiveMod=f;r.radToByte=function(a){return f(a*r.C_RAD_TO_256,256)};r.degToByte=function(a){return f(a*r.C_DEG_TO_256,256)};r.log2=
function(b){return Math.log(b)*a};r.sqr=function(a){return a*a};r.clamp=function(a,c,f){return Math.min(Math.max(a,c),f)};r.interpolate=function(a,c,f){return a*(1-f)+c*f};r.between=function(a,c,f){return a>=c&&a<=f||a>=f&&a<=c}})},"esri/views/vectorTiles/style/Filter":function(){define(["require","exports"],function(B,r){return function(){function f(a,b,c){this._op=a;"$type"===b?(this._val=c instanceof Array?c.map(function(a){return f._types.indexOf(a)}):f._types.indexOf(c),this._op+=11):(this._key=
b,this._val=c)}f.prototype.filter=function(a){switch(this._op){case 0:return this._val;case 1:return a.values[this._key]===this._val;case 2:return a.values[this._key]!==this._val;case 3:return a.values[this._key]<this._val;case 4:return a.values[this._key]>this._val;case 5:return a.values[this._key]<=this._val;case 6:return a.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(a.values[this._key]);case 8:return-1===this._val.indexOf(a.values[this._key]);case 9:for(var b=0,c=this._val;b<
c.length;b++){var f=c[b];if(f.filter(a))return!0}return!1;case 10:b=0;for(c=this._val;b<c.length;b++)if(f=c[b],!f.filter(a))return!1;return!0;case 11:b=0;for(c=this._val;b<c.length;b++)if(f=c[b],f.filter(a))return!1;return!0;case 12:return a.type===this._val;case 13:return a.type!==this._val;case 14:return a.type<this._val;case 15:return a.type>this._val;case 16:return a.type>=this._val;case 17:return a.type<=this._val;case 18:return-1!==this._val.indexOf(a.type);case 19:return-1===this._val.indexOf(a.type)}};
f.createFilter=function(a){if(!a)return new f(0,void 0,!0);var b=a[0];if(1>=a.length)return new f(0,void 0,"any"!==b);switch(b){case "\x3d\x3d":return new f(1,a[1],a[2]);case "!\x3d":return new f(2,a[1],a[2]);case "\x3e":return new f(4,a[1],a[2]);case "\x3c":return new f(3,a[1],a[2]);case "\x3e\x3d":return new f(6,a[1],a[2]);case "\x3c\x3d":return new f(5,a[1],a[2]);case "in":return new f(7,a[1],a.slice(2));case "!in":return new f(8,a[1],a.slice(2));case "any":return new f(9,void 0,a.slice(1).map(f.createFilter.bind(this)));
case "all":return new f(10,void 0,a.slice(1).map(f.createFilter.bind(this)));case "none":return new f(11,void 0,a.slice(1).map(f.createFilter.bind(this)));default:throw Error("invalid operator: "+b);}};f._types=["Unknown","Point","LineString","Polygon"];return f}()})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require","exports"],function(B,r){return function(){function f(a,b){this.lockedSchemaPixelSize=a;this.isWGS84=b}f.prototype.getCompatibleLevelRowCol=function(a){var b=a[0],c=
a[1];a=a[2];this.isWGS84?(c>>=1,a>>=1):256===this.lockedSchemaPixelSize&&0<b&&(b--,c>>=1,a>>=1);return[b,c,a]};f.prototype.getSchemaShift=function(a,b){var c=0,f=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)a[2]%2&&(c=2*b),a[1]%2&&(f=2*b);return[c,f]};f.prototype.adjustLevel=function(a){return this.isWGS84?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};f.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.rows&&256===a.cols)return a;for(var b=a.format,c=a.compressionQuality,
f=a.dpi,p=a.origin,h=a.spatialReference,l=4326===h.wkid,q=[],r,z,w=a.lods.length,u=0;u<w;u++){var C=a.lods[u];r=C.scale;z=l?C.resolution:2*C.resolution;q.push({level:C.level,scale:r,resolution:z})}return{rows:256,cols:256,dpi:f,format:b,compressionQuality:c,origin:p,spatialReference:h,lods:q}};f.create512x512CompatibleTileInfo=function(a){if(!a||256===a.rows||256===a.cols)return null;for(var b=a.format,c=a.compressionQuality,f=a.dpi,p=a.origin,h=a.spatialReference,l=[],q,r,z=a.lods.length,w=0;w<z;w++){var u=
a.lods[w];q=u.scale;r=.5*u.resolution;l.push({level:u.level,scale:q,resolution:r})}return{rows:512,cols:512,dpi:f,format:b,compressionQuality:c,origin:p,spatialReference:h,lods:l}};return f}()})},"esri/layers/WMTSLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/_base/lang ../request ../core/Error ../core/HandleRegistry ../core/Collection ../core/promiseUtils ./Layer ./WebTileLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./support/WMTSSublayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/wmtsUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n){function A(a,b){return a.map(function(a){var c=new C;c.read(a,b);return c})}var x={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png","image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};return function(u){function w(a,b){var c=u.call(this)||this;c._sublayersHandles=new h;c.copyright=null;c.customParameters=null;c.customLayerParameters=
null;c.operationalLayerType="WebTiledLayer";c.resourceInfo=null;c.serviceMode="RESTful";c.sublayers=null;c.type="wmts";c.version="1.0.0";c.watch("activeLayer",function(a,b){b&&(b.layer=null);a&&(a.layer=c)},!0);c.watch("sublayers",function(a,b){b&&(b.forEach(function(a){a.layer=null}),c._sublayersHandles.removeAll(),c._sublayersHandles=null);a&&(a.forEach(function(a){a.layer=c}),c._sublayersHandles||(c._sublayersHandles=new h),c._sublayersHandles.add([a.on("after-add",function(a){a.item.layer=c}),
a.on("after-remove",function(a){a.item.layer=null})]))},!0);return c}f(w,u);w.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?c.mixin({},{url:a},b):a};w.prototype.load=function(){var a=this;if("KVP"!==this.serviceMode&&"RESTful"!==this.serviceMode)console.error("WMTS mode could only be 'KVP' or 'RESTful'");else return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){return a._fetchService()}).otherwise(function(){return q.reject(new p("wmtslayer:unsupported-service-data",
"Invalid response from the WMTS service."))})),this};Object.defineProperty(w.prototype,"activeLayer",{get:function(){return this._get("activeLayer")},set:function(a){this._set("activeLayer",a)},enumerable:!0,configurable:!0});w.prototype.readActiveLayerFromService=function(a,b,c){var h=this,f;this.activeLayer?b.layers.some(function(a){return a.id===h.activeLayer.id?(f=a,!0):!1}):(this.activeLayer=new C,f=b.layers[0]);this.activeLayer.read(f,c);return this.activeLayer};w.prototype.readActiveLayerFromItemOrWebDoc=
function(a,b,c){return new C({id:b.wmtsInfo.layerIdentifier,tileMatrixSetId:b.wmtsInfo.tileMatrixSet})};w.prototype.writeActiveLayer=function(a,b){a=this.activeLayer;b.templateUrl=this.getUrlTemplate(a.id,a.tileMatrixSetId,a.imageFormat,a.styleId);b.wmtsInfo=c.mixin(b.wmtsInfo||{},{layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId})};Object.defineProperty(w.prototype,"fullExtents",{get:function(){var a=[];this.activeLayer.tileMatrixSets.forEach(function(b){b.fullExtent&&a.push(b.fullExtent)});
return a},enumerable:!0,configurable:!0});w.prototype.readServiceMode=function(a,b,c){return-1<b.templateUrl.indexOf("?")?"KVP":"RESTful"};w.prototype.readSublayersFromService=function(a,b,c){return A(b.layers,c)};Object.defineProperty(w.prototype,"supportedSpatialReferences",{get:function(){return this.activeLayer.tileMatrixSets.map(function(a){return a.tileInfo.spatialReference}).toArray()},enumerable:!0,configurable:!0});Object.defineProperty(w.prototype,"title",{get:function(){return"Layer"===
this._get("title")?this.activeLayer&&this.activeLayer.title:this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(w.prototype,"url",{get:function(){return this._get("url")},set:function(a){a&&"/"===a.substr(-1)?this._set("url",a.slice(0,-1)):this._set("url",a)},enumerable:!0,configurable:!0});w.prototype.createWebTileLayer=function(a){var b=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,
this.activeLayer.styleId),c=this._getTileMatrixSetById(a.tileMatrixSetId).tileInfo,h=a.fullExtent;a={layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId,url:this.url};this.customLayerParameters&&(a.customLayerParameters=this.customLayerParameters);this.customParameters&&(a.customParameters=this.customParameters);return new z({fullExtent:h,urlTemplate:b,tileInfo:c,wmtsInfo:a})};w.prototype.fetchTile=function(a,b,c){a=this.getTileUrl(a,b,c);return t(a,{responseType:"image"}).then(function(a){return a.data})};
w.prototype.findSublayerById=function(a){return this.sublayers.find(function(b){return b.id===a})};w.prototype.getTileUrl=function(a,b,c){var h=this._getTileMatrixSetById(this.activeLayer.tileMatrixSetId).tileInfo.lods[a],h=h.levelValue?h.levelValue:String(h.level);(a=this.resourceInfo?"":n.getTileUrlFromResourceUrls(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.styleId,a,b,c))||(a=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,
this.activeLayer.styleId).replace(/\{level\}/gi,h).replace(/\{row\}/gi,b).replace(/\{col\}/gi,c));return a=this._appendCustomLayerParameters(a)};w.prototype.getUrlTemplate=function(a,b,c,h){var f="";if(!this.resourceInfo&&(f=n.getTileUrlTemplateFromResourceUrls(a,b,c,h)))return f;"KVP"===this.serviceMode?f=this.url+"?SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+a+"\x26STYLE\x3d"+h+"\x26FORMAT\x3d"+c+"\x26TILEMATRIXSET\x3d"+b+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":
"RESTful"===this.serviceMode&&(f="",x[c.toLowerCase()]&&(f=x[c.toLowerCase()]),f=this.url+a+"/"+h+"/"+b+"/{level}/{row}/{col}"+f);return f};w.prototype._fetchService=function(){var a=this;return q.resolve().then(function(){if(a.resourceInfo)return"KVP"===a.resourceInfo.serviceMode&&(a.url+=-1<a.url.indexOf("?")?"":"?"),{ssl:!1,data:a.resourceInfo};var b=a._getCapabilitiesUrl(a.serviceMode);return t(b,{responseType:"text",callbackParamName:"callback"}).otherwise(function(c){b=a._getCapabilitiesUrl("KVP"===
a.serviceMode?"RESTful":"KVP");return t(b,{responseType:"text",callbackParamName:"callback"})})}).then(function(b){b.data=a.resourceInfo?n.parseResourceInfo(b.data):n.parseCapabilities(b.data,{serviceMode:a.serviceMode});b.data&&a.read(b.data,{origin:"service"})})};w.prototype._getTileMatrixSetById=function(a){return this.findSublayerById(this.activeLayer.id).tileMatrixSets.find(function(b){return b.id===a})};w.prototype._appendCustomParameters=function(a){if(this.customParameters)for(var b in this.customParameters)a+=
(-1===a.indexOf("?")?"?":"\x26")+b+"\x3d"+encodeURIComponent(this.customParameters[b]);return a};w.prototype._appendCustomLayerParameters=function(a){if(this.customLayerParameters||this.customParameters){var b=c.clone(this.customParameters||{});c.mixin(b,this.customLayerParameters||{});for(var h in b)a+=(-1===a.indexOf("?")?"?":"\x26")+h+"\x3d"+encodeURIComponent(b[h])}return a};w.prototype._getCapabilitiesUrl=function(a){var b;this.url=this.url.split("?")[0];"KVP"===a?b=this.url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+
this.version:"RESTful"===a&&(b=this.url+"/"+this.version+"/WMTSCapabilities.xml");return b=this._appendCustomParameters(b)};a([b.shared({"2d":"../views/2d/layers/WMTSLayerView2D","3d":"../views/3d/layers/WMTSLayerView3D"})],w.prototype,"viewModulePaths",void 0);a([b.property({type:C,dependsOn:["sublayers"],json:{origins:{"web-document":{write:{ignoreOrigin:!0}}}}})],w.prototype,"activeLayer",null);a([b.reader("service","activeLayer",["layers"])],w.prototype,"readActiveLayerFromService",null);a([b.reader(["web-document",
"portal-item"],"activeLayer",["wmtsInfo"])],w.prototype,"readActiveLayerFromItemOrWebDoc",null);a([b.writer(["web-document","portal-item"],"activeLayer")],w.prototype,"writeActiveLayer",null);a([b.property()],w.prototype,"copyright",void 0);a([b.property({json:{origins:{webDocument:{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}},portalItem:{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}}}}})],w.prototype,"customParameters",
void 0);a([b.property({json:{origins:{webDocument:{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}},portalItem:{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}}}}})],w.prototype,"customLayerParameters",void 0);a([b.property({readOnly:!0,dependsOn:["activeLayer"]})],w.prototype,"fullExtents",null);a([b.property()],w.prototype,"operationalLayerType",void 0);a([b.property()],w.prototype,"resourceInfo",void 0);
a([b.property()],w.prototype,"serviceMode",void 0);a([b.reader(["portal-item","web-document"],"serviceMode",["templateUrl"])],w.prototype,"readServiceMode",null);a([b.property({type:l.ofType(C)})],w.prototype,"sublayers",void 0);a([b.reader("service","sublayers",["layers"])],w.prototype,"readSublayersFromService",null);a([b.property({readOnly:!0,dependsOn:["activeLayer"]})],w.prototype,"supportedSpatialReferences",null);a([b.property({dependsOn:["activeLayer"],json:{read:{source:"title"}}})],w.prototype,
"title",null);a([b.property({json:{read:!1},readOnly:!0,value:"wmts"})],w.prototype,"type",void 0);a([b.property({json:{origins:{service:{read:{source:"tileUrl"}},webDocument:{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}},portalItem:{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}}}}})],w.prototype,"url",null);a([b.property()],w.prototype,"version",void 0);return w=a([b.subclass("esri.layers.WMTSLayer")],w)}(b.declared(y,w,u,E,G))})},"esri/layers/WebTileLayer":function(){define("dojo/_base/lang dojo/_base/url dojo/string ../core/Error ../core/MultiOriginJSONSupport ../core/urlUtils ../geometry/SpatialReference ../geometry/Extent ../geometry/Point ./TiledLayer ./mixins/OperationalLayer ./mixins/ScaleRangeLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./support/TileInfo ./support/LOD".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C){return l.createSubclass([q,b,y,z,w],{declaredClass:"esri.layers.WebTileLayer",normalizeCtorArgs:function(a,b){return"string"===typeof a?B.mixin({urlTemplate:a},b||{}):a},getDefaults:function(a){var b=new p(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,t.WebMercator);return B.mixin(this.inherited(arguments),{fullExtent:b,tileInfo:new u({size:256,dpi:96,format:"PNG8",compressionQuality:0,origin:new h({x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:t.WebMercator}),spatialReference:t.WebMercator,lods:[new C({level:0,scale:5.91657527591555E8,resolution:156543.033928}),new C({level:1,scale:2.95828763795777E8,resolution:78271.5169639999}),new C({level:2,scale:1.47914381897889E8,resolution:39135.7584820001}),new C({level:3,scale:7.3957190948944E7,resolution:19567.8792409999}),new C({level:4,scale:3.6978595474472E7,resolution:9783.93962049996}),new C({level:5,scale:1.8489297737236E7,resolution:4891.96981024998}),new C({level:6,scale:9244648.868618,
resolution:2445.98490512499}),new C({level:7,scale:4622324.434309,resolution:1222.99245256249}),new C({level:8,scale:2311162.217155,resolution:611.49622628138}),new C({level:9,scale:1155581.108577,resolution:305.748113140558}),new C({level:10,scale:577790.554289,resolution:152.874056570411}),new C({level:11,scale:288895.277144,resolution:76.4370282850732}),new C({level:12,scale:144447.638572,resolution:38.2185141425366}),new C({level:13,scale:72223.819286,resolution:19.1092570712683}),new C({level:14,
scale:36111.909643,resolution:9.55462853563415}),new C({level:15,scale:18055.954822,resolution:4.77731426794937}),new C({level:16,scale:9027.977411,resolution:2.38865713397468}),new C({level:17,scale:4513.988705,resolution:1.19432856685505}),new C({level:18,scale:2256.994353,resolution:.597164283559817}),new C({level:19,scale:1128.497176,resolution:.298582141647617})]})})},properties:{copyright:{value:"",json:{write:!0}},fullExtent:{json:{write:!0}},legendEnabled:{json:{read:{source:["showLegend"],
reader:function(a,b){return null!=b.showLegend?b.showLegend:!0}},write:{target:"showLegend"}}},levelValues:{dependsOn:["tileInfo"],get:function(){var a=[];if(!this.tileInfo)return null;this.tileInfo.lods.forEach(function(b){a[b.level]=b.levelValue||b.level},this);return a}},operationalLayerType:"WebTiledLayer",popupEnabled:{json:{read:{source:["disablePopup"],reader:function(a,b){return null!=b.disablePopup?!b.disablePopup:!0}}}},refreshInterval:{json:{write:!0}},spatialReference:{type:t,value:t.WebMercator,
json:{read:{source:["spatialReference","fullExtent.spatialReference"],reader:function(a,b){return a||b.fullExtent&&b.fullExtent.spatialReference&&t.fromJSON(b.fullExtent.spatialReference)}}}},subDomains:{value:null,json:{write:!0}},tileInfo:{type:u,json:{write:!0}},tileServers:{value:null,dependsOn:["urlTemplate","subDomains"],get:function(){if(!this.urlTemplate)return null;var a=new r(this.urlTemplate),b=a.scheme?a.scheme+"://":"//",c=b+a.authority+"/",h=this.subDomains,f,l=[];-1===a.authority.indexOf("{subDomain}")&&
l.push(c);h&&0<h.length&&1<a.authority.split(".").length&&h.forEach(function(c){-1<a.authority.indexOf("{subDomain}")&&(f=b+a.authority.replace(/\{subDomain\}/gi,c)+"/");l.push(f)},this);return l=l.map(function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a})}},type:{value:"web-tile",json:{read:!1}},urlPath:{dependsOn:["urlTemplate"],get:function(){if(!this.urlTemplate)return null;var a=this.urlTemplate,b=new r(a);return a.substring(((b.scheme?b.scheme+"://":"//")+b.authority+"/").length)}},urlTemplate:{json:{origins:{portalItem:{read:{source:"url"}}},
read:{source:["urlTemplate","templateUrl"],reader:function(a,b){return a||b.templateUrl}},write:function(a,b){a&&c.isProtocolRelative(a)&&(a="https:"+a);b.templateUrl=a?c.normalize(a):a}}},url:{json:{write:!1}},wmtsInfo:{json:{write:!0}}},getTileUrl:function(a,b,c){a=this.levelValues[a];var h=this.tileServers[b%this.tileServers.length]+f.substitute(this.urlPath,{level:a,col:c,row:b});return h=h.replace(/\{level\}/gi,a).replace(/\{row\}/gi,b).replace(/\{col\}/gi,c)},load:function(){var b=this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){if(!this.urlTemplate)throw new a("layer:load",
"WebTileLayer (title: '"+this.title+"', id: '"+this.id+"') is missing the required 'urlTemplate' property value");}.bind(this));this.addResolvingPromise(b);return this}})})},"esri/layers/support/WMTSSublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/accessorSupport/decorators ../../core/Collection ../../core/JSONSupport ./TileMatrixSet ./WMTSStyle ../../geometry/Extent".split(" "),function(B,
r,f,a,b,c,t,p,h,l,q){return function(b){function p(a){a=b.call(this)||this;a.fullExtent=null;a.imageFormats=null;a.id=null;a.layer=null;a.styles=null;a.tileMatrixSetId=null;a.tileMatrixSets=null;return a}f(p,b);w=p;Object.defineProperty(p.prototype,"description",{get:function(){return this._get("description")},set:function(a){this._set("description",a)},enumerable:!0,configurable:!0});p.prototype.readFullExtent=function(a,b,c){return(a=b.fullExtent)?q.fromJSON(a):null};Object.defineProperty(p.prototype,
"imageFormat",{get:function(){var a=this._get("imageFormat");a||(a=this.imageFormats&&this.imageFormats.length?this.imageFormats[0]:"");return a},set:function(a){if(-1<a.indexOf("image/")||-1===this.imageFormats.indexOf(a))if(-1===a.indexOf("image/")&&(a="image/"+a),this.imageFormats&&-1===this.imageFormats.indexOf(a)){console.error("The layer doesn't support the format of "+a);return}this._set("imageFormat",a)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"styleId",{get:function(){var a=
this._get("styleId");a||(a=this.styles&&this.styles.length?this.styles.getItemAt(0).id:"");return a},set:function(a){this._set("styleId",a)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"tileMatrixSet",{get:function(){var a=this;return this.tileMatrixSets.find(function(b){return b.id===a.tileMatrixSetId})},enumerable:!0,configurable:!0});
p.prototype.clone=function(){var a=new w;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("imageFormats")&&(a.imageFormats=this.imageFormats&&this.imageFormats.slice());this.hasOwnProperty("imageFormat")&&(a.imageFormat=this.imageFormat);this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("styleId")&&(a.styleId=
this.styleId);this.hasOwnProperty("styles")&&(a.styles=this.styles&&this.styles.clone());this.hasOwnProperty("tileMatrixSetId")&&(a.tileMatrixSetId=this.tileMatrixSetId);this.hasOwnProperty("tileMatrixSets")&&(a.tileMatrixSets=this.tileMatrixSets.clone());this.hasOwnProperty("title")&&(a.title=this.title);return a};a([c.property()],p.prototype,"description",null);a([c.property()],p.prototype,"fullExtent",void 0);a([c.reader("fullExtent",["fullExtent"])],p.prototype,"readFullExtent",null);a([c.property({dependsOn:["imageFormats"]})],
p.prototype,"imageFormat",null);a([c.property({json:{read:{source:"formats"}}})],p.prototype,"imageFormats",void 0);a([c.property()],p.prototype,"id",void 0);a([c.property()],p.prototype,"layer",void 0);a([c.property()],p.prototype,"styleId",null);a([c.property({type:t.ofType(l),json:{read:{source:"styles"}}})],p.prototype,"styles",void 0);a([c.property({value:null,json:{write:{ignoreOrigin:!0}}})],p.prototype,"title",null);a([c.property()],p.prototype,"tileMatrixSetId",void 0);a([c.property({readOnly:!0,
dependsOn:["tileMatrixSetId"]})],p.prototype,"tileMatrixSet",null);a([c.property({type:t.ofType(h),json:{read:{source:"tileMatrixSets"}}})],p.prototype,"tileMatrixSets",void 0);return p=w=a([c.subclass("esri.layers.support.WMTSSublayer")],p);var w}(c.declared(p))})},"esri/layers/support/TileMatrixSet":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/accessorSupport/decorators ../../core/JSONSupport".split(" "),
function(B,r,f,a,b,c,t){return function(b){function h(a){a=b.call(this)||this;a.fullExtent=null;a.id=null;a.tileInfo=null;return a}f(h,b);l=h;h.prototype.clone=function(){var a=new l;this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("tileInfo")&&(a.tileInfo=this.tileInfo&&this.tileInfo.clone());return a};a([c.property({json:{read:{source:"fullExtent"}}})],h.prototype,"fullExtent",void 0);a([c.property({json:{read:{source:"id"}}})],
h.prototype,"id",void 0);a([c.property({json:{read:{source:"tileInfo"}}})],h.prototype,"tileInfo",void 0);return h=l=a([c.subclass("esri.layer.support.TileMatrixSet")],h);var l}(c.declared(t))})},"esri/layers/support/WMTSStyle":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/accessorSupport/decorators ../../core/JSONSupport".split(" "),function(B,r,f,a,b,c,t){return function(b){function h(a){a=
b.call(this)||this;a.id=null;a.title=null;a.description=null;a.legendUrl=null;return a}f(h,b);l=h;h.prototype.clone=function(){var a=new l;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("isDefault")&&(a.isDefault=this.isDefault);this.hasOwnProperty("keywords")&&(a.keywords=this.keywords&&this.keywords.slice());this.hasOwnProperty("legendUrl")&&(a.legendUrl=this.legendUrl);this.hasOwnProperty("title")&&(a.title=this.title);
return a};a([c.property({json:{read:{source:"id"}}})],h.prototype,"id",void 0);a([c.property({json:{read:{source:"title"}}})],h.prototype,"title",void 0);a([c.property({json:{read:{source:"abstract"}}})],h.prototype,"description",void 0);a([c.property({json:{read:{source:"legendUrl"}}})],h.prototype,"legendUrl",void 0);a([c.property({json:{read:{source:"isDefault"}}})],h.prototype,"isDefault",void 0);a([c.property({json:{read:{source:"keywords"}}})],h.prototype,"keywords",void 0);return h=l=a([c.subclass("esri.layer.support.WMTSStyle")],
h);var l}(c.declared(t))})},"esri/layers/support/wmtsUtils":function(){define("require exports ../../geometry/Extent ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/WKIDUnitConversion ./TileInfo ../../core/Error".split(" "),function(B,r,f,a,b,c,t,p){function h(a,b){return(a=b.getElementsByTagName(a))&&0<a.length?a[0]:null}function l(a,b){return Array.prototype.slice.call(b.getElementsByTagName(a)).map(function(a){return a.textContent})}function q(a,b){a.split("\x3e").forEach(function(a){b=
h(a,b)});return b&&b.textContent}function y(a,b,c,f){var l;Array.prototype.slice.call(f.childNodes).some(function(f){if(-1<f.nodeName.indexOf(a)){var n=h(b,f),n=n&&n.textContent;return n===c||c.split(":")&&c.split(":")[1]===n?(l=f,!0):!1}});return l}function z(a){var b=[],c=K[a],h=Array.prototype.slice.call(c.getElementsByTagName("ResourceURL")),c=c.getElementsByTagName("Dimension"),f,n,p,u;c.length&&(f=q("Identifier",c[0]),n=l("Default",c[0])||l("Value",c[0]));1<c.length&&(p=q("Identifier",c[1]),
u=l("Default",c[1])||l("Value",c[1]));I[a]={dimensions:n,dimensions2:u};h.forEach(function(a){var c=a.getAttribute("template");if(f&&n.length)if(-1<c.indexOf("{"+f+"}"))c=c.replace("{"+f+"}","{dimensionValue}");else{var k=c.toLowerCase().indexOf("{"+f.toLowerCase()+"}");-1<k&&(c=c.substring(0,k)+"{dimensionValue}"+c.substring(k+f.length+2))}p&&u.length&&(-1<c.indexOf("{"+p+"}")?c=c.replace("{"+p+"}","{dimensionValue2}"):(k=c.toLowerCase().indexOf("{"+p.toLowerCase()+"}"),-1<k&&(c=c.substring(0,k)+
"{dimensionValue2}"+c.substring(k+p.length+2))));b.push({template:c,format:a.getAttribute("fomrat"),resourceType:a.getAttribute("resourceType")})});return b}function w(a){return Array.prototype.slice.call(a.getElementsByTagName("Style")).map(function(a){var b=h("LegendURL",a),c=h("Keywords",a),c=c&&l("Keyword",c);return{abstract:q("Abstract",a),id:q("Identifier",a),isDefault:"true"===a.getAttribute("isDefault"),keywords:c,legendUrl:b&&b.getAttribute("xlink:href"),title:q("Title",a)}})}function u(a,
b){return l("TileMatrixSet",a).map(function(c){return C(c,a,b)})}function C(a,b,c){b=y("TileMatrixSetLink","TileMatrixSet",a,b);b=l("TileMatrix",b);var f=y("TileMatrixSet","Identifier",a,c);c=E(f);var p=c.spatialReference,u=p.wkid,w=h("TileMatrix",f),w=[parseInt(q("TileWidth",w),10),parseInt(q("TileHeight",w),10)],r=[];b.length?b.forEach(function(b,c){b=y("TileMatrix","Identifier",b,f);r.push(n(b,u,c,a))}):Array.prototype.slice.call(f.getElementsByTagName("TileMatrix")).forEach(function(b,c){r.push(n(b,
u,c,a))});b=G(f,c,w,r[0]);return{id:a,fullExtent:b,tileInfo:new t({dpi:96,spatialReference:p,size:w,origin:c,lods:r})}}function E(c){var f=q("SupportedCRS",c);f&&(f=f.toLowerCase());var l=parseInt(f.split(":").pop(),10);if(900913===l||3857===l)l=102100;var n=!1;if(-1<f.indexOf("crs84")||-1<f.indexOf("crs:84"))l=4326,n=!0;else if(-1<f.indexOf("crs83")||-1<f.indexOf("crs:83"))l=4269,n=!0;else if(-1<f.indexOf("crs27")||-1<f.indexOf("crs:27"))l=4267,n=!0;var p=new b({wkid:l});c=h("TileMatrix",c);var u=
q("TopLeftCorner",c).split(" ");c=u[0].split("E").map(function(a){return Number(a)});var u=u[1].split("E").map(function(a){return Number(a)}),t=c[0],w=u[0],r;1<c.length&&(t=c[0]*Math.pow(10,c[1]));1<u.length&&(w=u[0]*Math.pow(10,u[1]));var y=n&&4326===l&&90===t&&-180===w;x.some(function(b,c){var k=Number(f.split(":").pop());if(k>=b[0]&&k<=b[1]||4326===l&&(!n||y))return r=new a(w,t,p),!0;c===x.length-1&&(r=new a(t,w,p));return!1});return r}function G(a,b,c,l){var n=h("BoundingBox",a),p,u;n&&(p=q("LowerCorner",
n).split(" "),u=q("UpperCorner",n).split(" "));p&&1<p.length&&u&&1<u.length?(a=parseFloat(p[0]),c=parseFloat(p[1]),p=parseFloat(u[0]),u=parseFloat(u[1])):(a=h("TileMatrix",a),p=parseFloat(q("MatrixWidth",a)),n=parseFloat(q("MatrixHeight",a)),a=b.x,u=b.y,p=a+p*c[0]*l.resolution,c=u-n*c[1]*l.resolution);return new f(a,c,p,u,b.spatialReference)}function n(a,b,c,h){var f=q("Identifier",a);a=q("ScaleDenominator",a).split("E").map(function(a){return Number(a)});a=1<a.length?a[0]*Math.pow(10,a[1]):a[0];
b=A(b,a,h);return{level:c,levelValue:f,scale:1.058267716535433*a,resolution:b}}function A(a,b,h){a=c.hasOwnProperty(String(a))?c.values[c[a]]:"default028mm"===h?6370997*Math.PI/180:6378137*Math.PI/180;return 7*b/25E3/a}Object.defineProperty(r,"__esModule",{value:!0});var x=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],
[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],
[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],
[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],I=new Map,K=new Map;r.parseCapabilities=function(a,b){a=a.replace(/ows:/gi,"");a=(new DOMParser).parseFromString(a,"text/xml").documentElement;var c=h("Contents",a);if(!c)throw new p("wmtslayer:wmts-capabilities-xml-is-not-valid");var f=
h("OperationsMetadata",a).querySelector("[name\x3d'GetTile']").getElementsByTagName("Get"),f=Array.prototype.slice.call(f),n=b.serviceMode,t,r,x;f.some(function(a){var b=h("Constraint",a);if(!b||y("AllowedValues","Value",n,b))return r=a.attributes[0].nodeValue,!0;if(!b||y("AllowedValues","Value","RESTful",b)||y("AllowedValues","Value","REST",b))x=a.attributes[0].nodeValue;else if(!b||y("AllowedValues","Value","KVP",b))t=a.attributes[0].nodeValue;return!1});r||(x?(r=x,n="RESTful"):t&&(r=t,n="KVP"));
-1===r.indexOf("/1.0.0/")&&"RESTful"===n&&(r+="/");"KVP"===n&&(r+=-1<r.indexOf("?")?"":"?");b=q("ServiceIdentification\x3eAccessConstraints",a);a=Array.prototype.slice.call(c.getElementsByTagName("Layer")).map(function(a){var b=q("Identifier",a);K[b]=a;var k=q("Abstract",a),f=l("Format",a),n,e=h("WGS84BoundingBox",a);n=e?q("LowerCorner",e).split(" "):["-180","-90"];e=e?q("UpperCorner",e).split(" "):["180","90"];n={xmin:parseFloat(n[0]),ymin:parseFloat(n[1]),xmax:parseFloat(e[0]),ymax:parseFloat(e[1]),
spatialReference:{wkid:4326}};var e=w(a),d=q("Title",a);a=u(a,c);return{id:b,fullExtent:n,description:k,formats:f,styles:e,title:d,tileMatrixSets:a}});return{copyright:b,layers:a,tileUrl:r,serviceMode:n}};r.parseResourceInfo=function(a){a.layers.forEach(function(a){a.tileMatrixSets.forEach(function(a){var b=a.tileInfo;96!==b.dpi&&(b.lods.forEach(function(c){c.scale=96*c.scale/b.dpi;c.resolution=A(b.spatialReference.wkid,90.71428571428571*c.scale/96,a.id)}),b.dpi=96)})});return a};r.getTileUrlFromResourceUrls=
function(a,b,c,h,f,l){var n=z(a),q=I[a].dimensions&&I[a].dimensions[0];a=I[a].dimensions2&&I[a].dimensions2[0];var p="";n&&0<n.length&&(p=n[f%n.length].template.replace(/\{Style\}/gi,c).replace(/\{TileMatrixSet\}/gi,b).replace(/\{TileMatrix\}/gi,h).replace(/\{TileRow\}/gi,f).replace(/\{TileCol\}/gi,l).replace(/\{dimensionValue\}/gi,q).replace(/\{dimensionValue2\}/gi,a));return p};r.getTileUrlTemplateFromResourceUrls=function(a,b,c,h){c=z(a);var f="";if(c&&0<c.length){var l=I[a].dimensions&&I[a].dimensions[0];
a=I[a].dimensions2&&I[a].dimensions2[0];f=c[0].template;f.indexOf(".xxx")===f.length-4&&(f=f.slice(0,f.length-4));f=f.replace(/\{Style\}/gi,h);f=f.replace(/\{TileMatrixSet\}/gi,b);f=f.replace(/\{TileMatrix\}/gi,"{level}");f=f.replace(/\{TileRow\}/gi,"{row}");f=f.replace(/\{TileCol\}/gi,"{col}");f=f.replace(/\{dimensionValue\}/gi,l);f=f.replace(/\{dimensionValue2\}/gi,a)}return f}})},"esri/views/3d/terrain/tileUtils":function(){define(["require","exports","./UpsampleInfo","../support/PreallocArray"],
function(B,r,f,a){function b(a,c,f,p){p=c.call(f,a,p);for(var h=0;4>h;h++){var l=a.children[h];l&&b(l,c,f,p)}}function c(a,b,c){if(Array.isArray(a))for(var h=0;h<a.length;h++)t(a[h],b,c);else t(a,b,c)}function t(a,b,f){for(var h=0;4>h;h++){var l=a.children[h];l&&c(l,b,f)}b.call(f,a)}Object.defineProperty(r,"__esModule",{value:!0});B=function(){function b(b){void 0===b&&(b=100);this.q=new a(b);this._last=null;this.done=!0}b.prototype.reset=function(a){this.q.clear();a&&this.q.pushEither(a);this._last=
null;this.done=0===this.q.length};b.prototype.skip=function(){this._last=null;0===this.q.length&&(this.done=!0)};b.prototype.next=function(){if(this.done)return null;if(null!==this._last){var a=this._last.children;if(a[0])for(var b=4;0<=b;b--){var c=a[b];c&&this.q.push(c)}this._last=null}this._last=this.q.pop();0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return b}();r.IteratorPreorder=B;B=function(){function b(b){void 0===b&&(b=100);this.q=new a(b);this.done=!0}b.prototype.reset=
function(a){this.q.clear();this.q.pushEither(a);for(a=0;a<this.q.length;)for(var b=this.q.data[a++],c=0;4>c;c++){var h=b.children[c];h&&this.q.push(h)}this.done=0===this.q.length};b.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return b}();r.IteratorPostorder=B;r.lij2str=function(a,b,c){return a+"/"+b+"/"+c};r.tile2str=function(a){return a.lij[0]+"/"+a.lij[1]+"/"+a.lij[2]};r.traverseTilesPreorder=function(a,c,f,p){if(Array.isArray(a))for(var h=0;h<a.length;h++)b(a[h],
c,f,p);else b(a,c,f,p)};r.traverseTilesPostorder=c;r.fallsWithinLayer=function(a,b,c){var h=b.fullExtent,f=a.extent;if(c){if(f[0]<h.xmin||f[1]<h.ymin||f[2]>h.xmax||f[3]>h.ymax)return!1}else if(h.xmin>f[2]||h.ymin>f[3]||h.xmax<f[0]||h.ymax<f[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};r.isPosWithinTile=function(a,b){a=a.extent;return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};r.getTileNLevelsUp=
function(a,b){for(;0<b;)a=a.parent,b--;return a};r.nextTileInAncestry=function(a,b){var c=a.lij[0]-b.lij[0]-1,h=a.lij[2]>>c,f=0;a.lij[1]>>c&1&&(f+=2);h&1&&(f+=1);return b.children[f]};r.computeUpsampleInfoForAncestor=function(a,b){for(var c=1,h=0,l=0;a!==b;)if(c*=.5,h*=.5,l*=.5,a.lij[2]&1&&(h+=.5),0===(a.lij[1]&1)&&(l+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of ancestorTile");a=f.Pool.acquire();a.init(b,h,l,c);return a};var p=[null];r.hasVisibleSiblings=function(a){Array.isArray(a)||
(p[0]=a,a=p);for(var b=0;b<a.length;b++){var c=a[b],h=c.parent;if(h)for(var f=0;4>f;f++){var t=h.children[f];if(t&&t!==c&&t.visible)return!0}}return!1}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../lib/glMatrix","../../../core/ObjectPool"],function(B,r,f,a){var b=f.vec2d;return function(){function c(a,c,h,f){this.scale=0;this.tile=null;this.offset=b.create();void 0!==a&&this.init(a,c,h,f)}c.prototype.init=function(a,b,c,f){this.tile=a;this.offset[0]=b;this.offset[1]=
c;this.scale=f};c.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};c.Pool=new a(c);return c}()})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../layers/support/rasterFormats/LercCodec","./TerrainConst","../support/mathUtils"],function(B,r,f,a,b){return function(){function c(a,b,c,f){this.samplerData=null;this.level=a;this.i=b;this.j=c;this.extent=f}c.prototype.computeMinMaxValue=function(c,f,h,l){var q=Infinity,p=-Infinity;
c-=this.level;var t=Math.pow(2,c);if(Math.floor(f/t)===this.i&&Math.floor(h/t)===this.j&&0<c){var w=this.samplerData.width,u=this.samplerData.pixelData,r=.5*a.ELEVATION_NODATA_VALUE;c=(w-1)/t;h=(h-this.j*t)*c;f=(f-this.i*t)*c;if(1>c){var t=Math.floor(h),E=Math.floor(f),G=t+E*w,n=u[G],A=u[G+1],x=u[G+w],G=u[G+w+1];if(n+A+x+G<r)return q=b.bilerp(n,A,x,G,h-t,f-E),p=b.bilerp(n,A,x,G,h-t+c,f-E),w=b.bilerp(n,A,x,G,h-t,f-E+c),c=b.bilerp(n,A,x,G,h-t+c,f-E+c),l[0]=Math.min(q,p,w,c),l[1]=Math.max(q,p,w,c),l;
h=t;f=E;c=1}else h=Math.floor(h),f=Math.floor(f),c=Math.ceil(c);for(t=h;t<=h+c;t++)for(E=f;E<=f+c;E++)G=t+E*w,n=u[G],n<r?(q=Math.min(q,n),p=Math.max(p,n)):(q=0<q?0:q,p=0>p?0:p)}l[0]=q;l[1]=p;return l};c.createFromLERC=function(a,b,h,l){h=f.decode(h,l);a=new c(a[0],a[1],a[2],b);a.samplerData={pixelData:h.pixelData,width:h.width,height:h.height,minValue:h.minValue,maxValue:h.maxValue,noDataValue:h.noDataValue,safeWidth:.99999999*(h.width-1),dx:(h.width-1)/(a.extent[2]-a.extent[0]),dy:(h.width-1)/(a.extent[3]-
a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[a.samplerData.minValue,-3E38<a.samplerData.maxValue?a.samplerData.maxValue:0];return a};c.createFromFetchTileResult=function(a,b,h){a=new c(a[0],a[1],a[2],b);b=h.values;for(var f=h.noDataValue,q=Infinity,p=-Infinity,t=!0,w=0;w<b.length;w++){var u=b[w];u!==f&&(q=u<q?u:q,p=u>p?u:p,t=!1)}t&&(p=q=0);a.samplerData={pixelData:h.values,width:h.width,height:h.height,minValue:q,maxValue:p,noDataValue:f,safeWidth:.99999999*(h.width-1),dx:(h.width-1)/(a.extent[2]-
a.extent[0]),dy:(h.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[q,p];return a};return c}()})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("require exports ./TileAgentBase ./TerrainConst ./UpsampleInfo ../../webgl/Texture ../../vectorTiles/VectorTileDisplayObject".split(" "),function(B,r,f,a,b,c,t){return function(){function p(a){this.waitingAgents=[];this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=
this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(a)}p.prototype.init=function(b){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=null;this.pendingUpdates=0;b===a.LayerClass.ELEVATION&&(this.elevationBounds=null)};p.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this.upsampleFromTile&&
(b.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null)};p.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==f.AGENT_DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=null;this.tilemapRequest&&(this.tilemapRequest.cancel(),this.tilemapRequest=null);this.upsampleFromTile&&(b.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null);this.rawData=null;this.pendingUpdates=
0;this.disposeData()};p.prototype.disposeData=function(){var a=this.data;a&&(a instanceof c?a.dispose():a instanceof t&&a.dispose(),this.data=null)};p.makeEmptyLayerInfo=function(a,b){return b?(b.init(a),b):new p(a)};return p}()})},"esri/views/3d/terrain/TileAgentBase":function(){define(["require","exports","./UpsampleInfo","./tileUtils"],function(B,r,f,a){function b(a,c,h,l,q,r,z){if(!a.parent||6<z)return null;l*=.5;q*=.5;r*=.5;a.lij[2]&1&&(q+=.5);0===(a.lij[1]&1)&&(r+=.5);return a.parent.hasLayerData(c,
h)?(c=f.Pool.acquire(),c.init(a.parent,q,r,l),c):b(a.parent,c,h,l,q,r,z+1)}var c=Error("Abstract method called on TileAgentBase");return function(){function t(){}t.prototype.init=function(a,b,c,q){this.tile=a;this.layerIdx=b;this.layerClass=c;this.suspended=q;this._tileLayerInfo=a.getLayerInfo(b,c);this._dataRequested=null;(a=this._findAncestorWithData())?(this._setUpsamplingTile(a.tile),f.Pool.release(a)):(this._tileLayerInfo.upsampleFromTile&&f.Pool.release(this._tileLayerInfo.upsampleFromTile),
this._tileLayerInfo.upsampleFromTile=null);return this._requestNext(!0)};t.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null);this._tileLayerInfo=this.tile=null};t.prototype.setSuspension=function(a){a!==this.suspended&&((this.suspended=a)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};
t.prototype.update=function(){var a=this._findAncestorWithData();a&&this._tileLayerInfo.upsampleFromTile&&a.tile!==this._tileLayerInfo.upsampleFromTile.tile?this._setUpsamplingTile(a.tile):a&&f.Pool.release(a);return this._requestNext()};t.prototype.dataArrived=function(a){throw c;};t.prototype.dataMissing=function(a){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};t.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,this.layerClass);this.dispose()};
t.prototype._requestNext=function(a){void 0===a&&(a=!1);if(this.suspended)return!0;var b=this._findNextDownload();if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this);this._dataRequested=null}b?b.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=b):a||this._agentDone();return!!this._dataRequested};t.prototype._findNextDownload=function(){for(var b=this.layerIdx,c=this.layerClass,f=this.tile.parentSurface.layerViewByIndex(b,
c),q=f.minDataLevel,r=f.maxDataLevel,z=this._desiredMinLevelDelta(),w=t.START_LOADING_LEVEL_DELTA+z,u=this._scaleRangeEnabled,C,E=this.tile,G=0,n=E.lij[0],A=this._tileLayerInfo.upsampleFromTile?this._tileLayerInfo.upsampleFromTile.tile.lij[0]:-1,x=this.tile.parentSurface,I=x.tilemapStats,K=x.getTilemapTile(E),J=!1;E&&(!u||a.fallsWithinLayer(E,f.layer,!1))&&E.lij[0]>=q;){var B=E.layerInfo[c][b];if(B.data&&G>=z){E.lij[0]>A&&this._setUpsamplingTile(E);B.dataInvalidated&&(C=E);break}if(K&&!K.tileDataAvailable(E,
b,c))J=!0;else if(E.lij[0]<=r&&!B.data&&!B.dataMissing&&(C=E,G>=w))break;(E=E.parent)&&K&&(K=K.parent||x.getTilemapTile(E));G++}C&&n-C.lij[0]<z&&this._tileLayerInfo.upsampleFromTile&&(C=null);!C&&J&&I.tilesNotPresent++;return C};t.prototype._findAncestorWithData=function(){return b(this.tile,this.layerIdx,this.layerClass,1,0,0,0)};t.prototype._desiredMinLevelDelta=function(){throw c;};t.prototype._setUpsamplingTile=function(a){throw c;};t.prototype._unsetUpsamplingTile=function(){this._tileLayerInfo.upsampleFromTile&&
f.Pool.release(this._tileLayerInfo.upsampleFromTile);this._tileLayerInfo.upsampleFromTile=null};t.START_LOADING_LEVEL_DELTA=4;t.AGENT_DONE=new t;return t}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix/vec2 ../../core/libs/gl-matrix/mat4 ../../core/ObjectPool ../../geometry/support/spatialReferenceUtils ../webgl/BufferObject ../2d/engine/DisplayObject ../2d/tiling/TileKey ./RenderBucket".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q){return function(h){function r(){for(var c=[],f=0;f<arguments.length;f++)c[f]=arguments[f];f=h.call(this)||this;f._renderBuckets=[];f._vectorTileData=null;f._symbolUpdateData=null;f.status=5;f.coords=[0,0];f.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};f.stencilData={mask:0,reference:0};f.status=0;f.tileTransform.transform=b.create();f.tileTransform.displayCoord=a.create();0<c.length&&(l=f.acquire).call.apply(l,[f].concat(c));return f;var l}
f(r,h);r.prototype.reset=function(){l.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.height=this.width=this.coords[1]=0;this.resolution=null;this.rotation=0;this.id=this._connection=this.workerID=this._glyphsMosaic=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=null;this.status=0};r.prototype.acquire=
function(a,b,c,h,f,l){this.key=a;this.refKey=b;b=c.lodAt(a.level).resolution;var n=c.size[0]*b,q=c.origin,p=a.col*n,n=a.row*n,u=c.spatialReference,w=0;u&&(u._isWrappable?u._isWrappable():u.isWrappable)&&(w=t.getInfo(u),w=w.valid[1]-w.valid[0]);n=q.y-n;this.coords[0]=q.x+p+a.world*w;this.coords[1]=n;this.widthInPixels=c.size[1];this.coordRange=4096;this.resolution=b;this.rotation=l;this.styleLayers=h;this._glyphsMosaic=f;this.id=a.id;this.status=1};r.prototype.setData=function(a,b,c){this._vectorTileData=
a;this.workerID=b;this._connection=c;this.status=3};r.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};r.prototype.dispose=function(){this.polygonTrianglesVertexArrayObject&&(this.polygonTrianglesVertexArrayObject.dispose(),this.polygonTrianglesVertexArrayObject=null);this.polygonOutlineVertexArrayObject&&(this.polygonOutlineVertexArrayObject.dispose(),this.polygonOutlineVertexArrayObject=null);this.lineTrianglesVertexArrayObject&&(this.lineTrianglesVertexArrayObject.dispose(),
this.lineTrianglesVertexArrayObject=null);this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.polygonTrianglesVertexBuffer&&(this.polygonTrianglesVertexBuffer.dispose(),this.polygonTrianglesVertexBuffer=null);this.polygonTrianglesIndexBuffer&&(this.polygonTrianglesIndexBuffer.dispose(),this.polygonTrianglesIndexBuffer=null);this.polygonOutlinesVertexBuffer&&
(this.polygonOutlinesVertexBuffer.dispose(),this.polygonOutlinesVertexBuffer=null);this.polygonOutlinesIndexBuffer&&(this.polygonOutlinesIndexBuffer.dispose(),this.polygonOutlinesIndexBuffer=null);this.lineVertexBuffer&&(this.lineVertexBuffer.dispose(),this.lineVertexBuffer=null);this.lineTrianglesIndexBuffer&&(this.lineTrianglesIndexBuffer.dispose(),this.lineTrianglesIndexBuffer=null);this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),
this.iconIndexBuffer=null);this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);this._renderBuckets.length=0;this.status=7};r.prototype.attach=function(a){if(4===this.status)return!0;this.status=3;if(!this._vectorTileData)return!1;if(!this._vectorTileData.bufferDataInfo)return this.status=4,!0;if(0===this._renderBuckets.length)for(var b=
new Uint32Array(this._vectorTileData.bucketDataInfo),c=b.length,h=0;h<c;){var f=b[h],l=b[h+1];if(0===l)l=new q.BackgroundRenderBucket,l.layerID=f,this._renderBuckets.push(l),h+=2;else if(1===l)l=new q.FillRenderBucket,l.layerID=f,l.triangleElementStart=b[h+2],l.triangleElementCount=b[h+3],l.outlineElementStart=b[h+4],l.outlineElementCount=b[h+5],this._renderBuckets.push(l),h+=6;else if(2===l)l=new q.LineRenderBucket,l.layerID=f,l.triangleElementStart=b[h+2],l.triangleElementCount=b[h+3],this._renderBuckets.push(l),
h+=6;else if(3===l){l=new q.SymbolRenderBucket;l.layerID=f;l.isSDF=0!==b[h+2];var f=b[h+3],t=h+4;if(0<f)for(var t=h+4,w=void 0,r=void 0,y=void 0,z=0;z<f;z++)w=b[t],r=b[t+1],y=b[t+2],l.markerPerPageElementsMap.set(w,[r,y]),t+=3;var B=b[t];if(0<B)for(t++,y=r=w=void 0,z=0;z<B;z++)w=b[t],r=b[t+1],y=b[t+2],l.glyphPerPageElementsMap.set(w,[r,y]),t+=3;this._renderBuckets.push(l);h+=5+3*f+3*B}else console.error("Bad bucket type!")}a=a.context;b=new Uint32Array(this._vectorTileData.bufferDataInfo);c=b.length;
for(l=h=0;l<c;l+=2,h++)if(!(0>=b[l+1]||0===this._vectorTileData.bufferData[h].byteLength))switch(b[l]){case 2:this.polygonTrianglesVertexBuffer?this.polygonTrianglesVertexBuffer.setData(this._vectorTileData.bufferData[h]):this.polygonTrianglesVertexBuffer=p.createVertex(a,35044,this._vectorTileData.bufferData[h]);break;case 6:this.polygonTrianglesIndexBuffer?this.polygonTrianglesIndexBuffer.setData(this._vectorTileData.bufferData[h]):this.polygonTrianglesIndexBuffer=p.createIndex(a,35044,this._vectorTileData.bufferData[h]);
break;case 3:this.polygonOutlinesVertexBuffer?this.polygonOutlinesVertexBuffer.setData(this._vectorTileData.bufferData[h]):this.polygonOutlinesVertexBuffer=p.createVertex(a,35044,this._vectorTileData.bufferData[h]);break;case 7:this.polygonOutlinesIndexBuffer?this.polygonOutlinesIndexBuffer.setData(this._vectorTileData.bufferData[h]):this.polygonOutlinesIndexBuffer=p.createIndex(a,35044,this._vectorTileData.bufferData[h]);break;case 0:this.lineVertexBuffer?this.lineVertexBuffer.setData(this._vectorTileData.bufferData[h]):
this.lineVertexBuffer=p.createVertex(a,35044,this._vectorTileData.bufferData[h]);break;case 8:this.lineTrianglesIndexBuffer?this.lineTrianglesIndexBuffer.setData(this._vectorTileData.bufferData[h]):this.lineTrianglesIndexBuffer=p.createIndex(a,35044,this._vectorTileData.bufferData[h]);break;case 4:this.iconVertexBuffer?this.iconVertexBuffer.setData(this._vectorTileData.bufferData[h]):this.iconVertexBuffer=p.createVertex(a,35044,this._vectorTileData.bufferData[h]);break;case 9:this.iconIndexBuffer?
this.iconIndexBuffer.setData(this._vectorTileData.bufferData[h]):this.iconIndexBuffer=p.createIndex(a,35044,this._vectorTileData.bufferData[h]);break;case 5:this.textVertexBuffer?this.textVertexBuffer.setData(this._vectorTileData.bufferData[h]):this.textVertexBuffer=p.createVertex(a,35044,this._vectorTileData.bufferData[h]);break;case 10:this.textIndexBuffer?this.textIndexBuffer.setData(this._vectorTileData.bufferData[h]):this.textIndexBuffer=p.createIndex(a,35044,this._vectorTileData.bufferData[h])}this.status=
4;return!0};r.prototype.detach=function(a){-1!==this.workerID&&this._connection&&6!==this.status&&7!==this.status&&this._connection.broadcast("destructTileData",{key:this.id,worker:this.workerID},[]);this.dispose();h.prototype.detach.call(this,a)};r.prototype.doRender=function(a){if(this.visible&&4===this.status){var b=a.context,c=a.renderer;if(b&&c){var h=a.drawphase;this._symbolUpdateData&&this._updateSymbolData(a);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var f=
this.styleLayers,l=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==l){var q,p=this._renderBuckets.length,t=0;if(0===h)for(t=p-1;0<=t;t--)q=this._renderBuckets[t],3!==q.type&&q.hasData()&&c.renderBucket(b,q,a.displayLevel,a.requiredLevel,h,this,f.layers[q.layerID],l);else for(t=0;t<p;t++)q=this._renderBuckets[t],q.hasData()&&c.renderBucket(b,q,a.displayLevel,a.requiredLevel,h,this,f.layers[q.layerID],l)}}}};r.prototype._updateSymbolData=function(a){var b=new Uint32Array(this._symbolUpdateData.bucketDataInfo),
c=b.length;if(0===c)return this._symbolUpdateData=null,!0;if(1>a.budget.remaining||4!==this.status)return this.requestRender(),!1;a=a.context;for(var h=new Uint32Array(this._symbolUpdateData.bufferDataInfo),f=h.length,l=0,t=0;t<f;t+=2,l++)switch(h[t]){case 4:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=p.createVertex(a,35044,this._symbolUpdateData.bufferData[l]);break;case 9:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=
null);this.iconIndexBuffer=p.createIndex(a,35044,this._symbolUpdateData.bufferData[l]);break;case 5:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=p.createVertex(a,35044,this._symbolUpdateData.bufferData[l]);break;case 10:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=p.createIndex(a,35044,this._symbolUpdateData.bufferData[l])}a=this._renderBuckets.length;for(h=0;h<a;h++)this._renderBuckets[h]instanceof
q.SymbolRenderBucket&&(f=this._renderBuckets[h],f.markerPerPageElementsMap.clear(),f.glyphPerPageElementsMap.clear());for(a=0;a<c;){f=b[a];l=-1;t=this._renderBuckets.length;for(h=0;h<t;h++)if(this._renderBuckets[h].layerID===f){l=h;break}h=this._renderBuckets[l];h||(h=new q.SymbolRenderBucket,h.layerID=f,h.isSDF=0!==b[a+2],this._renderBuckets.push(h));var f=b[a+3],w=a+4;if(0<f)for(var w=a+4,r=t=l=void 0,y=0;y<f;y++)l=b[w],t=b[w+1],r=b[w+2],h.markerPerPageElementsMap.set(l,[t,r]),w+=3;var z=b[w];if(0<
z)for(w++,r=t=l=void 0,y=0;y<z;y++)l=b[w],t=b[w+1],r=b[w+2],h.glyphPerPageElementsMap.set(l,[t,r]),w+=3;a+=5+3*f+3*z}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this._symbolUpdateData=null;return!0};r.pool=new c(r);return r}(h)})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(B){var r={create:function(){var f=new B.ARRAY_TYPE(2);
f[0]=0;f[1]=0;return f},clone:function(f){var a=new B.ARRAY_TYPE(2);a[0]=f[0];a[1]=f[1];return a},fromValues:function(f,a){var b=new B.ARRAY_TYPE(2);b[0]=f;b[1]=a;return b},copy:function(f,a){f[0]=a[0];f[1]=a[1];return f},set:function(f,a,b){f[0]=a;f[1]=b;return f},add:function(f,a,b){f[0]=a[0]+b[0];f[1]=a[1]+b[1];return f},subtract:function(f,a,b){f[0]=a[0]-b[0];f[1]=a[1]-b[1];return f}};r.sub=r.subtract;r.multiply=function(f,a,b){f[0]=a[0]*b[0];f[1]=a[1]*b[1];return f};r.mul=r.multiply;r.divide=
function(f,a,b){f[0]=a[0]/b[0];f[1]=a[1]/b[1];return f};r.div=r.divide;r.ceil=function(f,a){f[0]=Math.ceil(a[0]);f[1]=Math.ceil(a[1]);return f};r.floor=function(f,a){f[0]=Math.floor(a[0]);f[1]=Math.floor(a[1]);return f};r.min=function(f,a,b){f[0]=Math.min(a[0],b[0]);f[1]=Math.min(a[1],b[1]);return f};r.max=function(f,a,b){f[0]=Math.max(a[0],b[0]);f[1]=Math.max(a[1],b[1]);return f};r.round=function(f,a){f[0]=Math.round(a[0]);f[1]=Math.round(a[1]);return f};r.scale=function(f,a,b){f[0]=a[0]*b;f[1]=
a[1]*b;return f};r.scaleAndAdd=function(f,a,b,c){f[0]=a[0]+b[0]*c;f[1]=a[1]+b[1]*c;return f};r.distance=function(f,a){var b=a[0]-f[0];f=a[1]-f[1];return Math.sqrt(b*b+f*f)};r.dist=r.distance;r.squaredDistance=function(f,a){var b=a[0]-f[0];f=a[1]-f[1];return b*b+f*f};r.sqrDist=r.squaredDistance;r.length=function(f){var a=f[0];f=f[1];return Math.sqrt(a*a+f*f)};r.len=r.length;r.squaredLength=function(f){var a=f[0];f=f[1];return a*a+f*f};r.sqrLen=r.squaredLength;r.negate=function(f,a){f[0]=-a[0];f[1]=
-a[1];return f};r.inverse=function(f,a){f[0]=1/a[0];f[1]=1/a[1];return f};r.normalize=function(f,a){var b=a[0],c=a[1],b=b*b+c*c;0<b&&(b=1/Math.sqrt(b),f[0]=a[0]*b,f[1]=a[1]*b);return f};r.dot=function(f,a){return f[0]*a[0]+f[1]*a[1]};r.cross=function(f,a,b){a=a[0]*b[1]-a[1]*b[0];f[0]=f[1]=0;f[2]=a;return f};r.lerp=function(f,a,b,c){var t=a[0];a=a[1];f[0]=t+c*(b[0]-t);f[1]=a+c*(b[1]-a);return f};r.random=function(f,a){a=a||1;var b=2*B.RANDOM()*Math.PI;f[0]=Math.cos(b)*a;f[1]=Math.sin(b)*a;return f};
r.transformMat2=function(f,a,b){var c=a[0];a=a[1];f[0]=b[0]*c+b[2]*a;f[1]=b[1]*c+b[3]*a;return f};r.transformMat2d=function(f,a,b){var c=a[0];a=a[1];f[0]=b[0]*c+b[2]*a+b[4];f[1]=b[1]*c+b[3]*a+b[5];return f};r.transformMat3=function(f,a,b){var c=a[0];a=a[1];f[0]=b[0]*c+b[3]*a+b[6];f[1]=b[1]*c+b[4]*a+b[7];return f};r.transformMat4=function(f,a,b){var c=a[0];a=a[1];f[0]=b[0]*c+b[4]*a+b[12];f[1]=b[1]*c+b[5]*a+b[13];return f};r.forEach=function(){var f=r.create();return function(a,b,c,t,p,h){b||(b=2);
c||(c=0);for(t=t?Math.min(t*b+c,a.length):a.length;c<t;c+=b)f[0]=a[c],f[1]=a[c+1],p(f,f,h),a[c]=f[0],a[c+1]=f[1];return a}}();r.str=function(f){return"vec2("+f[0]+", "+f[1]+")"};r.exactEquals=function(f,a){return f[0]===a[0]&&f[1]===a[1]};r.equals=function(f,a){var b=f[0];f=f[1];var c=a[0];a=a[1];return Math.abs(b-c)<=B.EPSILON*Math.max(1,Math.abs(b),Math.abs(c))&&Math.abs(f-a)<=B.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return r})},"esri/core/libs/gl-matrix/common":function(){define([],function(){var B=
{EPSILON:1E-6};B.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;B.RANDOM=Math.random;B.ENABLE_SIMD=!1;B.SIMD_AVAILABLE=B.ARRAY_TYPE===Float32Array&&"SIMD"in this;B.USE_SIMD=B.ENABLE_SIMD&&B.SIMD_AVAILABLE;B.setMatrixArrayType=function(f){B.ARRAY_TYPE=f};var r=Math.PI/180;B.toRadian=function(f){return f*r};B.equals=function(f,a){return Math.abs(f-a)<=B.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return B})},"esri/core/libs/gl-matrix/mat4":function(){define(["./common"],function(B){var r=
{scalar:{},SIMD:{},create:function(){var f=new B.ARRAY_TYPE(16);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f},clone:function(f){var a=new B.ARRAY_TYPE(16);a[0]=f[0];a[1]=f[1];a[2]=f[2];a[3]=f[3];a[4]=f[4];a[5]=f[5];a[6]=f[6];a[7]=f[7];a[8]=f[8];a[9]=f[9];a[10]=f[10];a[11]=f[11];a[12]=f[12];a[13]=f[13];a[14]=f[14];a[15]=f[15];return a},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];f[4]=a[4];f[5]=a[5];f[6]=
a[6];f[7]=a[7];f[8]=a[8];f[9]=a[9];f[10]=a[10];f[11]=a[11];f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f},fromValues:function(f,a,b,c,t,p,h,l,q,r,z,w,u,C,E,G){var n=new B.ARRAY_TYPE(16);n[0]=f;n[1]=a;n[2]=b;n[3]=c;n[4]=t;n[5]=p;n[6]=h;n[7]=l;n[8]=q;n[9]=r;n[10]=z;n[11]=w;n[12]=u;n[13]=C;n[14]=E;n[15]=G;return n},set:function(f,a,b,c,t,p,h,l,q,r,z,w,u,C,E,G,n){f[0]=a;f[1]=b;f[2]=c;f[3]=t;f[4]=p;f[5]=h;f[6]=l;f[7]=q;f[8]=r;f[9]=z;f[10]=w;f[11]=u;f[12]=C;f[13]=E;f[14]=G;f[15]=n;return f},
identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f}};r.scalar.transpose=function(f,a){if(f===a){var b=a[1],c=a[2],t=a[3],p=a[6],h=a[7],l=a[11];f[1]=a[4];f[2]=a[8];f[3]=a[12];f[4]=b;f[6]=a[9];f[7]=a[13];f[8]=c;f[9]=p;f[11]=a[14];f[12]=t;f[13]=h;f[14]=l}else f[0]=a[0],f[1]=a[4],f[2]=a[8],f[3]=a[12],f[4]=a[1],f[5]=a[5],f[6]=a[9],f[7]=a[13],f[8]=a[2],f[9]=a[6],f[10]=a[10],f[11]=a[14],f[12]=a[3],f[13]=a[7],
f[14]=a[11],f[15]=a[15];return f};r.SIMD.transpose=function(f,a){var b,c,t,p,h,l;b=SIMD.Float32x4.load(a,0);c=SIMD.Float32x4.load(a,4);t=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);p=SIMD.Float32x4.shuffle(b,c,0,1,4,5);h=SIMD.Float32x4.shuffle(t,a,0,1,4,5);l=SIMD.Float32x4.shuffle(p,h,0,2,4,6);p=SIMD.Float32x4.shuffle(p,h,1,3,5,7);SIMD.Float32x4.store(f,0,l);SIMD.Float32x4.store(f,4,p);p=SIMD.Float32x4.shuffle(b,c,2,3,6,7);h=SIMD.Float32x4.shuffle(t,a,2,3,6,7);b=SIMD.Float32x4.shuffle(p,
h,0,2,4,6);c=SIMD.Float32x4.shuffle(p,h,1,3,5,7);SIMD.Float32x4.store(f,8,b);SIMD.Float32x4.store(f,12,c);return f};r.transpose=B.USE_SIMD?r.SIMD.transpose:r.scalar.transpose;r.scalar.invert=function(f,a){var b=a[0],c=a[1],t=a[2],p=a[3],h=a[4],l=a[5],q=a[6],r=a[7],z=a[8],w=a[9],u=a[10],C=a[11],E=a[12],G=a[13],n=a[14];a=a[15];var A=b*l-c*h,x=b*q-t*h,I=b*r-p*h,K=c*q-t*l,J=c*r-p*l,B=t*r-p*q,M=z*G-w*E,Q=z*n-u*E,S=z*a-C*E,P=w*n-u*G,O=w*a-C*G,T=u*a-C*n,U=A*T-x*O+I*P+K*S-J*Q+B*M;if(!U)return null;U=1/U;
f[0]=(l*T-q*O+r*P)*U;f[1]=(t*O-c*T-p*P)*U;f[2]=(G*B-n*J+a*K)*U;f[3]=(u*J-w*B-C*K)*U;f[4]=(q*S-h*T-r*Q)*U;f[5]=(b*T-t*S+p*Q)*U;f[6]=(n*I-E*B-a*x)*U;f[7]=(z*B-u*I+C*x)*U;f[8]=(h*O-l*S+r*M)*U;f[9]=(c*S-b*O-p*M)*U;f[10]=(E*J-G*I+a*A)*U;f[11]=(w*I-z*J-C*A)*U;f[12]=(l*Q-h*P-q*M)*U;f[13]=(b*P-c*Q+t*M)*U;f[14]=(G*x-E*K-n*A)*U;f[15]=(z*K-w*x+u*A)*U;return f};r.SIMD.invert=function(f,a){var b,c,t,p,h,l,q,r;h=SIMD.Float32x4.load(a,0);l=SIMD.Float32x4.load(a,4);q=SIMD.Float32x4.load(a,8);r=SIMD.Float32x4.load(a,
12);a=SIMD.Float32x4.shuffle(h,l,0,1,4,5);c=SIMD.Float32x4.shuffle(q,r,0,1,4,5);b=SIMD.Float32x4.shuffle(a,c,0,2,4,6);c=SIMD.Float32x4.shuffle(c,a,1,3,5,7);a=SIMD.Float32x4.shuffle(h,l,2,3,6,7);p=SIMD.Float32x4.shuffle(q,r,2,3,6,7);t=SIMD.Float32x4.shuffle(a,p,0,2,4,6);p=SIMD.Float32x4.shuffle(p,a,1,3,5,7);a=SIMD.Float32x4.mul(t,p);a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.mul(c,a);l=SIMD.Float32x4.mul(b,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,a),
h);l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,a),l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);a=SIMD.Float32x4.mul(c,t);a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(p,a),h);r=SIMD.Float32x4.mul(b,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(p,a));r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,a),r);r=SIMD.Float32x4.swizzle(r,2,3,0,1);a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,3,0,1),p);a=SIMD.Float32x4.swizzle(a,1,0,3,2);t=SIMD.Float32x4.swizzle(t,
2,3,0,1);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(t,a),h);q=SIMD.Float32x4.mul(b,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(t,a));q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,a),q);q=SIMD.Float32x4.swizzle(q,2,3,0,1);a=SIMD.Float32x4.mul(b,c);a=SIMD.Float32x4.swizzle(a,1,0,3,2);q=SIMD.Float32x4.add(SIMD.Float32x4.mul(p,a),q);r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(t,a),r);a=SIMD.Float32x4.swizzle(a,2,3,0,1);q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(p,a),q);r=SIMD.Float32x4.sub(r,
SIMD.Float32x4.mul(t,a));a=SIMD.Float32x4.mul(b,p);a=SIMD.Float32x4.swizzle(a,1,0,3,2);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(t,a));q=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,a),q);a=SIMD.Float32x4.swizzle(a,2,3,0,1);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(t,a),l);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(c,a));a=SIMD.Float32x4.mul(b,t);a=SIMD.Float32x4.swizzle(a,1,0,3,2);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(p,a),l);r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(c,a));a=SIMD.Float32x4.swizzle(a,2,
3,0,1);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(p,a));r=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,a),r);b=SIMD.Float32x4.mul(b,h);b=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(b,2,3,0,1),b);b=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(b,1,0,3,2),b);a=SIMD.Float32x4.reciprocalApproximation(b);b=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(b,SIMD.Float32x4.mul(a,a)));b=SIMD.Float32x4.swizzle(b,0,0,0,0);if(!b)return null;SIMD.Float32x4.store(f,0,SIMD.Float32x4.mul(b,h));SIMD.Float32x4.store(f,
4,SIMD.Float32x4.mul(b,l));SIMD.Float32x4.store(f,8,SIMD.Float32x4.mul(b,q));SIMD.Float32x4.store(f,12,SIMD.Float32x4.mul(b,r));return f};r.invert=B.USE_SIMD?r.SIMD.invert:r.scalar.invert;r.scalar.adjoint=function(f,a){var b=a[0],c=a[1],t=a[2],p=a[3],h=a[4],l=a[5],q=a[6],r=a[7],z=a[8],w=a[9],u=a[10],C=a[11],E=a[12],G=a[13],n=a[14];a=a[15];f[0]=l*(u*a-C*n)-w*(q*a-r*n)+G*(q*C-r*u);f[1]=-(c*(u*a-C*n)-w*(t*a-p*n)+G*(t*C-p*u));f[2]=c*(q*a-r*n)-l*(t*a-p*n)+G*(t*r-p*q);f[3]=-(c*(q*C-r*u)-l*(t*C-p*u)+w*(t*
r-p*q));f[4]=-(h*(u*a-C*n)-z*(q*a-r*n)+E*(q*C-r*u));f[5]=b*(u*a-C*n)-z*(t*a-p*n)+E*(t*C-p*u);f[6]=-(b*(q*a-r*n)-h*(t*a-p*n)+E*(t*r-p*q));f[7]=b*(q*C-r*u)-h*(t*C-p*u)+z*(t*r-p*q);f[8]=h*(w*a-C*G)-z*(l*a-r*G)+E*(l*C-r*w);f[9]=-(b*(w*a-C*G)-z*(c*a-p*G)+E*(c*C-p*w));f[10]=b*(l*a-r*G)-h*(c*a-p*G)+E*(c*r-p*l);f[11]=-(b*(l*C-r*w)-h*(c*C-p*w)+z*(c*r-p*l));f[12]=-(h*(w*n-u*G)-z*(l*n-q*G)+E*(l*u-q*w));f[13]=b*(w*n-u*G)-z*(c*n-t*G)+E*(c*u-t*w);f[14]=-(b*(l*n-q*G)-h*(c*n-t*G)+E*(c*q-t*l));f[15]=b*(l*u-q*w)-h*
(c*u-t*w)+z*(c*q-t*l);return f};r.SIMD.adjoint=function(f,a){var b,c,t,p,h,l,q,r;b=SIMD.Float32x4.load(a,0);c=SIMD.Float32x4.load(a,4);t=SIMD.Float32x4.load(a,8);p=SIMD.Float32x4.load(a,12);l=SIMD.Float32x4.shuffle(b,c,0,1,4,5);h=SIMD.Float32x4.shuffle(t,p,0,1,4,5);a=SIMD.Float32x4.shuffle(l,h,0,2,4,6);h=SIMD.Float32x4.shuffle(h,l,1,3,5,7);l=SIMD.Float32x4.shuffle(b,c,2,3,6,7);c=SIMD.Float32x4.shuffle(t,p,2,3,6,7);b=SIMD.Float32x4.shuffle(l,c,0,2,4,6);c=SIMD.Float32x4.shuffle(c,l,1,3,5,7);l=SIMD.Float32x4.mul(b,
c);l=SIMD.Float32x4.swizzle(l,1,0,3,2);t=SIMD.Float32x4.mul(h,l);p=SIMD.Float32x4.mul(a,l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);t=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,l),t);p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,l),p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);l=SIMD.Float32x4.mul(h,b);l=SIMD.Float32x4.swizzle(l,1,0,3,2);t=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,l),t);r=SIMD.Float32x4.mul(a,l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);t=SIMD.Float32x4.sub(t,SIMD.Float32x4.mul(c,l));r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,
l),r);r=SIMD.Float32x4.swizzle(r,2,3,0,1);l=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,3,0,1),c);l=SIMD.Float32x4.swizzle(l,1,0,3,2);b=SIMD.Float32x4.swizzle(b,2,3,0,1);t=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,l),t);q=SIMD.Float32x4.mul(a,l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);t=SIMD.Float32x4.sub(t,SIMD.Float32x4.mul(b,l));q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,l),q);q=SIMD.Float32x4.swizzle(q,2,3,0,1);l=SIMD.Float32x4.mul(a,h);l=SIMD.Float32x4.swizzle(l,1,0,3,2);q=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,
l),q);r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,l),r);l=SIMD.Float32x4.swizzle(l,2,3,0,1);q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,l),q);r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(b,l));l=SIMD.Float32x4.mul(a,c);l=SIMD.Float32x4.swizzle(l,1,0,3,2);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(b,l));q=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,l),q);l=SIMD.Float32x4.swizzle(l,2,3,0,1);p=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,l),p);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(h,l));l=SIMD.Float32x4.mul(a,b);
l=SIMD.Float32x4.swizzle(l,1,0,3,2);p=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,l),p);r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(h,l));l=SIMD.Float32x4.swizzle(l,2,3,0,1);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(c,l));r=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,l),r);SIMD.Float32x4.store(f,0,t);SIMD.Float32x4.store(f,4,p);SIMD.Float32x4.store(f,8,q);SIMD.Float32x4.store(f,12,r);return f};r.adjoint=B.USE_SIMD?r.SIMD.adjoint:r.scalar.adjoint;r.determinant=function(f){var a=f[0],b=f[1],c=f[2],t=f[3],p=f[4],
h=f[5],l=f[6],q=f[7],r=f[8],z=f[9],w=f[10],u=f[11],C=f[12],E=f[13],G=f[14];f=f[15];return(a*h-b*p)*(w*f-u*G)-(a*l-c*p)*(z*f-u*E)+(a*q-t*p)*(z*G-w*E)+(b*l-c*h)*(r*f-u*C)-(b*q-t*h)*(r*G-w*C)+(c*q-t*l)*(r*E-z*C)};r.SIMD.multiply=function(f,a,b){var c=SIMD.Float32x4.load(a,0),t=SIMD.Float32x4.load(a,4),p=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);var h=SIMD.Float32x4.load(b,0),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),c),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,
1,1,1,1),t),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),p),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),a))));SIMD.Float32x4.store(f,0,h);h=SIMD.Float32x4.load(b,4);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),c),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),t),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),p),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),a))));SIMD.Float32x4.store(f,
4,h);h=SIMD.Float32x4.load(b,8);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),c),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),t),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),p),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),a))));SIMD.Float32x4.store(f,8,h);b=SIMD.Float32x4.load(b,12);c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,0,0,0,0),c),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,
1,1,1,1),t),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,2,2,2),p),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,3,3,3,3),a))));SIMD.Float32x4.store(f,12,c);return f};r.scalar.multiply=function(f,a,b){var c=a[0],t=a[1],p=a[2],h=a[3],l=a[4],q=a[5],r=a[6],z=a[7],w=a[8],u=a[9],C=a[10],E=a[11],G=a[12],n=a[13],A=a[14];a=a[15];var x=b[0],I=b[1],K=b[2],J=b[3];f[0]=x*c+I*l+K*w+J*G;f[1]=x*t+I*q+K*u+J*n;f[2]=x*p+I*r+K*C+J*A;f[3]=x*h+I*z+K*E+J*a;x=b[4];I=b[5];K=b[6];J=b[7];f[4]=x*c+I*l+K*w+
J*G;f[5]=x*t+I*q+K*u+J*n;f[6]=x*p+I*r+K*C+J*A;f[7]=x*h+I*z+K*E+J*a;x=b[8];I=b[9];K=b[10];J=b[11];f[8]=x*c+I*l+K*w+J*G;f[9]=x*t+I*q+K*u+J*n;f[10]=x*p+I*r+K*C+J*A;f[11]=x*h+I*z+K*E+J*a;x=b[12];I=b[13];K=b[14];J=b[15];f[12]=x*c+I*l+K*w+J*G;f[13]=x*t+I*q+K*u+J*n;f[14]=x*p+I*r+K*C+J*A;f[15]=x*h+I*z+K*E+J*a;return f};r.multiply=B.USE_SIMD?r.SIMD.multiply:r.scalar.multiply;r.mul=r.multiply;r.scalar.translate=function(f,a,b){var c=b[0],t=b[1];b=b[2];var p,h,l,q,r,z,w,u,C,E,G,n;a===f?(f[12]=a[0]*c+a[4]*t+
a[8]*b+a[12],f[13]=a[1]*c+a[5]*t+a[9]*b+a[13],f[14]=a[2]*c+a[6]*t+a[10]*b+a[14],f[15]=a[3]*c+a[7]*t+a[11]*b+a[15]):(p=a[0],h=a[1],l=a[2],q=a[3],r=a[4],z=a[5],w=a[6],u=a[7],C=a[8],E=a[9],G=a[10],n=a[11],f[0]=p,f[1]=h,f[2]=l,f[3]=q,f[4]=r,f[5]=z,f[6]=w,f[7]=u,f[8]=C,f[9]=E,f[10]=G,f[11]=n,f[12]=p*c+r*t+C*b+a[12],f[13]=h*c+z*t+E*b+a[13],f[14]=l*c+w*t+G*b+a[14],f[15]=q*c+u*t+n*b+a[15]);return f};r.SIMD.translate=function(f,a,b){var c=SIMD.Float32x4.load(a,0),t=SIMD.Float32x4.load(a,4),p=SIMD.Float32x4.load(a,
8),h=SIMD.Float32x4.load(a,12);b=SIMD.Float32x4(b[0],b[1],b[2],0);a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11]);c=SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(b,0,0,0,0));t=SIMD.Float32x4.mul(t,SIMD.Float32x4.swizzle(b,1,1,1,1));p=SIMD.Float32x4.mul(p,SIMD.Float32x4.swizzle(b,2,2,2,2));a=SIMD.Float32x4.add(c,SIMD.Float32x4.add(t,SIMD.Float32x4.add(p,h)));SIMD.Float32x4.store(f,12,a);return f};r.translate=B.USE_SIMD?
r.SIMD.translate:r.scalar.translate;r.scalar.scale=function(f,a,b){var c=b[0],t=b[1];b=b[2];f[0]=a[0]*c;f[1]=a[1]*c;f[2]=a[2]*c;f[3]=a[3]*c;f[4]=a[4]*t;f[5]=a[5]*t;f[6]=a[6]*t;f[7]=a[7]*t;f[8]=a[8]*b;f[9]=a[9]*b;f[10]=a[10]*b;f[11]=a[11]*b;f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};r.SIMD.scale=function(f,a,b){var c;b=SIMD.Float32x4(b[0],b[1],b[2],0);c=SIMD.Float32x4.load(a,0);SIMD.Float32x4.store(f,0,SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(b,0,0,0,0)));c=SIMD.Float32x4.load(a,
4);SIMD.Float32x4.store(f,4,SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(b,1,1,1,1)));c=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(f,8,SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(b,2,2,2,2)));f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};r.scale=B.USE_SIMD?r.SIMD.scale:r.scalar.scale;r.rotate=function(f,a,b,c){var t=c[0],p=c[1];c=c[2];var h=Math.sqrt(t*t+p*p+c*c),l,q,r,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q,S,P;if(Math.abs(h)<B.EPSILON)return null;h=1/h;t*=h;p*=h;c*=h;l=Math.sin(b);q=Math.cos(b);
r=1-q;b=a[0];h=a[1];z=a[2];w=a[3];u=a[4];C=a[5];E=a[6];G=a[7];n=a[8];A=a[9];x=a[10];I=a[11];K=t*t*r+q;J=p*t*r+c*l;N=c*t*r-p*l;M=t*p*r-c*l;Q=p*p*r+q;S=c*p*r+t*l;P=t*c*r+p*l;t=p*c*r-t*l;p=c*c*r+q;f[0]=b*K+u*J+n*N;f[1]=h*K+C*J+A*N;f[2]=z*K+E*J+x*N;f[3]=w*K+G*J+I*N;f[4]=b*M+u*Q+n*S;f[5]=h*M+C*Q+A*S;f[6]=z*M+E*Q+x*S;f[7]=w*M+G*Q+I*S;f[8]=b*P+u*t+n*p;f[9]=h*P+C*t+A*p;f[10]=z*P+E*t+x*p;f[11]=w*P+G*t+I*p;a!==f&&(f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);return f};r.scalar.rotateX=function(f,a,b){var c=
Math.sin(b);b=Math.cos(b);var t=a[4],p=a[5],h=a[6],l=a[7],q=a[8],r=a[9],z=a[10],w=a[11];a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[4]=t*b+q*c;f[5]=p*b+r*c;f[6]=h*b+z*c;f[7]=l*b+w*c;f[8]=q*b-t*c;f[9]=r*b-p*c;f[10]=z*b-h*c;f[11]=w*b-l*c;return f};r.SIMD.rotateX=function(f,a,b){var c=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);
var t=SIMD.Float32x4.load(a,4);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(f,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(t,b),SIMD.Float32x4.mul(a,c)));SIMD.Float32x4.store(f,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,b),SIMD.Float32x4.mul(t,c)));return f};r.rotateX=B.USE_SIMD?r.SIMD.rotateX:r.scalar.rotateX;r.scalar.rotateY=function(f,a,b){var c=Math.sin(b);b=Math.cos(b);var t=a[0],p=a[1],h=a[2],l=a[3],q=a[8],r=a[9],z=a[10],w=a[11];a!==f&&(f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[12]=a[12],f[13]=
a[13],f[14]=a[14],f[15]=a[15]);f[0]=t*b-q*c;f[1]=p*b-r*c;f[2]=h*b-z*c;f[3]=l*b-w*c;f[8]=t*c+q*b;f[9]=p*c+r*b;f[10]=h*c+z*b;f[11]=l*c+w*b;return f};r.SIMD.rotateY=function(f,a,b){var c=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));a!==f&&(f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);var t=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(f,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(t,b),SIMD.Float32x4.mul(a,c)));
SIMD.Float32x4.store(f,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(t,c),SIMD.Float32x4.mul(a,b)));return f};r.rotateY=B.USE_SIMD?r.SIMD.rotateY:r.scalar.rotateY;r.scalar.rotateZ=function(f,a,b){var c=Math.sin(b);b=Math.cos(b);var t=a[0],p=a[1],h=a[2],l=a[3],q=a[4],r=a[5],z=a[6],w=a[7];a!==f&&(f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[0]=t*b+q*c;f[1]=p*b+r*c;f[2]=h*b+z*c;f[3]=l*b+w*c;f[4]=q*b-t*c;f[5]=r*b-p*c;f[6]=z*b-h*c;f[7]=w*b-l*c;return f};r.SIMD.rotateZ=
function(f,a,b){var c=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));a!==f&&(f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);var t=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(f,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(t,b),SIMD.Float32x4.mul(a,c)));SIMD.Float32x4.store(f,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,b),SIMD.Float32x4.mul(t,c)));return f};r.rotateZ=B.USE_SIMD?r.SIMD.rotateZ:r.scalar.rotateZ;
r.fromTranslation=function(f,a){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=a[0];f[13]=a[1];f[14]=a[2];f[15]=1;return f};r.fromScaling=function(f,a){f[0]=a[0];f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a[1];f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=a[2];f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};r.fromRotation=function(f,a,b){var c=b[0],t=b[1];b=b[2];var p=Math.sqrt(c*c+t*t+b*b),h;if(Math.abs(p)<B.EPSILON)return null;p=1/p;c*=p;t*=p;b*=p;p=Math.sin(a);a=Math.cos(a);
h=1-a;f[0]=c*c*h+a;f[1]=t*c*h+b*p;f[2]=b*c*h-t*p;f[3]=0;f[4]=c*t*h-b*p;f[5]=t*t*h+a;f[6]=b*t*h+c*p;f[7]=0;f[8]=c*b*h+t*p;f[9]=t*b*h-c*p;f[10]=b*b*h+a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};r.fromXRotation=function(f,a){var b=Math.sin(a);a=Math.cos(a);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=b;f[7]=0;f[8]=0;f[9]=-b;f[10]=a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};r.fromYRotation=function(f,a){var b=Math.sin(a);a=Math.cos(a);f[0]=a;f[1]=0;f[2]=-b;f[3]=0;f[4]=0;f[5]=1;f[6]=
0;f[7]=0;f[8]=b;f[9]=0;f[10]=a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};r.fromZRotation=function(f,a){var b=Math.sin(a);a=Math.cos(a);f[0]=a;f[1]=b;f[2]=0;f[3]=0;f[4]=-b;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};r.fromRotationTranslation=function(f,a,b){var c=a[0],t=a[1],p=a[2],h=a[3],l=c+c,q=t+t,r=p+p;a=c*l;var z=c*q,c=c*r,w=t*q,t=t*r,p=p*r,l=h*l,q=h*q,h=h*r;f[0]=1-(w+p);f[1]=z+h;f[2]=c-q;f[3]=0;f[4]=z-h;f[5]=1-(a+p);f[6]=t+l;f[7]=0;f[8]=
c+q;f[9]=t-l;f[10]=1-(a+w);f[11]=0;f[12]=b[0];f[13]=b[1];f[14]=b[2];f[15]=1;return f};r.getTranslation=function(f,a){f[0]=a[12];f[1]=a[13];f[2]=a[14];return f};r.getRotation=function(f,a){var b=a[0]+a[5]+a[10],c=0;0<b?(c=2*Math.sqrt(b+1),f[3]=.25*c,f[0]=(a[6]-a[9])/c,f[1]=(a[8]-a[2])/c,f[2]=(a[1]-a[4])/c):a[0]>a[5]&a[0]>a[10]?(c=2*Math.sqrt(1+a[0]-a[5]-a[10]),f[3]=(a[6]-a[9])/c,f[0]=.25*c,f[1]=(a[1]+a[4])/c,f[2]=(a[8]+a[2])/c):a[5]>a[10]?(c=2*Math.sqrt(1+a[5]-a[0]-a[10]),f[3]=(a[8]-a[2])/c,f[0]=(a[1]+
a[4])/c,f[1]=.25*c,f[2]=(a[6]+a[9])/c):(c=2*Math.sqrt(1+a[10]-a[0]-a[5]),f[3]=(a[1]-a[4])/c,f[0]=(a[8]+a[2])/c,f[1]=(a[6]+a[9])/c,f[2]=.25*c);return f};r.fromRotationTranslationScale=function(f,a,b,c){var t=a[0],p=a[1],h=a[2],l=a[3],q=t+t,r=p+p,z=h+h;a=t*q;var w=t*r,t=t*z,u=p*r,p=p*z,h=h*z,q=l*q,r=l*r,l=l*z,z=c[0],C=c[1];c=c[2];f[0]=(1-(u+h))*z;f[1]=(w+l)*z;f[2]=(t-r)*z;f[3]=0;f[4]=(w-l)*C;f[5]=(1-(a+h))*C;f[6]=(p+q)*C;f[7]=0;f[8]=(t+r)*c;f[9]=(p-q)*c;f[10]=(1-(a+u))*c;f[11]=0;f[12]=b[0];f[13]=b[1];
f[14]=b[2];f[15]=1;return f};r.fromRotationTranslationScaleOrigin=function(f,a,b,c,t){var p=a[0],h=a[1],l=a[2],q=a[3],r=p+p,z=h+h,w=l+l;a=p*r;var u=p*z,p=p*w,C=h*z,h=h*w,l=l*w,r=q*r,z=q*z,q=q*w,w=c[0],E=c[1];c=c[2];var G=t[0],n=t[1];t=t[2];f[0]=(1-(C+l))*w;f[1]=(u+q)*w;f[2]=(p-z)*w;f[3]=0;f[4]=(u-q)*E;f[5]=(1-(a+l))*E;f[6]=(h+r)*E;f[7]=0;f[8]=(p+z)*c;f[9]=(h-r)*c;f[10]=(1-(a+C))*c;f[11]=0;f[12]=b[0]+G-(f[0]*G+f[4]*n+f[8]*t);f[13]=b[1]+n-(f[1]*G+f[5]*n+f[9]*t);f[14]=b[2]+t-(f[2]*G+f[6]*n+f[10]*t);
f[15]=1;return f};r.fromQuat=function(f,a){var b=a[0],c=a[1],t=a[2];a=a[3];var p=b+b,h=c+c,l=t+t,b=b*p,q=c*p,c=c*h,r=t*p,z=t*h,t=t*l,p=a*p,h=a*h;a*=l;f[0]=1-c-t;f[1]=q+a;f[2]=r-h;f[3]=0;f[4]=q-a;f[5]=1-b-t;f[6]=z+p;f[7]=0;f[8]=r+h;f[9]=z-p;f[10]=1-b-c;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};r.frustum=function(f,a,b,c,t,p,h){var l=1/(b-a),q=1/(t-c),r=1/(p-h);f[0]=2*p*l;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*p*q;f[6]=0;f[7]=0;f[8]=(b+a)*l;f[9]=(t+c)*q;f[10]=(h+p)*r;f[11]=-1;f[12]=0;f[13]=0;f[14]=
h*p*2*r;f[15]=0;return f};r.perspective=function(f,a,b,c,t){a=1/Math.tan(a/2);var p=1/(c-t);f[0]=a/b;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(t+c)*p;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*t*c*p;f[15]=0;return f};r.perspectiveFromFieldOfView=function(f,a,b,c){var t=Math.tan(a.upDegrees*Math.PI/180),p=Math.tan(a.downDegrees*Math.PI/180),h=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var l=2/(h+a),q=2/(t+p);f[0]=l;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=
q;f[6]=0;f[7]=0;f[8]=-((h-a)*l*.5);f[9]=(t-p)*q*.5;f[10]=c/(b-c);f[11]=-1;f[12]=0;f[13]=0;f[14]=c*b/(b-c);f[15]=0;return f};r.ortho=function(f,a,b,c,t,p,h){var l=1/(a-b),q=1/(c-t),r=1/(p-h);f[0]=-2*l;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*q;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=2*r;f[11]=0;f[12]=(a+b)*l;f[13]=(t+c)*q;f[14]=(h+p)*r;f[15]=1;return f};r.lookAt=function(f,a,b,c){var t,p,h,l,q,y,z,w,u=a[0],C=a[1];a=a[2];h=c[0];l=c[1];p=c[2];z=b[0];c=b[1];t=b[2];if(Math.abs(u-z)<B.EPSILON&&Math.abs(C-c)<B.EPSILON&&
Math.abs(a-t)<B.EPSILON)return r.identity(f);b=u-z;c=C-c;z=a-t;w=1/Math.sqrt(b*b+c*c+z*z);b*=w;c*=w;z*=w;t=l*z-p*c;p=p*b-h*z;h=h*c-l*b;(w=Math.sqrt(t*t+p*p+h*h))?(w=1/w,t*=w,p*=w,h*=w):h=p=t=0;l=c*h-z*p;q=z*t-b*h;y=b*p-c*t;(w=Math.sqrt(l*l+q*q+y*y))?(w=1/w,l*=w,q*=w,y*=w):y=q=l=0;f[0]=t;f[1]=l;f[2]=b;f[3]=0;f[4]=p;f[5]=q;f[6]=c;f[7]=0;f[8]=h;f[9]=y;f[10]=z;f[11]=0;f[12]=-(t*u+p*C+h*a);f[13]=-(l*u+q*C+y*a);f[14]=-(b*u+c*C+z*a);f[15]=1;return f};r.str=function(f){return"mat4("+f[0]+", "+f[1]+", "+f[2]+
", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+", "+f[9]+", "+f[10]+", "+f[11]+", "+f[12]+", "+f[13]+", "+f[14]+", "+f[15]+")"};r.frob=function(f){return Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2)+Math.pow(f[2],2)+Math.pow(f[3],2)+Math.pow(f[4],2)+Math.pow(f[5],2)+Math.pow(f[6],2)+Math.pow(f[7],2)+Math.pow(f[8],2)+Math.pow(f[9],2)+Math.pow(f[10],2)+Math.pow(f[11],2)+Math.pow(f[12],2)+Math.pow(f[13],2)+Math.pow(f[14],2)+Math.pow(f[15],2))};r.add=function(f,a,b){f[0]=a[0]+b[0];f[1]=a[1]+
b[1];f[2]=a[2]+b[2];f[3]=a[3]+b[3];f[4]=a[4]+b[4];f[5]=a[5]+b[5];f[6]=a[6]+b[6];f[7]=a[7]+b[7];f[8]=a[8]+b[8];f[9]=a[9]+b[9];f[10]=a[10]+b[10];f[11]=a[11]+b[11];f[12]=a[12]+b[12];f[13]=a[13]+b[13];f[14]=a[14]+b[14];f[15]=a[15]+b[15];return f};r.subtract=function(f,a,b){f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];f[3]=a[3]-b[3];f[4]=a[4]-b[4];f[5]=a[5]-b[5];f[6]=a[6]-b[6];f[7]=a[7]-b[7];f[8]=a[8]-b[8];f[9]=a[9]-b[9];f[10]=a[10]-b[10];f[11]=a[11]-b[11];f[12]=a[12]-b[12];f[13]=a[13]-b[13];f[14]=a[14]-
b[14];f[15]=a[15]-b[15];return f};r.sub=r.subtract;r.multiplyScalar=function(f,a,b){f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;f[3]=a[3]*b;f[4]=a[4]*b;f[5]=a[5]*b;f[6]=a[6]*b;f[7]=a[7]*b;f[8]=a[8]*b;f[9]=a[9]*b;f[10]=a[10]*b;f[11]=a[11]*b;f[12]=a[12]*b;f[13]=a[13]*b;f[14]=a[14]*b;f[15]=a[15]*b;return f};r.multiplyScalarAndAdd=function(f,a,b,c){f[0]=a[0]+b[0]*c;f[1]=a[1]+b[1]*c;f[2]=a[2]+b[2]*c;f[3]=a[3]+b[3]*c;f[4]=a[4]+b[4]*c;f[5]=a[5]+b[5]*c;f[6]=a[6]+b[6]*c;f[7]=a[7]+b[7]*c;f[8]=a[8]+b[8]*c;f[9]=a[9]+
b[9]*c;f[10]=a[10]+b[10]*c;f[11]=a[11]+b[11]*c;f[12]=a[12]+b[12]*c;f[13]=a[13]+b[13]*c;f[14]=a[14]+b[14]*c;f[15]=a[15]+b[15]*c;return f};r.exactEquals=function(f,a){return f[0]===a[0]&&f[1]===a[1]&&f[2]===a[2]&&f[3]===a[3]&&f[4]===a[4]&&f[5]===a[5]&&f[6]===a[6]&&f[7]===a[7]&&f[8]===a[8]&&f[9]===a[9]&&f[10]===a[10]&&f[11]===a[11]&&f[12]===a[12]&&f[13]===a[13]&&f[14]===a[14]&&f[15]===a[15]};r.equals=function(f,a){var b=f[0],c=f[1],t=f[2],p=f[3],h=f[4],l=f[5],q=f[6],r=f[7],z=f[8],w=f[9],u=f[10],C=f[11],
E=f[12],G=f[13],n=f[14];f=f[15];var A=a[0],x=a[1],I=a[2],K=a[3],J=a[4],N=a[5],M=a[6],Q=a[7],S=a[8],P=a[9],O=a[10],T=a[11],U=a[12],W=a[13],k=a[14];a=a[15];return Math.abs(b-A)<=B.EPSILON*Math.max(1,Math.abs(b),Math.abs(A))&&Math.abs(c-x)<=B.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(t-I)<=B.EPSILON*Math.max(1,Math.abs(t),Math.abs(I))&&Math.abs(p-K)<=B.EPSILON*Math.max(1,Math.abs(p),Math.abs(K))&&Math.abs(h-J)<=B.EPSILON*Math.max(1,Math.abs(h),Math.abs(J))&&Math.abs(l-N)<=B.EPSILON*Math.max(1,
Math.abs(l),Math.abs(N))&&Math.abs(q-M)<=B.EPSILON*Math.max(1,Math.abs(q),Math.abs(M))&&Math.abs(r-Q)<=B.EPSILON*Math.max(1,Math.abs(r),Math.abs(Q))&&Math.abs(z-S)<=B.EPSILON*Math.max(1,Math.abs(z),Math.abs(S))&&Math.abs(w-P)<=B.EPSILON*Math.max(1,Math.abs(w),Math.abs(P))&&Math.abs(u-O)<=B.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(C-T)<=B.EPSILON*Math.max(1,Math.abs(C),Math.abs(T))&&Math.abs(E-U)<=B.EPSILON*Math.max(1,Math.abs(E),Math.abs(U))&&Math.abs(G-W)<=B.EPSILON*Math.max(1,Math.abs(G),
Math.abs(W))&&Math.abs(n-k)<=B.EPSILON*Math.max(1,Math.abs(n),Math.abs(k))&&Math.abs(f-a)<=B.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return r})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./Evented"],function(B,r,f,a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._renderRequestedCalled=!1;b._attached=!1;b._opacity=1;b.renderRequested=!1;b._visible=!0;return b}f(b,a);Object.defineProperty(b.prototype,
"attached",{get:function(){return this._attached},set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},
set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.attach=function(a){return!0};b.prototype.detach=function(a){};b.prototype.processRender=function(a){this._renderRequestedCalled=!1;this.doRender(a);this._renderRequestedCalled||(this.renderRequested=!1);this.hasEventListener("post-render")&&this.emit("post-render")};b.prototype.requestRender=function(){var a=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;
this.parent&&this.parent.requestChildRender(this);a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};b.prototype.dispose=function(){};return b}(a.Evented)})},"esri/views/2d/engine/Evented":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","dojo/aspect","dojo/on"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function c(){}c.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};c.prototype.once=
function(a,c){return b.once(this,a,c)};c.prototype.emit=function(a){b.emit(this,a,this)};c.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return c}();r.Evented=B;r.EventedMixin=function(c){return function(c){function p(){return null!==c&&c.apply(this,arguments)||this}f(p,c);p.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};p.prototype.once=function(a,c){return b.once(this,a,c)};p.prototype.emit=function(a,c){b.emit(this,a,c)};p.prototype.hasEventListener=
function(a){a="on"+a;return!(!this[a]||!this[a].after)};return p}(c)}})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});B=function(){return function(a){this.type=a}}();r.RenderBucket=B;a=function(a){function b(){var b=a.call(this,2)||this;b.triangleElementStart=0;b.triangleElementCount=0;b.joinStart=0;b.joinCount=0;return b}f(b,
a);b.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.joinCount};return b}(B);r.LineRenderBucket=a;a=function(a){function b(){var b=a.call(this,1)||this;b.triangleElementStart=0;b.triangleElementCount=0;b.outlineElementStart=0;b.outlineElementCount=0;return b}f(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return b}(B);r.FillRenderBucket=a;a=function(a){function b(){var b=a.call(this,3)||this;b.markerPerPageElementsMap=new Map;
b.glyphPerPageElementsMap=new Map;b.isSDF=!1;return b}f(b,a);b.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return b}(B);r.SymbolRenderBucket=a;B=function(a){function b(){return a.call(this,0)||this}f(b,a);b.prototype.hasData=function(){return!0};return b}(B);r.BackgroundRenderBucket=B})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgentBase ./UpsampleInfo".split(" "),
function(B,r,f,a,b,c,t){return function(c){function h(){var a=null!==c&&c.apply(this,arguments)||this;a._scaleRangeEnabled=!1;return a}f(h,c);h.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.updateGeometry());this._dataRequested=null;this._requestNext()};h.prototype.updateGeometry=function(){this._tileLayerInfo.pendingUpdates|=b.TileUpdateTypes.UPDATE_GEOMETRY;this.tile.updateGeometry()};h.prototype._findAncestorWithData=function(){for(var a=
this.layerClass,c=this.layerIdx,h=this.tile,f=h.vlevel,p;h&&!(h.layerInfo[a][c].data&&(p=h,f-h.lij[0]>=b.ELEVATION_DESIRED_RESOLUTION_LEVEL));)h=h.parent;return p?(a=t.Pool.acquire(),a.init(p,0,0,1),a):null};h.prototype._desiredMinLevelDelta=function(){return b.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};h.prototype._setUpsamplingTile=function(a){this._unsetUpsamplingTile();var b=t.Pool.acquire();b.init(a,0,0,1);this._tileLayerInfo.upsampleFromTile=b;this.updateGeometry()};
h.Pool=new a(h);return h}(c)})},"esri/views/3d/terrain/MapTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TileAgentBase ./tileUtils".split(" "),function(B,r,f,a,b,c){return function(b){function p(){var a=b.call(this)||this;a._scaleRangeEnabled=!0;return a}f(p,b);p.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.tile.updateTexture());this._dataRequested=null;a!==this.tile&&this._requestNext()};
p.prototype._desiredMinLevelDelta=function(){return 0};p.prototype._setUpsamplingTile=function(a){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===a||(this._unsetUpsamplingTile(),this._tileLayerInfo.upsampleFromTile=c.computeUpsampleInfoForAncestor(this.tile,a),this.tile.updateTexture())};p.Pool=new a(p);return p}(b)})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryData ../lib/glMatrix ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),
function(B,r,f,a,b,c){function t(a,b,c,h,f){a<h[0]&&(h[0]=a);a>f[0]&&(f[0]=a);b<h[1]&&(h[1]=b);b>f[1]&&(f[1]=b);c<h[2]&&(h[2]=c);c>f[2]&&(f[2]=c)}function p(a,h,f){for(var l=0;l<f.length;l++){var n=f[l];if(n){var q=n.safeWidth,p=n.width,u=n.pixelData,t=b.clamp(n.dy*(n.y1-h),0,q),n=b.clamp(n.dx*(a-n.x0),0,q),q=Math.floor(t),r=Math.floor(n),w=q*p+r,k=w+p,x=u[w],p=u[k],w=u[w+1],u=u[k+1];if(x+p+w+u<.5*c.ELEVATION_NODATA_VALUE)return t-=q,n-=r,a=x+(w-x)*n,a+(p+(u-p)*n-a)*t}}return null}var h=a.earthRadius,
l=f.vec3d,q=b.lerp,y=function(){var a=l.create(),b=l.create(),c=l.create(),h,f,n;this.init=function(q,p){f=q;n=p;l.subtract(c,b,a);h=.5*l.length(a);l.lerp(b,c,.5,a)};this.getCenter=function(){return a};this.getBSRadius=function(){return h};this.getBBMin=function(){return b};this.getBBMax=function(){return c};this.getPosition=function(){return f};this.getIndices=function(){return n};this.getPrimitiveIndices=function(){};this.getChildren=function(){}},z=function(a,b,c,f){a*=h;for(var l=0;l<=b;l++)c[5*
f]=0,c[5*f+1]=0,c[5*f+2]=a,f++},w=new function(){var a=Array(50),b=0,c={};this.get=function(f){var l=c[f];l||(l={ptr:0,data:Array(50)},c[f]=l);0<l.ptr?(h.vertexArrayHits++,f=l.data[--l.ptr],l.data[l.ptr]=null):(h.vertexArrayMisses++,f=new Float32Array(f));if(0<b)return h.geometryHits++,l=a[--b],a[b]=null,l.getData().getVertexAttr().terrain.data=f,l;h.geometryMisses++;l={};l.terrain={size:5,data:f};f=new y;return new B(new r([{type:"triangle",indices:{terrain:null},positionKey:"terrain"}],l),"tile",
[f])};this.put=function(h){var f=h.getData(),l=f.getVertexAttr(),n=l.terrain.data,q=c[n.length];50>q.ptr&&(q.data[q.ptr++]=n);l.terrain.data=null;f.getFaces()[0].indices.terrain=null;50>b&&(a[b++]=h)};var h={geometryHits:0,geometryMisses:0,vertexArrayHits:0,vertexArrayMisses:0};this.stats=h;this._pools={geometry:a,vertexArray:c}},u=[],C=Array(c.MAX_TILE_TESSELATION+1),E=Array(c.MAX_TILE_TESSELATION+1),G=Array(c.MAX_TILE_TESSELATION+1),n=Array(c.MAX_TILE_TESSELATION+1),A={values:null,numSurfaceIndices:0,
numSkirtIndices:0},x=function(a,b,c){c||(a.values=b.values);a.numSurfaceIndices=b.numSurfaceIndices;a.numSkirtIndices=b.numSkirtIndices;return a},I=function(a,b,c,h,f){var l;l=A;var n=c&2,q=b+(h?1024:0)+(n?2048:0),p=u[q];l||(l={});if(p)x(l,p);else{var p=b-1,t=b-1,r=b*b,k=2*p+2*t,w=p*t*6,y=6*k,e=6*(2*p+t-1);h&&(w*=2,y*=2,e*=2);for(var k=65536<r+k?new Uint32Array(w+y):new Uint16Array(w+y),d=0,g=0,m=w,v,z,C,J,I=0,E=0;E<=t;E++){n&&(I=0===E?e:E===t?-e:0);for(var m=m+I,K=0;K<=p;K++)J=z=-1,0===E&&(z=r+K,
K!==p&&(J=d+1)),K===p&&(z=r+p+E,E<t&&(J=d+p+1)),E===t&&(z=r+p+t+(p-K),0<K&&(J=d-1)),0===K&&0<E&&(z=r+2*p+t+(t-E),J=d-(p+1)),-1<z&&(C=0===K&&1===E?r:z+1,-1<J&&(v=d,h?(k[m+0]=v,k[m+1]=z,k[m+2]=z,k[m+3]=C,k[m+4]=C,k[m+5]=v,k[m+6]=C,k[m+7]=J,k[m+8]=J,k[m+9]=v,k[m+10]=v,k[m+11]=C,m+=12):(k[m+0]=v,k[m+1]=z,k[m+2]=C,k[m+3]=C,k[m+4]=J,k[m+5]=v,m+=6))),++d,K<p&&E<t&&(v=E*(p+1)+K,z=v+1,C=z+(p+1),J=C-1,h?(k[g+0]=v,k[g+1]=z,k[g+2]=z,k[g+3]=C,k[g+4]=C,k[g+5]=v,k[g+6]=C,k[g+7]=J,k[g+8]=J,k[g+9]=v,k[g+10]=v,k[g+
11]=C,g+=12):(k[g+0]=v,k[g+1]=z,k[g+2]=C,k[g+3]=C,k[g+4]=J,k[g+5]=v,g+=6));m-=I}l.values=k;l.numSurfaceIndices=w;l.numSkirtIndices=y;u[q]=x({},l)}n=a.getData();q=n.getVertexAttr();n.getFaces()[0].indices.terrain=l.values;a.getBoundingInfo(0).init(q.terrain,l.values);f||(f={});f.geometry=a;f.numWithoutSkirtIndices=l.numSurfaceIndices+(c?6*(b-1)*(h?2:1):0);f.numVertsPerRow=b;return x(f,l,!0)};return{createPlanarGlobeTile:function(a,b,c,h,f,n,q){var u=b[0],r=b[1],x=b[2]-u;b=b[3]-r;var y=.1*x,k=a-1,z=
a-1,A=a*a,e=w.get(5*(A+(2*k+2*z))),d=e.getData().getVertexAttr().terrain.data,g,m,v=0;g=e.getBoundingInfo(0);var C=g.getBBMin(),J=g.getBBMax();l.set3(1E7,1E7,1E7,C);l.set3(-1E7,-1E7,-1E7,J);for(m=0;m<=z;m++){var E=m/z,K=r+E*b;n&&(K<n[1]?(K=n[1],E=(K-r)/b):K>n[3]&&(K=n[3],E=(K-r)/b));for(g=0;g<=k;g++){var G=g/k,B=u+G*x;n&&(B<n[0]?(B=n[0],G=(B-u)/x):B>n[2]&&(B=n[2],G=(B-u)/x));var N=c?p(B,K,c)||0:0,B=B-h[0],M=K-h[1],N=N-h[2];t(B,M,N,C,J);d[5*v]=B;d[5*v+1]=M;d[5*v+2]=N;d[5*v+3]=G;d[5*v+4]=E;var Q=-1;
0===m&&(Q=A+g);g===k&&(Q=A+k+m);m===z&&(Q=A+k+z+(k-g));0===g&&0<m&&(Q=A+2*k+z+(z-m));-1<Q&&(d[5*Q]=B,d[5*Q+1]=M,d[5*Q+2]=N-y,d[5*Q+3]=G,d[5*Q+4]=E,t(B,M,N-y,C,J));++v}}return I(e,a,0,f,q)},createSphericalGlobeTile:function(a,b,c,f,u,r,x,y,A){var J=c[0],K=c[1],k=c[2],B=c[3],N=Math.max(.9,1-.5*(k-J));c=a-1;var e=a-1,d=a*a,g=w.get(5*(d+(2*c+2*e))),m=g.getData().getVertexAttr().terrain.data,v=b[2]-b[0],D=b[3]-b[1],M=k-J,k=r[0],Q=r[1];r=r[2];var P=g.getBoundingInfo(0),O=P.getBBMin(),P=P.getBBMax();l.set3(1E7,
1E7,1E7,O);l.set3(-1E7,-1E7,-1E7,P);var T;for(T=0;T<=c;T++){var S=T/c,ea=J+S*M;C[T]=Math.sin(ea);E[T]=Math.cos(ea);G[T]=S;n[T]=b[0]+S*v}for(J=v=0;J<=e;J++){M=J/e;T=q(K,B,M);var ea=Math.cos(T),ha=Math.sin(T),ga;f?(ga=h/2*Math.log((1+ha)/(1-ha)),M=(ga-b[1])/D):ga=180*T/Math.PI;for(T=0;T<=c;T++){var S=G[T],ma=C[T],fa=E[T],Y=h;u&&(Y+=p(n[T],ga,u)||0);var fa=fa*ea*Y,ma=ma*ea*Y,Y=ha*Y,wa=fa-k,oa=ma-Q,ta=Y-r;t(wa,oa,ta,O,P);var F=5*v;m[F+0]=wa;m[F+1]=oa;m[F+2]=ta;m[F+3]=S;m[F+4]=M;F=-1;0===J&&(F=d+T);T===
c&&(F=d+c+J);J===e&&(F=d+c+e+(c-T));0===T&&0<J&&(F=d+2*c+e+(e-J));-1<F&&(fa=fa*N-k,ma=ma*N-Q,Y=Y*N-r,t(fa,ma,Y,O,P),F*=5,m[F+0]=fa,m[F+1]=ma,m[F+2]=Y,m[F+3]=S,m[F+4]=M);++v}}f&&(b=!!(x&2),x&1&&z(-1,c,m,d),b&&z(1,c,m,d+c+e));return I(g,a,f?x:0,y,A)},releaseGeometry:w.put,elevationSampler:p,_geometryObjectPool:w}})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./IdGen ./Util ./BoundingInfo ./ComponentUtils".split(" "),function(B,r,f,a,b,c){return function(){function t(b,
c,f){this.singleUse=!1;this.componentAABB=null;this.id=t.__idGen.gen(c);this.data=b;this.boundingInfos=f||[];a.assert(1<=b.faces.length)}t.prototype.getId=function(){return this.id};t.prototype.getData=function(){return this.data};Object.defineProperty(t.prototype,"numGroups",{get:function(){return this.data.faces.length},enumerable:!0,configurable:!0});t.prototype.getNumGroups=function(){return this.numGroups};t.prototype.getComponentCount=function(){return c.componentCount(this.data.componentOffsets)};
t.prototype.getComponentAABB=function(a,b){null==this.componentAABB&&(this.componentAABB=this._computeComponentAABB());for(var c=0;6>c;c++)b[c]=this.componentAABB[6*a+c];return b};t.prototype._computeComponentAABB=function(){for(var a=this.getComponentCount(),b=new Float32Array(6*a),c=0;c<a;c++)this._calculateAABB(0,c,b,6*c);return b};t.prototype._calculateAABB=function(a,b,c,f){void 0===f&&(f=0);var h=this.data.faces[a];a=h.indices[h.positionKey];var h=this.data.vertexAttributes[h.positionKey].data,
l=this.data.componentOffsets,q=l.length?l[b+1]:a.length,p=Infinity,t=Infinity,r=Infinity,G=-Infinity,n=-Infinity,A=-Infinity;for(b=l.length?l[b]:0;b<q;b++)var x=3*a[b],l=h[x],I=h[x+1],x=h[x+2],p=Math.min(p,l),t=Math.min(t,I),r=Math.min(r,x),G=Math.max(G,l),n=Math.max(n,I),A=Math.max(A,x);c?(c[f]=p,c[f+1]=t,c[f+2]=r,c[f+3]=G,c[f+4]=n,c[f+5]=A):c=[p,t,r,G,n,A];return c};t.prototype.calculateBoundingInfo=function(c,h){c=this.data.faces[c];var f="triangle"===c.type?3:1,q=c.indices[c.positionKey];if(0===
q.length)for(var q=new Uint32Array(f),p=0;p<f;++p)q[p]=p;p=q.length;a.assert(0===p%f);for(var t=p/f,r=new Uint32Array(t),p=0;p<t;++p)r[p]=p;return new b(r,f,q,this.data.vertexAttributes[c.positionKey],h)};t.prototype.getBoundingInfo=function(a){var b=this.boundingInfos[a];null==b&&(b=this.calculateBoundingInfo(a),this.boundingInfos[a]=b);return b};t.prototype.invalidateBoundingInfo=function(){this.boundingInfos=[]};t.__idGen=new f;return t}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["require",
"exports","./Util","./gl-matrix"],function(B,r,f,a){var b=a.vec3d;return function(){function a(a,c,h,l,q){f.assert(1<=a.length);f.assert(0===h.length%c);f.assert(h.length>=a.length*c);f.assert(3===l.size||4===l.size);this.primitiveIndices=a;this.indices=h;this.position=l;this._numIndexPerPrimitive=c;this._faceRange=q;var p=l.data;l=l.size;var t=0,r=a.length;null!=q&&(t=q[0],r=q[1]+1);var u=l*h[c*a[t]];this.bbMin=b.createFrom(p[u],p[u+1],p[u+2]);this.bbMax=b.create(this.bbMin);for(q=t;q<r;++q)for(var C=
c*a[q],E=0;E<c;++E)for(var u=l*h[C+E],G=0;3>G;++G){var n=p[u+G];n<this.bbMin[G]?this.bbMin[G]=n:n>this.bbMax[G]&&(this.bbMax[G]=n)}this.center=b.create();b.lerp(this.bbMin,this.bbMax,.5,this.center);this.bsRadius=0;for(q=t;q<r;++q)for(C=c*a[q],E=0;E<c;++E)u=l*h[C+E],t=p[u]-this.center[0],G=p[u+1]-this.center[1],u=p[u+2]-this.center[2],u=t*t+G*G+u*u,u>this.bsRadius&&(this.bsRadius=u);this.bsRadius=Math.sqrt(this.bsRadius)}a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=
function(){return this.bsRadius};a.prototype.getBBMin=function(){return this.bbMin};a.prototype.getBBMax=function(){return this.bbMax};a.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};a.prototype.getIndices=function(){return this.indices};a.prototype.getPosition=function(){return this.position};a.prototype.getChildren=function(){if(this.children)return this.children;if(1<b.dist2(this.bbMin,this.bbMax)){for(var c=b.lerp(this.bbMin,this.bbMax,.5,b.create()),f=this.primitiveIndices.length,
h=new Uint8Array(f),l=Array(8),q=0;8>q;++q)l[q]=0;for(var r=this.position.size,q=0;q<f;++q){for(var z=0,w=this._numIndexPerPrimitive*this.primitiveIndices[q],u=this.position.data,C=r*this.indices[w],E=u[C],G=u[C+1],n=u[C+2],A=1;A<this._numIndexPerPrimitive;++A){var C=r*this.indices[w+A],x=u[C],I=u[C+1],C=u[C+2];x<E&&(E=x);I<G&&(G=I);C<n&&(n=C)}E<c[0]&&(z|=1);G<c[1]&&(z|=2);n<c[2]&&(z|=4);h[q]=z;++l[z]}for(q=z=0;8>q;++q)0<l[q]&&++z;if(2>z)return;c=Array(8);for(q=0;8>q;++q)c[q]=0<l[q]?new Uint32Array(l[q]):
void 0;for(q=0;8>q;++q)l[q]=0;for(q=0;q<f;++q)z=h[q],c[z][l[z]++]=this.primitiveIndices[q];this.children=Array(8);for(q=0;8>q;++q)void 0!==c[q]&&(this.children[q]=new a(c[q],this._numIndexPerPrimitive,this.indices,this.position))}return this.children};return a}()})},"esri/views/3d/terrain/SphericalTile":function(){define("./TileBase ./TileGeometryFactory ../../../core/ObjectPool ../support/mathUtils ../support/earthUtils ../lib/glMatrix".split(" "),function(B,r,f,a,b,c){var t=c.vec3d,p=b.earthRadius,
h=function(a,b,c,h){c=p+c;var f=Math.cos(a);h[0]=Math.cos(b)*f*c;h[1]=Math.sin(b)*f*c;h[2]=Math.sin(a)*c};b=function(a,b,c,h){B.call(this);this.tileUp=t.create();this.obb=Array(8);this._isWebMercator=!1;for(var f=0;8>f;f++)this.obb[f]=t.create();void 0!==a&&this.init(a,b,c,h)};b.prototype=new B;b.prototype.constructor=b;b.prototype.init=function(b,c,f,r){B.prototype.init.call(this,b,c,f,r);this._isWebMercator=r.spatialReference.isWebMercator;c=this.extentWGS84Rad[0];f=this.extentWGS84Rad[1];r=this.extentWGS84Rad[2];
var l=this.extentWGS84Rad[3];b=b[0];var q=a.lerp(f,l,.5),y=a.lerp(c,r,.5);this.edgeLen=(r-c)*Math.cos(0===b?0:Math.min(Math.abs(f),Math.abs(l)))*p;this.curvatureHeight=p-Math.sqrt(p*p-this.edgeLen*this.edgeLen/4);h(q,y,0,this.centerAtSeaLevel);t.set(this.centerAtSeaLevel,this.tileUp);t.normalize(this.tileUp);this._updateOBB();this.updateRadiusAndCenter()};b.prototype.isVisible=function(a,b){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0]){b=this.obb;for(var c=0;6>c;c++){for(var h=0;8>h&&
!(0>a[c][0]*b[h][0]+a[c][1]*b[h][1]+a[c][2]*b[h][2]+a[c][3]);h++);if(8===h)return!1}}else if(b=this.radius,c=this.center,a[0][0]*c[0]+a[0][1]*c[1]+a[0][2]*c[2]+a[0][3]>b||a[1][0]*c[0]+a[1][1]*c[1]+a[1][2]*c[2]+a[1][3]>b||a[2][0]*c[0]+a[2][1]*c[1]+a[2][2]*c[2]+a[2][3]>b||a[3][0]*c[0]+a[3][1]*c[1]+a[3][2]*c[2]+a[3][3]>b||a[4][0]*c[0]+a[4][1]*c[1]+a[4][2]*c[2]+a[4][3]>b||a[5][0]*c[0]+a[5][1]*c[1]+a[5][2]*c[2]+a[5][3]>b)return!1;return!0};b.prototype.computeElevationBounds=function(){B.prototype.computeElevationBounds.call(this);
this._updateOBB()};b.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])t.set3(0,0,0,this.center),this.radius=p+this.elevationBounds[1];else{B.prototype.updateRadiusAndCenter.call(this);var a=Math.max(t.dist2(this.center,this.obb[0]),t.dist2(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};b.prototype._numSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];b.prototype.createGeometry=function(a,b,c){var h=this._isPole(this.lij[1],this.lij[0]);a.needsUpdate=!1;return r.createSphericalGlobeTile(a.numVertsPerRow,
this.extent,this.extentWGS84Rad,this._isWebMercator,a.samplerData,b,h,c)};b.prototype._updateOBB=function(){var a=this.extentWGS84Rad,b=this.obb,c;for(c=0;2>c;c++){var f=this.elevationBounds[c],r=4*c;h(a[1],a[0],f,b[r++]);h(a[3],a[0],f,b[r++]);h(a[3],a[2],f,b[r++]);h(a[1],a[2],f,b[r++])}this._isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(t.set3(0,0,p,b[1]),t.set3(0,0,p,b[2]),t.set3(0,0,p,b[5]),t.set3(0,0,p,b[6])):1===a&&(t.set3(0,0,-p,b[0]),t.set3(0,0,-p,b[3]),t.set3(0,0,-p,b[4]),
t.set3(0,0,-p,b[7])))};b.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};b.Pool=new f(b);return b})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/arrayUtils ../../../core/HandleRegistry ../../../geometry/support/webMercatorUtils ../../../views/3d/support/aaBoundingRect ./terrainUtils ./TerrainConst".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y){function z(a,b){a&&!a.spatialReference.equals(b)&&(a=h.canProject(a.spatialReference,b)?h.project(a,b):null);return a}Object.defineProperty(r,"__esModule",{value:!0});B=function(c){function h(a){a=c.call(this,a)||this;a._changeListeners=new p;return a}f(h,c);h.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};h.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(h.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});h.prototype._computeStencilEnabledExtents=function(a,b){var c=[],h=0;for(a=a.items;h<a.length;h++){var f=a[h].layer;"IntegratedMeshLayer"===f.operationalLayerType&&null!=b&&(f=z(f.fullExtent,b),null!=f&&c.push([f.xmin,
f.ymin,f.xmax,f.ymax]))}return c};a([b.property({readOnly:!0})],h.prototype,"layerViewsExtent",null);a([b.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],h.prototype,"tiledLayersExtent",null);a([b.property({readOnly:!0,dependsOn:["spatialReference"]})],h.prototype,"stencilEnabledExtents",null);a([b.property()],h.prototype,"spatialReference",null);a([b.property()],h.prototype,"tilingScheme",null);a([b.property()],h.prototype,"defaultTiledLayersExtent",void 0);a([b.property({constructOnly:!0})],
h.prototype,"layers",void 0);a([b.property({constructOnly:!0})],h.prototype,"layerViews",void 0);return h=a([b.subclass()],h)}(b.declared(c));c=function(c){function h(){return null!==c&&c.apply(this,arguments)||this}f(h,c);h.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};h.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};h.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?y.WEBMERCATOR_WORLD_EXTENT:y.GEOGRAPHIC_WORLD_EXTENT};
a([b.property({dependsOn:["spatialReference"]})],h.prototype,"layerViewsExtent",void 0);return h=a([b.subclass()],h)}(b.declared(B));r.SurfaceExtentHelperGlobal=c;B=function(c){function h(){return null!==c&&c.apply(this,arguments)||this}f(h,c);h.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};h.prototype._computeLayerViewsExtent=
function(){var a=l.create(l.NEGATIVE_INFINITY),b=this.spatialReference;this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInViewSpatialReference||c.layer.fullExtent,(c=z(c,b))&&l.expand(a,c))});var c=l.allFinite(a)?a:null,h=this._get("layerViewsExtent");return t.equals(c,h)?h:c};h.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,c=l.create(l.NEGATIVE_INFINITY);this.layers.forEach(function(h){if(h.loaded&&q.isTiledLayer(h)){var f=
q.getTiledLayerInfo(h,b,"local");h=f.tileInfo;f=f.fullExtent;h&&a.compatibleWith(h)&&f&&f.spatialReference.equals(b)&&l.expand(c,f)}});this.defaultTiledLayersExtent&&l.expand(c,this.defaultTiledLayersExtent);var h=l.allFinite(c)?c:null,f=this._get("tiledLayersExtent");return t.equals(h,f)?f:h};return h=a([b.subclass()],h)}(b.declared(B));r.SurfaceExtentHelperLocal=B})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/HandleRegistry ./terrainUtils ./TilingScheme".split(" "),
function(B,r,f,a,b,c,t,p,h){return function(c){function l(a){a=c.call(this,a)||this;a._changeHandles=new t;return a}f(l,c);l.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};l.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};l.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){var b=this.layers.find(function(b){return p.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!p.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(b)if(b.isResolved()){var c=p.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,c=new h(c),b=p.getKnownTiledServiceLevelCap(b.url);Infinity>b&&c.capMaxLod(b);this._lockTilingScheme(c)}else this._updateWhen(b)}};l.prototype._updateWhen=
function(a){var b=this,c=a.always(function(){c===b._waitTask&&b._update()});this._waitTask=c};l.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a=a.spatialReference.isWebMercator?h.makeWebMercatorAuxiliarySphere(c):h.makeWGS84WithTileSize(a.pixelSize[0],c)}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",
function(){return b._updateTiledLayerExtent()}))};l.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};l.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?h.WebMercatorAuxiliarySphere:h.makeWGS84WithTileSize(256),this.extent=this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=h.fromExtent(a,this.extentHelper.spatialReference),
this.extent=a)}};a([b.property()],l.prototype,"tilingScheme",void 0);a([b.property()],l.prototype,"extent",void 0);a([b.property({value:!1})],l.prototype,"tilingSchemeLocked",void 0);a([b.property({constructOnly:!0})],l.prototype,"viewSpatialReference",void 0);a([b.property({constructOnly:!0})],l.prototype,"layers",void 0);a([b.property({constructOnly:!0})],l.prototype,"extentHelper",void 0);a([b.property({constructOnly:!0})],l.prototype,"manifold",void 0);return l=a([b.subclass()],l)}(b.declared(c))})},
"esri/views/3d/terrain/TerrainRenderer":function(){define("dojo/when ./tileUtils ./TerrainConst ./TileGeometryFactory ./TileRenderData ./ResourceCounter ./TileRenderer ../support/PreallocArray ../../../core/ObjectPool ../../../core/promiseUtils ../support/imageUtils ../webgl-engine/lib/ShaderVariations dojo/text!./TerrainMaterial.xml ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/lib/Util ../lib/glMatrix ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/tracer ../../webgl/Texture ../../webgl/VertexArrayObject ../../webgl/BufferObject ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/Util".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q){var S=u.assert;u=C.vec2d;var P=C.vec3d,O=C.vec4d,T=C.mat4d.identity(),U=[2,2],W=G.OPAQUE_TERRAIN,k=G.TRANSPARENT_TERRAIN,ca=P.create(),V=u.create();C=function(e,d,g){function m(a,b){a=a.screenDepth;b=b.screenDepth;return a<b?-Aa:a>b?Aa:0}function u(a,b){return 0===a.tiles.length?-Aa:0===b.tiles.length?Aa:m(a.tiles.data[0],b.tiles.data[0])}d=d||256;var C,G=!1,R=null,Z=null,ba=null,ja={},aa,ea,ha=new h(b),ga=new p(10,function(){return{root:null,
tiles:new p(300)}}),ma=!0,fa=new r.IteratorPreorder,Y=null,wa=!0,oa=1,ta=!0,F=!1,la={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},ua=!1,ya=!1,ra=!1,Aa=1,qa=!0,da=!0,Ga=null,za=null,Da=null,Fa=!1,Qa=[];this.updateTileBackground=function(a){Da&&Da.cancel();Da=a?q.requestImage(a).otherwise(function(){return null}):l.resolve(null);this.renderTileBackground();return Da};var Wa=0,Ta=0,Ha=0,Xa=0;this.resourceCounter=new c;this.castShadows=!0;this.clippingExtent=
null;this.loaded=function(){};var Ya=!1;this.needsRender=!0;this.receiveShadows=this.needsHighlight=this.didRender=!1;var pa=new p(10),Ra=0,Ua=new p(30),Za=new h(function(){this.extent=O.create();this.maxLevel=this.minLevel=0;this.callback=null},!1);this.renderTileBackground=function(){if(aa&&Da&&za)return Da.then(function(a){Fa=!0;za.setGridImage(a);R&&r.traverseTilesPreorder(R,function(a){za.updateTileTexture(a)}.bind(this))}.bind(this))};this.initializeRenderContext=function(a){aa=a.rctx;ea=a.rctx.gl;
var b=function(a){B(a).then(function(){G=!0;this.setNeedsRender()}.bind(this)).otherwise(b)}.bind(this);b(this.renderTileBackground());C=a.textureRep;var e=a.shaderSnippets,c=a.shaderRep;a=a.programRep;e.vsTerrain||e._parse(z);aa.extensions.standardDerivatives;var g=new y("terrain",["vsTerrain","fsTerrain"],null,a,c,e,aa);g.addDefine("Spherical","SPHERICAL");g.addDefine("Overlay","OVERLAY");g.addDefine("Atmosphere","ATMOSPHERE");g.addDefine("Wireframe","WIREFRAME");g.addDefine("TileBorders","TILE_BORDERS");
g.addBinaryShaderSnippetSuffix("Wireframe","Wireframe",[!1,!0]);g.addDefine("ReceiveShadows","RECEIVE_SHADOWS");g.addDefine("ScreenSizePerspective","SCREEN_SIZE_PERSPECTIVE");c=new y("terrainNormal",["vsTerrainNormal","fsNormal"],null,a,c,e,aa);c.addDefine("Spherical","SPHERICAL");c.addDefine("AlphaZero","ALPHA_ZERO");ba={depth:a.get("depth"),depthShadowMap:a.get("depthShadowMap"),depthOnly:new K(aa,e.vsTerrainDepthOnly,e.fsTerrainDepthOnly,J.Default3D),highlight:new K(aa,e.vsTerrainHighlight,e.fsTerrainHighlight,
J.Default3D)};Z={color:g,normal:c};this._updatePrograms();za=new t(aa,d,a,this.resourceCounter,this.setNeedsRender.bind(this));this.renderTileBackground();Ga=new A(aa,{target:ea.TEXTURE_2D,pixelFormat:ea.RGBA,dataType:ea.UNSIGNED_BYTE,samplingMode:ea.NEAREST,width:4,height:4})};this.uninitializeRenderContext=function(a){null!=Ga&&(Ga.dispose(),Ga=null);za&&(za.dispose(),za=null)};this._updatePrograms=function(){var a="spherical"===e,b="shader"===la.mode;ba.color=Z.color.getProgram([a,!0,a&&da,b,ua,
b||ua,this.receiveShadows,F]);ba.normal=Z.normal.getProgram([a,!0]);this.setNeedsRender()};this.install=function(a){a.addExternalRenderer([W,k],this)};this.uninstall=function(a){a.removeExternalRenderer(this)};this.setRootTiles=function(a){R=a;this.setNeedsRender()};this.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};this.setStencilEnabledLayerExtents=function(a){Qa=a;this.setNeedsRender()};this.setTileSize=function(a){d=a;za&&(za.tileSize=a);this.setNeedsRender()};this.loadTile=
function(a){S(null===a.renderData);a.renderData=ha.acquire();a.renderData.init();var b=this.getLocalOriginOfTile(a),d=a.createGeometry(a.renderData.updateGeometryState(a),b,"debug"===la.mode,a.renderData.geometryInfo);a.renderData.localOrigin=b;this._setTileGeometry(a,d);Fa&&za.updateTileTexture(a)};this.queryVisibleLevelRange=function(a,b,d,e){var c=Za.acquire();O.set(a,c.extent);c.minLevel=b?b:-Number.MAX_VALUE;c.maxLevel=null!=d?d:Number.MAX_VALUE;c.callback=e;Ua.push(c);this.setNeedsRender()};
this.updateTileTexture=function(a){za&&Fa&&za.updateTileTexture(a)};this.updateTileGeometryNeedsUpdate=function(a){return a.renderData.updateGeometryState(a).needsUpdate};this._updateTileGeometry=function(a){for(var b=a.renderData.geometryState,d=a.layerInfo[f.LayerClass.ELEVATION],e=0;e<d.length;e++)d[e].pendingUpdates&=~f.TileUpdateTypes.UPDATE_GEOMETRY;return b.needsUpdate?(a.renderData.vao&&this._releaseTileGeometry(a),b=a.createGeometry(b,a.renderData.localOrigin,"debug"===la.mode,a.renderData.geometryInfo),
this._setTileGeometry(a,b),!0):!1};this.updateTileGeometry=function(a){a.renderData.updateGeometryState(a);return this._updateTileGeometry(a)};this.unloadTile=function(a){this._releaseTileGeometry(a);a.renderData.texture&&a.renderData.texture.dispose();ha.release(a.renderData);a.renderData=null};this.getLocalOriginOfTile=function(a){if(10<=a.lij[0]){for(;7<a.lij[0];)a=a.parent;return a.centerAtSeaLevel}if("spherical"===e)return ca;for(;a.parent;)a=a.parent;return a.centerAtSeaLevel};this.setVisibility=
function(a){wa=a;this.setNeedsRender()};this.getStats=function(){return{numTilesRendered:Ta,numTilesCulled:Ha,numTrianglesRendered:Wa,numOriginsRendered:Xa}};this.setDisableRendering=function(a){ya=!!a;this.setNeedsRender()};this.getOpacity=function(){return oa};this.getWireframeEnabled=function(){return"shader"===la.mode};this.setDebugScreenSizePerspective=function(a){a!==F&&(F=a,this._updatePrograms())};this.setWireframe=function(a){a&&!0!==a||(a={mode:a?"shader":"none"});if(void 0!==a.mode&&la.mode!==
a.mode){var b="debug"===la.mode,e="debug"===a.mode;la.mode=a.mode;this._updatePrograms();b!==e&&R&&r.traverseTilesPreorder(R,function(a){if(a.renderData){a.renderData.vao&&this._releaseTileGeometry(a);var b=a.createGeometry(a.renderData.updateGeometryState(a),a.renderData.localOrigin,e,a.renderData.geometryInfo);this._setTileGeometry(a,b)}}.bind(this))}for(var c in a)la.hasOwnProperty(c)&&(la[c]=a[c]),this.setNeedsRender();la.resolution&&(la.resolution=Math.min(la.resolution,d),la.resolution=1<<Math.round(Math.log(la.resolution)/
Math.LN2))};this.setOpacity=function(a){oa=a;this.setNeedsRender()};this.setDrawSkirts=function(a){ta=a;this.setNeedsRender()};this.setCullBackFaces=function(a){ra=a;this.setNeedsRender()};this.setRenderOrder=function(a){Aa=a;this.setNeedsRender()};this.setBorders=function(a){ua!==a&&(ua=a,this._updatePrograms())};this.setFrontMostTransparent=function(a){qa!==a&&(qa=a,this.setNeedsRender())};this.setVelvetOverground=function(a){da!==a&&(da=a,this._updatePrograms())};this.setNeedsRender=function(){this.needsRender=
!0;this.didRender=!1;ma=!0};this.resetNeedsRender=function(){this.didRender&&(this.needsRender=0!==Ua.length,this.didRender=!1)};var ka=P.create();this.isTransparent=function(){return 1>oa||"shader"===la.mode&&(1>la.wireOpacity||1>la.surfaceOpacity)};this._renderMaterialPass=function(a,b){var d=this.isTransparent(),e=a.shadowMap&&a.shadowMap.getEnableState();this.receiveShadows!=e&&(this.receiveShadows=e,this._updatePrograms());e=a.camera;aa.setDepthTestEnabled(!0);aa.setBlendingEnabled(d);d&&aa.setBlendFunctionSeparate(ea.SRC_ALPHA,
ea.ONE_MINUS_SRC_ALPHA,ea.ONE,ea.ONE_MINUS_SRC_ALPHA);d&&qa?(d=ba.depthOnly,aa.bindProgram(d),aa.setColorMask(!1,!1,!1,!1),aa.setDepthWriteEnabled(!0),this._renderTilesAuxilliary(a,d,b),aa.setColorMask(!0,!0,!0,!0),aa.setDepthFunction(ea.EQUAL),aa.setDepthWriteEnabled(!1)):aa.setDepthFunction(ea.LESS);d=ba.color;aa.bindProgram(d);d.setUniform1f("opacity",oa);if("shader"===la.mode||ua)d.setUniform1f("wireframe.width",la.width),d.setUniform1f("wireframe.falloff",Math.min(la.width,la.falloff)),d.setUniform1f("wireframe.wireOpacity",
la.wireOpacity*oa),d.setUniform1f("wireframe.surfaceOpacity",la.surfaceOpacity*oa),d.setUniform4fv("wireframe.color",la.color);e=a.camera;a.shadowMap&&a.shadowMap.bind(d);a.ssaoHelper&&a.ssaoHelper.setUniforms(d);d.setUniform1i("tex",4);d.setUniform1i("overlayTex",5);d.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);d.setUniformMatrix4fv("proj",e.projectionMatrix);a.lightingData.helper.setUniforms(d,!0);e=e.viewMatrix;P.set3(e[12],e[13],e[14],ka);P.normalize(ka);d.setUniform3fv("viewDirection",
ka);for(Xa=Wa=Ha=Ta=0;pa.length<pa.data.length&&0<Ua.length;)e=Ua.pop(),pa.push(e);Ra=pa.length;this._renderTiles(a,d,b);aa.setBlendingEnabled(!1);aa.setDepthFunction(ea.LESS);aa.setDepthWriteEnabled(!0);for(a=0;a<pa.length;a++)b=pa.data[a],Za.release(b),b.callback(a>=Ra),b.callback=null;pa.clear();0<Ta&&!Ya&&(Ya=!0,this.loaded&&this.loaded())};this._renderDepthPass=function(a,b,d){var e=a.camera;aa.bindProgram(b);aa.setBlendingEnabled(!1);aa.setDepthTestEnabled(!0);aa.setDepthFunction(ea.LESS);b.setUniformMatrix4fv("model",
T);b.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);V[0]=e.near;V[1]=e.far;b.setUniform2fv("nearFar",V);this._renderTilesAuxilliary(a,b,d)};this._renderNormalPass=function(a,b){var d=a.camera,e=ba.normal;aa.bindProgram(e);aa.setBlendingEnabled(!1);aa.setDepthTestEnabled(!0);aa.setDepthFunction(ea.LESS);e.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);this._renderTilesAuxilliary(a,e,b)};this._renderHighlightPass=function(a,b){var d=ba.highlight;aa.bindProgram(d);aa.setBlendingEnabled(!1);
aa.setDepthTestEnabled(!0);aa.setDepthFunction(ea.LESS);var e=a.offscreenRenderingHelper;aa.bindTexture(e.getDepthTexture(),6);d.setUniform1i("depthTex",6);d.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height);this._renderTilesAuxilliary(a,d,b,!0)};this.render=function(a){if(G&&!ya&&wa&&R&&Fa){var b=this.isTransparent()?k:W;if(a.slot===b){n.trace("# BEGIN RENDER TERRAIN");b=a.pass;aa.setFaceCullingEnabled(ra);var d=1===a.lightingData.helper.globalFactor;b===E.MATERIAL?this._renderMaterialPass(a,
this._updatePerOriginTileData()):b===E.MATERIAL_DEPTH_SHADOWMAP&&this.castShadows&&d?this._renderDepthPass(a,ba.depthShadowMap,this._updatePerOriginTileData()):b===E.MATERIAL_DEPTH?this._renderDepthPass(a,ba.depth,this._updatePerOriginTileData()):b===E.MATERIAL_NORMAL?this._renderNormalPass(a,this._updatePerOriginTileData()):b===E.MATERIAL_HIGHLIGHT&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),aa.clear(aa.gl.DEPTH_BUFFER_BIT));ra&&aa.setFaceCullingEnabled(!1);
n.trace("# END RENDER TERRAIN");return!0}}};this._updatePerOriginTileData=function(){if(!ma)return ga;Y=null;this._renderCollectOrigins();if(0!==Aa){for(var a=0;a<ga.length;a++)this._sortFrontToBack(ga.data[a].tiles,m);this._sortFrontToBack(ga,u)}ma=!1;return ga};this._renderCollectOrigins=function(){ga.clear();for(var a=0;a<R.length;a++){var b=R[a],d=ga.next();d.root=b;d.origin="spherical"===e?ca:b.centerAtSeaLevel;d.tiles.clear();this._renderCollectOriginsForRoot(d)}return!0};this._renderCollectOriginsForRoot=
function(a){for(fa.reset(a.root);!fa.done;){var b=fa.next(),d=b.renderData;if(d&&!b.visible)Ha++,fa.skip();else{var e=ga.peek();if(7===b.lij[0]){if(e===a||0!==e.tiles.length)e=ga.next(),e.tiles.clear();e.root=b;e.origin=b.centerAtSeaLevel}if(d){10<=b.lij[0]?ga.peek().tiles.push(b):a.tiles.push(b);if(!Y||b.vlevel>Y.vlevel)Y=b;fa.skip()}}}};this._sortFrontToBack=function(a,b){a.sort(b)};this._updateStencilReadStateForTile=function(a,b){if(a.stencilRenderingHelper&&a.stencilRenderingHelper.getEnableState()){for(var d=
!1,e=0;e<Qa.length;e++)if(b.intersectsExtent(Qa[e])){d=!0;break}d?a.stencilRenderingHelper.enableStencilRead():a.stencilRenderingHelper.disableStencilRead()}};this._renderTilesAuxilliary=function(a,b,d,e){var c=a.camera,g=c.viewMatrix,h=a.rctx;b.setUniformMatrix4fv("proj",c.projectionMatrix);e&&b.setUniform1i("overlayTex",5);for(c=0;c<d.length;c++){var k=d.data[c];b.setUniform3fv("origin",k.origin);w.bindView(k.origin,g,b);for(var f=0;f<k.tiles.length;f++){var l=k.tiles.data[f],m=l.renderData;e&&
(m.highlightOverlayTexId?Ia(b,m,m.highlightOverlayTexId):h.bindTexture(Ga,5));this._updateStencilReadStateForTile(a,l);h.bindVAO(m.vao);Q.assertCompatibleVertexAttributeLocations(m.vao,b);l=m.vao.indexBuffer.size;ta||(l=m.geometryInfo.numWithoutSkirtIndices);h.drawElements(ea.TRIANGLES,l,m.vao.indexBuffer.indexType,0)}}h.bindVAO(null);h.stencilRenderingHelper&&h.stencilRenderingHelper.disableStencilRead()};this._renderTiles=function(a,b,c){var h=a.camera.viewMatrix;if(F){var k=M.getSettings(e);k.update({distance:g.distanceToSurface,
fovY:g.fovY});w.bindScreenSizePerspective(k,b,"screenSizePerspective")}for(k=0;k<c.length;k++){var f=c.data[k];b.setUniform3fv("origin",f.origin);w.bindView(f.origin,h,b);a.shadowMap&&a.shadowMap.bindView(b,f.origin);Xa++;var l=f.tiles;if(0!==l.length){var m=ea.TRIANGLES;"debug"===la.mode&&(m=ea.LINES);var q=Y,p;q?(q=q.vlevel,p=d/la.resolution):(q=16,p=d/64);for(var u=0;u<l.length;u++){var t=l.data[u],f=t.renderData;this._updateStencilReadStateForTile(a,t);n.trace("# RENDER TILE "+t.lij[0]+"/"+t.lij[1]+
"/"+t.lij[2]+", screenDepth:"+t.screenDepth);b.setUniform2fv("texOffset",f.texOffset);b.setUniform1f("texScale",f.texScale);aa.bindTexture(f.textureReference||f.texture,4);f.overlayTexId?Ia(b,f,f.overlayTexId):(b.setUniform2fv("overlayTexOffset",U),aa.bindTexture(Ga,5));("shader"===la.mode||ua)&&b.setUniform1f("wireframe.subdivision",p*(1<<q-t.vlevel));var r=f.vao.indexBuffer.size;ta||(r=f.geometryInfo.numWithoutSkirtIndices);aa.bindVAO(f.vao);Q.assertCompatibleVertexAttributeLocations(f.vao,b);aa.drawElements(m,
r,f.vao.indexBuffer.indexType,0);t.renderOrder=Ta;Ta++;Wa+=r/3;f=t.extent;t=t.lij[0];for(r=0;r<Ra;){var v=pa.data[r],x=v.extent;t>=v.minLevel&&t<=v.maxLevel&&x[0]<=f[2]&&x[2]>=f[0]&&x[1]<=f[3]&&x[3]>=f[1]?(pa.swap(r,Ra-1),Ra--):r++}}}}aa.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};var Ia=function(a,b,d){var e=ja[d];e||(e=C.aquire(d).getGLTexture(),S(e),ja[d]=e);a.setUniform2fv("overlayTexOffset",b.overlayTexOffset);a.setUniform2fv("overlayTexScale",b.overlayTexScale);
a.setUniform1f("overlayOpacity",b.overlayOpacity);aa.bindTexture(e,5)},Ja=P.create(),Ka=P.create(),Sa=P.create(),$a=this.clippingExtent;this.intersect=function(a,b,d){if(R&&(!a.isSelection||!this.isTransparent())&&a.enableTerrain){P.subtract(d,b,Ja);var e=a.getMinResult(),c=a.getMaxResult();fa.reset(R);for(var g={};!fa.done;){var h=fa.next();if(null!==h.renderData){if(a.enableInvisibleTerrain){if(!h.visible&&$a&&!h.intersectsExtent($a))continue}else if(!h.visible)continue;var k=h.renderData.geometryInfo.geometry,
f=h.renderData.localOrigin;P.subtract(b,f,Ka);P.subtract(d,f,Sa);w.intersectTriangleGeometry(k,g,void 0,a,Ka,Sa,function(b,d,g){if((ta||!(3*g>=h.renderData.geometryInfo.numWithoutSkirtIndices))&&0<=b&&(a.enableBackfacesTerrain||0>P.dot(d,Ja))){if(void 0===e.dist||b<e.dist)g=r.lij2str(h.lij[0],h.lij[1],h.lij[2]),e.set(void 0,g,b,d,void 0),e.setIntersector("terrain");if(void 0===c.dist||b>c.dist)g=r.lij2str(h.lij[0],h.lij[1],h.lij[2]),c.set(void 0,g,b,d,void 0),c.setIntersector("terrain")}})}}}};this._setTileGeometry=
function(b,d){b=b.renderData;var e=d.geometry.getData(),c=e.getVertexAttr().terrain.data,e=e.getFaces()[0].indices.terrain;b.vao=new x(aa,J.Default3D,{geometry:N.Pos3Tex},{geometry:I.createVertex(aa,ea.STATIC_DRAW,c)},I.createIndex(aa,ea.STATIC_DRAW,e));b.geometryInfo.geometry&&a.releaseGeometry(b.geometryInfo.geometry);b.geometryInfo=d;this.setNeedsRender()};this._releaseTileGeometry=function(b){b=b.renderData;b.vao.dispose(!0);b.vao=null;b.geometryInfo.geometry&&a.releaseGeometry(b.geometryInfo.geometry);
b.geometryInfo.geometry=null;this.setNeedsRender()}};C.TileRenderData=b;return C})},"esri/views/3d/terrain/TileRenderData":function(){define(["require","exports","../lib/glMatrix"],function(B,r,f){var a=f.vec2d;return function(){function b(){this.overlayTexOffset=a.create();this.texOffset=a.create();this.geometryInfo={geometry:null,numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0};this.init()}b.prototype.init=function(){this.geometryInfo.geometry=null;this.geometryInfo.numSurfaceIndices=
0;this.geometryInfo.numSkirtIndices=0;this.geometryInfo.numWithoutSkirtIndices=0;this.geometryInfo.numVertsPerRow=0;this.textureReference=this.texture=this.vao=this.geometryState=null;a.set2(0,0,this.texOffset);this.texScale=1;this.highlightOverlayTexId=this.overlayTexId=null;this.overlayTexScale=[1,1];this.overlayOpacity=1;this.localOrigin=null};b.prototype.updateGeometryState=function(a){return this.geometryState=a.geometryState(this.geometryState)};return b}()})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require",
"exports"],function(B,r){return function(){function f(){this._numTileTexturesComposited=0}Object.defineProperty(f.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},enumerable:!0,configurable:!0});f.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++};f.prototype.resetNumTileTexturesComposited=function(){this._numTileTexturesComposited=0};return f}()})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../lib/glMatrix ../../webgl/FramebufferObject ../../webgl/VertexArrayObject ../../webgl/Texture ../../webgl/BufferObject ../../webgl/Util ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../../vectorTiles/VectorTileDisplayObject ../../vectorTiles/tileRendererHelper3D ./TerrainConst".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z){var w=f.vec2d,u=Array(20),C=[0,0];return function(){function f(a,c,f,q,p){this._gridTex=null;this.tileSize=256;this._context=a;this.tileSize=c;this._resourceCounter=q;this._setNeedsRender=p;a.extensions.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,a.parameters.maxMaxAnisotropy));c=new Float32Array(20);c[0]=-1;c[1]=-1;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=-1;c[7]=0;c[8]=1;c[9]=0;c[10]=-1;c[11]=1;c[12]=0;c[13]=0;c[14]=1;c[15]=1;c[16]=1;c[17]=0;c[18]=1;c[19]=
1;this._vaoQuad=new b(a,h.Default3D,{geometry:l.Pos3Tex},{geometry:t.createVertex(a,35044,c)});this._blendLayersProgram=f.get("blendLayers")}f.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._gridTex&&(this._gridTex.dispose(),this._gridTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context&&(this._context=null)};f.prototype.updateTileTexture=function(a){for(var b=
z.LayerClass.MAP,c=a.layerInfo[b],h=0;h<c.length;h++)c[h].pendingUpdates&=~z.TileUpdateTypes.UPDATE_TEXTURE;if(a.renderData){var f,h=a.renderData,l,q=0,p=!0;for(l=0;l<c.length;l++){f=c[l];var t=a.parentSurface.layerViewByIndex(l,b);u[l]=t.fullOpacity;if(f.data||f.upsampleFromTile)if(q++,!t.isTransparent){p=!1;break}}l===c.length&&l--;0===q&&this._gridTex?(h.textureReference=this._gridTex,w.set2(0,0,h.texOffset),h.texScale=1):1!==q||p?(this._composeMapLayers(a,c,l,p,u),h.textureReference=null,w.set2(0,
0,h.texOffset),h.texScale=1):(f=c[l],f.data?(b=f,w.set2(0,0,h.texOffset),h.texScale=1):(a=f.upsampleFromTile,b=a.tile.layerInfo[b][l],w.set(a.offset,h.texOffset),h.texScale=a.scale),b&&(b.data instanceof HTMLImageElement&&(b.data=this._buildTexture(b.data)),h.textureReference=b.data));this._setNeedsRender()}};f.prototype.setGridImage=function(a){this._gridTex=this._buildTexture(a)};f.prototype._buildTexture=function(a){var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,
maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},h=this._context,f;if(a)try{f=new c(h,b,a)}catch(I){b.width=b.height=this.tileSize,f=new c(h,b),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}else b.width=b.height=this.tileSize,f=new c(h,b);h.bindTexture(f);f.generateMipmap();return f};f.prototype._drawVectorData=function(a,b,c,h,f,l,q,p){void 0===p&&(p=1);y(this._context,c,a,b.renderer,b.schemeHelper,c[0],h,f,0,l,q,p)};f.prototype._drawRasterData=
function(a,b,c,h){void 0===h&&(h=1);var f=this._context,l=this._blendLayersProgram,n=this._vaoQuad;f.bindProgram(l);f.bindVAO(n);p.assertCompatibleVertexAttributeLocations(n,l);f.bindTexture(a,0);l.setUniform1i("tex",0);l.setUniform1f("scale",b);l.setUniform2f("offset",c[0],c[1]);l.setUniform1f("opacity",h);f.drawArrays(5,0,p.vertexCount(n,"geometry"))};f.prototype._composeMapLayers=function(b,c,h,f,l){var n=z.LayerClass.MAP,p=this._context;b.renderData.texture||(b.renderData.texture=this._buildTexture());
var u=b.renderData.texture,t=this._fbo;t&&t.width===u.descriptor.width&&t.height===u.descriptor.height||(this._fbo=t=a.create(p,{colorTarget:0,depthStencilTarget:1,width:u.descriptor.width,height:u.descriptor.height}));var r=p.gl;p.bindFramebuffer(t);p.setViewport(0,0,this.tileSize,this.tileSize);p.setClearColor(0,0,0,0);p.setClearDepth(1);p.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);p.setDepthTestEnabled(!1);p.setBlendFunctionSeparate(1,771,1,771);p.setBlendEquation(32774);p.setBlendingEnabled(!0);
var w,x;for(f&&this._gridTex&&this._drawRasterData(this._gridTex,1,C);0<=h;h--)if(f=null,t=c[h],t.data?(f=t,w=C,x=1):t.upsampleFromTile&&(x=t.upsampleFromTile,f=x.tile.layerInfo[n][h],w=x.offset,x=x.scale),f){if(f.data instanceof HTMLImageElement||f.data instanceof HTMLCanvasElement)f.data=this._buildTexture(f.data);f.data instanceof q?(t=b.parentSurface.layerViewByIndex(h,n),this._drawVectorData(f.data,t,b.lij,u.descriptor.width,u.descriptor.height,x,w,l[h])):this._drawRasterData(f.data,x,w,l[h])}p.bindTexture(u);
r.copyTexImage2D(p.gl.TEXTURE_2D,0,u.descriptor.pixelFormat,0,0,u.descriptor.width,u.descriptor.height,0);u.generateMipmap();p.bindFramebuffer(null);p.setBlendFunctionSeparate(770,771,1,771);p.setBlendingEnabled(!1);this._resourceCounter.incrementNumTileTexturesComposited()};return f}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","dojo/has","../../core/libs/gl-matrix/vec3","../../core/libs/gl-matrix/mat4"],function(B,r,f,a,b){var c={extent:{xmin:0,ymin:0,
xmax:0,ymax:0,spatialReference:{wkid:102100,isWrappable:!0},intersects:function(a){return!1}},center:[0,0],scale:1,resolution:1,rotation:0,width:1,height:1,pixelRatio:1,size:[256,256],spatialReference:{wkid:102100,isWrappable:!0},worldScreenWidth:1,viewpoint:{},toMap:function(a,b){return[0,0]},toScreen:function(a,b){return[0,0]},clone:function(){return null},copy:function(a){return this}},t=a.create();return function(a,h,l,q,r,z,w,u,C,E,G,n){C=[h[0],h[1],h[2]];for(var p=E;1>p;p*=2)C[0]--,C[1]>>=1,
C[2]>>=1;h={context:a,budget:null,state:c,stationary:!0,devicePixelRatio:1,displayLevel:r.adjustLevel(z),requiredLevel:r.adjustLevel(h[0]),drawphase:0,renderer:q,layerOpacity:n};if(w!==u)throw Error("It is expected that tiles are square!");z=1/E;n=r.getSchemaShift(C,z);p=n[1];l.tileTransform.displayCoord[0]=-1-2*z*G[0]-n[0];l.tileTransform.displayCoord[1]=1+2*z*(1-G[1]-E)+p;E=l.tileTransform.transform;b.identity(E);r.isWGS84&&512===r.lockedSchemaPixelSize&&(z*=2);r=.25*z/w;t.set([r,-r,1]);b.scale(E,
E,t);a.setBlendFunctionSeparate(1,771,1,771);a.setClearDepth(1);a.clear(a.gl.DEPTH_BUFFER_BIT);h.state.size=[w,u];h.state.width=w;h.state.height=u;q.setStateParams(h.state,h.devicePixelRatio,C[0]);l.attach(h);a.setFaceCullingEnabled(!1);a.setDepthFunction(515);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);l.processRender(h);a.setDepthWriteEnabled(!1);a.setBlendingEnabled(!0);h.drawphase=1;l.processRender(h);h.drawphase=2;l.processRender(h);f("esri-vector-tiles-debug")&&
q.renderTileInfo(a,l);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!1);a.setFaceCullingEnabled(!0)}})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(B){var r={create:function(){var f=new B.ARRAY_TYPE(3);f[0]=0;f[1]=0;f[2]=0;return f},clone:function(f){var a=new B.ARRAY_TYPE(3);a[0]=f[0];a[1]=f[1];a[2]=f[2];return a},fromValues:function(f,a,b){var c=new B.ARRAY_TYPE(3);c[0]=f;c[1]=a;c[2]=b;return c},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];return f},set:function(f,
a,b,c){f[0]=a;f[1]=b;f[2]=c;return f},add:function(f,a,b){f[0]=a[0]+b[0];f[1]=a[1]+b[1];f[2]=a[2]+b[2];return f},subtract:function(f,a,b){f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];return f}};r.sub=r.subtract;r.multiply=function(f,a,b){f[0]=a[0]*b[0];f[1]=a[1]*b[1];f[2]=a[2]*b[2];return f};r.mul=r.multiply;r.divide=function(f,a,b){f[0]=a[0]/b[0];f[1]=a[1]/b[1];f[2]=a[2]/b[2];return f};r.div=r.divide;r.ceil=function(f,a){f[0]=Math.ceil(a[0]);f[1]=Math.ceil(a[1]);f[2]=Math.ceil(a[2]);return f};r.floor=
function(f,a){f[0]=Math.floor(a[0]);f[1]=Math.floor(a[1]);f[2]=Math.floor(a[2]);return f};r.min=function(f,a,b){f[0]=Math.min(a[0],b[0]);f[1]=Math.min(a[1],b[1]);f[2]=Math.min(a[2],b[2]);return f};r.max=function(f,a,b){f[0]=Math.max(a[0],b[0]);f[1]=Math.max(a[1],b[1]);f[2]=Math.max(a[2],b[2]);return f};r.round=function(f,a){f[0]=Math.round(a[0]);f[1]=Math.round(a[1]);f[2]=Math.round(a[2]);return f};r.scale=function(f,a,b){f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;return f};r.scaleAndAdd=function(f,a,b,
c){f[0]=a[0]+b[0]*c;f[1]=a[1]+b[1]*c;f[2]=a[2]+b[2]*c;return f};r.distance=function(f,a){var b=a[0]-f[0],c=a[1]-f[1];f=a[2]-f[2];return Math.sqrt(b*b+c*c+f*f)};r.dist=r.distance;r.squaredDistance=function(f,a){var b=a[0]-f[0],c=a[1]-f[1];f=a[2]-f[2];return b*b+c*c+f*f};r.sqrDist=r.squaredDistance;r.length=function(f){var a=f[0],b=f[1];f=f[2];return Math.sqrt(a*a+b*b+f*f)};r.len=r.length;r.squaredLength=function(f){var a=f[0],b=f[1];f=f[2];return a*a+b*b+f*f};r.sqrLen=r.squaredLength;r.negate=function(f,
a){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];return f};r.inverse=function(f,a){f[0]=1/a[0];f[1]=1/a[1];f[2]=1/a[2];return f};r.normalize=function(f,a){var b=a[0],c=a[1],t=a[2],b=b*b+c*c+t*t;0<b&&(b=1/Math.sqrt(b),f[0]=a[0]*b,f[1]=a[1]*b,f[2]=a[2]*b);return f};r.dot=function(f,a){return f[0]*a[0]+f[1]*a[1]+f[2]*a[2]};r.cross=function(f,a,b){var c=a[0],t=a[1];a=a[2];var p=b[0],h=b[1];b=b[2];f[0]=t*b-a*h;f[1]=a*p-c*b;f[2]=c*h-t*p;return f};r.lerp=function(f,a,b,c){var t=a[0],p=a[1];a=a[2];f[0]=t+c*(b[0]-t);f[1]=
p+c*(b[1]-p);f[2]=a+c*(b[2]-a);return f};r.hermite=function(f,a,b,c,t,p){var h=p*p,l=h*(2*p-3)+1,q=h*(p-2)+p,r=h*(p-1);p=h*(3-2*p);f[0]=a[0]*l+b[0]*q+c[0]*r+t[0]*p;f[1]=a[1]*l+b[1]*q+c[1]*r+t[1]*p;f[2]=a[2]*l+b[2]*q+c[2]*r+t[2]*p;return f};r.bezier=function(f,a,b,c,t,p){var h=1-p,l=h*h,q=p*p,r=l*h,l=3*p*l,h=3*q*h;p*=q;f[0]=a[0]*r+b[0]*l+c[0]*h+t[0]*p;f[1]=a[1]*r+b[1]*l+c[1]*h+t[1]*p;f[2]=a[2]*r+b[2]*l+c[2]*h+t[2]*p;return f};r.random=function(f,a){a=a||1;var b=2*B.RANDOM()*Math.PI,c=2*B.RANDOM()-
1,t=Math.sqrt(1-c*c)*a;f[0]=Math.cos(b)*t;f[1]=Math.sin(b)*t;f[2]=c*a;return f};r.transformMat4=function(f,a,b){var c=a[0],t=a[1];a=a[2];var p=b[3]*c+b[7]*t+b[11]*a+b[15],p=p||1;f[0]=(b[0]*c+b[4]*t+b[8]*a+b[12])/p;f[1]=(b[1]*c+b[5]*t+b[9]*a+b[13])/p;f[2]=(b[2]*c+b[6]*t+b[10]*a+b[14])/p;return f};r.transformMat3=function(f,a,b){var c=a[0],t=a[1];a=a[2];f[0]=c*b[0]+t*b[3]+a*b[6];f[1]=c*b[1]+t*b[4]+a*b[7];f[2]=c*b[2]+t*b[5]+a*b[8];return f};r.transformQuat=function(f,a,b){var c=a[0],t=a[1],p=a[2];a=
b[0];var h=b[1],l=b[2];b=b[3];var q=b*c+h*p-l*t,r=b*t+l*c-a*p,z=b*p+a*t-h*c,c=-a*c-h*t-l*p;f[0]=q*b+c*-a+r*-l-z*-h;f[1]=r*b+c*-h+z*-a-q*-l;f[2]=z*b+c*-l+q*-h-r*-a;return f};r.rotateX=function(f,a,b,c){var t=[],p=[];t[0]=a[0]-b[0];t[1]=a[1]-b[1];t[2]=a[2]-b[2];p[0]=t[0];p[1]=t[1]*Math.cos(c)-t[2]*Math.sin(c);p[2]=t[1]*Math.sin(c)+t[2]*Math.cos(c);f[0]=p[0]+b[0];f[1]=p[1]+b[1];f[2]=p[2]+b[2];return f};r.rotateY=function(f,a,b,c){var t=[],p=[];t[0]=a[0]-b[0];t[1]=a[1]-b[1];t[2]=a[2]-b[2];p[0]=t[2]*Math.sin(c)+
t[0]*Math.cos(c);p[1]=t[1];p[2]=t[2]*Math.cos(c)-t[0]*Math.sin(c);f[0]=p[0]+b[0];f[1]=p[1]+b[1];f[2]=p[2]+b[2];return f};r.rotateZ=function(f,a,b,c){var t=[],p=[];t[0]=a[0]-b[0];t[1]=a[1]-b[1];t[2]=a[2]-b[2];p[0]=t[0]*Math.cos(c)-t[1]*Math.sin(c);p[1]=t[0]*Math.sin(c)+t[1]*Math.cos(c);p[2]=t[2];f[0]=p[0]+b[0];f[1]=p[1]+b[1];f[2]=p[2]+b[2];return f};r.forEach=function(){var f=r.create();return function(a,b,c,t,p,h){b||(b=3);c||(c=0);for(t=t?Math.min(t*b+c,a.length):a.length;c<t;c+=b)f[0]=a[c],f[1]=
a[c+1],f[2]=a[c+2],p(f,f,h),a[c]=f[0],a[c+1]=f[1],a[c+2]=f[2];return a}}();r.angle=function(f,a){f=r.fromValues(f[0],f[1],f[2]);a=r.fromValues(a[0],a[1],a[2]);r.normalize(f,f);r.normalize(a,a);a=r.dot(f,a);return 1<a?0:Math.acos(a)};r.str=function(f){return"vec3("+f[0]+", "+f[1]+", "+f[2]+")"};r.exactEquals=function(f,a){return f[0]===a[0]&&f[1]===a[1]&&f[2]===a[2]};r.equals=function(f,a){var b=f[0],c=f[1];f=f[2];var t=a[0],p=a[1];a=a[2];return Math.abs(b-t)<=B.EPSILON*Math.max(1,Math.abs(b),Math.abs(t))&&
Math.abs(c-p)<=B.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))&&Math.abs(f-a)<=B.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return r})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(B,r,f,a){return function(){function b(a){this.parent=null;this.lij=a;this.layerInfo=Array(f.LayerClass.LAYER_CLASS_COUNT)}b.prototype.tileDataAvailable=function(a,b,f){return(b=this.layerInfo[f][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],
a.lij[2]):!0};b.prototype.modifyLayers=function(b,f,p){b=f.length;for(var c=this.layerInfo[p],l=Array(b),q=0;q<b;q++){var t=f[q];l[q]=-1<t?c[t]:new a(p)}this.layerInfo[p]=l};return b}()})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/watchUtils ../../../../core/HandleRegistry ../../../../core/Logger ../../support/aaBoundingRect ../../support/PreallocArray ./deconflictorDebug ../../lib/glMatrix ../../webgl-engine/lib/Util ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/materials/internal/MaterialUtil ../../webgl-engine/materials/HUDMaterial".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w){function u(a){return!!a&&"selection"===a.type}var C=l.vec2d;B=l.vec4d;var E=q.VertexAttrConstants,G=c.getLogger("esri.views.3d.graphics.Deconflictor"),n=B.create(),A=B.create(),x=B.create(),I=B.create(),K=C.create(),J=t.create(),N=t.create(),M=new Set,Q=q.lerp,S=new p(100),P=new p(100),O=function(){function a(a,b){this.creator=a;this.disposer=b;this.list=[];this.currentIndex=0}a.prototype.alloc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];
this.currentIndex>=this.list.length&&this.list.push(new this.creator(a));return this.list[this.currentIndex++]};a.prototype.freeAll=function(){for(var a=this.currentIndex,b=this.disposer,e=this.list;0<=--a;)b(e[a]);this.currentIndex=0};return a}(),T=function(){function a(){this.graphics3DGraphic=null;this.positions=[C.create(),C.create(),C.create(),C.create()];this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.graphicsOwner=null;this.graphicId=this.id=0}a.release=function(a){a.graphics3DGraphic=
null;a.graphicsOwner=null};return a}();c=function(){function c(c){var h=this;this.graphicsOwners=[];this.deconflictTimeoutId=0;this.handles=new b;this.graphicInfoPool=new O(T,T.release);this.nextGraphicInfoId=0;this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this.iconMarginFactor=-.1;this.view=c;this.stage=c._stage;this.handles.add([a.on(c,"navigation","targetViewChanged",function(){return h.scheduleRun()}),a.whenNot(c,"ready",function(){return h.clearDeconflictTimeout()})])}
c.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.clearDeconflictTimeout();this.graphicInfoPool.freeAll();this.stage=this.view=this.graphicInfoPool=null};c.prototype.clearDeconflictTimeout=function(){this.deconflictTimeoutId&&(clearTimeout(this.deconflictTimeoutId),this.deconflictTimeoutId=0)};c.prototype.addGraphicsOwner=function(a){var b=this;this.graphicsOwners.push(a);this.setDirty();a.layer&&"function"===typeof a.layer.watch&&a.layer.watch("featureReduction",function(e,
d){u(e)?b.setDirty():u(d)&&(b._removeIconVisibilityFlags(a),b.setDirty())})};c.prototype.removeGraphicsOwner=function(a){a=this.graphicsOwners.indexOf(a);0<=a&&this.graphicsOwners.splice(a,1);this.setDirty()};c.prototype.setDirty=function(){this.scheduleRun(10)};c.prototype.initializeLabelVisibility=function(a){a.setVisibilityFlag(2,!1,1)};c.prototype.doesIntersectExistingPoly=function(a){var b=a.graphicId,e=a.positions;M.clear();for(var d=Math.floor(a.xMin/this.accBinsSizeX);d<=Math.floor(a.xMax/
this.accBinsSizeX);d++)if(!(0>d||d>=this.accBinsNumX))for(var c=Math.floor(a.yMin/this.accBinsSizeY);c<=Math.floor(a.yMax/this.accBinsSizeY);c++)if(!(0>c||c>=this.accBinsNumY)){var h=this.accBins[d][c],k=0;a:for(;k<h.length;k++){var f=h.data[k];if(f.graphicId!==b&&!M.has(f.id)){M.add(f.id);f=f.positions;this.accNumTests++;for(var l=0;2>l;l++){var n=0===l?e:f,q=0===l?f:e,p=0;b:for(;4>p;p++){var u=n[p],t=n[(p+1)%4],r=n[(p+2)%4];K[0]=t[0]-u[0];K[1]=t[1]-u[1];t=C.normalize(K);x=[-t[1],t[0]];t[0]=x[0];
t[1]=x[1];u=t[0]*u[0]+t[1]*u[1];r=t[0]*r[0]+t[1]*r[1]<u;for(x=0;4>x;x++){var w=q[x],w=t[0]*w[0]+t[1]*w[1];if(r&&w<u||!r&&w>u)continue b}continue a}}return!0}}}return!1;var x};c.prototype.initBins=function(a,b){if(null==this.accBins){this.accBins=[];for(var e=0;e<this.accBinsNumX;e++){this.accBins.push([]);for(var d=this.accBins[this.accBins.length-1],c=0;c<this.accBinsNumY;c++)d.push(new p(10))}}for(e=0;e<this.accBinsNumX;e++)for(c=0;c<this.accBinsNumY;c++)this.accBins[e][c].clear();this.accBinsSizeX=
a/this.accBinsNumX;this.accBinsSizeY=b/this.accBinsNumY;this.accNumTests=0};c.prototype.addToBins=function(a){for(var b=Math.floor(a.xMin/this.accBinsSizeX);b<=Math.floor(a.xMax/this.accBinsSizeX);b++)if(!(0>b||b>=this.accBinsNumX))for(var e=Math.floor(a.yMin/this.accBinsSizeY);e<=Math.floor(a.yMax/this.accBinsSizeY);e++)0>e||e>=this.accBinsNumY||this.accBins[b][e].push(a)};c.prototype.scheduleRun=function(a){var b=this;void 0===a&&(a=200);0===this.deconflictTimeoutId&&(this.deconflictTimeoutId=setTimeout(function(){return b.run()},
a))};c.prototype.run=function(){var a=this.view;this.clearDeconflictTimeout();if(a.ready){var b=a.navigation.targetCamera;this.graphicInfoPool.freeAll();this.nextGraphicInfoId=0;var e=b.fullWidth,d=b.fullHeight;h.prepare(a);S.clear();P.clear();for(var a=!1,c=0;c<this.graphicsOwners.length;c++){var k=this.graphicsOwners[c];if(null!=k.getGraphics3DGraphics&&null!=k.getGraphics3DGraphicsKeys){var f=null!=k.labelsEnabled&&k.labelsEnabled(),l=u(k.layer?k.layer.featureReduction:null);if(f||l){a||(this.initBins(e,
d),a=!0);for(var n=k.getGraphics3DGraphics(),q=k.getGraphics3DGraphicsKeys(),p=0;p<q.length;p++){var t=n[q[p]];t.areVisibilityFlagsSet(void 0,2)&&(l&&this._collectGraphics(t,!1,k,b,S,this.iconMarginFactor),f&&this._collectGraphics(t,!0,k,b,P))}}}}S.sort(function(a,b){return b.posView-a.posView});P.sort(function(a,b){return b.posView-a.posView});this._deconflictVisibleObjects(S,!1);P.length&&this._deconflictVisibleObjects(P,!0);h.drawAccelerationStruct(this,S);h.drawAccelerationStruct(this,P)}else this.setDirty()};
c.prototype._collectGraphics=function(a,b,e,d,c,h){void 0===h&&(h=0);var g=b?a._labelGraphics:a._graphics,k=b?1:0;if(g.length){b=t.set(J,t.NEGATIVE_INFINITY);for(var f,l,m,q=0;q<g.length;q++){var p=g[q];if(!p.isDraped()){var u=p.stageObject,r=u?u.getNumGeometryRecords():0;if(!(1>r)){var C=u.getGeometryRecord(0),K=C.materials[0];if(K instanceof w)if(1<r)G.warn("Graphic objects with more than 1 geometry record are not supported");else{r=C.geometry.getData().getVertexAttr();if(!l){l=u.getCenter();m=
C.origin.vec3;l=z.transformToWorld(l,m,n);l=z.transformToView(l,m,d.viewMatrix,A);K.applyVerticalOffsetTransformation(l,r[E.NORMAL].data,u.objectTransformation,d,U);u=r[E.AUXPOS1].data;r="screen"!==K.getParams().centerOffsetUnits;m=z.transformToProjection(l,d.projectionMatrix,r?u:[0,0,0],x);m=z.transformToNDC(m,I);r||(m[0]+=u[0]/d.fullWidth*2,m[1]+=u[1]/d.fullHeight*2);if(-1>m[0]||-1>m[1]||-1>m[2]||1<=m[0]||1<=m[1])break;f=l[2];a.areVisibilityFlagsSet(2,void 0,k)&&(f*=.7)}p=p.getScreenSize(W);y.applyPrecomputedScaleFactorVec2(p,
U.factor,p);K=t.offset(K.calculateRelativeScreenBounds(p,U.scaleAlignment,N),Q(0,d.fullWidth,.5+.5*m[0]),Q(0,d.fullHeight,.5+.5*m[1]));0!==h&&(p=h*Math.min(t.width(K),t.height(K)),K[0]-=p,K[1]-=p,K[2]+=p,K[3]+=p);t.expand(b,K)}}}}null!=f&&(d=this.graphicInfoPool.alloc(),d.id=this.nextGraphicInfoId++,d.graphicId=a.graphic.uid,d.xMin=b[0],d.yMin=b[1],d.xMax=b[2],d.yMax=b[3],d.positions[0][0]=b[0],d.positions[0][1]=b[1],d.positions[1][0]=b[0],d.positions[1][1]=b[3],d.positions[2][0]=b[2],d.positions[2][1]=
b[3],d.positions[3][0]=b[2],d.positions[3][1]=b[1],d.graphics3DGraphic=a,d.posView=f,d.graphicsOwner=e,c.push(d))}};c.prototype._deconflictVisibleObjects=function(a,b){for(var e=b?1:0,d=0;d<a.length;d++){var c=a.data[d],k=c.graphics3DGraphic,f=!(b&&!1===k.areVisibilityFlagsSet(2,void 0))&&!this.doesIntersectExistingPoly(c);f&&this.addToBins(c);k.setVisibilityFlag(2,f,e);h.drawPoly(c.positions,f?"green":"red")}};c.prototype._removeIconVisibilityFlags=function(a){if(null!=a.getGraphics3DGraphics&&null!=
a.getGraphics3DGraphicsKeys){var b=a.getGraphics3DGraphics(),e=0;for(a=a.getGraphics3DGraphicsKeys();e<a.length;e++)b[a[e]].setVisibilityFlag(2,void 0)}};return c}();var U={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},W=C.create();return c})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../lib/glMatrix","../../support/debugFlags"],function(B,r,f,a,b){function c(a,
b){if(p){var c=l.height,h=q;h.beginPath();h.lineWidth=1;h.strokeStyle=b;h.moveTo(a[0][0],c-a[0][1]);for(b=1;4>b;b++)h.lineTo(a[b][0],c-a[b][1]),h.stroke();h.lineTo(a[0][0],c-a[0][1]);h.stroke();h.closePath()}}Object.defineProperty(r,"__esModule",{value:!0});var t=a.vec2d,p=!1,h=!1,l,q;r.drawAccelerationStruct=function(a,b){if(h&&q){for(var f=q,l=[t.create(),t.create(),t.create(),t.create()],p=0,r=0;r<a.accBinsNumX;r++)for(var y=0;y<a.accBinsNumY;y++){var n=a.accBins[r][y],p=p+n.length,z=r*a.accBinsSizeX,
x=(r+1)*a.accBinsSizeX,I=y*a.accBinsSizeY,K=(y+1)*a.accBinsSizeY;l[0][0]=z;l[0][1]=I;l[1][0]=x;l[1][1]=I;l[2][0]=x;l[2][1]=K;l[3][0]=z;l[3][1]=K;f.fillText(n.length.toFixed(),z+5,I+15);c(l,"blue")}f.fillText("total totalShownLabels: "+p,70,40);f.fillText("total visible labels: "+b.length,70,50);f.fillText("total numTests: "+a.accNumTests,70,30)}};r.prepare=function(a){p=b.DECONFLICTOR_SHOW_OUTLINES;h=b.DECONFLICTOR_SHOW_GRID;if(p||h)null==l&&(l=document.createElement("canvas"),l.setAttribute("id",
"canvas2d"),a.surface.parentElement.style.position="relative",a.surface.parentElement.appendChild(l)),l.setAttribute("width",a.width+"px"),l.setAttribute("height",a.height+"px"),l.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;"),q=l.getContext("2d"),q.clearRect(0,0,a.width,a.height),q.font="8px Arial"};r.drawPoly=c})},"esri/views/3d/layers/GraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../layers/GraphicsView ./graphics/Graphics3DCore ./graphics/Graphics3DSpatialIndex ./graphics/Graphics3DElevationAlignment ../support/PromiseLightweight ../../../core/promiseUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q){return function(c){function r(){var a=null!==c&&c.apply(this,arguments)||this;a.graphicsCore=null;a.spatialIndex=null;a.elevation=null;a.supportsDraping=!0;a._overlayUpdating=!1;a._eventHandles=[];return a}f(r,c);Object.defineProperty(r.prototype,"graphics",{set:function(a){a!==this.loadedGraphics&&(this.loadedGraphics=a);this._set("graphics",a)},enumerable:!0,configurable:!0});r.prototype.initialize=function(){var a=this;this.mockLayerId="__sceneView.graphics-"+Date.now().toString(16);
this.spatialIndex=new p;this.spatialIndex.whenLoaded().then(function(){return a.deferredInitialize()})};r.prototype.deferredInitialize=function(){var a=this;if(!this.destroyed){this.loadedGraphics=this.graphics;this.graphicsCore=new t;this.elevation=new h;var b={id:this.mockLayerId,uid:this.mockLayerId};this.spatialIndex.initialize(this,b,this.view.spatialReference,this.graphicsCore);this.elevation.initialize(this,function(b,c,h){a.spatialIndex.intersects(b,c,h)},this.graphicsCore,this.view.elevationProvider);
this.graphicsCore.initialize(this,b,this.elevation,null,this.spatialIndex,null,null,null,null,this.view.basemapTerrain);this._eventHandles.push(this.view.watch("clippingArea",function(){return a.updateClippingExtent()}));this.updateClippingExtent();this.view.resourceController.registerIdleFrameWorker(this,{needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate})}};r.prototype.destroy=function(){this._eventHandles.forEach(function(a){return a.remove()});this._eventHandles=null;this.view.resourceController.deregisterIdleFrameWorker(this);
this.spatialIndex&&(this.spatialIndex.destroy(),this.spatialIndex=null);this.elevation&&(this.elevation.destroy(),this.elevation=null);this.graphicsCore&&(this.graphicsCore.destroy(),this.graphicsCore=null);this.loadedGraphics=null};r.prototype.getGraphicsFromStageObject=function(a,b){var c=a.getMetadata().graphicId,h=null;this.loadedGraphics&&this.loadedGraphics.some(function(a){return a.uid===c?(h=a,!0):!1});a=new l.Promise;null!==h?a.done(h):a.reject();return a};r.prototype.whenGraphicBounds=function(a){var b=
this;return this.spatialIndex?this.spatialIndex.whenLoaded().then(function(){return b.graphicsCore?b.graphicsCore.whenGraphicBounds(a):q.reject()}):q.reject()};r.prototype._needsIdleUpdate=function(){return this.elevation.needsIdleUpdate()};r.prototype._idleUpdate=function(a){this.elevation.idleUpdate(a)};r.prototype._notifySuspendedChange=function(){};r.prototype._notifyDrapedDataChange=function(){this.view.basemapTerrain&&this.view.basemapTerrain.overlayManager.setOverlayDirty()};r.prototype._evaluateUpdatingState=
function(){if(this.elevation){var a;a=0+this.elevation.numNodesUpdating();a+=this.graphicsCore.numNodesUpdating();this.updating=a=(a=(a=0<a||this._overlayUpdating)||this.spatialIndex.isUpdating())||this.graphicsCore.needsIdleUpdate()}else this.updating=!1};r.prototype.updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};a([b.property()],r.prototype,"graphics",null);a([b.property()],r.prototype,
"loadedGraphics",void 0);a([b.property({value:!0})],r.prototype,"updating",void 0);a([b.property({value:!1})],r.prototype,"suspended",void 0);return r=a([b.subclass("esri.views.3d.layers.GraphicsView3D")],r)}(b.declared(c))})},"esri/views/layers/GraphicsView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/Collection ../../Graphic".split(" "),function(B,r,f,a,b,c,t,
p){return function(c){function h(){var a=null!==c&&c.apply(this,arguments)||this;a.graphics=null;a.renderer=null;a.view=null;return a}f(h,c);a([b.property({type:t.ofType(p)})],h.prototype,"graphics",void 0);a([b.property()],h.prototype,"renderer",void 0);a([b.property()],h.prototype,"view",void 0);return h=a([b.subclass("esri.views.layers.GraphicsView")],h)}(b.declared(c))})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/watchUtils ../../../../core/arrayUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../support/projectionUtils ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/rendererConversion ../../../../renderers/support/diffUtils ../../../../geometry/Point ../../../../geometry/Extent ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/Layer ../../webgl-engine/lib/FloatingBoxLocalOriginFactory ../../../../symbols/WebStyleSymbol ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/support/symbolConversion ../../../../symbols/support/unitConversionUtils ../../lib/glMatrix ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DWebStyleSymbol ./graphicUtils ./Graphics3DSymbolFactory ./Graphics3DOwner ./ElevationQuery ../../support/aaBoundingBox ../../support/mathUtils dojo/Deferred".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q,S,P,O,T,U,W,k,ca){function V(a){(a=a.elevationInfo&&a.elevationInfo.unit)&&!J.supportsUnit(a)&&g.warn("elevationInfo.unit","'"+a+"' is not a valid unit")}B=N.vec3d;var e=new w,d=B.create(),g=p.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");return function(){function m(a){void 0===a&&(a=!0);this.elevationFeatureExpressionEnabled=a;this.graphics={};this.graphicsDrapedIds={};this.graphicsBySymbol={};this.graphicsKeys=[];this.symbols=
{};this.graphicsWithoutSymbol={};this.computedExtent=null;this.symbolCreationContext=new T.Graphics3DSymbolCreationContext;this.hasDraped=!1;this.updatingGraphicIds=new Set;this.graphicTransformFunc=this.onComputedExtentChange=this.stage=this.labelStageLayer=this.stageLayer=this.tilingSchemeHandle=this.lastFastUpdate=null;this.eventHandles=[];this.sharedSymbolResourcesOwnerHandle=this.highlights=this.elevationQueryService=this.labeling=this.spatialIndex=this.scaleVisibility=this.elevation=this.layer=
this.layerView=this.viewSR=null;this.whenGraphics3DGraphicRequests={}}m.prototype.initialize=function(a,d,e,c,h,k,f,l,n,q){var p=this;this.layerView=a;this.layer=d;this.viewSR=a.view.spatialReference;this.elevation=e;this.scaleVisibility=c;this.spatialIndex=h;this.labeling=k;this.highlights=f;this.onComputedExtentChange=l;this.graphicTransformFunc=n;var u=this.layerView.view;this.elevationQueryService=new U.ElevationQuery(this.viewSR,function(){return u.map.ground},{maximumAutoTileRequests:4});this.initializeStage(u,
this.layer.uid);this.symbolCreationContext.sharedResources=u.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=u.sharedSymbolResources.addGraphicsOwner(this);this.symbolCreationContext.renderer=this.layer.renderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=u.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=u.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=u.renderCoordsHelper;this.symbolCreationContext.layer=
this.layer;this.symbolCreationContext.layerView=this.layerView;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=m.createLocalOriginFactory();this.symbolCreationContext.elevationProvider=u.elevationProvider;V(this.layer);d=M.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=M.createContext(d,this.viewSR,g);u.deconflictor.addGraphicsOwner(this);this.symbolCreationContext.screenSizePerspectiveEnabled=
u.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.tilingSchemeHandle=b.when(q,"tilingScheme",function(a){a.spatialReference.equals(p.symbolCreationContext.overlaySR)||(p.symbolCreationContext.overlaySR=q.spatialReference,p.recreateAllGraphics())});this.eventHandles.push(this.layerView.watch("suspended",function(){return p.suspendedChange()}));this.eventHandles.push(this.layerView.watch("layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled",function(){p.symbolCreationContext.screenSizePerspectiveEnabled=
u.screenSizePerspectiveEnabled&&p.layer.screenSizePerspectiveEnabled;p.recreateAllGraphics()}));this.eventHandles.push(b.on(a,"loadedGraphics","change",function(a){return p.graphicsCollectionChanged(a)},function(){p.clearSymbolsAndGraphics();p.graphicsCollectionChanged({added:p.layerView.loadedGraphics.toArray(),removed:[]})}));this.validateRenderer(this.layer.renderer)};m.prototype.destroy=function(){var a=this;this.layerView.view.deconflictor.removeGraphicsOwner(this);this.clear();if(this.stage){var b=
[this.stageLayer.getId()];this.labelStageLayer&&b.push(this.labelStageLayer.getId());this.stage.removeFromViewContent(b);b.forEach(function(b){return a.stage.remove(C.ModelContentType.LAYER,b)});this.stage=this.labelStageLayer=this.stageLayer=null}this.tilingSchemeHandle&&(this.tilingSchemeHandle.remove(),this.tilingSchemeHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.layerView=this.labeling=this.scaleVisibility=this.viewSR=this.onComputedExtentChange=this.eventHandles=
null;for(var d in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[d].reject(new t("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null)};m.prototype.clear=function(){var a=!1,b;for(b in this.graphics){var d=this.graphics[b],a=a||d.isDraped();d.destroy()}this.graphics={};this.graphicsKeys=null;for(var e in this.symbols)(b=
this.symbols[e])&&b.destroy();this.symbols={};this.graphicsBySymbol={};this.graphicsWithoutSymbol={};this.hasDraped=!1;a&&this.layerView._notifyDrapedDataChange()};m.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new G(b,{state:this.layerView.suspended?"HIDDEN":"VISIBLE"},b);this.stage.add(C.ModelContentType.LAYER,this.stageLayer);a=[this.stageLayer.getId()];this.labeling&&(this.labelStageLayer=new G(b,{state:this.layerView.suspended?"HIDDEN":"IGNORED"},b+"_labels"),this.stage.add(C.ModelContentType.LAYER,
this.labelStageLayer),a.push(this.labelStageLayer.getId()));this.stage.addToViewContent(a)};m.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b={},d={},e;for(e in this.graphics)this.graphics[e].setDrawOrder(a,b,d);for(var c in d)(d=this.symbols[c])&&d.setDrawOrder(a,b);E.objectEmpty(b)||(this.stage.getTextureGraphicsRenderer().updateRenderOrder(b),this.layerView._notifyDrapedDataChange())};m.prototype.suspendedChange=function(){!0===this.layerView.suspended?(this.stageLayer.setState("HIDDEN"),
this.labelStageLayer&&this.labelStageLayer.setState("HIDDEN"),this.hideAllGraphics()):!1===this.layerView.suspended&&(this.stageLayer.setState("VISIBLE"),this.labelStageLayer&&this.labelStageLayer.setState("IGNORED"),this.updateAllGraphicsVisibility())};m.prototype.getGraphics3DGraphics=function(){return this.graphics};m.prototype.getGraphics3DGraphicById=function(a){return this.graphics[a]};m.prototype.getGraphics3DGraphicsKeys=function(){null===this.graphicsKeys&&(this.graphicsKeys=Object.keys(this.graphics));
return this.graphicsKeys};m.prototype.labelsEnabled=function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())};m.prototype.getSymbolUpdateType=function(){var a=0,b=0,d=0,e;for(e in this.symbols){var c=this.symbols[e];c&&(c=c.getFastUpdateStatus(),a+=c.loading,d+=c.fast,b+=c.slow)}return 0<a?"unknown":0<=d&&0===b?"fast":0<=b&&0===d?"slow":"mixed"};m.prototype.numNodesUpdating=function(){return this.updatingGraphicIds.size};m.prototype.needsIdleUpdate=function(){return!!this.lastFastUpdate&&
500<performance.now()-this.lastFastUpdate};m.prototype.idleUpdate=function(a){a.done()||(this.lastFastUpdate&&(this.labeling&&this.labeling.updateLabelingInfo(),this.lastFastUpdate=null),this.layerView._evaluateUpdatingState())};m.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics[a.uid];if(b)return h.resolve(b);b=this.whenGraphics3DGraphicRequests[a.uid];b||(b=new ca,this.whenGraphics3DGraphicRequests[a.uid]=b);return b.promise};m.prototype.boundsForGraphics3DGraphic=function(b){return a(this,
void 0,void 0,function(){var a,c,g,h,k,m,n,q,p;return f(this,function(f){switch(f.label){case 0:return a=this.layerView.view.spatialReference,c=this.layerView.view.renderSpatialReference,g=this.layerView.view.basemapTerrain.spatialReference,h=function(b,d,e){return l.bufferToBuffer(b,c,d,b,a,d,e)},k=function(b,d,e){return l.bufferToBuffer(b,g,d,b,a,d,e)},[4,b.getProjectedBoundingBox(h,k,this.elevationQueryService)];case 1:m=f.sent();if(!m)return[2,null];n=m.boundingBox;m.requiresDrapedElevation&&
(q=this.symbolCreationContext.elevationProvider)&&(W.center(n,d),e.x=d[0],e.y=d[1],e.z=void 0,e.spatialReference=a,p=q.getElevation(e)||0,n[2]=Math.min(n[2],p),n[5]=Math.max(n[5],p));return[2,{boundingBox:n,screenSpaceObjects:m.screenSpaceObjects}]}})})};m.prototype.whenGraphicBounds=function(a){var d=this;return b.whenOnce(this.layerView,"loadedGraphics").then(function(){var b=d.layerView.layer&&d.layerView.layer.objectIdField,e=d.layerView.loadedGraphics.find(function(d){return d===a||b&&d.attributes&&
a.attributes&&d.attributes[b]===a.attributes[b]?!0:!1});if(e)return d.whenGraphics3DGraphic(e);throw new t("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return d.boundsForGraphics3DGraphic(a)})};m.prototype.graphicsCollectionChanged=function(a){var b=this.graphicTransformFunc?this.graphicTransformFunc(a.added):a.added;this.add(b);this.remove(a.removed)};m.prototype.graphicUpdateHandler=function(a){var b=this.graphics[a.graphic.uid];if(b)switch(a.property){case "visible":b.setVisibilityFlag(0,
a.newValue)&&(b.isDraped()&&this.layerView._notifyDrapedDataChange(),this.labeling&&this.layerView.view.deconflictor.setDirty())}};m.prototype.beginGraphicUpdate=function(a){this.updatingGraphicIds.add(a.uid);"symbolsUpdating"in this.layerView&&!this.layerView.get("symbolsUpdating")&&this.layerView.set("symbolsUpdating",!0);this.layerView._evaluateUpdatingState()};m.prototype.endGraphicUpdate=function(a){a&&this.updatingGraphicIds.delete(a.uid);"symbolsUpdating"in this.layerView&&this.layerView.get("symbolsUpdating")&&
0===this.updatingGraphicIds.size&&(this.layerView.view.flushDisplayModifications(),this.layerView.set("symbolsUpdating",!1));this.layerView._evaluateUpdatingState()};m.prototype.expandComputedExtent=function(a){var b,d,e,c,g,h;if("point"===a.type)b=d=a.x,e=c=a.y,a.z&&(g=h=a.z);else if("polygon"===a.type||"polyline"===a.type||"multipoint"===a.type){h=a.extent;if(!h)return;b=h.xmin;d=h.xmax;e=h.ymin;c=h.ymax;g=h.zmin;h=h.zmax}var f=this.viewSR,n=m.tmpVec;!a.spatialReference.equals(f)&&l.xyzToVector(b,
e,0,a.spatialReference,n,f)&&(b=n[0],e=n[1],l.xyzToVector(d,c,0,a.spatialReference,n,f),d=n[0],c=n[1]);if(k.isFinite(b)&&k.isFinite(d)&&k.isFinite(e)&&k.isFinite(c)){(f=this.computedExtent)?(b<f.xmin&&(f.xmin=b),d>f.xmax&&(f.xmax=d),e<f.ymin&&(f.ymin=e),c>f.ymax&&(f.ymax=c)):this.computedExtent=f=new u(b,e,d,c,a.spatialReference);if(k.isFinite(g)&&!k.isFinite(h)){if(null==f.zmin||g<f.zmin)f.zmin=g;if(null==f.zmax||h>f.zmax)f.zmax=h}this.onComputedExtentChange&&this.onComputedExtentChange()}};m.prototype.updateHasDraped=
function(){this.hasDraped=!1;for(var a in this.graphicsDrapedIds)if(this.graphicsDrapedIds.hasOwnProperty(a)){this.hasDraped=!0;break}};m.prototype.elevationInfoChange=function(){V(this.layer);var a=M.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=M.createContext(a,this.viewSR,g);this.labeling&&this.labeling.elevationInfoChange();this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);
for(var b in this.graphicsBySymbol){var d=this.symbols[b],a=this.graphicsBySymbol[b];if(d&&d.layerPropertyChanged("elevationInfo",a)){for(var e in a){var c=a[e],d=c.graphic,c=c._labelGraphics;this.elevation&&this.elevation.markGraphicElevationDirty(d.uid);for(var h=0;h<c.length;h++){var k=c[h];k.graphics3DSymbolLayer.updateGraphicElevationInfo(d,k)}}this.layerView._evaluateUpdatingState()}else this._recreateSymbol(b)}};m.prototype.clearSymbolsAndGraphics=function(){this.clear();this.elevation&&this.elevation.clear();
this.labeling&&this.labeling.clear()};m.prototype.recreateAllGraphics=function(){this.clearSymbolsAndGraphics();this.computedExtent=null;this.onComputedExtentChange&&this.onComputedExtentChange();this.layerView.loadedGraphics&&this.layerView.view.basemapTerrain.tilingScheme&&this.add(this.layerView.loadedGraphics.toArray())};m.prototype._recreateSymbol=function(a){var b=this.graphicsBySymbol[a],d=[],e=!1,c;for(c in b){var g=b[c];g.isDraped()&&(delete this.graphicsDrapedIds[c],e=!0);d.push(g.graphic);
g.destroy();delete this.graphics[c]}this.graphicsBySymbol[a]={};(b=this.symbols[a])&&b.destroy();delete this.symbols[a];this.updateHasDraped();e&&this.layerView._notifyDrapedDataChange();this.add(d)};m.prototype.add=function(a){if(this.layerView.view.basemapTerrain&&this.layerView.view.basemapTerrain.tilingScheme){for(var b=a.length,d=Array(b),e=Array(b),c=Array(b),h=!1,k=0;k<b;k++){var f=a[k],l=f.geometry;if(l)if(this.expandComputedExtent(l),l=this.layerView.getRenderingInfo?this.layerView.getRenderingInfo(f):
{symbol:f.symbol},this.graphicsWithoutSymbol[f.uid]=f,l&&l.symbol){if(e[k]=l.symbol,c[k]=l,l=this.getOrCreateGraphics3DSymbol(e[k],l.renderer))d[k]=l,this.beginGraphicUpdate(f)}else h||(h=!0,g.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render"))}for(k=0;k<b;k++)this.waitForSymbol(d[k],e[k],a[k],c[k])}};m.prototype.waitForSymbol=function(a,b,d,e){var c=this;a&&a.then(function(){c.createGraphics3DGraphic(a,d,e);c.endGraphicUpdate(d);c.labeling&&c.layerView.view.deconflictor.setDirty()},
function(){c.endGraphicUpdate(d)})};m.prototype.remove=function(a){for(var b=!1,d=a.length,e=0;e<d;e++){var c=a[e].uid,g=this.graphics[c];if(g){g.isDraped()&&(delete this.graphicsDrapedIds[c],b=!0);var h=g.graphics3DSymbol.symbol.id;g.destroy();delete this.graphics[c];delete this.graphicsBySymbol[h][c];delete this.graphicsWithoutSymbol[c];this.graphicsKeys=null}}this.updateHasDraped();b&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()};m.prototype.hasLabelingContext=
function(a){if(a instanceof x||a instanceof I){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};m.prototype.hasValidSymbolCreationContext=function(a){return a instanceof x&&!this.hasLabelingContext(a)?(g.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};m.prototype.createGraphics3DSymbol=function(a,b){if(!this.hasValidSymbolCreationContext(a))return null;
a=K.to3D(a,!0,!1,this.hasLabelingContext(a));if(a.symbol){var d=void 0;b&&b.backgroundFillSymbol&&(b=K.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&(d=b.symbol.symbolLayers));return O.make(a.symbol,this.symbolCreationContext,d)}a.error&&g.error(a.error.message);return null};m.prototype.getOrCreateGraphics3DSymbol=function(a,b){var d=this,e=this.symbols[a.id];void 0===e&&(e=a instanceof A?new S(a,function(a){return d.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols[a.id]=
e);return e};m.prototype.createGraphics3DGraphic=function(a,b,d){delete this.graphicsWithoutSymbol[b.uid];if(!this.symbols[a.symbol.id])this.add([b]);else if(!this.graphics[b.uid]){d=a.createGraphics3DGraphic(b,d);this.graphics[b.uid]=d;this.graphicsKeys=null;this.graphicsBySymbol[a.symbol.id]||(this.graphicsBySymbol[a.symbol.id]={});this.graphicsBySymbol[a.symbol.id][b.uid]=d;d.initialize(this.stageLayer,this.stage);d.isDraped()&&(this.hasDraped=this.graphicsDrapedIds[b.uid]=!0,this.layerView._notifyDrapedDataChange());
d.centroid=null;"point"!==b.geometry.type&&d instanceof Q&&(d.centroid=P.computeCentroid(b.geometry,this.viewSR));a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.spatialIndex&&this.spatialIndex.shouldAddToSpatialIndex(b,d,a)&&this.spatialIndex.addGraphicToSpatialIndex(b,d);this.labeling&&this.labeling.layerLabelsEnabled()&&this.labeling.createLabelsForGraphic(b,d);a&&this.scaleVisibility.updateGraphicScaleVisibility(b,d);d.setVisibilityFlag(0,b.visible&&!this.layerView.suspended);
if(a=this.whenGraphics3DGraphicRequests[b.uid])delete this.whenGraphics3DGraphicRequests[b.uid],a.resolve(d);this.highlights&&this.highlights.graphicCreated(d)}};m.prototype.rendererChange=function(a){var b=this.symbolCreationContext.renderer;if(a!==b){this.validateRenderer(a);var d=z.diff(b,a);this.updateUnchangedSymbolMappings(d,a,b);this.symbolCreationContext.renderer=a;d&&("complete"===d.type?this.recreateAllGraphics():"partial"===d.type&&(this.applyRendererDiff(d,a,b)?this.volatileGraphicsUpdated():
this.recreateAllGraphics()))}};m.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":break;case "defaultSymbol":break;case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};m.prototype.applySymbolSetDiff=function(a,b,d,e){e=!1;a=a||[];b=b||[];for(var c=[],g=0;g<b.length;g++){var h=b[g],k=this.graphicsBySymbol[h.id],f;for(f in k){var l=k[f],m=l.graphic;if(h!==d.defaultSymbol||d.getSymbol(m)!==
d.defaultSymbol)l.isDraped()&&(delete this.graphicsDrapedIds[f],e=!0),a.length||d.defaultSymbol?c.push(m):this.graphicsWithoutSymbol[f]=m,l.destroy(),this.highlights&&this.highlights.graphicDeleted(this.graphics[f]),delete k[f],delete this.graphics[f],this.graphicsKeys=null}if(void 0===k||0===Object.keys(k).length)delete this.graphicsBySymbol[h.id],(k=this.symbols[h.id])&&k.destroy(),delete this.symbols[h.id]}if(a.length||c.length){for(f in this.graphicsWithoutSymbol)c.push(this.graphicsWithoutSymbol[f]);
this.graphicsWithoutSymbol={};this.add(c)}this.updateHasDraped();e&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()};m.prototype.applyUniqueValueRendererDiff=function(a,b,d){var e=a.diff.defaultSymbol,c=a.diff.uniqueValueInfos;if(e||c){var g=c?c.added.map(function(a){return a.symbol}):[],h=c?c.removed.map(function(a){return a.symbol}):[];if(c)for(var k=0;k<c.changed.length;k++)g.push(c.changed[k].newValue.symbol),h.push(c.changed[k].oldValue.symbol);e?(d.defaultSymbol&&
h.push(d.defaultSymbol),b.defaultSymbol&&g.push(b.defaultSymbol)):d.defaultSymbol&&g.length&&h.push(b.defaultSymbol);this.applySymbolSetDiff(g,h,b,d);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};m.prototype.calculateUnchangedSymbolMapping=function(a,b,d){if(b instanceof q&&d instanceof q)if(!a){if(d&&d.defaultSymbol)return[{oldId:d.defaultSymbol.id,newId:b.defaultSymbol.id}]}else if("partial"===a.type){var e=a.diff;a=e.defaultSymbol;var e=e.uniqueValueInfos,c=void 0,
c=e?e.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):d.uniqueValueInfos.map(function(a,d){return{oldId:a.symbol.id,newId:b.uniqueValueInfos[d].symbol.id}});!a&&d.defaultSymbol&&c.push({oldId:d.defaultSymbol.id,newId:b.defaultSymbol.id});return c}return[]};m.prototype.updateUnchangedSymbolMappings=function(a,b,d){var e=0;for(a=this.calculateUnchangedSymbolMapping(a,b,d);e<a.length;e++)if(d=a[e],b=d.oldId,d=d.newId,b&&b!==d){var c=this.graphicsBySymbol[b];
delete this.graphicsBySymbol[b];void 0!==c&&(this.graphicsBySymbol[d]=c);c=this.symbols[b];delete this.symbols[b];void 0!==c&&(this.symbols[d]=c,c.symbol.id=d)}};m.prototype.applyRendererDiff=function(a,b,d){var e=!1;if(this.diffHasSymbolChange(a))return!1;if(b instanceof q&&d instanceof q&&this.applyUniqueValueRendererDiff(a,b,d)&&0===Object.keys(a.diff).length)return!0;for(var c in this.graphicsBySymbol)if(d=this.symbols[c]){var g=this.graphicsBySymbol[c];if(!d.applyRendererDiff(a,b,g))return!1;
if(!e)for(var h in g)if(g[h].isDraped()){this.layerView._notifyDrapedDataChange();e=!0;break}}return!0};m.prototype.opacityChange=function(){var a=!1,b;for(b in this.graphicsBySymbol){var d=this.symbols[b];if(d){var e=this.graphicsBySymbol[b];d.layerPropertyChanged("opacity");if(!a)for(var c in e)if(e[c].isDraped()){this.layerView._notifyDrapedDataChange();a=!0;break}}}};m.prototype.setClippingExtent=function(a,b){var d=this.symbolCreationContext.clippingExtent,e=[];l.extentToBoundingRect(a,e,b)?
this.symbolCreationContext.clippingExtent=[e[0],e[1],-Infinity,e[2],e[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!c.equals(this.symbolCreationContext.clippingExtent,d)};m.prototype.forEachGraphics3DGraphic=function(a){var b=this;if(this.layerView.loadedGraphics){var d=!1,e=!1;this.layerView.loadedGraphics.forEach(function(c){var g=b.getGraphics3DGraphicById(c.uid);g&&a(g,c)&&(d=!0,e=e||g.isDraped())});d&&this.layerView.view.deconflictor.setDirty();e&&this.layerView._notifyDrapedDataChange()}};
m.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(b,d){var e=b.setVisibilityFlag(0,d.visible),c=!1;a.scaleVisibility&&(c=a.scaleVisibility.updateGraphicScaleVisibility(d,b));return e||c})};m.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1)})};m.prototype.validateRenderer=function(a){(a=y.validateTo3D(a))&&g.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+
this.layer.id+"' is not supported in a SceneView",a.message)};m.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=performance.now());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.layerView._evaluateUpdatingState()};m.createLocalOriginFactory=function(){return new n(5E6,16)};m.prototype.snapshotInternals=function(){var a=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),
graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:Object.keys(a.graphicsBySymbol[b]).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedIds:Object.keys(this.graphicsDrapedIds).sort()}};m.tmpVec=N.vec3d.create();return m}()})},"esri/core/tsSupport/generatorHelper":function(){define([],function(){return function(B,r){function f(b){return function(c){return a([b,c])}}function a(a){if(c)throw new TypeError("Generator is already executing.");
for(;b;)try{if(c=1,t&&(p=t[a[0]&2?"return":a[0]?"throw":"next"])&&!(p=p.call(t,a[1])).done)return p;if(t=0,p)a=[0,p.value];switch(a[0]){case 0:case 1:p=a;break;case 4:return b.label++,{value:a[1],done:!1};case 5:b.label++;t=a[1];a=[0];continue;case 7:a=b.ops.pop();b.trys.pop();continue;default:if(!(p=b.trys,p=0<p.length&&p[p.length-1])&&(6===a[0]||2===a[0])){b=0;continue}if(3===a[0]&&(!p||a[1]>p[0]&&a[1]<p[3]))b.label=a[1];else if(6===a[0]&&b.label<p[1])b.label=p[1],p=a;else if(p&&b.label<p[2])b.label=
p[2],b.ops.push(a);else{p[2]&&b.ops.pop();b.trys.pop();continue}}a=r.call(B,b)}catch(q){a=[6,q],t=0}finally{c=p=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var b={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},c,t,p,h;return h={next:f(0),"throw":f(1),"return":f(2)},"function"===typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h}})},"esri/core/tsSupport/awaiterHelper":function(){define(["dojo/Deferred","dojo/when"],function(B,r){return function(f,
a,b,c){function t(a){try{h(c.next(a))}catch(y){l.reject(y)}}function p(a){try{h(c["throw"](a))}catch(y){l.reject(y)}}function h(a){a.done?r(a.value).then(l.resolve,l.reject):r(a.value).then(t,p)}var l=new B;h((c=c.apply(f,a||[])).next());return l.promise}})},"esri/renderers/support/rendererConversion":function(){define(["require","exports","../../core/Error","../../symbols/support/symbolConversion"],function(B,r,f,a){function b(a,b){if(!b)return null;b=Array.isArray(b)?b:[b];if(0<b.length){var c=
b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});c.sort();var h=[];c.forEach(function(a,b){0!==b&&a===c[b-1]||h.push(a)});return new f("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+h.join(", ")+") which are not supported in 3D",{renderer:a,symbolErrors:b})}return null}function c(c){var h=c.uniqueValueInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),f=a.to3D(c.defaultSymbol);
f.error&&h.unshift(f.error);return b(c,h)}function t(c){var h=c.classBreakInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),f=a.to3D(c.defaultSymbol);f.error&&h.unshift(f.error);return b(c,h)}Object.defineProperty(r,"__esModule",{value:!0});r.validateTo3D=function(p){return p?"simple"===p.type?b(p,a.to3D(p.symbol).error):"unique-value"===p.type?c(p):"class-breaks"===p.type?t(p):new f("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+
(p.type||p.declaredClass)+"'",{renderer:p}):null}})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports dojo/has ./IdGen ./Octree ./PerformanceTimer ./Util ./gl-matrix ./ModelContentType".split(" "),function(B,r,f,a,b,c,t,p,h){var l=p.vec3d;return function(){function c(a,b,h){this._parentStages=[];this._children=[];this.id=c._idGen.gen(h);this.name=a;b=b||{};this.group=b.group||"";this.state=b.state||"VISIBLE";this.interaction=b.interaction||"PICKABLE";this.translation=l.create(b.translation);
this._extent=[l.createFrom(0,0,0),l.createFrom(1E3,1E3,1E3)];this._extentDirty=!0}c.prototype.getId=function(){return this.id};c.prototype.getParentStages=function(){return this._parentStages};c.prototype.addParentStage=function(a){-1===this._parentStages.indexOf(a)&&this._parentStages.push(a)};c.prototype.removeParentStage=function(a){a=this._parentStages.indexOf(a);-1<a&&this._parentStages.splice(a,1)};c.prototype.getName=function(){return this.name};c.prototype.getGroup=function(){return this.group};
c.prototype.getState=function(){return this.state};c.prototype.getInteraction=function(){return this.interaction};c.prototype.getTranslation=function(){return this.translation};c.prototype.getObjectIds=function(){return this._children.map(function(a){return a.getId()})};c.prototype.getObjects=function(){return this._children};c.prototype.setState=function(a){this.state=a};c.prototype.getExtent=function(){this._updateExtent();return this._extent};c.prototype.addObject=function(a){this._children.push(a);
a.addParentLayer(this);this.notifyDirty("layObjectAdded",a);this._invalidateExtent();this._spatialAccelerator&&this._spatialAccelerator.add(a)};c.prototype.hasObject=function(a){return-1<this._children.indexOf(a)};c.prototype.removeObject=function(a){return null!=t.arrayRemove(this._children,a)?(a.removeParentLayer(this),this.notifyDirty("layObjectRemoved",a),this._invalidateExtent(),this._spatialAccelerator&&this._spatialAccelerator.remove(a),!0):!1};c.prototype.replaceObject=function(a,b){var c=
this._children.indexOf(a);t.assert(-1<c,"Layer.replaceObject: layer doesn't contain specified object");this._children[c]=b;a.removeParentLayer(this);b.addParentLayer(this);this.notifyDirty("layObjectReplaced",[a,b]);this._invalidateExtent();this._spatialAccelerator&&(this._spatialAccelerator.remove(a),this._spatialAccelerator.add(b))};c.prototype.notifyObjectBBChanged=function(a,b){this._spatialAccelerator&&this._spatialAccelerator.update(a,b)};c.prototype.getCenter=function(){this._updateExtent();
var a=l.create();return l.lerp(this._extent[0],this._extent[1],.5,a)};c.prototype.getBSRadius=function(){this._updateExtent();return.5*l.dist(this._extent[0],this._extent[1])};c.prototype.getSpatialQueryAccelerator=function(){if(this._spatialAccelerator)return this._spatialAccelerator;if(50<this._children.length)return this._createOctree(),this._spatialAccelerator};c.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};c.prototype.invalidateSpatialQueryAccelerator=
function(){this._spatialAccelerator=null};c.prototype.notifyDirty=function(a,b,c,f){c=c||h.LAYER;f=f||this;for(var l=0;l<this._parentStages.length;l++)this._parentStages[l].notifyDirty(c,f,a,b)};c.prototype._createOctree=function(){for(var a=this.getExtent(),c=0,h=0;3>h;h++)c=Math.max(c,a[1][h]-a[0][h]);h=l.create();l.lerp(a[0],a[1],.5,h);this._spatialAccelerator=new b(h,1.2*c);this._spatialAccelerator.add(this._children)};c.prototype._invalidateExtent=function(){this._extentDirty=!0};c.prototype._updateExtent=
function(){if(this._extentDirty)if(0===this._children.length)this._extent=[[0,0,0],[0,0,0]];else{var a=this._children[0];this._extent=[l.create(a.getBBMin()),l.create(a.getBBMax())];for(a=0;a<this._children.length;++a)for(var b=this._children[a],c=b.getBBMin(),b=b.getBBMax(),h=0;3>h;++h)this._extent[0][h]=Math.min(this._extent[0][h],c[h]),this._extent[1][h]=Math.max(this._extent[1][h],b[h]);this._extentDirty=!1}};c._idGen=new a;return c}()})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ./gl-matrix ./Util dojo/has ./PerformanceTimer".split(" "),
function(B,r,f,a,b,c){function t(a,b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}var p=f.vec3d;B=function(){function b(a,b,c){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._autoResize=!0;this._outsiders=[];c&&(void 0!==c.maximumObjectsPerNode&&(this._maximumObjectsPerNode=c.maximumObjectsPerNode),void 0!==c.maximumDepth&&(this._maximumDepth=c.maximumDepth),void 0!==c.autoResize&&(this._autoResize=c.autoResize));isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||isNaN(b)?this._root=new h(null,
p.createFrom(0,0,0),.5):this._root=new h(null,a,b/2)}Object.defineProperty(b.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"outsiders",{get:function(){return this._outsiders.slice()},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"autoResize",{get:function(){return this._autoResize},enumerable:!0,configurable:!0});b.prototype.add=function(a){a=this._objectOrObjectsArray(a);this._grow(a);for(var b=h.acquire(),c=
0;c<a.length;c++){var f=a[c];b.init(this._root);0===f.getBSRadius()||isNaN(f.getBSRadius())||!this._autoResize&&!this._fitsInsideTree(this._boundingSphereFromObject(f,C))?this._outsiders.push(f):this._add(f,b)}h.release(b)};b.prototype.remove=function(b,c){b=this._objectOrObjectsArray(b);for(var f=h.acquire(),l=!0,n=0;n<b.length;n++){var l=b[n],p=this._boundingSphereFromObject(c||l,C);0===p.radius||isNaN(p.radius)||!this._autoResize&&!this._fitsInsideTree(p)?l=null!=a.arrayRemove(this._outsiders,
l):(f.init(this._root),l=this._remove(l,p,f))}h.release(f);this._shrink();return l};b.prototype.update=function(a,b){this.remove(a,b);this.add(a)};b.prototype.forEachAlongRay=function(b,c,h){this._forEachTest(function(h){t(h.center,2*-h.halfSize,z);t(h.center,2*h.halfSize,w);return a.rayBoxTest(b,c,z,w)},h)};b.prototype.forEachInBoundingBox=function(a,b,c){this._forEachTest(function(c){for(var h=2*c.halfSize,f=0;3>f;f++)if(c.center[f]+h<a[f]||c.center[f]-h>b[f])return!1;return!0},c)};b.prototype.forEachNode=
function(a){this._forEachNode(this._root,function(b){return a(b.node,b.center,2*b.halfSize)})};b.prototype._forEachTest=function(a,b){this._outsiders.forEach(b);this._forEachNode(this._root,function(c){return a(c)?(c=c.node,c.terminals.forEach(b),null!==c.residents&&c.residents.forEach(b),!0):!1})};b.prototype._forEachNode=function(a,b){a=h.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var f=0;f<a.node.children.length;f++)a.node.children[f]&&c.push(h.acquire().init(a).advance(f));
h.release(a)}};b.prototype._objectOrObjectsArray=function(a){Array.isArray(a)||(q[0]=a,a=q);return a};b.prototype._remove=function(b,c,h){u.length=0;h.advanceTo(c,function(a,b){u.push(a.node,b)})?(b=null!=a.arrayRemove(h.node.terminals,b),h=0===h.node.terminals.length):(b=null!=a.arrayRemove(h.node.residents,b),h=0===h.node.residents.length);if(h)for(h=u.length-2;0<=h&&this._purge(u[h],u[h+1]);h-=2);return b};b.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===
a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};b.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=[]),!0):!1};b.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,C))?b.node.terminals.push(a):(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};b.prototype._split=function(a){var b=a.node.residents;
a.node.residents=null;for(var c=0;c<b.length;c++){var f=h.acquire().init(a);this._add(b[c],f);h.release(f)}};b.prototype._grow=function(a){if(0!==a.length&&this._autoResize&&(a=this._boundingSphereFromObjects(a,this._boundingSphereFromObject,E),!isNaN(a.radius)&&0!==a.radius&&!this._fitsInsideTree(a)))if(this._nodeIsEmpty(this._root.node))p.set(a.center,this._root.center),this._root.halfSize=1.25*a.radius;else{var b=h.acquire();this._rootBoundsForRootAsSubNode(a,b);this._placingRootViolatesMaxDepth(b)?
this._rebuildTree(a,b):this._growRootAsSubNode(b);h.release(b)}};b.prototype._rebuildTree=function(a,b){var c=this;p.set(b.center,G.center);G.radius=b.halfSize;a=this._boundingSphereFromObjects([a,G],function(a){return a},n);b=h.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(b,function(a){c.add(a.node.terminals);null!==a.node.residents&&c.add(a.node.residents);return!0});h.release(b)};b.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,
function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};b.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,h=a.center;a=-Infinity;for(var f=this._root.center,l=this._root.halfSize,n=0;3>n;n++){var p=Math.max(0,Math.ceil((f[n]-l-(h[n]-c))/(2*l))),q=Math.max(0,Math.ceil((h[n]+c-(f[n]+l))/(2*l)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(p+q)*Math.LOG2E)));A[n].min=p;A[n].max=q}for(n=0;3>n;n++)p=A[n].min,q=A[n].max,
c=(a-(p+q))/2,p+=Math.ceil(c),q+=Math.floor(c),y[n]=f[n]-l-p*l*2+(q+p)*l;return b.initFrom(null,y,a*l,0)};b.prototype._growRootAsSubNode=function(a){var b=this._root.node;p.set(this._root.center,E.center);E.radius=this._root.halfSize;this._root.init(a);a.advanceTo(E,null,!0);a.node.children=b.children;a.node.residents=b.residents;a.node.terminals=b.terminals};b.prototype._shrink=function(){if(this._autoResize)for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=
0}};b.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,h=0;h<b.length&&null==a;)c=h++,a=b[c];for(;h<b.length;)if(b[h++])return-1;return c};b.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,h=a.center;return a.radius<=c&&h[0]>=b[0]-c&&h[0]<=b[0]+c&&h[1]>=b[1]-c&&h[1]<=b[1]+c&&h[2]>=b[2]-c&&h[2]<=b[2]+c};b.prototype._boundingSphereFromObject=function(a,b){p.set(a.getCenter(),
b.center);b.radius=a.getBSRadius();return b};b.prototype._boundingSphereFromObjects=function(a,b,c){if(1===a.length){var h=b(a[0],E);p.set(h.center,c.center);c.radius=h.radius}else{z[0]=Infinity;z[1]=Infinity;z[2]=Infinity;w[0]=-Infinity;w[1]=-Infinity;w[2]=-Infinity;for(var f=0;f<a.length;f++){var h=b(a[f],E),l=z,n=h.center,q=h.radius;l[0]=Math.min(l[0],n[0]-q);l[1]=Math.min(l[1],n[1]-q);l[2]=Math.min(l[2],n[2]-q);l=w;n=h.center;h=h.radius;l[0]=Math.max(l[0],n[0]+h);l[1]=Math.max(l[1],n[1]+h);l[2]=
Math.max(l[2],n[2]+h)}p.scale(p.add(z,w,c.center),.5);c.radius=Math.max(w[0]-z[0],w[1]-z[1],w[2]-z[2])/2}return c};return b}();var h=function(){function a(a,b,c,h){void 0===c&&(c=0);void 0===h&&(h=0);this.center=p.create();this.initFrom(a,b,c,0)}a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};a.prototype.initFrom=function(b,c,h,f){void 0===b&&(b=null);void 0===h&&(h=this.halfSize);void 0===f&&(f=this.depth);this.node=b||a.createEmptyNode();c&&p.set(c,this.center);
this.halfSize=h;this.depth=f;return this};a.prototype.advance=function(b){var c=this.node.children[b];c||(c=a.createEmptyNode(),this.node.children[b]=c);this.node=c;this.halfSize/=2;this.depth++;b=l[b];this.center[0]+=b[0]*this.halfSize;this.center[1]+=b[1]*this.halfSize;this.center[2]+=b[2]*this.halfSize;return this};a.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=
null);var h=this._childIndex(a);b&&b(this,h);this.advance(h)}};a.prototype.isLeaf=function(){return null!=this.node.residents};a.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};a.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,h=0;3>h;h++)b[h]<a[h]&&(c|=1<<h);return c};a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:[],residents:[]}};a.acquire=function(){if(0===this._pool.length)return new a;var b=this._pool[this._pool.length-
1];this._pool.length--;return b};a.release=function(a){this._pool.push(a)};a._pool=[];return a}(),l=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],q=[null],y=p.create(),z=p.create(),w=p.create(),u=[],C={center:p.create(),radius:0},E={center:p.create(),radius:0},G={center:p.create(),radius:0},n={center:p.create(),radius:0},A=[{min:0,max:0},{min:0,max:0},{min:0,max:0}];return B})},"esri/views/3d/webgl-engine/lib/FloatingBoxLocalOriginFactory":function(){define(["require",
"exports","./gl-matrix"],function(B,r,f){var a=f.vec3d;B=function(){function c(a,b){this._origins=[];this._boxSize=a;this._maxNumOrigins=b}c.prototype.getOrigin=function(f){for(var p=this._origins.length,h,l=!1,q=Number.MAX_VALUE,t=0;t<p;t++){var r=this._origins[t];a.subtract(f,r.vec3,b);b[0]=Math.abs(b[0]);b[1]=Math.abs(b[1]);b[2]=Math.abs(b[2]);var w=b[0]+b[1]+b[2];w<q&&(h=r,q=w,l=b[0]<this._boxSize&&b[1]<this._boxSize&&b[2]<this._boxSize)}l||h&&null!=this._maxNumOrigins&&!(this._origins.length<
this._maxNumOrigins)||(p=c.OFFSET,h={vec3:[f[0]+p,f[1]+p,f[2]+p],id:c.ORIGIN_PREFIX+this._origins.length},this._origins.push(h));return h};c.OFFSET=1.11;c.ORIGIN_PREFIX="fb_";return c}();var b=a.create();return B})},"esri/symbols/support/unitConversionUtils":function(){define(["require","exports","../../renderers/support/utils"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});r.supportsUnit=function(a){return null!=f.meterIn[a]};r.getMetersPerUnit=function(a){return 1/(f.meterIn[a]||
1)}})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require","exports","../../../../support/arcadeUtils"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});r.createContext=function(a,b,c){var t=null;a=a&&a.expression;"string"===typeof a&&(t="0"===a?0:null,null!=t?t={cachedResult:t}:(t=f.createSyntaxTree(a),f.dependsOnView(t)?(null!=c&&c.error("Expressions containing '$view' are not supported on ElevationInfo"),t={cachedResult:0}):t={arcade:{func:f.createFunction(t),
context:f.createExecContext(null,{sr:b})}}));return t};r.createFeature=function(a){return f.createFeature(a)};r.setContextFeature=function(a,b){null!=a&&null==a.cachedResult&&f.updateExecContext(a.arcade.context,b)};r.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var b=a.arcade,b=f.executeFunction(b.func,b.context);"number"!==typeof b&&(b=a.cachedResult=0);return b}return 0};r.extractExpressionInfo=function(a,b){void 0===b&&(b=!1);var c=(a=a&&a.featureExpressionInfo)&&
a.expression;b||"0"===c||(a=null);return a};r.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../support/aaBoundingBox ../../support/aaBoundingRect ./featureExpressionInfoUtils".split(" "),function(B,r,f,a,b,c,t,p,h){var l=new c(Array,function(a){return t.set(a,t.ZERO)},null,10,5),q=p.create();
return function(){function c(a,b,c){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var f=Array(2),l=0;l<f.length;l++)f[l]=Array(3);this._visibilityFlags=f;this._featureExpressionFeature=null;this.graphics3DSymbol=b;this.graphic=a;this._graphics=c;this._featureExpressionFeature=h.createFeature(a)}c.prototype.initialize=function(a,b){var c=this;this._layer=a;this._stage=b;this.forEachSymbolLayerGraphic(function(h){h.initialize(a,b);h.setVisibility(c.isVisible())})};
c.prototype.destroy=function(){this.forEachRenderedGraphic(function(a){return a.destroy()});this._graphics.length=0;this._labelGraphics.length=0;this._auxiliaryGraphics.length=0};c.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};c.prototype.addLabelGraphic=function(a,b,c){this._labelGraphics.push(a);a.initialize(b,c);a.setVisibility(this.isVisible(1))};c.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);
this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};c.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){b.isDraped()&&(a=!0)});return a};c.prototype.setDrawOrder=function(a,b,c){var h=this;c[this.graphics3DSymbol.symbol.id]=!0;this.forEachSymbolLayerGraphic(function(f,l){f.setDrawOrder(a+(1-(1+l)/h._graphics.length),b,c)})};c.prototype.areVisibilityFlagsSet=function(a,b,c){void 0===c&&(c=0);c=this._visibilityFlags[c];if(null!=a)return c[a];
a=!0;for(var h=0;h<c.length;h++)if(h!==b){var f=c[h];a=a&&(null==f||!0===f)}return a};c.prototype.isVisible=function(a){void 0===a&&(a=0);for(var b=!0,c=0;c<=a;c++)for(var h=this._visibilityFlags[c],f=0;f<h.length;f++)var l=h[f],b=b&&(null==l||!0===l);return b};c.prototype.setVisibilityFlag=function(a,b,c){void 0===c&&(c=0);var h=this.isVisible(c);this._visibilityFlags[c][a]=b;var f=this.isVisible(c);if(h!==f){if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(f)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(f)});
var l=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(l)})}return!0}return!1};c.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};c.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()};c.prototype.getProjectedBoundingBox=function(c,h,u,r){return a(this,void 0,void 0,function(){var w=this;return f(this,function(y){switch(y.label){case 0:return r||(r={boundingBox:null,
requiresDrapedElevation:!1,screenSpaceObjects:[]}),r.boundingBox?t.set(r.boundingBox,t.NEGATIVE_INFINITY):r.boundingBox=t.create(t.NEGATIVE_INFINITY),r.requiresDrapedElevation=!1,[4,b.forEach(this._graphics,function(b){return a(w,void 0,void 0,function(){var a,n,p;return f(this,function(f){switch(f.label){case 0:if(!b)return[2];a=b.isDraped()?h:c;n=l.acquire();return[4,b.getProjectedBoundingBox(a,u,n,r.screenSpaceObjects)];case 1:return p=f.sent(),isFinite(p[2])&&isFinite(p[5])||(r.requiresDrapedElevation=
!0),p&&t.expand(r.boundingBox,n),l.release(n),[2]}})})})];case 1:return y.sent(),t.allFinite(r.boundingBox)||p.allFinite(t.toRect(r.boundingBox,q))?[2,r]:[2,null]}})})};c.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var c=b[a];if(c&&c.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((c=b[a])&&c.needsElevationUpdates)return!0;return!1};c.prototype.alignWithElevation=function(a,b){var c=this;this.forEachRenderedGraphic(function(h){h.alignWithElevation(a,
b,c._featureExpressionFeature)})};c.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,b)})};c.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};c.prototype.forEachGraphicList=function(a,b){a.forEach(function(a,c){return a&&b(a,c)})};c.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};c.prototype.forEachLabelGraphic=
function(a){this.forEachGraphicList(this._labelGraphics,a)};c.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return c}()})},"esri/core/asyncUtils":function(){define(["require","exports","./tsSupport/generatorHelper","./tsSupport/awaiterHelper","./promiseUtils"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});r.forEach=function(c,t,p){return a(this,void 0,void 0,function(){return f(this,function(a){switch(a.label){case 0:return[4,
b.eachAlways(c.map(function(a,b){return t.apply(p,[a,b])}))];case 1:return a.sent(),[2]}})})};r.map=function(c,t,p){return a(this,void 0,void 0,function(){var a;return f(this,function(h){switch(h.label){case 0:return[4,b.eachAlways(c.map(function(a,b){return t.apply(p,[a,b])}))];case 1:return a=h.sent(),[2,a.map(function(a){return a.value})]}})})}})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/PromiseLightweight"],
function(B,r,f,a){return function(a){function b(b,c){var h=a.call(this)||this;h.symbol=null;h.graphics3DSymbol=null;h.symbol=b;b.fetchSymbol().then(function(a){if(h.isRejected())throw Error();h.graphics3DSymbol=c(a)}).then(function(){if(h.isRejected())throw Error();h.graphics3DSymbol.then(function(){h.isRejected()||h.resolve()},function(a){h.isRejected()||h.reject(a)})}).otherwise(function(a){h.isRejected()||h.reject(a)});return h}f(b,a);b.prototype.createGraphics3DGraphic=function(a,b){return this.graphics3DSymbol.createGraphics3DGraphic(a,
b,this)};b.prototype.layerPropertyChanged=function(a,b){return this.graphics3DSymbol.layerPropertyChanged(a,b)};b.prototype.applyRendererDiff=function(a,b,c){return this.graphics3DSymbol.applyRendererDiff(a,b,c)};b.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};b.prototype.setDrawOrder=function(a,b){return this.graphics3DSymbol.setDrawOrder(a,b)};b.prototype.destroy=function(){this.isFulfilled()||this.reject();
this.graphics3DSymbol&&this.graphics3DSymbol.destroy()};return b}(a.Promise)})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DSymbol","./Graphics3DPointSymbol"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});r.make=function(b,c,t){var p;switch(b.type){case "point-3d":p=a;break;default:p=f}return new p(b,c,t)}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/PromiseLightweight ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory".split(" "),
function(B,r,f,a,b,c){return function(a){function p(b,f,p){var h=a.call(this)||this;h.symbol=b;b=b.symbolLayers;p&&(b=p.concat(b));p=b.length;h.childGraphics3DSymbols=Array(b.length);h.childGraphics3DSymbolPromises=Array(b.length);for(var l=f.layerOrder,q=0,u=0,t=!1,r=function(a,b){b&&(this.childGraphics3DSymbols[a]=b,u++);q--;!this.isRejected()&&t&&1>q&&(0<u?this.resolve():this.reject())},G=0;G<p;G++){var n=b.getItemAt(G);!1!==n.enabled&&(f.layerOrder=l+(1-(1+G)/p),f.layerOrderDelta=1/p,n=c.make(h.symbol,
n,f,n._ignoreDrivers))&&(q++,h.childGraphics3DSymbolPromises[G]=n,n.then(r.bind(h,G,n),r.bind(h,G,null)))}f.layerOrder=l;t=!0;!h.isRejected()&&1>q&&(0<u?h.resolve():h.reject());return h}f(p,a);p.prototype.createGraphics3DGraphic=function(a,c,f){for(var h=Array(this.childGraphics3DSymbols.length),l=0;l<this.childGraphics3DSymbols.length;l++){var p=this.childGraphics3DSymbols[l];p&&(h[l]=p.createGraphics3DGraphic(a,c))}return new b(a,f||this,h)};p.prototype.layerPropertyChanged=function(a,b){for(var c=
this.childGraphics3DSymbols.length,h=function(c){var h=f.childGraphics3DSymbols[c],l=function(a){return a._graphics[c]};if(h&&!h.layerPropertyChanged(a,b,l))return{value:!1}},f=this,l=0;l<c;l++){var p=h(l);if("object"===typeof p)return p.value}return!0};p.prototype.applyRendererDiff=function(a,b,c){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(h,f,l){return h&&(!f||f.applyRendererDiff(a,b,c,l))},!0):!1};p.prototype.getFastUpdateStatus=function(){var a=0,b=0,c=0;this.childGraphics3DSymbolPromises.forEach(function(h){h&&
!h.isFulfilled()?a++:h&&h.isFastUpdatesEnabled()?c++:h&&b++});return{loading:a,slow:b,fast:c}};p.prototype.setDrawOrder=function(a,b){for(var c=this.childGraphics3DSymbols.length,h=1/c,f=0;f<c;f++){var l=this.childGraphics3DSymbols[f];l&&l.setDrawOrder(a+(1-(1+f)/c),h,b)}};p.prototype.destroy=function(){this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&this.childGraphics3DSymbolPromises[a].destroy()};return p}(a.Promise)})},
"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DIconSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DFillSymbolLayer ./Graphics3DExtrudeSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),function(B,r,f,a,b,c,t,p,h,l){Object.defineProperty(r,"__esModule",{value:!0});var q=f.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");r.make=function(a,
b,c,h){var f=y[b.type];return f?new f(a,b,c,h):(q.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var y={icon:a,object:b,line:c,path:t,fill:p,extrude:h,text:l}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/when dojo/errors/CancelError ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DDrapedGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./SignedDistanceFunctions ../support/FastSymbolUpdates ./graphicUtils ../../../../core/screenUtils ../../../../core/sniff ../../../../core/Error ../../../../symbols/support/symbolUtils ../../../../Color ../../../../geometry/Polygon ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../core/urlUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q,S,P){function O(a){return"cross"===a||"x"===a}function T(a){var b;"primitive:"===a.substring(0,10)&&(a=a.substring(10));switch(a){case m.PRIM_CIRCLE:b=y.computeSignedDistancefieldCicle(128,64);break;case m.PRIM_SQUARE:b=y.computeSignedDistancefieldSquare(128,64,!1);break;case m.PRIM_KITE:b=y.computeSignedDistancefieldSquare(128,64,!0);break;case m.PRIM_CROSS:b=y.computeSignedDistancefieldCrossAndX(128,64,!1);break;case m.PRIM_X:b=y.computeSignedDistancefieldCrossAndX(128,
64,!0)}return new Q(b,"sdf_"+a,{mipmap:!1,wrapClamp:!0,width:128,height:128,components:4})}var U=I.vec3d;B=I.vec4d;var W=I.mat4d.identity(),k=[0,0,1],ca=[0,0,0,0],V=[0,0,0],e=[1,1,1],d="center bottom top left right bottom-left bottom-right top-left top-right".split(" "),g=[.25,.25,.75,.75],m={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},v=[64,64];t=function(m){function t(){var a=null!==m&&m.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,
supportsOnTheGround:!0};return a}f(t,m);t.prototype._prepareResources=function(){var a=this.symbol,b=Math.round(null!=a.size?u.pt2px(a.size):16);this._size=null;this._symbolTextureRatio=1;this._primitive=null;var d=this._getStageIdHint();if(!this._isPropertyDriven("size")){var e=w.validateSymbolLayerSize(b);if(e){this._logWarning(e);this.reject();return}}this._isPropertyDriven("size")&&64>b&&(b=64);var c=a.resource||{primitive:"circle",href:void 0},e={anchorPos:this._getAnchorPos(a)},h=this.symbolContainer;
if(this._hasVisibleVerticalOffset(h)){var h=h.verticalOffset,k=h.minWorldLength,f=h.maxWorldLength;e.verticalOffset={screenLength:u.pt2px(h.screenLength),minWorldLength:k||0,maxWorldLength:null!=f?f:Infinity}}this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);c.href?(this._outlineSize=this._getOutlineSize(a,null),e.color=this._getFillColor(a,null),e.outlineColor=this._getOutlineColor(a),e.outlineSize=this._outlineSize,
e.textureIsSignedDistanceField=!1,this._prepareImageResources(b,e,d)):(c=c.primitive||"circle",h="primitive:"+c,this._primitive=c,this._outlineSize=this._getOutlineSize(a,c),e.color=this._getFillColor(a,c),e.outlineColor=this._getOutlineColor(a),e.outlineSize=this._outlineSize,O(c)&&0===e.outlineSize?this.reject():(this.texture=this._context.sharedResources.textures.acquire(h,T),this._textureURI=h,e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=g,e.textureId=this.texture.getId(),this._size=
[b,b],this._symbolTextureRatio=2,this._createMaterialsAndAddToStage(e,this._context.stage,d),this.resolve()))};t.prototype._getOutlineSize=function(a,b){var d=0,d=a.outline&&null!=a.outline.size?u.pt2px(a.outline.size):O(b)?1.5:0;return Math.max(d,0)};t.prototype._getOutlineColor=function(a){var b=this._getLayerOpacity();if(a.outline&&null!=a.outline.color){var d=n.toUnitRGB(a.outline.color);return[d[0],d[1],d[2],a.outline.color.a*b]}return[0,0,0,b]};t.prototype._getFillColor=function(a,b){return O(b)?
ca:this._getMaterialOpacityAndColor()};t.prototype._getAnchorPos=function(a){return-1<d.indexOf(a.anchor)?a.anchor:"center"};t.prototype._prepareImageResources=function(a,d,e){var g=this,h=G.getIconHref(this.symbolContainer,this.symbol);!C("esri-canvas-svg-support")&&P.isSVG(h)?(this._logWarning("IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"),this.reject(new E("SVG Not Supported","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"))):(b(this._context.sharedResources.textures.acquire(h,
null,a),function(b){if(!g.isRejected()){var c=b.params,h=c.width/c.height;g._size=a?1<h?[a,Math.round(a/h)]:[Math.round(a*h),a]:[c.width,c.height];d.textureId=b.getId();g._createMaterialsAndAddToStage(d,g._context.stage,e);g.resolve()}},function(a){a instanceof c?g.reject():(a="IconSymbol3DLayer failed to load (Request for icon resource failed: "+h+")",g._logWarning(a),g.reject(new E("Request Failed",a)))}),this._textureURI=h)};t.prototype._createMaterialsAndAddToStage=function(b,d,e){this._fastUpdates=
z.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&a.mixin(b,this._fastUpdates.materialParameters);var c=a.mixin({},b);c.verticalOffset=null;c.screenSizePerspective=null;c.occlusionTest=!1;c.shaderPolygonOffset=0;this._drapedMaterial=new S(c,e+"_iconDraped");d.add(K.ModelContentType.MATERIAL,this._drapedMaterial);b.occlusionTest=!0;this._material=new S(b,e+"_icon");d.add(K.ModelContentType.MATERIAL,
this._material)};t.prototype.destroy=function(){m.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(K.ModelContentType.MATERIAL,this._material.getId()),this._material=null);this._drapedMaterial&&(this._context.stage.remove(K.ModelContentType.MATERIAL,this._drapedMaterial.getId()),this._drapedMaterial=null);this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=null)};t.prototype._getGeometry=function(a){a=
this._validateGeometry(a.geometry);if("extent"===a.type)return q.placePointOnPolygon(A.fromExtent(a));if("polyline"===a.type)return q.placePointOnPolyline(a);if("polygon"===a.type)return q.placePointOnPolygon(a);if("point"===a.type)return a;this._logWarning("unsupported geometry type for icon symbol: "+a.type);return null};t.prototype._getScaleFactor=function(a){if(this._isPropertyDriven("size")&&a.size){for(var b=0;3>b;b++){var d=a.size[b];d&&"symbolValue"!==d&&"proportional"!==d&&(a.size[b]=u.pt2px(d))}b=
this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"!==a.size[0]){if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}}return 1};t.prototype.createGraphics3DGraphic=function(a,b){var d=this._getGeometry(a);if(null===d)return null;var e="graphic"+a.uid,c=this._getVertexOpacityAndColor(b),g=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(g=this._getScaleFactor(b));g*=this._symbolTextureRatio;b=[this._size[0]*g,this._size[1]*
g];g=this.getGraphicElevationInfo(a);return"on-the-ground"===g.mode?this._createAsOverlay(a,d,c,b,g,e,a.uid):this._createAs3DShape(a,d,c,b,g,e,a.uid)};t.prototype.layerPropertyChanged=function(a,b,d){if("opacity"===a)return b=this._getFillColor(this.symbol,this._primitive),this._drapedMaterial.setParameterValues({color:b}),this._material.setParameterValues({color:b}),b=this._getOutlineColor(this.symbol),this._drapedMaterial.setParameterValues({outlineColor:b}),this._material.setParameterValues({outlineColor:b}),
!0;if("elevationInfo"===a){a=this._elevationInfo.mode;this._updateElevationInfo();var e=this._elevationInfo.mode;if("on-the-ground"===a&&"on-the-ground"===e)return!0;if(a!==e&&("on-the-ground"===a||"on-the-ground"===e))return!1;a=q.needsElevationUpdates2D(e)||"absolute-height"===e;for(var c in b){var g=b[c];(e=d(g))&&!e.isDraped()&&(g=this.getGraphicElevationInfo(g.graphic),e.needsElevationUpdates=a,e.elevationInfo.set(g))}return!0}return!1};t.prototype.applyRendererDiff=function(a,b,d,e){for(var c in a.diff)switch(c){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,
b,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};t.prototype.setDrawOrder=function(a,b,d){this._drapedMaterial&&(this._drapedMaterial.setRenderPriority(a),d[this._drapedMaterial.getId()]=!0)};t.prototype._defaultElevationInfoNoZ=function(){return D};t.prototype._createAs3DShape=function(a,b,d,e,c,g,h){var f=
this,m=this._getFastUpdateAttrValues(a);a=m?function(a){return z.evaluateModelTransform(f._fastUpdates.materialParameters,m,a)}:null;d=N.createPointGeometry(k,null,d,e,L,null,m);d=[new J(d,g)];g=q.createStageObjectForPoint.call(this,b,d,[[this._material]],null,null,c,g,this._context.layer.uid,h,!0,a);if(null===g)return null;var n=new p(this,g.object,d,null,null,l.perObjectElevationAligner,c);n.alignedTerrainElevation=g.terrainElevation;n.needsElevationUpdates=q.needsElevationUpdates2D(c.mode)||"absolute-height"===
c.mode;n.getScreenSize=this._createScreenSizeGetter(e,a);n.calculateRelativeScreenBounds=function(a){return f._material.calculateRelativeScreenBounds(n.getScreenSize(),1,a)};q.extendPointGraphicElevationInfo(n,b,this._context.elevationProvider);return n};t.prototype._createAsOverlay=function(a,b,d,e,c,g,f){var l=this;this._drapedMaterial.setRenderPriority(this._symbolLayerOrder);f=U.create();x.pointToVector(b,f,this._context.overlaySR);f[2]=this._getDrapedZ();if((b=this._context.clippingExtent)&&
!q.pointInBox2D(f,b))return null;var m=this._getFastUpdateAttrValues(a);a=m?function(a){return z.evaluateModelTransform(l._fastUpdates.materialParameters,m,a)}:null;d=N.createPointGeometry(k,f,d,e,null,null,m);b=new M(d);b.material=this._drapedMaterial;b.center=f;b.bsRadius=0;b.transformation=W;b.name=g;b.uniqueName=g+"#"+d.id;var n=new h(this,[b],null,null,null,c);n.getScreenSize=this._createScreenSizeGetter(e,a);n.calculateRelativeScreenBounds=function(a){return l._drapedMaterial.calculateRelativeScreenBounds(n.getScreenSize(),
1,a)};return n};t.prototype._createScreenSizeGetter=function(a,b){var d=this._outlineSize+2;if(this._fastUpdates.enabled){var e=a[0]/this._symbolTextureRatio,c=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=Array(2));var g=b(W);a[0]=g[0]*e+d;a[1]=g[5]*c+d;return a}}var g=a[0]/this._symbolTextureRatio+d,h=a[1]/this._symbolTextureRatio+d;return function(a){void 0===a&&(a=Array(2));a[0]=g;a[1]=h;return a}};t.prototype._supportsShaderVisualVariables=function(){return!0};t.prototype._fastVisualVariableConvertOptions=
function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=[a,a,a],d=u.px2pt(1),a=a*d;return{modelSize:b,symbolSize:[a,a,a],unitInMeters:d,transformation:{anchor:V,scale:e,rotation:V}}};t.prototype._hasVisibleVerticalOffset=function(a){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()};t.PRIMITIVE_SIZE=v;t.VALID_ANCHOR_STRINGS=d;return t}(t);var D={mode:"relative-to-ground",offset:0},L=B.createFrom(0,0,0,1);return t})},
"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/PromiseLightweight ./featureExpressionInfoUtils ./ElevationInfo ./graphicUtils ./Graphics3DSymbolCommonCode ./constants ../../../../core/Logger ../../../../Color ../../../../core/Scheduler".split(" "),function(B,r,f,a,b,c,t,p,h,l,q,y){function z(a,b){a=null!=a?b.attributes[a]:0;null!=a&&isFinite(a)||(a=0);return a}var w=new c,u=l.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),
C={mode:"on-the-ground",offset:0,unit:"meters"},E={mode:"absolute-height",offset:0,unit:"meters"};return function(a){function l(b,h,f,l){var n=a.call(this)||this;n._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};n.symbolContainer=b;n.symbol=h;n._context=f;n._symbolLayerOrder=f.layerOrder;n._symbolLayerOrderDelta=f.layerOrderDelta;n._elevationInfo=new c;n._material=null;n._geometryCreationWarningHandle=null;n._updateDrivenProperties(l);n._updateElevationInfo();n._prepareResources();
return n}f(l,a);l.prototype._logWarning=function(a){u.warn(a)};l.prototype._logGeometryCreationWarnings=function(a,b,c,h){var f=this;if(null==this._geometryCreationWarningHandle){var l=a.geometryData&&a.geometryData.polygons;h+=" geometry failed to be created";var n=null;a.projectionSuccess?!b.length||1===b.length&&!b[0].length?n=h+" (no "+c+" were defined)":Array.isArray(b)&&Array.isArray(b[0])?l&&0===l.length&&"rings"===c&&(n=h+" (filled "+c+" should use clockwise winding - try reversing the order of vertices)"):
n=h+" ("+c+" should be defined as a 2D array)":n=h+" (failed to project geometry to view spatial reference)";n&&(this._geometryCreationWarningHandle=y.schedule(function(){return f._onNextTick()}),this._logWarning(n))}};l.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};l.prototype._validateGeometry=function(a){switch(a.type){case "point":if(null==a.x||null==a.y){this._logWarning("point coordinate is null - setting to default value");var b=a.clone();b.x=a.x||0;b.y=a.y||0;
return b}}return a};l.prototype._prepareResources=function(a){throw Error("This is an abstract base class");};l.prototype._defaultElevationInfoNoZ=function(){return C};l.prototype._defaultElevationInfoZ=function(){return E};l.prototype._updateElevationInfo=function(){this._elevationInfo.setDefaults();var a=this._context.layer.elevationInfo;a&&this._elevationInfo.mixinApi(a);(a=this.symbol&&this.symbol.elevationInfo)&&this._elevationInfo.mixinApi(a);this._elevationInfo.featureExpressionInfoContext=
this._context.featureExpressionInfoContext};l.prototype.getGraphicElevationInfo=function(a){var c=a.geometry.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();w.setUnit(null!=this._elevationInfo.unit?this._elevationInfo.unit:c.unit);w.mode=this._elevationInfo.mode||c.mode;w.setOffsetMeters(null!=this._elevationInfo.meterUnitOffset?this._elevationInfo.meterUnitOffset:c.offset);w.featureExpressionInfoContext=this._elevationInfo.featureExpressionInfoContext;w.hasOffsetAdjustment=!1;
this._elevationOptions.supportsOnTheGround||"on-the-ground"!==w.mode||(w.mode="relative-to-ground",w.setOffsetMeters(0),w.featureExpressionInfoContext=b.zeroContext);c=b.createFeature(a);b.setContextFeature(w.featureExpressionInfoContext,c);p.needsOffsetAdjustment(w,this._elevationOptions,a.geometry,this.symbolContainer)&&(w.setOffsetRenderUnits(h.defaultIconElevationOffset),w.hasOffsetAdjustment=!0);return w};l.prototype._getDrapedZ=function(){return-2};l.prototype._updateDrivenProperties=function(a){var b=
{color:!1,opacity:!1,size:!1};!a&&(a=this._context.renderer)&&(b.color=!!a.colorInfo,b.size=!!a.sizeInfo,a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.colors)for(var c=0;c<a.colors.length;c++){var h=a.colors[c];h&&(Array.isArray(h)&&3<h.length&&255!==h[3]||void 0!==h.a&&255!==h.a)&&(b.opacity=!0)}if(a.stops)for(c=0;c<a.stops.length;c++)(h=a.stops[c].color)&&(Array.isArray(h)&&3<h.length&&255!==h[3]||void 0!==h.a&&255!==h.a)&&(b.opacity=!0);break;
case "opacity":b.opacity=!0;break;case "size":b.size=!0}}));this._drivenProperties=b};l.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};l.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};l.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbol&&this.symbol.material;b&&!this._isPropertyDriven("opacity")&&
b.color&&(a*=b.color.a);return a};l.prototype._getMaterialOpacityAndColor=function(){var a=this.symbol&&this.symbol.material,b=this._getMaterialOpacity(),a=!this._isPropertyDriven("color")&&a&&a.color?q.toUnitRGB(a.color):null;return t.mixinColorAndOpacity(a,b)};l.prototype._getVertexOpacityAndColor=function(a,b,c){var h=this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;h=t.mixinColorAndOpacity(h,a);c&&(h[0]*=c,h[1]*=c,h[2]*=c,h[3]*=c);return b?new b(h):
h};l.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};l.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};l.prototype.setDrawOrder=function(a,b,c){this._material&&(this._material.setRenderPriority(a),c[this._material.getId()]=!0)};l.prototype.createGraphics3DGraphic=function(a,b){for(var c=2;c<arguments.length;c++);throw Error("This is an abstract base class");};l.prototype.destroy=function(){this._geometryCreationWarningHandle&&
(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)};l.prototype.layerPropertyChanged=function(a,b,c){return!1};l.prototype.applyRendererDiff=function(a,b,c,h){return!1};l.prototype._getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?z(b.size.field,a):0;a=b.color?z(b.color.field,a):0;return[c,a,0,0]};return l}(a.Promise)})},"esri/views/3d/layers/graphics/ElevationInfo":function(){define(["require",
"exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(B,r,f,a){return function(){function b(a){a?this.set(a):this.setDefaults()}Object.defineProperty(b.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});b.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=f.getMetersPerUnit(a)};
b.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.hasOffsetAdjustment=!1;this.setUnit("meters")};b.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||0;this.featureExpressionInfoContext=a.featureExpressionInfoContext;this.hasOffsetAdjustment=a.hasOffsetAdjustment;this.setUnit(a.unit)};b.prototype.setOffsetMeters=function(a){this._meterUnitOffset=
a;this._renderUnitOffset=0};b.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};b.prototype.setOffsetRenderUnits=function(a){this._meterUnitOffset=0;this._renderUnitOffset=a};b.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};b.prototype.mixinApi=function(a){null!=a.mode&&(this.mode=a.mode);null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&this.setOffsetElevationInfoUnits(a.offset)};b.prototype.calculateOffsetRenderUnits=
function(b){var c=this._meterUnitOffset,f=this.featureExpressionInfoContext;null!=f&&(c+=a.execute(f)*this._metersPerElevationInfoUnit);return c/b.unitInMeters+this._renderUnitOffset};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry/Point ../../../../symbols/callouts/calloutUtils ../../../../geometry/support/mathUtils ./graphicUtils ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Object3D".split(" "),
function(B,r,f,a,b,c,t,p,h){function l(a,b,c,h,f){var l=0,n=b.z||0,p=0,p=c.mode;h=c.calculateOffsetRenderUnits(h);c=c.featureExpressionInfoContext;"on-the-ground"===p?(l=p=a.getElevation(b,"ground")||0,f&&(f.verticalDistanceToGround=0,f.terrainElevation=p)):"relative-to-ground"===p?(p=a.getElevation(b,"ground")||0,l=h,null==c&&(l+=n),f&&(f.verticalDistanceToGround=l,f.terrainElevation=p),l+=p):"relative-to-scene"===p?(p=a.getElevation(b,"scene")||0,l=h,f&&(f.verticalDistanceToGround=l,f.terrainElevation=
p),l+=p):"absolute-height"===p&&(l=h,null==c&&(l+=n),f&&(p=a.getElevation(b,"ground")||0,f.verticalDistanceToGround=l-p,f.terrainElevation=p));return l}function q(a){for(var b=0,c=a.length-1,h=0;h<c;h++)b+=a[h][0]*a[h+1][1]-a[h+1][0]*a[h][1];return 0<=b}function y(a,b,c,h,f,l){h*=3;for(var n=0;n<f;++n){var p=a[b++];c[h++]=p[0];c[h++]=p[1];c[h++]=l?p[2]:0}return h/3}function z(a,b){for(var c=a.length,h=Array(c),f=Array(c),l=Array(c),n=0,p=0,u=0,t=0,r=0;r<c;++r)t+=a[r].length;for(var t=new Float64Array(3*
t),k=0,w=c-1;0<=w;w--){var x=a[w];if(q(x))h[n++]=x;else{for(var e=x.length,r=0;r<n;++r)e+=h[r].length;r={index:k,pathLengths:Array(n+1),count:e,holeIndices:Array(n)};r.pathLengths[0]=x.length;0<x.length&&(l[u++]={index:k,count:x.length});k=y(x,0,t,k,x.length,b);for(x=0;x<n;++x)e=h[x],r.holeIndices[x]=k,r.pathLengths[x+1]=e.length,0<e.length&&(l[u++]={index:k,count:e.length}),k=y(e,0,t,k,e.length,b);n=0;0<r.count&&(f[p++]=r)}}for(x=0;x<n;++x)e=h[x],0<e.length&&(l[u++]={index:k,count:e.length}),k=y(e,
0,t,k,e.length,b);p<c&&(f.length=p);u<c&&(l.length=u);return{vertexData:t,polygons:f,outlines:l}}function w(a,b,c,h,f){b*=3;h*=3;for(var l=0;l<f;++l)c[h++]=a[b++],c[h++]=a[b++],c[h++]=a[b++]}function u(a,b,c,h,f,l,n){return t.bufferToBuffer(a,c,b,h,l,f,n)}function C(a,b,c){t.pointToVector(a,b,c)}function E(a,b){return!(a[0]>b[3]||a[0]<b[0]||a[1]>b[4]||a[1]<b[1])}function G(a,b){return!(b[0]>a[3]||b[3]<a[0]||b[1]>a[4]||b[4]<a[1])}Object.defineProperty(r,"__esModule",{value:!0});B=p.mat4d;var n=p.vec3d.create(),
A=B.identity(),x=new f({x:0,y:0,z:0,spatialReference:null});r.createStageObjectForPoint=function(a,b,f,p,q,u,r,w,x,y,z){var k=b?b.length:0,J=this._context.clippingExtent;C(a,n,this._context.elevationProvider.spatialReference);if(J&&!E(n,J))return null;C(a,n,this._context.renderSpatialReference);J=this._context.localOriginFactory.getOrigin(n);r=new h({castShadow:!1,metadata:{layerUid:w,graphicId:x,usesVerticalDistanceToGround:!!y},idHint:r});for(w=0;w<k;w++)r.addGeometry(b[w],f[w],p?p[w]:A,q,J,z);
b=this._context.renderSpatialReference;p=this._context.elevationProvider;q=this._context.renderCoordsHelper;f=0;var K;r.metadata.usesVerticalDistanceToGround?(f=l(p,a,u,q,I),c.updateVertexAttributeAuxpos1w(r,I.verticalDistanceToGround),K=I.terrainElevation):(z="absolute-height"!==u.mode,f=l(p,a,u,q,z?I:null),z&&(K=I.terrainElevation));u=r.getObjectTransformation();n[0]=a.x;n[1]=a.y;n[2]=f;t.computeLinearTransformation(a.spatialReference,n,u,b)?r.setObjectTransformation(u):console.warn("Could not locate symbol object properly, it might be misplaced");
return{object:r,terrainElevation:K}};r.extendPointGraphicElevationInfo=function(a,b,c){a=a.elevationInfo;c=c.spatialReference;C(b,n,c);a.centerPointInElevationSR=new f({x:n[0],y:n[1],z:b.hasZ?n[2]:0,spatialReference:c})};r.placePointOnPolyline=function(a){var c=a.paths[0],c=b.getPointOnPath(c,b.getPathLength(c)/2);return new f({x:c[0],y:c[1],z:c[2],spatialReference:a.spatialReference})};r.placePointOnPolygon=function(a){return c.computeCentroid(a)};r.computeElevation=l;r.getSingleSizeDriver=function(a,
b){void 0===b&&(b=0);return isFinite(a[b])?a[b]:null};r.isCounterClockwise=q;r.copyPointData=y;r.copyPathData=z;r.copyVertices=w;r.chooseOrigin=function(a,b,c,h){b=Math.floor(b+(c-1)/2);h[0]=a[3*b+0];h[1]=a[3*b+1];h[2]=a[3*b+2]};r.subtractCoordinates=function(a,b,c,h){b*=3;for(var f=0;f<c;++f)a[b++]-=h[0],a[b++]-=h[1],a[b++]-=h[2]};r.setZ=function(a,b,c,h){b*=3;for(var f=0;f<c;++f)a[b+2]=h,b+=3};r.offsetZ=function(a,b,c,h){b*=3;for(var f=0;f<c;++f)a[b+2]+=h,b+=3};r.scaleZ=function(a,b,c,h){b*=3;for(var f=
0;f<c;++f)a[b+2]*=h,b+=3};r.flatArrayToArrayOfArrays=function(a,b,c){var h=[];b*=3;for(var f=0;f<c;++f)h.push([a[b++],a[b++],a[b++]]);return h};r.reproject=u;r.reprojectPoint=C;r.getGeometryVertexData3D=function(a,b,c,h,f,l,n){var p=f.spatialReference;a=z(a,b);b=a.vertexData;var q=b.length/3,t=new Float64Array(b.length),r=!0;c.equals(p)?w(b,0,t,0,b.length):r=u(b,0,c,t,0,p,q);var k=c=0,y=n.mode,A=0,e=0,d=0;l=n.calculateOffsetRenderUnits(l);n=n.featureExpressionInfoContext;x.spatialReference=f.spatialReference;
c*=3;for(var k=3*k,g=0;g<q;++g)x.x=t[c+0],x.y=t[c+1],x.z=t[c+2],"on-the-ground"===y?(e=A=f.getElevation(x)||0,d+=A):"relative-to-ground"===y?(A=f.getElevation(x)||0,e=A+l,null==n&&(e+=x.z),d+=A):"relative-to-scene"===y?(A=f.getElevation(x,"scene")||0,e=A+l,d+=A):"absolute-height"===y&&(e=l,null==n&&(e+=x.z)),b[k+0]=t[c+0],b[k+1]=t[c+1],b[k+2]=e,c+=3,k+=3;f=d/q;p.equals(h)||u(b,0,p,b,0,h,q);return{geometryData:a,vertexData:b,eleVertexData:t,terrainElevation:f,projectionSuccess:r}};r.getGeometryVertexDataDraped=
function(a,b,c){a=z(a,!1);var h=a.vertexData,f=h.length/3,l=!0;b.equals(c)||(l=t.bufferToBuffer(h,b,0,h,c,0,f));return{geometryData:a,vertexData:h,projectionSuccess:l}};r.computeBoundingBox=function(a,b,c,h){h[0]=Number.MAX_VALUE;h[1]=Number.MAX_VALUE;h[2]=Number.MAX_VALUE;h[3]=-Number.MAX_VALUE;h[4]=-Number.MAX_VALUE;h[5]=-Number.MAX_VALUE;b*=3;for(var f=0;f<c;++f){var l=a[b++],n=a[b++],p=a[b++];l<h[0]&&(h[0]=l);n<h[1]&&(h[1]=n);p<h[2]&&(h[2]=p);l>h[3]&&(h[3]=l);n>h[4]&&(h[4]=n);p>h[5]&&(h[5]=p)}return h};
r.pointInBox2D=E;r.boxesIntersect2D=G;r.boundingBoxClipped=function(a,b){return b?!G(a,b):!1};r.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};r.needsElevationUpdates3D=function(a){return"absolute-height"!==a};r.needsOffsetAdjustment=function(b,c,h,f){if(!1===c.needsOffsetAdjustment||!1===c.supportsOffsetAdjustment||"on-the-ground"===b.mode)return!1;if(0===b.meterUnitOffset){if(!0===c.needsOffsetAdjustment)return!0;if(a.isCalloutSupport(f)&&f.hasVisibleVerticalOffset())return!1;
if("relative-to-ground"===b.mode&&(!h.hasZ||b.featureExpressionInfoContext)||"relative-to-scene"===b.mode)return!0}return!1};var I={verticalDistanceToGround:0,terrainElevation:0}})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.defaultIconElevationOffset=1})},"esri/views/3d/layers/graphics/Graphics3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./Graphics3DGraphicElevationInfo ./featureExpressionInfoUtils ../../webgl-engine/Stage ../../lib/glMatrix ../../support/aaBoundingBox".split(" "),
function(B,r,f,a,b,c,t,p,h,l){B=h.vec3d;var q=h.mat4d,y=[0,0,0];h=function(){function h(a,b,f,l,p,q,u,t){this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=l;this.uniqueGeometries=f;this.uniqueTextures=p;this.stageObject=b;this.elevationAligner=q;this.elevationInfo=new c(u);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=t?t:h.VisibilityModes.HIDE_FACERANGE}h.prototype.initialize=function(a,
b){this.stageLayer=a;this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(p.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(p.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(p.ModelContentType.TEXTURE,this.uniqueTextures[a]);b.add(p.ModelContentType.OBJECT,this.stageObject)};h.prototype.isDraped=function(){return!1};
h.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===h.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),!0):!1};h.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=
0;b<this.uniqueMaterials.length;b++)a.remove(p.ModelContentType.MATERIAL,this.uniqueMaterials[b].getId());if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(p.ModelContentType.GEOMETRY,this.uniqueGeometries[b].getId());if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(p.ModelContentType.TEXTURE,this.uniqueTextures[b].getId())}a.remove(p.ModelContentType.OBJECT,this.stageObject.getId());this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),
this._addedToStage=!1);this._visible=!1;this.stage=this.stageLayer=null};h.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(t.setContextFeature(this.elevationInfo.featureExpressionInfoContext,c),a=this.elevationAligner(this.stageObject,this.elevationInfo,a,b),null!=a&&(this.alignedTerrainElevation=a))};h.prototype.setDrawOrder=function(a,b,c){};h.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};h.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)};
h.prototype.getBoundingBoxObjectSpace=function(a){var b=this.stageObject;a||(a=l.create());l.setMin(a,b.getBBMin(!0));l.setMax(a,b.getBBMax(!0));return a};h.prototype.getProjectedBoundingBox=function(c,h,f,p){return b(this,void 0,void 0,function(){var b,n,t,r,A,C,E,B;return a(this,function(a){switch(a.label){case 0:b=this.getBoundingBoxObjectSpace(f);n=u;t=l.isPoint(b)?1:n.length;for(r=0;r<t;r++)A=n[r],w[0]=b[A[0]],w[1]=b[A[1]],w[2]=b[A[2]],q.multiplyVec3(this.stageObject.objectTransformation,w),
z[3*r+0]=w[0],z[3*r+1]=w[1],z[3*r+2]=w[2];if(!c(z,0,t))return[3,6];l.set(b,l.NEGATIVE_INFINITY);C=null;this.calculateRelativeScreenBounds&&(C=this.calculateRelativeScreenBounds());for(r=0;r<3*t;r+=3){for(E=0;3>E;E++)b[E]=Math.min(b[E],z[r+E]),b[E+3]=Math.max(b[E+3],z[r+E]);C&&p.push({location:z.slice(r,r+3),screenSpaceBoundingRect:C})}if(!h)return[3,5];l.center(b,y);if("absolute-height"===this.elevationInfo.mode)return[3,5];B=void 0;a.label=1;case 1:return a.trys.push([1,3,,4]),[4,h.queryElevation(y[0],
y[1])];case 2:return B=a.sent(),[3,4];case 3:return a.sent(),B=null,[3,4];case 4:null!=B&&l.offset(b,0,0,-this.alignedTerrainElevation+B),a.label=5;case 5:return[2,b];case 6:return[2,null]}})})};h.prototype.addHighlight=function(a,b){b=this.stageObject.highlightAllComponents(b);a.addObject(this.stageObject,b)};h.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};h.VisibilityModes={REMOVE_OBJECT:0,HIDE_FACERANGE:1};return h}();var z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0],w=B.create(),u=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return h})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationInfo":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationInfo"],function(B,r,f,a){return function(a){function b(b){b=a.call(this,b)||this;b.centerPointInElevationSR=null;return b}f(b,a);return b}(a)})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./ElevationInfo ../../support/aaBoundingBox ../../support/aaBoundingRect ../../webgl-engine/Stage".split(" "),
function(B,r,f,a,b,c,t,p,h){B=function(){function f(a,b,h,f,l,n){this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.uniqueMaterials=h;this.uniqueTextures=f;this.boundingBox=l;this.elevationInfo=new c(n);this.stage=null;this._visible=!1}f.prototype.initialize=function(a,b){this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(h.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(h.ModelContentType.TEXTURE,
this.uniqueTextures[a])};f.prototype.isDraped=function(){return!0};f.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getTextureGraphicsRenderer().addRenderGeometries(this.renderGeometries):this.stage.getTextureGraphicsRenderer().removeRenderGeometries(this.renderGeometries),!0):!1};f.prototype.destroy=function(){if(this.stage){var a=this.stage;this._visible&&a.getTextureGraphicsRenderer().removeRenderGeometries(this.renderGeometries);
this._visible=!1;if(this.uniqueMaterials)for(var b=0;b<this.uniqueMaterials.length;b++)a.remove(h.ModelContentType.MATERIAL,this.uniqueMaterials[b].getId());if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(h.ModelContentType.TEXTURE,this.uniqueTextures[b].getId());this.stage=null}};f.prototype.alignWithElevation=function(a,b,c){};f.prototype.setDrawOrder=function(a,b,c){var h=this;this.uniqueMaterials&&this.uniqueMaterials.forEach(function(c){c.setRenderPriority(a);h._visible&&
(b[c.getId()]=!0)})};f.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};f.prototype.getCenterObjectSpace=function(){return[0,0,0]};f.prototype.addHighlight=function(a,b){var c=this.stage.getTextureGraphicsRenderer();this.renderGeometries.forEach(function(h){var f=c.addRenderGeometryHighlight(h,b);a.addRenderGeometry(h,c,f)})};f.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};
f.prototype.getProjectedBoundingBox=function(c,h,f,p){return b(this,void 0,void 0,function(){var b,n,q;return a(this,function(a){switch(a.label){case 0:t.set(f,t.NEGATIVE_INFINITY);for(b=0;b<this.renderGeometries.length;b++)n=this.renderGeometries[b],this._getRenderGeometryProjectedBoundingRect(n,l,c,p),t.expand(f,l);if(!h)return[3,5];t.center(f,y);q=void 0;a.label=1;case 1:return a.trys.push([1,3,,4]),[4,h.queryElevation(y[0],y[1])];case 2:return q=a.sent(),[3,4];case 3:return a.sent(),q=null,[3,
4];case 4:null!=q&&(f[2]=Math.min(f[2],q),f[5]=Math.max(f[5],q)),a.label=5;case 5:return[2,f]}})})};f.prototype._getRenderGeometryProjectedBoundingRect=function(a,b,c,h){if(this.boundingBox)t.set(q,this.boundingBox);else{var f=a.center;a=a.bsRadius;q[0]=f[0]-a;q[1]=f[1]-a;q[2]=f[2]-a;q[3]=f[0]+a;q[4]=f[1]+a;q[5]=f[2]+a}c(q,0,2);this.calculateRelativeScreenBounds&&h.push({location:t.center(q),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return t.toRect(q,b)};return f}();var l=p.create(),
q=[0,0,0,0,0,0],y=[0,0,0];return B})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../geometry/Point ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/lib/Util ./Graphics3DSymbolCommonCode ./graphicUtils".split(" "),function(B,r,f,a,b,c,t,p){Object.defineProperty(r,"__esModule",{value:!0});var h=c.VertexAttrConstants;B=a.vec3d;var l=new f,q=B.create(),y=B.create(),z=B.create(),w={verticalDistanceToGround:0,terrainElevation:0};r.perVertexElevationAligner=
function(a,b,c,f){l.spatialReference=c.spatialReference;for(var n=a.getGeometryRecords(),p=n.length,u="absolute-height"!==b.mode,C=0,E=0;E<p;E++){var J=n[E].geometry,B=n[E].getShaderTransformation();y[0]=B[12];y[1]=B[13];y[2]=B[14];J.invalidateBoundingInfo();for(var B=J.getData().getVertexAttr(),G=B[h.POSITION],J=G.data,B=B.mapPos.data,G=G.size,Q=J.length/G,S=0,P=0,O=!1,T=0,U=0;U<Q;U++){l.x=B[P++];l.y=B[P++];l.z=B[P++];z[0]=J[S];z[1]=J[S+1];z[2]=J[S+2];var W=t.computeElevation(c,l,b,f,u?w:null);u&&
(T+=w.terrainElevation);q[0]=J[S]+y[0];q[1]=J[S+1]+y[1];q[2]=J[S+2]+y[2];f.setAltitude(W,q,0);J[S]=q[0]-y[0];J[S+1]=q[1]-y[1];J[S+2]=q[2]-y[2];W=r.updateThresholdInMeters/f.unitInMeters;if(Math.abs(z[0]-J[S])>=W||Math.abs(z[1]-J[S+1])>=W||Math.abs(z[2]-J[S+2])>=W)O=!0;S+=G}C+=T/Q;O&&a.geometryVertexAttrsUpdated(E)}return C/p};r.perObjectElevationAligner=function(a,c,h,f,l){var n=c.centerPointInElevationSR,u=0;l=0;if(a.metadata.usesVerticalDistanceToGround)u=t.computeElevation(h,n,c,f,w),p.updateVertexAttributeAuxpos1w(a,
w.verticalDistanceToGround),l=w.terrainElevation;else{var y="absolute-height"!==c.mode,u=t.computeElevation(h,n,c,f,y?w:null);y&&(l=w.terrainElevation)}c=a.getObjectTransformation();h=[c[12],c[13],c[14]];r.iterativeUpdatesEnabled?f.setAltitudeOfTransformation(u,c):(q[0]=n.x,q[1]=n.y,q[2]=u,b.computeLinearTransformation(n.spatialReference,q,c,f.spatialReference)&&a.setObjectTransformation(c));f=r.updateThresholdInMeters/f.unitInMeters;(Math.abs(c[12]-h[0])>=f||Math.abs(c[13]-h[1])>=f||Math.abs(c[14]-
h[2])>=f)&&a.setObjectTransformation(c);return l};r.updateThresholdInMeters=.01;r.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/SignedDistanceFunctions":function(){define(["require","exports","../../support/mathUtils"],function(B,r,f){function a(a){return a-Math.floor(a)}function b(b,l,p){b=f.clamp(b,0,.9999991);var h=a(b*c[0]),q=a(b*c[1]),r=a(b*c[2]);b=a(b*c[3]);l[p+0]=256*(h-h*t[0]);l[p+1]=256*(q-h*t[1]);l[p+2]=256*(r-q*t[2]);l[p+3]=256*(b-r*t[3])}Object.defineProperty(r,"__esModule",
{value:!0});var c=[16777216,65536,256,1],t=[0,1/256,1/256,1/256],p=[1/16777216,1/65536,1/256,1];r.packFloat=b;r.unpackFloat=function(a,b){var c=a[b+1]/256,h=a[b+2]/256,f=a[b+3]/256;a=0+a[b+0]/256*p[0];a+=c*p[1];a+=h*p[2];return a+=f*p[3]};r.computeSignedDistancefieldCicle=function(a,c){var h=new Uint8Array(4*a*a),f=a/2-.5;c/=2;for(var l=0;l<a;l++)for(var p=0;p<a;p++){var u=p+a*l,t=p-f,r=l-f,t=Math.sqrt(t*t+r*r)-c,t=t/a+.5;b(t,h,4*u)}return h};r.computeSignedDistancefieldSquare=function(a,c,f){f&&
(c/=Math.SQRT2);for(var h=new Uint8Array(4*a*a),l=0;l<a;l++)for(var p=0;p<a;p++){var q=p-.5*(a-.5),t=l-.5*(a-.5),r=l*a+p;if(f)var B=(q+t)/Math.SQRT2,t=(t-q)/Math.SQRT2,q=B;q=Math.max(Math.abs(q),Math.abs(t))-.5*c;q=q/a+.5;b(q,h,4*r)}return h};r.computeSignedDistancefieldCrossAndX=function(a,c,f){f&&(c*=Math.SQRT2);c*=.5;for(var h=new Uint8Array(4*a*a),l=0;l<a;l++)for(var p=0;p<a;p++){var q=p-.5*a+0,t=l-.5*a+0,r=l*a+p;if(f)var B=(q+t)/Math.SQRT2,t=(t-q)/Math.SQRT2,q=B;q=Math.abs(q);t=Math.abs(t);B=
void 0;B=q>t?q>c?Math.sqrt((q-c)*(q-c)+t*t):t:t>c?Math.sqrt(q*q+(t-c)*(t-c)):q;B=B/a+.5;b(B,h,4*r)}return h}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../renderers/support/utils","../../lib/glMatrix","../graphics/graphicUtils"],function(B,r,f,a,b){function c(a){return null!==a&&void 0!==a}function t(a){return"number"===typeof a}function p(a,b){a&&a.push(b)}function h(a,b,h,n,q){var u=a.minSize,r=a.maxSize;if(a.expression)return p(q,"Could not convert size info: expression not supported"),
!1;if(a.useSymbolValue)return a=n.symbolSize[h],b.minSize[h]=a,b.maxSize[h]=a,b.offset[h]=b.minSize[h],b.factor[h]=0,b.type[h]=1,!0;if(c(a.field)){if(c(a.stops)){if(2===a.stops.length&&t(a.stops[0].size)&&t(a.stops[1].size))return l(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,b,h),b.type[h]=1,!0;p(q,"Could not convert size info: stops only supported with 2 elements");return!1}if(t(u)&&t(r)&&c(a.minDataValue)&&c(a.maxDataValue))return l(u,r,a.minDataValue,a.maxDataValue,b,h),
b.type[h]=1,!0;if(null!=f.meterIn[a.valueUnit])return b.minSize[h]=-Infinity,b.maxSize[h]=Infinity,b.offset[h]=0,b.factor[h]=1/f.meterIn[a.valueUnit],b.type[h]=1,!0;"unknown"===a.valueUnit?p(q,"Could not convert size info: proportional size not supported"):p(q,"Could not convert size info: scale-dependent size not supported");return!1}if(!c(a.field)){if(a.stops&&a.stops[0]&&t(a.stops[0].size))return b.minSize[h]=a.stops[0].size,b.maxSize[h]=a.stops[0].size,b.offset[h]=b.minSize[h],b.factor[h]=0,b.type[h]=
1,!0;if(t(u))return b.minSize[h]=u,b.maxSize[h]=u,b.offset[h]=u,b.factor[h]=0,b.type[h]=1,!0}p(q,"Could not convert size info: unsupported variant of sizeInfo");return!1}function l(a,b,c,h,f,l){h=0<Math.abs(h-c)?(b-a)/(h-c):0;f.minSize[l]=0<h?a:b;f.maxSize[l]=0<h?b:a;f.offset[l]=a-c*h;f.factor[l]=h}function q(a,b,c,f){if(a.normalizationField||a.valueRepresentation)return p(f,"Could not convert size info: unsupported property"),null;var l=a.field;if(null!=l&&"string"!==typeof l)return p(f,"Could not convert size info: field is not a string"),
null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=a.field;else if(a.field!==b.size.field)return p(f,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(l=h(a,b.size,0,c,f))?b:null;case "height":return(l=h(a,b.size,2,c,f))?b:null;case "depth":return(l=h(a,b.size,1,c,f))?b:null;case "width-and-depth":return(l=h(a,b.size,0,c,f))&&h(a,b.size,1,c,f),l?
b:null;case null:case void 0:case "all":return(l=(l=(l=h(a,b.size,0,c,f))&&h(a,b.size,1,c,f))&&h(a,b.size,2,c,f))?b:null;default:return p(f,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function y(a,b,c){for(var h=0;3>h;++h){var f=b.unitInMeters;1===a.type[h]&&(f*=b.modelSize[h],a.type[h]=2);a.minSize[h]/=f;a.maxSize[h]/=f;a.offset[h]/=f;a.factor[h]/=f}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return p(c,"No size axis contains a valid size or scale"),
!1;for(h=0;3>h;++h)0===a.type[h]&&(a.minSize[h]=a.minSize[b],a.maxSize[h]=a.maxSize[b],a.offset[h]=a.offset[b],a.factor[h]=a.factor[b],a.type[h]=a.type[b]);return!0}function z(a,b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function w(a,b,h){if(a.normalizationField)return p(h,"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return p(h,"Could not convert color info: too many color stops"),null;b.color={field:a.field,
values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(h=0;8>h;++h){var f=a[Math.min(h,a.length-1)];b.color.values[h]=f.value;z(b.color.colors,h,f.color)}}else if(a.colors){if(!c(a.minDataValue)||!c(a.maxDataValue))return p(h,"Could not convert color info: missing data values"),null;if(2!==a.colors.length)return p(h,"Could not convert color info: invalid colors array"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};b.color.values[0]=a.minDataValue;z(b.color.colors,0,a.colors[0]);b.color.values[1]=a.maxDataValue;z(b.color.colors,1,a.colors[1]);for(h=2;8>h;++h)b.color.values[h]=a.maxDataValue,z(b.color.colors,h,a.colors[1])}else return p(h,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length||a.colors&&0<=a.colors.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0],b.color={field:null,values:[0,
0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},h=0;8>h;h++)b.color.values[h]=Infinity,z(b.color.colors,h,a);else return p(h,"Could not convert color info: no field and no colors/stops"),null;return b}function u(a,b,c,h){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function C(a,b,c){if("string"!==typeof a.field)return p(c,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,
offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return p(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return u(a,b.rotation,0,c),b;case "roll":return u(a,b.rotation,1,c),b;case null:case void 0:case "heading":return u(a,b.rotation,2,c),b;default:return p(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function E(a,b,c){if(!a)return null;
var h=!b.supportedTypes||!!b.supportedTypes.size,f=!b.supportedTypes||!!b.supportedTypes.color,l=!b.supportedTypes||!!b.supportedTypes.rotation;return(a=a.reduce(function(a,n){if(!a)return a;if(n.valueExpression)return p(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case "size":return h?q(n,a,b,c):a;case "color":return f?w(n,a,c):a;case "rotation":return l?C(n,a,c):a;default:return p(c,"Could not convert visual variables: unsupported type "+n.type),
null}},{size:null,color:null,rotation:null}))&&a.size&&!y(a.size,b,c)?null:a}function G(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function n(a,b){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},
h=a&&null!=a.size;a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&h&&(c.vvSizeValue=b.transformation.scale);a&&h&&(c.vvSymbolAnchor=b.transformation.anchor,c.vvSymbolRotation=b.transformation.rotation);a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=a.color.colors);return c}Object.defineProperty(r,"__esModule",{value:!0});r.convertVisualVariables=E;r.initFastSymbolUpdatesState=
function(a,b,c){return b&&a&&!a.disableFastUpdates?(a=E(a.visualVariables,c))?{enabled:!0,visualVariables:a,materialParameters:n(a,c),customTransformation:a&&null!=a.size}:{enabled:!1}:{enabled:!1}};r.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var h=a.visualVariables;b=E(b.visualVariables,c);if(!(b&&G(h.size,b.size,"size")&&G(h.color,b.color,"color")&&G(h.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=n(b,c);a.customTransformation=b&&
null!=b.size;return!0};r.getMaterialParams=n;var A;(function(c){var h=a.mat4d,f=a.vec3,l=h.create(),n=f.create();c.evaluateModelTransform=function(a,c,f){if(!a.vvSizeEnabled)return f;h.identity(l);h.multiply(f,l,l);b.computeObjectRotation(a.vvSymbolRotation[2],a.vvSymbolRotation[0],a.vvSymbolRotation[1],l);if(a.vvSizeEnabled){for(f=0;3>f;++f){var p=a.vvSizeOffset[f]+c[0]*a.vvSizeFactor[f],q=f;var u=a.vvSizeMinSize[f],t=a.vvSizeMaxSize[f],p=p<u?u:p>t?t:p;n[q]=p}h.scale(l,n,l)}else h.scale(l,a.vvSizeValue,
l);h.translate(l,a.vvSymbolAnchor,l);return l}})(A||(A={}));r.evaluateModelTransform=A.evaluateModelTransform})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/sniff"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});r.isVolumetricSymbol=function(a){return(a=a&&a.symbolLayers)?a.some(function(a){a=a.type;return"object"===a||"path"===a||"extrude"===a}):!1};r.getIconHref=function(b,c){c=c.resource.href;return!f("esri-canvas-svg-support")&&b.styleOrigin&&
a.test(c)?c.replace(a,"/resource/png/$1.png"):c};var a=/\/resource\/(.*?)\.svg$/})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/errors/CancelError ../../../../Color ../../../../core/screenUtils ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./graphicUtils ../support/FastSymbolUpdates ./objectResourceUtils ../../lib/glMatrix ../../../../symbols/ObjectSymbol3DLayer ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/Material".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x){var I=u.mat4d,K=u.vec3d,J=[1,1,1],N=[1,1,1,1],M=[0,0,0];B=[-.5,-.5,-.5,.5,.5,.5];r=[-.5,-.5,0,.5,.5,1];var Q={sphere:B,cube:B,cylinder:r,cone:r,"inverted-cone":r,tetrahedron:[-.5,-.5,0,.5,.5,.5],diamond:B},S=[G.ModelContentType.MATERIAL,G.ModelContentType.TEXTURE,G.ModelContentType.GEOMETRY];return function(p){function u(){return null!==p&&p.apply(this,arguments)||this}f(u,p);u.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();
if(!this._isPropertyDriven("size")){var c=y.validateSymbolLayerSize(this.symbol);if(c){this._logWarning(c);this.reject();return}}a.resource&&a.resource.href?this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};u.prototype._preparePrimitiveResources=function(b,h){var f=this.symbol;if("sphere"===b)this._geometryData=A.createPolySphereGeometry(.5,2,!0);else if("cube"===b)this._geometryData=A.createBoxGeometry(1);else if("cylinder"===
b)this._geometryData=A.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);else if("cone"===b)this._geometryData=A.createConeGeometry(1,.5,15,!1),A.cgToGIS(this._geometryData);else if("inverted-cone"===b)this._geometryData=A.createConeGeometry(1,.5,15,!0),A.cgToGIS(this._geometryData);else if("tetrahedron"===b)this._geometryData=A.createTetrahedronGeometry(1),A.cgToGIS(this._geometryData);else if("diamond"===b)this._geometryData=A.createDiamondGeometry(1),A.cgToGIS(this._geometryData);else{this._logWarning("Unknown object symbol primitive: "+
b);this.reject();return}this._geometry=new n(this._geometryData,h);this._context.stage.add(G.ModelContentType.GEOMETRY,this._geometry);this._resourceBoundingBox=Q[b];this._resourceSize=E.size(this._resourceBoundingBox);this._symbolSize=y.computeSizeWithResourceSize(this._resourceSize,f);b=this._getMaterialOpacity();b={specular:[0,0,0],shininess:3,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:J,diffuse:J};var k=this.symbolContainer;if("point-3d"===
k.type&&k.verticalOffset){var k=k.verticalOffset,l=k.minWorldLength,p=k.maxWorldLength;b.verticalOffset={screenLength:t.pt2px(k.screenLength),minWorldLength:l||0,maxWorldLength:null!=p?p:Infinity};b.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(b.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?b.externalColor=N:(k=f.material?c.toUnitRGBA(f.material.color):N,b.externalColor=k);f.material&&f.material.colorMixMode&&(b.colorMixMode=
f.material.colorMixMode);this._fastUpdates=z.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(a.mixin(b,this._fastUpdates.materialParameters),b.instanced.push("featureAttribute")):this._hasPerInstanceColor()&&b.instanced.push("color");this._material=new x(b,h+"_objectmat");this._context.stage.add(G.ModelContentType.MATERIAL,this._material);this.resolve()};u.prototype._prepareModelResources=
function(c,h){var f=this,k=["transformation"];h={materialParamsMixin:{instanced:k},idHint:h,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=z.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(a.mixin(h.materialParamsMixin,this._fastUpdates.materialParameters),k.push("featureAttribute")):this._hasPerInstanceColor()&&k.push("color");k=this.symbolContainer;if("point-3d"===
k.type&&k.verticalOffset){var k=k.verticalOffset,l=k.minWorldLength,n=k.maxWorldLength;h.materialParamsMixin.verticalOffset={screenLength:t.pt2px(k.screenLength),minWorldLength:l||0,maxWorldLength:null!=n?n:Infinity};h.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=w.fetch(c,h);this._symbolLoaderPromise.then(function(a){f._symbolLoaderPromise=null;if(!f.isRejected()){var b=f._context,e=a.stageResources,c=b.stage,h=f._getExternalColorParameters(f.symbol.material),k=f._getMaterialOpacity(),
l=f._isPropertyDriven("opacity"),n=e[G.ModelContentType.MATERIAL];a.originalMaterialOpacities=Array(n.length);n.forEach(function(d,e){var c=d.getParameterValues();d.setParameterValues(h);a.originalMaterialOpacities[e]=c.opacity;c.opacity*=k;c.transparent=1>c.opacity;d.setParameterValues({opacity:c.opacity,transparent:c.transparent||l});b.screenSizePerspectiveEnabled&&(c.screenSizePerspective=b.sharedResources.screenSizePerspectiveSettings,d.setParameterValues({screenSizePerspective:c.screenSizePerspective}))});
S.forEach(function(a){for(var b=e[a],d=0;b&&d<b.length;d++)c.add(a,b[d])});f._resourceBoundingBox=w.computeBoundingBox(a);f._resourceSize=E.size(f._resourceBoundingBox);f._pivotOffset=a.pivotOffset;f._symbolSize=y.computeSizeWithResourceSize(f._resourceSize,f.symbol);f._i3sModel=a;z.updateFastSymbolUpdatesState(f._fastUpdates,f._context.renderer,f._fastVisualVariableConvertOptions())&&n.forEach(function(a){return a.setParameterValues(f._fastUpdates.materialParameters)});f.resolve()}},function(a){f._symbolLoaderPromise=
null;if(!f.isFulfilled()){if(!(a instanceof b)){var d="ObjectSymbol3DLayer failed to load";a&&a.message&&(d+=" ("+a.message+")");f._logWarning(d)}f.reject()}})};u.prototype._forEachMaterial=function(a){this._i3sModel?this._i3sModel.stageResources[G.ModelContentType.MATERIAL].forEach(a):a(this._material)};u.prototype._getExternalColorParameters=function(a){var b={};a&&a.colorMixMode&&(b.colorMixMode=a.colorMixMode);this._isPropertyDriven("color")?b.externalColor=N:a&&a.color?b.externalColor=c.toUnitRGBA(a.color):
(b.externalColor=N,b.colorMixMode="ignore");return b};u.prototype.destroy=function(){p.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;if(this._i3sModel){var b=this._i3sModel.stageResources;S.forEach(function(c){for(var h=b[c],f=0;h&&f<h.length;f++)a.remove(c,h[f].getId())})}else this._material&&a.remove(G.ModelContentType.MATERIAL,this._material.getId()),this._geometry&&a.remove(G.ModelContentType.GEOMETRY,
this._geometry.getId())};u.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"polyline"===a.type?q.placePointOnPolyline(a):"polygon"===a.type?q.placePointOnPolygon(a):"extent"===a.type?a.center:"point"!==a.type?(this._logWarning("unsupported geometry type for object symbol: "+a.type),null):a};u.prototype.createGraphics3DGraphic=function(a,b){var c=this._getGeometry(a);if(null===c)return null;var h="graphic"+a.uid,f=this.getGraphicElevationInfo(a);return this._createAs3DShape(a,
c,b,f,h,a.uid)};u.prototype.layerPropertyChanged=function(a,b,c){var h=this;if("opacity"===a){var f=this._isPropertyDriven("opacity");if(this._i3sModel){var l=this._getMaterialOpacity();this._i3sModel.stageResources[G.ModelContentType.MATERIAL].forEach(function(a,b){b=h._i3sModel.originalMaterialOpacities[b]*l;a.setParameterValues({opacity:b,transparent:1>b||f})})}else b=this._getMaterialOpacity(),this._material.setParameterValues({opacity:b,transparent:1>b||f});return!0}if("elevationInfo"===a){this._updateElevationInfo();
for(var e in b){var d=b[e];if(a=c(d))d=this.getGraphicElevationInfo(d.graphic),a.needsElevationUpdates=q.needsElevationUpdates3D(d.mode),a.elevationInfo.set(d)}return!0}return!1};u.prototype.applyRendererDiff=function(a,b,c,h){var f=this,k;for(k in a.diff)switch(k){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._forEachMaterial(function(a){return a.setParameterValues(f._fastUpdates.materialParameters)});else return!1;break;
default:return!1}return!0};u.prototype._createAs3DShape=function(a,b,c,f,n,p){var e=this,d=null,g=null;if(a=this._getFastUpdateAttrValues(a))d=d||{},d.featureAttribute=a,g=function(a){return z.evaluateModelTransform(e._fastUpdates.materialParameters,d.featureAttribute,a)};!this._fastUpdates.enabled&&this._hasPerInstanceColor()&&(d=d||{},d.color=y.mixinColorAndOpacity(c.color,c.opacity));a=this._context.layer.uid;var k=I.identity();this._applyObjectRotation(c,k);this._applyObjectRotation(this.symbol,
k);this._applyObjectScale(c,k);this._applyAnchor(k);if(this._i3sModel){c=this._i3sModel.stageResources[G.ModelContentType.GEOMETRY];for(var u=this._i3sModel.materialsByComponent,t=Array(c.length),r=0;r<k.length;r++)t[r]=k;n=q.createStageObjectForPoint.call(this,b,c,u,t,d,f,n,a,p,null,g)}else n=q.createStageObjectForPoint.call(this,b,[this._geometry],[[this._material]],[k],d,f,n,a,p,null,g);if(null===n)return null;if(this._fastUpdates.enabled){var w=z.getMaterialParams(this._fastUpdates.visualVariables,
this._fastVisualVariableConvertOptions());this._forEachMaterial(function(a){return a.setParameterValues(w)})}n.object.setCastShadow(!0);p=new h(this,n.object,null,null,null,l.perObjectElevationAligner,f,h.VisibilityModes.REMOVE_OBJECT);p.alignedTerrainElevation=n.terrainElevation;p.needsElevationUpdates=q.needsElevationUpdates3D(f.mode);q.extendPointGraphicElevationInfo(p,b,this._context.elevationProvider);return p};u.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||
(a=this._isPropertyDriven("size")&&a.size?a.size:this._symbolSize,a=y.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||I.scale(b,a))};u.prototype._applyObjectRotation=function(a,b){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&a instanceof C))return y.computeObjectRotation(a.heading,a.tilt,a.roll,b)};u.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return K.scale(E.center(this._resourceBoundingBox),
-1);case "top":var a=E.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=E.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];default:return this._pivotOffset?K.scale(this._pivotOffset,-1,Array(3)):M}};u.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&I.translate(a,b)}};u.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||
this._isPropertyDriven("opacity")};u.prototype._supportsShaderVisualVariables=function(){return this._context.stage.has("angleInstancedArrays")?!0:!1};u.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?E.size(this._resourceBoundingBox):J,b=this._resourceBoundingBox?this._computeAnchor():M,c=this._context.renderCoordsHelper.unitInMeters,h=y.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,c);return{modelSize:a,symbolSize:this._symbolSize||
J,unitInMeters:c,transformation:{anchor:b,scale:h,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0]}}};u.PRIMITIVE_BOUNDING_BOX=Q;return u}(p)})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/Deferred dojo/errors/CancelError ../../../../request ../../../../core/Error ../../../../core/Version ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/Material ../../webgl-engine/lib/Texture ../../support/aaBoundingBox".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E){function G(a){return new p("","Request for object resource failed: "+a)}function n(b,c){var f=[],l=[],n=[],p=[],t=[],r=h.Version.parse(b.version||"1.0","wosr");I.validate(r);var r="meshsymbol_"+b.model.name,y=b.textureDefinitions,A={},E;for(E in y){var k=y[E],J=k.images[0].data;x(J,"symbol resources must have embedded texture data (at the moment)");var B="/textureDefinitions/"+E,J=new C(k.encoding+";base64,"+J,r,{noUnpackFlip:!0});t.push(J);A[B]={engineTexObj:J,
transparent:"rgba"===k.channels}}E=b.model.geometries;y=b.materialDefinitions;for(k=0;k<E.length;k++){var e=E[k];e.params.components||(B=e,J=B.params,x(J.material),J.components=[{id:1,material:B.params.material,texture:B.params.texture,region:B.params.texture}],J.faces&&(J.faces.componentIndices=[J.faces.position.count]));var B=e.params.components,d=B.length,J=e.params.faces,g=e.params.vertexAttributes,m=e.params.topology||"Indexed",e={},v;for(v in g){var D=g[v],G=D.values;x(D.values,"symbol resources with external geometry bin not yet supported");
e[v]={data:G,size:D.valuesPerElement}}g=void 0;D=Array(d);if("Indexed"===m){var g=J.componentIndices,K;for(K in J);}else"PerAttributeArray"!==m?console.warn("I3S symbol loader: unsupported topology type "+m):1!==d&&console.warn("I3S symbol loader: if topology is not Indexed, only single component geometries are supported");n.push([]);for(d=0;d<B.length;d++){m=B[d];G={type:"triangle",positionKey:"position",indices:{}};if(g)for(var Z in J){if("componentIndices"!==Z){var ba=J[Z];x(ba.values,"symbol resources with external geometry bin not yet supported");
G.indices[Z]=new Uint32Array(ba.values)}}else{for(var ba=e.position.data.length/e.position.size,ja=new Uint32Array(ba),aa=0;aa<ba;aa++)ja[aa]=aa;var ba=ja,ea;for(ea in e)G.indices[ea]=ba}D[d]=G;G=void 0;m.texture&&(G=A[m.texture].engineTexObj.getId());ba=p[m.material]?p[m.material][m.texture]:null;ba||(ba=m.material.substring(m.material.lastIndexOf("/")+1),ba=y[ba].params,1===ba.transparency&&(ba.transparency=0),G={ambient:ba.diffuse,diffuse:ba.diffuse,specular:[0,0,0],shininess:0,opacity:1-ba.transparency,
transparent:0<ba.transparency,textureId:G,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:ba.externalColorMixMode||"tint"},c.materialParamsMixin&&a.mixin(G,c.materialParamsMixin),ba=new u(G,r),p[m.material]||(p[m.material]={}),p[m.material][m.texture]=ba,l.push(ba));n[k].push(ba)}B=new z(new w(D,e),r);f.push(B)}return{stageResources:(ha={},ha[q.ModelContentType.TEXTURE]=t,ha[q.ModelContentType.MATERIAL]=l,ha[q.ModelContentType.GEOMETRY]=f,ha),materialsByComponent:n,pivotOffset:b.model.pivotOffset};
var ha}Object.defineProperty(r,"__esModule",{value:!0});var A=l.vec3d,x=y.assert,I=new h.Version(1,1,"wosr");r.fetch=function(a,h){h=h||{};var f=h.streamDataSupplier;if(f){var l=f.request(a,"json"),p=new b(function(){return f.cancelRequest(l)});l.then(function(a,b){try{var c=n(b,h);return p.resolve(c)}catch(W){return p.reject(W)}},function(a){p.reject(a instanceof c?a:G(a))});return p.promise}var q=t(a),u=new b(function(){return q.cancel()});q.then(function(a){try{var b=n(a.data,h);return u.resolve(b)}catch(U){return u.reject(U)}},
function(b){u.reject(b instanceof c?b:G(a))});return u.promise};r.computeBoundingBox=function(a){a=a.stageResources[q.ModelContentType.GEOMETRY];for(var b=E.create(E.NEGATIVE_INFINITY),c=[0,0,0],h=[0,0,0],f=0;f<a.length;f++)for(var l=a[f],n=l.getNumGroups(),p=0;p<n;++p){var u=l.getBoundingInfo(p);A.set(u.getBBMin(),c);A.set(u.getBBMax(),h);for(u=0;3>u;++u)b[u]=Math.min(b[u],c[u]),b[u+3]=Math.max(b[u+3],h[u])}return b};r.createStageResources=n})},"esri/core/Version":function(){define(["require","exports",
"./Error"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function a(a,c,f){void 0===f&&(f="");this.major=a;this.minor=c;this._context=f}a.prototype.lessThan=function(a,c){return this.major<a||a===this.major&&this.minor<c};a.prototype.since=function(a,c){return!this.lessThan(a,c)};a.prototype.validate=function(a){if(this.major!==a.major)throw new f((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+
this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,this.minor,this._context)};a.parse=function(b,c){void 0===c&&(c="");var t=b.split("."),p=t[0],t=t[1],h=/^\s*\d+\s*$/;if(!p||!p.match||!p.match(h))throw new f((c&&c+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:b});if(!t||!t.match||!t.match(h))throw new f((c&&c+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:b});b=parseInt(p,10);p=parseInt(t,10);return new a(b,p,c)};return a}();r.Version=B})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DDrapedGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./lineUtils ../../../../core/screenUtils ../../../../geometry/Polygon ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/RenderGeometry ./graphicUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E){var G=y.vec3d,n=y.mat4d;return function(a){function r(){return null!==a&&a.apply(this,arguments)||this}f(r,a);r.prototype._prepareResources=function(){var a=this.symbol,b=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),a={idHint:this._getStageIdHint(),width:this._getWidth(a),color:this._getMaterialOpacityAndColor()};if(!this._isPropertyDriven("size")){var c=E.validateSymbolLayerSize(a.width);if(c){this._logWarning(c);
this.reject();return}}if(b||1.5<=a.width)this._isPropertyDriven("size")&&(a.width=0),this._isNativeLineMaterial=!1,this._material=h.createRibbonMaterial(a);else if(0<a.width)this._isNativeLineMaterial=!0,this._material=h.createNativeMaterial(a);else{this.reject();return}this._context.stage.add(z.ModelContentType.MATERIAL,this._material);this.resolve()};r.prototype._getWidth=function(a){return null!=a.size?l.pt2px(a.size):1};r.prototype.destroy=function(){a.prototype.destroy.call(this);this.isFulfilled()||
this.reject();this._material&&(this._context.stage.remove(z.ModelContentType.MATERIAL,this._material.getId()),this._material=null)};r.prototype.createGraphics3DGraphic=function(a,b){var c=this._validateGeometry(a.geometry);if("polyline"!==c.type&&"polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for line symbol: "+c.type),null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",h="graphic"+a.uid,f=this._getVertexOpacityAndColor(b,Float32Array,255),n=
0;b.size&&this._isPropertyDriven("size")&&(n=p.getSingleSizeDriver(b.size),n=l.pt2px(n));b=this.getGraphicElevationInfo(a);return"on-the-ground"===b.mode?this._createAsOverlay(a,c,f,n,b,h):this._createAs3DShape(a,c,f,n,b,h,a.uid)};r.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return this._isNativeLineMaterial?(b=this._material.getColor(),b[3]=this._getMaterialOpacity(),this._material.setColor(b)):(b=this._material.getParameterValues(),b.color[3]=this._getMaterialOpacity(),this._material.setParameterValues({color:b.color})),
!0;if("elevationInfo"===a){a=this._elevationInfo.mode;this._updateElevationInfo();var h=this._elevationInfo.mode;if(null==a||null==h)return!1;if("on-the-ground"===a&&"on-the-ground"===h)return!0;if(a!==h&&("on-the-ground"===a||"on-the-ground"===h))return!1;a=p.needsElevationUpdates2D(h);for(var f in b){var l=b[f];(h=c(l))&&!h.isDraped()&&(l=l.graphic,h.needsElevationUpdates=a,h.elevationInfo.set(this.getGraphicElevationInfo(l)))}return!0}return!1};r.prototype._getOutlineGeometry=function(a,b){return b};
r.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);"extent"===a.type&&(a=q.fromExtent(a));return a};r.prototype._createAs3DShape=function(a,c,f,l,q,r,y){var x=this._getGeometry(a),z=x.hasZ,A=x[c],C=this._getOutlineGeometry(x,A);a=[];var E=[],k=[],J=G.create(),B=Array(6),x=p.getGeometryVertexData3D(C,z,x.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,q);this._logGeometryCreationWarnings(x,A,c,"LineSymbol3DLayer");
if(0<C.length){for(var A=x.geometryData.outlines,C=x.eleVertexData,z=x.vertexData,e=0;e<A.length;++e){var d=A[e],g=d.index,m=d.count;if(this._context.clippingExtent&&(p.computeBoundingBox(C,g,m,B),p.boundingBoxClipped(B,this._context.clippingExtent)))continue;p.chooseOrigin(z,g,m,J);p.subtractCoordinates(z,g,m,J);d=new Float64Array(C.buffer,3*g*C.BYTES_PER_ELEMENT,3*m);g=new Float64Array(z.buffer,3*g*z.BYTES_PER_ELEMENT,3*m);g=h.createPolylineGeometry(g,d,"rings"===c,f,l);g=new u(g,r+"path"+e);g.singleUse=
!0;a.push(g);E.push([this._material]);g=n.identity();n.translate(g,J,g);k.push(g)}if(0<a.length)return c=new w({geometries:a,materials:E,transformations:k,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicId:y},idHint:r}),c=new b(this,c,a,null,null,t.perVertexElevationAligner,q),c.alignedTerrainElevation=x.terrainElevation,c.needsElevationUpdates=p.needsElevationUpdates2D(q.mode),c}return null};r.prototype._createAsOverlay=function(a,b,f,l,q,u){var t=this._getGeometry(a);this._material.setRenderPriority(this._symbolLayerOrder);
var r=t[b],w=this._getOutlineGeometry(t,r);a=[];var y=Array(6),x=G.create(),t=p.getGeometryVertexDataDraped(w,t.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(t,r,b,"LineSymbol3DLayer");if(0<w.length){r=t.vertexData;w=t.geometryData.outlines;for(t=0;t<w.length;++t){var z=w[t],k=z.index,z=z.count;p.computeBoundingBox(r,k,z,y);if(!p.boundingBoxClipped(y,this._context.clippingExtent)){p.chooseOrigin(r,k,z,x);p.subtractCoordinates(r,k,z,x);p.setZ(r,k,z,this._getDrapedZ());
z=new Float64Array(r.buffer,3*k*r.BYTES_PER_ELEMENT,3*z);k=n.identity();n.translate(k,x,k);var z=h.createPolylineGeometry(z,null,"rings"===b,f,l),A=new C(z);A.material=this._material;A.center=[.5*(y[0]+y[3]),.5*(y[1]+y[4]),0];A.bsRadius=.5*Math.sqrt((y[3]-y[0])*(y[3]-y[0])+(y[4]-y[1])*(y[4]-y[1]));A.transformation=k;A.name=u;A.uniqueName=u+"#"+z.id;a.push(A)}}return new c(this,a,null,null,y,q)}return null};return r}(a)})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util".split(" "),
function(B,r,f,a,b,c){function t(a){var b=a.length;return a[0]===a[b-3]&&a[1]===a[b-2]&&a[2]===a[b-1]}Object.defineProperty(r,"__esModule",{value:!0});var p=c.VertexAttrConstants;r.createRibbonMaterial=function(a){var b={width:a.width,color:a.color,miterLimit:a.miterLimit,polygonOffset:!0};"miter"===a.join||"bevel"===a.join?b.join=a.join:(b.join="miter",a.join&&console.warn("unsupported join type for line symbol: "+a.join));return new f(b,a.idHint+"_ribbonlinemat")};r.createNativeMaterial=function(b){return new a(b.width,
b.color,b.idHint+"_nativelinemat")};r.isClosed=t;r.createPolylineGeometry=function(a,c,f,r,z){var h,l,q;if(f=f&&!t(a)){f=new Float32Array(a.length+3);for(l=0;l<a.length;l++)f[l]=a[l];l=f.length;f[l-3]=a[0];f[l-2]=a[1];f[l-1]=a[2];h=a.length/3+1;l=new Uint32Array(2*(h-1));q=new Uint32Array(2*(h-1))}else h=a.length/3,l=new Uint32Array(2*(h-1)),q=new Uint32Array(2*(h-1)),f=a;a=new Float32Array(1);a[0]=z;for(var y=z=0,B=0;B<h-1;B++)l[z++]=B,l[z++]=B+1,q[y++]=0,q[y++]=0;z={};h={};z[p.POSITION]=l;z[p.COLOR]=
q;z[p.SIZE]=q;h[p.POSITION]={size:3,data:f};h[p.COLOR]={size:4,data:r};h[p.SIZE]={size:1,data:a};c&&(z.mapPos=l,h.mapPos={size:3,data:c});return new b(h,z,b.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/DefaultVertexBufferLayouts ../lib/ComponentUtils ../../../webgl/Util".split(" "),function(B,r,f,a,b,c,t){var p=f.vec3d,h=f.vec2d,l=f.mat4d,q=r.VertexAttrConstants,
y=p.create(),z=p.create(),w=p.create(),u=p.create(),C=h.create(),E=h.create(),G=p.create(),n=p.create(),A=function(a,h,f,M){"string"===typeof f&&(M=f,f=void 0);B.basicMaterialConstructor(this,M);this.lineType=f||A.LINES;var J=b.Pos3,K=t.getStride(J)/4;this.canBeMerged=this.lineType===A.LINES;this.setColor=function(a){h=a;this.notifyDirty("matChanged")};this.getColor=function(){return h};this.dispose=function(){};this.getOutputAmount=function(a){a=a/2+1;if(this.lineType===A.STRIP)return a*K;if(this.lineType===
A.LINES)return(2*a-2)*K};this.getVertexBufferLayout=function(){return J};this.fillInterleaved=function(a,b,c,h,f,k){a=a.vertexAttr[q.POSITION].data;if(b||this.lineType===A.LINES)for(h=a.length/3,c=0;c<h;c++){var l=3*c,n=a[l],e=a[l+1],d=a[l+2];if(b)var l=n,g=e,n=b[0]*l+b[4]*g+b[8]*d+b[12],e=b[1]*l+b[5]*g+b[9]*d+b[13],d=b[2]*l+b[6]*g+b[10]*d+b[14];f[k++]=n;f[k++]=e;f[k++]=d;this.lineType===A.LINES&&0!==c&&c!==h-1&&(f[k++]=n,f[k++]=e,f[k++]=d)}else for(c=0;c<a.length;c++)f[k++]=a[c]};this.intersect=
function(a,b,h,f,q,k,t){if(f.isSelection&&!c.isAllHidden(b.componentVisibilities,a.data.componentOffsets)){b=a.getData().getVertexAttr("position").position.data;a=Number.MAX_VALUE;var x,e;q=f.camera;k=f.point;for(var d=0;d<b.length-5;d+=3){y[0]=b[d];y[1]=b[d+1];y[2]=b[d+2];l.multiplyVec3(h,y);z[0]=b[d+3];z[1]=b[d+4];z[2]=b[d+5];l.multiplyVec3(h,z);q.projectPoint(y,C);q.projectPoint(z,E);if(0>C[2]&&0<E[2])p.subtract(y,z,w),x=q.frustumPlanes,e=-(p.dot(x[4],y)+x[4][3]),x=e/p.dot(w,x[4]),p.scale(w,x,
w),p.add(y,w,y),q.projectPoint(y,C);else if(0<C[2]&&0>E[2])p.subtract(z,y,w),x=q.frustumPlanes,e=-(p.dot(x[4],z)+x[4][3]),x=e/p.dot(w,x[4]),p.scale(w,x,w),p.add(z,w,z),q.projectPoint(z,E);else if(0>C[2]&&0>E[2])continue;x=r.pointLineSegmentDistance2D(C,E,k);x<a&&(a=x,p.set(y,G),p.set(z,n))}h=f.p0;f=f.p1;2>a&&(a=r.lineSegmentLineSegmentDistance3D(G,n,h,f),b=Number.MAX_VALUE,a[0]&&(p.subtract(a[2],h,u),a=p.length(u),p.scale(u,1/a),b=a/p.dist(h,f)),t(b,u))}};this.getGLMaterials=function(){return{color:x,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:I}};this.getAllTextureIds=function(){return[]}};A.STRIP=1;A.LINES=2;var x=function(b,c){B.basicGLMaterialConstructor(this,b);var h=c.get("simple"),f=b.getColor();this.beginSlot=function(b){return b===a.OPAQUE_MATERIAL};this.getProgram=function(){return h};this.bind=function(a,b){a.bindProgram(h);h.setUniform4fv("color",f);a.setBlendingEnabled(1>f[3]);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);
a.setDepthTestEnabled(!0)};this.release=function(a){1>f[3]&&a.setBlendingEnabled(!1)};this.bindView=function(a,b){B.bindView(b.origin,b.view,h)};this.bindInstance=function(a,b){h.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){a=a.gl;return b.lineType===A.STRIP?a.LINE_STRIP:a.LINES}},I=function(b,c){B.basicGLMaterialConstructor(this,b);var h=c.get("highlight");this.beginSlot=function(b){return b===a.OPAQUE_MATERIAL};this.getProgram=function(){return h};this.bind=function(a,
b){a.bindProgram(h);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,b){B.bindView(b.origin,b.view,h)};this.bindInstance=function(a,b){h.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){a=a.gl;return b.lineType===A.STRIP?a.LINE_STRIP:a.LINES}};return A})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ../../../../geometry/Point ../../support/projectionUtils ../../../../views/3d/lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/Material ../../webgl-engine/lib/Util ./graphicUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C){function E(a,b,h,f){for(var l=a.getGeometryRecords(),n=l.length,p="absolute-height"!==b.mode,q=0,k=0;k<n;k++){var u=l[k].geometry,t=[l[k].transformation[12],l[k].transformation[13],l[k].transformation[14]],e=u.getData().getVertexAttr(),d=e[x.POSITION].data,g=e.zOffset.data,e=e.mapPos.data,m=e.length/3;A(d.length/3===m*N+2,"unexpected tube geometry");var r=0,w=0;K.spatialReference=h.spatialReference;for(var y=0,z=0;z<m;z++){K.x=e[3*z];K.y=e[3*z+1];K.z=e[3*
z+2];var C=c.computeElevation(h,K,b,f,p?J:null);p&&(y+=J.terrainElevation);var E=N;0!==z&&z!==m-1||E++;for(var B=0;B<E;B++)I[0]=d[r]+t[0],I[1]=d[r+1]+t[1],I[2]=d[r+2]+t[2],f.setAltitude(C+g[w],I,0),d[r]=I[0]-t[0],d[r+1]=I[1]-t[1],d[r+2]=I[2]-t[2],r+=3,w+=1;u.invalidateBoundingInfo()}a.geometryVertexAttrsUpdated(k);q+=y/m}return q/n}var G=h.vec3d,n=h.mat4d,A=u.assert;B=function(a){function h(){return null!==a&&a.apply(this,arguments)||this}f(h,a);h.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=
C.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),c=G.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};this._material=new w(c,a+"_3dlinemat");this._context.stage.add(l.ModelContentType.MATERIAL,this._material);this.resolve()};h.prototype.destroy=function(){a.prototype.destroy.call(this);
this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(l.ModelContentType.MATERIAL,this._material.getId()),this._material=null)};h.prototype.createGraphics3DGraphic=function(a,b){var c=this._validateGeometry(a.geometry);if("polyline"!==c.type)return this._logWarning("unsupported geometry type for path symbol: "+c.type),null;var c="graphic"+a.uid,h=this.getGraphicElevationInfo(a);return this._createAs3DShape(a,b,h,c,a.uid)};h.prototype.layerPropertyChanged=function(a,b,h){if("opacity"===
a)return b=this._getMaterialOpacity(),h=1>b||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:b,transparent:h}),!0;if("elevationInfo"===a){this._updateElevationInfo();for(var f in b){var l=b[f];if(a=h(l))l=this.getGraphicElevationInfo(l.graphic),a.needsElevationUpdates=c.needsElevationUpdates3D(l.mode),a.elevationInfo.set(l)}return!0}return!1};h.prototype._getPathSize=function(a){a=a.size&&this._isPropertyDriven("size")?c.getSingleSizeDriver(a.size):this._getSymbolSize();
return a/=this._context.renderCoordsHelper.unitInMeters};h.prototype._getSymbolSize=function(){return this.symbol.size||1};h.prototype._createAs3DShape=function(a,h,f,l,u){var t=a.geometry,k=t.hasZ,r=t.paths;a=[];var w=[],e=[],d=G.create(),g=this._context.renderSpatialReference===p.SphericalRenderSpatialReference,m=Array(6),v=this._getPathSize(h),t=c.getGeometryVertexData3D(r,k,t.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,
f);this._logGeometryCreationWarnings(t,r,"paths","PathSymbol3DLayer");if(0<r.length){for(var r=t.geometryData.outlines,k=t.eleVertexData,x=t.vertexData,A=0;A<r.length;++A){var C=r[A],J=C.index,B=C.count;if(this._context.clippingExtent&&(c.computeBoundingBox(k,J,B,m),c.boundingBoxClipped(m,this._context.clippingExtent)))continue;c.chooseOrigin(x,J,B,d);c.subtractCoordinates(x,J,B,d);C=new Float64Array(k.buffer,3*J*k.BYTES_PER_ELEMENT,3*B);J=c.flatArrayToArrayOfArrays(x,J,B);J=z.createTubeGeometry(J,
.5*v,N,g,d);J.getVertexAttr().mapPos={size:3,data:C};this._material.getParams().vertexColors&&(C=this._getVertexOpacityAndColor(h),J=z.addVertexColors(J,C,!0));C=new y(J,l+"path"+A);C.singleUse=!0;a.push(C);w.push([this._material]);C=n.identity();n.translate(C,d,C);e.push(C)}if(0<a.length)return h=new q({geometries:a,materials:w,transformations:e,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:u},idHint:l}),h=new b(this,h,a,null,null,E,f),h.alignedTerrainElevation=t.terrainElevation,
h.needsElevationUpdates=c.needsElevationUpdates3D(f.mode),h}return null};return h}(a);var x=u.VertexAttrConstants,I=G.create(),K=new t,J={verticalDistanceToGround:0,terrainElevation:0},N=10;return B})},"esri/views/3d/layers/graphics/Graphics3DFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DDrapedGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./lineUtils ./graphicUtils ../../../../geometry/Polygon ../../../../Color ../../lib/glMatrix ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/lib/Util ./earcut/earcut".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K){var J=I.VertexAttrConstants;B=w.vec3d;var N=w.mat4d;b=function(b){function r(){var a=null!==b&&b.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};return a}f(r,b);r.prototype._prepareResources=function(){this._prepareFillResources();this._prepareOutlineResources();this.resolve()};r.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),b=
{color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0};this._material=new x(b,a+"_colormat");this._context.stage.add(C.ModelContentType.MATERIAL,this._material)};r.prototype._prepareOutlineResources=function(){var b=this.symbol.outline;if(this._hasOutline=!!(b&&b.size&&0<b.size&&b.color))b={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:a.pt2px(b.size)},2<b.width?(this._outlineMaterial=l.createRibbonMaterial(b),this._isOutlineNativeLineMaterial=
!1):(this._outlineMaterial=l.createNativeMaterial(b),this._isOutlineNativeLineMaterial=!0),this._context.stage.add(C.ModelContentType.MATERIAL,this._outlineMaterial)};r.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(C.ModelContentType.MATERIAL,this._material.getId()),this._material=null);this._outlineMaterial&&(this._context.stage.remove(C.ModelContentType.MATERIAL,this._outlineMaterial.getId()),this._outlineMaterial=
null)};r.prototype.createGraphics3DGraphic=function(a,b){var c=this._validateGeometry(a.geometry);if("polyline"!==c.type&&"polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for fill symbol: "+c.type),null;c="graphic"+a.uid;b=this._getVertexOpacityAndColor(b,Uint8Array,255);var h=this.getGraphicElevationInfo(a);return"on-the-ground"===h.mode?this._createAsOverlay(a,b,h,c):this._createAs3DShape(a,b,h,c,a.uid)};r.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===
a)return b=this._material.getColor(),b[3]=this._getMaterialOpacity(),this._material.setColor(b),this._material.setTransparent(1>b[3]),this._outlineMaterial&&(this._isOutlineNativeLineMaterial?(b=this._outlineMaterial.getColor(),b[3]=this._getOutlineOpacity(),this._outlineMaterial.setColor(b)):(b=this._outlineMaterial.getParameterValues(),b.color[3]=this._getOutlineOpacity(),this._outlineMaterial.setParameterValues({color:b.color}))),!0;if("elevationInfo"===a){a=this._elevationInfo.mode;this._updateElevationInfo();
var f=this._elevationInfo.mode;if(null==a||null==f)return!1;if("on-the-ground"===a&&"on-the-ground"===f)return!0;if(a!==f&&("on-the-ground"===a||"on-the-ground"===f))return!1;a=h.needsElevationUpdates2D(f);for(var k in b){var e=b[k];(f=c(e))&&!f.isDraped()&&(e=e.graphic,f.needsElevationUpdates=a,f.elevationInfo.set(this.getGraphicElevationInfo(e)))}return!0}return!1};r.prototype.setDrawOrder=function(a,b,c){this._material&&(this._material.setRenderPriority(a+b/2),c[this._material.getId()]=!0);this._outlineMaterial&&
(this._outlineMaterial.setRenderPriority(a),c[this._outlineMaterial.getId()]=!0)};r.prototype._createAs3DShape=function(a,b,f,l,n){var e=this._getPolyGeometry(a),d=e.hasZ;a=e.rings;var g=this._getOutlineGeometry(e,a),e=h.getGeometryVertexData3D(g,d,e.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,f);P.idHint=l;P.color=b;P.data=e;var k;this._hasOutline&&(k=new e.vertexData.constructor(e.vertexData));P.outNum=0;P.outGeometries=
[];P.outTransforms=[];P.outMaterials=[];this._createAs3DShapeFill(P);P.data.vertexData=k;this._createAs3DShapeOutline(P);this._logGeometryCreationWarnings(P.data,a,"rings","FillSymbol3DLayer");if(0===P.outNum)return null;b=new E({geometries:P.outGeometries,materials:P.outMaterials,transformations:P.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicId:n},idHint:l});b=new c(this,b,P.outGeometries,null,null,p.perVertexElevationAligner,f);b.alignedTerrainElevation=e.terrainElevation;
b.needsElevationUpdates=h.needsElevationUpdates2D(f.mode);return b};r.prototype._createAs3DShapeFill=function(a){for(var b=a.data.geometryData.polygons,c=a.data.eleVertexData,f=a.data.vertexData,l=function(d){var g=b[d];d=g.count;var k=g.index;if(e._context.clippingExtent&&(h.computeBoundingBox(c,k,d,M),h.boundingBoxClipped(M,e._context.clippingExtent)))return"continue";var l=new Float64Array(c.buffer,3*k*c.BYTES_PER_ELEMENT,3*d),n=new Float64Array(f.buffer,3*k*f.BYTES_PER_ELEMENT,3*d),g=g.holeIndices.map(function(a){return a-
k}),g=K(l,g,3);if(0===g.length)return"continue";h.chooseOrigin(f,k,d,Q);h.subtractCoordinates(f,k,d,Q);d=e._createFillGeometry(g,0,n,l,a.color);d=new G(d,a.idHint);d.singleUse=!0;l=N.identity();N.translate(l,Q,l);a.outGeometries.push(d);a.outMaterials.push([e._material]);a.outTransforms.push(l);a.outNum++},e=this,d=0;d<b.length;++d)l(d)};r.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.data.geometryData.outlines,c=a.data.eleVertexData,f=a.data.vertexData,n=0;n<b.length;++n){var e=
b[n],d=e.index,g=e.count;if(this._context.clippingExtent&&(h.computeBoundingBox(c,d,g,M),h.boundingBoxClipped(M,this._context.clippingExtent)))continue;h.chooseOrigin(f,d,g,Q);h.subtractCoordinates(f,d,g,Q);e=new Float64Array(c.buffer,3*d*c.BYTES_PER_ELEMENT,3*g);d=new Float64Array(f.buffer,3*d*f.BYTES_PER_ELEMENT,3*g);d=l.createPolylineGeometry(d,e,a.isRings,S,0);d=new G(d,a.idHint+"outline"+n);d.singleUse=!0;e=N.identity();N.translate(e,Q,e);a.outGeometries.push(d);a.outMaterials.push([this._outlineMaterial]);
a.outTransforms.push(e);a.outNum++}};r.prototype._createAsOverlay=function(a,b,c,f){var k=this._getPolyGeometry(a);a=k.rings;var e=this._getOutlineGeometry(k,a);this._material.setRenderPriority(this._symbolLayerOrder+this._symbolLayerOrderDelta/2);this._hasOutline&&this._outlineMaterial.setRenderPriority(this._symbolLayerOrder);k=h.getGeometryVertexDataDraped(e,k.spatialReference,this._context.overlaySR);P.idHint=f;P.color=b;P.data=k;var d;this._hasOutline&&(d=new k.vertexData.constructor(k.vertexData));
P.outNum=0;P.outGeometries=[];P.outBoundingBox=u.create(u.NEGATIVE_INFINITY);this._createAsOverlayFill(P);P.data.vertexData=d;this._createAsOverlayOutline(P);this._logGeometryCreationWarnings(P.data,a,"rings","FillSymbol3DLayer");return 0<P.outNum?new t(this,P.outGeometries,null,null,P.outBoundingBox,c):null};r.prototype._createAsOverlayFill=function(a){for(var b=a.data.vertexData,c=a.data.geometryData.polygons,f=function(d){var e=c[d];d=e.count;var f=e.index,k=new Float64Array(b.buffer,3*f*b.BYTES_PER_ELEMENT,
3*d),e=e.holeIndices.map(function(a){return a-f}),k=K(k,e,3);if(0===k.length)return"continue";h.computeBoundingBox(b,f,d,M);if(h.boundingBoxClipped(M,l._context.clippingExtent))return"continue";u.expand(a.outBoundingBox,M);h.chooseOrigin(b,f,d,Q);h.subtractCoordinates(b,f,d,Q);h.setZ(b,f,d,l._getDrapedZ());d=N.identity();N.translate(d,Q,d);k=l._createFillGeometry(k,f,b,null,a.color);e=new A(k);e.material=l._material;var n=M;e.center=[.5*(n[0]+n[3]),.5*(n[1]+n[4]),0];e.bsRadius=.5*Math.sqrt((n[3]-
n[0])*(n[3]-n[0])+(n[4]-n[1])*(n[4]-n[1]));e.transformation=d;e.name=a.idHint;e.uniqueName=a.idHint+"#"+k.id;a.outGeometries.push(e);a.outNum++},l=this,e=0;e<c.length;++e)f(e)};r.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=a.data.vertexData,c=a.data.geometryData.outlines,f=0;f<c.length;++f){var n=c[f],e=n.index,n=n.count;h.computeBoundingBox(b,e,n,M);if(!h.boundingBoxClipped(M,this._context.clippingExtent)){u.expand(a.outBoundingBox,M);h.chooseOrigin(b,e,n,Q);h.subtractCoordinates(b,
e,n,Q);h.setZ(b,e,n,this._getDrapedZ());n=new Float64Array(b.buffer,3*e*b.BYTES_PER_ELEMENT,3*n);e=N.identity();N.translate(e,Q,e);var n=l.createPolylineGeometry(n,null,!0,S,0),d=new A(n);d.material=this._outlineMaterial;var g=M;d.center=[.5*(g[0]+g[3]),.5*(g[1]+g[4]),0];d.bsRadius=.5*Math.sqrt((g[3]-g[0])*(g[3]-g[0])+(g[4]-g[1])*(g[4]-g[1]));d.transformation=e;d.name=a.idHint+"outline";d.uniqueName=a.idHint+"outline#"+n.id;a.outGeometries.push(d);a.outNum++}}};r.prototype._getOutlineGeometry=function(a,
b){return b};r.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbol.outline.color.a};r.prototype._getOutlineColor=function(){var a=this.symbol.outline.color,b=this._getOutlineOpacity();return q.mixinColorAndOpacity(z.toUnitRGB(a),b)};r.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?y.fromExtent(a):a};r.prototype._createFillGeometry=function(a,b,c,h,f){for(var e=a.length,d=new Uint32Array(e),g=new Uint32Array(e),k=0;k<e;k++)d[k]=a[k]+b,g[k]=
0;a={};b={};a[J.POSITION]=d;a[J.COLOR]=g;b[J.POSITION]={size:3,data:c};b[J.COLOR]={size:4,data:f};h&&(b.mapPos={size:3,data:h},a.mapPos=d);return new n(b,a)};return r}(b);var M=u.create(),Q=B.create(),S=new Float32Array([255,255,255,255]),P={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return b})},"esri/views/3d/layers/graphics/earcut/earcut":function(){define([],function(){function B(h,l,q){q=q||2;var n=l&&l.length,u=n?l[0]*
q:h.length,t=r(h,0,u,q,!0),y=[];if(!t)return y;var x,z,A,C;if(n){var E=q,n=[],B,G,W;C=0;for(B=l.length;C<B;C++)G=l[C]*E,W=C<B-1?l[C+1]*E:h.length,G=r(h,G,W,E,!1),G===G.next&&(G.steiner=!0),n.push(p(G));n.sort(b);for(C=0;C<n.length;C++){l=n[C];E=t;if(E=c(l,E))l=w(E,l),f(l,l.next);t=f(t,t.next)}}if(h.length>80*q){x=A=h[0];z=n=h[1];for(E=q;E<u;E+=q)C=h[E],l=h[E+1],C<x&&(x=C),l<z&&(z=l),C>A&&(A=C),l>n&&(n=l);A=Math.max(A-x,n-z)}a(t,y,q,x,z,A);return y}function r(a,b,c,h,f){var l;if(f===0<G(a,b,c,h))for(f=
b;f<c;f+=h)l=u(f,a[f],a[f+1],l);else for(f=c-h;f>=b;f-=h)l=u(f,a[f],a[f+1],l);l&&q(l,l.next)&&(C(l),l=l.next);return l}function f(a,b){if(!a)return a;b||(b=a);var c;do if(c=!1,a.steiner||!q(a,a.next)&&0!==l(a.prev,a,a.next))a=a.next;else{C(a);a=b=a.prev;if(a===a.next)return null;c=!0}while(c||a!==b);return b}function a(b,c,p,u,r,E,B){if(b){if(!B&&E){var n=b,x=n;do null===x.z&&(x.z=t(x.x,x.y,u,r,E)),x.prevZ=x.prev,x=x.nextZ=x.next;while(x!==n);x.prevZ.nextZ=null;x.prevZ=null;var n=x,A,J,G,I,K,N,k=
1;do{x=n;G=n=null;for(I=0;x;){I++;J=x;for(A=K=0;A<k&&(K++,J=J.nextZ,J);A++);for(N=k;0<K||0<N&&J;)0===K?(A=J,J=J.nextZ,N--):0!==N&&J?x.z<=J.z?(A=x,x=x.nextZ,K--):(A=J,J=J.nextZ,N--):(A=x,x=x.nextZ,K--),G?G.nextZ=A:n=A,A.prevZ=G,G=A;x=J}G.nextZ=null;k*=2}while(1<I)}for(n=b;b.prev!==b.next;){x=b.prev;J=b.next;if(E)a:{G=b;N=u;var ca=r,V=E;I=G.prev;K=G;k=G.next;if(0<=l(I,K,k))G=!1;else{var e=I.x>K.x?I.x>k.x?I.x:k.x:K.x>k.x?K.x:k.x,d=I.y>K.y?I.y>k.y?I.y:k.y:K.y>k.y?K.y:k.y;A=t(I.x<K.x?I.x<k.x?I.x:k.x:K.x<
k.x?K.x:k.x,I.y<K.y?I.y<k.y?I.y:k.y:K.y<k.y?K.y:k.y,N,ca,V);N=t(e,d,N,ca,V);for(ca=G.nextZ;ca&&ca.z<=N;){if(ca!==G.prev&&ca!==G.next&&h(I.x,I.y,K.x,K.y,k.x,k.y,ca.x,ca.y)&&0<=l(ca.prev,ca,ca.next)){G=!1;break a}ca=ca.nextZ}for(ca=G.prevZ;ca&&ca.z>=A;){if(ca!==G.prev&&ca!==G.next&&h(I.x,I.y,K.x,K.y,k.x,k.y,ca.x,ca.y)&&0<=l(ca.prev,ca,ca.next)){G=!1;break a}ca=ca.prevZ}G=!0}}else a:if(G=b,I=G.prev,K=G,k=G.next,0<=l(I,K,k))G=!1;else{for(A=G.next.next;A!==G.prev;){if(h(I.x,I.y,K.x,K.y,k.x,k.y,A.x,A.y)&&
0<=l(A.prev,A,A.next)){G=!1;break a}A=A.next}G=!0}if(G)c.push(x.i/p),c.push(b.i/p),c.push(J.i/p),C(b),n=b=J.next;else if(b=J,b===n){if(!B)a(f(b),c,p,u,r,E,1);else if(1===B){B=c;n=p;x=b;do J=x.prev,G=x.next.next,!q(J,G)&&y(J,x,x.next,G)&&z(J,G)&&z(G,J)&&(B.push(J.i/n),B.push(x.i/n),B.push(G.i/n),C(x),C(x.next),x=b=G),x=x.next;while(x!==b);b=x;a(b,c,p,u,r,E,2)}else if(2===B)a:{B=b;do{for(n=B.next.next;n!==B.prev;){if(x=B.i!==n.i){x=B;J=n;G=void 0;if(G=x.next.i!==J.i&&x.prev.i!==J.i){G=void 0;b:{G=x;
do{if(G.i!==x.i&&G.next.i!==x.i&&G.i!==J.i&&G.next.i!==J.i&&y(G,G.next,x,J)){G=!0;break b}G=G.next}while(G!==x);G=!1}G=!G}I=void 0;if(I=G&&z(x,J)&&z(J,x)){G=x;I=!1;K=(x.x+J.x)/2;J=(x.y+J.y)/2;do G.y>J!==G.next.y>J&&K<(G.next.x-G.x)*(J-G.y)/(G.next.y-G.y)+G.x&&(I=!I),G=G.next;while(G!==x)}x=I}if(x){b=w(B,n);B=f(B,B.next);b=f(b,b.next);a(B,c,p,u,r,E);a(b,c,p,u,r,E);break a}n=n.next}B=B.next}while(B!==b)}break}}}}function b(a,b){return a.x-b.x}function c(a,b){var c=b,f=a.x,l=a.y,n=-Infinity,p;do{if(l<=
c.y&&l>=c.next.y){var q=c.x+(l-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(q<=f&&q>n){n=q;if(q===f){if(l===c.y)return c;if(l===c.next.y)return c.next}p=c.x<c.next.x?c:c.next}}c=c.next}while(c!==b);if(!p)return null;if(f===n)return p.prev;b=p;for(var q=p.x,u=p.y,t=Infinity,r,c=p.next;c!==b;)f>=c.x&&c.x>=q&&h(l<u?f:n,l,q,u,l<u?n:f,l,c.x,c.y)&&(r=Math.abs(l-c.y)/(f-c.x),(r<t||r===t&&c.x>p.x)&&z(c,a)&&(p=c,t=r)),c=c.next;return p}function t(a,b,c,h,f){a=32767*(a-c)/f;b=32767*(b-h)/f;a=(a|a<<8)&16711935;a=(a|
a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function p(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function h(a,b,c,h,f,l,p,q){return 0<=(f-p)*(b-q)-(a-p)*(l-q)&&0<=(a-p)*(h-q)-(c-p)*(b-q)&&0<=(c-p)*(l-q)-(f-p)*(h-q)}function l(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function q(a,b){return a.x===b.x&&a.y===b.y}function y(a,b,c,h){return q(a,b)&&q(c,h)||q(a,h)&&
q(c,b)?!0:0<l(a,b,c)!==0<l(a,b,h)&&0<l(c,h,a)!==0<l(c,h,b)}function z(a,b){return 0>l(a.prev,a,a.next)?0<=l(a,b,a.next)&&0<=l(a,a.prev,b):0>l(a,b,a.prev)||0>l(a,a.next,b)}function w(a,b){var c=new E(a.i,a.x,a.y),h=new E(b.i,b.x,b.y),f=a.next,l=b.prev;a.next=b;b.prev=a;c.next=f;f.prev=c;h.next=c;c.prev=h;l.next=h;h.prev=l;return h}function u(a,b,c,h){a=new E(a,b,c);h?(a.next=h.next,a.prev=h,h.next.prev=a,h.next=a):(a.prev=a,a.next=a);return a}function C(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&
(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function E(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function G(a,b,c,h){for(var f=0,l=c-h;b<c;b+=h)f+=(a[l]-a[b])*(a[b+1]+a[l+1]),l=b;return f}B.deviation=function(a,b,c,h){var f=b&&b.length,l=Math.abs(G(a,0,f?b[0]*c:a.length,c));if(f)for(var f=0,n=b.length;f<n;f++)l-=Math.abs(G(a,b[f]*c,f<n-1?b[f+1]*c:a.length,c));for(f=b=0;f<h.length;f+=3){var n=h[f]*c,p=h[f+1]*c,q=h[f+2]*c;b+=
Math.abs((a[n]-a[q])*(a[p+1]-a[n+1])-(a[n]-a[p])*(a[q+1]-a[n+1]))}return 0===l&&0===b?0:Math.abs((b-l)/l)};B.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},h=0,f=0;f<a.length;f++){for(var l=0;l<a[f].length;l++)for(var n=0;n<b;n++)c.vertices.push(a[f][l][n]);0<f&&(h+=a[f-1].length,c.holes.push(h))}return c};return B})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ../../../../geometry/Polygon ../../../../geometry/Point ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/Material ../../webgl-engine/lib/Util ./earcut/earcut ./graphicUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G){function n(a,b,d,e,c,g,h,f,k,l,n,p,q,u){var m=d.length/3,t=0;n+=2*e.count;var r=e.index,w=e.count,v=k,y=n;J.set(q,Q);var z=0<p?1:-1,r=3*r,A=v;q=3*A;for(var C=v+w,v=3*C,E=0;E<w;++E)u&&(Q[0]=a[r+0],Q[1]=a[r+1],Q[2]=a[r+2],J.normalize(Q)),c[q+0]=a[r+0],c[q+1]=a[r+1],c[q+2]=a[r+2],g[q+0]=b[r+0],g[q+1]=b[r+1],g[q+2]=b[r+2],h[q+0]=-z*Q[0],h[q+1]=-z*Q[1],h[q+2]=-z*Q[2],f[A]=0,c[v+0]=a[r+0]+p*Q[0],c[v+1]=a[r+1]+p*Q[1],c[v+2]=a[r+2]+p*Q[2],g[v+0]=b[r+0],g[v+1]=
b[r+1],g[v+2]=b[r+2],h[v+0]=z*Q[0],h[v+1]=z*Q[1],h[v+2]=z*Q[2],f[C]=p,q+=3,v+=3,r+=3,A+=1,C+=1;r=0;q=3*y;v=3*(y+m);q=3*(y+m);v=3*y;a=S;b=P;0>p&&(a=P,b=S);for(E=0;E<m;++E)l[q+0]=d[r+a[0]],l[q+1]=d[r+a[1]],l[q+2]=d[r+a[2]],l[v+0]=d[r+b[0]]+w,l[v+1]=d[r+b[1]]+w,l[v+2]=d[r+b[2]]+w,q+=3,v+=3,r+=3;k+=2*e.count;n=n+2*m-(2*e.count+2*m);x(c,g,f,h,t,e.pathLengths[0],e.count,k,l,n,p);k+=4*e.pathLengths[0];n+=2*e.pathLengths[0];t+=e.pathLengths[0];for(d=1;d<e.pathLengths.length;++d)x(c,g,f,h,t,e.pathLengths[d],
e.count,k,l,n,p),k+=4*e.pathLengths[d],n+=2*e.pathLengths[d],t+=e.pathLengths[d]}function A(a,b,d,e,c,g,h){e[g]=e[h];h*=3;g*=3;a[g+0]=a[h+0];a[g+1]=a[h+1];a[g+2]=a[h+2];b[g+0]=b[h+0];b[g+1]=b[h+1];b[g+2]=b[h+2];d[g+0]=c[0];d[g+1]=c[1];d[g+2]=c[2]}function x(a,b,d,c,g,h,f,l,n,p,q){var m=g,u=g+1,t=g+f,r=g+f+1,w=l,v=l+1,y=l+2*h;l=l+2*h+1;0>q&&(m=g+f+1,r=g);p*=3;for(var z=0;z<h;++z){z===h-1&&(0<q?(u=g,r=g+f):(u=g,m=g+f));var x=a,C=m,E=u,D=t,B=U,C=3*C,E=3*E,D=3*D;J.set3(x[C++],x[C++],x[C++],W);J.set3(x[E++],
x[E++],x[E++],k);J.set3(x[D++],x[D++],x[D++],ca);J.subtract(k,W,V);J.subtract(ca,W,e);J.cross(e,V,B);J.normalize(B,B);A(a,b,c,d,U,w,m);A(a,b,c,d,U,v,u);A(a,b,c,d,U,y,t);A(a,b,c,d,U,l,r);n[p++]=w;n[p++]=y;n[p++]=l;n[p++]=w;n[p++]=l;n[p++]=v;m++;u++;t++;r++;w+=2;v+=2;y+=2;l+=2}}function I(a,b,e,h){var f=h.setAltitude;O.spatialReference=e.spatialReference;for(var k=a.getGeometryRecords(),l=k.length,m="absolute-height"!==b.mode,n=0,p=0;p<l;p++){var q=k[p].geometry,u=k[p].transformation;g[0]=u[12];g[1]=
u[13];g[2]=u[14];q.invalidateBoundingInfo();for(var t=q.getData().getVertexAttr(),q=t[K.POSITION].data,u=t[K.SIZE].data,t=t.mapPos.data,r=q.length/3,w=0,v=0,y=!1,z=0,x=0;x<r;x++){O.x=t[v];O.y=t[v+1];O.z=t[v+2];d[0]=q[w];d[1]=q[w+1];d[2]=q[w+2];var A=c.computeElevation(e,O,b,h,m?T:null);m&&(z+=T.terrainElevation);M[0]=q[w]+g[0];M[1]=q[w+1]+g[1];M[2]=q[w+2]+g[2];f(A+u[w/3],M,0);q[w]=M[0]-g[0];q[w+1]=M[1]-g[1];q[w+2]=M[2]-g[2];A=.01/h.unitInMeters;if(Math.abs(d[0]-q[w])>A||Math.abs(d[1]-q[w+1])>A||Math.abs(d[2]-
q[w+2])>A)y=!0;v+=3;w+=3}y&&a.geometryVertexAttrsUpdated(p);n+=z/r}return n/l}var K=C.VertexAttrConstants,J=l.vec3d,N=l.mat4d,M=J.create(),Q=J.create(),S=[0,2,1],P=[0,1,2],O=new p,T={verticalDistanceToGround:0,terrainElevation:0};B=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}f(d,a);d.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=G.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),
b=this._getMaterialOpacityAndColor(),d=J.create(b),b=b[3],d={diffuse:d,ambient:d,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:!0};this._material=new u(d,a+"_3dlinemat");this._context.stage.add(q.ModelContentType.MATERIAL,this._material);this.resolve()};d.prototype.destroy=function(){a.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(q.ModelContentType.MATERIAL,this._material.getId())};d.prototype.createGraphics3DGraphic=
function(a,b){var d=this._validateGeometry(a.geometry);if("polygon"!==d.type&&"extent"!==d.type)return this._logWarning("unsupported geometry type for extrude symbol: "+d.type),null;var d="polygon"===d.type||"extent"===d.type?"rings":"paths",e="graphic"+a.uid,c=this._getVertexOpacityAndColor(b,Float32Array,255),g=this.getGraphicElevationInfo(a);return this._createAs3DShape(a,d,b,c,g,e,a.uid)};d.prototype.layerPropertyChanged=function(a,b,d){if("opacity"===a)return b=this._getMaterialOpacity(),d=1>
b||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:b,transparent:d}),!0;if("elevationInfo"===a){this._updateElevationInfo();for(var e in b){var g=b[e];if(a=d(g))g=this.getGraphicElevationInfo(g.graphic),a.needsElevationUpdates=c.needsElevationUpdates3D(g.mode),a.elevationInfo.set(g)}return!0}return!1};d.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?c.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};
d.prototype._getSymbolSize=function(){return this.symbol.size||1};d.prototype._createAs3DShape=function(a,d,e,g,f,k,l){var m=a.geometry;"extent"===m.type&&(m=t.fromExtent(m));a=m[d];var p=m.hasZ,q=[],u=[],r=[],w=J.create(),v=Array(6),x=this._context.renderSpatialReference===h.SphericalRenderSpatialReference,A=this._getExtrusionSize(e),C=J.create();x||this._context.renderCoordsHelper.worldUpAtPosition(null,C);e=c.getGeometryVertexData3D(a,p,m.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,
this._context.renderCoordsHelper,f);this._logGeometryCreationWarnings(e,a,d,"ExtrudeSymbol3DLayer");if(0<a.length){var D=e.geometryData.polygons,B=e.eleVertexData,G=e.vertexData;d=G.length/3;var K=new Float64Array(18*d),U=new Float64Array(18*d),M=new Float64Array(18*d),L=new Float64Array(6*d),W=0;d=function(a){var b=D[a],d=b.count,e=b.index;if(Q._context.clippingExtent&&(c.computeBoundingBox(B,e,d,v),c.boundingBoxClipped(v,Q._context.clippingExtent)))return"continue";var h=new Float64Array(B.buffer,
3*e*K.BYTES_PER_ELEMENT,3*d),f=b.holeIndices.map(function(a){return a-e}),h=E(h,f,3);if(0<h.length){c.chooseOrigin(G,e,d,w);var f=new Uint32Array(6*d+2*h.length),l=6*d,m=new Float64Array(K.buffer,3*W*K.BYTES_PER_ELEMENT,3*l),p=new Float64Array(U.buffer,3*W*U.BYTES_PER_ELEMENT,3*l),t=new Float64Array(M.buffer,3*W*M.BYTES_PER_ELEMENT,3*l),y=new Float64Array(L.buffer,1*W*L.BYTES_PER_ELEMENT,1*l);n(G,B,h,b,m,t,p,y,0,f,0,A,C,x);c.subtractCoordinates(m,0,l,w);W+=6*d;b=Q._createExtrudeGeometry(f,{positions:m,
elevation:t,normals:p,heights:y},g);a=new z(b,k+"path"+a);a.singleUse=!0;q.push(a);u.push([Q._material]);a=N.identity();N.translate(a,w,a);r.push(a)}};var Q=this;for(a=0;a<D.length;++a)d(a);if(0<q.length)return l=new y({geometries:q,materials:u,transformations:r,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:l},idHint:k}),l=new b(this,l,q,null,null,I,f),l.alignedTerrainElevation=e.terrainElevation,l.needsElevationUpdates=c.needsElevationUpdates3D(f.mode),l}return null};d.prototype._createExtrudeGeometry=
function(a,b,d){for(var e=a.length,c=new Uint32Array(e),g=0;g<e;g++)c[g]=0;e={};g={};e[K.POSITION]=a;e[K.NORMAL]=a;e[K.COLOR]=c;g[K.POSITION]={size:3,data:b.positions};g[K.NORMAL]={size:3,data:b.normals};g[K.COLOR]={size:4,data:d};g[K.SIZE]={size:1,data:b.heights};b.elevation&&(g.mapPos={size:3,data:b.elevation},e.mapPos=a);return new w(g,e)};return d}(a);var U=J.create(),W=J.create(),k=J.create(),ca=J.create(),V=J.create(),e=J.create(),d=J.create(),g=J.create();return B})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u){var C=[1,1,1,1],E=[0,0,1],G={mode:"relative-to-ground",offset:0},n=[0,0,0,1];return function(t){function r(){var a=null!==t&&t.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}f(r,t);r.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=q.validateSymbolLayerSize(this._getTextSize());if(a){this._logWarning(a);this.reject();return}}this._anchor="center";this.resolve()};r.prototype.destroy=
function(){t.prototype.destroy.call(this);this.isFulfilled()||this.reject()};r.prototype.createGraphics3DGraphic=function(a,b,c,h){var f="polyline"===a.geometry.type,l=this._getGeometry(a);if(!l)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var n=this._context.layer.id+"_label_"+a.uid,p=b.text||this.symbol.text;if(!p||1>p.length)return null;b&&null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var q=this.getGraphicElevationInfo(a,
b.elevationOffset||0);return this._createAs3DShape(this.symbol,l,p,q,n,a.uid,b,c,h,f)};r.prototype.getGraphicElevationInfo=function(a,b){void 0===b&&(b=0);a=t.prototype.getGraphicElevationInfo.call(this,a);a.addOffsetRenderUnits(b);return a};r.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"polyline"===a.type?l.placePointOnPolyline(a):"polygon"===a.type?l.placePointOnPolygon(a):"extent"===a.type?a.center:"point"!==a.type?null:a};r.prototype.layerPropertyChanged=function(a,
b,c){if("opacity"===a)this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===a){this._updateElevationInfo();if(b)for(var h in b){a=b[h];var f=c(a);f&&this.updateGraphicElevationInfo(a.graphic,f)}return!0}return!1};r.prototype.updateGraphicElevationInfo=function(a,b){a=this.getGraphicElevationInfo(a,b.metadata.elevationOffset);b.elevationInfo.set(a);b.needsElevationUpdates=l.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};r.prototype._defaultElevationInfoNoZ=
function(){return G};r.prototype._createAs3DShape=function(f,q,t,r,x,A,B,G,O,T){var J=B.centerOffset||n,I=B.screenOffset||[0,0],k=B.debugDrawBorder||!1,K=B.translation||[0,0,0],N=B.anchor||this._anchor||"center";this._anchor=N;var e=f.material?a.toUnitRGBA(f.material.color):C,d=f.halo&&f.halo.color&&0<f.halo.size,g=d?a.toUnitRGBA(f.halo.color):C,d=d?b.pt2px(f.halo.size):0,m=this._getTextSize(f);f=new w(t,{size:m,color:e,font:{family:f.font&&f.font.family?f.font.family:"Arial",weight:f.font&&f.font.weight?
f.font.weight:"normal",style:f.font&&f.font.style?f.font.style:"normal"},halo:{size:d,color:g}},x);O=(e=O&&O.canHoldTextTexture(f))?O.addTextTexture(f):null;var v;G?v=B:c.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(v=this.symbolContainer);I={textureId:e?O.texture.getId():f.getId(),texCoordScale:e?[1,1]:f.getTexcoordScale(),occlusionTest:!0,screenOffset:I,anchorPos:N,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:B.centerOffsetUnits,debugDrawBorder:k,
drawInSecondSlot:!0};v&&v.verticalOffset&&(v=v.verticalOffset,k=v.minWorldLength,N=v.maxWorldLength,I.verticalOffset={screenLength:b.pt2px(v.screenLength),minWorldLength:k||0,maxWorldLength:null!=N?N:Infinity});this._context.screenSizePerspectiveEnabled&&(v=this._context.sharedResources,k=v.screenSizePerspectiveSettings,I.screenSizePerspective=v.screenSizePerspectiveSettingsLabels.overridePadding(d),I.screenSizePerspectiveAlignment=k);T&&(I.shaderPolygonOffset=1E-4);T=null;d=JSON.stringify(I);null!=
G?(T=G.getMaterial(d),null==T?(T=new u(I,x),G.addMaterial(d,T)):e&&T.setTextureDirty()):T=new u(I,x);T=[T];d=[f.getTextWidth(),f.getTextHeight()];J=z.createPointGeometry(E,K,void 0,d,J,O?O.uvMinMax:null);J=[new y(J,x)];x=l.createStageObjectForPoint.call(this,q,J,[T],null,null,r,x,this._context.layer.uid,A,!0);G=new p(this,x.object,J,null==G?T:null,e?null:[f],h.perObjectElevationAligner,r);G.alignedTerrainElevation=x.terrainElevation;G.needsElevationUpdates=l.needsElevationUpdates2D(r.mode)||"absolute-height"===
r.mode;var D=e?f.getTextWidth():f.getWidth(),M=e?f.getTextHeight():f.getHeight();G.getScreenSize=function(a){void 0===a&&(a=Array(2));a[0]=D;a[1]=M;return a};G.metadata={labelText:t,elevationOffset:B.elevationOffset||0};l.extendPointGraphicElevationInfo(G,q,this._context.elevationProvider);return G};r.prototype._getTextSize=function(a){return b.pt2px((a||this.symbol).size)||12};return r}(t)})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ./Texture ./Util ../../../webgl/Texture ../../../webgl/enums".split(" "),
function(B,r,f,a,b,c){function t(){var a=document.createElement("canvas");a.width=512;a.height=512;return a}function p(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"}function h(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"}B=function(){function c(b,c,f,l){void 0===l&&(l=!0);this._idHint=f;this._text=b;this._textLines=b.split(/\r?\n/);this._params=c;this._haloSize=Math.round(this._params.halo.size);this._fillStyle=
h(this._params.color);this._haloStyle=p(this._params.halo.color);this._textWidth=this._computeTextWidth();this._lineHeight=this._computeLineHeight();this._textHeight=this._computeTextHeight();this._scaleFactor=l?Math.min(1,Math.min(2048/this._textWidth,2048/this._textHeight)):1;this._renderedWidth=Math.round(this._textWidth*this._scaleFactor);this._renderedHeight=Math.round(this._textHeight*this._scaleFactor);l&&a.assert(2048>=this._renderedWidth&&2048>=this._renderedHeight);this._width=a.nextHighestPowerOfTwo(this._renderedWidth);
this._height=a.nextHighestPowerOfTwo(this._renderedHeight)}c.prototype.getId=function(){null==this._id&&(this._id=f.idGen.gen(this._idHint));return this._id};c.prototype.getParams=function(){return this._params};c.prototype.getText=function(){return this._text};c.prototype.deferredLoading=function(){return!1};c.prototype.getWidth=function(){return this._width};c.prototype.getHeight=function(){return this._height};c.prototype.getTextWidth=function(){return this._textWidth};c.prototype.getTextHeight=
function(){return this._textHeight};c.prototype.getRenderedWidth=function(){return this._renderedWidth};c.prototype.getRenderedHeight=function(){return this._renderedHeight};c.prototype.initializeThroughRender=function(a,c){var h=this._getTextCanvas();h.width=this._width;h.height=this._height;var f=h.getContext("2d");f.save();c.samplingMode=9987;c.wrapMode=33071;c.flipped=!0;c.preMultiplyAlpha=!0;c.hasMipmap=!0;this.renderText(this._renderedWidth,this._renderedHeight,f,0,this._height-this._renderedHeight);
a=new b(a,c,h);f.restore();return a};c.prototype.getTexcoordScale=function(){return[this._renderedWidth/this._width,this._renderedHeight/this._height]};c.prototype.setUnloadFunc=function(a){this._unloadFunc=a};c.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};c.prototype.renderText=function(a,b,c,h,f){void 0===h&&(h=0);void 0===f&&(f=0);b=this._lineHeight*this._scaleFactor;var p=this._haloSize,q=c.textAlign;a=("center"===q?.5*a:"right"===q?a:0)+p;
c.save();var n=3>p;if(0<p){var q=p,u=this._getHaloCanvas();u.width=Math.max(512,this._renderedWidth);u.height=Math.max(512,this._renderedHeight);var t=u.getContext("2d");t.clearRect(0,0,u.width,u.height);this._setFontProperties(t,this._params.size*this._scaleFactor);t.fillStyle=this._haloStyle;t.strokeStyle=this._haloStyle;t.lineJoin=n?"miter":"round";if(n)for(var r=0,w=this._textLines;r<w.length;r++){for(var n=w[r],y=0,z=l;y<z.length;y++){var C=z[y];t.fillText(n,a+p*C[0],p+p*C[1])}q+=b}else for(r=
0,w=this._textLines;r<w.length;r++){n=w[r];y=2*p;for(z=0;5>z;z++)t.lineWidth=(.6+.1*z)*y,t.strokeText(n,a,q);q+=b}c.globalAlpha=this._params.halo.color[3];c.drawImage(u,h,f);u.width=512;u.height=512;c.globalAlpha=1}this._setFontProperties(c,this._params.size*this._scaleFactor);q=f+p;f=0;for(p=this._textLines;f<p.length;f++)n=p[f],c.globalCompositeOperation="destination-out",c.fillStyle="rgb(0, 0, 0)",c.fillText(n,h+a,q),c.globalCompositeOperation="source-over",c.fillStyle=this._fillStyle,c.fillText(n,
h+a,q),q+=b;c.restore()};c.preferredAtlasSize=function(){return 512};c.prototype._getTextCanvas=function(){null==c._textCanvas2D&&(c._textCanvas2D=t());return c._textCanvas2D};c.prototype._getHaloCanvas=function(){null==c._haloCanvas2D&&(c._haloCanvas2D=t());return c._haloCanvas2D};c.prototype._setFontProperties=function(a,b){var c=this._params.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family;a.textAlign="left";a.textBaseline="top"};c.prototype._computeTextWidth=function(){var a=this._getTextCanvas().getContext("2d");
this._setFontProperties(a,this._params.size);for(var b=0,c=0,h=this._textLines;c<h.length;c++){var f=a.measureText(h[c]).width;f>b&&(b=f)}c=this._params.font;if("italic"===c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)b+=.3*a.measureText("A").width;b+=2*this._haloSize;return b=Math.round(b)};c.prototype._computeLineHeight=function(){return Math.floor(1.275*this._params.size+2*this._haloSize)};c.prototype._computeTextHeight=
function(){return this._computeLineHeight()*this._textLines.length};return c}();var l=[];for(r=0;360>r;r+=22.5)l.push([Math.cos(Math.PI*r/180),Math.sin(Math.PI*r/180)]);return B})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./Graphics3DSymbol","./Graphics3DCalloutSymbolLayerFactory"],function(B,r,f,a,b){return function(a){function c(c,h,f){c=a.call(this,c,h,f)||this;c.calloutSymbolLayer=null;c.symbol.hasVisibleCallout()&&
(c.calloutSymbolLayer=b.make(c.symbol,h));return c}f(c,a);c.prototype.destroy=function(){a.prototype.destroy.call(this)};c.prototype.createGraphics3DGraphic=function(b,c,f){f=a.prototype.createGraphics3DGraphic.call(this,b,c,f);this.calloutSymbolLayer&&(b=this.createCalloutGraphic(b,c))&&f.addAuxiliaryGraphic(b);return f};c.prototype.layerPropertyChanged=function(b,c){var h=this;return a.prototype.layerPropertyChanged.call(this,b,c)?this.calloutSymbolLayer?this.calloutSymbolLayer.layerPropertyChanged(b,
c,function(a){var b=0;for(a=a._auxiliaryGraphics;b<a.length;b++){var c=a[b];if(c.graphics3DSymbolLayer===h.calloutSymbolLayer)return c}}):!0:!1};c.prototype.createCalloutGraphic=function(a,b){return this.calloutSymbolLayer.createGraphics3DGraphic(a,{renderer:b.renderer,symbol:b.symbol,needsOffsetAdjustment:b.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null})};return c}(a)})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require",
"exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});var c=f.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");r.make=function(b,h){if(!a.isCalloutSupport(b))return c.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+b.type+"' does not support callouts"),null;if(!b.callout)return null;var f=t[b.callout.type];return f?new f(b,
h):(c.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+b.callout.type),null)};var t={line:b}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./ElevationAligners ../../../../core/screenUtils ../../../../Color ../../../../geometry/Polygon ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Util ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u){var C=z.VertexAttrConstants;B=function(a){function r(b,c){b=a.call(this,b,null,c,!0)||this;b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return b}f(r,a);r.prototype.destroy=function(){a.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(q.ModelContentType.MATERIAL,this._material.getId()),this._material=null)};r.prototype._prepareResources=function(){var a=this._getStageIdHint();
this._createMaterialsAndAddToStage(this._context.stage,a);this.resolve()};r.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};Object.defineProperty(r.prototype,"materialParameters",{get:function(){var a=this.symbolContainer,b=a.callout,c=h.toUnitRGBA(b.color);c[3]*=this._getLayerOpacity();var f=p.pt2px(b.size||0),l=null;if(a.verticalOffset)var l=a.verticalOffset,n=l.minWorldLength,
q=l.maxWorldLength,l={screenLength:p.pt2px(l.screenLength),minWorldLength:n||0,maxWorldLength:null!=q?q:Infinity};b=b.border&&b.border.color?h.toUnitRGBA(b.border.color):null;n="object"===a.symbolLayers.getItemAt(0).type;return{color:c,size:f,verticalOffset:l,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:b,occlusionTest:!n,shaderPolygonOffset:n?0:void 0,depthHUDAlignStart:"label-3d"===
a.type}},enumerable:!0,configurable:!0});r.prototype._createMaterialsAndAddToStage=function(a,b){this._material=new u(this.materialParameters,b+"_lineCallout_common");a.add(q.ModelContentType.MATERIAL,this._material)};r.prototype._defaultElevationInfoNoZ=function(){return A};r.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);if("extent"===a.type)return c.placePointOnPolygon(l.fromExtent(a));if("polyline"===a.type)return c.placePointOnPolyline(a);if("polygon"===a.type)return c.placePointOnPolygon(a);
if("point"===a.type)return a;this._logWarning("unsupported geometry type for point symbol: "+a.type);return null};r.prototype.createGraphics3DGraphic=function(a,b){null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var c=this.getGraphicElevationInfo(a,b.elevationOffset||0),h=b.symbol,f="on-the-ground"===this._elevationInfo.mode&&!h.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type});if("label-3d"!==h.type&&f)return null;h=this._getGeometry(a);
return null===h?null:this._createAs3DShape(a,h,c,b,"graphic"+a.uid,a.uid)};r.prototype.layerPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return this.layerElevationInfoChanged(b,c)}return!1};r.prototype.layerOpacityChanged=function(a,b){this._material.setParameterValues(this.materialParameters);return!0};r.prototype.layerElevationInfoChanged=function(a,b){var c=this._elevationInfo.mode;this._updateElevationInfo();var h=this._elevationInfo.mode;
if(c!==h&&("on-the-ground"===c||"on-the-ground"===h))return!1;for(var f in a)c=a[f],(h=b(c))&&this.updateGraphicElevationInfo(c.graphic,h);return!0};r.prototype.getGraphicElevationInfo=function(b,c){void 0===c&&(c=0);b=a.prototype.getGraphicElevationInfo.call(this,b);b.addOffsetRenderUnits(c);return b};r.prototype.updateGraphicElevationInfo=function(a,b){a=this.getGraphicElevationInfo(a,b.metadata.elevationOffset);b.elevationInfo.set(a);b.needsElevationUpdates=c.needsElevationUpdates2D(a.mode)};r.prototype.createVertexData=
function(a){var b=a.translation;a=a.centerOffset;if(!b&&!a)return E;b=b?{size:3,data:[b[0],b[1],b[2]]}:E[C.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:E[C.AUXPOS1];return c={},c[C.POSITION]=b,c[C.NORMAL]=E[C.NORMAL],c[C.AUXPOS1]=a,c;var c};r.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),h=u.uniqueMaterialIdentifier(c);if(h===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var f=a.materialCollection.getMaterial(h);
f||(f=new u(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(h,f));return{material:f,isUnique:!1}}f=new u(c,b+"_lineCallout_unique");return{material:f,isUnique:!0}};r.prototype._createAs3DShape=function(a,h,f,l,p,q){a=new w(this.createVertexData(l),n,w.DefaultOffsets,"point");a=[new y(a,p)];var u=this.getOrCreateMaterial(l,p);p=c.createStageObjectForPoint.call(this,h,a,[[u.material]],null,null,f,p,this._context.layer.uid,q,!0);if(null===p)return null;q=new b(this,p.object,a,u.isUnique?
[u.material]:null,null,t.perObjectElevationAligner,f);q.metadata={elevationOffset:l.elevationOffset||0};q.alignedTerrainElevation=p.terrainElevation;q.needsElevationUpdates=c.needsElevationUpdates2D(f.mode);c.extendPointGraphicElevationInfo(q,h,this._context.elevationProvider);return q};return r}(a);var E=(G={},G[C.POSITION]={size:3,data:[0,0,0]},G[C.NORMAL]={size:3,data:[0,0,1]},G[C.AUXPOS1]={size:4,data:[0,0,0,1]},G),G=new Uint32Array([0]),n=(x={},x[C.POSITION]=G,x[C.NORMAL]=G,x[C.AUXPOS1]=G,x),
A={mode:"relative-to-ground",offset:0},G,x;return B})},"esri/views/3d/layers/graphics/Graphics3DOwner":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});B=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=this.streamDataSupplier=
this.sharedResources=null;this.screenSizePerspectiveEnabled=!0}}();r.Graphics3DSymbolCreationContext=B})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/Deferred dojo/_base/lang ../../../../core/Scheduler ../../../../geometry/Multipoint".split(" "),function(B,r,f,a,b,c,t,p){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function h(a,b,h){this.spatialReference=
a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=c.mixin({},h,{ignoreInvisibleLayers:!0})}h.prototype.queryElevation=function(c,h){return a(this,void 0,void 0,function(){var a;return f(this,function(f){a=new b;this._queries.push({x:c,y:h,result:a});this._scheduleDoQuery();return[2,a.promise]})})};h.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(t.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};h.prototype._doQuery=
function(){return a(this,void 0,void 0,function(){var a,b,c,h,t,u,r;return f(this,function(f){switch(f.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];b=a.map(function(a){return[a.x,a.y]});c=new p({points:b,spatialReference:this.spatialReference});h=this._getElevationQueryProvider();if(!h)return a.forEach(function(a,b){return a.result.reject()}),[2];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,h.queryElevation(c,this._queryOptions)];case 2:return t=f.sent(),[3,4];case 3:return u=
f.sent(),a.forEach(function(a){return a.result.reject(u)}),[2];case 4:return r=t.geometry.points,a.forEach(function(a,b){return a.result.resolve(r[b][2])}),[2]}})})};return h}();r.ElevationQuery=B})},"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports dojo/Deferred ../../../../processors/SpatialIndex ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils".split(" "),function(B,r,f,a,b,c){return function(){function t(){var b=this;this.spatialIndex=
new a;this.spatialIndexNumPendingQueries=this.spatialIndexNumGraphics=0;this.graphicsCore=this.viewSR=this.layer=this.layerView=null;this._readyDfd=new f;var c=function(a){return a.workerClient&&a.workerClient.worker};if(c(this.spatialIndex))this._readyDfd.resolve();else this.spatialIndex.on("start",function(){c(b.spatialIndex)&&b._readyDfd.resolve()})}t.prototype.initialize=function(a,b,c,f){this.layerView=a;this.layer=b;this.viewSR=c;this.graphicsCore=f};t.prototype.destroy=function(){this.spatialIndex&&
(this.spatialIndex.destroy(),this.spatialIndex=null);this.graphicsCore=this.layerView=this.viewSR=null};t.prototype.numNodesUpdating=function(){return 0};t.prototype.isUpdating=function(){return 0<this.spatialIndexNumPendingQueries};t.prototype.hasGraphics=function(){return 0<this.spatialIndexNumGraphics};t.prototype.intersects=function(a,b,c){var h=this;this.hasGraphics()&&(this.spatialIndexNumPendingQueries++,this.spatialIndex.intersects(a,void 0,void 0,!0).then(function(a){h.spatialIndexNumPendingQueries--;
c(a.results,a.results.length);h.layerView._evaluateUpdatingState()}))};t.prototype.shouldAddToSpatialIndex=function(a,b,c){return c||b.needsElevationUpdates()};t.prototype.addGraphicsToSpatialIndex=function(a){if(this.layerView.loadedGraphics)for(var b=this.layerView.loadedGraphics.toArray(),c=b.length,f=0;f<c;f++){var p=b[f],t=this.graphicsCore.getGraphics3DGraphicById(p.uid);t&&!t.addedToSpatialIndex&&this.shouldAddToSpatialIndex(p,t,a)&&this.addGraphicToSpatialIndex(p,t)}};t.prototype.addGraphicToSpatialIndex=
function(a,h){var f=a.geometry.spatialReference,p=this.viewSR,t={id:a.uid,geometry:null};if(f.equals(p))t.geometry=a.geometry.toJSON();else{var r=void 0;if(f.wkid===b.WGS84.wkid&&p.isWebMercator)r=c.geographicToWebMercator(a.geometry);else if(f.isWebMercator&&p.wkid===b.WGS84.wkid)r=c.webMercatorToGeographic(a.geometry);else return console.warn("Cannot convert graphic geometry to map spatial reference, elevation and scale updates are disabled"),!1;t.geometry=r.toJSON()}this.spatialIndexNumGraphics++;
this.spatialIndex.runProcess([t],this.layer.id);return h.addedToSpatialIndex=!0};t.prototype.whenLoaded=function(){return this._readyDfd.promise};return t}()})},"esri/processors/SpatialIndex":function(){define("../core/declare dojo/Deferred dojo/_base/lang ./Processor ../workers/WorkerClient ../layers/FeatureLayer".split(" "),function(B,r,f,a,b,c){return B([a],{declaredClass:"esri.processors.SpatialIndex",index:null,indexType:"rtree",autostart:!1,constructor:function(a){a=a||{};var c=!1!==a.autostart;
f.mixin(this,a);this.workerCallback=["./scripts/helpers","./scripts/indexInterface","./indexWorker"];if(!this.fetchWithWorker){var h=this;this.workerClient=new b("./mutableWorker",function(a){this.workerClient=a;this.workerCallback.push("./libs/"+this.indexType);this.workerClient.importScripts(this.workerCallback).then(function(){h._attachedSystem=!0;c&&h.start()})}.bind(this))}this._featCache={}},destroy:function(){this.workerClient&&this.workerClient.terminate()},addLayer:function(a,b){if(a.graphics&&
a.graphics.length||b||a.isInstanceOf(c)){var h=this.workerClient;if(!this._attachedSystem&&h.worker){var f=this;this.inherited(arguments,[a,!0]);h.importScripts("./libs/"+this.indexType).then(function(){f.runProcess(a.graphics,a.id);f._attachedSystem=!0})}else this.inherited(arguments,[a])}},unsetMap:function(){this.stop();this.workerClient.terminate();this.fetchWithWorker||(this.workerClient=new b(this.workerCallback,function(){}));this.inherited(arguments);this.start()},removeLayer:function(a){this.inherited(arguments)},
runProcess:function(a,b){if(a&&a.length){var c=this,f=this.workerClient,p=a[0]._graphicsLayer;b||0===b||(b=p?p.id:"rawFeatures_"+Object.keys(this._featCache).length);this._featCache[b]||(this._featCache[b]={});for(var t,r,w=[],u=a.length,C=p&&p.objectIdField;u--;)r=a[u],t=r.attributes&&C?r.attributes[C]:r.id,null!=t&&this._featCache[b][t]||(this._featCache[b][t]=1,r.declaredClass?w.push({id:t,geometry:r.geometry.toJSON(!0),attributes:r.attributes}):w.push(r));0!==w.length&&(f.postMessage({insert:w,
system:this.indexType,options:this.indexOptions,idField:p&&p.objectIdField,layerId:b}).then(function(a){p&&p.emit("process-end",{processor:c,results:{insert:a.insert}})}),p&&p.emit("process-start",{processor:this}))}},_sendFeaturesFromLayer:function(a,b){b=b.graphic;var c=this.workerClient,f=this,p=b.attributes[a.objectIdField];this._featCache[a.id]||(this._featCache[a.id]={});this._featCache[a.id][p]||(this._featCache[a.id][p]=1,c.postMessage({insert:[{attributes:b.attributes,geometry:b.geometry.toJSON(!0)}],
system:this.indexType,options:this.indexOptions,idField:a.objectIdField,layerId:a.id}).then(function(b){a.emit("process-end",{processor:f,results:{insert:b.insert}})}),a.emit("process-start",{processor:f}))},_notifyProcessStart:function(a,b){},_sendFeaturesFromTask:function(a,b){b=b.featureSet.features;var c=[],f=this.workerClient,p=this,r=b.length,t,w;for(this._featCache[a.id]||(this._featCache[a.id]={});r--;)w=b[r],t=w.attributes[a.objectIdField],this._featCache[a.id][t]||(this._featCache[a.id][t]=
1,c.push(w));f.postMessage({insert:c,system:this.indexType,options:this.indexOptions,idField:a.objectIdField,layerId:a.id}).then(function(b){a.emit("process-end",{processor:p,results:{insert:b.insert}})});a.emit("process-start",{processor:p})},get:function(){},intersects:function(a,b,c,f){return"rtree"!=this.indexType?(console.error("Index.intersects only works with rtree indexes"),a=new r,a.reject({message:"Index.intersects only works with rtree indexes"}),a.promise):this.workerClient.postMessage({search:a,
layerId:b,returnNode:c,onlyIds:f})},within:function(a,b,c){if("rtree"!=this.indexType)return console.error("Index.within only works with rtree indexes"),a=new r,a.reject({message:"Index.within only works with rtree indexes"}),a.promise},nearest:function(a){return"kdtree"!=this.indexType?(console.error("Index.nearest only works with kdtree indexes"),a=new r,a.reject({message:"Index.nearest only works with kdtree indexes"}),a.promise):this.workerClient.postMessage({search:a})}})})},"esri/processors/Processor":function(){define("../core/sniff ../core/declare dojo/_base/lang dojo/_base/array dojo/Evented ../workers/RequestClient ../layers/GraphicsLayer".split(" "),
function(B,r,f,a,b,c,t){return r([b],{declaredClass:"esri.processors.Processor",layers:null,results:null,passFeatures:!0,drawFeatures:!0,requireWorkerSupport:!0,fetchWithWorker:!1,workerCallback:null,workerClient:null,_started:null,_handlers:null,constructor:function(a){a=a||{};f.mixin(this,a);B("esri-workers")||!1===this.requireWorkerSupport&&!1===a.requireWorkerSupport?(this._handlers={},this._notifyProcessStart=f.hitch(this,this._notifyProcessStart),this._sendFeaturesFromTask=f.hitch(this,this._sendFeaturesFromTask),
this._sendFeaturesFromLayer=f.hitch(this,this._sendFeaturesFromLayer),!1!==a.autostart&&this.start()):(console.log("Browser doesn't support workers \x26 worker support is required for this processor"),this.addLayer=this.setMap=this.start=this.runProcess=function(){},this._disabled=!0)},addLayer:function(a,b){var h=a._task,p=this._handlers[a.id]=[],r="complete";!1===this.drawFeatures&&(a._params.drawMode=!1);this.fetchWithWorker?(this.workerClient||(this.workerClient=c.getClient(this.workerCallback)),
h.requestOptions={workerOptions:{worker:this.workerClient}},this.passFeatures&&p.push(h.on(r,f.partial(this._notifyProcessStart,a)))):this.passFeatures?(r=this.drawFeatures?"graphic-draw":"graphic-add",p.push(a.on(r,f.partial(this._sendFeaturesFromLayer,a)))):p.push(h.on(r,f.partial(this._sendFeaturesFromTask,a)));!0!==b&&a.graphics&&this.runProcess(a.graphics,a.id)},removeLayer:function(b){a.forEach(this._handlers[b.id],function(a){a.remove()});delete this._handlers[b.id]},setMap:function(b){if(this.map)if(b!=
this.map)this.unsetMap();else return;var c=this;a.forEach(this.layers,c.removeLayer);a.forEach(b.graphicsLayerIds,function(a){c.addLayer(b.findLayerById(a))});this._handlers.map=[b.on("layer-add",function(a){a=a.layer;a.isInstanceOf(t)&&c.addLayer(a)}),b.on("layer-remove",function(a){a=a.layer;a.isInstanceOf(t)&&c.removeLayer(a)})];this.map=b},unsetMap:function(){this.map&&(a.forEach(this._handlers.map,function(a){a.remove()}),delete this._handlers.map,a.forEach(this.layers,this.removeLayer),this.map=
null)},start:function(){this.map?this.setMap(this.map):this.layers&&(f.isArray(this.layers)||(this.layers=[this.layers]),a.forEach(this.layers,this.addLayer));this._started=!0;this.emit("start",{processor:this});console.log("processor started")},stop:function(){this._started=!1;for(var a in this._handlers)this._handlers.hasOwnProperty(a)&&(this._handlers[a].remove(),delete this._handlers[a]);this.emit("stop",{processor:this});console.log("processor stopped")},runProcess:function(a,b){},_sendFeaturesFromTask:function(){},
_sendFeaturesFromLayer:function(){},_notifyProcessStart:function(){}})})},"esri/workers/RequestClient":function(){define(["../core/declare","dojo/_base/xhr","../config","./WorkerClient"],function(B,r,f,a){function b(a,b){var h=new c;h.addWorkerCallback(a,b);t.unshift({id:b?a+"::"+b:a,client:h});t.length>p&&t.pop().client.terminate();return h}var c=B([a],{declaredClass:"esri.workers.RequestClient",constructor:function(){this.setWorker(["./mutableWorker","./requestWorker"],function(){})},get:function(a){return this._send("GET",
a)},post:function(a){return this._send("POST",a)},_send:function(a,b){b=r._ioSetArgs(b);b.xhr=null;var c=b.ioArgs,h=c.url;delete c.url;delete c.args;this.postMessage({method:a,url:h,options:c}).then(this._getSuccessHandler(b),this._getErrorHandler(b),this._getProgressHandler(b));return b},_addHeaderFunctions:function(a){a.getResponseHeader=function(b){var c,h=a.headers;Object.keys(h).forEach(function(a){if(a.toLowerCase()==b.toLowerCase())return c=h[a],!1});return c};a.getAllResponseHeaders=function(){var b=
[],c=a.headers;Object.keys(c).forEach(function(a){b.push(a+": "+c[a])});return b=b.join("\n")};return a},_getSuccessHandler:function(a){var b=this,c=a.ioArgs;return function(h){a.xhr=b._addHeaderFunctions(h);h=a.xhr.getResponseHeader("content-type");("xml"==c.handleAs||-1<h.indexOf("xml"))&&"string"==typeof a.xhr.response&&(a.xhr.response=(new DOMParser).parseFromString(a.xhr.response,"text/xml"));a.resolve(a.xhr.response,a.xhr)}},_getErrorHandler:function(a){return function(b){a.reject(b)}},_getProgressHandler:function(a){return function(b){a.progress(b)}}}),
t=[],p=f.request.maxWorkers,h=new c;c.getClient=function(a,c){if(a){var f;t.some(function(b){b.id==(c?a+"::"+c:a)&&(f=b.client);return!0});return f||b(a,c)}return h};c.setLimit=function(a){p=f.request.maxWorkers=a};return c})},"esri/workers/WorkerClient":function(){define("dojo/Evented ../core/declare dojo/Deferred dojo/_base/lang dojo/request ../core/sniff ../core/urlUtils require".split(" "),function(B,r,f,a,b,c,t,p){var h=window.Blob||window.webkitBlob||window.mozBlob,l=window.URL||window.webkitURL||
window.mozURL;return r([B],{declaredClass:"esri.workers.WorkerClient",worker:null,_queue:null,constructor:function(b,h){this._isIE=c("ie");this._queue={};this._acceptMessage=a.hitch(this,this._acceptMessage);this._errorMessage=a.hitch(this,this._errorMessage);b&&this.setWorker(b,function(a){this.worker=a;h(this)}.bind(this))},setWorker:function(a,b){if(a instanceof Array){var c=a;a=c.shift()}var f=this._getUrl(a),f=t.normalize(f);a=!t.hasSameOrigin(f,location.href);var p;if(!1===f)return console.log("Can not resolve worker path"),
!1;this.worker&&(p=this.worker,p.removeEventListener("message",this._acceptMessage,!1),p.removeEventListener("error",this._errorMessage,!1),p.terminate(),p=null);if(a){a=this._getUrl("./mutableWorker",!0);try{this._getRemoteText(a,function(a){a=l.createObjectURL(new h([a],{type:"text/javascript"}));b(this._createWorker(a,f))}.bind(this))}catch(C){try{a=t.getProxyUrl(a).path+"?"+encodeURI(a),this._useProxy=!0,b(this._createWorker(a,c))}catch(E){return console.log("Can not create worker"),!1}}}else b(this._createWorker(f,
c))},_createWorker:function(a,b){a=new Worker(a);a.addEventListener("message",this._acceptMessage,!1);a.addEventListener("error",this._errorMessage,!1);this.worker=a;b&&this.importScripts(b);return a},postMessage:function(a,b){if(a instanceof Array||"object"!=typeof a)a={data:a};var c=Math.floor(64E9*Math.random()).toString(36);a.msgId=c;c=this._queue[c]=new f;this.worker?(b?this.worker.postMessage(a,b):this.worker.postMessage(a),this.emit("start-message",{target:this,message:a})):c.reject({message:"No worker was set."});
return c.promise},terminate:function(){var a=Object.keys(this._queue);this.worker&&this.worker.terminate();for(var b=a.length-1;0<=b;b--)this._queue[a[b]].cancel("terminated"),delete this._queue[a[b]]},addWorkerCallback:function(b,c){var h=this._getUrl(b,!0);return!1===h?(c=new f,c.reject({message:"Could not load text from "+b}),c.promise):this.postMessage({action:"add-callback",url:h,cbName:c||"main"}).then(a.hitch(this,function(a){a.target=this;this.emit("callback-added",a)}))},importScripts:function(b){Array.isArray(b)||
(b=[b]);b=b.map(function(a){a=this._getUrl(a,!0);this._useProxy&&!t.hasSameOrigin(a,location.href)&&(a=t.getProxyUrl(a).path+"?"+encodeURI(a));return a},this);return this.postMessage({action:"import-script",url:b}).then(a.hitch(this,function(a){a.target=this;this.emit("scripts-imported",a)}))},_acceptMessage:function(a){var b=a.data,c=b.msgId;if(b.status&&"debug"==b.status)console[b.showAs||"debug"](b);else if(c&&c in this._queue){var h=this._queue[c];"progress"==b.status?h.progress(a.data):("error"==
b.status?h.reject(a.data):h.resolve(a.data),delete this._queue[c])}this.emit("message",{message:a.data,event:a,target:this})},_errorMessage:function(a){this.onerror||this.onError?this.onerror?this.onerror(a):this.onError(a):console.log("Worker Error: "+a.message+"\nIn "+a.filename+" on "+a.lineno)},_getUrl:function(a,b){if(!a)return console.error("can not resolve empty path"),!1;a.match(/\.js$/)||(a+=".js");a=p.toUrl(a);return b?t.makeAbsolute(a):a},_getRemoteText:function(a,c){(a=this._getUrl(a))&&
b.get(a,{sync:!1,handleAs:"text",headers:{"X-Requested-With":"","Content-Type":"text/plain"}}).then(function(a){c(a)})},_startBlobWorker:function(){var a=this._xdSource;a||(a=this._getUrl("./mutableWorker"),a=new h(["if(!self._mutable){importScripts('"+a+"');}"],{type:"text/javascript"}),a=this._xdSource=l.createObjectURL(a));try{return new Worker(a)}catch(y){return console.log(y.message),!1}}})})},"esri/layers/GraphicsLayer":function(){define("../core/Accessor ../core/Collection ../core/promiseUtils ./Layer ./mixins/ScaleRangeLayer ../Graphic dojo/_base/lang".split(" "),
function(B,r,f,a,b,c,t){var p=B.createSubclass({properties:{layer:null,layerView:null,graphics:null}});return a.createSubclass([b],{declaredClass:"esri.layers.GraphicsLayer",viewModulePaths:{"2d":"../views/2d/layers/GraphicsLayerView2D","3d":"../views/3d/layers/FeatureLayerView3D"},getDefaults:function(a){return t.mixin(this.inherited(arguments),{graphics:[]})},destroy:function(){this.removeAll()},_gfxHdl:null,properties:{elevationInfo:null,graphics:{type:r.ofType(c),set:function(a){var b=this._get("graphics");
b||(a.forEach(function(a){a.layer=this},this),this._gfxHdl=a.on("change",function(a){var b,c,h;h=a.added;for(b=0;c=h[b];b++)c.layer=this;h=a.removed;for(b=0;c=h[b];b++)c.layer=null}.bind(this)),this._set("graphics",a),b=a);b.removeAll();b.addMany(a)}},screenSizePerspectiveEnabled:!0,type:{readOnly:!0,value:"graphics"}},add:function(a){this.graphics.add(a);return this},addMany:function(a){this.graphics.addMany(a);return this},removeAll:function(){this.graphics.removeAll();return this},createGraphicsController:function(a){return f.resolve(new p({layer:this,
layerView:a.layerView,graphics:this.graphics}))},remove:function(a){this.graphics.remove(a)},removeMany:function(a){this.graphics.removeMany(a)},graphicChanged:function(a){this.emit("graphic-update",a)}})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define(["require","exports"],function(B,r){return function(){function f(){this.elevationDirtyGraphicsQueue=[];this.elevationDirtyGraphicsSet={};this.elevationUpdateEventHandle=null;this.eventHandles=[];this.updateElevation=
!1;this.graphicsCore=this.layerView=null}f.prototype.initialize=function(a,b,c,f){var p=this;this.layerView=a;this.graphicsCore=c;this.elevationProvider=f;this.getGraphicsInExtent=b;this.elevationUpdateEventHandle=f.on("elevation-change",function(a){return p.elevationUpdateHandler(a)});this.eventHandles.push(this.layerView.watch("suspended",function(){return p.suspendedChange()}))};f.prototype.destroy=function(){this.elevationDirtyGraphicsSet=this.elevationDirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&
(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.getGraphicsInExtent=this.graphicsCore=this.layerView=this.eventHandles=null};f.prototype.clear=function(){this.elevationDirtyGraphicsSet={};this.elevationDirtyGraphicsQueue=[]};f.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()};
f.prototype.isUpdating=function(){return 0<this.elevationDirtyGraphicsQueue.length};f.prototype.numNodesUpdating=function(){return this.elevationDirtyGraphicsQueue.length};f.prototype.needsIdleUpdate=function(){return this.elevationProvider&&0<this.elevationDirtyGraphicsQueue.length};f.prototype.idleUpdate=function(a){if(!a.done()){var b=this.layerView.view,c=this.elevationDirtyGraphicsQueue.length;if(0<c){for(var f=this.graphicsCore.stageLayer.getId(),p=this.graphicsCore.labelStageLayer?this.graphicsCore.labelStageLayer.getId():
null,h=0,l=0,l=0;l<c;l++){var q=this.elevationDirtyGraphicsQueue[l],r=this.graphicsCore.graphics[q];r&&r.alignWithElevation(this.elevationProvider,b.renderCoordsHelper);delete this.elevationDirtyGraphicsSet[q];h++;if(20<=h){b._stage.processDirtyLayer(f);null!=p&&b._stage.processDirtyLayer(p);if(a.done())break;h=0}}b._stage.processDirtyLayer(f);null!=p&&b._stage.processDirtyLayer(p);this.elevationDirtyGraphicsQueue.splice(0,l+1);b.deconflictor.setDirty();this.layerView._evaluateUpdatingState()}}};
f.prototype.markAllGraphicsElevationDirty=function(){for(var a in this.graphicsCore.graphics)this.markGraphicElevationDirty(this.graphicsCore.graphics[a].graphic.uid);this.layerView._evaluateUpdatingState()};f.prototype.markGraphicElevationDirty=function(a){this.elevationDirtyGraphicsSet[a]||(this.elevationDirtyGraphicsSet[a]=!0,this.elevationDirtyGraphicsQueue.push(a))};f.prototype.elevationUpdateHandler=function(a){var b=this,c=a.extent;this.layerView.suspended?this.updateElevation||(a=this.graphicsCore.computedExtent)&&
c[2]>a.xmin&&c[0]<a.xmax&&c[3]>a.ymin&&c[1]<a.ymax&&(this.updateElevation=!0):-Infinity===c[0]?this.markAllGraphicsElevationDirty():this.getGraphicsInExtent(c,a.spatialReference,function(a,c){for(var h=!1,f=0;f<c;f++){var p=a[f],r=b.graphicsCore.graphics[p];r&&r.needsElevationUpdates()&&(b.markGraphicElevationDirty(p),h=!0)}h&&b.layerView._evaluateUpdatingState()})};return f}()})},"esri/views/3d/navigation/spherical/NavigationSpherical":function(){define("../Navigation ./ConstraintsSpherical ./AnimationSpherical ./actions/PanSpherical ./actions/ZoomSpherical ./actions/RotateSpherical ../../webgl-engine/lib/Camera ../../support/earthUtils ../../lib/glMatrix".split(" "),
function(B,r,f,a,b,c,t,p,h){var l=h.vec3d,q=h.mat4d,y=l.create(),z=l.create(),w=q.create();return B.createSubclass([r,f],{declaredClass:"esri.views.3d.navigation.spherical.NavigationSpherical",initialize:function(){this.pan=new a({navigation:this});this.zoom=new b({navigation:this});this.rotate=new c({navigation:this});this._intersectTerrainSelector.enableBackfacesTerrain=!1},getInitialCamera:function(){return new t(l.createFrom(4*p.earthRadius,0,0),l.createFrom(p.earthRadius,0,0),l.createFrom(0,
0,1))},fixTargetUpVector:function(){this.cameras.target.computeUpOnSphere()},setPoiAuto:function(a,b){a=this.picker.pickAlongRay(this.cameras.target.eye,this.cameras.target.center,null,a);this.picker.pickedIntersectionPoint(a,y)&&(this.setCameraFromEyeAndCenter(this.cameras.target.eye,y,{animate:!1}),l.set(this.cameras.target.center,this.cameras.current.center),b&&this.setCurrentToTarget())},rotateCameraWithPointsOnSphere:function(a,b,c,h,f){var n;null==f&&(f=l.length(a));n=Math.abs(l.length(b)-f);
1E-4<=n&&(console.error("[NavigationSpherical.rotateCameraWithPointsOnSphere: invalid radius for target point (got "+f+", but expected "+l.length(b)+")"),f=l.length(b));n=Math.abs(l.length(a)-f);1E-4<=n&&(console.error("[NavigationSpherical.rotateCameraWithPointsOnSphere]: invalid radius for source point (got "+f+", but expected "+l.length(a)+", "+a+")"),f=l.length(a));a=this.rotationFromPointsOnSphere(a,b,f,z);q.identity(w);q.rotate(w,a,z);q.multiplyVec3(w,c.eye,h.eye);q.multiplyVec3(w,c.center,
h.center);q.multiplyVec3(w,c.up,h.up)},rotationFromPointsOnSphere:function(a,b,c,h){l.cross(a,b,h);return-Math.acos(1-l.dist2(a,b)/(2*c*c))}})})},"esri/views/3d/navigation/Navigation":function(){define(["../../../core/Accessor","../../../core/Evented","../../../core/watchUtils","./Picker","./mixins/CamerasMixin"],function(B,r,f,a,b){return B.createSubclass([b,r],{properties:{interacting:{get:function(){return this._interacting},readOnly:!0},renderCoordsHelper:{},renderUnitInMeters:{dependsOn:["renderCoordsHelper"],
get:function(){return this.renderCoordsHelper?this.renderCoordsHelper.unitInMeters:1}},picker:{},constraints:{},pan:{},zoom:{},rotate:{},view:{}},initialize:function(){this._mapCoordsHelperHandle=f.init(this.view,"mapCoordsHelper",function(a){this.mapCoordsHelper=a}.bind(this));this._renderCoordsHelperHandle=f.init(this.view,"renderCoordsHelper",this.updateRenderCoordsHelper.bind(this));this.picker=new a(this,this.view);this._interacting=!1},destroy:function(){this._mapCoordsHelperHandle.remove();
this._renderCoordsHelperHandle.remove()},updateRenderCoordsHelper:function(a){this.renderCoordsHelper=a;this.inherited(arguments)},begin:function(a){this.pan&&this.pan.continuous&&this.pan.continuous.stop();this.pan&&this.pan.momentum&&(this.pan.momentum=null);this._interacting=!0;this.notifyChange("interacting")},end:function(a){this._interacting=!1;this.notifyChange("interacting")}})})},"esri/views/3d/navigation/Picker":function(){define(["../../../core/declare","../lib/glMatrix","../webgl-engine/lib/Selector"],
function(B,r,f){var a=r.vec3d,b=a.create(),c=a.create();return B([],{constructor:function(a,b){this.navigation=a;this.pickAlongRay=b._pickRay.bind(b);this.createPickRay=b._pickRayWithBeginPoint.bind(b);this.renderCoordsHelper=b.renderCoordsHelper;this.selector=new f(b.viewingMode)},pickPointInScreen:function(a,b){return this.pickedIntersectionPoint(this.pickInScreen(a,!1),b)},pickFreePointInScreen:function(f,p){this.createPickRay(f,void 0,this.navigation.currentCamera.viewMatrix,b,c);p||(p=a.create());
a.subtract(c,b);a.normalize(c);var h=this.navigation.view.dataExtent;f=Math.max(h.xmax-h.xmin,h.ymax-h.ymin,8*Math.max(h.xmax-h.xmin,h.ymax-h.ymin));var l=this.navigation.currentCamera,q=Math.max(0,h.xmin-l.eye[0],l.eye[0]-h.xmax),h=Math.max(0,h.ymin-l.eye[1],l.eye[1]-h.ymax),q=Math.sqrt(q*q+h*h),h=this.renderCoordsHelper.getAltitude(l.eye),l=this.navigation._getTerrainElevationBelowCamera(l),l=f/Math.max(1,Math.pow(Math.max(0,Math.log(f/(Math.abs(h-l)+Number.MIN_VALUE))),2)),l=Math.max(l,Math.min(q,
f));a.scale(c,l);a.add(b,c,p)},pickInScreen:function(f,p){this.createPickRay(f,void 0,this.navigation.currentCamera.viewMatrix,b,c);p&&a.set(this.navigation.currentCamera.eye,b);return this.pickAlongRay(b,c,f,f,null,null,this.selector)},pickedIntersectionPoint:function(b,c){if(!b)return!1;c||(c=a.create());return b.getMinResult().getIntersectionPoint(c)}})})},"esri/views/3d/navigation/mixins/CamerasMixin":function(){define("../../../../core/Accessor ../../../../core/Evented ../../webgl-engine/lib/Camera ../../support/mathUtils ../../lib/glMatrix dojo/on".split(" "),
function(B,r,f,a,b,c){var t=b.vec4d.create();return B.createSubclass([r],{declaredClass:"esri.views.3d.navigation.mixins.CamerasMixin",properties:{targetCamera:{get:function(){return this.cameras.target}},currentCamera:{get:function(){return this.cameras.current}},windowSize:{set:function(a){var b=a[0],c=a[1],f=!1,p=this.cameras.target.x-this.cameras.target.padding[3],r=this.cameras.target.y-this.cameras.target.padding[2];if(this.cameras.target.width+p!==b||this.cameras.target.height+r!==c)this.cameras.target.width=
b-p,this.cameras.target.height=c-r,this.targetChanged(),f=!0;p=this.cameras.current.x-this.cameras.current.padding[3];r=this.cameras.current.y-this.cameras.current.padding[2];if(this.cameras.current.width+p!==b||this.cameras.current.height+r!==c)this.cameras.current.width=b-p,this.cameras.current.height=c-r,this.currentChanged(),f=!0;f&&this.currentHasReachedTarget()&&this.currentReachedTarget();this._set("windowSize",a)}},padding:{set:function(b){var c=!1,f=!1;t[0]=b.top;t[1]=b.right;t[2]=b.bottom;
t[3]=b.left;a.vectorEquals(this.cameras.current.padding,t)||(this.cameras.current.padding=t,f=!0);a.vectorEquals(this.cameras.target.padding,t)||(this.cameras.target.padding=t,c=!0);c&&this.targetChanged();f&&this.currentChanged();this.currentHasReachedTarget()&&(c||f)&&this.currentReachedTarget()}}},initialize:function(){var a=this.getInitialCamera();this.cameras={current:a,target:a.copy()}},currentHasReachedTarget:function(){return this.cameras.current.equals(this.cameras.target)},currentHasAlmostReachedTarget:function(){return this.cameras.current.almostEquals(this.cameras.target,
5E-4/this.renderUnitInMeters)},setCamera:function(a,b){this.pan&&this.pan.continuous&&this.pan.continuous.stop();this.pan&&this.pan.momentum&&(this.pan.momentum=null);this.cameras.target.copyFrom(a);var c=!(b&&b.internalUpdate)||!this._targetCameraChangedByElevationUpdate;c&&this._targetCameraBeforeElevationUpdate.copyFrom(a);this._targetCameraAnimated.copyFrom(this.cameras.target);this.applyConstraints(this._targetCameraAnimated,!0);a=!1;this.constrainTargetEyeByElevation()&&(a=!0);this.applyConstraints(this.cameras.target,
!0)&&(a=!0);this.fixTargetUpVector();this.currentHasReachedTarget()?(this.targetChanged(),a&&c&&(this._targetCameraChangedByElevationUpdate=!0),this.currentReachedTarget()):(void 0===b||void 0===b.animate||b.animate?this.targetAnimatedChanged(!1,b,!0):(this.targetAndCurrentChanged(!0),a=!0),a&&c&&(this._targetCameraChangedByElevationUpdate=!0),this._autoUpdateTiltConstraint())},getTargetCamera:function(){console.warn("[Navigation.getTargetCamera()] deprecated; use .targetCamera instead");return this.targetCamera},
getCurrentCamera:function(){console.warn("[Navigation.getCurrentCamera()] deprecated; use .currentCamera instead");return this.currentCamera},_cameraFromEyeCenterUp:function(a,b,c){var h=this.cameras.target.copy();h.eye=a;h.center=b;h.up=c;return h},setCameraFromEyeAndCenter:function(a,b,c){this.setCamera(this._cameraFromEyeCenterUp(a,b,this.cameras.target.up),c)},setCameraFromEyeCenterAndUp:function(a,b,c,f){this.setCamera(this._cameraFromEyeCenterUp(a,b,c),f)},_cameraEvents:{},_prepareCameraEvent:function(a,
b){var c=this._cameraEvents[a];c||(c={camera:new f},this._cameraEvents[a]=c);c.camera.copyFrom(b);return c},emitWithCamera:function(a,b){c.emit(this,a,this._prepareCameraEvent(a,b))},targetChanged:function(a){this.inherited(arguments);this.cameras.target.markViewDirty();var b=this._prepareCameraEvent("targetViewChanged",this.cameras.target);b.interruptedAnimation=!!a;b.finishedAnimation=!1;c.emit(this,"targetViewChanged",b)},targetAnimatedChanged:function(a,b,c){this.targetChanged(a);this.startAnimation(b,
c)},targetAndCurrentChanged:function(a){this.targetChanged(a);this.setCurrentToTarget(!1,a)},currentChanged:function(){this.inherited(arguments);this.cameras.current.markViewDirty();this.emitWithCamera("currentViewChanged",this.cameras.current)},currentReachedTarget:function(a,b){this.inherited(arguments);this.currentChanged();if(!(this.pan&&this.pan.continuous&&this.pan.continuous.active)){var h=this._prepareCameraEvent("currentViewReachedTarget",this.cameras.current);h.finishedAnimation=!!a;h.interruptedAnimation=
!!b;c.emit(this,"currentViewReachedTarget",h)}},setCurrentToTarget:function(a,b){this.cameras.current.copyFrom(this.cameras.target);this.currentReachedTarget(a,b)}})})},"esri/views/3d/navigation/spherical/ConstraintsSpherical":function(){define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../lib/glMatrix ../../webgl-engine/lib/Util ../../constraints/SceneViewAltitudeConstraint ../../constraints/SceneViewTiltConstraint".split(" "),function(B,r,f,a,b,c,t){var p=a.vec3d,
h=p.create(),l=p.create(),q=p.create();return B.createSubclass({declaredClass:"esri.views.3d.navigation.spherical.ConstraintsSpherical",defaultConstraints:{tilt:new B.Tilt({min:function(){return r.deg2rad(t.MAX_DEFAULT)},max:r.makePiecewiseLinearFunction([[4E3,r.deg2rad(t.MIN_DEFAULT)],[5E4,r.deg2rad(88)],[6E6,r.deg2rad(88)],[2E7,r.deg2rad(t.MAX_DEFAULT)]])}),altitude:new B.Altitude({min:function(){return c.MIN_DEFAULT},max:function(){return c.MAX_DEFAULT}}),collision:new B.Collision},initialize:function(){this.captainNemoAltitudeThreshold=
2E4;this.captainNemoElevationThreshold=-500},limitAltitude:function(a,c,r){p.scale(r,a/p.length(r),h);var u=p.subtract(c,h,h),t=this.renderCoordsHelper.getAltitude(u),w=this.constraints.altitude.apply(this,t);return 1E-6<Math.abs(t-w)&&(u=t<w?c:u,r=t<w?p.scale(r,-1,q):r,b.raySphere(u,r,null,w+f.earthRadius,l))?p.dist(c,l):a},tiltConstraintsFromAltitudeConstraints:function(a,b){var c=this.constraints.altitude.min(),h=this.constraints.altitude.max();a=p.length2(a);var l=Math.sqrt(a),c=c+f.earthRadius,
h=h+f.earthRadius,h=(h*h-b*b-a)/(2*l*b);b=Math.acos(r.clamp((c*c-b*b-a)/(2*l*b),-1,1));return{min:Math.acos(r.clamp(h,-1,1)),max:b}},distanceToSilhouette:function(a,b,c,h,l){l||(l={maxFarNearRatio:0,distance:0});a=p.dot(a.eye,a.eye);b=f.earthRadius*f.earthRadius;l.maxFarNearRatio=this.maxFarNearRatio;this.isNemoMode(a,h)?(h=f.earthRadius+h,l.distance=Math.sqrt(a-h*h)):a>b?(l.maxFarNearRatio=r.clamp(2E4-(Math.log(Math.sqrt(a)-f.earthRadius)-7.983)/9.011*19E3,1E3,2E4),l.distance=Math.sqrt(a-b)):l.distance=
this.maxFarNearRatio*this.minNearDistance;l.distance*=1.2;return l},isNemoMode:function(a,b){var c=f.earthRadius+this.captainNemoAltitudeThreshold;return a<c*c&&b<this.captainNemoElevationThreshold},getFallbackCenterAlongViewDirection:function(a,b,c){var h=p.dot(a,a),l=f.earthRadius*f.earthRadius,h=h>l?Math.sqrt(h-l)/3:1;p.subtract(b,a,c);p.scale(c,h/p.length(c),c);p.add(c,a)}})})},"esri/views/3d/navigation/mixins/ConstraintsMixin":function(){define("../../../../core/Accessor ../../../../core/watchUtils ../../../../geometry/Point ../../support/mathUtils ../../lib/glMatrix ../../constraints/SceneViewAltitudeConstraint ../../webgl-engine/lib/Camera ../../webgl-engine/lib/IntervalUtilities ../../webgl-engine/lib/Selector".split(" "),
function(B,r,f,a,b,c,t,p,h){function l(b){return new K.Tilt({min:function(){return.01},max:function(){return a.deg2rad(b.tilt.max)}})}function q(a){return new K.Altitude({min:function(){return a.altitude.min},max:function(){return a.altitude.max}})}var y=b.vec3d,z=b.mat4d,w=new f,u=y.create(),C=z.create(),E=y.create(),G=y.create(),n=new t,A=y.create(),x={tilt:0,distance:0},I={distance:0,maxFarNearRatio:0},K=B.createSubclass([],{declaredClass:"esri.views.3d.navigation.mixins.ConstraintsMixin",properties:{userConstraints:{set:function(a){this._disconnectUserConstraints();
this._connectUserConstraints(a);this._set("userConstraints",a)}},elevationProvider:{value:null,set:function(a){null!==this._elevationChangeHandle&&(this._elevationChangeHandle.remove(),this._elevationChangeHandle=null);null!==this._elevationChangeTileHandle&&(this._elevationChangeTileHandle.remove(),this._elevationChangeTileHandle=null);null!==a&&(this._elevationChangeHandle=a.on("elevation-change",this._elevationChangeHandler.bind(this)),this._elevationChangeTileHandle=a.on("tile-geometry-change",
this._elevationChangeTileHandler.bind(this)));this._set("elevationProvider",a)}},minPoiDist:{get:function(){return this._minPoiDistInMeters/this.renderUnitInMeters},dependsOn:["renderUnitInMeters"]},cameraElevationMargin:{get:function(){return this._cameraElevationMarginInMeters/this.renderUnitInMeters},dependsOn:["renderUnitInMeters"]},minNearDistance:{get:function(){return this._minNearDistanceInMeters/this.renderUnitInMeters},dependsOn:["renderUnitInMeters"]},renderUnitInMeters:{},constraintsEnabled:{value:!0}},
constructor:function(a){this._userConstraints=null;this._userConstraintsHandles=[];this._clipDistanceHandles=[];this._tiltHandles=[];this._altitudeHandles=[];this.constraints={tilt:this.defaultConstraints.tilt,altitude:this.defaultConstraints.altitude,collision:this.defaultConstraints.collision};this._tiltModeHandler=this._tiltModeHandler.bind(this);this._tiltMaxHandler=this._tiltMaxHandler.bind(this);this._altitudeModeHandler=this._altitudeModeHandler.bind(this);this._altitudeMinMaxHandler=this._altitudeMinMaxHandler.bind(this);
this._clipDistanceModeHandler=this._clipDistanceModeHandler.bind(this);this._clipDistanceNearFarHandler=this._clipDistanceNearFarHandler.bind(this);this._collisionEnabledHandler=this._collisionEnabledHandler.bind(this);this.enableElevationUpdates=!0;this.updateTargetByElevationUpdates=K.UPDATE_TARGET_BY_ELEVATION_UPDATES_DEFAULT;this._recomputeTargetEyeForElevationChange=this._recomputeTargetCenterForElevationChange=!1;this._elevationChangeTileHandle=this._elevationChangeHandle=null;this._autoAltitudeConstraints=
{min:c.MIN_DEFAULT,max:c.MAX_DEFAULT};this.maxFarNearRatio=2E4;this._minNearDistanceInMeters=2;this._minPoiDistInMeters=4;this._cameraElevationMarginInMeters=5;this._intersectTerrainSelector=new h(a.view.viewingMode);this._intersectTerrainSelector.enableInvisibleTerrain=!0},initialize:function(){this._targetCameraBeforeElevationUpdate=this.cameras.current.copy();this._targetCameraChangedByElevationUpdate=!1;this._sceneExtentChangeHandle=this.view.watch("dataExtent",function(a){this._dataExtentChanged()}.bind(this))},
_dataExtentChanged:function(){this.view.ready&&0<this.view.dataExtent.xmax-this.view.dataExtent.xmin&&(this._updateSurfaceDistanceConstraint(this.view.dataExtent),this._reapplyConstraints(),this._camerasChanged())},_updateSurfaceDistanceConstraint:function(a){},updateRenderCoordsHelper:function(a,b){this.inherited(arguments);this._userConstraints&&"auto"!==this._userConstraints.altitude.mode||(this.constraints.altitude=K.Altitude.scale(this.defaultConstraints.altitude,a.unitInMeters));this._userConstraints&&
"auto"!==this._userConstraints.tilt.mode||(this.constraints.tilt=K.Tilt.scale(this.defaultConstraints.tilt,a.unitInMeters));this._updateSurfaceDistanceConstraint(this.view.dataExtent);this._reapplyConstraints();this._camerasChanged()},destroy:function(){this._disconnectUserConstraints();this._sceneExtentChangeHandle.remove()},_updateTargetCenterForElevation:function(a){this._recomputeTargetCenterForElevationChange=!1;if(a||this.enableElevationUpdates&&this.updateTargetByElevationUpdates)if(this._targetCameraChangedByElevationUpdate?
a=this._targetCameraBeforeElevationUpdate:(a=this.cameras.target,this._targetCameraBeforeElevationUpdate.copyFrom(a)),(a=this.getCameraIntersectTerrain(a.eye,a.center,a.up,.02))&&!a.equals(this.cameras.target))return this.setCamera(a,{internalUpdate:!0}),this._targetCameraChangedByElevationUpdate=!0;return!1},_updateTargetCenterForElevationWhenIdle:function(){var a=this.isAnimating,b=!1;if(!(this.pan&&this.pan.continuous&&this.pan.continuous.active||this.pan.active||this.zoom.active||this.rotate.active||
a)&&this._recomputeTargetCenterForElevationChange){var c=this._targetCameraChangedByElevationUpdate;this._updateTargetCenterForElevation()&&(b=!0);this._targetCameraChangedByElevationUpdate=c}!a&&this._recomputeTargetEyeForElevationChange&&this._updateTargetEyeForElevationChange()&&(b=!0);return b},step:function(){this._updateTargetCenterForElevationWhenIdle();this.inherited(arguments)},applyTiltConstraint:function(a){if(!this.constraintsEnabled)return!1;var b=!1,c=this._cameraElevationAngle(a,x),
h=this.constraints.tilt.min(c.distance),f=this.constraints.tilt.max(c.distance),l=0;c.tilt>f?l=c.tilt-f:c.tilt<h&&(l=c.tilt-h);.01<Math.abs(l)&&(z.identity(C),z.rotate(C,-l,a.viewRight),y.subtract(a.center,a.eye,u),z.multiplyVec3(C,u),y.subtract(a.center,u,a.eye),z.multiplyVec3(C,a.up),b=!0);this._autoUpdateTiltConstraint(f);return b},adjustTiltAfterZoom:function(a){return this.applyTiltConstraint(a)},applyConstraints:function(a,b,c){if(!this.constraintsEnabled)return!1;b=!1;c&&(b=this.applyTiltConstraint(a));
y.subtract(a.center,a.eye,E);c=a.distance;var h=this.limitAltitude(c,a.center,E);c!==h&&(y.scale(E,-h/c),y.add(a.center,E,a.eye),b=!0);return b},limitTumbleByConstraints:function(a,b,c,h){if(!this.constraintsEnabled)return b;var f=this.tiltConstraintsFromAltitudeConstraints(c,h);c=Math.max(this.constraints.tilt.min(h),f.min);h=Math.min(this.constraints.tilt.max(h),f.max);this._autoUpdateTiltConstraint(h);b=a+b;b>=h?b=Math.max(h,Math.min(b,a)):b<=c&&(b=Math.min(c,Math.max(b,a)));return b-a},_autoUpdateAltitudeConstraint:function(){var a=
this._userConstraints&&this._userConstraints.altitude;a&&"auto"===a.mode&&a.autoUpdate(this.constraints.altitude.min(this),this.constraints.altitude.max(this))},_autoUpdateTiltConstraint:function(b){var c=this._userConstraints&&this._userConstraints.tilt;void 0===b&&(b=this.constraints.tilt.max(this.cameras.target.distance));c&&"auto"===c.mode&&c.autoUpdate(a.rad2deg(b))},_disconnectUserConstraints:function(){if(this._userConstraints){this._userConstraintsHandles.forEach(function(a){a.remove()});
this._userConstraints=null;this._userConstraintsHandles.length=0;var a=this.renderUnitInMeters;this.constraints.tilt=K.Tilt.scale(this.defaultConstraints.tilt,a);this.constraints.altitude=K.Altitude.scale(this.defaultConstraints.altitude,a)}},_connectUserConstraints:function(a){a&&(this._userConstraints=a,this._userConstraintsHandles.push(r.init(a,"tilt.mode",this._tiltModeHandler),r.init(a,"clipDistance.mode",this._clipDistanceModeHandler),r.init(a,"altitude.mode",this._altitudeModeHandler),r.init(a,
"collision.enabled",this._collisionEnabledHandler)))},_camerasChanged:function(){var a=this._targetCameraChangedByElevationUpdate;this.targetChanged();this._targetCameraChangedByElevationUpdate=a;this.currentChanged();this.currentHasReachedTarget()&&this.currentReachedTarget()},_reapplyConstraints:function(a){var b=!1;this.applyConstraints(this.cameras.current,void 0,a)&&(b=!0);this.applyConstraints(this.cameras.target,void 0,a)&&(b=!0);b&&this._camerasChanged()},_userConstraintsChanged:function(){this._reapplyConstraints(!0)},
_altitudeMinMaxHandler:function(a,b,c){this._userConstraintsChanged()},_tiltMaxHandler:function(a,b,c){this._userConstraintsChanged()},_tiltModeHandler:function(a){this._tiltHandles.forEach(function(a){a.remove()});this._tiltHandles.length=0;"auto"===a?this.constraints.tilt=K.Tilt.scale(this.defaultConstraints.tilt,this.renderUnitInMeters):(this._tiltHandles.push(this._userConstraints.watch("tilt.max",this._tiltMaxHandler)),this.constraints.tilt=l(this._userConstraints));this._tiltMaxHandler()},_altitudeModeHandler:function(a){this._altitudeHandles.forEach(function(a){a.remove()});
this._altitudeHandles.length=0;"auto"===a?(this.constraints.altitude=K.Altitude.scale(this.defaultConstraints.altitude,this.renderUnitInMeters),this._autoUpdateAltitudeConstraint()):(this._altitudeHandles.push(this._userConstraints.watch("altitude.min",this._altitudeMinMaxHandler),this._userConstraints.watch("altitude.max",this._altitudeMinMaxHandler)),this.constraints.altitude=q(this._userConstraints));this._altitudeMinMaxHandler()},_collisionEnabledHandler:function(a,b,c){this.constraints.collision=
new K.Collision(this._userConstraints.collision.enabled);this._userConstraintsChanged()},_clipDistanceNearFarHandler:function(a,b,c){"auto"!==this._userConstraints.clipDistance.mode&&(this.cameras.target.near=this._userConstraints.clipDistance.near,this.cameras.target.far=this._userConstraints.clipDistance.far,this.cameras.current.near=this._userConstraints.clipDistance.near,this.cameras.current.far=this._userConstraints.clipDistance.far);this._camerasChanged()},_clipDistanceModeHandler:function(a){this._clipDistanceHandles.forEach(function(a){a.remove()});
this._clipDistanceHandles.length=0;"auto"!==a&&this._clipDistanceHandles.push(this._userConstraints.watch(["clipDistance.near","clipDistance.far"],this._clipDistanceNearFarHandler));this._clipDistanceNearFarHandler()},_updateAutoNearFar:function(a){var b=this._userConstraints&&this._userConstraints.clipDistance;if(!b||"auto"===b.mode){var c=this.renderUnitInMeters,h=this.distanceToSilhouette(a,this.view.dataExtent,c,this._getTerrainElevationBelowCamera(a),I);a.far=h.distance/c;a.far/h.maxFarNearRatio>
this.minNearDistance?a.near=a.far/h.maxFarNearRatio:(a.near=this.minNearDistance,a.far=a.near*h.maxFarNearRatio);b&&a===this.cameras.current&&b.autoUpdate(a.near,a.far)}},constrainTargetEyeByElevation:function(){var a=!1,b=this.elevationProvider;b&&b.spatialReference&&(a=this.cameras.target,b=this._getTerrainElevationBelowCamera(a),a=this._applyElevationConstraint(a.eye,b,this.cameraElevationMargin));return a},constrainTargetEyeByElevationAndMoveLookAt:function(){y.set(this.cameras.target.eye,G);
this.constrainTargetEyeByElevation()&&(y.subtract(G,this.cameras.target.eye),y.subtract(this.cameras.target.center,G))},targetChanged:function(a){this.inherited(arguments);this._targetCameraChangedByElevationUpdate=!1;this._updateAutoNearFar(this.cameras.target);this.currentHasReachedTarget()&&this.currentReachedTarget()},currentChanged:function(){this._updateAutoNearFar(this.cameras.current);this.inherited(arguments)},_applyElevationConstraint:function(a,b,c){if(!this.constraintsEnabled)return!1;
var h=this.renderCoordsHelper,f=h.getAltitude(a);return this.constraints.collision.enabled&&f-b<c?(h.setAltitude(b+c,a,0),!0):!1},_cameraElevationAngle:function(a,b){b=b||{tilt:0,distance:0};b.tilt=this.renderCoordsHelper.viewAngle(a.center,a.eye);b.distance=a.distance;return b},_elevationChangeTileHandler:function(a){if(this.enableElevationUpdates&&this._targetCameraChangedByElevationUpdate&&this.constraintsEnabled){var b=!1,c=a.tile.extent;a=this.renderCoordsHelper.fromRenderCoords(this._targetCameraBeforeElevationUpdate.eye,
w,a.spatialReference);c[0]<=a.x&&c[1]<=a.y&&c[2]>a.x&&c[3]>a.y&&(n.copyFrom(this.cameras.target),this.cameras.target.copyFrom(this._targetCameraBeforeElevationUpdate),this.constrainTargetEyeByElevation(),this.applyConstraints(this.cameras.target),b=!n.equals(this.cameras.target));b&&(this.isAnimating?this.targetChanged():this.targetAnimatedChanged(!1,{internalUpdate:!0}),this._targetCameraChangedByElevationUpdate=!0)}},_elevationChangeHandler:function(a){var b=a.extent;a=a.spatialReference;var c=
this.renderCoordsHelper.fromRenderCoords(this.cameras.target.eye,a);this._deferredUpdateTargetEyeForElevationChange(b,c,a);this._deferredUpdateTargetCenterForElevationChange(b,c,a)},_isPositionWithinExtent:function(a,b){return b[0]<=a.x&&b[1]<=a.y&&b[2]>a.x&&b[3]>a.y},_deferredUpdateTargetEyeForElevationChange:function(a,b){this.enableElevationUpdates&&this.constraintsEnabled&&this._isPositionWithinExtent(b,a)&&(this.isAnimating?this._recomputeTargetEyeForElevationChange=!0:this._updateTargetEyeForElevationChange())},
_updateTargetEyeForElevationChange:function(){this._recomputeTargetEyeForElevationChange=!1;var a=this.cameras.target;this._targetCameraChangedByElevationUpdate||this._targetCameraBeforeElevationUpdate.copyFrom(a);var b=this._getTerrainElevationBelowCamera(a);if(a=this._applyElevationConstraint(a.eye,b,this.cameraElevationMargin))this.isAnimating?this.targetChanged():this.targetAnimatedChanged(!1,{internalUpdate:!0}),this._targetCameraChangedByElevationUpdate=!0;return a},_deferredUpdateTargetCenterForElevationChange:function(a,
b,c){if(this.enableElevationUpdates&&!this._recomputeTargetCenterForElevationChange){var h=this.renderCoordsHelper.fromRenderCoords(this.cameras.target.center,c);c=Math.max(h.y,b.y);var f=Math.min(h.y,b.y);b=p.intersectIntervals([[Math.min(h.x,b.x),Math.max(h.x,b.x)]],[[a[0],a[2]]]);a=p.intersectIntervals([[f,c]],[[a[1],a[3]]]);0<b.length&&0<a.length&&(this._recomputeTargetCenterForElevationChange=!0)}},_getTerrainElevationBelowCamera:function(a){var b=this.elevationProvider;return b&&b.spatialReference?
(a=this.renderCoordsHelper.fromRenderCoords(a.eye,this.elevationProvider.spatialReference),this.elevationProvider.getElevation(a)||0):0},getCenterIntersectTerrain:function(a,b,c){c||(c=y.create());y.set(b,c);var h=this.picker.pickAlongRay(a,c,null,null,null,!1,this._intersectTerrainSelector);this.picker.pickedIntersectionPoint(h,c)||this.getCenterIntersectManifold(a,b,c)||this.getFallbackCenterAlongViewDirection(a,b,c);return c},getCenterIntersectManifold:function(a,b,c){y.subtract(b,a,u);return this.intersectManifold(a,
u,0,c)},intersectManifold:function(a,b,c,h){return this.renderCoordsHelper.intersectManifold(a,b,c,h)},getCameraIntersectTerrain:function(a,b,c,h){var f=this.cameras.current.copy();a&&(f.eye=a);b&&(f.center=b);c&&(f.up=c);this.getCenterIntersectTerrain(f.eye,f.center,A);y.dist2(f.eye,A)<this.minPoiDist&&this.constraintsEnabled&&(a=this.constraints.collision.enabled,y.set(f.viewForward,u),y.scale(u,this.minPoiDist),a?y.subtract(A,u,f.eye):y.add(f.eye,u,A),b=this.renderCoordsHelper,c=b.getAltitude(f.eye),
a&&c<this.cameraElevationMargin&&(y.subtract(A,f.eye,u),b.setAltitude(this.cameraElevationMargin,f.eye),y.add(f.eye,u,A)),f.markViewDirty());0<h?(a=y.dist(f.eye,f.center),y.dist(A,f.center)>a*h&&(f.center=A)):f.center=A;return f}});K.UPDATE_TARGET_BY_ELEVATION_UPDATES_DEFAULT=!0;K.Tilt=function(a){this.min=a.min;this.max=a.max};K.Tilt.scale=function(a,b){return 1===b?a:new K.Tilt({min:function(c){return a.min(c*b)},max:function(c){return a.max(c*b)}})};K.Tilt.prototype.apply=function(b,c){return a.clamp(b,
this.min(c),this.max(c))};K.Altitude=function(a){this.min=a.min;this.max=a.max};K.Altitude.scale=function(a,b){return 1===b?a:new K.Altitude({min:function(c){return a.min(c)/b},max:function(c){return a.max(c)/b}})};K.Altitude.prototype.apply=function(b,c){return a.clamp(c,this.min(b),this.max(b))};K.Collision=function(a){this.enabled=null!=a?a:!0};return K})},"esri/views/3d/navigation/spherical/AnimationSpherical":function(){define(["../mixins/AnimationMixin","../../lib/glMatrix","../../support/mathUtils"],
function(B,r,f){function a(a,b){var c=b[0]-a[0],h=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return c*c+h*h+f*f+a*a}function b(b,c){return Math.sqrt(a(b,c))}function c(a){this.interpolate=function(a,b,c){c=Math.min(9*c,.3);f.slerpOrLerp(a.center,b.center,c,a.center,1E-4);f.slerpOrLerp(a.eye,b.eye,c,a.eye,1E-4);f.slerp(a.up,b.up,c);a.fov=f.lerp(a.fov,b.fov,c);a.padding=h.lerp(a.padding,b.padding,c,l);a.computeUpOnSphere()}}function t(a,c,r){c=c||250;r=r||c;var q=0,u=0,t=0,y=0,z=function(b,h,f,l,n){return a.easeInOutInterpLinear(r,
c,b,h,f,l,n)},n=function(a,b,h,l){var n=p.dist(a,b);if(.1>n)return p.set(b,a),0;l=Math.min(l+r*h,Math.min(Math.sqrt(n*r),c));f.slerpOrLerp(a,b,Math.min(l/n*h,1),a,1E-4);return l};this.interpolate=function(a,c,p){q=n(a.eye,c.eye,p,q);u=n(a.center,c.center,p,u);y=n(a.padding,c.padding,p,y,{dist:b,lerp:function(a,b,c){return h.lerp(a,b,c,l)},set:function(b){a.padding=b}});t=z(a.fov,c.fov,p,t,{dist:function(a,b){return Math.abs(b-a)},lerp:f.lerp,set:function(b){a.fov=b}});a.computeUpOnSphere()}}var p=
r.vec3d,h=r.vec4d,l=h.create();return B.createSubclass({declaredClass:"esri.views.3d.navigation.spherical.AnimationSpherical",constructor:function(){this.interpolationTypes={linear:c,easeInOut:t}}})})},"esri/views/3d/navigation/mixins/AnimationMixin":function(){define(["../../../../core/Accessor","dojo/on","dojo/_base/lang","../../animation/pointToPoint/Animation","../../../animation/easing"],function(B,r,f,a,b){a=a.default;return B.createSubclass([],{declaredClass:"esri.views.3d.navigation.mixins.AnimationMixin",
properties:{interpolation:{set:function(a){if("string"===typeof a){var b=this.interpolationTypes[a];b?this._set("interpolation",new b(this)):console.error("[AnimationMixin] Invalid interpolation type "+a)}else this._set("interpolation",a)}},isAnimating:!1},initialize:function(){this._pointToPointAnimation=new a(this.view.viewingMode);this._targetCameraAnimated=this.cameras.current.copy();this.animationId=0},getDefaults:function(){return{interpolation:"linear"}},easeInOutInterpLinear:function(a,b,
f,h,l,q,r){var c=r.dist(f,h);if(c<.1/this.renderUnitInMeters)return r.set(h,f),0;q=Math.min(q+a*l,Math.min(Math.sqrt(c*a),b));r.set(r.lerp(f,h,Math.min(q/c*l,1)),f);return q},step:function(a){this.inherited(arguments);var b=this.currentHasReachedTarget();this._stepTimeAnimation(a/1E3,b);b&&this.pan.updateContinuous(a)},startAnimation:function(a,b){this.animationId++;this._startTimeAnimation(a,b);this.animationStarted()},_stepTimeAnimation:function(a,b){this.isAnimating&&(b?this.setCurrentToTarget(!0):
(b=this._pointToPointAnimation,b.step(a,this.cameras.current),b.finished?(this.isAnimating=!1,this._updateTargetCenterForElevationWhenIdle()||(this.isAnimating=!0,this.setCurrentToTarget(!0))):this.currentChanged()))},_startTimeAnimation:function(a,r){this.isAnimating=!0;var c={};a&&a.internalUpdate?(c.apex=null,c.duration=.3,c.easing=b.outExpo):c.apex={maximumDistance:this.view.constraints.altitude.max/6};a=f.mixin(c,"object"===typeof a?a:null);this._pointToPointAnimation.update(this.cameras.current,
r?this._targetCameraAnimated:this.cameras.target,a)},animationStarted:function(){r.emit(this,"animationStarted")},stop:function(){this.pan&&this.pan.continuous&&this.pan.continuous.stop();this.pan&&this.pan.momentum&&(this.pan.momentum=null);this.currentHasAlmostReachedTarget()?this.currentReachedTarget(!1,!0):(this.cameras.target.copyFrom(this.cameras.current),this.targetAndCurrentChanged(!0))},currentReachedTarget:function(){this.inherited(arguments);this.isAnimating=!1}})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../animation/pointToPoint/Animation ./Camera ../../lib/glMatrix ../../webgl-engine/lib/Camera".split(" "),
function(B,r,f,a,b,c,t){Object.defineProperty(r,"__esModule",{value:!0});var p=c.vec3d,h=p.create();B=function(){function c(c){this.animation=new a.Animation(function(){return new b.default(c)});this._current=new b.default(c)}Object.defineProperty(c.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});c.prototype.update=
function(a,b,c){var f=this.animation.definition.source,l=this.animation.definition.target,q=p.subtract(b.center,a.center,h),r=p.length(q);1E-5<=r?(q[0]/=r,q[1]/=r,q[2]/=r):(q[0]=0,q[1]=1,q[0]=0);p.set(q,f.lookAtDirection);p.set(q,l.lookAtDirection);f.copyFromRenderCamera(a);l.copyFromRenderCamera(b);this._current.copyFrom(f);this.animation.update(f,l,c);this.currentTime=0};c.prototype.cameraAt=function(a,b){a=this.animation.cameraAt(a,this._current);b||(b=new t);a.copyToRenderCamera(b);return b};
c.prototype.step=function(a,b){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return c}();r.Animation=B;r.default=B})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(B,r,f,a,b,c){Object.defineProperty(r,"__esModule",{value:!0});var t={zoom:0,pan:0,rotate:0};B=function(){function p(b){this.createCamera=
b;this.time=0;this.definition=new a.Definition(b);this.path=new c.Path}p.prototype.update=function(a,b,c){this.definition.update(a,b,c);this.path.update(this.definition,c);this.time=this._applyTimeSettings(this.path.time,c);this.settings=c};p.prototype.cameraAt=function(a,b){b||(b=this.createCamera());a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.settings.easing(a,1E3*this.time):1<=this.time?f.inOutCoastQuad(a):f.outExpo(a);a=this.path.interpolateComponentsAt(a,t);b.interpolate(this.definition.source,
this.definition.target,a);return b};p.prototype._applyTimeSettings=function(a,c){var h=null!=c.speedFactor?c.speedFactor:1;null!=c.duration?a=c.duration:null!=c.speedFactor&&(a/=h);return a=Math.min(Math.max(null!=c.minDuration?c.minDuration:b.defaultSettings.minDuration/h,a),null!=c.maxDuration?c.maxDuration:b.defaultSettings.maxDuration/h)};return p}();r.Animation=B;r.default=B})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(B,r,f){Object.defineProperty(r,
"__esModule",{value:!0});B=function(){function a(a){this.createCamera=a;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:f.defaultSettings.desiredScreenFlow};this.source=a();this.target=a()}a.prototype.clone=function(){var b=new a(this.createCamera);b.copyFrom(this);return b};a.prototype.copyFrom=function(a){this.update(a.source,a.target,a.settings)};a.prototype.update=function(a,c,r){this.source!==a&&this.source.copyFrom(a);this.target!==c&&this.target.copyFrom(c);
this.settings.desiredScreenFlow=null!=r.desiredScreenFlow?r.desiredScreenFlow:f.defaultSettings.desiredScreenFlow;this.compared=this.source.compareTo(this.target,this.compared);this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};a.prototype.halfWindowPanAtZoom=function(a){a=this.target.pixelsPerPanAtZoom(a);return this.halfWindowSize/a};Object.defineProperty(a.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-
this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return a}();r.Definition=B;r.default=B})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.defaultSettings=
{desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(B,r,f,a,b,c,t){Object.defineProperty(r,"__esModule",{value:!0});B=function(b){function h(a,h){var f=b.call(this)||this;f._preallocSegments=[new c.default,new c.default,new c.default];f.update(a,h);return f}f(h,b);h.prototype.update=function(a,b){if(a){this.definition?
this.definition.copyFrom(a):this.definition=a.clone();var c=null;b&&b.apex&&(c=t.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==c?this._updateWithoutApex():this._updateWithApex(c,b.apex)}};h.prototype.segmentInterpolateComponentsAt=function(b,c,h){h=b.interpolateComponentsAt(c,h);b===this._ascensionSegment?h.zoom=a.outQuad(h.zoom):b===this._descensionSegment&&(h.zoom=a.inQuad(h.zoom));return h};h.prototype._updateWithApex=function(a,b){var c=
this._preallocSegments,h=c[0],f=c[1],c=c[2],l=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-l,null!=b.ascensionFactor?b.descensionFactor:.5);var p=1-l-b;h.definition?h.definition.copyFrom(this.definition):h.definition=this.definition.clone();h.definition.compared.targetZoom=a;h.definition.compared.pan=this.definition.compared.pan*l;h.definition.compared.rotate=this.definition.compared.rotate*l;h.update();this._ascensionSegment=h;this.segments.push(h);0<p&&(f.definition?f.definition.copyFrom(this.definition):
f.definition=this.definition.clone(),f.definition.copyFrom(this.definition),f.definition.compared.sourceZoom=a,f.definition.compared.targetZoom=a,f.definition.compared.pan=this.definition.compared.pan*p,f.definition.compared.rotate=this.definition.compared.rotate*p,f.update(),this.segments.push(f));c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=a;c.definition.compared.pan=this.definition.compared.pan*b;c.definition.compared.rotate=
this.definition.compared.rotate*b;c.update();this._descensionSegment=c;this.segments.push(c)};h.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return h}(b.default);r.Path=B;r.default=B})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function f(){this.segments=[]}Object.defineProperty(f.prototype,"time",{get:function(){return this.segments.reduce(function(a,
b){return a+b.time},0)},enumerable:!0,configurable:!0});f.prototype.interpolateComponentsAt=function(a,b){a=Math.min(Math.max(a,0),1);a*=this.time;for(var c=0,f=0,p=this.definition,h=0;h<this.segments.length;h++){var l=this.segments[h],q=l.definition;if(a<=l.time||h===this.segments.length-1)return b=this.segmentInterpolateComponentsAt(l,a/l.time,b),b.pan=p.hasPan?(c+q.compared.pan*b.pan)/p.compared.pan:1,b.rotate=p.hasRotate?(f+q.compared.rotate*b.rotate)/p.compared.rotate:1,a=b.zoom*(q.compared.targetZoom-
q.compared.sourceZoom)+q.compared.sourceZoom,c=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,b.zoom=p.hasZoom?(a-c)/(f-c):1,b;a-=l.time;c+=q.compared.pan;f+=q.compared.rotate}};f.prototype.segmentInterpolateComponentsAt=function(a,b,c){return a.interpolateComponentsAt(b,c)};return f}();r.Path=B;r.default=B})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,
"__esModule",{value:!0});B=function(){function f(a){a&&this.update(a)}f.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=a.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};f.prototype._updatePrecomputedVariables=function(){var a=this.definition,b=a.compared,c=b.sourceZoom,f=b.targetZoom;this._sl=c>f?1:-1;this._panPixelsAtSource=b.pan*a.source.pixelsPerPanAtZoom(c);a=(a.source.pixelsPerRotateAtZoom(c)+a.target.pixelsPerRotateAtZoom(f))/
2;this._rotatePixels=b.rotate*a};f.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,b=this.definition.compared.targetZoom,c=this.definition.hasZoom,f=this.definition.hasPan,p=this.definition.hasRotate,h,l;h=f&&c?(b/a-1)/(-1/(this._sl*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource):0;l=c&&p?Math.log(a/b)/Math.LN2*this._sl*this.definition.halfWindowSize/this._rotatePixels:0;this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;a=this.definition.desiredPixelFlow;
c&&f&&p?(b=h+l+h*l,this._zoomPixelFlow=h*l/b*a,this._panPixelFlow=l/b*a,this._rotatePixelFlow=h/b*a):c&&f?(b=1+h,this._zoomPixelFlow=h/b*a,this._panPixelFlow=1/b*a):c&&p?(b=1+l,this._zoomPixelFlow=l/b*a,this._rotatePixelFlow=1/b*a):f&&p?(h=this._panPixelsAtSource/this._rotatePixels,b=1+h,this._panPixelFlow=h/b*a,this._rotatePixelFlow=1/b*a):f?this._panPixelFlow=a:c?this._zoomPixelFlow=a:p&&(this._rotatePixelFlow=a);this.time=p?this.rotateTime:c?this.zoomTime:f?this.panTime:0};Object.defineProperty(f.prototype,
"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._sl*this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._sl*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*a+1)/
(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});f.prototype._interpolateComponentsZoom=function(a){if(this.definition.hasZoom){var b=this.definition.compared.sourceZoom,c=this.definition.compared.targetZoom;return(b*Math.pow(b/c,-a)-b)/(c-b)}return a};f.prototype._interpolateComponentsPan=
function(a){if(this.definition.hasPan&&this.definition.hasZoom){var b=-1/(this._sl*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,b*a*this.time)-1)/(b*Math.LN2)}return a};f.prototype._interpolateComponentsRotate=function(a){return a};f.prototype.interpolateComponentsAt=function(a,b){a=Math.min(Math.max(a,0),1);var c=this._interpolateComponentsZoom(a),f=this._interpolateComponentsPan(a);a=this._interpolateComponentsRotate(a);b?(b.zoom=
c,b.pan=f,b.rotate=a):b={zoom:c,pan:f,rotate:a};return b};return f}();r.Segment=B;r.default=B})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports","./functions"],function(B,r,f){function a(a,c){var b=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<b?null!=c.maximumDistance?b+(c.maximumDistance-b)/2:1.5*b:c.maximumDistance?Math.min(c.maximumDistance,a):a}Object.defineProperty(r,
"__esModule",{value:!0});r.optimalDistance=function(b,c){var r=a(b,c),p={ascensionFactor:null!=c.ascensionFactor?c.ascensionFactor:.5,descensionFactor:null!=c.descensionFactor?c.descensionFactor:.5},h=0===p.ascensionFactor,l=0===p.descensionFactor,q=h?f.tAscensionZoomOnly:f.tAscensionZoomPan,y=h?f.dtAscensionZoomOnly:f.dtAscensionZoomPan,z=h?f.ddtAscensionZoomOnly:f.ddtAscensionZoomPan,w=l?f.tDescensionZoomOnly:f.tDescensionZoomPan,u=l?f.dtDescensionZoomOnly:f.dtDescensionZoomPan,C=l?f.ddtDescensionZoomOnly:
f.ddtDescensionZoomPan,h=function(a){return q(b,p,a)+f.tPanion(b,p,a)+w(b,p,a)},l=function(a){return y(b,p,a)+f.dtPanion(b,p,a)+u(b,p,a)},E=function(a){return z(b,p,a)+f.ddtPanion(b,p,a)+C(b,p,a)},B=h(r),n=f.tBaseLine(b),A=c.maximumIterations||20,x=null!=c.maximumDistance?c.maximumDistance:Infinity;for(c=0;c<A;c++){var I=(l(r)+1E-6)/E(r);if(isNaN(I)||r>=x&&0>I){if(!isFinite(x))return null;r=x;B=h(r);break}r-=I;if(r<b.compared.sourceZoom||r<b.compared.targetZoom)return null;I=h(r);if(.005>=Math.abs(I-
B)/B)break;B=I}return B>.7*n?null:r<b.compared.sourceZoom||r<b.compared.targetZoom?null:r}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.tAscensionZoomPan=function(f,a,b){var c=f.halfWindowPanAtZoom(b-f.compared.sourceZoom);return-f.halfWindowSize*(a.ascensionFactor*Math.LN2*f.compared.pan+c)*Math.log(f.compared.sourceZoom/b)/(f.desiredPixelFlow*Math.LN2*c)};r.dtAscensionZoomPan=function(f,
a,b){var c=1/b,r=Math.log(f.compared.sourceZoom*c),p=1/f.desiredPixelFlow,h=1/Math.LN2;b-=f.compared.sourceZoom;var l=1/b;a=(a.ascensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(b))/f.halfWindowPanAtZoom(1);return f.halfWindowSize*c*p*h*l*a-f.halfWindowSize*r*p*h*l+f.halfWindowSize*r*p*h*a/(b*b)};r.ddtAscensionZoomPan=function(f,a,b){var c=b-f.compared.sourceZoom,r=1/c,p=1/b,h=Math.log(f.compared.sourceZoom*p);a=(a.ascensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(c))/f.halfWindowPanAtZoom(1);
return f.halfWindowSize*r*(-2*r*p*a+2*r*h+2*p-2*h*a/(c*c)-a/(b*b))/(f.desiredPixelFlow*Math.LN2)};r.tAscensionZoomOnly=function(f,a,b){return-f.halfWindowSize*Math.log(f.compared.sourceZoom/b)/(f.desiredPixelFlow*Math.LN2)};r.dtAscensionZoomOnly=function(f,a,b){return f.halfWindowSize/(b*f.desiredPixelFlow*Math.LN2)};r.ddtAscensionZoomOnly=function(f,a,b){return-f.halfWindowSize/(b*b*f.desiredPixelFlow*Math.LN2)};r.tPanion=function(f,a,b){return-f.compared.pan*f.halfWindowSize*(a.ascensionFactor+
a.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(b))};r.dtPanion=function(f,a,b){return f.compared.pan*f.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(b*b))};r.ddtPanion=function(f,a,b){return-2*f.compared.pan*f.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(b*b*b))};r.tDescensionZoomPan=function(f,a,b){return f.halfWindowSize*(-f.halfWindowPanAtZoom(b)-a.descensionFactor*Math.LN2*
f.compared.pan+f.halfWindowPanAtZoom(f.compared.targetZoom))*Math.log(b/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2*f.halfWindowPanAtZoom(-b+f.compared.targetZoom))};r.dtDescensionZoomPan=function(f,a,b){var c=Math.log(b/f.compared.targetZoom),r=1/f.desiredPixelFlow,p=1/Math.LN2,h=-b+f.compared.targetZoom,l=1/h;a=(-f.halfWindowPanAtZoom(b)-a.descensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(f.compared.targetZoom))/f.halfWindowPanAtZoom(1);return-f.halfWindowSize*c*r*p*l+f.halfWindowSize*
c*r*p*a/(h*h)+f.halfWindowSize*r*p*l*a/b};r.ddtDescensionZoomPan=function(f,a,b){var c=b-f.compared.targetZoom,r=1/c,p=1/b,h=Math.log(b/f.compared.targetZoom);a=(f.halfWindowPanAtZoom(b)+a.descensionFactor*Math.LN2*f.compared.pan-f.halfWindowPanAtZoom(f.compared.targetZoom))/f.halfWindowPanAtZoom(1);return f.halfWindowSize*r*(-2*r*p*a-2*r*h+2*p+2*h*a/(c*c)-a/(b*b))/(f.desiredPixelFlow*Math.LN2)};r.tDescensionZoomOnly=function(f,a,b){return f.halfWindowSize*Math.log(b/f.compared.targetZoom)/(f.desiredPixelFlow*
Math.LN2)};r.dtDescensionZoomOnly=function(f,a,b){return f.halfWindowSize/(b*f.desiredPixelFlow*Math.LN2)};r.ddtDescensionZoomOnly=function(f,a,b){return-f.halfWindowSize/(b*b*f.desiredPixelFlow*Math.LN2)};r.tBaseLine=function(f){var a=Math.LN2*f.compared.pan,b=f.halfWindowPanAtZoom(f.compared.sourceZoom-f.compared.targetZoom),c=f.halfWindowSize*Math.log(f.compared.sourceZoom/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2*b);return f.compared.sourceZoom<=f.compared.targetZoom?c*(a-b):c*(a+b)}})},
"esri/views/3d/animation/pointToPoint/Camera":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(B,r,f,a){Object.defineProperty(r,"__esModule",{value:!0});var b=a.angle,c=a.lerp,t=a.slerpOrLerp,p=f.vec3d,h=f.mat3d,l=p.create(),q=p.create(),y=p.create(),z=p.create(),w=p.create(),u=p.create(),C=p.createFrom(0,0,1),E=p.createFrom(0,1,0),G=p.createFrom(1,0,0),n=h.create();B=function(){function a(a){void 0===a&&(a="global");this.viewingMode=a;this.center=p.create();
this.distance=this.yaw=this.pitch=0;this.lookAtDirection=p.create(E)}a.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};a.prototype.compareTo=function(a,c){c||(c={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var h=p.length(this.center),
f=p.length(a.center),h=(h+f)/2;c.pan=b(this.center,a.center)*h}else c.pan=p.dist(this.center,a.center);h=Math.abs(a.yaw-this.yaw);h>=Math.PI&&(h=2*Math.PI-h);c.rotate=Math.max(h,Math.abs(a.pitch-this.pitch));c.sourceZoom=this.distance;c.targetZoom=a.distance;return c};a.prototype.interpolate=function(a,b,h){"global"===this.viewingMode?t(a.center,b.center,h.pan,this.center,A):p.lerp(a.center,b.center,h.pan,this.center);this.distance=c(a.distance,b.distance,h.zoom);this.pitch=c(a.pitch,b.pitch,h.rotate);
a=a.yaw;b=b.yaw;Math.abs(b-a)>=Math.PI&&(a+=2*(a<b?1:-1)*Math.PI);this.yaw=c(a,b,h.rotate)};a.prototype.copyFrom=function(a){p.set(a.center,this.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;p.set(a.lookAtDirection,this.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};a.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,n);p.set(a.center,this.center);h.multiplyVec3(b,p.subtract(a.center,a.eye,z));h.multiplyVec3(b,
a.up,w);this.distance=p.length(z);z[0]/=this.distance;z[1]/=this.distance;z[2]/=this.distance;this.pitch=this._eyeUpToPitch(z,w);this.yaw=this._eyeUpToYaw(z,w);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};a.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};a.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,n);h.transpose(b);this._axisAngleVec3(G,this.pitch-Math.PI/2,E,z);this._axisAngleVec3(C,
this.yaw,z);this._axisAngleVec3(G,this.pitch-Math.PI/2,C,w);this._axisAngleVec3(C,this.yaw,w);p.scale(z,this.distance);h.multiplyVec3(b,z);h.multiplyVec3(b,w);a.center=this.center;a.eye=p.subtract(this.center,z,z);a.up=w};a.prototype._axisAngleVec3=function(a,b,c,h){void 0===h&&(h=c);var f=Math.cos(b);b=Math.sin(b);p.scale(c,f,l);p.scale(p.cross(a,c,q),b);p.scale(a,(1-f)*p.dot(a,c),y);return p.add(p.add(l,q,h),y,h)};a.prototype._lookAtOrientation=function(a,b){this._upAtLookAt(a,y);p.normalize(p.cross(this.lookAtDirection,
y,l));0===l[0]&&0===l[1]&&0===l[2]&&p.set(G,l);p.normalize(p.cross(y,l,q));b||(b=h.create());b[0]=l[0];b[1]=q[0];b[2]=y[0];b[3]=l[1];b[4]=q[1];b[5]=y[1];b[6]=l[2];b[7]=q[2];b[8]=y[2];return b};a.prototype._upAtLookAt=function(a,b){return"local"===this.viewingMode?p.set(C,b):p.normalize(a,b)};a.prototype._eyeUpToPitch=function(a,c){return Math.PI-b(C,a)};a.prototype._eyeUpToYaw=function(a,c){.5>Math.abs(c[2])?(p.set(c,u),0<a[2]&&p.scale(u,-1)):p.set(a,u);return b(G,p.normalize(p.cross(u,C,q)),C)};
return a}();var A=1E-4;r.default=B})},"esri/views/3d/navigation/spherical/actions/PanSpherical":function(){define("./ActionSpherical ../../mixins/PanMixin ../../../lib/glMatrix ../../../support/earthUtils ../../../support/mathUtils ../../../webgl-engine/lib/Util ../../ContinuousAction ../../NavigationConstants ../../../webgl-engine/lib/Camera ./Momentum".split(" "),function(B,r,f,a,b,c,t,p,h,l){var q=f.vec2d,y=f.vec3d,z=f.vec4d,w=f.mat4d,u=y.create(),C=y.create(),E=y.create(),G=y.create(),n=y.create(),
A=y.create(),x=w.create(),I=p.Pan.Mode,K=p.Pan.Direction,J=p.Pan.Vertical;return B.createSubclass([r],{declaredClass:"esri.views.3d.navigation.spherical.actions.PanSpherical",constructor:function(){this._panMode=0;this._plane=z.create();this.momentum=null;this._momentumEstimator=new l.ScreenspaceMomentumEstimator(.05,500,12,.82);this._momentumDirection=y.create();this.momentumEnabled=!0;this._momentumInitialCamera=new h;this.continuous=new t},begin:function(b,h){this.inherited(arguments);this._momentumEstimator.reset();
this.pickPointInScreen(b,this._navPickPoint)?this._navSphereRadius=y.length(this._navPickPoint):(this._navSphereRadius=y.length(this.targetCamera.center),this._navSphereRadius<.9*a.earthRadius&&(this._navSphereRadius=a.earthRadius),this.createPickRay(b,b,this.currentCamera.viewMatrix,u,C),y.subtract(C,this.currentCamera.eye),this.intersectManifold(this.currentCamera.eye,C,this._navSphereRadius-a.earthRadius,this._navPickPoint)||this.closestPointOnSphereSilhouette(this.currentCamera.eye,u,this._navSphereRadius,
this._navPickPoint));var f=!1;this.renderCoordsHelper.getAltitude(this.currentCamera.eye)<J.ELEVATION_THRESHOLD&&(this._navSphereRadius>y.length(this.currentCamera.eye)?f=!0:(y.normalize(y.subtract(this.targetCamera.eye,this._navPickPoint,E)),f=Math.abs(.5*Math.PI-Math.acos(y.dot(this._navPickPoint,E)/y.length(this._navPickPoint)))<J.ANGLE_THRESHOLD));f?(this._panMode=I.VERTICAL,y.normalize(y.subtract(this.targetCamera.eye,this.targetCamera.center,E)),this.updatePlane(this._navPickPoint,E)):(this._panMode=
I.HORIZONTAL,f=void 0===h?c.performance.now():h,this._momentumEstimator.add(b[0],b[1],this._navPickPoint,.001*f));q.set(b,this._dragLastPoint);q.set(b,this._dragBeginPoint);this._mouseDownCamera.copyFrom(this.targetCamera)},update:function(b,h){if(this._panMode===I.HORIZONTAL){if(0>=this._navSphereRadius)return;this.createPickRay(b,this._dragBeginPoint,this._mouseDownCamera.viewMatrix,u,C);y.subtract(C,this._mouseDownCamera.eye);this.intersectManifold(this._mouseDownCamera.eye,C,this._navSphereRadius-
a.earthRadius,this._targetOnSphere)||this.closestPointOnSphereSilhouette(this._mouseDownCamera.eye,u,this._navSphereRadius,this._targetOnSphere);this.rotateCameraWithPointsOnSphere(this._navPickPoint,this._targetOnSphere,this._mouseDownCamera,this.targetCamera,this._navSphereRadius);var f=void 0===h?c.performance.now():h;this._momentumEstimator.add(b[0],b[1],this._targetOnSphere,.001*f)}else{this.createPickRay(this._dragLastPoint,this._dragBeginPoint,this.currentCamera.viewMatrix,u,C);y.subtract(C,
u);if(!c.rayPlane(u,C,this._plane,G))return;this.createPickRay(b,this._dragBeginPoint,this.currentCamera.viewMatrix,u,C);y.subtract(C,u);if(!c.rayPlane(u,C,this._plane,n))return;y.subtract(n,G);y.subtract(this.targetCamera.eye,n);y.subtract(this.targetCamera.center,n);q.set(b,this._dragLastPoint)}this.constrainTargetEyeByElevationAndMoveLookAt();q.set(b,this._dragLastPoint);this.fixTargetUpVector();this.targetAndCurrentChanged();this.inherited(arguments)},end:function(a,b){this.update(a,b);this._panMode===
I.HORIZONTAL&&this._initiateMomentumPanning(a,b);this._navSphereRadius=0;this.inherited(arguments)},_initiateMomentumPanning:function(a,b){if(0>=this._navSphereRadius)return this.setPoiAuto(a,!0),!1;this.update(a,b);this.momentumEnabled&&(this.momentum=this._momentumEstimator.evaluateMomentum());if(this.momentum)return this._momentumInitialVelocity=this.rotationFromPointsOnSphere(this.momentum.dataOldest,this.momentum.dataNewest,this._navSphereRadius,this._momentumDirection)/this.momentum.dataTimeDelta,
this._momentumElapsed=0,this._momentumInitialCamera.copyFrom(this.currentCamera),this.animationStarted(),!0;this.currentReachedTarget();return!1},beginContinuous:function(a){var b=0===this.continuous.status;this.momentum=null;b&&(this.navigation.begin(this),this.active=!0,this.emit("begin"));this.inherited(arguments);this.setCurrentToTarget();b&&y.set3(0,0,0,this.continuous.direction);this.continuous.status&a||(this.continuous.status|=a,a&(K.LEFT|K.RIGHT|K.FORWARD|K.BACKWARD)?(this._computePanAxis(a,
A),y.add(this.continuous.direction,A)):(b=this.continuous.status&(K.UP|K.DOWN),this.continuous.radiusChange=b===K.UP?1:b===K.DOWN?-1:0),this.continuous.velocity=this._computePanVelocity());this.continuous.timer=0},updateContinuous:function(a){if(this.continuous){var b=0,c=null,h=!1;if(this.momentum)this._momentumElapsed+=.001*a,b=this.momentum.valueFromInitialVelocity(this._momentumInitialVelocity,this._momentumElapsed),c=this._momentumDirection,w.identity(x),w.rotate(x,b,c),w.multiplyVec3(x,this._momentumInitialCamera.eye,
this.targetCamera.eye),w.multiplyVec3(x,this._momentumInitialCamera.center,this.targetCamera.center),w.multiplyVec3(x,this._momentumInitialCamera.up,this.targetCamera.up),this.applyConstraints(this.targetCamera),this.constrainTargetEyeByElevationAndMoveLookAt(),this.fixTargetUpVector(),this.momentum.isFinished(this._momentumElapsed)?(this.momentum=null,this.setCurrentToTarget(!0,!1)):this.targetAndCurrentChanged();else{var b=this.continuous.step(a),c=this.continuous.direction,h=.01<y.dot(this.continuous.direction,
this.continuous.direction),f=this.targetCamera;if(0<Math.abs(this.continuous.radiusChange)){a=1+b*this.continuous.radiusChange;var l=f.viewForward,f=y.normalize(f.center,C);(-.999<y.dot(l,f)||0>this.continuous.radiusChange)&&y.scale(this.targetCamera.center,a);y.scale(this.targetCamera.eye,a);this.continuous.velocity=this._computePanVelocity();h||(this.applyConstraints(this.targetCamera),this.constrainTargetEyeByElevationAndMoveLookAt(),this.fixTargetUpVector(),this.targetAndCurrentChanged())}}h&&
(w.identity(x),w.rotate(x,b,c),w.multiplyVec3(x,this.targetCamera.eye),w.multiplyVec3(x,this.targetCamera.center),w.multiplyVec3(x,this.targetCamera.up),this.applyConstraints(this.targetCamera),this.constrainTargetEyeByElevationAndMoveLookAt(),this.fixTargetUpVector(),this.targetAndCurrentChanged());this.emit("update")}},endContinuous:function(a){this.continuous.status&=~a;this.momentum=null;if(0===this.continuous.status)this.continuous.stop(),this.continuous.radiusChange=0,this.active=!1,this.emit("end"),
this.navigation.end(this);else if(a&(K.LEFT|K.RIGHT|K.FORWARD|K.BACKWARD))this._computePanAxis(a,A),y.subtract(this.continuous.direction,A),.01>y.length(this.continuous.direction)&&y.set3(0,0,0,this.continuous.direction);else{var b=this.continuous.status&(K.UP|K.DOWN);this.continuous.radiusChange=b==K.UP?1:b==K.DOWN?-1:0}this.inherited(arguments)},_computePanAxis:function(a,b){y.subtract(this.targetCamera.center,this.targetCamera.eye,b);y.cross(b,this.targetCamera.up);if(a===K.LEFT||a===K.RIGHT)y.normalize(b),
y.cross(b,this.targetCamera.center);a!==K.RIGHT&&a!==K.FORWARD||y.negate(b);y.normalize(b)},_computePanVelocity:function(){var c=.5*Math.abs(y.length(this.targetCamera.eye)-a.earthRadius),c=b.clamp(c,1,2*a.earthRadius);return b.acos(1-c*c/(2*a.earthRadius*a.earthRadius))},updatePlane:function(a,b){z.set4(b[0],b[1],b[2],-y.dot(b,a),this._plane)}})})},"esri/views/3d/navigation/spherical/actions/ActionSpherical":function(){define(["../../Action","../../../support/mathUtils","../../../lib/glMatrix"],
function(B,r,f){var a=f.vec3d,b=f.mat4d,c=a.create(),t=b.create();return B.createSubclass({declaredClass:"esri.views.3d.navigation.spherical.actions.ActionSpherical",constructor:function(){this._targetOnSphere=a.create();this._navSphereRadius=0},closestPointOnSphereSilhouette:function(f,h,l,q){a.cross(f,h,c);a.cross(c,f,q);a.scale(q,1/a.length(q)*l);f=-r.asin(l/a.length(f));b.identity(t);b.rotate(t,f,c);b.multiplyVec3(t,q)},rotateCameraWithPointsOnSphere:function(a,b,c,f,r){return this.navigation.rotateCameraWithPointsOnSphere(a,
b,c,f,r)},rotationFromPointsOnSphere:function(a,b,c,f){return this.navigation.rotationFromPointsOnSphere(a,b,c,f)}})})},"esri/views/3d/navigation/Action":function(){define(["../../../core/Accessor","../../../core/Evented","../webgl-engine/lib/Camera","../lib/glMatrix","dojo/on"],function(B,r,f,a,b){var c=a.vec3d,t=a.vec2d;return B.createSubclass([r],{properties:{type:{},navigation:{},picker:{readOnly:!0,aliasOf:"navigation.picker"},currentCamera:{aliasOf:"navigation.currentCamera"},targetCamera:{aliasOf:"navigation.targetCamera"},
constraints:{readOnly:!0,aliasOf:"navigation.constraints"},renderCoordsHelper:{readOnly:!0,aliasOf:"navigation.renderCoordsHelper"},minPoiDist:{readOnly:!0,aliasOf:"navigation.minPoiDist"}},constructor:function(){this._tmpEvent={type:null,phase:null,x:void 0,y:void 0};this._mouseDownCamera=new f;this._navPickPoint=c.create();this._dragLastPoint=t.create();this._dragBeginPoint=t.create();this.active=!1},initialize:function(){var a=this;["minPoiDist","renderCoordsHelper","constraints","picker"].forEach(function(b){this.navigation.watch(b,
function(){a.notifyChange(b)})}.bind(this))},emit:function(a,c,f){this._tmpEvent.type=this.type;this._tmpEvent.phase=a;this._tmpEvent.x=c;this._tmpEvent.y=f;b.emit(this,a,this._tmpEvent);b.emit(this.navigation,this.type,this._tmpEvent)},intersectManifold:function(a,b,c,f){return this.navigation.intersectManifold(a,b,c,f)},fixTargetUpVector:function(){return this.navigation.fixTargetUpVector()},setPoiAuto:function(a,b){return this.navigation.setPoiAuto(a,b)},normalizeCoordinate:function(a,b){b[0]=
a[0]/this.currentCamera.width;b[1]=a[1]/this.currentCamera.height},worldUpAtPosition:function(a,b){return this.renderCoordsHelper.worldUpAtPosition(a,b)},applyConstraints:function(a,b){return this.navigation.applyConstraints(a,b)},constrainTargetEyeByElevation:function(a){return this.navigation.constrainTargetEyeByElevation(a)},constrainTargetEyeByElevationAndMoveLookAt:function(){return this.navigation.constrainTargetEyeByElevationAndMoveLookAt()},targetAndCurrentChanged:function(a){return this.navigation.targetAndCurrentChanged(a)},
targetAnimatedChanged:function(a,b){return this.navigation.targetAnimatedChanged(a,b)},currentReachedTarget:function(a){return this.navigation.currentReachedTarget(a)},setCurrentToTarget:function(a,b){return this.navigation.setCurrentToTarget(a,b)},animationStarted:function(){return this.navigation.animationStarted()},limitAltitude:function(a,b,c){return this.navigation.limitAltitude(a,b,c)},limitTumbleByConstraints:function(a,b,c,f){return this.navigation.limitTumbleByConstraints(a,b,c,f)},createPickRay:function(a,
b,c,f,r){return this.picker.createPickRay(a,b,c,f,r)},pickAlongRay:function(a,b,c,f,r,t){return this.picker.pickAlongRay(a,b,c,f,r,t)},pickPointInScreen:function(a,b){return this.picker.pickPointInScreen(a,b)},pickFreePointInScreen:function(a,b){return this.picker.pickFreePointInScreen(a,b)},pickInScreen:function(a){return this.picker.pickInScreen(a)}})})},"esri/views/3d/navigation/mixins/PanMixin":function(){define(["../../../../core/declare"],function(B){return B([],{declaredClass:"esri.views.3d.navigation.mixins.PanMixin",
type:"pan",begin:function(r){this.navigation.begin(this);this.active=!0;this.emit("begin")},update:function(r){this.emit("update")},end:function(r){this.active=!1;this.emit("end");this.navigation.end(this)},beginContinuous:function(r){},updateContinuous:function(r){},endContinuous:function(r){}})})},"esri/views/3d/navigation/ContinuousAction":function(){define(["../../../core/Accessor","../lib/glMatrix"],function(B,r){var f=r.vec3d;return B.createSubclass({properties:{active:{get:function(){return 0!==
this.velocity},dependsOn:["velocity"],readOnly:!0},velocity:{}},constructor:function(){this.direction=f.create();this.status=this.timer=this.velocity=0},stop:function(){this.status=this.velocity=this.timer=0;f.set3(0,0,0,this.direction)},step:function(a){var b;a*=.001;0<this.timer?(a=Math.min(a,this.timer),b=this.velocity*a*(1-a/(2*this.timer)),this.velocity*=1-a/this.timer,this.timer-=a):b=this.velocity*a;return b}})})},"esri/views/3d/navigation/spherical/actions/Momentum":function(){define(["require",
"exports","../../../../navigation/Momentum"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});r.ScreenspaceMomentumEstimator=f.ScreenspaceMomentumEstimator;r.ScreenspaceMomentum=f.ScreenspaceMomentum})},"esri/views/3d/navigation/spherical/actions/ZoomSpherical":function(){define(["./ActionSpherical","../../mixins/ZoomMixin","../../../lib/glMatrix","../../../support/earthUtils"],function(B,r,f,a){var b=f.vec2d,c=f.vec3d,t=f.mat4d,p=c.create(),h=c.create(),l=c.create(),q=t.create(),
y=c.create(),z=c.create();return B.createSubclass([r],{declaredClass:"esri.views.3d.navigation.spherical.actions.ZoomSpherical",constructor:function(){},begin:function(b){this.inherited(arguments);this.pickPointInScreen(b,this._navPickPoint)?this._navSphereRadius=c.length(this._navPickPoint):(this._navSphereRadius=c.length(this.targetCamera.center),this._navSphereRadius<.9*a.earthRadius&&(this._navSphereRadius=a.earthRadius),this.createPickRay(b,b,this.currentCamera.viewMatrix,p,h),c.subtract(h,this.currentCamera.eye),
this.intersectManifold(this.currentCamera.eye,h,this._navSphereRadius-a.earthUtils,this._navPickPoint)||(this._navSphereRadius=0));this._mouseDownCamera.copyFrom(this.targetCamera)},update:function(f){var u=this.targetCamera;u.eye=this._mouseDownCamera.eye;u.center=this._mouseDownCamera.center;u.up=this._mouseDownCamera.up;c.subtract(u.center,u.eye,l);var r=c.length(l);this.normalizeCoordinate(f,p);var w=12*(p[1]-this.normalizedAnchorPoint[1]);f=r*Math.pow(2,w);0>w&&f<this.navigation.minPoiDist&&
(f=this.navigation.minPoiDist);f=this.limitAltitude(f,u.center,l);1E-6>Math.abs(r-f)||(0<this._navSphereRadius&&f<r&&(w=1-(1-f/r)*(1-this._navSphereRadius/c.length(u.center)),c.scale(u.center,w)),c.scale(l,-f/r),c.add(u.center,l,u.eye),r=!1,0<this._navSphereRadius&&(t.lookAt(u.eye,u.center,u.up,q),this.createPickRay(this._dragBeginPoint,this._dragBeginPoint,q,p,h),c.normalize(c.subtract(h,u.eye)),this.intersectManifold(u.eye,h,this._navSphereRadius-a.earthRadius,this._targetOnSphere)||(this.closestPointOnSphereSilhouette(u.eye,
p,this._navSphereRadius,this._targetOnSphere),r=!0),this.rotateCameraWithPointsOnSphere(this._navPickPoint,this._targetOnSphere,u,u,this._navSphereRadius),this.fixTargetUpVector()),this.applyConstraints(u),this.constrainTargetEyeByElevation(),this.targetAndCurrentChanged(),b.set(this._dragBeginPoint,this._dragLastPoint),r&&(t.lookAt(u.eye,u.center,u.up,q),this._dragLastPoint=this.currentCamera.projectPoint(this._navPickPoint,q)),u=this._toYDownCoord(this._dragLastPoint),this.emit("update",u[0],u[1]))},
stepAtPoint:function(b,f,l,r){c.set(f,z);f=c.length(z);c.subtract(this.targetCamera.center,this.targetCamera.eye,y);var u=c.length(y),n=u*b,n=1>=b&&n<this.minPoiDist?this.minPoiDist:this.limitAltitude(n,z,y);b=n/u;1E-6>Math.abs(u-n)||(r&&(u=c.length(this.targetCamera.center),c.scale(this.targetCamera.center,(f+b*(u-f))/u)),c.scale(y,-b),c.add(this.targetCamera.center,y,this.targetCamera.eye),r&&l&&(t.lookAt(this.targetCamera.eye,this.targetCamera.center,this.targetCamera.up,q),this.createPickRay(l,
l,q,p,h),c.normalize(c.subtract(h,this.targetCamera.eye)),this.intersectManifold(this.targetCamera.eye,h,f-a.earthRadius,this._targetOnSphere)?this.rotateCameraWithPointsOnSphere(z,this._targetOnSphere,this.targetCamera,this.targetCamera,f):r=!1),this.navigation.adjustTiltAfterZoom(this.targetCamera),this.applyConstraints(this.targetCamera),this.constrainTargetEyeByElevation(),r&&this.fixTargetUpVector(),this.navigation.currentHasAlmostReachedTarget()?this.targetAndCurrentChanged():this.targetAnimatedChanged(!1,
{internalUpdate:!0}))}})})},"esri/views/3d/navigation/mixins/ZoomMixin":function(){define(["../../../../core/declare","../../lib/glMatrix"],function(B,r){var f=r.vec2d,a=r.vec3d,b=a.create();return B([],{declaredClass:"esri.views.3d.navigation.mixins.ZoomMixin",type:"zoom",constructor:function(){this.normalizedAnchorPoint=f.create();this._lastStepAnimationId=-1},begin:function(a){this.navigation.begin(this);f.set(a,this._dragBeginPoint);this.normalizeCoordinate(a,this.normalizedAnchorPoint);a=this._toYDownCoord(this._dragBeginPoint);
this.active=!0;this.emit("begin",a[0],a[1])},update:function(a){},end:function(a){this.active=!1;a=this._toYDownCoord(this._dragBeginPoint);this.emit("end",a[0],a[1]);this.navigation.end(this)},stepScreen:function(c,f){this.active||(a.set(this.currentCamera.center,b),0<c&&(this.pickPointInScreen(f,b)||"local"!==this.navigation.view.viewingMode||this.pickFreePointInScreen(f,b)),this.step(Math.pow(.6,c),b,f))},step:function(b,f,p){if(!this.active){this.navigation.begin(this);this.navigation.currentHasAlmostReachedTarget()||
this.navigation.animationId===this._lastStepAnimationId?this.targetCamera.copyFrom(this.currentCamera):this.navigation.stop();var c=1E-6<a.dist(f,this.targetCamera.center);this.stepAtPoint(b,f,p,c);this._lastStepAnimationId=this.navigation.animationId;this.navigation.end(this)}},stepAtPoint:function(a,b,f,h){},_toYDownCoord:function(a){return[a[0],this.currentCamera.height-a[1]]}})})},"esri/views/3d/navigation/spherical/actions/RotateSpherical":function(){define(["./ActionSpherical","../../mixins/RotateMixin"],
function(B,r){return B.createSubclass([r],{declaredClass:"esri.views.3d.navigation.spherical.actions.RotateSpherical"})})},"esri/views/3d/navigation/mixins/RotateMixin":function(){define(["../../../../core/declare","../../lib/glMatrix","../../support/mathUtils","../NavigationConstants"],function(B,r,f,a){var b=r.vec2d,c=r.vec3d,t=r.mat4d,p=c.create(),h=c.create(),l=b.create(),q=t.create(),y=c.create(),z=[3,1.5],w=a.Rotate.PivotPoint;return B([],{declaredClass:"esri.views.3d.navigation.mixins.RotateMixin",
type:"rotate",constructor:function(){this._rotLastPoint=b.create()},begin:function(a,b){void 0===b&&(b=w.POI);this.navigation.begin(this);this.active=!0;this.emit("begin");this.setPoiAuto(a);this.normalizeCoordinate(a,this._rotLastPoint)},update:function(a,b){void 0===b&&(b=w.POI);var c,h;switch(b){case w.EYE:c=this.targetCamera.center;h=this.targetCamera.eye;break;default:c=this.targetCamera.eye,h=this.targetCamera.center,b!==w.POI&&console.error("[RotateMixin.update]: invalid pivot specified")}this._applyRotation(a,
b,c,h);this.constrainTargetEyeByElevation();this.fixTargetUpVector();this.targetAndCurrentChanged();this.emit("update")},_applyRotation:function(a,r,E,B){this.renderCoordsHelper.worldUpAtPosition(B,p);this.normalizeCoordinate(a,l);a=(l[1]-this._rotLastPoint[1])*z[r-1];var n=(l[0]-this._rotLastPoint[0])*z[r-1];c.subtract(E,B,h);var u=c.length(h),x=f.acos(c.dot(h,p)/u);r===w.POI?a=this.limitTumbleByConstraints(x,a,B,u):(x=.5*Math.PI-x,u=.495*Math.PI,a=x-Math.max(-u,Math.min(u,x+-.5*a)));t.identity(q);
c.cross(this.targetCamera.up,h,y);r==w.POI&&(n=-n);t.rotate(q,n,p);t.rotate(q,a,y);t.multiplyVec3(q,h);c.add(B,h,E);t.multiplyVec3(q,this.targetCamera.up);b.set(l,this._rotLastPoint)},end:function(a){this.active=!1;this.emit("end");this.navigation.end(this)}})})},"esri/views/3d/navigation/planar/NavigationPlanar":function(){define("../Navigation ./ConstraintsPlanar ./AnimationPlanar ./actions/PanPlanar ./actions/RotatePlanar ./actions/ZoomPlanar ../../webgl-engine/lib/Camera ../../lib/glMatrix".split(" "),
function(B,r,f,a,b,c,t,p){var h=p.vec3d,l=h.create(),q=h.create(),y=h.create(),z=h.create();return B.createSubclass([r,f],{declaredClass:"esri.views.3d.navigation.planar.NavigationPlanar",initialize:function(){this.pan=new a({navigation:this});this.zoom=new c({navigation:this});this.rotate=new b({navigation:this})},getInitialCamera:function(){return new t(h.createFrom(0,0,100),h.createFrom(0,0,0),h.createFrom(0,1,0))},fixTargetUpVector:function(){var a=this.renderCoordsHelper.worldUpAtPosition(),
b=this.cameras.target;h.direction(b.center,b.eye,z);var c=h.dot(z,a);.9999>=Math.abs(c)&&(h.scale(z,c,z),h.subtract(a,z,b.up),h.normalize(b.up))},setPoiAuto:function(a,b){a=this.picker.pickAlongRay(this.cameras.target.eye,this.cameras.target.center,null,a);if(a.getMinResult().getIntersectionPoint(l)&&a.getMaxResult().getIntersectionPoint(q)){var c=5/this.renderUnitInMeters;b=a.getMinResult().dist-c;var c=a.getMaxResult().dist+c,f=h.dist(this.cameras.target.eye,this.cameras.target.center);if(f<=b||
f>=c){if(a.getMinResult().object){a.getMaxResult().dist=void 0;a.intersectObject(a.getMinResult().object);if(void 0===a.getMaxResult().dist){console.error("[NavigationPlanar.setPoiAuto] Did not obtain maximum intersection distance");return}a.getMaxResult().getIntersectionPoint(q);h.lerp(l,q,.5,y)}else h.set(l,y);this.setCameraFromEyeAndCenter(this.cameras.target.eye,y,{animate:!1})}}}})})},"esri/views/3d/navigation/planar/ConstraintsPlanar":function(){define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../constraints/SceneViewTiltConstraint ../../lib/glMatrix ../../terrain/StableSurfaceCenter ../../webgl-engine/lib/Util ../../../../geometry/support/scaleUtils ../../../../core/watchUtils ../../../../core/Logger".split(" "),
function(B,r,f,a,b,c,t,p,h,l){var q=b.vec3d,y=l.getLogger("esri.views.3d.navigation.planar.ConstraintsPlanar"),z=q.create(),w=q.create(),u=q.create(),C={min:0,max:Math.PI};return B.createSubclass({declaredClass:"esri.views.3d.navigation.planar.ConstraintsPlanar",defaultConstraints:{tilt:new B.Tilt({min:function(){return r.deg2rad(a.MAX_DEFAULT)},max:r.makePiecewiseLinearFunction([[4E3,r.deg2rad(a.MIN_DEFAULT)],[1E4,r.deg2rad(88)],[6E6,r.deg2rad(88)]])}),altitude:new B.Altitude({min:function(){return-Infinity},
max:function(){return Infinity}}),collision:new B.Collision},_surfaceDistanceConstraint:Infinity,_surfaceCenter:null,_surfaceCenterHelper:null,_basemapTerrainWatchHandle:null,constructor:function(a){this._basemapTerrainWatchHandle=h.init(a.view,"basemapTerrain",this._initializeSurfaceCenterHelper.bind(this,a.view))},destroy:function(){this._surfaceCenterHelper&&(this._surfaceCenterHelper.destroy(),this._surfaceCenterHelper=null);this._basemapTerrainWatchHandle&&(this._basemapTerrainWatchHandle.remove(),
this._basemapTerrainWatchHandle=null)},_initializeSurfaceCenterHelper:function(a){this._surfaceCenterHelper&&(this._surfaceCenterHelper.destroy(),this._surfaceCenter=this._surfaceCenterHelper=null);a.basemapTerrain&&(this._surfaceCenterHelper=new c({view:a}),h.init(this._surfaceCenterHelper,"center",function(a){a&&this.renderCoordsHelper.toRenderCoords(a,z)?(this._surfaceCenter=q.create(z),this._dataExtentChanged()):this._surfaceCenter=null}.bind(this)))},_altitudeModeHandler:function(a){this.inherited(arguments);
"auto"!==a&&y.warn("Altitude constraint is ignored in local scenes")},_updateSurfaceDistanceConstraint:function(a){var b=Math.max(a.xmax-a.xmin,a.ymax-a.ymin);a.hasZ&&(b=Math.max(b,a.zmax-a.zmin));b=3*b/Math.atan((this._targetCameraBeforeElevationUpdate||this.targetCamera)._fov/2);a=p.getMetersPerUnitForSR(a.spatialReference);this._surfaceDistanceConstraint=b*a},limitAltitude:function(a,b,c){var h=this._surfaceDistanceConstraint;if(!this._surfaceCenter||Infinity===h)return a;q.scale(c,a/q.length(c),
z);var f=q.subtract(b,z,z);return 1E-6<q.dist(f,this._surfaceCenter)-h&&t.raySphere(f,c,this._surfaceCenter,h,w)?q.dist(b,w):a},tiltConstraintsFromAltitudeConstraints:function(a,b){return C},distanceToSilhouette:function(a,b,c,h,l){l||(l={maxFarNearRatio:0,distance:0});l.maxFarNearRatio=this.maxFarNearRatio;var n=this.renderCoordsHelper.getAltitude(a.eye),p=n*=c;h=n-h;var t=this.elevationProvider?this.elevationProvider.getElevationBounds():null;t&&(n=0<=h?p-c*t[0]:c*t[1]-p);p=Math.max(b.xmax-b.xmin,
b.ymax-b.ymin,4*Math.max(b.xmax-b.xmin,b.ymax-b.ymin));q.subtract(a.center,a.eye,u);z[0]=0<u[0]?b.xmax:b.xmin;z[1]=0<u[1]?b.ymax:b.ymin;z[2]=0<u[2]?p/2:-p/2;q.subtract(z,a.eye);q.normalize(u);a=1.1*q.dot(z,u)*c;t=n+f.earthRadius;t=Math.sqrt(t*t-f.earthRadius*f.earthRadius);b=Math.max(b.xmax-b.xmin,b.ymax-b.ymin);var w=1E-4*b*c;c=r.clamp((n-w)/(.001*b*c-w),0,1);l.distance=r.lerp(t,a,c*c*c);l.maxFarNearRatio=2E4;l.distance*=Math.max(Math.log(Math.abs(h)),1);l.distance=Math.min(l.distance,Math.max(34064E4,
p));return l},getFallbackCenterAlongViewDirection:function(a,b,c){q.set(b,c)}})})},"esri/views/3d/terrain/StableSurfaceCenter":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/HandleRegistry ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Point ../support/aaBoundingRect".split(" "),function(B,r,f,a,b,c,t,p,h,l){return function(b){function q(a){a=b.call(this,
a)||this;a._updatePromise=null;a._set("center",null);return a}f(q,b);q.prototype.normalizeCtorArgs=function(a){this._set("view",a.view);return{}};q.prototype.initialize=function(){var a=this;this._handles=new c;this._handles.add(this.watch("surfaceView.extent",function(){return a._update()}));this._handles.add(t.on(this,"surface.layers","change",function(){return a._update()}));this._update()};q.prototype.destroy=function(){this._handles.destroy()};q.prototype._update=function(){var a=this;this._updatePromise&&
(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView){var b=l.center(this.surfaceView.extent),b=new h(b[0],b[1],this.surfaceView.spatialReference);this.surface&&0<this.surface.layers.length?(this._set("center",null),this._updatePromise=this.surface.queryElevation(b,{noDataValue:0}).then(function(b){a._updatePromise=null;a._set("center",b.geometry)}).otherwise(function(a){"cancel"!==a&&console.error("StableSurfaceCenter failed to update: ",a)})):(b.z=0,this._set("center",
b))}else this._set("center",null)};a([p.property({readOnly:!0})],q.prototype,"view",void 0);a([p.property({readOnly:!0,aliasOf:"view.map.ground"})],q.prototype,"surface",void 0);a([p.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],q.prototype,"surfaceView",void 0);a([p.property({readOnly:!0})],q.prototype,"center",void 0);return q=a([p.subclass("esri.views.3d.terrain.StableSurfaceCenter")],q)}(p.declared(b))})},"esri/views/3d/navigation/planar/AnimationPlanar":function(){define(["../mixins/AnimationMixin",
"../../lib/glMatrix","../../support/mathUtils"],function(B,r,f){function a(a,b){var c=b[0]-a[0],h=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return c*c+h*h+f*f+a*a}function b(b,c){return Math.sqrt(a(b,c))}function c(a){this.interpolate=function(a,b,c){c=Math.min(5*c,.3);p.lerp(a.eye,b.eye,c);p.lerp(a.center,b.center,c);p.lerp(a.up,b.up,c);a.fov=f.lerp(a.fov,b.fov,c);a.padding=h.lerp(a.padding,b.padding,c,l)}}function t(a,c,r){c=c||250;r=r||c;var q=0,u=0,t=0,z=0,y=0,n=function(b,h,f,l,n){return a.easeInOutInterpLinear(r,
c,b,h,f,l,n)};this.interpolate=function(a,c,r){q=n(a.eye,c.eye,r,q,p);u=n(a.center,c.center,r,u,p);t=n(a.up,c.up,r,t,p);y=n(a.padding,c.padding,r,y,{dist:b,lerp:function(a,b,c){return h.lerp(a,b,c,l)},set:function(b){a.padding=b}});z=n(a.fov,c.fov,r,z,{dist:function(a,b){return Math.abs(b-a)},lerp:f.lerp,set:function(b){a.fov=b}})}}var p=r.vec3d,h=r.vec4d,l=h.create();return B.createSubclass({declaredClass:"esri.views.3d.navigation.planar.AnimationPlanar",constructor:function(){this.interpolationTypes=
{linear:c,easeInOut:t}}})})},"esri/views/3d/navigation/planar/actions/PanPlanar":function(){define(["./ActionPlanar","../../mixins/PanMixin","../../../lib/glMatrix","../../../webgl-engine/lib/Util"],function(B,r,f,a){var b=f.vec2d,c=f.vec3d,t=c.create(),p=c.create(),h=c.create(),l=c.create(),q=c.create(),y=c.create(),z=Math.PI/9,w=c.create(),u=c.create();return B.createSubclass([r],{declaredClass:"esri.views.3d.navigation.planar.actions.PanPlanar",begin:function(a){this.inherited(arguments);this.pickPointInScreen(a,
t)||this.pickFreePointInScreen(a,t);c.normalize(c.subtract(this.targetCamera.eye,this.targetCamera.center,p));this.renderCoordsHelper.worldUpAtPosition(a,y);var f=c.dot(p,y);0>f&&(c.negate(p),f=-f);var l=Math.asin(f);l>=z?c.set(y,p):(c.subtract(p,c.scale(y,f,h)),c.normalize(p),l>z&&(c.lerp(p,y,(l-z)/(z-z)),c.normalize(p)));this.updatePlane(t,p);b.set(a,this._dragLastPoint);b.set(a,this._dragBeginPoint)},update:function(a){this._intersectPanPlane(this._dragLastPoint,this._dragBeginPoint,w)&&this._intersectPanPlane(a,
this._dragBeginPoint,u)&&(c.subtract(u,w),c.subtract(this.targetCamera.eye,u),c.subtract(this.targetCamera.center,u),b.set(a,this._dragLastPoint),this.constrainTargetEyeByElevationAndMoveLookAt(),this.targetAndCurrentChanged())},_intersectPanPlane:function(b,h,f){this.createPickRay(b,h,this.currentCamera.viewMatrix,l,q);c.subtract(q,l);return a.rayPlane(l,q,this._plane,f)},end:function(a){this.setPoiAuto(a,!0);this._navSphereRadius=0;this.inherited(arguments)}})})},"esri/views/3d/navigation/planar/actions/ActionPlanar":function(){define(["../../Action",
"../../../lib/glMatrix"],function(B,r){var f=r.vec3d,a=r.vec4d;return B.createSubclass({declaredClass:"esri.views.3d.navigation.planar.actions.ActionPlanar",constructor:function(){this._plane=a.create()},updatePlane:function(b,c){a.set4(c[0],c[1],c[2],-f.dot(c,b),this._plane)}})})},"esri/views/3d/navigation/planar/actions/RotatePlanar":function(){define(["./ActionPlanar","../../mixins/RotateMixin"],function(B,r){return B.createSubclass([r],{declaredClass:"esri.views.3d.navigation.planar.actions.RotatePlanar"})})},
"esri/views/3d/navigation/planar/actions/ZoomPlanar":function(){define(["./ActionPlanar","../../mixins/ZoomMixin","../../../lib/glMatrix","../../../webgl-engine/lib/Util"],function(B,r,f,a){var b=f.vec2d,c=f.vec3d,t=c.create(),p=c.create(),h=c.create(),l=c.create(),q=c.create(),y=c.create();return B.createSubclass([r],{declaredClass:"esri.views.3d.navigation.planar.actions.ZoomPlanar",begin:function(a){this.inherited(arguments);this.pickPointInScreen(a,q)||this.pickFreePointInScreen(a,q);c.normalize(c.subtract(this.targetCamera.eye,
this.targetCamera.center,l));0>l[1]&&c.negate(l);this.updatePlane(q,l)},update:function(h){c.set(this.targetCamera.center,y);this.createPickRay(this._dragBeginPoint,this._dragBeginPoint,this.currentCamera.viewMatrix,t,p);c.subtract(p,t);a.rayPlane(t,p,this._plane,y);this.normalizeCoordinate(h,t);h=4*(this.normalizedAnchorPoint[1]-t[1]);b.set(t,this.normalizedAnchorPoint);this._applyZoom(y,h);h=this._toYDownCoord(this._dragLastPoint);this.emit("update",h[0],h[1])},_applyZoom:function(a,b){c.subtract(a,
this.targetCamera.eye,h);var f=c.length(h),l=f*(1-b);0<=b&&l<this.minPoiDist&&(l=this.minPoiDist);l=this.limitAltitude(l,a,h);1E-6>Math.abs(f-l)||(b=-(l-f)/f,c.scale(h,b),c.add(this.targetCamera.eye,h),c.lerp(this.targetCamera.center,a,b),this.fixTargetUpVector(),this.targetAndCurrentChanged())},stepAtPoint:function(a,b,f,l){c.set(b,y);c.subtract(y,this.targetCamera.eye,h);b=c.length(h);f=b*a;1>=a&&f<this.minPoiDist&&(f=this.minPoiDist);f=this.limitAltitude(f,y,h);a=f/b;1E-6<=Math.abs(b-f)&&(c.scale(h,
f/b),c.subtract(y,h,this.targetCamera.eye),c.lerp(this.targetCamera.center,y,1-a),this.constrainTargetEyeByElevation(),this.fixTargetUpVector(),this.targetAnimatedChanged(!1,{internalUpdate:!0}))}})})},"esri/views/3d/support/Frustum":function(){define(["../../../core/declare","../lib/glMatrix","../support/earthUtils","../webgl-engine/lib/Util"],function(B,r,f,a){var b=r.vec3d,c=r.vec4d;return B([],{constructor:function(){this.planes=Array(6);this.points=Array(8);this.lines=Array(12);this.origin=b.create();
this.direction=b.create();this.dirty=!1;this._altitude=null;for(var a=0;6>a;a++)this.planes[a]=c.create();for(a=0;8>a;a++)this.points[a]=b.create();for(a=0;12>a;a++)this.lines[a]={origin:null,direction:b.create(),endpoint:null}},_makeLine:function(a,c,h){a.origin=c;a.endpoint=h;b.direction(h,c,a.direction)},update:function(c){if(this.dirty){a.matrix2frustumPlanes(c.viewMatrix,c.projectionMatrix,this.points,this.planes);for(var f=0;4>f;f++){var h=f,l=f+4;this._makeLine(this.lines[f],this.points[h],
this.points[l]);this._makeLine(this.lines[f+4],this.points[h],3===f?this.points[0]:this.points[h+1]);this._makeLine(this.lines[f+8],this.points[l],3===f?this.points[4]:this.points[l+1])}b.set(c.eye,this.origin);b.set(c.viewForward,this.direction);this._altitude=null;this.dirty=!1}},altitude:function(){return null!=this._altitude?this._altitude:this._altitude=b.length(this.origin)-f.earthRadius}})})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI dojo/_base/lang".split(" "),
function(B,r,f,a,b,c,t){return function(c){function h(){return c.call(this)||this}f(h,c);h.prototype.getDefaults=function(){return t.mixin(this.inherited(arguments),{components:["attribution","zoom","navigation-toggle","compass"]})};return h=a([b.subclass("esri.views.ui.3d.DefaultUI3D")],h)}(b.declared(c))})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/promise/all dojo/errors/CancelError ../../../views/3d/support/ResourceController ../../../core/sql/WhereClause ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SIndexTraversal ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/i3s/IdleQueue ../../../layers/SceneLayer ../../../layers/IntegratedMeshLayer ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/Evented ../../../core/Promise ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/HandleRegistry ../../../views/3d/support/PromiseLightweight ../../../views/3d/support/projectionUtils ../../../views/3d/lib/glMatrix".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q){function S(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}var P=x.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");return function(n){function r(a){a=n.call(this)||this;a.nodeIndex={};a.screenSizeFactor=0;a.updating=!0;a.updatingPercentage=0;a._lodFactorProperty=null;a._isIdle=!1;a._computedMbs={};a._numNodesLoading=0;a._numAttributesLoading=0;a._progressMaxNumNodes=
1;a._poi=null;a._requiredAttributesDirty=!0;a._updatesDisabled=!1;a._restartNodeLoading=!1;a._handles=new J;a._idleQueue=new w.IdleQueue;return a}f(r,n);Object.defineProperty(r.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.registerClient(this.layerView,t.ClientType.SCENE,
{addUrlToken:this.addUrlToken,trackRequests:!0})},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer&&this.layer.definitionExpression)try{var a=p.create(this.layer.definitionExpression);if(!a.isStandardized())return P.error("definitionExpression is using non standard function"),null;var b=[],c=a.getFields();q.findFieldsCaseInsensitive(c,this.layer.fields,b);return 0<b.length?(P.error("definitionExpression references unknown fields: "+
b.join(", ")),null):a}catch(ca){return P.error("Failed to parse definitionExpression: "+ca),null}else return null},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var a=this.parsedDefinitionExpression.getFields();return q.findFieldsCaseInsensitive(a,this.layer.fields)}return null},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"crsVertex",{get:function(){return q.getVertexCrs(this.layer)},
enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"crsIndex",{get:function(){return q.getIndexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"rootNodeVisible",{get:function(){var a=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return a&&this._viewportQueries?this._viewportQueries.isNodeVisible(a):!0},enumerable:!0,configurable:!0});r.prototype.initialize=function(){var a=this;this.updateEventListener={needsUpdate:function(){return a._needsAnimationFrameHandler()},
idleFrame:function(b){return a._animationFrameHandler(b)},idleBegin:function(){a._startNodeLoading();a._updateIdleState(!0)},idleEnd:function(){a.cancelNodeLoading();a._updateIdleState(!1)}};this.updateEventListenerWhileSuspended={idleBegin:function(){return a._startNodeLoadingWhileSuspended()}};this._lodHandling=new y(this.layerViewRequiredFunctions,this.layerViewOptionalFunctions,function(){return a._evaluateUpdatingState()});this.layerView._controller=this;var c=this.layer;this._defaultGeometrySchema=
c.store.defaultGeometrySchema;this._fields=c.fields;this._attributeStorageInfo=c.attributeStorageInfo;this._rootNodeUrl=c.store.rootNode;c=this._rootNodeUrl.split("/");this._rootNodeId=c[c.length-1];this.layer instanceof u?"mesh"===this.layer.geometryType?this._lodFactorProperty="qualitySettings.sceneService.3dObject.lodFactor":"point"===this.layer.geometryType&&(this._lodFactorProperty="qualitySettings.sceneService.point.lodFactor"):this.layer instanceof C&&(this._lodFactorProperty="qualitySettings.sceneService.integratedMesh.lodFactor");
this._centerOnSurface=this.layerView.view.pointsOfInterest.centerOnSurfaceFrequent;c=b([this.layer,this.layerView]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){a.setClippingArea(a.layerView.view.clippingArea);var b=a.layerView.view.resourceController,c=!1;a._handles.add(K.init(a.layerView,"suspended",function(e){c&&b.deregisterIdleFrameWorker(a);e?b.registerIdleFrameWorker(a,a.updateEventListenerWhileSuspended):b.registerIdleFrameWorker(a,a.updateEventListener);c=!0}),"layerview");
var h=a.layerView.view.pointsOfInterest;a._handles.add([a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}),h.events.on("camera-parameters-changed",function(){return a.restartNodeLoading()})],"view");a._handles.add(a.layer.watch("elevationInfo",function(b){return a._elevationInfoChanged(b)}),"layer");a._lodFactorProperty&&a._handles.add(a.layerView.view.watch(a._lodFactorProperty,function(){return a._qualityChanged()}),"quality")}});this.addResolvingPromise(c)};
r.prototype.destroy=function(){this.layerView.view.resourceController.deregisterIdleFrameWorker(this);this.layerView.view.resourceController.deregisterClient(this.layerView);this._handles.destroy();this._nodeLoader=null};r.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields)return[];var a=Object.create(null);this.layer.renderer&&this.layer.renderer.collectRequiredFields(a);this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(b){b._collectRequiredFields(a)});
if(null!=this.definitionExpressionFields)for(var b=0,c=this.definitionExpressionFields;b<c.length;b++)a[c[b]]=!0;var h=this._attributeStorageInfo,f=this._fields,e=this.layer.objectIdField;return Object.keys(a).map(function(a){var b=S(h,a);a=S(f,a);return 0<=b&&0<=a?{index:b,name:f[a].name,field:f[a],attributeStorageInfo:h[b]}:null}).filter(function(a){return null!=a&&a.name!==e}).sort(function(a,b){return b.index-a.index}).filter(function(a,b,c){return 0===b||c[b-1].index!==a.index})};r.prototype._requiredFieldsChange=
function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};r.prototype._labelingChanged=function(){var a=this._requiredAttributes,b=this._getRequiredAttributes();a.length===b.length&&a.every(function(a){return 0<=S(b,a.name)})||this._requiredFieldsChange()};r.prototype.setClippingArea=function(a){var b=[];M.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null};r.prototype._qualityChanged=function(){this.restartNodeLoading()};
r.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._indexLoader&&this._indexLoader.updatePointOfInterest(this._poi))};r.prototype._calculatePointOfInterest=function(a){void 0===a&&(a=Q.vec3d.create());var b=Q.vec3d.create(),c=Q.vec3d.create(),h=this._centerOnSurface.renderLocation,f=this.layerView.view.renderCoordsHelper;Q.vec3d.subtract(h,this.camPos,b);Q.vec3d.normalize(b);f.worldUpAtPosition(h,c);b=Math.acos(Q.vec3d.dot(c,b))-.5*Math.PI;Q.vec3d.lerp(this.camPos,
h,Math.max(0,Math.min(1,b/(.5*Math.PI))),a);return a};r.prototype.updateClippingArea=function(a){this.setClippingArea(a);this.restartNodeLoading()};r.prototype.getBaseUrl=function(){return q.addTrailingSlash(this.layer.parsedUrl.path)};r.prototype.updateElevationChanged=function(a,b,c){q.findIntersectingNodes(a,b,this.nodeIndex.root,this.crsIndex,this.nodeIndex,c);for(a=0;a<c.length;a++)b=c.data[a],this._computedMbs[b.id]&&(this._computedMbs[b.id][3]=-1),b.id===this._rootNodeId&&this.notifyChange("rootNodeVisible");
c.length&&this.restartNodeLoading()};r.prototype._elevationInfoChanged=function(a){a=0;for(var b=Object.keys(this._computedMbs);a<b.length;a++)this._computedMbs[b[a]][3]=-1;this._initViewData()};r.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this._evaluateUpdatingState()};r.prototype.schedule=function(){return this._idleQueue.push()};r.prototype._needsAnimationFrameHandler=function(){return!0};r.prototype._animationFrameHandler=function(a){this._restartNodeLoading&&(this.cancelNodeLoading(),
this._startNodeLoading());if(null!=this._nodeLoader){var b=5-this._numNodesLoading;for(null!=this._indexLoader&&0<b&&this._indexLoader.continueTraversal(b);0<this._idleQueue.length()&&!a.done();)this._idleQueue.process();this._evaluateUpdatingState();this._lodHandling.lodGlobalHandling()}};r.prototype._evaluateUpdatingState=function(){var a=null!=this._indexLoader?this._indexLoader.getQueueSize()+3*this._numNodesLoading:0,b=!(!(0<a||0<this._numAttributesLoading||this._indexLoader&&this._indexLoader.isLoading()||
this._restartNodeLoading||0<this._idleQueue.length()||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===a&&(this._progressMaxNumNodes=1);this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);b!==this._get("updating")&&this._set("updating",b);a=100*a/this._progressMaxNumNodes;a!==this._get("updatingPercentage")&&this._set("updatingPercentage",a)};r.prototype._initViewData=function(){var a=this.layerView.view,b=a.navigation.currentCamera,c=a.renderCoordsHelper;
this.camPos=Q.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest();var h=this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||1;this._viewportQueries=new z(this._computedMbs,this.crsIndex,c,b,this._clippingArea,null!=this.layerViewOptionalFunctions.traversalOptions?this.layerViewOptionalFunctions.traversalOptions.errorMetricPreference:null,a.elevationProvider,this.layer.elevationInfo,{screenspaceErrorBias:h,
maxDistance:25E7,angleDependentLoD:.5>h});this.notifyChange("rootNodeVisible")};r.prototype._startNodeLoadingWhileSuspended=function(){var a=this;this._initViewData();this._removeInvisibleNodes(function(b){return a._viewportQueries.isNodeVisible(b)})};r.prototype._startNodeLoading=function(){var a=this;this._restartNodeLoading=!1;if(!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData();var b=this.layerViewOptionalFunctions.textureOptions,c=this.isMeshPyramid&&null!=this._defaultGeometrySchema&&
null!=this._defaultGeometrySchema.ordering;null!=this.layerViewOptionalFunctions.getLoadedAttributes&&this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1,this._handles.add([this.layer.watch("renderer",function(){return a._requiredFieldsChange()}),this.layer.watch("definitionExpression",function(){return a._requiredFieldsChange()}),this.layer.watch("labelsVisible",function(){return a._labelingChanged()}),this.layer.watch("labelingInfo",
function(){return a._labelingChanged()})],"requiredAttributes"));this._nodeLoader=new h(this.streamDataSupplier,null!=b?b.useCompressedTextures:!1,P,this._defaultGeometrySchema,this._requiredAttributes,c);this._indexLoader=new l(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,this._poi,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,function(b){return a._processNodeIndexDocument(b)},function(b){return a._lodHandling.finishedLevel(b)},P,this.layerViewOptionalFunctions.traversalOptions);
this._indexLoader.start();this._removeInvisibleNodes(function(b){return a._indexLoader.nodeIsVisible(b)});b=this.layerViewOptionalFunctions.traversalOptions;this._lodHandling.startNodeLoading(function(b){return a._indexLoader.nodeIsVisible(b)},function(b){return a._indexLoader.nodeTraversalState(b)},this.nodeIndex,this._rootNodeId,{mode:null!=b&&b.perLevelTraversal?"perLevel":"global",allowPartialOverlaps:!!b.allowPartialOverlaps});this.layerViewOptionalFunctions.additionalStartNodeLoadingHandler&&
this.layerViewOptionalFunctions.additionalStartNodeLoadingHandler();this._evaluateUpdatingState()}};r.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._indexLoader};r.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._indexLoader.cancel(),this._nodeLoader.cancel(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._numNodesLoading=0,this._indexLoader=this._nodeLoader=void 0,this._poi=null,this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler&&
this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler(),this._evaluateUpdatingState())};r.prototype._removeInvisibleNodes=function(a){for(var b={},c=this.layerViewRequiredFunctions.getAddedNodeIDs(),h=0;h<c.length;h++){var f=c[h],e=this.nodeIndex[f];this._isNodeVisibleWithParents(e,a)?b[f]=e:this._removeNodeData(e)}return b};r.prototype._isNodeVisibleWithParents=function(a,b){var c=a;do a=b(c),c=c.parentNode,c=null!=c?this.nodeIndex[c.id]:null;while(a&&null!=c);return a};r.prototype._removeNodeData=
function(a){this._lodHandling.setLodGlobalDirty();this.layerViewRequiredFunctions.removeNodeData(a)};r.prototype._processNodeIndexDocument=function(a){var b=this,c=new N.Promise;if(null!=a.featureData&&0<a.featureData.length)if(this.layerViewRequiredFunctions.areAllBundlesLoaded(a)){var h=this.layerViewOptionalFunctions.getLoadedAttributes,h=null!=h?h(a):void 0;null!=h&&h!==this._requiredAttributes&&(this._nodeLoader.loadAttributes(a,a.baseUrl,this._requiredAttributes).then(function(c){b.layerViewOptionalFunctions.setAttributeData(a,
b._requiredAttributes,c)}).otherwise(function(c){b.layerViewOptionalFunctions.setAttributeData(a,b._requiredAttributes,{})}).then(function(){b._numAttributesLoading--;b._evaluateUpdatingState()}),this._numAttributesLoading++,this._evaluateUpdatingState());this._lodHandling.shouldLoadNode(a)&&this._lodHandling.lodSwapBundleLoaded(a)}else if(this._lodHandling.shouldLoadNode(a)){if(this.layerViewRequiredFunctions.isOverMemory())return c.done(),c;for(var h=[],f=0;f<a.featureData.length;f++)this.layerViewRequiredFunctions.isBundleAlreadyAddedToStage(a,
f)||h.push(this._loadAndAddBundle(a,f));this._numNodesLoading++;this._evaluateUpdatingState();I.eachAlways(h).then(function(){b._numNodesLoading--;b._evaluateUpdatingState();c.done()});return c}c.done();return c};r.prototype._loadAndAddBundle=function(a,b){var h=this;return this._idleQueue.push().then(function(){return h._nodeLoader.loadBundleData(a,b)}).then(function(c){h._lodHandling.lodSwapBundleLoaded(a);return h._idleQueue.push().then(function(){return h.layerViewRequiredFunctions.addBundle(a,
b,c)})}).then(function(){if(null!=h.layerViewOptionalFunctions.setPolygonOffset){var b=h._lodHandling.shouldSetPolygonOffset(a);b&&h.layerViewOptionalFunctions.setPolygonOffset(a,b)}}).otherwise(function(h){h instanceof c||P.error("Failed to load node '"+a.id+"' bundle "+b+": "+h)})};r.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._evaluateUpdatingState())};a([E.property({readOnly:!0})],r.prototype,"isMeshPyramid",null);a([E.property({readOnly:!0})],r.prototype,"streamDataSupplier",
null);a([E.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],r.prototype,"parsedDefinitionExpression",null);a([E.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],r.prototype,"definitionExpressionFields",null);a([E.property({readOnly:!0})],r.prototype,"crsVertex",null);a([E.property({readOnly:!0})],r.prototype,"crsIndex",null);a([E.property({readOnly:!0})],r.prototype,"nodeIndex",void 0);a([E.property()],r.prototype,"camPos",void 0);a([E.property()],r.prototype,"screenSizeFactor",
void 0);a([E.property()],r.prototype,"layerView",void 0);a([E.property()],r.prototype,"layerViewRequiredFunctions",void 0);a([E.property()],r.prototype,"layerViewOptionalFunctions",void 0);a([E.property()],r.prototype,"layer",void 0);a([E.property()],r.prototype,"addUrlToken",void 0);a([E.property({readOnly:!0})],r.prototype,"updating",void 0);a([E.property({readOnly:!0})],r.prototype,"updatingPercentage",void 0);a([E.property({readOnly:!0})],r.prototype,"rootNodeVisible",null);return r=a([E.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],
r)}(E.declared(G,A,n))})},"esri/core/sql/WhereClause":function(){define(["require","exports","./WhereGrammar","../../moment","./StandardizedFunctions"],function(B,r,f,a,b){function c(a){return Array.isArray(a)?a:[a]}function t(a){return null!==a?!0!==a:null}function p(a,b){if(null==a)return null;for(var c=!1,h=0;h<b.length;h++){var f=b[h];if(null==f)c=null;else if(a===f){c=!0;break}}return c}function h(a,b,c){if(null==a)return null;for(var h="",f=0,l=0;l<b.length;l++){var n=b.charAt(l);switch(f){case 0:n===
c?f=1:h=0<="-[]/{}()*+?.\\^$|".indexOf(n)?h+("\\"+n):"%"===n?h+".*":"_"===n?h+".":h+n;break;case 1:h=0<="-[]/{}()*+?.\\^$|".indexOf(n)?h+("\\"+n):h+n,f=0}}return(new RegExp("^"+h+"$")).test(a)}function l(a){return a instanceof Date?a.valueOf():a}function q(a,b,c){if(null==b||null==c)return null;b=l(b);c=l(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function y(a){for(var b=
[],c={},h=0;h<a.length;h++){var f=a[h],l=f.toLowerCase();void 0===c[l]&&(b.push(f),c[l]=1)}return b}return function(){function r(){this.parameters=this.parseTree=null}r.create=function(a){var b=new r;b.parseTree=f.WhereGrammar.parse(a);return b};r.prototype.isStandardized=function(){var a=!0;this.visitAll(this.parseTree,function(c){a&&"function"===c.type&&(a=b.isStandardized(c.name,c.args.value.length))});return a};r.prototype.setVariablesDictionary=function(a){this.parameters=a};r.prototype.testFeature=
function(a){return!!this.evaluateNode(this.parseTree,a)};r.prototype.calculateValue=function(a){return this.evaluateNode(this.parseTree,a)};r.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return y(a)};r.prototype.getFields=function(){var a=[];this.visitAll(this.parseTree,function(b){"column_ref"===b.type&&a.push(b.column)});return y(a)};r.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,
function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return y(a)};r.prototype.featureValue=function(a,b,c){var h=a.attributes[b];if(void 0!==h)return h;for(var f in a.attributes)if(b.toLowerCase()===f.toLowerCase())return c.column=f,a.attributes[f];return null};r.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,h=a.clauses;c<h.length;c++){var f=h[c];this.visitAll(f,
b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)f=a[c],this.visitAll(f,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};r.prototype.evaluateNode=function(f,r){switch(f.type){case "case_expression":if("simple"===f.format)for(var u=l(this.evaluateNode(f.operand,r)),w=0;w<f.clauses.length;w++){if(u===
l(this.evaluateNode(f.clauses[w].operand,r)))return this.evaluateNode(f.clauses[w].value,r)}else for(w=0;w<f.clauses.length;w++)if(!0===this.evaluateNode(f.clauses[w].operand,r))return this.evaluateNode(f.clauses[w].value,r);return null!==f.else?this.evaluateNode(f.else,r):null;case "param":return this.parameters[f.value.toLowerCase()];case "expr_list":u=[];w=0;for(f=f.value;w<f.length;w++){var y=f[w];u.push(this.evaluateNode(y,r))}return u;case "unary_expr":return t(this.evaluateNode(f.expr,r));
case "binary_expr":switch(f.operator){case "AND":return u=this.evaluateNode(f.left,r),r=this.evaluateNode(f.right,r),null!=u&&null!=r?!0===u&&!0===r:!1===u||!1===r?!1:null;case "OR":return u=this.evaluateNode(f.left,r),r=this.evaluateNode(f.right,r),null!=u&&null!=r?!0===u||!0===r:!0===u||!0===r?!0:null;case "IS":if("null"!==f.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(f.left,r);case "ISNOT":if("null"!==f.right.type)throw Error("Unsupported RHS for IS");return null!==
this.evaluateNode(f.left,r);case "IN":return u=c(this.evaluateNode(f.right,r)),p(this.evaluateNode(f.left,r),u);case "NOT IN":return u=c(this.evaluateNode(f.right,r)),t(p(this.evaluateNode(f.left,r),u));case "BETWEEN":return u=this.evaluateNode(f.left,r),r=this.evaluateNode(f.right,r),null==u||null==r[0]||null==r[1]?null:u>=r[0]&&u<=r[1];case "NOTBETWEEN":return u=this.evaluateNode(f.left,r),r=this.evaluateNode(f.right,r),null==u||null==r[0]||null==r[1]?null:u<r[0]||u>r[1];case "LIKE":return h(this.evaluateNode(f.left,
r),this.evaluateNode(f.right,r),f.escape);case "NOT LIKE":return t(h(this.evaluateNode(f.left,r),this.evaluateNode(f.right,r),f.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return q(f.operator,this.evaluateNode(f.left,r),this.evaluateNode(f.right,r));case "*":return this.evaluateNode(f.left,r)*this.evaluateNode(f.right,r);case "-":return this.evaluateNode(f.left,r)-this.evaluateNode(f.right,r);case "+":return this.evaluateNode(f.left,r)+this.evaluateNode(f.right,
r);case "/":return this.evaluateNode(f.left,r)/this.evaluateNode(f.right,r)}throw Error("Not Supported Operator "+f.operator);case "null":case "bool":case "string":case "number":return f.value;case "date":return a(f.value,["YYYY-M-D"]).toDate();case "timestamp":return a(f.value,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate();case "column_ref":return"CURRENT_DATE"===f.column.toUpperCase()?(y=new Date,y.setHours(0,0,0,0),y):"CURRENT_TIMESTAMP"===f.column.toUpperCase()?
new Date:this.featureValue(r,f.column,f);case "function":return r=this.evaluateNode(f.args,r),b.evaluateFunction(f.name,r)}throw Error("Unsupported sql syntax "+f.type);};return r}()})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function a(){}a.parse=function(a){return f.parse(a)};return a}();r.WhereGrammar=B})},"esri/core/sql/sql92grammar":function(){define([],function(){function B(r,
f,a,b){this.message=r;this.expected=f;this.found=a;this.location=b;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,B)}(function(r,f){function a(){this.constructor=r}a.prototype=f.prototype;r.prototype=new a})(B,Error);B.buildMessage=function(r,f){function a(a){return a.charCodeAt(0).toString(16).toUpperCase()}function b(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,
"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}function c(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}var t={literal:function(a){return'"'+b(a.text)+'"'},"class":function(a){var b=
"",f;for(f=0;f<a.parts.length;f++)b+=a.parts[f]instanceof Array?c(a.parts[f][0])+"-"+c(a.parts[f][1]):c(a.parts[f]);return"["+(a.inverted?"^":"")+b+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),c;for(c=0;c<a.length;c++){var f=c,p;p=a[c];p=t[p.type](p);b[f]=p}b.sort();if(0<b.length){for(a=c=1;c<b.length;c++)b[c-1]!==b[c]&&(b[a]=b[c],a++);b.length=a}switch(b.length){case 1:return b[0];
case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(r)+" but "+(f?'"'+b(f)+'"':"end of input")+" found."};return{SyntaxError:B,parse:function(r,f){function a(a,b){return{type:"literal",text:a,ignoreCase:b}}function b(a,b,d){return{type:"class",parts:a,inverted:b,ignoreCase:d}}function c(a){var b=ab[a],d;if(!b){for(d=a-1;!ab[d];)d--;b=ab[d];for(b={line:b.line,column:b.column};d<a;)10===r.charCodeAt(d)?(b.line++,b.column=1):b.column++,d++;ab[a]=b}return b}
function t(a,b){var d=c(a),e=c(b);return{start:{offset:a,line:d.line,column:d.column},end:{offset:b,line:e.line,column:e.column}}}function p(a){H<Ba||(H>Ba&&(Ba=H,sb=[]),sb.push(a))}function h(){var a,b,d;a=H;b=Y();b!==F?(b=q(),b!==F?(d=Y(),d!==F?a=b:(H=a,a=F)):(H=a,a=F)):(H=a,a=F);return a}function l(){var a,b,d,c,e,g,h,f;a=H;b=q();if(b!==F){d=[];c=H;e=Y();e!==F?(g=ga(),g!==F?(h=Y(),h!==F?(f=q(),f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);for(;c!==F;)d.push(c),c=H,e=Y(),e!==F?
(g=ga(),g!==F?(h=Y(),h!==F?(f=q(),f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);if(d!==F){a={type:"expr_list"};b=[b];for(c=0;c<d.length;c++)b.push(d[c][3]);a.value=b}else H=a,a=F}else H=a,a=F;return a}function q(){var a,b,d,c,e,g,h,f;a=H;b=y();if(b!==F){d=[];c=H;e=Y();e!==F?(g=L(),g!==F?(h=Y(),h!==F?(f=y(),f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);for(;c!==F;)d.push(c),c=H,e=Y(),e!==F?(g=L(),g!==F?(h=Y(),h!==F?(f=y(),f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):
(H=c,c=F)):(H=c,c=F);d!==F?a=b=ta(b,d):(H=a,a=F)}else H=a,a=F;return a}function y(){var a,b,d,c,e,g,h,f;a=H;b=z();if(b!==F){d=[];c=H;e=Y();e!==F?(g=D(),g!==F?(h=Y(),h!==F?(f=z(),f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);for(;c!==F;)d.push(c),c=H,e=Y(),e!==F?(g=D(),g!==F?(h=Y(),h!==F?(f=z(),f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);d!==F?a=b=ta(b,d):(H=a,a=F)}else H=a,a=F;return a}function z(){var a,b,d,c,e;a=H;b=v();b===F&&(b=H,33===r.charCodeAt(H)?(d=ya,
H++):(d=F,0===X&&p(ra)),d!==F?(c=H,X++,61===r.charCodeAt(H)?(e=Aa,H++):(e=F,0===X&&p(qa)),X--,e===F?c=void 0:(H=c,c=F),c!==F?b=d=[d,c]:(H=b,b=F)):(H=b,b=F));b!==F?(d=Y(),d!==F?(c=z(),c!==F?a=b={type:"unary_expr",operator:"NOT",expr:c}:(H=a,a=F)):(H=a,a=F)):(H=a,a=F);if(a===F)if(a=H,b=E(),b!==F)if(d=Y(),d!==F){var h,f,k;d=[];c=H;e=Y();e!==F?(h=w(),h!==F?(f=Y(),f!==F?(k=E(),k!==F?c=e=[e,h,f,k]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);if(c!==F)for(;c!==F;)d.push(c),c=H,e=Y(),e!==F?(h=w(),h!==F?(f=
Y(),f!==F?(k=E(),k!==F?c=e=[e,h,f,k]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);else d=F;d!==F&&(d={type:"arithmetic",tail:d});d===F&&(d=H,c=C(),c!==F?(e=Y(),e!==F?(e=ma(),e!==F?(e=Y(),e!==F?(e=l(),e!==F?(h=Y(),h!==F?(h=fa(),h!==F?d=c={op:c,right:e}:(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F),d===F&&(d=H,c=C(),c!==F?(e=Y(),e!==F?(e=ma(),e!==F?(e=Y(),e!==F?(e=fa(),e!==F?d=c={op:c,right:{type:"expr_list",value:[]}}:(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F),
d===F&&(d=H,c=C(),c!==F?(e=Y(),e!==F?(e=M(),e!==F?d=c={op:c,right:e}:(H=d,d=F)):(H=d,d=F)):(H=d,d=F))),d===F&&(d=H,e=v(),e!==F?(c=Y(),c!==F?(c=R(),c!==F?(h=Y(),h!==F?(h=E(),h!==F?(f=Y(),f!==F?(f=D(),f!==F?(e=Y(),e!==F?(e=E(),e!==F?d=e={op:"NOT"+c,right:{type:"expr_list",value:[h,e]}}:(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F),d===F&&(d=H,e=R(),e!==F?(c=Y(),c!==F?(c=E(),c!==F?(h=Y(),h!==F?(h=D(),h!==F?(f=Y(),f!==F?(f=E(),f!==F?d=e={op:e,right:{type:"expr_list",
value:[c,f]}}:(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)),d===F&&(d=H,c=g(),c!==F?(e=Y(),e!==F?(e=v(),e!==F?(e=Y(),e!==F?(e=E(),e!==F?d=c={op:c+"NOT",right:e}:(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F),d===F&&(d=H,c=g(),c!==F?(e=Y(),e!==F?(e=E(),e!==F?d=c={op:c,right:e}:(H=d,d=F)):(H=d,d=F)):(H=d,d=F)),d===F&&(d=H,c=u(),c!==F?(e=Y(),e!==F?(e=S(),e!==F?(h=Y(),h!==F?(h=H,r.substr(H,6).toLowerCase()===ed?(f=r.substr(H,6),H+=6):(f=F,0===X&&p(fd)),f!==F?(f=H,
X++,k=J(),X--,k===F?f=void 0:(H=f,f=F),f!==F?h="ESCAPE":(H=h,h=F)):(H=h,h=F),h!==F?(h=Y(),h!==F?(h=P(),h!==F?d=c={op:c,right:e,escape:h.value}:(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F)):(H=d,d=F),d===F&&(d=H,c=u(),c!==F?(e=Y(),e!==F?(e=S(),e!==F?d=c={op:c,right:e,escape:""}:(H=d,d=F)):(H=d,d=F)):(H=d,d=F))))));d===F&&(d=null);d!==F?(a=b,b=d,""==b||void 0==b||null==b?b=a:(d=null,b=d="arithmetic"==b.type?ta(a,b.tail):oa(b.op,a,b.right,b.escape)),a=b):(H=a,a=F)}else H=a,a=F;else H=
a,a=F;return a}function w(){var a;r.substr(H,2)===da?(a=da,H+=2):(a=F,0===X&&p(Ga));a===F&&(62===r.charCodeAt(H)?(a=za,H++):(a=F,0===X&&p(Da)),a===F&&(r.substr(H,2)===Fa?(a=Fa,H+=2):(a=F,0===X&&p(Qa)),a===F&&(r.substr(H,2)===Wa?(a=Wa,H+=2):(a=F,0===X&&p(Ta)),a===F&&(60===r.charCodeAt(H)?(a=Ha,H++):(a=F,0===X&&p(Xa)),a===F&&(61===r.charCodeAt(H)?(a=Aa,H++):(a=F,0===X&&p(qa)),a===F&&(r.substr(H,2)===Ya?(a=Ya,H+=2):(a=F,0===X&&p(pa))))))));return a}function u(){var a,b,d,c;a=a=H;b=v();b!==F?(d=Y(),d!==
F?(c=m(),c!==F?a=b=[b,d,c]:(H=a,a=F)):(H=a,a=F)):(H=a,a=F);a!==F&&(a=a[0]+" "+a[2]);a===F&&(a=m());return a}function C(){var a,b,c,e;a=a=H;b=v();b!==F?(c=Y(),c!==F?(e=d(),e!==F?a=b=[b,c,e]:(H=a,a=F)):(H=a,a=F)):(H=a,a=F);a!==F&&(a=a[0]+" "+a[2]);a===F&&(a=d());return a}function E(){var a,b,d,c,e,g,h,f;a=H;b=n();if(b!==F){d=[];c=H;e=Y();e!==F?(g=G(),g!==F?(h=Y(),h!==F?(f=n(),f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);for(;c!==F;)d.push(c),c=H,e=Y(),e!==F?(g=G(),g!==F?(h=Y(),h!==
F?(f=n(),f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);d!==F?a=b=ta(b,d):(H=a,a=F)}else H=a,a=F;return a}function G(){var a;43===r.charCodeAt(H)?(a=Ra,H++):(a=F,0===X&&p(Ua));a===F&&(45===r.charCodeAt(H)?(a=Za,H++):(a=F,0===X&&p(ka)));return a}function n(){var a,b,d,c,e,g,h,f;a=H;b=x();if(b!==F){d=[];c=H;e=Y();e!==F?(g=A(),g!==F?(h=Y(),h!==F?(f=x(),f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);for(;c!==F;)d.push(c),c=H,e=Y(),e!==F?(g=A(),g!==F?(h=Y(),h!==F?(f=x(),
f!==F?c=e=[e,g,h,f]:(H=c,c=F)):(H=c,c=F)):(H=c,c=F)):(H=c,c=F);d!==F?a=b=ta(b,d):(H=a,a=F)}else H=a,a=F;return a}function A(){var a;42===r.charCodeAt(H)?(a=Ia,H++):(a=F,0===X&&p(Ja));a===F&&(47===r.charCodeAt(H)?(a=Ka,H++):(a=F,0===X&&p(Sa)));return a}function x(){var a,b,c,e,g,h,f;f=P();if(f===F){var m,n,u,t;m=H;var v,w,x,y;v=H;w=W();w!==F?(x=k(),x!==F?(y=ca(),y!==F?v=w=parseFloat(w+x+y):(H=v,v=F)):(H=v,v=F)):(H=v,v=F);v===F&&(v=H,w=W(),w!==F?(x=k(),x!==F?v=w=parseFloat(w+x):(H=v,v=F)):(H=v,v=F),
v===F&&(v=H,w=W(),w!==F?(x=ca(),x!==F?v=w=parseFloat(w+x):(H=v,v=F)):(H=v,v=F),v===F&&(v=H,w=W(),w!==F&&(w=parseFloat(w)),v=w)));n=v;n!==F?(u=H,X++,t=K(),X--,t===F?u=void 0:(H=u,u=F),u!==F?m=n={type:"number",value:n}:(H=m,m=F)):(H=m,m=F);f=m;if(f===F){var z,A;z=H;var C,E,B,D;C=H;r.substr(H,4).toLowerCase()===gd?(E=r.substr(H,4),H+=4):(E=F,0===X&&p(hd));E!==F?(B=H,X++,D=J(),X--,D===F?B=void 0:(H=B,B=F),B!==F?C=E=[E,B]:(H=C,C=F)):(H=C,C=F);A=C;A!==F&&(A={type:"bool",value:!0});z=A;if(z===F){z=H;var G,
Qa,L,Wa;G=H;r.substr(H,5).toLowerCase()===id?(Qa=r.substr(H,5),H+=5):(Qa=F,0===X&&p(jd));Qa!==F?(L=H,X++,Wa=J(),X--,Wa===F?L=void 0:(H=L,L=F),L!==F?G=Qa=[Qa,L]:(H=G,G=F)):(H=G,G=F);A=G;A!==F&&(A={type:"bool",value:!1});z=A}f=z;if(f===F){var wa,V,oa,R,Ta;V=H;r.substr(H,4).toLowerCase()===kd?(oa=r.substr(H,4),H+=4):(oa=F,0===X&&p(ld));oa!==F?(R=H,X++,Ta=J(),X--,Ta===F?R=void 0:(H=R,R=F),R!==F?V=oa=[oa,R]:(H=V,V=F)):(H=V,V=F);wa=V;wa!==F&&(wa={type:"null",value:null});f=wa;if(f===F){var ta,la,da,ua;
ta=H;var Ha,ra,ea,ya;Ha=H;r.substr(H,4).toLowerCase()===md?(ra=r.substr(H,4),H+=4):(ra=F,0===X&&p(nd));ra!==F?(ea=H,X++,ya=J(),X--,ya===F?ea=void 0:(H=ea,ea=F),ea!==F?Ha=ra="DATE":(H=Ha,Ha=F)):(H=Ha,Ha=F);la=Ha;la!==F?(da=Y(),da!==F?(ua=S(),ua!==F?ta=la={type:"date",value:ua.value}:(H=ta,ta=F)):(H=ta,ta=F)):(H=ta,ta=F);f=ta;if(f===F){var ga,Xa,za,Ya;ga=H;var qa,ka,ha,Da;qa=H;r.substr(H,9).toLowerCase()===od?(ka=r.substr(H,9),H+=9):(ka=F,0===X&&p(pd));ka!==F?(ha=H,X++,Da=J(),X--,Da===F?ha=void 0:(H=
ha,ha=F),ha!==F?qa=ka="TIMESTAMP":(H=qa,qa=F)):(H=qa,qa=F);Xa=qa;Xa!==F?(za=Y(),za!==F?(Ya=S(),Ya!==F?ga=Xa={type:"timestamp",value:Ya.value}:(H=ga,ga=F)):(H=ga,ga=F)):(H=ga,ga=F);f=ga}}}}}a=f;if(a===F){var pa,Aa,Ga,Ua,Ka,Fa,Ra,Sa,Ia,Za,Ja,Ub;pa=H;var Ba,$a,db,Tb;Ba=H;r.substr(H,7).toLowerCase()===qd?($a=r.substr(H,7),H+=7):($a=F,0===X&&p(rd));$a!==F?(db=H,X++,Tb=J(),X--,Tb===F?db=void 0:(H=db,db=F),db!==F?Ba=$a="EXTRACT":(H=Ba,Ba=F)):(H=Ba,Ba=F);Aa=Ba;if(Aa!==F)if(Ga=Y(),Ga!==F)if(Ua=ma(),Ua!==F)if(Ka=
Y(),Ka!==F){var La,gb,rb,Fb,Wb;gb=H;r.substr(H,4).toLowerCase()===sd?(rb=r.substr(H,4),H+=4):(rb=F,0===X&&p(td));rb!==F?(Fb=H,X++,Wb=J(),X--,Wb===F?Fb=void 0:(H=Fb,Fb=F),Fb!==F?gb=rb="YEAR":(H=gb,gb=F)):(H=gb,gb=F);La=gb;if(La===F){var hb,eb,Gb,fb;hb=H;r.substr(H,5).toLowerCase()===ud?(eb=r.substr(H,5),H+=5):(eb=F,0===X&&p(vd));eb!==F?(Gb=H,X++,fb=J(),X--,fb===F?Gb=void 0:(H=Gb,Gb=F),Gb!==F?hb=eb="MONTH":(H=hb,hb=F)):(H=hb,hb=F);La=hb;if(La===F){var ib,ab,Hb,qb;ib=H;r.substr(H,3).toLowerCase()===
wd?(ab=r.substr(H,3),H+=3):(ab=F,0===X&&p(xd));ab!==F?(Hb=H,X++,qb=J(),X--,qb===F?Hb=void 0:(H=Hb,Hb=F),Hb!==F?ib=ab="DAY":(H=ib,ib=F)):(H=ib,ib=F);La=ib;if(La===F){var jb,Yb,Ib,Vb;jb=H;r.substr(H,4).toLowerCase()===yd?(Yb=r.substr(H,4),H+=4):(Yb=F,0===X&&p(zd));Yb!==F?(Ib=H,X++,Vb=J(),X--,Vb===F?Ib=void 0:(H=Ib,Ib=F),Ib!==F?jb=Yb="HOUR":(H=jb,jb=F)):(H=jb,jb=F);La=jb;if(La===F){var kb,Zb,Jb,Xb;kb=H;r.substr(H,6).toLowerCase()===Ad?(Zb=r.substr(H,6),H+=6):(Zb=F,0===X&&p(Bd));Zb!==F?(Jb=H,X++,Xb=J(),
X--,Xb===F?Jb=void 0:(H=Jb,Jb=F),Jb!==F?kb=Zb="MINUTE":(H=kb,kb=F)):(H=kb,kb=F);La=kb;if(La===F){var lb,$b,Kb,sb;lb=H;r.substr(H,6).toLowerCase()===Cd?($b=r.substr(H,6),H+=6):($b=F,0===X&&p(Dd));$b!==F?(Kb=H,X++,sb=J(),X--,sb===F?Kb=void 0:(H=Kb,Kb=F),Kb!==F?lb=$b="SECOND":(H=lb,lb=F)):(H=lb,lb=F);La=lb}}}}}Fa=La;Fa!==F?(Ra=Y(),Ra!==F?(Sa=Z(),Sa!==F?(Ia=Y(),Ia!==F?(Za=q(),Za!==F?(Ja=Y(),Ja!==F?(Ub=fa(),Ub!==F?pa=Aa={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:Fa},
Za]}}:(H=pa,pa=F)):(H=pa,pa=F)):(H=pa,pa=F)):(H=pa,pa=F)):(H=pa,pa=F)):(H=pa,pa=F)):(H=pa,pa=F)}else H=pa,pa=F;else H=pa,pa=F;else H=pa,pa=F;else H=pa,pa=F;a=pa;if(a===F){var va,sc,Ab,Bb,Cb,ac,Db,Eb,Bc,bc,Cc,Ea,tb,tc,uc,vc;va=H;var mb,cc,Lb,Dc;mb=H;r.substr(H,9).toLowerCase()===Ed?(cc=r.substr(H,9),H+=9):(cc=F,0===X&&p(Fd));cc!==F?(Lb=H,X++,Dc=J(),X--,Dc===F?Lb=void 0:(H=Lb,Lb=F),Lb!==F?mb=cc="SUBSTRING":(H=mb,mb=F)):(H=mb,mb=F);sc=mb;if(sc!==F)if(Ab=Y(),Ab!==F)if(Bb=ma(),Bb!==F)if(Cb=Y(),Cb!==F)if(ac=
q(),ac!==F)if(Db=Y(),Db!==F)if(Eb=Z(),Eb!==F)if(Bc=Y(),Bc!==F)if(bc=q(),bc!==F)if(Cc=Y(),Cc!==F){Ea=H;var nb,dc,Mb,Ec;nb=H;r.substr(H,3).toLowerCase()===Gd?(dc=r.substr(H,3),H+=3):(dc=F,0===X&&p(Hd));dc!==F?(Mb=H,X++,Ec=J(),X--,Ec===F?Mb=void 0:(H=Mb,Mb=F),Mb!==F?nb=dc="FOR":(H=nb,nb=F)):(H=nb,nb=F);tb=nb;tb!==F?(tc=Y(),tc!==F?(uc=q(),uc!==F?(vc=Y(),vc!==F?Ea=tb=[tb,tc,uc,vc]:(H=Ea,Ea=F)):(H=Ea,Ea=F)):(H=Ea,Ea=F)):(H=Ea,Ea=F);Ea===F&&(Ea=null);Ea!==F?(tb=fa(),tb!==F?va=sc={type:"function",name:"substring",
args:{type:"expr_list",value:Ea?[ac,bc,Ea[2]]:[ac,bc]}}:(H=va,va=F)):(H=va,va=F)}else H=va,va=F;else H=va,va=F;else H=va,va=F;else H=va,va=F;else H=va,va=F;else H=va,va=F;else H=va,va=F;else H=va,va=F;else H=va,va=F;else H=va,va=F;a=va;if(a===F){var ia,ub,ec,fc,gc,Ma,hc,vb,ic,jc,Fc,wc,Gc,Hc;ia=H;ub=ba();ub!==F?(ec=Y(),ec!==F?(fc=ma(),fc!==F?(gc=Y(),gc!==F?(Ma=Q(),Ma===F&&(Ma=null),Ma!==F?(hc=Y(),hc!==F?(vb=q(),vb!==F?(ic=Y(),ic!==F?(jc=Z(),jc!==F?(Fc=Y(),Fc!==F?(wc=q(),wc!==F?(Gc=Y(),Gc!==F?(Hc=fa(),
Hc!==F?ia=ub={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Ma?"BOTH":Ma},vb,wc]}}:(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F);ia===F&&(ia=H,ub=ba(),ub!==F?(ec=Y(),ec!==F?(fc=ma(),fc!==F?(gc=Y(),gc!==F?(Ma=Q(),Ma===F&&(Ma=null),Ma!==F?(hc=Y(),hc!==F?(vb=q(),vb!==F?(ic=Y(),ic!==F?(jc=fa(),jc!==F?ia=ub={type:"function",name:"trim",args:{type:"expr_list",
value:[{type:"string",value:null==Ma?"BOTH":Ma},vb]}}:(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F)):(H=ia,ia=F));a=ia;if(a===F){var xa,xc,Ic,Jc,Kc,yc,Lc,Mc,Nc,zc,Oc,Pc;xa=H;var ob,kc,Nb,Qc;ob=H;r.substr(H,8).toLowerCase()===Id?(kc=r.substr(H,8),H+=8):(kc=F,0===X&&p(Jd));kc!==F?(Nb=H,X++,Qc=J(),X--,Qc===F?Nb=void 0:(H=Nb,Nb=F),Nb!==F?ob=kc="POSITION":(H=ob,ob=F)):(H=ob,ob=F);xc=ob;xc!==F?(Ic=Y(),Ic!==F?(Jc=ma(),Jc!==F?(Kc=Y(),Kc!==F?(yc=q(),
yc!==F?(Lc=Y(),Lc!==F?(Mc=d(),Mc!==F?(Nc=Y(),Nc!==F?(zc=q(),zc!==F?(Oc=Y(),Oc!==F?(Pc=fa(),Pc!==F?xa=xc={type:"function",name:"position",args:{type:"expr_list",value:[yc,zc]}}:(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F)):(H=xa,xa=F);a=xa;if(a===F){var Ca,lc,Rc,Sc,Tc,wb,Uc,Vc;Ca=H;var Na,Ob,Pb,Va;Na=H;Na=Ob=I();if(Na===F)if(Na=H,96===r.charCodeAt(H)?(Ob=Wc,H++):(Ob=F,0===X&&p(Xc)),Ob!==F){Pb=[];Yc.test(r.charAt(H))?
(Va=r.charAt(H),H++):(Va=F,0===X&&p(Zc));if(Va!==F)for(;Va!==F;)Pb.push(Va),Yc.test(r.charAt(H))?(Va=r.charAt(H),H++):(Va=F,0===X&&p(Zc));else Pb=F;Pb!==F?(96===r.charCodeAt(H)?(Va=Wc,H++):(Va=F,0===X&&p(Xc)),Va!==F?Na=Ob=Pb.join(""):(H=Na,Na=F)):(H=Na,Na=F)}else H=Na,Na=F;lc=Na;lc!==F?(Rc=Y(),Rc!==F?(Sc=ma(),Sc!==F?(Tc=Y(),Tc!==F?(wb=l(),wb===F&&(wb=null),wb!==F?(Uc=Y(),Uc!==F?(Vc=fa(),Vc!==F?Ca=lc={type:"function",name:lc,args:wb?wb:{type:"expr_list",value:[]}}:(H=Ca,Ca=F)):(H=Ca,Ca=F)):(H=Ca,Ca=
F)):(H=Ca,Ca=F)):(H=Ca,Ca=F)):(H=Ca,Ca=F)):(H=Ca,Ca=F);a=Ca;if(a===F){var mc,na,xb,nc,yb,oc,bb,Oa,Qb,$c,ad;na=H;xb=ja();if(xb!==F)if(nc=Y(),nc!==F)if(yb=q(),yb!==F)if(oc=Y(),oc!==F){bb=[];for(Oa=T();Oa!==F;)bb.push(Oa),Oa=T();bb!==F?(Oa=Y(),Oa!==F?(Qb=aa(),Qb!==F?na=xb={type:"case_expression",format:"simple",operand:yb,clauses:bb,else:null}:(H=na,na=F)):(H=na,na=F)):(H=na,na=F)}else H=na,na=F;else H=na,na=F;else H=na,na=F;else H=na,na=F;if(na===F)if(na=H,xb=ja(),xb!==F)if(nc=Y(),nc!==F)if(yb=q(),
yb!==F)if(oc=Y(),oc!==F){bb=[];for(Oa=T();Oa!==F;)bb.push(Oa),Oa=T();bb!==F?(Oa=Y(),Oa!==F?(Qb=U(),Qb!==F?($c=Y(),$c!==F?(ad=aa(),ad!==F?na=xb={type:"case_expression",format:"simple",operand:yb,clauses:bb,else:Qb.value}:(H=na,na=F)):(H=na,na=F)):(H=na,na=F)):(H=na,na=F)):(H=na,na=F)}else H=na,na=F;else H=na,na=F;else H=na,na=F;else H=na,na=F;mc=na;if(mc===F){var sa,zb,pc,cb,Pa,Rb,bd,cd;sa=H;zb=ja();if(zb!==F)if(pc=Y(),pc!==F){cb=[];for(Pa=O();Pa!==F;)cb.push(Pa),Pa=O();cb!==F?(Pa=Y(),Pa!==F?(Rb=aa(),
Rb!==F?sa=zb={type:"case_expression",format:"searched",clauses:cb,else:null}:(H=sa,sa=F)):(H=sa,sa=F)):(H=sa,sa=F)}else H=sa,sa=F;else H=sa,sa=F;if(sa===F)if(sa=H,zb=ja(),zb!==F)if(pc=Y(),pc!==F){cb=[];for(Pa=O();Pa!==F;)cb.push(Pa),Pa=O();cb!==F?(Pa=Y(),Pa!==F?(Rb=U(),Rb!==F?(bd=Y(),bd!==F?(cd=aa(),cd!==F?sa=zb={type:"case_expression",format:"searched",clauses:cb,else:Rb.value}:(H=sa,sa=F)):(H=sa,sa=F)):(H=sa,sa=F)):(H=sa,sa=F)):(H=sa,sa=F)}else H=sa,sa=F;else H=sa,sa=F;mc=sa}a=mc;if(a===F){var Sb,
pb,Ac,qc,rc;pb=H;Ac=K();if(Ac!==F){qc=[];for(rc=N();rc!==F;)qc.push(rc),rc=N();qc!==F?pb=Ac+=qc.join(""):(H=pb,pb=F)}else H=pb,pb=F;Sb=pb;Sb!==F&&(Sb={type:"column_ref",table:"",column:Sb});a=Sb;a===F&&(a=M(),a===F&&(a=H,b=ma(),b!==F?(c=Y(),c!==F?(e=q(),e!==F?(g=Y(),g!==F?(h=fa(),h!==F?(e.paren=!0,a=b=e):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)))}}}}}}}return a}function I(){var a,b,d,c;a=H;b=K();if(b!==F){d=[];for(c=J();c!==F;)d.push(c),c=J();d!==F?a=b+=d.join(""):(H=a,a=F)}else H=a,
a=F;return a}function K(){var a;$a.test(r.charAt(H))?(a=r.charAt(H),H++):(a=F,0===X&&p(Tb));return a}function J(){var a;Ub.test(r.charAt(H))?(a=r.charAt(H),H++):(a=F,0===X&&p(rb));return a}function N(){var a;Vb.test(r.charAt(H))?(a=r.charAt(H),H++):(a=F,0===X&&p(Wb));return a}function M(){var a,b,d;a=H;64===r.charCodeAt(H)?(b=db,H++):(b=F,0===X&&p(Xb));b!==F?(d=I(),d!==F?a=b=[b,d]:(H=a,a=F)):(H=a,a=F);a!==F&&(a={type:"param",value:a[1]});return a}function Q(){var a,b,d;a=H;r.substr(H,7).toLowerCase()===
Kd?(b=r.substr(H,7),H+=7):(b=F,0===X&&p(Ld));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="LEADING":(H=a,a=F)):(H=a,a=F);a===F&&(a=H,r.substr(H,8).toLowerCase()===Md?(b=r.substr(H,8),H+=8):(b=F,0===X&&p(Nd)),b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="TRAILING":(H=a,a=F)):(H=a,a=F),a===F&&(a=H,r.substr(H,4).toLowerCase()===Od?(b=r.substr(H,4),H+=4):(b=F,0===X&&p(Pd)),b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="BOTH":(H=a,a=F)):(H=a,a=F)));return a}function S(){var a;
a=P();a===F&&(a=M());return a}function P(){var a,b,d;a=H;39===r.charCodeAt(H)?(b=eb,H++):(b=F,0===X&&p(Ab));b===F&&(r.substr(H,2)===Bb?(b=Bb,H+=2):(b=F,0===X&&p(dd)));if(b!==F){b=[];d=H;r.substr(H,2)===fb?(d=fb,H+=2):(d=F,0===X&&p(Cb));d!==F&&(d="'");d===F&&(Db.test(r.charAt(H))?(d=r.charAt(H),H++):(d=F,0===X&&p(Eb)));for(;d!==F;)b.push(d),d=H,r.substr(H,2)===fb?(d=fb,H+=2):(d=F,0===X&&p(Cb)),d!==F&&(d="'"),d===F&&(Db.test(r.charAt(H))?(d=r.charAt(H),H++):(d=F,0===X&&p(Eb)));b!==F?(39===r.charCodeAt(H)?
(d=eb,H++):(d=F,0===X&&p(Ab)),d!==F?a=b={type:"string",value:b.join("")}:(H=a,a=F)):(H=a,a=F)}else H=a,a=F;return a}function O(){var a,b,d;a=H;b=ea();b!==F?(b=Y(),b!==F?(b=q(),b!==F?(d=Y(),d!==F?(d=ha(),d!==F?(d=Y(),d!==F?(d=q(),d!==F?a=b={type:"when_clause",operand:b,value:d}:(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F);return a}function T(){var a,b,d;a=H;b=ea();b!==F?(b=Y(),b!==F?(b=q(),b!==F?(d=Y(),d!==F?(d=ha(),d!==F?(d=Y(),d!==F?(d=q(),d!==F?a=b={type:"when_clause",
operand:b,value:d}:(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F)):(H=a,a=F);return a}function U(){var a,b;a=H;var d,c;b=H;r.substr(H,4).toLowerCase()===Qd?(d=r.substr(H,4),H+=4):(d=F,0===X&&p(Rd));d!==F?(d=H,X++,c=J(),X--,c===F?d=void 0:(H=d,d=F),d!==F?b="ELSE":(H=b,b=F)):(H=b,b=F);b!==F?(b=Y(),b!==F?(b=q(),b!==F?a={type:"else_clause",value:b}:(H=a,a=F)):(H=a,a=F)):(H=a,a=F);return a}function W(){var a,b,d;a=V();a===F&&(a=H,45===r.charCodeAt(H)?(b=Za,H++):(b=F,0===X&&p(ka)),b===
F&&(43===r.charCodeAt(H)?(b=Ra,H++):(b=F,0===X&&p(Ua))),b!==F?(d=V(),d!==F?a=b=b[0]+d:(H=a,a=F)):(H=a,a=F));return a}function k(){var a,b;a=H;46===r.charCodeAt(H)?(b=Sd,H++):(b=F,0===X&&p(Td));b!==F?(b=V(),b===F&&(b=null),b!==F?a="."+(null!=b?b:""):(H=a,a=F)):(H=a,a=F);return a}function ca(){var a,b,d;b=a=H;Ud.test(r.charAt(H))?(d=r.charAt(H),H++):(d=F,0===X&&p(Vd));d!==F?(Wd.test(r.charAt(H))?(d=r.charAt(H),H++):(d=F,0===X&&p(Xd)),d===F&&(d=null),d!==F?b="e"+(null===d?"":d):(H=b,b=F)):(H=b,b=F);
b!==F?(d=V(),d!==F?a=b+d:(H=a,a=F)):(H=a,a=F);return a}function V(){var a,b;a=[];b=e();if(b!==F)for(;b!==F;)a.push(b),b=e();else a=F;a!==F&&(a=a.join(""));return a}function e(){var a;Yd.test(r.charAt(H))?(a=r.charAt(H),H++):(a=F,0===X&&p(Zd));return a}function d(){var a,b,d;a=H;r.substr(H,2).toLowerCase()===$d?(b=r.substr(H,2),H+=2):(b=F,0===X&&p(ae));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="IN":(H=a,a=F)):(H=a,a=F);return a}function g(){var a,b,d;a=H;r.substr(H,2).toLowerCase()===
be?(b=r.substr(H,2),H+=2):(b=F,0===X&&p(ce));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="IS":(H=a,a=F)):(H=a,a=F);return a}function m(){var a,b,d;a=H;r.substr(H,4).toLowerCase()===de?(b=r.substr(H,4),H+=4):(b=F,0===X&&p(ee));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="LIKE":(H=a,a=F)):(H=a,a=F);return a}function v(){var a,b,d;a=H;r.substr(H,3).toLowerCase()===fe?(b=r.substr(H,3),H+=3):(b=F,0===X&&p(ge));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="NOT":
(H=a,a=F)):(H=a,a=F);return a}function D(){var a,b,d;a=H;r.substr(H,3).toLowerCase()===he?(b=r.substr(H,3),H+=3):(b=F,0===X&&p(ie));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="AND":(H=a,a=F)):(H=a,a=F);return a}function L(){var a,b,d;a=H;r.substr(H,2).toLowerCase()===je?(b=r.substr(H,2),H+=2):(b=F,0===X&&p(ke));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="OR":(H=a,a=F)):(H=a,a=F);return a}function R(){var a,b,d;a=H;r.substr(H,7).toLowerCase()===le?(b=r.substr(H,7),H+=
7):(b=F,0===X&&p(me));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="BETWEEN":(H=a,a=F)):(H=a,a=F);return a}function Z(){var a,b,d;a=H;r.substr(H,4).toLowerCase()===ne?(b=r.substr(H,4),H+=4):(b=F,0===X&&p(oe));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="FROM":(H=a,a=F)):(H=a,a=F);return a}function ba(){var a,b,d;a=H;r.substr(H,4).toLowerCase()===pe?(b=r.substr(H,4),H+=4):(b=F,0===X&&p(qe));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="TRIM":(H=a,a=F)):(H=a,
a=F);return a}function ja(){var a,b,d;a=H;r.substr(H,4).toLowerCase()===re?(b=r.substr(H,4),H+=4):(b=F,0===X&&p(se));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="CASE":(H=a,a=F)):(H=a,a=F);return a}function aa(){var a,b,d;a=H;r.substr(H,3).toLowerCase()===te?(b=r.substr(H,3),H+=3):(b=F,0===X&&p(ue));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="END":(H=a,a=F)):(H=a,a=F);return a}function ea(){var a,b,d;a=H;r.substr(H,4).toLowerCase()===ve?(b=r.substr(H,4),H+=4):(b=F,0===
X&&p(we));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="WHEN":(H=a,a=F)):(H=a,a=F);return a}function ha(){var a,b,d;a=H;r.substr(H,4).toLowerCase()===xe?(b=r.substr(H,4),H+=4):(b=F,0===X&&p(ye));b!==F?(b=H,X++,d=J(),X--,d===F?b=void 0:(H=b,b=F),b!==F?a="THEN":(H=a,a=F)):(H=a,a=F);return a}function ga(){var a;44===r.charCodeAt(H)?(a=ze,H++):(a=F,0===X&&p(Ae));return a}function ma(){var a;40===r.charCodeAt(H)?(a=Be,H++):(a=F,0===X&&p(Ce));return a}function fa(){var a;41===r.charCodeAt(H)?
(a=De,H++):(a=F,0===X&&p(Ee));return a}function Y(){var a,b;a=[];for(b=wa();b!==F;)a.push(b),b=wa();return a}function wa(){var a;Fe.test(r.charAt(H))?(a=r.charAt(H),H++):(a=F,0===X&&p(Ge));return a}function oa(a,b,d,c){a={type:"binary_expr",operator:a,left:b,right:d};void 0!==c&&(a.escape=c);return a}function ta(a,b){for(var d=0;d<b.length;d++)a=oa(b[d][1],a,b[d][3]);return a}f=void 0!==f?f:{};var F={},la={start:h},ua=h,ya="!",ra=a("!",!1),Aa="\x3d",qa=a("\x3d",!1),da="\x3e\x3d",Ga=a("\x3e\x3d",!1),
za="\x3e",Da=a("\x3e",!1),Fa="\x3c\x3d",Qa=a("\x3c\x3d",!1),Wa="\x3c\x3e",Ta=a("\x3c\x3e",!1),Ha="\x3c",Xa=a("\x3c",!1),Ya="!\x3d",pa=a("!\x3d",!1),Ra="+",Ua=a("+",!1),Za="-",ka=a("-",!1),Ia="*",Ja=a("*",!1),Ka="/",Sa=a("/",!1),$a=/^[A-Za-z_\x80-\uFFFF]/,Tb=b([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Ub=/^[A-Za-z0-9_]/,rb=b([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Vb=/^[A-Za-z0-9_.\x80-\uFFFF]/,Wb=b([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),db="@",Xb=a("@",!1),
eb="'",Ab=a("'",!1),Bb="N'",dd=a("N'",!1),fb="''",Cb=a("''",!1),Db=/^[^']/,Eb=b(["'"],!0,!1),Sd=".",Td=a(".",!1),Yd=/^[0-9]/,Zd=b([["0","9"]],!1,!1),Ud=/^[eE]/,Vd=b(["e","E"],!1,!1),Wd=/^[+\-]/,Xd=b(["+","-"],!1,!1),kd="null",ld=a("NULL",!0),gd="true",hd=a("TRUE",!0),id="false",jd=a("FALSE",!0),$d="in",ae=a("IN",!0),be="is",ce=a("IS",!0),de="like",ee=a("LIKE",!0),ed="escape",fd=a("ESCAPE",!0),fe="not",ge=a("NOT",!0),he="and",ie=a("AND",!0),je="or",ke=a("OR",!0),le="between",me=a("BETWEEN",!0),ne=
"from",oe=a("FROM",!0),Gd="for",Hd=a("FOR",!0),Ed="substring",Fd=a("SUBSTRING",!0),qd="extract",rd=a("EXTRACT",!0),pe="trim",qe=a("TRIM",!0),Id="position",Jd=a("POSITION",!0),od="timestamp",pd=a("TIMESTAMP",!0),md="date",nd=a("DATE",!0),Kd="leading",Ld=a("LEADING",!0),Md="trailing",Nd=a("TRAILING",!0),Od="both",Pd=a("BOTH",!0),sd="year",td=a("YEAR",!0),ud="month",vd=a("MONTH",!0),wd="day",xd=a("DAY",!0),yd="hour",zd=a("HOUR",!0),Ad="minute",Bd=a("MINUTE",!0),Cd="second",Dd=a("SECOND",!0),re="case",
se=a("CASE",!0),te="end",ue=a("END",!0),ve="when",we=a("WHEN",!0),xe="then",ye=a("THEN",!0),Qd="else",Rd=a("ELSE",!0),ze=",",Ae=a(",",!1),Be="(",Ce=a("(",!1),De=")",Ee=a(")",!1),Fe=/^[ \t\n\r]/,Ge=b([" ","\t","\n","\r"],!1,!1),Wc="`",Xc=a("`",!1),Yc=/^[^`]/,Zc=b(["`"],!0,!1),H=0,ab=[{line:1,column:1}],Ba=0,sb=[],X=0,qb;if("startRule"in f){if(!(f.startRule in la))throw Error("Can't start parsing from rule \""+f.startRule+'".');ua=la[f.startRule]}qb=ua();if(qb!==F&&H===r.length)return qb;qb!==F&&H<
r.length&&p({type:"end"});throw function(a,b,d){return new B(B.buildMessage(a,b),a,b,d)}(sb,Ba<r.length?r.charAt(Ba):null,Ba<r.length?t(Ba,Ba+1):t(Ba,Ba));}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});r.evaluateFunction=function(b,c){var f=a[b.toLowerCase()];if(null==f)throw Error("Function Not Recognised");if(c.length<f.minParams||c.length>f.maxParams)throw Error("Invalid Parameter count for call to "+
b.toUpperCase());return f.evaluate(c)};r.isStandardized=function(b,c){b=a[b.toLowerCase()];return null!=b&&c>=b.minParams&&c<=b.maxParams};var a={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");
}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=a[0],f=a[1];return null==b||null==f?null:b.toString().substring(f-1)}if(3===a.length)return b=a[0],f=a[1],a=a[2],null==b||null==f||null==a?null:0>=a?"":b.toString().substring(f-1,f+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var b=3===a.length,r=b?a[1]:" ",b=b?a[2]:a[1];if(null==r||null==
b)return null;r="("+f.escapeString(r)+")";switch(a[0]){case "BOTH":return b.replace(new RegExp("^"+r+"*|"+r+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+r+"*","g"),"");case "TRAILING":return b.replace(new RegExp(r+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,
maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==
a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],
a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=a[0];a=2===a.length?Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?
a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",f=0;f<a.length;f++){if(null==a[f])return null;b+=a[f].toString()}return b}},lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports dojo/_base/lang dojo/Deferred dojo/promise/all dojo/errors/CancelError ../../webgl-engine/lib/Util ./I3SUtil ./I3SBinaryReader ../../../../core/promiseUtils ../../../../core/urlUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q){return function(){function r(a,b,c,h,f,p){this.useCompressedTextures=b;this.logger=c;this.defaultGeometrySchema=h;this.requiredAttributes=f;this.bypassFeatureData=p;this.loadShared=function(a){if(null==a.sharedResource)return l.resolve({});var b=q.makeAbsolute(a.sharedResource.href,a.baseUrl)+"/";return this.loadJSON(b).then(function(a){r.fixTextureEncodings(a);r.addAbsoluteHrefTexture(a,b);return a})};this.loader=a;this.cancelled=!1}r.prototype.cancel=function(){this.cancelled=
!0};r.prototype.loadJSON=function(b){var c=this.loader.request(b,"json"),h=new a;c.then(function(a,b){h.resolve(b)},function(a){h.reject(Error("Failed to load: "+b))});return h.promise};r.prototype.loadBinary=function(b){var c=this.loader.request(b,"binary"),h=new a;c.then(function(a,b){h.resolve(b)},function(a){h.reject(Error("Failed to load: "+b))});return h.promise};r.prototype.loadImage=function(b){var c=this.loader.request(b,"image"),h=new a;c.then(function(a,b){h.resolve(b)},function(a){h.reject(Error("Failed to load: "+
b))});return h.promise};r.prototype.loadAttribute=function(a,b,c){a=p.addTrailingSlash(q.makeAbsolute(c,a));return this.loadBinary(a).then(function(a){return h.readBinaryAttribute(b,a)})};r.prototype.loadAttributes=function(a,c,h){var f=this,p=h.map(function(b){return null==a.attributeData||null==a.attributeData[b.index]?(f.logger.error("Missing attributeData for '"+b.name+"' on node '"+a.id+"'"),l.resolve(null)):f.loadAttribute(c,b.attributeStorageInfo,a.attributeData[b.index].href).otherwise(function(c){f.logger.error("Failed to load attributeData for '"+
b.name+"' on node '"+a.id+"'");return null})});return b(p).then(function(a){for(var b={},c=0;c<h.length;++c)a[c]&&(b[h[c].name]=a[c]);return b})};r.prototype.prepareBinaryGeometryData=function(a,b,c,l){f.mixin(a.geometries[0].params,c);a.faceRanges=[[0,c.header.fields.vertexCount/3-1]];l||null!=c.vertexAttributes.region||delete c.vertexAttributes.region;if(null!=c.featureAttributes){l=c.featureAttributes;if(l.faceRange){a.faceRanges=[];for(var q=h.createTypedView(b,l.faceRange),r=l.faceRange.valuesPerElement,
n=c.header.fields.featureCount,u=0;u<n;u++)a.faceRanges[u]=[q[u*r],q[u*r+1]];a.componentOffsets=p.convertFlatRangesToOffsets(q,n,r)}if(l.id)for(a.featureIds=[],q=1,u=h.valueType2TypedArrayClassMap[l.id.valueType],"UInt64"===l.id.valueType&&(u=Uint32Array,q=2),b=new u(b,l.id.byteOffset,l.id.count*l.id.valuesPerElement*q),u=0;u<c.header.fields.featureCount;u++)if(a.featureIds[u]=b[u*l.id.valuesPerElement*q],2===q){r=b[u*l.id.valuesPerElement*q+1];if(2097150<=r)throw Error("ID exceeded maximum range supported by javascript (max \x3d 53bit-1 \x3d 9007199254740991)");
a.featureIds[u]+=4294967296*r}}};r.prototype.loadBundleData=function(a,c){var f=this,p=a.baseUrl,r={},t=this.loadShared(a),n=null;null!=this.requiredAttributes&&(n=this.loadAttributes(a,p,this.requiredAttributes));var w=null;if(null!=a.geometryData){var x=a.geometryData[c],p=q.makeAbsolute(x.href,p);x.hrefConcat=p;w=this.loadBinary(p)}return t.then(function(p){f.handleCancelled();return(f.bypassFeatureData?l.resolve(null):f.loadFeatureData(a,c)).then(function(q){f.handleCancelled();var u=f.bypassFeatureData?
f.meshPyramidGeometryData(a,p):f.collectGeometries(a,q,p);q=null!=w?w.then(function(b){r[a.geometryData[c].hrefConcat]=b;var l=Object.keys(p.materialDefinitions)[0],l=p.materialDefinitions[l].params.vertexRegions,n=h.createGeometryDataIndex(b,f.defaultGeometrySchema,l);f.prepareBinaryGeometryData(u[0],b,n,l);return u}):l.resolve(u);var t=f.loadTextures(u,p).then(function(a){for(var b={},c=0;c<a.length;c++){var h=a[c],f=h.i3sTexId;b[f]={i3sTexId:f,data:h.data,encoding:h.encoding}}return b});return b([t,
q,n])}).then(function(a){var b=a[0],c=a[1];a=a[2];f.handleCancelled();var h=null;a&&(h={attributeData:a,loadedAttributes:f.requiredAttributes});return{allGeometryData:c,attributeDataInfo:h,geometryBuffers:r,sharedResource:p,preloadedDomImages:b}})})};r.addAbsoluteHrefTexture=function(a,b){a=a.textureDefinitions;if(null!=a)for(var c=0,h=Object.keys(a);c<h.length;c++)for(var f=0,l=a[h[c]].images;f<l.length;f++){var n=l[f];Array.isArray(n.href)?n.hrefConcat=n.href.map(function(a){return q.makeAbsolute(a,
b)}):n.hrefConcat=q.makeAbsolute(n.href,b)}};r.fixTextureEncodings=function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var h=0;h<c.encoding.length;h++){var f=c.encoding[h];"data:"===f.substring(0,5)&&(c.encoding[h]=f.substring(5))}else f=c.encoding,"data:"===f.substring(0,5)&&(c.encoding=f.substring(5))}};r.prototype.loadTexture=function(a,b,c){var h=this;return c===p.DDS_ENCODING_STRING?this.loadBinary(a).then(function(a){h.handleCancelled();
return{i3sTexId:b,data:a,encoding:c}}):this.loadImage(a).then(function(a){h.handleCancelled();return{i3sTexId:b,data:a,encoding:c}})};r.prototype.loadTextures=function(a,c){for(var h=[],f=0;f<a.length;f++){var l=a[f].geometries;if(null!=l)for(var q=0;q<l.length;q++){var n=l[q].params.textureID||"none";if("none"!==n){null!=c.textureDefinitions&&null!=c.textureDefinitions[n]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+n);var r=c.textureDefinitions[n];t.assert(void 0!==
r,"geometry wants unknown texture "+n);if(0!==r.images.length){var w=r.images[r.images.length-1],y=p.getAppropriateTextureEncoding(r.encoding,this.useCompressedTextures),n=this.loadTexture(-1<y?w.hrefConcat[y]:w.hrefConcat,n,-1<y?r.encoding[y]:r.encoding);h.push(n)}}}}return b(h)};r.prototype.meshPyramidGeometryData=function(a,b){a=b.materialDefinitions?Object.keys(b.materialDefinitions)[0]:null;b=b.textureDefinitions?Object.keys(b.textureDefinitions)[0]:null;return[{featureIds:[],geometries:[{type:"ArrayBufferView",
params:{materialID:a,textureID:b}}],featureDataPosition:[0,0,0]}]};r.prototype.collectGeometries=function(a,b,c){a=[];c=0;for(b=b.featureData;c<b.length;c++){var h=b[c],f=h.geometries;if(null!=f)for(var l=0;l<f.length;l++){var n=h.geometries[l];a.push({featureIds:[h.id],featureDataPosition:h.position,geometries:[n],faceRanges:[n.params.faceRange]})}else null!=h.position&&a.push({featureIds:[h.id],featureDataPosition:h.position,geometries:null})}return a};r.prototype.loadFeatureData=function(a,b){a=
q.makeAbsolute(a.featureData[b].href,a.baseUrl);return this.loadJSON(a)};r.prototype.handleCancelled=function(){if(this.cancelled)throw new c;};return r}()})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports dojo/_base/lang dojo/promise/all ../../../../request ../../../../core/promiseUtils ../../../../core/Error ../../../../core/urlUtils ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Util ./I3SBinaryReader".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C){function E(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function G(a,b,c,h,f,e){if(null!=c){var d=P;z.mbsToMbs(c.mbs,h,d,b);if(0!==n(a,d)){e.push(c);for(var d=null!=c.children?c.children.length:0,g=0;g<d;g++)G(a,b,f[c.children[g].id],h,f,e)}}}function n(a,b){var c=b[0],h=b[1],f=b[2];b=b[3];var e=0;if(c<a[0])var d=a[0]-c,e=e+d*d;h<a[1]&&(d=a[1]-h,e+=d*d);f<a[2]&&(d=a[2]-f,e+=d*d);c>a[3]&&(d=c-a[3],e+=d*d);h>a[4]&&(d=h-a[4],e+=d*d);f>
a[5]&&(d=f-a[5],e+=d*d);if(e>b*b)return 0;if(0<e)return 1;e=Infinity;c-a[0]<e&&(e=c-a[0]);h-a[1]<e&&(e=h-a[1]);f-a[2]<e&&(e=f-a[2]);a[3]-c<e&&(e=a[3]-c);a[4]-h<e&&(e=a[4]-h);a[5]-f<e&&(e=a[5]-f);return e>b?2:1}function A(b,h,f){void 0===f&&(f=["*"]);if(null!=b.maxRecordCount&&h.length>b.maxRecordCount){var k=K(h,b.maxRecordCount);return a(k.map(function(a){return A(b,a,f)})).then(J)}k=new y({objectIds:h,outFields:f,orderByFields:[b.objectIdField]});return(new q(b.parsedUrl.path)).execute(k).then(function(a){return a&&
a.features&&a.features.length===h.length?a.features.map(function(a){return a.attributes}):c.reject(new t("scenelayer:feature-not-in-companion","Feature not found in companion feature layer"))})}function x(h,f,k,l,n){void 0===l&&(l=["*"]);var e=l.some(function(a){return"*"===a}),d=e?null:l.map(function(a){return a.toLowerCase()});return a(f.attributeData.map(function(a,k){var g=h[k].name.toLowerCase();if(!e&&!d.some(function(a){return g===a}))return c.resolve(null);a=p.makeAbsolute(a.href,f.baseUrl);
return b(a,{query:{token:n},responseType:"array-buffer"}).then(function(a){return C.readBinaryAttribute(h[k],a.data)}).otherwise(function(){return null})})).then(function(a){for(var b=[],d=0;d<k.length;d++){for(var c=k[d],e={},g=0;g<a.length;g++)null!=a[g]&&(e[h[g].name]=I(a[g],c));b.push(e)}return b})}function I(a,b){b=a[b];return a instanceof Int16Array?b===O?null:b:a instanceof Int32Array?b===T?null:b:b!==b?null:b}function K(a,b){var c=a.length;b=Math.ceil(c/b);for(var h=[],f=0;f<b;f++)h.push(a.slice(Math.floor(c*
f/b),Math.floor(c*(f+1)/b)));return h}function J(a){for(var b=[],c=0;c<a.length;c++)b=b.concat(a[c]);return b}function N(a){var b=new h(E(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function M(a){var b=new h(E(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function Q(a,b,c){if(!l.canProject(a,b))throw new t("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",
{});if("local"===c&&a.isGeographic)throw new t("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{});}function S(a,b,c){var h=N(a);a=M(a);Q(h,b,c);Q(a,b,c)}Object.defineProperty(r,"__esModule",{value:!0});r.DDS_ENCODING_STRING="image/vnd-ms.dds";r.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];r.addTrailingSlash=function(a){"/"!==a[a.length-1]&&(a+="/");return a};r.extractWkid=E;r.processNormals=function(a,b,c){switch(b){case "none":b=
a.normals;c=a.positions;var h=a.normalInd,f=a.positionInd;u.assert(a.normalInd.length===a.positionInd.length);a=w.vec3d.create();for(var e=w.vec3d.create(),d=0;d<f.length;d+=3){var g=3*f[d],k=c[g],l=c[g+1],n=c[g+2],g=3*f[d+1];a[0]=c[g]-k;a[1]=c[g+1]-l;a[2]=c[g+2]-n;g=3*f[d+2];e[0]=c[g]-k;e[1]=c[g+1]-l;e[2]=c[g+2]-n;w.vec3d.cross(a,e,a);w.vec3d.normalize(a);for(g=0;3>g;g++)k=3*h[d+g],b[k]=a[0],b[k+1]=a[1],b[k+2]=a[2]}break;case "east-north-up":break;case "earth-centered":c(a.normals,z.SphericalRenderSpatialReference);
break;case "vertex-reference-frame":break;default:throw Error("Received unexpected normalReferenceFrame: "+b);}};r.getAppropriateTextureEncoding=function(a,b){if(Array.isArray(a)){if(b&&(b=a.indexOf(r.DDS_ENCODING_STRING),-1<b))return b;for(b=0;b<a.length;b++)if(-1<r.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[b]))return b;throw Error("Could not find appropriate texture encoding (among "+a.toString()+")");}return-1};r.findIntersectingNodes=G;var P=w.vec4d.create();r.intersectBoundingBoxWithMbs=
n;r.findFieldsCaseInsensitive=function(a,b,c){for(var h=[],f=0;f<a.length;f++){for(var e=a[f],d=e.toLowerCase(),g=!1,k=0,l=b;k<l.length;k++){var n=l[k];if(d===n.name.toLowerCase()){h.push(n.name);g=!0;break}}g||void 0===c||c.push(e)}return h};r.whenGraphicAttributes=function(a,b,h,l,n){if(0===b.length)return c.resolve(b);var e=Object.keys(b[0].attributes).map(function(a){return a.toLowerCase()});l=l.filter(function(a){return 0>e.indexOf(a.toLowerCase())});if(0===l.length)return c.resolve(b);var d=
function(a){for(var d=0;d<b.length;d++)f.mixin(b[d].attributes,a[d]);return b},g=a.companionFeatureLayer,k=a.attributeStorageInfo;return g?(b.sort(function(a,b){return a.attributes[h]-b.attributes[h]}),a=b.map(function(a){return a.attributes[h]}),A(g,a,l).then(d)):k&&(n=n(),null!=n)?x(k,n.node,n.indices,l,a.token).then(d):c.reject(new t("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var O=-Math.pow(2,15),T=-Math.pow(2,31);r.getCachedAttributeValue=
I;r.convertFlatRangesToOffsets=function(a,b,c){void 0===c&&(c=2);b=null!=b?b:a.length/c;for(var h=new Uint32Array(b+1),f=0;f<b;f++){var e=a[f*c];h[f]=3*e;var d=(f-1)*c+1;if(0<=d&&e-1!==a[d])throw new t("Face ranges are not continuous");}h[h.length-1]=3*(a[(b-1)*c+1]+1);return h};r.getIndexCrs=N;r.getVertexCrs=M;r.checkSpatialReference=Q;r.checkSpatialReferences=S;r.checkSceneLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!!(null!=
a.geometryType&&"triangles"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new t("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{});};r.checkSceneLayerCompatibleWithView=function(a,b){S(a,b.spatialReference,b.viewingMode)};r.checkPointCloudLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,
b=!!(null==a.geometryType||"points"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null!=a.encoding&&""!==a.encoding&&"lepcc-xyz"!==a.encoding||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new t("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};r.checkPointCloudLayerCompatibleWithView=function(a,b){Q(a.spatialReference,b.spatialReference,b.viewingMode)};r.encodeSymbolColor=function(a,
b,c){null==a||"ignore"===b?(c[0]=255,c[1]=255,c[2]=255,c[3]=255):(c[0]=Math.floor(255*a[0]),c[1]=Math.floor(255*a[1]),c[2]=Math.floor(255*a[2]),a=Math.floor(85*a[3]),c[3]=0===a?0:"tint"===b?a:"replace"===b?a+85:a+170)}})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports dojo/_base/lang ../../../../core/Logger ../../../../core/Error ./LEPCC".split(" "),function(B,r,f,a,b,c){function t(a,c,h){for(var f="",l=0;l<h;){var n=a[c+l];if(128>n)f+=String.fromCharCode(n),l++;else if(192<=
n&&224>n){if(l+1>=h)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var p=a[c+l+1],n=(n&31)<<6|p&63,f=f+String.fromCharCode(n),l=l+2}else if(224<=n&&240>n){if(l+2>=h)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var p=a[c+l+1],q=a[c+l+2],n=(n&15)<<12|(p&63)<<6|q&63,f=f+String.fromCharCode(n),l=l+3}else if(240<=n&&248>n){if(l+3>=h)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");
p=a[c+l+1];q=a[c+l+2];n=(n&7)<<18|(p&63)<<12|(q&63)<<6|a[c+l+3]&63;f=65536<=n?f+String.fromCharCode((n-65536>>10)+55296,(n&1023)+56320):f+String.fromCharCode(n);l+=4}else throw new b("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return f}function p(a,b){for(var c={byteOffset:0,byteCount:0,fields:Object.create(null)},h=0,f=0;f<b.length;f++){var l=b[f],p=l.valueType||l.type;c.fields[l.property]=(0,r.valueType2ArrayBufferReader[p])(a,h);h+=r.valueType2TypedArrayClassMap[p].BYTES_PER_ELEMENT}c.byteCount=
h;return c}function h(a,c,h){var f=[],l,n=0,p;for(p=0;p<a;p+=1){l=c[p];if(0<l){if(f.push(t(h,n,l-1)),0!==h[n+l-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else f.push(null);n+=l}return f}function l(a,b){return new r.valueType2TypedArrayClassMap[b.valueType](a,b.byteOffset,b.count*b.valuesPerElement)}function q(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function y(a,c,h){a=null!=c.header?p(a,c.header):{byteOffset:0,byteCount:0,fields:{count:h}};
h={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)};for(var l=a.byteCount,n=0;n<c.ordering.length;n++){var q=c.ordering[n],r=f.clone(c[q]);r.count=a.fields.count;if("String"===r.valueType){if(r.byteOffset=l,r.byteCount=a.fields[q+"ByteCount"],"UTF-8"!==r.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:r.encoding});}else if(w(r.valueType)){var t=u(r.valueType),l=l+(0!==l%t?t-l%t:0);r.byteOffset=l;r.byteCount=t*r.valuesPerElement*r.count}else throw new b("unsupported-value-type",
"Unsupported binary valueType",{valueType:r.valueType});l+=r.byteCount;h.entries[q]=r}h.byteCount=l-h.byteOffset;return h}function z(a,c,h){c!==a&&C.error("Invalid "+h+" buffer size\n expected: "+a+", actual: "+c+")");if(c<a)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:c});}function w(a){return r.valueType2TypedArrayClassMap.hasOwnProperty(a)}function u(a){return w(a)&&r.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT}Object.defineProperty(r,"__esModule",
{value:!0});var C=a.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");r.readHeader=p;r.readStringArray=h;r.createTypedView=l;r.createRawView=q;r.createAttributeDataIndex=y;r.createGeometryDataIndex=function(a,b,c){var h=p(a,b.header),l=h.byteCount,n={header:h,byteOffset:h.byteCount,byteCount:0,vertexAttributes:f.clone(b.vertexAttributes)},q=n.vertexAttributes;c||null==q.region||delete q.region;var h=h.fields,r=null!=h.vertexCount?h.vertexCount:h.count;for(c=0;c<b.ordering.length;c++){var t=b.ordering[c];
null!=q[t]&&(q[t].byteOffset=l,q[t].count=r,l+=u(q[t].valueType)*q[t].valuesPerElement*r)}q=h.faceCount;if(b.faces&&q)for(n.faces=f.clone(b.faces),r=n.faces,c=0;c<b.ordering.length;c++)t=b.ordering[c],null!=r[t]&&(r[t].byteOffset=l,r[t].count=q,l+=u(r[t].valueType)*r[t].valuesPerElement*q);h=h.featureCount;if(b.featureAttributes&&b.featureAttributeOrder&&h)for(n.featureAttributes=f.clone(b.featureAttributes),q=n.featureAttributes,c=0;c<b.featureAttributeOrder.length;c++)r=b.featureAttributeOrder[c],
q[r].byteOffset=l,q[r].count=h,t=u(q[r].valueType),"UInt64"===q[r].valueType&&(t=8),l+=t*q[r].valuesPerElement*h;z(l,a.byteLength,"geometry");n.byteCount=l-n.byteOffset;return n};r.readBinaryAttribute=function(a,f,n){if("lepcc-rgb"===a.encoding)return c.decodeRGB(f);if("lepcc-intensity"===a.encoding)return c.decodeIntensity(f);if(null!=a.encoding&&""!==a.encoding)throw new b("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");a["attributeByteCounts "]&&!a.attributeByteCounts&&
(C.warn("Warning: Trailing space in 'attributeByteCounts '."),a.attributeByteCounts=a["attributeByteCounts "]);"ObjectIds"===a.ordering[0]&&a.hasOwnProperty("objectIds")&&(C.warn("Warning: Case error in objectIds"),a.ordering[0]="objectIds");n=y(f,a,n);z(n.byteOffset+n.byteCount,f.byteLength,"attribute");if(a=n.entries.attributeValues||n.entries.objectIds){if("String"===a.valueType){n=n.entries.attributeByteCounts;var p=l(f,n);f=q(f,a);return h(n.count,p,f)}return l(f,a)}throw new b("bad-attribute-storage-info",
"Bad attributeStorageInfo specification.");};r.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};r.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},
UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,0)).getInt32(b,!0)}};r.isValueType=w;r.getBytesPerValue=u})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports","../../../../core/Error"],function(B,r,f){function a(a,b,c){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,c+t.identifierOffset,
t.identifierLength)),version:b.getUint16(c+t.versionOffset,!0),checksum:b.getUint32(c+t.checksumOffset,!0)}}function b(a,b,f){var h=[];b=c(a,b,h);for(var l=[],p=0;p<h.length;p++){l.length=0;b=c(a,b,l);for(var r=0;r<l.length;r++)f.push(l[r]+h[p])}return b}function c(a,b,c){var h=new DataView(a,b),l=h.getUint8(0),p=l&31,r=!!(l&32),u=(l&192)>>6,l=0;if(0===u)l=h.getUint32(1,!0),b+=5;else if(1===u)l=h.getUint16(1,!0),b+=3;else if(2===u)l=h.getUint8(1),b+=2;else throw new f("lepcc-decode-error","Bad count type");
if(r)throw new f("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,b,Math.ceil(l*p/8));for(var u=r=h=0,t=-1>>>32-p,B=0;B<l;B++){for(;r<p;)h|=a[u]<<r,r+=8,u+=1;c[B]=h&t;h>>>=p;r-=p;32<r+p&&(h|=a[u-1]>>8-r)}return b+u}Object.defineProperty(r,"__esModule",{value:!0});var t={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};r.decodeXYZ=function(c){var h,l,p,r,z,w,u,C,B,G,n,A,x=new DataView(c,0),I=0;r=a(c,x,I);p=r.identifier;r=r.version;I+=t.byteCount;
if("LEPCC     "!==p)throw new f("lepcc-decode-error","Bad identifier");if(1<r)throw new f("lepcc-decode-error","Unknown version");var K=I;h=x.getUint32(K+0,!0);l=x.getUint32(K+4,!0);p=x.getFloat64(K+8,!0);r=x.getFloat64(K+16,!0);z=x.getFloat64(K+24,!0);w=x.getFloat64(K+32,!0);u=x.getFloat64(K+40,!0);C=x.getFloat64(K+48,!0);B=x.getFloat64(K+56,!0);G=x.getFloat64(K+64,!0);n=x.getFloat64(K+72,!0);A=x.getUint32(K+80,!0);x.getUint32(K+84,!0);I+=88;if(l*Math.pow(2,32)+h!==c.byteLength)throw new f("lepcc-decode-error",
"Bad size");x=new Float64Array(3*A);h=[];l=[];A=[];K=[];I=b(c,I,h);I=b(c,I,l);I=b(c,I,A);I=b(c,I,K);if(I!==c.byteLength)throw new f("lepcc-decode-error","Bad length");for(var J=I=c=0;J<h.length;J++)for(var I=I+h[J],N=0,M=0;M<l[J];M++){var N=N+A[c],Q=K[c];x[3*c]=Math.min(w,p+2*B*N);x[3*c+1]=Math.min(u,r+2*G*I);x[3*c+2]=Math.min(C,z+2*n*Q);c++}return{errorX:B,errorY:G,errorZ:n,result:x}};r.decodeRGB=function(b){var c,l,p,r,z,w,u=new DataView(b,0),C=0;r=a(b,u,C);p=r.identifier;r=r.version;C+=t.byteCount;
if("ClusterRGB"!==p)throw new f("lepcc-decode-error","Bad identifier");if(1<r)throw new f("lepcc-decode-error","Unknown version");w=C;c=u.getUint32(w+0,!0);l=u.getUint32(w+4,!0);p=u.getUint32(w+8,!0);r=u.getUint16(w+12,!0);z=u.getUint8(w+14);w=u.getUint8(w+15);C+=16;if(l*Math.pow(2,32)+c!==b.byteLength)throw new f("lepcc-decode-error","Bad size");if(2!==z&&1!==z||0!==w){if(0===z&&0===w){if(3*p+C!==b.byteLength||0!==r)throw new f("lepcc-decode-error","Bad count");return(new Uint8Array(b,C)).slice()}if(2>=
z&&1===w){if(C+3!==b.byteLength||1!==r)throw new f("lepcc-decode-error","Bad count");r=u.getUint8(C);c=u.getUint8(C+1);u=u.getUint8(C+2);C=new Uint8Array(3*p);for(b=0;b<p;b++)C[3*b]=r,C[3*b+1]=c,C[3*b+2]=u;return C}throw new f("lepcc-decode-error","Bad method "+z+","+w);}if(3*r+p+C!==b.byteLength||256<r)throw new f("lepcc-decode-error","Bad count");u=new Uint8Array(b,C,3*r);r=new Uint8Array(b,C+3*r,p);C=new Uint8Array(3*p);for(b=0;b<p;b++)c=r[b],C[3*b]=u[3*c],C[3*b+1]=u[3*c+1],C[3*b+2]=u[3*c+2];return C};
r.decodeIntensity=function(b){var h,l,p,r,z,w=new DataView(b,0),u=0;r=a(b,w,u);p=r.identifier;r=r.version;u+=t.byteCount;if("Intensity "!==p)throw new f("lepcc-decode-error","Bad identifier");if(1<r)throw new f("lepcc-decode-error","Unknown version");var C=u;h=w.getUint32(C+0,!0);l=w.getUint32(C+4,!0);p=w.getUint32(C+8,!0);r=w.getUint16(C+12,!0);z=w.getUint8(C+14);w.getUint8(C+15);u+=16;if(l*Math.pow(2,32)+h!==b.byteLength)throw new f("lepcc-decode-error","Bad size");w=new Uint16Array(p);if(8===z){if(p+
u!==b.byteLength)throw new f("lepcc-decode-error","Bad size");z=new Uint8Array(b,u,p)}else if(16===z){if(2*p+u!==b.byteLength)throw new f("lepcc-decode-error","Bad size");z=new Uint16Array(b,u,p)}else if(z=[],c(b,u,z)!==b.byteLength)throw new f("lepcc-decode-error","Bad size");for(b=0;b<p;b++)w[b]=z[b]*r;return w}})},"esri/views/3d/layers/i3s/I3SIndexTraversal":function(){define("require exports ./GoogPriorityQueue ../../support/PromiseLightweight ../../lib/glMatrix ../../../../core/urlUtils".split(" "),
function(B,r,f,a,b,c){var t=f.goog.structs.PriorityQueue;return function(){function f(a,f,p,r,t,w,u,C,B,G,n){void 0===n&&(n={initDepthFirst:!0,neighborhood:!0,perLevelTraversal:!1});var h=this;this.baseURL=a;this.startNodeUrl=f;this.rootId=p;this.poi=r;this.nodeIndex=t;this.streamDataSupplier=w;this.viewportQueries=u;this.processNodeIndexDocument=C;this.finishedLevelCallback=B;this.logger=G;this.traversalOptions=n;this.queues=[];this.knownNodes=new Set;this.dataLoadingPerLevel=[];this.numIndicesLoading=
this.currentLevel=0;this.cancelled=this.queueTraversalEnabled=!1;this.initQueryErrback=function(){h.initPromise.done()};this.initQueryCallback=function(a,b){if(h.cancelled)h.initPromise.done();else if(h.nodeTraversalState(b.id),h.enqueueConnected(a,b,0),h.isLeafNode(b))h.initPromise.done();else{for(var f=1E9,l=void 0,n=0;n<b.children.length;++n){var p=b.children[n];if(h.nodeIsVisible(p)&&(!h.viewportQueries.hasLOD(b)||!h.viewportQueries.isTooHighLOD(b))){var q=h.viewportQueries.distToPOI(p,h.poi);
q<f&&(f=q,l=p)}}l?(a=c.makeAbsolute(l.href,a),h.getNode(a,l.id,h.initQueryCallback,h.initQueryErrback)):h.initPromise.done()}};this.poi=b.vec3d.create(r)}f.prototype.updatePointOfInterest=function(a){b.vec3d.set(a,this.poi);this.reprioritizeQueues()};f.prototype.start=function(){var b=this;this._nodeTraversalState={};this._nodeIsVisibleCached={};this.dataLoadingPerLevel=[];this.currentLevel=0;this.rootUrl=c.makeAbsolute(this.startNodeUrl,this.baseURL);this.traversalOptions.initDepthFirst?(this.initPromise=
new a.Promise,this.getNode(this.rootUrl,this.rootId,this.initQueryCallback,this.initQueryErrback),this.initPromise.then(function(){b.cancelled||(b.queueTraversalEnabled=!0)})):(this.enqueue({id:this.rootId,hrefConcat:this.rootUrl,mbs:null},0),this.queueTraversalEnabled=!0)};f.prototype.continueTraversal=function(a){void 0===a&&(a=5);if(this.queueTraversalEnabled)for(var b=0;b<this.queues.length;b++)if(!this.traversalOptions.perLevelTraversal||this.currentLevel===b){for(var c=this.queues[b];0<a--&&
!c.isEmpty();)this.processQueueOne(b);this.traversalOptions.perLevelTraversal&&c.isEmpty()&&0===this.dataLoadingPerLevel[b]&&(this.finishedLevelCallback.call(null,this.currentLevel),this.currentLevel++)}};f.prototype.isQueueTraversalEnabled=function(){return this.queueTraversalEnabled};f.prototype.getQueueSize=function(){for(var a=0,b=0;b<this.queues.length;b++)a+=this.queues[b].getCount();return a};f.prototype.cancel=function(){this.queueTraversalEnabled=!1;for(var a=0;a<this.queues.length;a++)this.queues[a].clear();
this.cancelled=!0};f.prototype.isLoading=function(){return 0<this.numIndicesLoading||0<this.getQueueSize()};f.prototype.nodeIsVisible=function(a){if(null!=this._nodeIsVisibleCached[a.id])return this._nodeIsVisibleCached[a.id];this._nodeIsVisibleCached[a.id]=this.viewportQueries.isNodeVisible(a);return this._nodeIsVisibleCached[a.id]};f.prototype.nodeTraversalState=function(a){if(null!=this._nodeTraversalState[a])return this._nodeTraversalState[a];var b=this.nodeIndex[a];if(null==b)return null;var c=
null,h=!1;if(null!=b.parentNode){c=this.nodeIndex[b.parentNode.id];if(null==c)return null;var f=this._nodeTraversalState[c.id];null!=f&&(h=f.nodeIsTooHighLOD)}var f=this.viewportQueries.hasLOD(b),p=this.viewportQueries.isTooHighLOD(b),c=this.viewportQueries.isChosenLOD(b,c,p,h);this._nodeTraversalState[b.id]={visited:!0,nodeHasLOD:f,nodeIsTooHighLOD:p,isChosenLOD:c};return this._nodeTraversalState[a]};f.prototype.reprioritizeQueues=function(){for(var a=0;a<this.queues.length;a++)this.queues[a]=this.reprioritizeQueue(this.queues[a])};
f.prototype.reprioritizeQueue=function(a){for(var b=new t;!a.isEmpty();){var c=a.dequeue(),h=this.entryPriority(c);b.enqueue(h,c)}return b};f.prototype.processQueueOne=function(a){var b=this,c=this.queues[a].dequeue();this.dataLoadingPerLevel[a]++;var h=function(){return b.dataLoadingPerLevel[a]--},f=function(c,f){b.nodeTraversalState(f.id);b.enqueueConnected(c,f,a);b.processNodeIndexDocument(f).then(h,h)};this.getNode(c.hrefConcat,c.id,function(a,c){if(b.traversalOptions.neighborhood&&null!=c.parentNode){var l=
b.concatHref(c.parentNode,a);b.getNode(l,c.parentNode.id,function(){return f(a,c)},h)}else f(a,c)},h)};f.prototype.getNode=function(a,b,c,f){var h=this;this.numIndicesLoading++;this.nodeIndex[b]?(c(a,this.nodeIndex[b]),this.numIndicesLoading--):this.streamDataSupplier.request(a,"json").then(function(a,b){h.nodeIndex[b.id]=b;b.baseUrl=a;c(a,b);h.numIndicesLoading--},function(b){null!=f&&f(b);h.loadErrorCallback(a);h.numIndicesLoading--})};f.prototype.isLeafNode=function(a){return null==a.children};
f.prototype.concatHref=function(a,b){return c.makeAbsolute(a.href,b)};f.prototype.entryPriority=function(a){return a.id===this.rootId?0:this.viewportQueries.distToPOI(a,this.poi)};f.prototype.enqueue=function(a,b){this.traversalOptions.perLevelTraversal||(b=0);for(this.knownNodes.add(a.id);this.queues.length<=b;)this.queues.push(new t),this.dataLoadingPerLevel.push(0);var c=this.entryPriority(a);this.queues[b].enqueue(c,a)};f.prototype.queueEntryFromNode=function(a,b){return{id:a.id,mbs:a.mbs,hrefConcat:b}};
f.prototype.queueEntryFromNodeRef=function(a,b){return this.queueEntryFromNode(a,this.concatHref(a,b))};f.prototype.enqueueConnected=function(a,b,c){if(!this.cancelled&&null!=b){var h=this.nodeTraversalState(b.id);b.id===this.rootId||null==b.parentNode||this.knownNodes.has(b.parentNode.id)?b.id===this.rootId&&!this.knownNodes.has(b.id)&&this.nodeIsVisible(b)&&this.enqueue(this.queueEntryFromNode(b,a),c):this.enqueue(this.queueEntryFromNodeRef(b.parentNode,a),c-1);if(b.children)for(var f=0,l=b.children;f<
l.length;f++){var p=l[f],q=this.nodeIsVisible(p);this.knownNodes.has(p.id)||h.nodeHasLOD&&h.nodeIsTooHighLOD||!q||this.enqueue(this.queueEntryFromNodeRef(p,a),c+1)}if(this.traversalOptions.neighborhood&&b.neighbors)for(h=0,b=b.neighbors;h<b.length;h++)f=b[h],l=this.nodeIsVisible(f),!this.knownNodes.has(f.id)&&l&&this.enqueue(this.queueEntryFromNodeRef(f,a),c)}};f.prototype.loadErrorCallback=function(a){this.logger.warn("Error loading node: "+a)};return f}()})},"esri/views/3d/layers/i3s/GoogPriorityQueue":function(){define([],
function(){var B={};(function(){function r(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&
!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function f(a,b){a=a.split(".");var c=h;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var f;a.length&&(f=a.shift());)a.length||void 0===b?c=c[f]?c[f]:c[f]={}:c[f]=b}function a(a,b){this.d=a;this.b=b}function b(a){if("array"!=r(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function c(b){this.a=[];if(b)a:{var f,h;if(b instanceof c){f=b.a;h=[];
for(var l=f.length,p=0;p<l;p++)h.push(f[p].getKey());f=h;h=b.a;for(var l=[],p=h.length,r=0;r<p;r++)l.push(h[r].b);h=l;if(0>=b.a.length){b=this.a;for(l=0;l<f.length;l++)b.push(new a(f[l],h[l]));break a}}else{f=[];l=0;for(p in b)f[l++]=p;l=[];p=0;for(h in b)l[p++]=b[h];h=l}for(l=0;l<f.length;l++)t(this,f[l],h[l])}}function t(b,c,h){var f=b.a;f.push(new a(c,h));c=f.length-1;b=b.a;for(h=b[c];0<c;)if(f=c-1>>1,b[f].getKey()>h.getKey())b[c]=b[f],c=f;else break;b[c]=h}function p(){c.call(this)}var h=this;
a.prototype.getKey=function(){return this.d};a.prototype.c=function(){return new a(this.d,this.b)};c.prototype.remove=function(){var a=this.a,c=a.length,f=a[0];if(!(0>=c)){if(1==c)b(a);else{a[0]=a.pop();for(var a=0,c=this.a,h=c.length,p=c[a];a<h>>1;){var r=2*a+1,t=2*a+2,r=t<h&&c[t].getKey()<c[r].getKey()?t:r;if(c[r].getKey()>p.getKey())break;c[a]=c[r];a=r}c[a]=p}return f.b}};c.prototype.c=function(){return new c(this)};c.prototype.g=function(){return this.a.length};c.prototype.h=function(){return 0==
this.a.length};c.prototype.clear=function(){b(this.a)};(function(){function a(){}a.prototype=c.prototype;p.i=c.prototype;p.prototype=new a})();p.prototype.f=function(a,b){t(this,a,b)};p.prototype.e=function(){return this.remove()};f("goog.structs.PriorityQueue",p);f("goog.structs.PriorityQueue.prototype.enqueue",p.prototype.f);f("goog.structs.PriorityQueue.prototype.dequeue",p.prototype.e);f("goog.structs.PriorityQueue.prototype.isEmpty",p.prototype.h);f("goog.structs.PriorityQueue.prototype.clear",
p.prototype.clear);f("goog.structs.PriorityQueue.prototype.clone",p.prototype.c);f("goog.structs.PriorityQueue.prototype.getCount",p.prototype.g)}).call(B);return B})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports"],function(B,r){return function(){function f(a,b,c){this.layerViewRequiredFunctions=a;this.layerViewOptionalFunctions=b;this.lodGlobalDirtyChanged=c}f.prototype.startNodeLoading=function(a,b,c,f,p){this._lodGlobalDirty=!1;this._lodMode=p.mode;this._allowPartialOverlaps=
p.allowPartialOverlaps;this._nodeIndex=c;this._rootId=f;this._nodeTraversalState=b;this._nodeIsVisible=a;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};f.prototype.shouldLoadNode=function(a){var b=this._nodeTraversalState(a.id),c=b.nodeHasLOD,b=b.isChosenLOD;return"perLevel"!==this._lodMode?b||!c:b||!c?!0:this._allowPartialOverlaps?!this._subtreeComplete(a):this._subtreeEmpty(a)};f.prototype.shouldSetPolygonOffset=function(a){return"perLevel"===this._lodMode?!this._nodeTraversalState(a.id).isChosenLOD:
!1};f.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};f.prototype.finishedLevel=function(a){"perLevel"===this._lodMode&&this._removeUpToLevelRecursive(this._nodeIndex[this._rootId],a-1)};f.prototype.lodSwapBundleLoaded=function(a){"perLevel"===this._lodMode?this._nodeTraversalState(a.id).isChosenLOD&&this._removeChildrenRecursive(a):this.setLodGlobalDirty()};Object.defineProperty(f.prototype,"requiresLODGlobalHandling",{get:function(){return"global"===
this._lodMode&&null!=this._rootId&&(!0===this._lodGlobalDirty||this.layerViewRequiredFunctions.isOverMemory())},enumerable:!0,configurable:!0});f.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var a=this._rootId,b=this.layerViewRequiredFunctions.isOverMemory();this._lodGlobalHandlingRecursion(a,!1,b);this._lodGlobalDirty=!1;this.lodGlobalDirtyChanged(this._lodGlobalDirty)}};f.prototype._lodGlobalHandlingRecursion=function(a,b,c){var f=this._nodeIndex[a];if(null==f)return!1;
a=this._nodeTraversalState(a).isChosenLOD;var p=this.layerViewRequiredFunctions.isBundleAlreadyAddedToStage(f,0);p&&null!=this.layerViewOptionalFunctions.setPolygonOffset&&this.layerViewOptionalFunctions.setPolygonOffset(f,!a);if(a&&p)return this._removeChildrenRecursive(f),!0;var h=!1;if(null!=f.children&&0!==f.children.length)for(var h=!0,l=0,q=f.children;l<q.length;l++){var r=q[l];this._nodeIsVisible(r)&&(r=this._lodGlobalHandlingRecursion(r.id,p||b,c),h=h&&r)}p&&!a&&(b||h||c)&&(this.layerViewRequiredFunctions.removeNodeData(f),
p=!1);return h||p};f.prototype._removeChildrenRecursive=function(a){if(null!=a.children){var b=0;for(a=a.children;b<a.length;b++){var c=this._nodeIndex[a[b].id];null!=c&&(this._removeChildrenRecursive(c),this.layerViewRequiredFunctions.removeNodeData(c))}}};f.prototype._removeUpToLevelRecursive=function(a,b){if(!(null==a||0>b)&&(this._nodeTraversalState(a.id).isChosenLOD||this.layerViewRequiredFunctions.removeNodeData(a),null!=a.children)){var c=0;for(a=a.children;c<a.length;c++)this._removeUpToLevelRecursive(this._nodeIndex[a[c].id],
b-1)}};f.prototype._subtreeEmpty=function(a){if(this.layerViewRequiredFunctions.areAllBundlesLoaded(a))return!1;if(null==a.children)return!0;var b=0;for(a=a.children;b<a.length;b++){var c=a[b];if(this._nodeIsVisible(c)&&(c=this._nodeIndex[c.id],null!=c&&!this._subtreeEmpty(c)))return!1}return!0};f.prototype._subtreeComplete=function(a){if(this.layerViewRequiredFunctions.areAllBundlesLoaded(a))return!0;if(null==a.children||0===a.children.length)return!1;var b=0;for(a=a.children;b<a.length;b++){var c=
a[b];if(this._nodeIsVisible(c)&&(c=this._nodeIndex[c.id],null==c||!this._subtreeComplete(c)))return!1}return!0};return f}()})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../lib/glMatrix ./I3SUtil ../../webgl-engine/lib/Util ../../support/projectionUtils ../graphics/featureExpressionInfoUtils ../graphics/ElevationInfo ../graphics/Graphics3DSymbolCommonCode ../../../../geometry/Point".split(" "),function(B,r,f,a,b,c,t,p,h,l){var q=f.vec3d,y=f.vec4d;return function(){function f(a,
c,f,h,q,n,r,x,z){void 0===z&&(z={});this._computedMbs=a;this.indexSR=c;this._renderCoordsHelper=f;this.extent=q;this.errorMetricPreference=n;this.elevationProvider=r;this.options=z;this.fp=[];this._tmp1=[0,0,0];this._tmp2=[0,0,0];this._tmp3=[0,0,0];this._tmp0=[0,0,0];this.supportedMetrics=["screenSpaceRelative","maxScreenThreshold","removedFeatureDiameter","distanceRangeFromDefaultCamera"];this.maxDistance=z.maxDistance||Number.MAX_VALUE;this.screenspaceErrorBias=z.screenspaceErrorBias||1;this.enableLoD=
!1!==z.disableLod;for(a=0;8>a;++a)this.fp[a]=y.create();b.matrix2frustumPlanes(h.viewMatrix,h.projectionMatrix,this.fp);this.engineSR=this._renderCoordsHelper.spatialReference;this._screenSizeFactor=1/h.perPixelRatio;this._camPos=h.eye;this._camDir=h.viewForward;x?(this._elevationInfo=new p,this._elevationInfo.featureExpressionInfoContext=t.createContext(t.extractExpressionInfo(x,!1)),this._elevationInfo.mixinApi(x)):this._elevationInfo=null;this.tmpPoint=new l({x:0,y:0,z:0,spatialReference:c})}f.prototype.computedMbs=
function(a){var b=this._computedMbs[a.id];null==b&&(b=y.createFrom(0,0,0,-1),this._computedMbs[a.id]=b);0>b[3]&&(y.set(a.mbs,b),this._elevationInfo&&1E5>a.mbs[3]&&(this.tmpPoint.x=b[0],this.tmpPoint.y=b[1],this.tmpPoint.z=b[2],b[2]=h.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationInfo,this._renderCoordsHelper,null)),c.mbsToMbs(b,this.indexSR,b,this.engineSR));return b};f.prototype.isNodeVisible=function(a){a=this.computedMbs(a);return this.isMBSinExtent(a)&&this.isMBSVisible(a)};
f.prototype.isMBSinExtent=function(b){return this.extent?0!==a.intersectBoundingBoxWithMbs(this.extent,b):!0};f.prototype.isMBSVisible=function(a){var b=a[0],c=a[1],f=a[2];a=a[3];var h=this.fp;return h[0][0]*b+h[0][1]*c+h[0][2]*f+h[0][3]<=a&&h[1][0]*b+h[1][1]*c+h[1][2]*f+h[1][3]<=a&&h[2][0]*b+h[2][1]*c+h[2][2]*f+h[2][3]<=a&&h[3][0]*b+h[3][1]*c+h[3][2]*f+h[3][3]<=a&&h[4][0]*b+h[4][1]*c+h[4][2]*f+h[4][3]<=a&&h[5][0]*b+h[5][1]*c+h[5][2]*f+h[5][3]<=a};f.prototype.calcScreenSpaceSize=function(a,b){a=this.computedMbs(a);
var c=a[3];a=q.dist2(a,this._camPos)-c*c;return 0>a?.5*Number.MAX_VALUE:b/Math.sqrt(a)*this._screenSizeFactor};f.prototype.calcCameraDistance=function(a){a=this.computedMbs(a);return Math.max(0,q.dist(a,this._camPos)-a[3])};f.prototype.calcAngleDependentLoD=function(a){a=this.computedMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/q.length(a)+b)/q.dist(a,this._camPos);return Math.min(1,a)};f.prototype.hasLOD=function(a){return this.enableLoD&&
null!=a.lodSelection};f.prototype.hasFeatures=function(a){return null!=a.featureData};f.prototype.getDistancePlanarMode=function(a,b,c){var f=a[0]-b[0],h=a[1]-b[1];a=a[2]-b[2];f=f+f+h*h;if(f<=c*c)return Math.abs(a);c=Math.sqrt(f)-c;return Math.sqrt(a*a+c*c)};f.prototype.getDistanceGlobeMode=function(a,b,c){var f=q.length(b),h=q.length(a)-f;q.scale(a,q.dot(a,b)/q.length2(a),this._tmp0);if(q.dist2(b,this._tmp0)<=c*c)return Math.abs(h);b=q.scale(b,1/f,this._tmp0);var f=q.scale(b,f-c*c/2/f,this._tmp1),
l=q.subtract(a,f,this._tmp2),l=q.subtract(l,q.scale(b,q.dot(b,l),this._tmp3),this._tmp2),f=q.add(f,q.scale(l,c/q.length(l),this._tmp2),this._tmp2);c=q.dist(a,f);2E5<=h&&(a=q.subtract(a,f,this._tmp1),a=q.dot(a,b)/q.length(a),.08>a&&(a=1E-4),c/=a);return c};f.prototype.getDistance=function(a,b,f){return this.engineSR===c.SphericalRenderSpatialReference?this.getDistanceGlobeMode(a,b,f):this.getDistancePlanarMode(a,b,f)};f.prototype._selectErrorMetric=function(a){if(this.errorMetricPreference)for(var b=
0;b<this.errorMetricPreference.length;b++)for(var c=0;c<a.length;c++){if(a[c].metricType===this.errorMetricPreference[b])return a[c]}else for(b=0;b<a.length;b++)if(0<=this.supportedMetrics.indexOf(a[b].metricType))return a[b];return null};f.prototype.isTooHighLOD=function(a){if(a.lodSelection&&0<a.lodSelection.length){if(!1===this.hasFeatures(a))return!1;var b=this._selectErrorMetric(a.lodSelection);if(null!=b)return this.evaluateLODmetric(a,b)}return!1};f.prototype.evaluateLODmetric=function(a,b){if("screenSpaceRelative"===
b.metricType)return a=this.computedMbs(a),a=2*this.getDistance(this._camPos,a,a[3])/this._screenSizeFactor,b.maxError*this.screenspaceErrorBias<=a;if("maxScreenThreshold"===b.metricType){var c=this.calcScreenSpaceSize(a,a.mbs[3]);this.options.angleDependentLoD&&(c*=this.calcAngleDependentLoD(a));return c*this.screenspaceErrorBias<b.maxError}return"removedFeatureDiameter"===b.metricType?10>this.calcScreenSpaceSize(a,b.maxError)*this.screenspaceErrorBias:"distanceRangeFromDefaultCamera"===b.metricType?
this.calcCameraDistance(a)>b.maxError:!1};f.prototype.isChosenLOD=function(a,b,c,f){return a.lodSelection&&0<a.lodSelection.length?(c||!a.children)&&!(b&&f):!0};f.prototype.distToPOI=function(a,b){a=this.computedMbs(a);return q.dist(a,b)-a[3]};return f}()})},"esri/views/3d/layers/i3s/IdleQueue":function(){define(["require","exports","dojo/Deferred"],function(B,r,f){Object.defineProperty(r,"__esModule",{value:!0});B=function(){function a(){this._queue=[]}a.prototype.push=function(){var a=new f;this._queue.push(a);
return a.promise};a.prototype.length=function(){return this._queue.length};a.prototype.process=function(){this._queue.shift().resolve()};a.prototype.cancelAll=function(){for(var a=0,c=this._queue;a<c.length;a++)c[a].cancel();this._queue.length=0};return a}();r.IdleQueue=B})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Layer ./FeatureLayer ./support/Field ./support/fieldUtils ./support/LabelClass ../symbols/support/ElevationInfo ./support/labelingInfo ./mixins/SceneService ./support/commonProperties ../PopupTemplate ../request ../core/requireUtils ../core/promiseUtils ../core/urlUtils ../core/Error ../core/Logger ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../portal/PortalItem ../tasks/support/Query dojo/_base/lang dojo/promise/all".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q,S,P,O){function T(a,b,d){a&&((a=J.read(a,b,d)||void 0)||W.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:d}));return a}var U=["3DObject","Point"],W=x.getLogger("esri.layers.SceneLayer"),k={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
ca={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(c){function e(a,b){a=c.call(this)||this;a.featureReduction=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.elevationInfo=null;a.labelsVisible=!1;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}f(e,c);e.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?P.mixin({},{url:a},b):a};e.prototype.getField=function(a){return h.getField(a,this.fields)};Object.defineProperty(e.prototype,"geometryType",{get:function(){return ca[this.profile]||"mesh"},enumerable:!0,configurable:!0});e.prototype.readLabelsVisible=function(a,b){return b.showLabels};e.prototype.writeLabelsVisible=function(a,b){b.showLabels=!!a};Object.defineProperty(e.prototype,"renderer",{set:function(a){h.fixRendererFields(a,
this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});e.prototype.readCachedDrawingInfo=function(a,b){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};e.prototype.readPopupEnabled=function(a,b){return null!=b.disablePopup?!b.disablePopup:void 0};e.prototype.writePopupEnabled=function(a,b){a||(b.disablePopup=!0)};e.prototype.readPopupTemplate=function(a,b){return b.popupInfo?u.fromJSON(b.popupInfo):void 0};e.prototype.writePopupTemplate=function(a,b){a&&(b.popupInfo=
a.toJSON())};e.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};e.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&k[a])return k[a];W.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};e.prototype.readNormalReferenceFrame=function(a,b){return b.store.normalReferenceFrame};e.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return O([a._verifyRootNodeAndUpdateExtent(),
a._setCompanionFeatureLayer()])}).then(function(){return a._applyCompanionOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return N.loadStyleRenderer(a,{origin:"service"})}).then(function(){return h.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(b);return this};e.prototype.createLayerView=function(a){var b=this;return E.when(B,null==this.profile||"mesh-pyramids"===this.profile?"../views/3d/layers/SceneLayerView3D":"../views/3d/layers/SceneLayerGraphicsView3D").then(function(d){return new d({view:a,
layer:b})})};e.prototype.createQuery=function(){var a=new S;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};e.prototype.queryExtent=function(a){var b=this;return this._getCompanionLayerForQuery().then(function(d){return d.queryExtent(a||b.createQuery())})};e.prototype.queryFeatureCount=function(a){var b=this;return this._getCompanionLayerForQuery().then(function(d){return d.queryFeatureCount(a||b.createQuery())})};
e.prototype.queryFeatures=function(a){var b=this;return this._getCompanionLayerForQuery().then(function(d){return d.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var d=0,c=a.features;d<c.length;d++)c[d].layer=b;return a})};e.prototype.queryObjectIds=function(a){var b=this;return this._getCompanionLayerForQuery().then(function(d){return d.queryObjectIds(a||b.createQuery())})};e.prototype.getFieldUsageInfo=function(a){return this._fieldUsageInfo[a]||{supportsLabelingInfo:!1,
supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}};e.prototype._getCompanionLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getCompanionLayerForQuery()});var b=this.companionFeatureLayer;return null!=b?G.resolve(b):G.reject(new A("scenelayer:query-not-available","SceneLayer queries are not available without companion feature layer"))};e.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===
a})};e.prototype.queryCachedStatistics=function(a){if(!this.hasCachedStatistics(a))return G.reject(new A("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var b=0,d=this.statisticsInfo;b<d.length;b++){var c=d[b];if(c.name===a)return a=n.join(this.parsedUrl.path,c.href),C(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};e.prototype.graphicChanged=function(a){this.emit("graphic-update",a)};e.prototype._validateLayer=function(a){if(a.layerType&&
-1===U.indexOf(a.layerType))throw new A("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new A("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new A("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,
supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,d=!1,c=!1;if(null==a)c=d=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":d=!0;c=b;break;case "vertex-reference-frame":d=!0;c=!b;break;default:d=!1}if(!d)throw new A("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!c)throw new A("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");
};e.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var d=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),c=!!(b.companionFeatureLayer&&b.companionFeatureLayer.fields&&b.companionFeatureLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:d,supportsRenderer:d,supportsPopupTemplate:d||c,supportsLayerQuery:c}},b=this,c=0,e=this.fields;c<e.length;c++)a(e[c])};
e.prototype._applyCompanionOverrides=function(){if(this.companionFeatureLayer){if(this.companionFeatureLayer.fields)for(var a=0,b=this.companionFeatureLayer.fields;a<b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=K.getProperties(this);for(c=0;c<a.length;c++){var e=a[c];this._buddyIsMoreImportant(e)&&(b.setDefaultOrigin(this.companionFeatureLayer.originOf(e)),b.set(e,this.companionFeatureLayer[e]),b.setDefaultOrigin("user"))}}};e.prototype._setCompanionFeatureLayer=
function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(b){a.companionFeatureLayer=b})};e.prototype._fetchCompanionFeatureLayer=function(){var a=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?G.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):this._fetchCompanionFeatureLayerFromUrl()).then(function(a){return a.load()}).otherwise(function(b){null==a.attributeStorageInfo?W.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+
a.title):W.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+a.title);return null})};e.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var b=this;return a.fetchRelatedItems({relationshipType:"Service2Data",direction:"forward"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===a.type})[0])?b._fetchCompanionFeatureLayerFromPortalItem(new Q({id:a.id,portal:a.portal})):G.reject()}).otherwise(function(){return b._fetchCompanionFeatureLayerFromUrl()})};
e.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var b=this;return a.load().then(function(a){return b._findMatchingCompanionSublayerUrl(a.url)}).then(function(b){return G.resolve(new t({url:b,portalItem:a}))})};e.prototype._fetchCompanionFeatureLayerFromUrl=function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return G.resolve(new t({url:a}))})};e.prototype._findMatchingCompanionSublayerUrl=function(a){var b=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);
if(!b)return G.reject();null==a&&(a=b[1]+"/FeatureServer");var d=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var c=b[1]+"/SceneServer",e=parseInt(b[2],10),b=C(this._addUrlToken(c),a).otherwise(function(a){return{layers:null}});a=C(this._addUrlToken(d),a);return O([a,b]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var c=0;c<Math.min(a.length,
b.length);c++){if(a[c].id===e)return d+"/"+b[c].id}else if(e<b.length)return d+"/"+b[e].id;throw Error("could not find matching companion sublayer");})};e.prototype._buddyIsMoreImportant=function(a){if(!this.companionFeatureLayer)return!1;var b=I.nameToId(this.originOf(a));a=I.nameToId(this.companionFeatureLayer.originOf(a));return null!=a&&a<=I.OriginId.SERVICE?null==b||b<I.OriginId.SERVICE:null!=a&&a<=I.OriginId.PORTAL_ITEM?null==b||b<I.OriginId.PORTAL_ITEM:!1};a([b.shared("esri.layers.SceneLayer")],
e.prototype,"declaredClass",void 0);a([b.property({json:{origins:{webScene:{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],e.prototype,"featureReduction",void 0);a([b.property()],e.prototype,"companionFeatureLayer",void 0);a([b.property()],e.prototype,"operationalLayerType",void 0);a([b.property({json:{read:!1},readOnly:!0})],e.prototype,"type",void 0);a([b.property({type:[p]})],e.prototype,"fields",void 0);a([b.property({readOnly:!0})],e.prototype,
"attributeStorageInfo",void 0);a([b.property({readOnly:!0})],e.prototype,"statisticsInfo",void 0);a([b.property({json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],e.prototype,"definitionExpression",void 0);a([b.property({type:q,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],e.prototype,"elevationInfo",
void 0);a([b.property({type:String,dependsOn:["profile"]})],e.prototype,"geometryType",null);a([b.property({type:Boolean})],e.prototype,"labelsVisible",void 0);a([b.reader("labelsVisible",["showLabels"])],e.prototype,"readLabelsVisible",null);a([b.writer("labelsVisible")],e.prototype,"writeLabelsVisible",null);a([b.property({type:[l],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:y.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",
reader:y.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],e.prototype,"labelingInfo",void 0);a([b.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],e.prototype,"legendEnabled",void 0);a([b.property({types:M.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:T}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:T},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],
e.prototype,"renderer",null);a([b.property({json:{read:!1}})],e.prototype,"cachedDrawingInfo",void 0);a([b.reader("service","cachedDrawingInfo")],e.prototype,"readCachedDrawingInfo",null);a([b.property({type:Boolean})],e.prototype,"popupEnabled",void 0);a([b.reader("popupEnabled",["disablePopup"])],e.prototype,"readPopupEnabled",null);a([b.writer("popupEnabled")],e.prototype,"writePopupEnabled",null);a([b.property({type:u})],e.prototype,"popupTemplate",void 0);a([b.reader("popupTemplate",["popupInfo"])],
e.prototype,"readPopupTemplate",null);a([b.writer("popupTemplate")],e.prototype,"writePopupTemplate",null);a([b.property({type:String,json:{read:!1}})],e.prototype,"objectIdField",void 0);a([b.reader("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdField",null);a([b.property()],e.prototype,"objectIdFilter",void 0);a([b.property({type:String,json:{read:!1}})],e.prototype,"profile",void 0);a([b.reader("service","profile",["store.profile"])],e.prototype,"readProfile",null);
a([b.property({readOnly:!0,type:String,json:{read:!1}})],e.prototype,"normalReferenceFrame",void 0);a([b.reader("service","normalReferenceFrame",["store.normalReferenceFrame"])],e.prototype,"readNormalReferenceFrame",null);a([b.property(w.screenSizePerspectiveEnabled)],e.prototype,"screenSizePerspectiveEnabled",void 0);return e=a([b.subclass()],e)}(b.declared(c,z))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Layer ../../core/MultiOriginJSONSupport ./ArcGISService ./OperationalLayer ./PortalLayer ../../core/Error ../../core/urlUtils ../../core/promiseUtils ../../core/requireUtils ../../request dojo/_base/lang dojo/io-query ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x){return function(c){function h(){var a=null!==c&&c.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}f(h,c);h.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};h.prototype._readSpatialReference=function(a){if(null!=
a.spatialReference)return A.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new A(a):null};h.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent?null:new G({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};h.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";
a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};h.prototype.readCopyright=function(a,b){return b.copyrightText};h.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};h.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return x.titleFromUrlAndName(this.url,b.name);b=b.name||x.parse(this.url).title;
"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return x.cleanTitle(b)};h.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(h.prototype,"url",{set:function(a){var b=y.urlToObject(a),c=x.parse(b.path);c&&null!=c.sublayer&&(this.layerId=c.sublayer,b=E.objectToQuery(b.query),a=c.url.path,b&&(a=a+"?"+b));for(;"/"===a[a.length-1];)a=a.slice(0,-1);this._set("url",a)},enumerable:!0,configurable:!0});h.prototype.writeUrl=function(a,b){a&&y.isProtocolRelative(a)&&
(a="https:"+a);a=a?y.normalize(a):a;var c=y.urlToObject(a);null!=this.layerId&&c?(b.url=c.path+"/layers/"+this.layerId,c.query&&Object.keys(c.query)&&(b.url+="?"+E.objectToQuery(c.query))):a&&(b.url=a)};Object.defineProperty(h.prototype,"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=y.urlToObject(a);null!=this.layerId&&x.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});h.prototype._addUrlToken=function(a){var b=C.mixin({},
this.parsedUrl.query,{token:this.token}),b=E.objectToQuery(b);return a+(b?"?"+b:"")};h.prototype.readRootNode=function(a,b){return b.store.rootNode};h.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};h.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=
b+a}};h.prototype._fetchRootNode=function(){if(!this.rootNode)return z.resolve();var a=y.join(this.parsedUrl.path,this.rootNode);return u(this._addUrlToken(a),{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).otherwise(function(b){throw new q("sceneservice:root-node-missing","Root node missing.",{error:b,url:a});})};h.prototype._fetchService=function(){var a=this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?this._fetchFirstLayerId().then(function(b){null!=b&&
(a.layerId=b)}):z.resolve()).then(function(){return a._fetchServiceLayer()})};h.prototype._fetchFirstLayerId=function(){return u(this._addUrlToken(this.url),{query:{f:"json"},callbackParamName:"callback",responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};h.prototype._fetchServiceLayer=function(){var a=this;return u(this._addUrlToken(this.parsedUrl.path),{query:{f:"json"},responseType:"json"}).then(function(b){b.ssl&&
(a.url=a.url.replace(/^http:/i,"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};h.prototype._validateLayer=function(a){};h.prototype.createGraphicsController=function(a){var b=this;a.layer=this;a.addUrlToken=function(a){return b._addUrlToken(a)};var c=w.when(B,"../graphics/controllers/I3SOnDemandController").then(function(b){return new b(a)});c.then(function(a){b.emit("graphics-controller-create",{graphicsController:a})});return c};a([b.shared({id:{json:{origins:{service:{read:!1},
portalItem:{read:!1}}}}})],h.prototype,"properties",void 0);a([b.property({type:A})],h.prototype,"spatialReference",void 0);a([b.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],h.prototype,"readSpatialReference",null);a([b.property({type:G})],h.prototype,"fullExtent",void 0);a([b.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],h.prototype,"readFullExtent",null);a([b.property({readOnly:!0,type:n})],h.prototype,
"heightModelInfo",void 0);a([b.property({readOnly:!0})],h.prototype,"version",void 0);a([b.reader("version",["store.version"])],h.prototype,"readVersion",null);a([b.property({type:String})],h.prototype,"copyright",void 0);a([b.reader("copyright",["copyrightText"])],h.prototype,"readCopyright",null);a([b.property({type:String})],h.prototype,"sublayerTitleMode",void 0);a([b.property({type:String})],h.prototype,"title",void 0);a([b.reader("portal-item","title")],h.prototype,"readTitlePortalItem",null);
a([b.reader("service","title",["name"])],h.prototype,"readTitleService",null);a([b.property({type:Number})],h.prototype,"layerId",void 0);a([b.reader("service","layerId",["id"])],h.prototype,"readLayerId",null);a([b.property()],h.prototype,"url",null);a([b.writer("url")],h.prototype,"writeUrl",null);a([b.property({dependsOn:["layerId"]})],h.prototype,"parsedUrl",null);a([b.property()],h.prototype,"store",void 0);a([b.property({type:String})],h.prototype,"rootNode",void 0);a([b.reader("rootNode",["store.rootNode"])],
h.prototype,"readRootNode",null);return h=a([b.subclass("esri.layers.mixins.SceneService")],h)}(b.declared(c,p,t,h,l))})},"esri/layers/IntegratedMeshLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Layer ./mixins/SceneService ../symbols/support/ElevationInfo ../core/Error dojo/_base/lang".split(" "),function(B,r,f,a,b,c,t,p,h,l){return function(c){function q(a,b){a=c.call(this)||this;a.geometryType=
"mesh";a.operationalLayerType="IntegratedMeshLayer";a.type="integrated-mesh";a.elevationInfo=null;return a}f(q,c);q.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?l.mixin({},{url:a},b):a};q.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return a._verifyRootNodeAndUpdateExtent()});this.addResolvingPromise(b);return this};q.prototype._validateLayer=function(a){if(a.layerType&&
"IntegratedMesh"!==a.layerType)throw new h("integratedmeshlayer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new h("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new h("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,
supportedVersions:"1.x"});};a([b.shared("esri.layers.IntegratedMeshLayer")],q.prototype,"declaredClass",void 0);a([b.shared({"3d":"../views/3d/layers/SceneLayerView3D"})],q.prototype,"viewModulePaths",void 0);a([b.property({type:String,readOnly:!0})],q.prototype,"geometryType",void 0);a([b.property()],q.prototype,"operationalLayerType",void 0);a([b.property({json:{read:!1},readOnly:!0})],q.prototype,"type",void 0);a([b.property({type:p,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},
write:{target:"layerDefinition.elevationInfo"}}})],q.prototype,"elevationInfo",void 0);return q=a([b.subclass()],q)}(b.declared(c,t))})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ./TiledLayerView3D ./support/tiledLayerUtils".split(" "),function(B,r,f,a,b,c,t,p,h,l){return function(h){function q(){return null!==
h&&h.apply(this,arguments)||this}f(q,h);q.prototype.initialize=function(){var a=this,b=this.get("view.map.ground.layers");b&&-1!==b.indexOf(this.layer)||(b=new c("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(t.reject(b)));(b=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent))?this.addResolvingPromise(t.reject(b)):(b=p.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){l.throwIfError(a._getTileInfoCompatibilityError(a.tileInfo,
a.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(b));this.addResolvingPromise(l.checkArcGISServiceVersionCompatibility(this.layer));this.addResolvingPromise(this.getHeightModelInfoResolvingPromise());this._updateMinMaxDataLevel()};a([b.property({aliasOf:"layer.fullExtent"})],q.prototype,"fullExtent",void 0);a([b.property()],q.prototype,"layer",void 0);a([b.property({aliasOf:"layer.tileInfo"})],q.prototype,"tileInfo",void 0);return q=a([b.subclass("esri.views.3d.layers.ElevationLayerView3D")],
q)}(b.declared(h))})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Error ./LayerView3D ./support/LayerViewUpdatingPercentage ../terrain/terrainUtils".split(" "),function(B,r,f,a,b,c,t,p,h){return function(l){function p(){var a=null!==l&&l.apply(this,arguments)||this;a.minDataLevel=0;a.maxDataLevel=Infinity;a._numUpdating=0;a._maxNumUpdating=
0;a._isUpdating=!1;return a}f(p,l);Object.defineProperty(p.prototype,"formatIsTransparent",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"isTransparent",{get:function(){return 1>this.fullOpacity||this.formatIsTransparent},enumerable:!0,configurable:!0});p.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};p.prototype._evaluateUpdatingState=function(a){this._isUpdating=a;this.notifyChange("updating")};p.prototype.isUpdating=function(){return this._isUpdating};
p.prototype._getTileInfoSupportError=function(a,b){if(a=h.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.basemapTerrain.manifold)){b={layer:this.layer,error:a};var f=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":f=new c("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",b);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":f=new c("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",b);break;default:f=new c("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return f}return null};p.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new c("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};p.prototype._updateMinMaxDataLevel=function(){var a=
Infinity,b=0;this.tileInfo.lods.forEach(function(c){a=Math.min(c.level,a);b=Math.max(c.level,b)});c=[a,b];this.minDataLevel=c[0];this.maxDataLevel=c[1];var c};a([b.property({readOnly:!0})],p.prototype,"formatIsTransparent",null);a([b.property()],p.prototype,"fullExtent",void 0);a([b.property({readOnly:!0,dependsOn:["fullOpacity","formatIsTransparent"]})],p.prototype,"isTransparent",null);a([b.property()],p.prototype,"layer",void 0);a([b.property()],p.prototype,"minDataLevel",void 0);a([b.property()],
p.prototype,"maxDataLevel",void 0);a([b.property()],p.prototype,"tileInfo",void 0);return p=a([b.subclass("esri.views.3d.layers.TiledLayerView3D")],p)}(b.declared(t,p))})},"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/promiseUtils ../../../core/watchUtils ../../../geometry/support/heightModelInfoUtils ../../layers/LayerView".split(" "),
function(B,r,f,a,b,c,t,p,h){return function(h){function l(){var a=null!==h&&h.apply(this,arguments)||this;a.supportsHeightUnitConversion=!1;return a}f(l,h);l.prototype.getHeightModelInfoResolvingPromise=function(){return p.mayHaveHeightModelInfo(this.layer)?this._validateHeightModelInfo():c.resolve()};l.prototype._validateHeightModelInfo=function(){var a=this;return c.create(function(b,c){t.whenFalseOnce(a.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var h=p.rejectLayerError(a.layer,
a.view.heightModelInfo,a.supportsHeightUnitConversion);h?c(h):b()})})};a([b.property()],l.prototype,"view",void 0);return l=a([b.subclass("esri.views.3d.layers.LayerView3D")],l)}(b.declared(h))})},"esri/views/3d/layers/support/LayerViewUpdatingPercentage":function(){define(["../../../../core/Accessor"],function(B){return B.createSubclass([],{properties:{updating:{readOnly:!0},updatingPercentageValue:{value:100,readOnly:!0},updatingPercentage:{dependsOn:["updating","updatingPercentageValue"],readOnly:!0,
value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}},constructor:function(){}})})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(B,r,f,a,b,c){function t(a){var b=null,c=a.search(/\/rest\/services\//i);0<c&&(b=a.substring(0,c+6));return b}Object.defineProperty(r,"__esModule",{value:!0});r.checkArcGISServiceVersionCompatibility=
function(p){if(!c.isHostedAgolService(p.url)){if(10.22>p.version)return p=new a("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+p.version,{minVersion:10.22,detectedVersion:p.version}),b.reject(p);if(10.22!==p.version||c.isHostedSecuredProxyService(p.url,p.get("portalItem.id")))return b.resolve();p=t(p.url);var h=new a("tiledlayerview3d:service-missing-cors-patch","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");
return f(p+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(a){if(!a||a.error)throw h;}).otherwise(function(){throw h;})}};r.throwIfError=function(a){if(a)throw a;}})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../layers/FeatureLayer ./GraphicLayerView3DBase ../../../layers/graphics/controllers/SnapshotController ../../../core/watchUtils ../../../core/Error ../../../core/promiseUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q){return function(r){function t(a){var b=r.call(this)||this;b.labelingEnabled=a.layer instanceof c;return b}f(t,r);w=t;t.prototype.initialize=function(){this.addResolvingPromise(this.validateMaximumFeatureCount())};t.prototype.createController=function(){var a=this;return this.layer.createGraphicsController({layerView:this,options:{maxPageSize:300,extent:this.view.clippingArea}}).then(function(b){b instanceof p&&a._eventHandles.push(h.whenFalseOnce(a,"suspended",function(){b.startup()}));
return b}).otherwise(function(a){return q.reject(new l("featurelayerview3d:create-controller",a.message,{error:a}))})};t.prototype.validateMaximumFeatureCount=function(){return 0>w.maximumFeatureCount||!this.layer.url?q.resolve():this.layer.queryFeatureCount().then(function(a){if(a>w.maximumFeatureCount)throw new l("featurelayerview3d:maximum-feature-count-exceeded","The maximum number of allowed features (${maximumFeatureCount}) has been exceeded (layer has ${numberOfFeatures} features)",{maximumFeatureCount:w.maximumFeatureCount,
numberOfFeatures:a});})};t.maximumFeatureCount=-1;a([b.property()],t.prototype,"controller",void 0);return t=w=a([b.subclass("esri.views.3d.layers.FeatureLayerView3D")],t);var w}(b.declared(t))})},"esri/views/3d/layers/GraphicLayerView3DBase":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators dojo/promise/all ./graphics/Graphics3DLayerViewCore ./graphics/graphicUtils ./support/LayerViewUpdatingPercentage ../../../renderers/support/renderingInfoUtils ../support/PromiseLightweight ../../../core/watchUtils ./LayerView3D ./support/projectExtentUtils ../../../core/Error ../../../core/promiseUtils ../../../layers/graphics/QueryEngine".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E){return function(h){function n(a){a=h.call(this)||this;a.supportsHeightUnitConversion=!0;a.controller=null;a.supportsDraping=!0;a._overlayUpdating=null;a._progressMaxNumNodes=0;a._eventHandles=[];a._controllerClientSideFiltering=!1;a._suspendResumeExtent=null;a.fullExtentInViewSpatialReference=null;a._isUpdating=!1;a._controllerCreated=!1;return a}f(n,h);Object.defineProperty(n.prototype,"drawingOrder",{set:function(a){this._layerViewCore.graphicsCore.setDrawingOrder(a);
this._set("drawingOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"hasDraped",{get:function(){return this._layerViewCore.graphicsCore.hasDraped},enumerable:!0,configurable:!0});n.prototype.initialize=function(){var a=this;this._layerViewCore=new t({owner:this,layer:this.layer,spatialIndexRequired:!0,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,labelingEnabled:this.labelingEnabled,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,verticalScaleEnabled:this.supportsHeightUnitConversion,
highlightsEnabled:!0,updateSuspendResumeExtent:function(){return a.updateSuspendResumeExtent()},updateClippingExtent:function(b){return a.updateClippingExtent(b)}});this.addResolvingPromise(this._layerViewCore.initialize());this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this.initializeController();this.addResolvingPromise(this.validateGeometryType());var b=w.toView(this).then(function(b){a.fullExtentInViewSpatialReference=b});b&&this.addResolvingPromise(b);this.addResolvingPromise(this.getHeightModelInfoResolvingPromise());
this._evaluateUpdatingState()};n.prototype.destroy=function(){this._eventHandles.forEach(function(a){return a.remove()});this._eventHandles=null;this.controller&&(this.controller.destroy(),this.controller=null);this._layerViewCore&&(this._layerViewCore.destroy(),this._layerViewCore=null);this.loadedGraphics=null};n.prototype.getRenderingInfo=function(a){if((a=l.getRenderingInfo(a,{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a};n.prototype.getGraphicsFromStageObject=
function(a,b){var c=a.getMetadata().graphicId,h=null;this.loadedGraphics&&this.loadedGraphics.some(function(a){return a.uid===c?(h=a,!0):!1});a=new q.Promise;null!==h?a.done(h):a.reject();return a};n.prototype.getGraphics3DGraphics=function(){return this._layerViewCore.graphicsCore.getGraphics3DGraphics()};n.prototype.getGraphics3DGraphicsKeys=function(){return this._layerViewCore.graphicsCore.getGraphics3DGraphicsKeys()};n.prototype.getSymbolUpdateType=function(){return this._layerViewCore.graphicsCore.getSymbolUpdateType()};
n.prototype.queryGraphics=function(){return this._queryEngine?this._queryEngine.queryFeatures():this._rejectQuery()};n.prototype.queryFeatures=function(a){return this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()};n.prototype.queryObjectIds=function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()};n.prototype.queryFeatureCount=function(a){return this._queryEngine?this._queryEngine.queryFeatureCount(a):this._rejectQuery()};n.prototype.queryExtent=
function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()};n.prototype.whenGraphicBounds=function(a){return this._layerViewCore.graphicsCore.whenGraphicBounds(a)};n.prototype.highlight=function(a,b){return this._layerViewCore.highlight(a,b,this.layer.objectIdField)};n.prototype._rejectQuery=function(){return C.reject(new u("FeatureLayerView3D","Not ready to execute query"))};n.prototype._notifySuspendedChange=function(){this.notifyChange("suspended")};n.prototype._notifyDrapedDataChange=
function(){this.notifyChange("hasDraped");this.emit("draped-data-change")};n.prototype.canResume=function(){return this.inherited(arguments)&&this._layerViewCore&&this._layerViewCore.canResume()};n.prototype._evaluateUpdatingState=function(){if(this._layerViewCore.elevationAlignment){var a;a=0+this._layerViewCore.elevationAlignment.numNodesUpdating();a+=this._layerViewCore.graphicsCore.numNodesUpdating();var b;b=(b=(b=(b=(b=!this._controllerCreated)||this.controller&&this.controller.updating)||this._overlayUpdating)||
this._layerViewCore.graphicsCore.needsIdleUpdate())||!(this.view.basemapTerrain&&this.view.basemapTerrain.ready);var c;c=0<a||b||this._layerViewCore.spatialIndex.isUpdating();this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);0===a&&(this._progressMaxNumNodes=1);this._isUpdating=c;this.notifyChange("updating");this._set("updatingPercentageValue",b?100:100*a/this._progressMaxNumNodes)}else this._isUpdating=!1,this.notifyChange("updating"),this._set("updatingPercentageValue",100)};n.prototype.isUpdating=
function(){return this._isUpdating};n.prototype.initializeController=function(){var a=this,b=null,h=this.createController().then(function(a){b=a}),f=y.whenTrueOnce(this.view,"basemapTerrain.ready");c([this,f]).then(function(){a.controller=b;a._eventHandles.push(a.controller.watch("updating",function(){return a._evaluateUpdatingState()}));a.loadedGraphics=b.graphics;a._queryEngine=new E({features:a.loadedGraphics,objectIdField:a.layer.objectIdField});a._evaluateUpdatingState()}).always(function(){a._controllerCreated=
!0;a._evaluateUpdatingState()});this.addResolvingPromise(h)};n.prototype.updateClippingExtent=function(a){if(this.controller){if(this._controllerClientSideFiltering)return!1;this.controller.extent?(this.controller.extent=null,this._controllerClientSideFiltering=!0):this.controller.extent=a;return!0}return!1};n.prototype.updateSuspendResumeExtent=function(){return this._suspendResumeExtent=p.enlargeExtent(this._layerViewCore.graphicsCore.computedExtent,this._suspendResumeExtent,1.2)};n.prototype.validateGeometryType=
function(){var a=this.layer;switch(a.geometryType){case "multipatch":case "multipoint":return C.reject(new u("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:a.geometryType}))}};n.prototype.getStats=function(){var a=this._layerViewCore.graphicsCore.getGraphics3DGraphics(),b="null",c=this._suspendResumeExtent;c&&(b=[c[0],c[1],c[2],c[3]].map(function(a){return a.toPrecision(4)}).join(", "));var c="null",h=this._layerViewCore.graphicsCore.computedExtent;
h&&(c=[h.xmin,h.ymin,h.xmax,h.ymax].map(function(a){return a.toPrecision(4)}).join(", "));return{numCollection:this.loadedGraphics.length,numGraphics:Object.keys(a).length,numElevationUpdating:this._layerViewCore.elevationAlignment.numNodesUpdating(),numSpatialIndexUpdating:this._layerViewCore.spatialIndex.numNodesUpdating(),numGraphicsUpdating:this._layerViewCore.graphicsCore.numNodesUpdating(),visibilityFrustum:this._layerViewCore.frustumVisibility.canResume(),visibilityScale:this._layerViewCore.scaleVisibility.canResume(),
resumeExtent:b,computedExtent:c,updating:this.updating,suspended:this.suspended}};n.maximumFeatureCount=-1;a([b.property()],n.prototype,"drawingOrder",null);a([b.property()],n.prototype,"loadedGraphics",void 0);a([b.property()],n.prototype,"symbolsUpdating",void 0);a([b.property()],n.prototype,"hasDraped",null);a([b.property()],n.prototype,"controller",void 0);return n=a([b.subclass("esri.views.3d.layers.GraphicsLayerView3DBase")],n)}(b.declared(z,h))})},"esri/views/3d/layers/graphics/Graphics3DLayerViewCore":function(){define("require exports ../../../../core/HandleRegistry ../../../../core/watchUtils ../../../../core/promiseUtils ../../../../core/Collection ../../../../tasks/support/Query ../../../../Graphic ./Graphics3DCore ./Graphics3DLabeling ./Graphics3DScaleVisibility ./Graphics3DFrustumVisibility ./Graphics3DElevationAlignment ./Graphics3DSpatialIndex ./Graphics3DVerticalScale ./Graphics3DHighlights ../support/attributeUtils".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E){return function(){function r(b){var c=this;this._handles=new f;this.layer=b.layer;this.owner=b.owner;this.updateClippingExtent=b.updateClippingExtent;this.updateSuspendResumeExtent=b.updateSuspendResumeExtent;this.getGraphicsInExtent=b.getGraphicsInExtent;this.graphicsCore=new h(b.elevationFeatureExpressionEnabled);b.spatialIndexRequired&&(this.spatialIndex=new w);if(b.frustumVisibilityEnabled){this.frustumVisibility=new y;var n=this.owner.view.basemapTerrain;
this._handles.add([this.owner.view.on("resize",function(){return c.frustumVisibility.viewChange()}),this.owner.view.navigation.on("currentViewChanged",function(){return c.frustumVisibility.viewChange()}),n.on("elevation-bounds-change",function(){return c.frustumVisibility.elevationBoundsChange()})]);"local"===this.owner.view.viewingMode?this.frustumVisibility.isVisibleBelowSurface=!0:this._handles.add(a.init(n,["opacity","wireframe"],function(){return c.frustumVisibility.isVisibleBelowSurface=n.isSeeThrough()}))}b.scaleVisibilityEnabled&&
(b.spatialIndexRequired?(this.scaleVisibility=new q,this._handles.add(this.layer.watch("minScale,maxScale",function(){return c.scaleVisibility.layerMinMaxScaleChangeHandler()}))):console.warn("scaleVisibility requires a spatialIndex"));b.elevationAlignmentEnabled&&(this.elevationAlignment=new z,this._handles.add(this.layer.watch("elevationInfo",function(){return c.graphicsCore.elevationInfoChange()})));b.labelingEnabled&&(this.labeling=new l,this._handles.add(this.layer.watch("labelsVisible",function(){return c.labeling.labelVisibilityChanged()})),
this._handles.add(this.layer.watch("labelingInfo",function(){return c.labeling.updateLabelingInfo()})));b.verticalScaleEnabled&&(this.verticalScale=new u({sourceSpatialReference:this.layer.spatialReference,destSpatialReference:this.owner.view.spatialReference}));b.highlightsEnabled&&(this.highlights=new C)}r.prototype.initialize=function(){var a=this;return this.whenSpatialIndexLoaded().then(function(){return a.deferredInitialize()})};r.prototype.whenSpatialIndexLoaded=function(){return this.spatialIndex?
this.spatialIndex.whenLoaded():b.resolve()};r.prototype.deferredInitialize=function(){var a=this;this.spatialIndex&&this.spatialIndex.initialize(this.owner,this.layer,this.owner.view.spatialReference,this.graphicsCore);this.frustumVisibility&&this.frustumVisibility.initialize(this.owner);var b=this.owner.view.basemapTerrain,c=this.owner.view.elevationProvider;this.scaleVisibility&&this.scaleVisibility.initialize(this.owner,this.layer,this.spatialIndex,this.graphicsCore,b);this.elevationAlignment&&
this.elevationAlignment.initialize(this.owner,function(b,c,h){return a._getGraphicsInExtent(b,c,h)},this.graphicsCore,c);this.labeling&&this.labeling.initialize(this.owner,this.layer,this.spatialIndex,this.graphicsCore,this.scaleVisibility);this.highlights&&this.highlights.initialize(this.graphicsCore);this.graphicsCore.initialize(this.owner,this.layer,this.elevationAlignment,this.scaleVisibility,this.spatialIndex,this.labeling,this.highlights,function(){a.updateSuspendResumeExtent&&a._updateSuspendResumeExtent(a.updateSuspendResumeExtent())},
function(b){return a.verticalScale?a.verticalScale.adjust(b):b},b);this._handles.add([this.layer.watch("renderer",function(b){return a.graphicsCore.rendererChange(b)}),this.owner.watch("fullOpacity",function(){return a.graphicsCore.opacityChange()})]);this._handles.add(this.layer.on("graphic-update",function(b){return a.graphicsCore.graphicUpdateHandler(b)}));this.owner.view.resourceController.registerIdleFrameWorker(this,{needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate});this.updateClippingExtent&&
(this._handles.add(this.owner.view.watch("clippingArea",function(){return a._updateClippingExtent()})),this._updateClippingExtent());if(this.labeling)return this.labeling.updateLabelingInfo()};r.prototype.destroy=function(){this.owner&&this.owner.view.resourceController.deregisterIdleFrameWorker(this);this._handles&&(this._handles.destroy(),this._handles=null);this.frustumVisibility&&(this.frustumVisibility.destroy(),this.frustumVisibility=null);this.scaleVisibility&&(this.scaleVisibility.destroy(),
this.scaleVisibility=null);this.elevationAlignment&&(this.elevationAlignment.destroy(),this.elevationAlignment=null);this.labeling&&(this.labeling.destroy(),this.labeling=null);this.graphicsCore&&(this.graphicsCore.destroy(),this.graphicsCore=null);this.spatialIndex&&(this.spatialIndex.destroy(),this.spatialIndex=null);this.highlights&&(this.highlights.destroy(),this.highlights=null);this.owner=this.layer=null};r.prototype.highlight=function(a,b,h){var f=this;if(a instanceof t){b=this.highlights.acquireSet(b,
h);var l=b.set,n=b.handle;this.owner.queryObjectIds(a).then(function(a){return f.highlights.setObjectIds(l,a)});return n}if("number"===typeof a||a instanceof p)return this.highlight([a],b,h);a instanceof c&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof p)if(n=a,h&&n[0].attributes&&null!==E.attributeLookup(n[0].attributes,h))a=n.map(function(a){return E.attributeLookup(a.attributes,h)});else return a=n.map(function(a){return a.uid}),n=this.highlights.acquireSet(b,null),b=n.set,
n=n.handle,this.highlights.setUids(b,a),n;if("number"===typeof a[0])return n=this.highlights.acquireSet(b,h),b=n.set,n=n.handle,this.highlights.setObjectIds(b,a),n}return{remove:function(){}}};r.prototype.canResume=function(){return(!this.frustumVisibility||this.frustumVisibility.canResume())&&(!this.scaleVisibility||this.scaleVisibility.canResume())};r.prototype._needsIdleUpdate=function(){return this.frustumVisibility&&this.frustumVisibility.needsIdleUpdate()||this.scaleVisibility&&this.scaleVisibility.needsIdleUpdate()||
this.elevationAlignment&&this.elevationAlignment.needsIdleUpdate()||this.graphicsCore&&this.graphicsCore.needsIdleUpdate()?!0:!1};r.prototype._idleUpdate=function(a){this.frustumVisibility&&this.frustumVisibility.idleUpdate(a);this.scaleVisibility&&this.scaleVisibility.idleUpdate(a);this.elevationAlignment&&this.elevationAlignment.idleUpdate(a);this.graphicsCore&&this.graphicsCore.idleUpdate(a)};r.prototype._updateSuspendResumeExtent=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);
this.scaleVisibility&&this.scaleVisibility.setExtent(a)};r.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};r.prototype._getGraphicsInExtent=function(a,b,c){this.getGraphicsInExtent?this.getGraphicsInExtent(a,b,c):this.spatialIndex&&this.spatialIndex.intersects(a,b,c)};return r}()})},"esri/views/3d/layers/graphics/Graphics3DLabeling":function(){define("require exports dojo/promise/all ../../../../core/HandleRegistry ../../../../core/watchUtils ../../../../layers/support/LabelClass ../../../../symbols/callouts/calloutUtils ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/MaterialCollection ./Graphics3DWebStyleSymbol ./Graphics3DCalloutSymbolLayerFactory ./labelPlacement ../../support/debugFlags".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z){return function(){function r(){this.calloutMaterialCollection=this.hudMaterialCollection=this.textTextureAtlas=null;this.labelVisibilityDirty=!1;this.labelClasses=[];this.eventHandles=new a;this.graphicsCore=this.spatialIndex=this.layer=this.layerView=null}r.prototype.initialize=function(a,c,h,f,l){var n=this;this.layerView=a;this.layer=c;this.spatialIndex=h;this.graphicsCore=f;this.scaleVisibility=l;this.eventHandles.add(b.whenNot(this.layerView,"suspended",function(){return n.resume()}))};
r.prototype.destroy=function(){this.textTextureAtlas&&(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelClasses=null;this.eventHandles.destroy();this.graphicsCore=this.layer=this.layerView=this.eventHandles=null};r.prototype.clear=function(){this.layerView.view.deconflictor.setDirty();
this.textTextureAtlas&&(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null)};r.prototype.updateLabelingInfo=function(){var a=this;this.removeLabels();return this.layer.then(function(){a.scaleVisibility&&a.scaleVisibility.updateScaleRangeActive();var b=a.layer.labelingInfo&&a.layer.labelingInfo.filter(function(a){return!!a.symbol});
if(b&&0<b.length){var c=Array(b.length),b=b.map(function(b,h){var f=b.symbol,n;n=a.graphicsCore.getOrCreateGraphics3DSymbol(f);n=n instanceof l?n.graphics3DSymbol:n;var p=null;t.isCalloutSupport(f)&&f.hasVisibleCallout()&&(p=q.make(f,a.graphicsCore.symbolCreationContext));c[h]={labelClass:b,graphics3DSymbol:n,graphics3DCalloutSymbolLayer:p,options:b.getOptions()};return n});return f(b).then(function(){return c})}return null}).then(function(b){a.labelClasses=b;a.labelVisibilityChanged()})};r.prototype.createLabelsForGraphic=
function(a,b){var f=!1;if(this.labelClasses&&0!==this.labelClasses.length&&b._graphics[0]){for(var l=this.layerLabelsEnabled(),n=0;n<this.labelClasses.length;n++){var q=this.labelClasses[n],r=q.labelClass;if(c.evaluateWhere(r.where,a.attributes)&&(r=r.getLabelExpression(),r.expression)){var t=c.buildLabelText(r.expression,a,this.layer.fields,q.options);if(t){r=null;q.graphics3DSymbol&&q.graphics3DSymbol.symbol&&"label-3d"===q.graphics3DSymbol.symbol.type&&(r=q.graphics3DSymbol.symbol);var u=q.graphics3DSymbol.childGraphics3DSymbols[0],
w=y.get({graphic:a,graphics3DGraphic:b,labelSymbol:r,labelClass:q.labelClass});if(w.isValid){null==this.textTextureAtlas&&(this.textTextureAtlas=new p(this.layer.id,this.layerView.view._stage));null==this.hudMaterialCollection&&(this.hudMaterialCollection=new h(this.layerView.view._stage));n={text:t,centerOffset:w.centerOffset,translation:w.translation,elevationOffset:w.elevationOffset,screenOffset:w.screenOffset,anchor:w.anchor,needsOffsetAdjustment:w.needsOffsetAdjustment,centerOffsetUnits:w.centerOffsetUnits,
verticalOffset:w.verticalOffset,debugDrawBorder:z.LABELS_SHOW_BORDER};if(u=u.createGraphics3DGraphic(a,n,this.hudMaterialCollection,this.textTextureAtlas))u._labelClass=q.labelClass,b.addLabelGraphic(u,this.graphicsCore.labelStageLayer,this.graphicsCore.stage),this.spatialIndex&&!b.addedToSpatialIndex&&this.spatialIndex.shouldAddToSpatialIndex(a,b,this.scaleVisibility.scaleRangeActive())&&this.spatialIndex.addGraphicToSpatialIndex(a,b),b.setVisibilityFlag(0,l,1),b.setVisibilityFlag(1,void 0,1),this.layerView.view.deconflictor.initializeLabelVisibility(b),
f=!0,q.graphics3DCalloutSymbolLayer&&w.hasLabelVerticalOffset&&(null==this.calloutMaterialCollection&&(this.calloutMaterialCollection=new h(this.layerView.view._stage)),(l=q.graphics3DCalloutSymbolLayer.createGraphics3DGraphic(a,{symbol:r,needsOffsetAdjustment:w.needsOffsetAdjustment,translation:n.translation,elevationOffset:n.elevationOffset,screenOffset:n.screenOffset,centerOffset:n.centerOffset,centerOffsetUnits:n.centerOffsetUnits,materialCollection:this.calloutMaterialCollection}))&&b.addLabelGraphic(l,
this.graphicsCore.labelStageLayer,this.graphicsCore.stage));break}}}}f&&this.scaleVisibility&&this.scaleVisibility.updateGraphicLabelScaleVisibility(a,b)}};r.prototype.layerLabelsEnabled=function(){return this.layer.labelsVisible};r.prototype.getGraphics3DGraphics=function(){return this.graphicsCore.getGraphics3DGraphics()};r.prototype.getGraphics3DGraphicsKeys=function(){return this.graphicsCore.getGraphics3DGraphicsKeys()};r.prototype.labelVisibilityChanged=function(){var a=this;if(this.layerView.suspended)this.labelVisibilityDirty=
!0;else if(this.layerView.loadedGraphics){var b=this.layerLabelsEnabled();this.layerView.loadedGraphics.forEach(function(c){var h=a.graphicsCore.getGraphics3DGraphicById(c.uid);h&&(b&&0===h._labelGraphics.length&&a.createLabelsForGraphic(c,h),h.setVisibilityFlag(0,b,1))});this.layerView.view.deconflictor.setDirty();this.labelVisibilityDirty=!1}};r.prototype.elevationInfoChange=function(){this.labelClasses&&this.labelClasses.forEach(function(a){a.graphics3DSymbol.layerPropertyChanged("elevationInfo",
{})})};r.prototype.resume=function(){this.labelVisibilityDirty&&this.labelVisibilityChanged()};r.prototype.removeLabels=function(){var a=this;this.layerView.loadedGraphics&&(this.layerView.loadedGraphics.forEach(function(b){if(b=a.graphicsCore.getGraphics3DGraphicById(b.uid))b._labelGraphics&&b._labelGraphics.forEach(function(a){return a._labelClass=null}),b.clearLabelGraphics()}),this.labelClasses=null,this.layerView.view.deconflictor.setDirty())};return r}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ./Texture ./TextTexture ./ModelContentType ../../../webgl/Texture ../../../webgl/enums".split(" "),
function(B,r,f,a,b,c,t){var p=a.preferredAtlasSize(),h=function(){function a(a){this.textTextures={};this.dirty=!1;this._glTexture=null;this.id=f.idGen.gen(a)}a.prototype.getId=function(){return this.id};a.prototype.dispose=function(){};a.prototype.deferredLoading=function(){return!1};a.prototype.getWidth=function(){return p};a.prototype.getHeight=function(){return p};a.prototype.initializeThroughRender=function(a,b){b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=
!0;var h=this._drawToCanvas();this._glTexture=new c(a,b,h);this.dirty=!1;return this._glTexture};a.prototype.redraw=function(){if(this.dirty&&this._glTexture){var a=this._drawToCanvas();this._glTexture.setData(a);this.dirty=!1}};a.prototype.setUnloadFunc=function(a){this._unloadFunc=a};a.prototype.unload=function(){null!=this._unloadFunc&&(this._unloadFunc(this.id),this._unloadFunc=null)};a.prototype._drawToCanvas=function(){var b=a._create2Dcanvas(),c=b.getContext("2d");c.clearRect(0,0,p,p);for(var h in this.textTextures){var f=
this.textTextures[h];f.textTexture.renderText(f.placement.width,f.placement.height,c,f.placement.atlasOffX,f.placement.atlasOffY)}return b};a._create2Dcanvas=function(){a._textCanvas2D||(a._textCanvas2D=document.createElement("canvas"),a._textCanvas2D.setAttribute("id","canvas2d"),a._textCanvas2D.setAttribute("width",p.toString()),a._textCanvas2D.setAttribute("height",p.toString()),a._textCanvas2D.setAttribute("style","display:none"));return a._textCanvas2D};return a}();return function(){function a(a,
b){this._textureAtlasSubtextures=[];this._curLineHeight=this._curY=this._curX=0;this._idHint=a;this._stage=b}a.prototype.dispose=function(){for(var a=0;a<this._textureAtlasSubtextures.length;a++)this._stage.remove(b.TEXTURE,this._textureAtlasSubtextures[a].getId());this._textureAtlasSubtextures=[]};a.prototype.canHoldTextTexture=function(a){return a.getRenderedWidth()<=p&&a.getRenderedHeight()<=p};a.prototype.addTextTexture=function(a){for(var c=JSON.stringify(a.getParams())+"_"+a.getText(),f=0;f<
this._textureAtlasSubtextures.length;f++){var l=this._textureAtlasSubtextures[f].textTextures[c];if(null!=l)return l.placement}var q=null;0===this._textureAtlasSubtextures.length&&(q=new h(this._idHint),this._textureAtlasSubtextures.push(q));var f=a.getRenderedWidth(),l=a.getRenderedHeight(),r=f+2,t=l+2+2,B;this._curLineHeight=Math.max(this._curLineHeight,t);this._curX+r<p&&this._curY+this._curLineHeight<p||(this._curY+this._curLineHeight+t<p?(this._curX=0,this._curY+=this._curLineHeight):(q=new h(this._idHint),
this._textureAtlasSubtextures.push(q),this._curY=this._curX=0,this._curLineHeight=t));t=this._curX;B=this._curY;this._curX+=r;null!=q&&this._stage.add(b.TEXTURE,q);q=this._textureAtlasSubtextures[this._textureAtlasSubtextures.length-1];f={uvMinMax:[t/p,1-(B+l)/p,(t+f)/p,1-B/p],atlasOffX:t,atlasOffY:B,width:f,height:l,texture:q};q.textTextures[c]={placement:f,textTexture:a};q.dirty=!0;return f};return a}()})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports",
"./ModelContentType"],function(B,r,f){return function(){function a(a){this.materials={};this.stage=a}a.prototype.getMaterial=function(a){return this.materials[a]};a.prototype.addMaterial=function(a,c){this.materials[a]=c;this.stage.add(f.MATERIAL,c)};a.prototype.dispose=function(){for(var a in this.materials)this.stage.remove(f.MATERIAL,this.materials[a].getId());this.materials={}};return a}()})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/Logger ../../../../core/Scheduler ../../lib/glMatrix ../../webgl-engine/materials/HUDMaterial ./Graphics3DWebStyleSymbol".split(" "),
function(B,r,f,a,b,c,t){function p(a,f){switch(f.graphic.geometry.type){case "polyline":case "polygon":case "extent":a.anchor="center";break;case "point":var l=f.graphics3DGraphic,n=h(l.graphics3DSymbol).symbol.symbolLayers.getItemAt(0),l=l.getCenterObjectSpace();b.vec3d.set(l,a.translation);switch(n.type){case "icon":case "text":l=f.graphics3DGraphic;n=l._graphics[0].getScreenSize();l.isDraped()?a.hasLabelVerticalOffset||(a.anchor="center"):(l=void 0,void 0===l&&(l=G),f=f.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].materials[0],
f instanceof c?(f=f.getParams().anchorPos,l[0]=2*(f[0]-.5),l[1]=2*(f[1]-.5)):(l[0]=0,l[1]=0),f=l,E[0]=n[0]/2*(a.normalizedOffset[0]-f[0]),E[1]=n[1]/2*(a.normalizedOffset[1]-f[1]),a.screenOffset[0]=E[0],a.hasLabelVerticalOffset?(a.centerOffset[1]=E[1],a.centerOffsetUnits="screen"):a.screenOffset[1]=E[1]);break;case "object":f=f.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(),f=[f[3]-f[0],f[4]-f[1],f[5]-f[2]],a.centerOffset[0]=1.1*Math.max(f[0],f[1])/2*a.normalizedOffset[0],n=f[2]/2*a.normalizedOffset[1]+
a.translation[2],a.translation[2]=n*(1.1-1),a.elevationOffset=n,f=b.vec3d.length(f),a.centerOffset[2]=1.1*f/2*a.normalizedOffset[2]}}}function h(a){return a instanceof t?a.graphics3DSymbol:a}function l(a,b){var c=b.labelSymbol;b=b.graphics3DGraphic;var f=h(b.graphics3DSymbol).symbol;if("point-3d"===f.type&&f.supportsCallout()&&f.hasVisibleVerticalOffset()&&!b.isDraped())a.verticalOffset=q(f.verticalOffset);else if(c&&c.hasVisibleVerticalOffset()&&("point-3d"!==f.type||!f.supportsCallout()||!f.verticalOffset||
b.isDraped())){a:switch(a.placement){case "above-center":b=!0;break a;default:b=!1}b?(a.verticalOffset=q(c.verticalOffset),a.anchor="bottom",a.normalizedOffset=[0,a.normalizedOffset[1],0],a.hasLabelVerticalOffset=!0):(y.error("verticalOffset","Callouts and vertical offset on labels are currently only supported with above-center label placement (not with "+a.placement+" placement)"),a.isValid=!1)}}function q(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}
Object.defineProperty(r,"__esModule",{value:!0});var y=f.getLogger("esri.views.3d.layers.graphics.labelPlacement"),z=null;r.get=function(b){var c=b.labelClass.labelPlacement,f=w[c];f||(null!=c&&null==z&&(y.warn("labelPlacement","'"+c+"' is not a valid label placement"),z=a.schedule(function(){z.remove();z=null})),f=w["default"]);var c=b.graphics3DGraphic._graphics[0],h=c.graphics3DSymbolLayer.getGraphicElevationInfo(b.graphics3DGraphic.graphic),f={placement:f.placement,anchor:f.anchor,normalizedOffset:f.normalizedOffset,
needsOffsetAdjustment:c.isDraped()?void 0:h.hasOffsetAdjustment,verticalOffset:null,screenOffset:[0,0],centerOffset:[0,0,0,-1],centerOffsetUnits:"world",translation:[0,0,0],elevationOffset:0,hasLabelVerticalOffset:!1,isValid:!0};l(f,b);p(f,b);return f};var w={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},
"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},u={"above-center":["default",
"esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};
B=function(a){var b=w[a];u[a].forEach(function(a){w[a]=b})};for(var C in u)B(C);Object.freeze&&(Object.freeze(w),Object.keys(w).forEach(function(a){Object.freeze(w[a]);Object.freeze(w[a].normalizedOffset)}));var E=[0,0],G=[0,0]})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define(["require","exports"],function(B,r){function f(a,b){return null!==a&&0<a&&8E7>a||1E3<b}return function(){function a(){this._scaleRangeActive=!1;this.layerScaleRangeVisibilityDirty=this.layerScaleRangeVisibility=
!0;this.layerScaleRangeVisibilityQuery=!1;this.basemapTerrain=this.graphicsCore=this.extent=this.spatialIndex=this.layer=this.layerView=this.scaleChangeEventHandle=null}a.prototype.initialize=function(a,c,f,p,h){this.layerView=a;this.layer=c;this.spatialIndex=f;this.graphicsCore=p;this.basemapTerrain=h;this.updateScaleRangeActive()};a.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.graphicsCore=this.spatialIndex=
this.extent=this.layerView=null};a.prototype.needsIdleUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty};a.prototype.canResume=function(){return this.layerScaleRangeVisibility};a.prototype.setExtent=function(a){this.extent=a;this.layerScaleRangeVisibilityDirty=!0};a.prototype.idleUpdate=function(a){this.layerView.view.basemapTerrain&&!a.done()&&this.layerScaleRangeVisibilityDirty&&(this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=
!1)};a.prototype.scaleRangeActive=function(){return this._scaleRangeActive};a.prototype.updateScaleRangeActive=function(){var a=this;if(!this.spatialIndex)return this._scaleRangeActive=!1;var c=this.layer,r=!1;c.labelingInfo&&(r=r||c.labelingInfo.some(function(a){return a&&f(a.minScale,a.maxScale)}));r=r||f(c.minScale,c.maxScale);c=this._scaleRangeActive!==r;(this._scaleRangeActive=r)&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",
function(b){return a.scaleUpdateHandler(b)}):!r&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);return c};a.prototype.updateSuspendScaleVisibleFinish=function(a){this.layerScaleRangeVisibilityQuery=!1;this.layerScaleRangeVisibility!==a&&(this.layerScaleRangeVisibility=a,this.layerView._notifySuspendedChange())};a.prototype.updateSuspendScaleVisible=function(){var a=this,c=this.layerView.view.basemapTerrain;this.extent&&c&&this._scaleRangeActive?
this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,c.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(b){return a.updateSuspendScaleVisibleFinish(b)})):this.updateSuspendScaleVisibleFinish(!0)};a.prototype.visibleAtScale=function(a,c,f){return null==a?!0:a>f&&(!c||a<c)};a.prototype.visibleAtLayerScale=function(a){return this.visibleAtScale(a,this.layer.minScale,this.layer.maxScale)};a.prototype.visibleAtLabelScale=function(a,c){return this.visibleAtScale(a,
c.minScale,c.maxScale)};a.prototype.graphicScale=function(a,c){var b;c.centroid?b=c.centroid:"point"===a.geometry.type&&(b=a.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};a.prototype.graphicVisible=function(a,c){a=this.graphicScale(a,c);return this.visibleAtLayerScale(a)};a.prototype.updateGraphicScaleVisibility=function(a,c){return this._scaleRangeActive?(c.addedToSpatialIndex||this.spatialIndex.addGraphicToSpatialIndex(a,c),a=this.graphicVisible(a,
c),c.setVisibilityFlag(1,a)):!1};a.prototype.updateGraphicLabelScaleVisibility=function(a,c){if(!this._scaleRangeActive||!c._labelGraphics||0===c._labelGraphics.length)return!1;c.addedToSpatialIndex||this.spatialIndex.addGraphicToSpatialIndex(a,c);a=this.graphicScale(a,c);(c=this.updateLabelScaleVisibility(c,a))&&this.layerView.view.deconflictor.setDirty();return c};a.prototype.updateLabelScaleVisibility=function(a,c){if(!a._labelGraphics||0===a._labelGraphics.length)return!1;1<a._labelGraphics.length&&
console.warn("Multiple label classes are not supported");var b=a._labelGraphics[0]._labelClass;return b&&null!=b.minScale&&null!=b.maxScale&&(c=this.visibleAtLabelScale(c,b),a.setVisibilityFlag(1,c,1))?!0:!1};a.prototype.scaleUpdateHandler=function(a){var b=this;if(!this.layerView.suspended&&this.spatialIndex.hasGraphics()){var f=a.extent,p=a.scale;this.spatialIndex.intersects(f,a.spatialReference,function(a,c){for(var h=b.visibleAtLayerScale(p),l=!1,r=!1,t=0;t<c;t++){var u=b.graphicsCore.getGraphics3DGraphicById(a[t]);
if(u){var B=u.centroid;B&&(f[0]>B.x||f[1]>B.y||f[2]<B.x||f[3]<B.y)||(B=!1,u.setVisibilityFlag(1,h)&&(B=!0),b.updateLabelScaleVisibility(u,p)&&(B=!0),B&&(r=!0,u.isDraped()&&(l=!0)))}}r&&b.layerView.view.deconflictor.setDirty();l&&b.layerView._notifyDrapedDataChange()})}this.layerScaleRangeVisibilityDirty=!0};a.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(1,
void 0)}));this.layerScaleRangeVisibilityDirty=!0};return a}()})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../support/earthUtils ../../support/projectionUtils ../../support/intersectionUtils ../../support/mathUtils ../../support/aaBoundingBox ../../support/aaBoundingRect ../../lib/glMatrix".split(" "),function(B,r,f,a,b,c,t,p,h){var l=-.3*f.earthRadius;B=.5*Math.PI;var q=B/Math.PI*180,y=B*f.earthRadius,z=.9*f.earthRadius,w=function(){function f(){this.extent=
Array(4);this.planes=Array(4);this.maxSpan=0;this.center={origin:h.vec3d.create(),direction:h.vec3d.create()};for(var a=0;4>a;a++)this.extent[a]={origin:h.vec3d.create(),originLength:0,direction:h.vec3d.create(),cap:{next:null,direction:h.vec3d.create()}},this.planes[a]=h.vec4d.create();this.planes[4]=h.vec4d.create()}f.prototype.toRenderBoundingExtent=function(b,f,l,q){p.center(b,C);C[2]=q;a.computeLinearTransformation(l,C,E,f);h.mat4d.inverse(E,G);t.set(n,t.NEGATIVE_INFINITY);for(var r=0,w=u;r<
w.length;r++)for(var x=w[r],y=x.x0,z=x.x1,A=x.y0,x=x.y1,B=0;5>B;B++){var I=B/4;C[0]=c.lerp(b[y],b[z],I);C[1]=c.lerp(b[A],b[x],I);C[2]=q;a.vectorToVector(C,l,C,f);h.mat4d.multiplyVec3(G,C);t.expand(n,C)}h.mat4d.multiplyVec3(E,h.vec3d.set3(n[0],n[1],n[2],this.extent[0].origin));h.mat4d.multiplyVec3(E,h.vec3d.set3(n[3],n[1],n[2],this.extent[1].origin));h.mat4d.multiplyVec3(E,h.vec3d.set3(n[3],n[4],n[2],this.extent[2].origin));h.mat4d.multiplyVec3(E,h.vec3d.set3(n[0],n[4],n[2],this.extent[3].origin))};
f.prototype.update=function(a,b,c,f,l,n){l=this.extent;this.toRenderBoundingExtent(a,c,f,n);h.vec3d.add(l[0].origin,l[2].origin,this.center.origin);h.vec3d.scale(this.center.origin,.5);b(this.center.origin,this.center.direction);for(c=0;4>c;c++)f=l[c],b(f.origin,f.direction),f.originLength=h.vec3d.length(f.origin),n=l[3===c?0:c+1],f.cap.next=n.origin,h.vec3d.direction(n.origin,f.origin,f.cap.direction),this._computePlane(f.cap.direction,f.direction,f.origin,this.planes[c]);this._computePlane(l[1].cap.direction,
l[0].cap.direction,l[0].origin,this.planes[4]);this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]))};f.prototype.isVisibleInFrustumGlobal=function(a){if(0>h.vec3d.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>h.vec3d.dot(this.extent[b].direction,a.direction))return!0;return!1};f.prototype.isVisibleInFrustum=function(a,c,f){if("global"===a.viewingMode){if(this.maxSpan>(a.spatialReference.isWGS84?q:y))return!0;if(c.altitude()>=z)return this.isVisibleInFrustumGlobal(c)}for(a=
0;a<this.extent.length;a++)if(f=this.extent[a],b.frustumRay(c.planes,f.origin,null,f.direction)||b.frustumLineSegment(c.planes,f.origin,f.cap.next,f.cap.direction))return!0;for(a=0;a<c.lines.length;a++)if(f=c.lines[a],b.frustumLineSegment(this.planes,f.origin,f.endpoint,f.direction))return!0;return!1};f.prototype._computePlane=function(a,b,c,f){h.vec3d.cross(a,b,f);f[3]=-h.vec3d.dot(f,c)};return f}();f=function(){function a(){this.frustumVisibilityDirty=this.frustumVisibility=!0;this.extent=null;
this.extentEngine=new w;this.extentEngineDirty=!0;this.renderSREqualsViewSR=null;this._isVisibleBelowSurface=!1;this.layerView=null}a.prototype.initialize=function(a){this.layerView=a;this.renderSREqualsViewSR=a.view.renderSpatialReference.equals(a.view.spatialReference)};a.prototype.destroy=function(){this.extentEngine=this.extent=this.layerView=null};a.prototype.needsIdleUpdate=function(){return this.frustumVisibilityDirty};a.prototype.canResume=function(){return this.frustumVisibility};a.prototype.setExtent=
function(a){this.extent=a;this.frustumVisibilityDirty=this.extentEngineDirty=!0};a.prototype.viewChange=function(){this.frustumVisibilityDirty=!0};a.prototype.elevationBoundsChange=function(){this.extentEngineDirty=this.frustumVisibilityDirty=!0};Object.defineProperty(a.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this.extentEngineDirty=this.frustumVisibilityDirty=!0},enumerable:!0,configurable:!0});a.prototype.idleUpdate=function(a){!a.done()&&this.frustumVisibilityDirty&&
(this.updateSuspendFrustumVisible(),this.frustumVisibilityDirty=!1)};a.prototype.updateExtentEngine=function(){if(this.extentEngineDirty){this.extentEngineDirty=!1;var a=this.layerView.view,b=a.renderCoordsHelper.worldUpAtPosition,c;if(this._isVisibleBelowSurface)c=l;else{c=a.basemapTerrain.getElevationBounds();var f=c[0];c=f-Math.max(1,(c[1]-f)*(1.2-1))}this.extentEngine.update(this.extent,b,a.renderSpatialReference,a.spatialReference,this.renderSREqualsViewSR,c)}};a.prototype.updateSuspendFrustumVisible=
function(){if(this.extent){this.updateExtentEngine();var a=this.layerView.view.getFrustum(),a=this.extentEngine.isVisibleInFrustum(this.layerView.view,a,this._isVisibleBelowSurface);a!==this.frustumVisibility&&(this.frustumVisibility=a,this.layerView._notifySuspendedChange())}else this.frustumVisibility=!0};return a}();var u=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],C=h.vec3d.create(),E=h.mat4d.create(),G=h.mat4d.create(),n=t.create();return f})},"esri/views/3d/layers/graphics/Graphics3DVerticalScale":function(){define(["require",
"exports","../../../../geometry/support/scaleUtils"],function(B,r,f){return function(){function a(a){this.sourceSpatialReference=a.sourceSpatialReference;this.destSpatialReference=a.destSpatialReference}a.prototype.adjust=function(a){var b=this._getVerticalUnitScale();1!==b&&(a=a.slice(),this._scaleVerticalUnits(a,b));return a};a.prototype._getVerticalUnitScale=function(){if(this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)){var a=f.getMetersPerVerticalUnitForSR(this.sourceSpatialReference),
c=f.getMetersPerVerticalUnitForSR(this.destSpatialReference);return a/c}return 1};a.prototype._vertexListsScaleZ=function(a,c){for(var b=0;b<a.length;++b)for(var f=a[b],h=0;h<f.length;++h)f[h][2]*=c};a.prototype._scaleVerticalUnits=function(a,c){for(var b=0;b<a.length;++b){var f=a[b].geometry;if(f.hasZ)this._geometryIsPoint(f)?null!==f.z&&(f.z*=c):this._geometryIsPolyline(f)?this._vertexListsScaleZ(f.paths,c):this._geometryIsPolygon(f)&&this._vertexListsScaleZ(f.rings,c);else break}};a.prototype._geometryIsPoint=
function(a){return"point"===a.type};a.prototype._geometryIsPolygon=function(a){return"polygon"===a.type};a.prototype._geometryIsPolyline=function(a){return"polyline"===a.type};return a}()})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(B,r,f){return function(){function a(){this.graphicsCore=null;this.highlights=[]}a.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});
this.highlights=null};a.prototype.initialize=function(a){this.graphicsCore=a};a.prototype.acquireSet=function(a,c){var b=this,p=new f(a,c);this.highlights.push(p);return{set:p,handle:{remove:function(){return b.releaseSet(p)}}}};a.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,1)};a.prototype.setUids=function(a,c){var b=this.graphicsCore.graphics;c.forEach(function(c){a.ids.add(c);(c=b[c])&&c.addHighlight(a.highlightSet,
a.options)})};a.prototype.setObjectIds=function(a,c){var b=this.graphicsCore.graphics;c.forEach(function(b){return a.ids.add(b)});for(var f in b)(c=b[f])&&a.hasGraphic(c)&&c.addHighlight(a.highlightSet,a.options)};a.prototype.graphicCreated=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.addHighlight(b.highlightSet,b.options)})};a.prototype.graphicDeleted=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.removeHighlight(b.highlightSet)})};a.prototype.allGraphicsDeleted=
function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return a}()})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(B,r,f){return function(){function a(a,c){this.highlightSet=new f;this.ids=new Set;this.options=a;this.objectIdField=c}a.prototype.hasGraphic=function(a){return this.objectIdField?this.ids.has(a.graphic.attributes[this.objectIdField]):this.ids.has(a.graphic.uid)};
return a}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require","exports"],function(B,r){return function(){function f(){this.items=[]}f.prototype.addObject=function(a,b){this.items.push({type:"object",highlightId:b,object:a})};f.prototype.addRenderGeometry=function(a,b,c){this.items.push({type:"renderGeometry",highlightId:c,renderGeometry:a,renderer:b})};f.prototype.removeObject=function(a){for(var b=this.items.length-1;0<=b;--b){var c=this.items[b];"object"===c.type&&c.object===
a&&(c.object.removeHighlights(c.highlightId),this.items.splice(b,1))}};f.prototype.removeRenderGeometry=function(a){for(var b=this.items.length-1;0<=b;--b){var c=this.items[b];"renderGeometry"===c.type&&c.renderGeometry===a&&(c.renderer.removeRenderGeometryHighlight(c.renderGeometry,c.highlightId),this.items.splice(b,1))}};f.prototype.removeAll=function(){this.items.forEach(function(a){"object"===a.type?a.object.removeHighlights(a.highlightId):"renderGeometry"===a.type&&a.renderer.removeRenderGeometryHighlight(a.renderGeometry,
a.highlightId)});this.items=[]};return f}()})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});r.attributeLookup=function(f,a){a=a.toLowerCase();for(var b=0,c=Object.keys(f);b<c.length;b++){var r=c[b];if(r.toLowerCase()===a)return f[r]}return null}})},"esri/renderers/support/renderingInfoUtils":function(){define(["require","exports"],function(B,r){function f(a,c){if(!a||a.symbol)return null;c=c.renderer;
return a&&c&&c.getObservationRenderer?c.getObservationRenderer(a):c}function a(a,c){if(a.symbol)return a.symbol;var b=f(a,c);return b&&b.getSymbol(a,c)}Object.defineProperty(r,"__esModule",{value:!0});r.getRenderer=f;r.getSymbol=a;r.getRenderingInfo=function(b,c){var r=f(b,c),p=a(b,c);if(!p)return null;p={renderer:r,symbol:p};if(r){r.colorInfo&&(p.color=r.getColor(b).toRgba());if(r.sizeInfo){var h=r.getSize(b);p.size=[h,h,h]}if(r.visualVariables){b=r.getVisualVariableValues(b,c);h=["proportional",
"proportional","proportional"];for(c=0;c<b.length;c++){var l=b[c],r=l.variable,q=l.value;"color"===r.type?p.color=q.toRgba():"size"===r.type?"outline"===r.target?p.outlineSize=q:(l=r.axis,r=r.useSymbolValue?"symbolValue":q,"width"===l?h[0]=r:"depth"===l?h[1]=r:"height"===l?h[2]=r:h[0]="width-and-depth"===l?h[1]=r:h[1]=h[2]=r):"opacity"===r.type?p.opacity=q:"rotation"===r.type&&"tilt"===r.axis?p.tilt=q:"rotation"===r.type&&"roll"===r.axis?p.roll=q:"rotation"===r.type&&(p.heading=q)}if(isFinite(h[0])||
isFinite(h[1])||isFinite(h[2]))p.size=h}}return p}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require","exports","../../../../portal/support/geometryServiceUtils","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils"],function(B,r,f,a,b){Object.defineProperty(r,"__esModule",{value:!0});r.toView=function(c){var r=c.view.spatialReference,p=c.layer.fullExtent&&c.layer.fullExtent.spatialReference;return!p||p.equals(r)||"local"!==c.view.viewingMode?
a.resolve(null):b.canProject(p,r)?a.resolve(b.project(c.layer.fullExtent,r)):f.projectGeometry(c.layer.fullExtent,r,c.layer.portalItem).then(function(a){if(!c.destroyed&&a)return a}).otherwise(function(){return null})}})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../layers/IntegratedMeshLayer ../../../core/arrayUtils ../../../core/watchUtils ../../../core/promiseUtils ../../../core/Logger ../../../core/Collection ../../../core/lang ../../../geometry/support/scaleUtils ../../../symbols/support/unitConversionUtils dojo/_base/lang dojo/has ../../../Graphic ../../../symbols/Symbol3D ../../../tasks/support/Query ./LayerView3D ./i3s/I3SUtil ./i3s/I3SBinaryReader ./i3s/I3SElevationProvider ./i3s/I3SProjectionUtil ./i3s/I3SQueryEngine ./i3s/Highlights ./i3s/FeatureChangeNotifier ./graphics/graphicUtils ./support/LayerViewUpdatingPercentage ../support/projectionUtils ../support/aaBoundingBox ../webgl-engine/Stage ../webgl-engine/lib/Layer ../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryData ../webgl-engine/lib/Object3D ../webgl-engine/lib/Texture ../webgl-engine/materials/Material ./support/attributeUtils ../webgl-engine/lib/Util ../lib/glMatrix".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q,S,P,O,T,U,W,k,ca,V,e,d,g,m,v){function D(a,b,c,d){var f=!1,g;b.encoding===x.DDS_ENCODING_STRING?g=e.DDS_ENCODING:f=!(m.isPowerOfTwo(a.width)&&m.isPowerOfTwo(a.height));a=b.usedByEngineMats.some(function(a){return a.getParams().atlasRegions})||b.atlas;c=(c||!a)&&!f;return{mipmap:c,wrapClamp:a||!b.wrap,disableAnisotropy:a&&c&&d,encoding:g,noUnpackFlip:!0}}var L=U.ModelContentType,R=l.getLogger("esri.views.3d.layers.SceneLayerView3D"),Z=
[1,1,1,1],ba=[.8,.8,.8],ja=[.5,.5,.5];B=function(l){function r(){var a=null!==l&&l.apply(this,arguments)||this;a._queryEngine=null;a._highlights=new M(a);a._elevationProvider=null;a._featureChangeNotifier=null;a._controllerCreated=!1;a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=20;return a}f(r,l);Object.defineProperty(r.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":
"probably-not":"unknown"},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=z.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=w.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});r.prototype.initialize=function(){var a=this;x.checkSceneLayerValid(this.layer);x.checkSceneLayerCompatibleWithView(this.layer,
this.view);this.addResolvingPromise(this.getHeightModelInfoResolvingPromise());var b=this.layer.version,b=!C("trident")||1<b.major||1===b.major&&3<b.minor;this._useCompressedTextures=this.view.has("s3tc")&&b;this._disableAtlasAnisotropy=(this._enableAtlasMipMaps=this.view.has("standardDerivatives"))&&!this.view.has("shaderTextureLOD");this._initGraphicsController();this.maxGpuMemory=1E3;this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._matId2Meta=
{};this._texId2Meta={};this._nodeId2Meta={};for(var b=new Uint8Array(256),c=0;c<b.length;c++)b[c]=255;this._whiteTexture=new e(b,"white",{width:8,height:8});this._stage.add(L.TEXTURE,this._whiteTexture);this._addThisLayerToStage();this._elevationProvider=new K({layerView:this,stageLayer:this._stageLayer});this.handles.add([p.init(this.view,"clippingArea",function(){return a._clippingAreaChanged()}),p.init(this.layer,"renderer",function(b){return a._rendererChange(b)}),p.init(this.layer,"objectIdFilter",
function(){return a._filterChange()}),p.init(this.layer,"elevationInfo",function(){return a._elevationInfoChanged()}),p.init(this,"_controller.parsedDefinitionExpression",function(){return a._filterChange()}),p.watch(this,"fullOpacity",function(b){return a._opacityChange(b)}),p.watch(this,"elevationOffset",function(){return a._elevationOffsetChange()}),p.init(this,"suspended",function(b){return a.setVisibility(!b)})],"sceneLayerHandles")};r.prototype.destroy=function(){this.handles.remove("sceneLayerHandles");
this._stage.remove(L.TEXTURE,this._whiteTexture.getId());this._removeThisLayerFromStage();this._stage=null;null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=this._texId2Meta=this._matId2Meta=null};r.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};r.prototype.isUpdating=function(){return this._controllerCreated?!(!this._controller||!this._controller.updating):
!0};r.prototype.memEstimateTextureAdded=function(a){a=a.getEstimatedTexMemRequiredMB();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a};r.prototype.memEstimateTextureRemoved=function(a){a=a.getEstimatedTexMemRequiredMB();this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};r.prototype.memEstimateGeometryAdded=function(a){a=a.estimateGpuMemoryUsage()/1E6;this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a};r.prototype.memEstimateGeometryRemoved=function(a){a=a.estimateGpuMemoryUsage()/1E6;this.gpuMemoryEstimate-=
a;this.geoMemoryEstimate-=a};r.prototype.isBundleAlreadyAddedToStage=function(a,b){return null!=this._nodeId2Meta[a.id]&&null!=this._nodeId2Meta[a.id].engineObjectsPerBundle&&null!=this._nodeId2Meta[a.id].engineObjectsPerBundle[b]};r.prototype._initGraphicsController=function(){var a=this;this.layer.createGraphicsController({layerView:this,layerViewRequiredFunctions:{addBundle:function(b,c,d){return a._addBundle(b,c,d)},isBundleAlreadyAddedToStage:function(b,c){return a.isBundleAlreadyAddedToStage(b,
c)},isOverMemory:function(){return a._isOverMemory()},removeNodeData:function(b){return a._removeNodeDataFromStage(b.id)},getAddedNodeIDs:function(){return a._getAddedNodeIDs()},areAllBundlesLoaded:function(b){return a._areAllBundlesLoaded(b)}},layerViewOptionalFunctions:{setPolygonOffset:function(b,c){return a._setPolygonOffset(b,c?1:0)},traversalOptions:{initDepthFirst:!0,neighborhood:!0,perLevelTraversal:!1,allowPartialOverlaps:!1},textureOptions:{useCompressedTextures:this._useCompressedTextures},
getLoadedAttributes:function(b){return a._getLoadedAttributes(b)},setAttributeData:function(b,c,d){return a._setAttributeData(b,c,d)}}}).then(function(b){a._controller=b;a._featureChangeNotifier=new Q.FeatureChangeNotifier(a,b);b.watch("rootNodeVisible",function(){a.notifyChange("suspended")})}).always(function(){a._controllerCreated=!0;a.notifyChange("updating")})};r.prototype.setMaxGpuMemory=function(a){this.maxGpuMemory=a};r.prototype.setVisibility=function(a){if(this._stage&&this._stageLayer){var b=
this._stageLayer.getId(),c=0<=this._stage.getViewContent().indexOf(b);!!a!==c&&(b=[b],a?(this._stage.addToViewContent(b),a=this._isIntegratedMesh()?"im":"scene",this.view.elevationProvider.register(a,this._elevationProvider),this._elevationProvider.visibilityChanged()):(this._stage.removeFromViewContent(b),this._elevationProvider.visibilityChanged(),this.view.elevationProvider.unregister(this._elevationProvider)))}};r.prototype.getStats=function(){var a={nodesInIndex:0,knownFeatures:0,activeMaterials:0,
"Total GPU Memory Estimate":this.gpuMemoryEstimate+"MB","Geometry Memory Estimate":this.geoMemoryEstimate+"MB","Texture Memory Estimate":this.texMemoryEstimate+"MB"};if(!this._controller)return a;a.nodesInIndex=Object.keys(this._controller.nodeIndex).length;a.activeMaterials=Object.keys(this._matId2Meta).length;return a};r.prototype._addThisLayerToStage=function(){var a=this._stage;this._initTexture=new e(null,"i3sInitTexture");a.add(L.TEXTURE,this._initTexture);var b=this.layer.id;this._stageLayer=
b=new W(b,{},b);a.add(L.LAYER,b)};r.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var a=this._stage;a.remove(L.TEXTURE,this._initTexture.getId());this._removeAllNodeDataFromStage();m.assert(m.objectEmpty(this._nodeId2Meta));m.assert(m.objectEmpty(this._matId2Meta));m.assert(m.objectEmpty(this._texId2Meta));a.remove(L.LAYER,this._stageLayer.getId());this._matId2Meta={};this._texId2Meta={};this._nodeId2Meta={};this._stageLayer=void 0;this.gpuMemoryEstimate=0}};r.prototype._getLoadedAttributes=
function(a){if((a=this._nodeId2Meta[a.id])&&1===a.engineObjects.length)return a.engineObjects[0].getMetadata().loadedAttributes};r.prototype._setAttributeData=function(a,b,c){var d=this._nodeId2Meta[a.id];if(d&&1===d.engineObjects.length){var d=d.engineObjects[0],e=d.getMetadata();e.loadedAttributes=b;e.attributeData=c;this._setObjectSymbology(d);this._applyFilters(a);this._elevationProvider.visibilityChanged(d)}};r.prototype._isOverMemory=function(){if(this.gpuMemoryEstimate>this.maxGpuMemory&&this.gpuMemoryEstimate!==
this.warnGpuMemoryEstimate){this.warnGpuMemoryEstimate=this.gpuMemoryEstimate;var a=function(a){return a.toLocaleString(void 0,{maximumFractionDigits:1})+" Mb"};R.warn("GPU Memory Limit exceeded!\nLimit: "+a(this.maxGpuMemory)+" Current: "+a(this.gpuMemoryEstimate)+"\n(Textures: "+a(this.texMemoryEstimate)+" Geometry: "+a(this.geoMemoryEstimate)+")")}return this.gpuMemoryEstimate>this.maxGpuMemory};r.prototype._getAddedNodeIDs=function(){return Object.keys(this._nodeId2Meta)};r.prototype._calcEngineMaterialTransparencyParams=
function(a,b,c){var d=this.fullOpacity,e=1-m.clamp(m.fallbackIfUndefined(b.transparency,0),0,1);a=1>e||1>d||a&&y.endsWith(a.channels,"a")||!0===b.useVertexColorAlpha||c;return{opacity:e,layerOpacity:d,transparent:a}};r.prototype._calcEngineMaterialDoubleSidedParams=function(a){return null!=a.doubleSided?a.doubleSided:!0};r.prototype._calcEngineMaterialCullFaceParams=function(a){return a.cullFace?a.cullFace:null!=a.doubleSided?a.doubleSided?"none":"back":"none"};r.prototype._createEngineMaterial=function(a,
b,c,f,g){var h,k;null!=a&&(h=(k=this._texId2Meta[b])&&k.engineTex?k.engineTex.getId():this._initTexture.getId());var l=c.params,n=m.fallbackIfUndefined(l.diffuse,ba),p,q;null!=a&&(q=x.getAppropriateTextureEncoding(a.encoding,this._useCompressedTextures),p=-1<q?a.encoding[q]:a.encoding);"standard"!==c.type&&R.warn("Unknown material type '"+c.type+"', must be 'standard'");void 0===l.reflectivity&&R.warn("Material parameter 'reflectivity' is missing.");c=this._isIntegratedMesh();h={ambient:n,diffuse:n,
specular:m.fallbackIfUndefined(l.specular,ja),shininess:m.fallbackIfUndefined(l.shininess,64),atlasRegions:l.vertexRegions,textureId:h,vertexColors:this._hasVertexColors(),symbolColors:this._hasSymbolColors(),flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(l),cullFace:this._calcEngineMaterialCullFaceParams(l),writeStencil:c,receiveSSAO:!c,groundNormalShading:c};c||(n=this._calcEngineMaterialTransparencyParams(a,l),u.mixin(h,n));h=new d(h,f);h.metadata={i3sMatId:f,i3sTexId:b,i3sTex:a,
i3sMatParams:l};if(null!=a&&(k?k.usedByEngineMats.push(h):(k={id:b,usedByEngineMats:[h],images:a.images,encoding:p,encodingIdx:q,atlas:!0===a.atlas,wrap:"none"!==a.wrap[0]||"none"!==a.wrap[1]},this._texId2Meta[b]=k),null!=g[b]))for(null==k.engineTex&&(a=g[b].data,g=D(a,k,this._enableAtlasMipMaps,this._disableAtlasAnisotropy),k.engineTex=new e(a,k.id,g),this._stage.add(L.TEXTURE,k.engineTex),this.memEstimateTextureAdded(k.engineTex)),a=k.engineTex.getId(),g=0,k=k.usedByEngineMats;g<k.length;g++)k[g].setParameterValues({textureId:a});
this._matId2Meta[f]||(this._matId2Meta[f]={});this._matId2Meta[f][b]={engineMat:h,refCount:1};return h};r.prototype._createVertexArrays=function(a,b,c){var d=a.params.vertexAttributes;a={};for(var e=0,f=Object.keys(d);e<f.length;e++){var g=f[e];if("classification"!==g&&(c||g!==m.VertexAttrConstants.NORMAL)){var h=d[g],k=I.valueType2TypedArrayClassMap[h.valueType];if(null!=k){var l=new k(b,h.byteOffset,h.count*h.valuesPerElement),k=new k(l);a[g]={data:k,size:h.valuesPerElement}}else R.error("unsupported vertex attribute value type: "+
h.valueType)}}b=Array.isArray(d.position)?d.position.length/3:d.position.count;if(this._hasVertexColors()&&null==a[m.VertexAttrConstants.COLOR])for(d=new Uint8Array(4*b),a[m.VertexAttrConstants.COLOR]={data:d,size:4},e=0;e<d.length;e++)d[e]=255;this._hasSymbolColors()&&(d=new Uint8Array(4*b),a[m.VertexAttrConstants.SYMBOLCOLOR]={data:d,size:4});c&&null==a[m.VertexAttrConstants.NORMAL]&&(d=new Float32Array(3*b),a[m.VertexAttrConstants.NORMAL]={data:d,size:3});return a};r.prototype._hasNonWhiteColors=
function(a){if("color"in a){a=a.color.data;for(var b=0;b<a.length;b++)if(255!==a[b])return!0}return!1};r.prototype._createEngineMats=function(a,b,c){var d=a.params.materialID,e=b.materialDefinitions[d];m.assert(void 0!==e,"geometry wants unknown material "+d);a=a.params.textureID||"none";var f;"none"!==a&&(null!=b.textureDefinitions&&null!=b.textureDefinitions[a]||R.warn("textureDefinitions missing in shared resource"),f=b.textureDefinitions[a]);this._matId2Meta[d]&&this._matId2Meta[d][a]?(c=this._matId2Meta[d][a],
b=c.engineMat,c.refCount++):b=this._createEngineMaterial(f,a,e,d,c);return[b]};r.prototype._areAllBundlesLoaded=function(a){if(null==this._nodeId2Meta[a.id]||null==this._nodeId2Meta[a.id].engineObjectsPerBundle)return!1;for(var b=0;b<a.featureData.length;b++)if(null==this._nodeId2Meta[a.id].engineObjectsPerBundle[b])return!1;return!0};r.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};r.prototype._findGraphicNodeAndIndex=function(a){a=g.attributeLookup(a.attributes,
this._getObjectIdField());for(var b=0,c=Object.keys(this._nodeId2Meta);b<c.length;b++)for(var d=c[b],e=this._nodeId2Meta[d].engineObjects,f=0;f<e.length;f++){var h=e[f].getMetadata().featureIds.indexOf(a);if(-1!==h)return{node:this._controller.nodeIndex[d],nodeId:d,bundleNr:f,index:h}}return null};r.prototype._getGraphicIndices=function(a,b,c){a=this._nodeId2Meta[a.id].engineObjects;if(!a||!a[b])return[];b=a[b].getMetadata();a=[];for(var d=this._getObjectIdField(),e=0;e<c.length;e++){var f=g.attributeLookup(c[e].attributes,
d),f=b.featureIds.indexOf(f);-1!==f&&a.push(f)}return a};r.prototype.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(null!=a&&(a=this._boundingBoxCornerPoints(a.index,this._nodeId2Meta[a.nodeId].engineObjects[a.bundleNr],new Float64Array(24)),O.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))){var b=T.create(T.NEGATIVE_INFINITY);T.expandBuffer(b,a,0,8);return h.resolve({boundingBox:b,screenSpaceObjects:[]})}return h.reject()};r.prototype.whenGraphicAttributes=
function(a,b){var c=this;return x.whenGraphicAttributes(this.layer,[a],this._getObjectIdField(),b,function(){var b=c._findGraphicNodeAndIndex(a);return{node:b.node,indices:[b.index]}}).then(function(a){return a[0]})};r.prototype.getGraphicsFromStageObject=function(a,b){if(this.layer instanceof c)return h.reject();var d=a.getMetadata();a=a.getFaceRangeIndexFromTriangleNr(b);return null!=a&&null!=d.featureIds&&a<d.featureIds.length?(d=this._createGraphic(a,d),h.resolve(d)):h.reject()};r.prototype._addBundle=
function(a,b,c){if(this._isOverMemory())return h.reject();var d=c.allGeometryData,e=c.attributeDataInfo,f=c.geometryBuffers,g=c.preloadedDomImages,l=c.sharedResource;c=this._stage;var m={};m[L.OBJECT]={};m[L.GEOMETRY]={};m[L.MATERIAL]={};m[L.TEXTURE]={};var n=this._stageLayer,p=n.getId();if(null!=this._nodeId2Meta[a.id]&&null!=this._nodeId2Meta[a.id].engineObjectsPerBundle&&this._nodeId2Meta[a.id].engineObjectsPerBundle[b])return this._applyFilters(a),h.resolve();null==this._nodeId2Meta[a.id]&&(this._nodeId2Meta[a.id]=
{engineObjects:[],engineObjectsPerBundle:[]});this._nodeId2Meta[a.id].engineObjectsPerBundle[b]=[];for(var q=0,r=this._hasColors,u=0;u<d.length;u++){for(var t=d[u],w=t.faceRanges,y=t.componentOffsets,z=t.featureIds,A=f[a.geometryData[b].hrefConcat],B=a.id+"|"+z[0],C=[],D=[],E=[],G=void 0,I=function(b){var c=!K._isIntegratedMesh(),d=K._createVertexArrays(b,A,c),e=K._createEngineMats(b,l,g);r=r||K._hasNonWhiteColors(d);var f=new ca(d,ca.DefaultIndices,y||ca.DefaultOffsets),h=K._controller.crsIndex,
n=K._controller.crsVertex,p=K.view.renderSpatialReference,q=v.vec4d.set(a.mbs,ha);q[2]+=K.elevationOffset;G=J.reprojectPoints(J.ReprojectionTypes.PER_VERTEX,d.position.data,q,h,n,p);c&&K._controller.isMeshPyramid&&x.processNormals({normals:f.vertexAttributes.normal.data,positions:f.vertexAttributes.position.data,normalInd:f.indices.normal,positionInd:f.indices.position},K.layer.normalReferenceFrame||"none",function(a,b){return J.reprojectNormalsPerVertex(a,q,h,b,p)});c=G.localTrafo;null!=b.transformation&&
(b=v.mat4d.create(b.transformation),v.mat4d.multiply(c,b,c));b=C.length;f=new k(f,B+(0<b?"_"+b:""));C.push(f);D.push(c);E.push(e);K.memEstimateGeometryAdded(f.getData());for(b=0;b<e.length;b++)c=e[b],m[L.MATERIAL][c.getId()]=c;m[L.GEOMETRY][f.getId()]=f},K=this,M=0,t=t.geometries;M<t.length;M++)I(t[M]);w={i3sNode:a.id,ceLayer:p,faceRanges:w,featureIds:z,attributeData:e?e.attributeData:null,loadedAttributes:e?e.loadedAttributes:null,layerUid:this.layer.uid};q+=null!=w.featureIds?w.featureIds.length:
1;w=new V({idHint:a.id,name:B,geometries:C,materials:E,transformations:D,castShadow:!0,metadata:w});z=v.mat4d.create();v.mat4d.identity(z);v.mat4d.multiply(z,G.globalTrafo,z);w.setObjectTransformation(z);this._nodeId2Meta[a.id].engineObjectsPerBundle[b].push(w);this._nodeId2Meta[a.id].engineObjects.push(w);m[L.OBJECT][w.getId()]=w;this._setObjectSymbology(w);this._applyFilters(a);this._highlights.objectCreated(w);this._elevationProvider.objectCreated(w)}c.beginMod();b=m[L.OBJECT];for(var Y in b)b.hasOwnProperty(Y)&&
n.addObject(b[Y]);for(var N in m)if(m.hasOwnProperty(N)){Y=m[N];for(var fa in Y)Y.hasOwnProperty(fa)&&null==c.get(N,fa)&&c.add(N,Y[fa])}c.endMod();!this._hasTextures&&null!=a.textureData&&0<a.textureData.length&&(this._hasTextures=!0);this._hasColors=r;this._hasData=!0;this.notifyChange("hasTexturesOrVertexColors");this._featureChangeNotifier.notify(q,0);return h.resolve()};r.prototype._clippingAreaChanged=function(){var a=this,b=[];O.extentToBoundingBox(this.view.clippingArea,b,this.view.renderSpatialReference)?
this._clippingArea=b:this._clippingArea=null;this._updateFilters();if(this._controller){var c=this._controller.nodeIndex;c&&Object.keys(this._nodeId2Meta).forEach(function(b){return a._applyFilters(c[b])});this._controller.updateClippingArea(this.view.clippingArea)}};r.prototype._filterChange=function(){this._updateFilters();if(this._controller){var a=this._controller.nodeIndex;if(a)for(var b=0,c=Object.keys(this._nodeId2Meta);b<c.length;b++)this._applyFilters(a[c[b]])}};r.prototype._updateFilters=
function(){var a=this,b=[];if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),d="include"===this.layer.objectIdFilter.method;c.sort();b.push(function(b,e){return a._objectIdFilter(c,d,e)})}if(this._controller&&this._controller.parsedDefinitionExpression&&this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var e=this._controller.parsedDefinitionExpression,f=this._controller.definitionExpressionFields;b.push(function(b,c){return a._sqlFilter(b,
e,f,c)})}this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,a._clippingArea,c)});this._filters=b};r.prototype._sqlFilter=function(a,b,c,d){var e={},f=new E(null,null,e);f.layer=this.layer;var h=this.layer.objectIdField,g=0,k=0,l=function(a){var l=a.getMetadata();a=l.featureIds;for(var n=l.attributeData,l=c.every(function(a){return null!=n[a]||a===h}),p=0;p<a.length&&g<d.length;p++)if(d[g]===a[p]){var q=!0;if(l){e[h]=a[p];for(var q=0,r=c;q<r.length;q++){var u=r[q];u!==h&&(e[u]=
x.getCachedAttributeValue(n[u],p))}q=m._evaluateClause(b,f)}q&&(d[k]=d[g],k++);g++}},m=this,n=0;for(a=this._nodeId2Meta[a.id].engineObjects;n<a.length;n++)l(a[n]);d.length=k};r.prototype._evaluateClause=function(a,b){try{return a.testFeature(b)}catch(wa){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&R.error("Error while evaluating definitionExpression: "+wa),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&R.error("Further errors are ignored"),
!1}};r.prototype._objectIdFilter=function(a,b,c){for(var d=0,e=0;d<c.length;)0<=t.binaryIndexOf(a,c[d])===b&&(c[e]=c[d],e++),d++;c.length=e};r.prototype._boundingboxFilter=function(a,b,c){var d=[0,0,0,0];O.mbsToMbs(a.mbs,this._controller.crsIndex,d,this.view.renderSpatialReference);d=null!=b?x.intersectBoundingBoxWithMbs(b,d):2;if(2!==d){var e=0,f=0;for(a=this._nodeId2Meta[a.id].engineObjects;f<a.length;f++){var h=a[f],g=h.getMetadata().featureIds;if(0===d){for(var k=0,h=0;h<g.length&&e+k<c.length;h+=
1)c[e+k]===g[h]&&k++;c.splice(e,k)}else{var l=h.getObjectTransformation(),k=h.getGeometryRecords()[0].getShaderTransformation();v.mat4d.multiply(l,k);if(0===l[1]&&0===l[2]&&0===l[3]&&0===l[4]&&0===l[6]&&0===l[7]&&0===l[8]&&0===l[9]&&0===l[11]&&1===l[15])for(var k=(b[0]-l[12])/l[0],m=(b[1]-l[13])/l[5],n=(b[2]-l[14])/l[10],p=(b[3]-l[12])/l[0],q=(b[4]-l[13])/l[5],l=(b[5]-l[14])/l[10],r=h.getGeometryRecords()[0].geometry.getData(),u=r.getFaces()[0].indices.position,r=r.getVertexAttr().position.data,t=
h.getMetadata().faceRanges,w=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,h=0;h<t.length&&e<c.length;h+=1)if(c[e]===g[h]){for(var w=t[h],D=w[0],E=w[1],w=y=z=Number.MAX_VALUE,A=B=C=-Number.MAX_VALUE;D<=E;D+=1)for(var G=0;3>G;G+=1)var I=3*u[3*D+G],J=r[I],K=r[I+1],I=r[I+2],w=Math.min(J,w),y=Math.min(K,y),z=Math.min(I,z),A=Math.max(J,A),B=Math.max(K,B),C=Math.max(I,C);w>p||A<k||y>q||B<m||z>l||C<n?c.splice(e,1):e++}}}}};r.prototype._applyFilters=function(a){if(this._nodeId2Meta[a.id]&&null!=this._nodeId2Meta[a.id].engineObjects){for(var b=
this._nodeId2Meta[a.id].engineObjects,c=0;c<b.length;c++){var d=b[c];d.unhideAllComponents()}if(0!==this._filters.length){for(var c=[],e=0;e<b.length;e++)d=b[e],c=c.concat(d.getMetadata().featureIds);d=c.length;for(e=0;e<this._filters.length;e++)this._filters[e](a,c);if(c.length!==d)for(e=a=0;e<b.length;e++)for(var d=b[e],f=d.getGeometryRecords()[0],h=d.getMetadata().featureIds,g=0;g<h.length;g+=1){var k=h[g];a>=c.length||c[a]!==k?d.setComponentVisibility(f,g,!1):a++}}}};r.prototype._removeAllNodeDataFromStage=
function(){for(var a=0,b=Object.keys(this._nodeId2Meta);a<b.length;a++)this._removeNodeDataFromStage(b[a])};r.prototype._removeNodeDataFromStage=function(a){if(null!=this._nodeId2Meta[a]&&null!=this._nodeId2Meta[a].engineObjects){for(var b=this._stage,c=this._stageLayer,d=0,e=this._nodeId2Meta[a].engineObjects,f=0;f<e.length;++f){var h=e[f];this._highlights.objectDeleted(h);this._elevationProvider.objectDeleted(h);var g=h.getMetadata(),d=d+(null!=g.featureIds?g.featureIds.length:1);c.removeObject(h);
for(var g=h.getGeometryRecords(),k=0;k<g.length;k++){var l=g[k];this.memEstimateGeometryRemoved(l.geometry.getData());b.remove(L.GEOMETRY,l.geometry.getId());for(var n=0;n<l.materials.length;n++){var p=l.materials[n],q=p.getId(),r=p.metadata.i3sMatId,u=p.metadata.i3sTexId||"none",t=this._matId2Meta[r][u];m.assert(0<t.refCount);t.refCount--;0===t.refCount&&this._removeMaterial(q,u,r,p,b)}}b.remove(L.OBJECT,h.getId())}delete this._nodeId2Meta[a];this._featureChangeNotifier.notify(0,d)}};r.prototype._removeMaterial=
function(a,b,c,d,e){e.remove(L.MATERIAL,a);if("none"!==b){a=this._texId2Meta[b];var f=a.usedByEngineMats;d=f.indexOf(d);m.assert(-1<d);f[d]=f[f.length-1];f.pop();1>f.length&&((d=a.engineTex)&&d!==this._initTexture&&(this.memEstimateTextureRemoved(d),e.remove(L.TEXTURE,a.engineTex.getId())),a.engineTex=void 0,delete this._texId2Meta[b])}delete this._matId2Meta[c][b];m.objectEmpty(this._matId2Meta[c])&&delete this._matId2Meta[c]};r.prototype._setPolygonOffset=function(a,b){if(null!=this._nodeId2Meta[a.id]&&
null!=this._nodeId2Meta[a.id].engineObjectsPerBundle){b={polygonOffset:b};for(var c=0;c<this._nodeId2Meta[a.id].engineObjectsPerBundle.length;c++)for(var d=this._nodeId2Meta[a.id].engineObjectsPerBundle[c],e=0;e<d.length;e++)for(var f=d[e].getGeometryRecords(),h=0;h<f.length;h++)for(var g=f[h].materials,k=0;k<g.length;k++)g[k].setParameterValues(b)}};r.prototype._rendererChange=function(a){(this._currentRenderer=a)&&(a.colorInfo||a.sizeInfo)&&R.warn("renderer.colorInfo and renderer.sizeInfo are not supported for Scene Services. Use visualVariables instead.");
if(a){var b=0;for(a=a.getSymbols();b<a.length;b++){var c=a[b];"mesh-3d"!==c.type&&R.error("Symbols of type '"+c.type+"' are not supported for 3D Object Scene Services.")}}};r.prototype._getRenderingInfo=function(a){var b=this._currentRenderer,c=b&&b.getSymbol(a);if(!(c instanceof G))return null;var c={symbol:c},d,e;if(b&&b.visualVariables)for(a=b.getVisualVariableValues(a),b=0;b<a.length;b++){var f=a[b],h=f.variable.type;"color"===h?d=f.value:"opacity"===h&&(e=f.value)}d&&(c.color=[d.r/255,d.g/255,
d.b/255]);null!=e?c.opacity=e:d&&null!=d.a&&(c.opacity=d.a);return c};r.prototype._getSymbolFillColor=function(a){var b=0;for(a=a.symbolLayers.items;b<a.length;b++){var c=a[b];if("fill"===c.type&&(c=c.material,c=null!=c?c.color:null,null!=c))return[c.r/255,c.g/255,c.b/255,c.a]}return null};r.prototype._getSymbolFillColorMixMode=function(a){var b=0;for(a=a.symbolLayers.items;b<a.length;b++){var c=a[b];if("fill"===c.type&&(c=c.material,c=null!=c?c.colorMixMode:null,null!=c))return c}return null};r.prototype._hasSymbolColors=
function(){return!this._isIntegratedMesh()};r.prototype._isIntegratedMesh=function(){return this.layer instanceof c};r.prototype._hasVertexColors=function(){return null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color)};r.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors()){for(var b=a.getMetadata(),c=b.faceRanges?b.faceRanges.length:1,d=new E(null,null,{}),e=d.attributes,f=this.layer.objectIdField,
h=this._currentRenderer&&this._currentRenderer.requiredFields,g=a.geometryRecords[0].geometry.data.vertexAttributes[m.VertexAttrConstants.SYMBOLCOLOR].data,k=!1,l=new Uint8Array(4),n=0;n<c;n++){null!=f&&null!=b.featureIds&&(e[f]=b.featureIds[n]);if(null!=h&&null!=b.attributeData)for(var p=0,q=h;p<q.length;p++){var r=q[p];null!=b.attributeData[r]&&(e[r]=x.getCachedAttributeValue(b.attributeData[r],n))}var u=this._getRenderingInfo(d),p=null!=b.faceRanges?b.faceRanges[n]:null;if(u){var q=this._getSymbolFillColorMixMode(u.symbol),
r=u.color,t=u.opacity;null==r||null==t?(u=this._getSymbolFillColor(u.symbol),r=S.overrideColor(r,t,u,u&&u[3],Z)):r=S.overrideColor(r,t,null,null,Z);1>r[3]&&(k=!0);x.encodeSymbolColor(r,q,l)}else x.encodeSymbolColor(null,null,l);this._setFaceRangeColor(p,g,l)}a.geometryColorAttrsUpdated(0);a=a.getGeometryRecords();for(b=0;b<a.length;b++)for(c=a[b],d=0;d<c.materials.length;d++)e=c.materials[d],f=e.getParams().transparent,h=e.getParams().opacity,e.metadata.symbolIsTransparent=k,g=this._calcEngineMaterialTransparencyParams(e.metadata.i3sTex,
e.metadata.i3sMatParams,e.metadata.symbolIsTransparent),f===g.transparent&&h===g.opacity||e.setParameterValues({transparent:g.transparent,opacity:g.opacity})}};r.prototype._setFaceRangeColor=function(a,b,c){var d=12*a[1]+12;for(a=12*a[0];a<d;a+=4)b[a+0]=c[0],b[a+1]=c[1],b[a+2]=c[2],b[a+3]=c[3]};r.prototype._elevationInfoChanged=function(){var a=this.layer.elevationInfo&&this.layer.elevationInfo.unit;a&&!w.supportsUnit(a)&&R.warn("elevationInfo.unit","'"+a+"' is not a valid unit")};r.prototype._elevationOffsetChange=
function(){this._removeAllNodeDataFromStage();null!=this._controller&&this._controller.restartNodeLoading()};r.prototype._opacityChange=function(a){for(var b in this._matId2Meta)for(var c in this._matId2Meta[b]){a=this._matId2Meta[b][c].engineMat;var d=a.getParams(),e=this._calcEngineMaterialTransparencyParams(a.metadata.i3sTex,a.metadata.i3sMatParams,a.metadata.symbolIsTransparent);d.transparent===e.transparent&&d.layerOpacity===e.layerOpacity||a.setParameterValues(e)}};r.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};
r.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};r.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};r.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().queryObjectIds(a)};r.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};r.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,object:null,bbCorners:new Float64Array(24)};
return new N({forAll:function(c,d){a._forAllFeatures(function(d,e,f){b.id=d;b.index=e;b.object=f;a._boundingBoxCornerPoints(b.index,b.object,b.bbCorners);c(b)},d)},createGraphic:function(b){return a._createGraphic(b.index,b.object.getMetadata())},requestFields:function(b,c,d){return x.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(){var d=a._getGraphicIndices(b.node,b.bundleNr,c);return{node:b.node,indices:d}})},createExtentBuilder:function(){return a._createExtentBuilder()}},{enableObjectId:!0,
enableOutFields:!!this.layer.objectIdField})};r.prototype._createExtentBuilder=function(){var a=this.view.renderSpatialReference,b=this.view.spatialReference,c=T.create(T.NEGATIVE_INFINITY),d=new Float64Array(24);return{add:function(e){O.bufferToBuffer(e.bbCorners,a,0,d,b,0,8)&&T.expandBuffer(c,d,0,8)},getExtent:function(){return T.toExtent(c,b)}}};r.prototype._forAllFeatures=function(a,b,c){for(var d=0,e=Object.keys(this._nodeId2Meta);d<e.length;d++)for(var f=e[d],h=this._nodeId2Meta[f].engineObjects,
g=0;g<h.length;g++)this._forAllFeaturesOfObject(h[g],a,c),b&&b({node:this._controller.nodeIndex[f],bundleNr:g})};r.prototype._forAllFeaturesOfObject=function(a,b,c){for(var d=a.getMetadata().featureIds,e=a.getGeometryRecords()[0],f=0;f<d.length;f++)(c||a.getComponentVisibility(e,f))&&b(d[f],f,a,e)};r.prototype._createGraphic=function(a,b){var c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);if(null!=b.attributeData)for(var d=0,e=Object.keys(b.attributeData);d<e.length;d++){var f=
e[d];c[f]=x.getCachedAttributeValue(b.attributeData[f],a)}a=new E(null,null,c);a.layer=this.layer;return a};r.prototype._boundingBoxCornerPoints=function(a,b,c){a=b.geometries[0].getComponentAABB(a,ea);for(var d=0;8>d;++d)aa[0]=d&1?a[0]:a[3],aa[1]=d&2?a[1]:a[4],aa[2]=d&4?a[2]:a[5],v.mat4d.multiplyVec3(b.objectTransformation,aa),c[3*d]=aa[0],c[3*d+1]=aa[1],c[3*d+2]=aa[2];return c};r.prototype.highlight=function(a,b){var c=this,d=this._highlights;if(a instanceof n){b=d.acquireSet(b);var e=b.set,f=b.handle;
this.queryObjectIds(a).then(function(a){return d.setFeatureIds(e,a)});return f}if("number"===typeof a||a instanceof E)return this.highlight([a],b);a instanceof q&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof E)return a=a.map(function(a){return g.attributeLookup(a.attributes,c._getObjectIdField())}),f=d.acquireSet(b),b=f.set,f=f.handle,d.setFeatureIds(b,a),f;if("number"===typeof a[0])return f=d.acquireSet(b),b=f.set,f=f.handle,d.setFeatureIds(b,a),f}return{remove:function(){}}};
a([b.property()],r.prototype,"layer",void 0);a([b.property()],r.prototype,"_controller",void 0);a([b.property({dependsOn:["_controller.updating"]})],r.prototype,"updating",void 0);a([b.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],r.prototype,"updatingPercentageValue",void 0);a([b.property({readOnly:!0})],r.prototype,"hasTexturesOrVertexColors",null);a([b.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],r.prototype,"elevationOffset",null);return r=a([b.subclass("esri.views.3d.layers.SceneLayerView3D")],
r)}(b.declared(A,P));var aa=v.vec3d.create(),ea=[0,0,0,0,0,0],ha=v.vec4d.create();return B})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/Accessor ../../../../core/Logger ../../../../geometry/Point ../../webgl-engine/lib/Selector ../../support/Evented ../../support/aaBoundingRect ../../lib/glMatrix".split(" "),
function(B,r,f,a,b,c,t,p,h,l,q,y){var z=q.create(q.NEGATIVE_INFINITY),w={spatialReference:null,extent:z},u=y.vec3d.create(),C=y.vec3d.create(),E=y.vec3d.create(),G=t.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(c){function l(a){return c.call(this)||this}f(l,c);l.prototype.initialize=function(){this.renderCoordsHelper=this.layerView.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.selector=new h(this.layerView.view.viewingMode);var a=this.layerView.layer.fullExtent;
this.zmin=a.zmin;this.zmax=a.zmax};l.prototype.getElevation=function(a){if(a instanceof p){if(!this.renderCoordsHelper.toRenderCoords(a,u))return G.error("could not project point for elevation alignment"),-Infinity}else if(!this.renderCoordsHelper.toRenderCoords(a,this.spatialReference,u))return G.error("could not project point for elevation alignment"),-Infinity;var b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;y.vec3d.set(u,C);y.vec3d.set(u,E);this.renderCoordsHelper.setAltitude(b,
C);this.renderCoordsHelper.setAltitude(a,E);this.selector.init(this.intersectLayers,C,E,null,null,1,!1);return this.selector.getMinResult().getIntersectionPoint(u)?this.renderCoordsHelper.getAltitude(u):-Infinity};l.prototype.objectCreated=function(a){this.objectChanged(a)};l.prototype.objectDeleted=function(a){this.objectChanged(a)};l.prototype.visibilityChanged=function(a){void 0!==a?this.objectChanged(a):this.spatialReference&&(w.extent=this.computeLayerExtent(this.intersectLayers[0]),w.spatialReference=
this.spatialReference,this.emit("elevation-change",w))};l.prototype.objectChanged=function(a){this.spatialReference&&(w.extent=this.computeObjectExtent(a),w.spatialReference=this.spatialReference,this.emit("elevation-change",w))};l.prototype.computeObjectExtent=function(a){q.set(z,q.NEGATIVE_INFINITY);this.expandExtent(a,z);return z};l.prototype.computeLayerExtent=function(a){q.set(z,q.NEGATIVE_INFINITY);var b=0;for(a=a.getObjects();b<a.length;b++)this.expandExtent(a[b],z);return z};l.prototype.expandExtent=
function(a,b){for(var c=a.getBBMin(!0),f=a.getBBMax(!0),h=0;8>h;++h)u[0]=h&1?c[0]:f[0],u[1]=h&2?c[1]:f[1],u[2]=h&4?c[2]:f[2],y.mat4d.multiplyVec3(a.objectTransformation,u),this.renderCoordsHelper.fromRenderCoords(u,u,this.spatialReference),q.expand(b,u);return b};a([b.property({constructOnly:!0})],l.prototype,"layerView",void 0);a([b.property({constructOnly:!0})],l.prototype,"stageLayer",void 0);a([b.property({readOnly:!0,aliasOf:"layerView.view.elevationProvider.spatialReference"})],l.prototype,
"spatialReference",void 0);return l=a([b.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],l)}(b.declared(c,l.Evented))})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define("require exports ../../../../geometry/SpatialReference ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Util".split(" "),function(B,r,f,a,b,c){function t(c,f,h,r,t){for(var l=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],q=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],
w=0;w<c.length/3;w++)for(var y=[c[3*w],c[3*w+1],c[3*w+2]],n=0;3>n;n++)l[n]=Math.min(l[n],y[n]),q[n]=Math.max(q[n],y[n]);w=r.wkid===p?[f[0],f[1],f[2]]:f;b.vec3d.add(w,l,l);b.vec3d.add(w,q,q);for(w=0;3>w;w++)q[w]===l[w]&&(q[w]+=1);w=[[l[0],l[1],l[2]],[q[0],l[1],l[2]],[l[0],q[1],l[2]],[l[0],l[1],q[2]]];for(y=0;4>y;y++)n=w[y],a.vectorToVector(n,r,n,t);r=b.vec3d.subtract(w[1],w[0],b.vec3d.create());y=b.vec3d.subtract(w[2],w[0],b.vec3d.create());n=b.vec3d.subtract(w[3],w[0],b.vec3d.create());b.vec3d.scale(r,
1/(q[0]-l[0]));b.vec3d.scale(y,1/(q[1]-l[1]));b.vec3d.scale(n,1/(q[2]-l[2]));var l=b.vec3d.length(r),q=b.vec3d.length(y),z=b.vec3d.length(n);if(3<Math.abs(l-q)||3<Math.abs(l-z)||3<Math.abs(q-z)){for(w=0;w<c.length/3;w++)c[3*w]*=l,c[3*w+1]*=q,c[3*w+2]*=z;b.vec3d.normalize(r);b.vec3d.normalize(y);b.vec3d.normalize(n)}c=b.mat4d.createFromMatrixRowMajor([r[0],y[0],n[0],0,r[1],y[1],n[1],0,r[2],y[2],n[2],0,0,0,0,1]);l=[0,0,0,0];a.vectorToVector(f,h,l,t);return{globalTrafo:b.mat4d.createFromMatrixRowMajor([1,
0,0,l[0],0,1,0,l[1],0,0,1,l[2],0,0,0,1]),localTrafo:c}}Object.defineProperty(r,"__esModule",{value:!0});var p=f.WGS84.wkid;r.ReprojectionTypes={PER_VERTEX:"perVertex",BOUNDINGBOX:"boundingBox",NO_REPROJECTION:"noReprojection"};var h=new Float64Array(3E3);r.reprojectPoints=function(c,f,p,z,w,u){if(c===r.ReprojectionTypes.PER_VERTEX){c=b.mat4d.create();a.computeLinearTransformation(z,p,c,u);var l=b.mat4d.create();b.mat4d.inverse(c,l);var q=b.mat4d.create();b.mat4d.identity(q);var y=[0,0,0],n=f.length/
3;a.vectorToVector(p,z,y,w);for(p=0;p<n;p+=1E3){z=Math.min(1E3,n-p);for(var A=0;A<z;A++)h[3*A]=f[3*(p+A)]+y[0],h[3*A+1]=f[3*(p+A)+1]+y[1],h[3*A+2]=f[3*(p+A)+2]+y[2];a.bufferToBuffer(h,w,0,h,u,0,z);for(A=0;A<z;A++){var x=h[3*A],B=h[3*A+1],K=h[3*A+2];f[3*(p+A)]=l[0]*x+l[4]*B+l[8]*K+l[12];f[3*(p+A)+1]=l[1]*x+l[5]*B+l[9]*K+l[13];f[3*(p+A)+2]=l[2]*x+l[6]*B+l[10]*K+l[14]}}u={localTrafo:q,globalTrafo:c}}else c===r.ReprojectionTypes.BOUNDINGBOX?u=t(f,p,z,w,u):(f=b.mat4d.create(),b.mat4d.identity(f),w=b.mat4d.create(),
a.computeLinearTransformation(z,p,w,u),u={localTrafo:f,globalTrafo:w});return u};r.reprojectNormalsPerVertex=function(f,h,p,r,t){c.assert(r.equals(a.SphericalRenderSpatialReference));r=b.mat4d.create();a.computeLinearTransformation(p,h,r,t);h=b.mat4d.create();b.mat4d.inverse(r,h);p=f.length/3;for(t=0;t<p;t++){r=f[3*t];var l=f[3*t+1],q=f[3*t+2];f[3*t]=h[0]*r+h[4]*l+h[8]*q;f[3*t+1]=h[1]*r+h[5]*l+h[9]*q;f[3*t+2]=h[2]*r+h[6]*l+h[10]*q}};r.reprojectBoundingBox=t})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports dojo/promise/all ../../../../core/promiseUtils ../../../../core/Error ../../../../tasks/support/FeatureSet".split(" "),
function(B,r,f,a,b,c){return function(){function r(a,b){this._support=a;this._options=b}r.prototype.queryExtent=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0,f=b._support.createExtentBuilder();b._forAllQueried(a,function(a){c++;f.add(a)});return{count:c,extent:0===c?null:f.getExtent()}})};r.prototype.queryFeatureCount=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0;b._forAllQueried(a,function(){return c++});return c})};r.prototype.queryFeatures=
function(b){var h=this;return this._rejectUnsupported(b).then(function(){var c=[],p=b&&b.outFields,r=[];h._forAllQueried(b,function(a){return r.push(h._support.createGraphic(a))},function(a){p&&(c.push(h._support.requestFields(a,r,p)),r=[])});p||c.push(a.resolve(r));return f(c)}).then(function(a){a=a.reduce(function(a,b){return a.concat(b)},[]);var b=new c;b.features=a;return b})};r.prototype.queryObjectIds=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=[];b._forAllQueried(a,
function(a){return c.push(a.id)});return c})};r.defaultExtentBuilder=function(a){var b=null;return{add:function(c){(c=a(c))&&(b=null!=b?b.union(c):c.clone())},getExtent:function(){return b}}};r.prototype._forAllQueried=function(a,b,c){var f=[];if(a&&a.objectIds){var h=a.objectIds;f.push(function(a){return 0<=h.indexOf(a.id)})}this._support.forAll(function(a){for(var c=0;c<f.length;c++)if(!(0,f[c])(a))return;b(a)},c)};r.prototype._rejectUnsupported=function(c){if(null==c)return a.resolve();var f=function(c){return a.reject(new b("Unsupported Query",
"Unsupported property '"+c+"'"))};return null!=c.distance?f("distance"):null!=c.geometryPrecision?f("geometryPrecision"):c.groupByFieldsForStatistics&&c.groupByFieldsForStatistics.length?f("groupByFieldsForStatistics"):null!=c.maxAllowableOffset?f("maxAllowableOffset"):c.multipatchOption?f("multipatchOption"):null!=c.num?f("num"):c.orderByFields&&c.orderByFields.length?f("orderByFields"):c.outSpatialReference?f("outSpatialReference"):c.outStatistics&&c.outStatistics.length?f("outStatistics"):c.pixelSize?
f("pixelSize"):c.quantizationParameters?f("quantizationParameters"):c.relationParam?f("relationParam"):c.returnDistinctValues?f("returnDistinctValues"):null!=c.start?f("start"):c.text?f("text"):c.timeExtent?f("timeExtent"):c.where?f("where"):c.geometry?f("geometry"):!this._options.enableOutFields&&c.outFields&&c.outFields.length?f("outFields"):!this._options.enableObjectId&&c.objectIds&&c.objectIds.length?f("objectIds"):a.resolve()};return r}()})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require",
"exports","../../webgl-engine/lib/HighlightSet"],function(B,r,f){var a=function(){return function(a){this.highlightSet=new f;this.ids=new Set;this.options=a}}();return function(){function b(a){this.highlights=[];this.layerView=a}b.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});this.highlights=null};b.prototype.acquireSet=function(b){var c=this,f=new a(b);this.highlights.push(f);return{set:f,handle:{remove:function(){return c.releaseSet(f)}}}};
b.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,1)};b.prototype.setFeatureIds=function(a,b){b.forEach(function(b){return a.ids.add(b)});this.layerView._forAllFeatures(function(b,c,f,q){a.ids.has(b)&&(b=f.setComponentHighlight(q,c,a.options),a.highlightSet.addObject(f,b))},null,!0)};b.prototype.objectCreated=function(a){var b=this;this.highlights.forEach(function(c){b.layerView._forAllFeaturesOfObject(a,
function(a,b,f,p){c.ids.has(a)&&(a=f.setComponentHighlight(p,b,c.options),c.highlightSet.addObject(f,a))},!0)})};b.prototype.objectDeleted=function(a){this.highlights.forEach(function(b){b.highlightSet.removeObject(a)})};b.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return b}()})},"esri/views/3d/layers/i3s/FeatureChangeNotifier":function(){define(["require","exports"],function(B,r){Object.defineProperty(r,"__esModule",{value:!0});
B=function(){function f(a,b){this._eventIsScheduled=!1;this._event=null;this._controller=b;this._layerView=a}f.prototype._emitFeaturesChangedEvent=function(){this._layerView.emit("features-changed",this._event);this._event=null;this._eventIsScheduled=!1};f.prototype._cancelFeaturesChangedEvent=function(){this._eventIsScheduled=!1};f.prototype.notify=function(a,b){var c=this;null==this._event&&(this._event={addedCount:0,removedCount:0});this._event.addedCount+=a;this._event.removedCount+=b;this._eventIsScheduled||
(this._eventIsScheduled=!0,this._controller.schedule().then(function(){return c._emitFeaturesChangedEvent()}).otherwise(function(){return c._cancelFeaturesChangedEvent()}))};return f}();r.FeatureChangeNotifier=B})},"url:esri/views/3d/environment/materials/SimpleAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsSimpleAtmosphere"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n\r\n#ifndef PANORAMIC\r\n\r\n  const float TWICEPI \x3d 2.0*3.14159265;\r\n  const float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\r\n\r\n  uniform vec3 silCircleCenter;\r\n  uniform vec3 silCircleV1;\r\n  uniform vec3 silCircleV2;\r\n  uniform vec2 texV;\r\n\r\n#endif\r\n\r\n  uniform vec3 lightDirection;\r\n\r\n  attribute vec3 $position;\r\n  varying vec2 vtc;\r\n  varying float falloff;\r\n\r\n  void main(void) {\r\n\r\n#ifdef PANORAMIC\r\n\r\n    vec3 pos \x3d $position;\r\n    float ndotl \x3d lightDirection.z;\r\n    vtc \x3d vec2(0, $position.z+0.05);\r\n\r\n#else\r\n\r\n    float phi \x3d $position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\r\n    vec3 pos \x3d (sin(phi) * silCircleV1 + cos(phi) * silCircleV2 + silCircleCenter) * $position.y;\r\n    float ndotl \x3d dot(normalize(pos), lightDirection);\r\n\r\n    vtc.x \x3d $position.x / ATMOSPHERE_RIM_SEGMENTS;\r\n    vtc.y \x3d texV.x * (1.0 - $position.z) + texV.y * $position.z;\r\n\r\n#endif\r\n\r\n    falloff \x3d max(0.0, (smoothstep(-1.0, 0.8, ndotl + ndotl)));\r\n\r\n    gl_Position \x3d proj * view * vec4(pos, 1.0);\r\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsSimpleAtmosphere"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec4 color;\r\n  varying vec2 vtc;\r\n  varying float falloff;\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    gl_FragColor \x3d texColor * color * falloff;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/environment/materials/RealisticAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3c!--Vertex Shader for Atmosphere--\x3e\r\n\x3csnippet name\x3d"vsRealisticAtmosphere"\x3e\x3c![CDATA[\r\n//\r\n// Based on Atmospheric scattering vertex shader by Sean O\'Neil from GPU Gems 2 Chapter 16.\r\n//\r\n// Link:                   http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter16.html\r\n// Download Portal:        http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Index.html\r\n// Unmodified Source Code: http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Content/16.zip\r\n//\r\n// Adapted for WebGIS by Jascha Gr\u00fcbel (jgruebel@esri.com), Z\u00fcrich 2015\r\n//\r\n\r\n  $vsprecisionf\r\n\r\n  //Camera\r\n  uniform vec2 halfSizeNearPlane;\r\n  uniform vec3 v3CameraUp;\r\n  uniform vec3 v3CameraRight;\r\n  uniform vec3 v3CameraDir;\r\n  uniform vec2 v2CameraCenterOffset;\r\n\r\n  //Attributes\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  //Varyings\r\n  varying vec3 v3WorldRay;\r\n  varying vec2 vtc;\r\n\r\n#ifdef HAZE\r\n  varying vec3 v3EyeDir;\r\n#endif\r\n\r\n  void main(void) {\r\n    vec3 v3Pos \x3d $position;\r\n    vtc \x3d $uv0;\r\n    vec2 rayvtc \x3d $uv0 - v2CameraCenterOffset;\r\n\r\n#ifdef HAZE\r\n    v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#else\r\n    vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#endif\r\n    v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\r\n    gl_Position \x3d vec4(v3Pos, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereScaleFunction"\x3e\x3c![CDATA[\r\n  //Approximation for inner integral based on a radii ratio of 10.25:10\r\n  float scale(float fCos){\r\n    float x \x3d 1.0 - fCos;\r\n    return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"toneMapperConstants"\x3e\x3c![CDATA[\r\n#ifdef HAZE\r\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\r\n#else\r\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\r\n#endif\r\n  const vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"exponentialToneMapper"\x3e\x3c![CDATA[\r\n  //ToneMapping operators\r\n  vec3 expTM(vec3 inputColor,float exposure){\r\n      return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"reinhardToneMapper"\x3e\x3c![CDATA[\r\n  vec3 reinhardTM(vec3 inputColor, float exposure){\r\n      vec3 intermediate \x3d inputColor *exposure;\r\n      intermediate /\x3d (1.0+intermediate);\r\n      return pow(intermediate, v3OneOverGamma);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"HSVColorSpace"\x3e\x3c![CDATA[\r\n//based on http://gamedev.stackexchange.com/a/59808\r\n// Hue in range [0,1] instead of 360\u00b0\r\nvec3 rgb2hsv(vec3 c)\r\n{\r\n    vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n    vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n    vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n    float d \x3d q.x - min(q.w, q.y);\r\n    float e \x3d 1.0e-10;\r\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 hsv2rgb(vec3 c)\r\n{\r\n    vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n    vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereUniformsConstantsVaryings"\x3e\x3c![CDATA[\r\n\r\n  //Light\r\n  uniform vec3 v3LightDir;      // The direction vector to the light source\r\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\r\n  uniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\r\n\r\n  //Radii\r\n  uniform vec4 v4Radii; // inner, inner^2, outer, outer^2,\r\n\r\n  //Atmosphere\r\n  const float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\r\n  const float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\r\n  //uniform float fScale;         // 1 / (fOuterRadius - fInnerRadius)\r\n  //uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\r\n  //uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\r\n  //uniform float fOneOverScaleDepth; // 1.0 / fScaleDepth\r\n\r\n  //uniform float fScaleDepthBlue;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\r\n  //uniform float fScaleOverScaleDepthBlue; // fScale / fScaleDepth\r\n  //uniform float fOneOverScaleDepthBlue; // 1.0 / fScaleDepth\r\n\r\n  uniform vec4 v4AtmosParams1; //(fScale,fScaleDepth,fScaleOverScaleDepth,fOneOverScaleDepth)\r\n  uniform vec4 v4AtmosParams2; //(g,fScaleDepthBlue,fScaleOverScaleDepthBlue,fOneOverScaleDepthBlue)\r\n#ifndef HAZE\r\n  uniform vec4 v4AtmosParams3; //(g2,fMiePhaseCoefficients,fLowerAlphaBlendBound,fOneOverOuterRadiusMinusAlphaBlendBound)\r\n#endif\r\n\r\n  //Camera\r\n  uniform vec3 v3CameraPos;     // The camera\'s current position\r\n  //uniform float fCameraHeight;  // The camera\'s current height\r\n  //uniform float fCameraHeight2; // fCameraHeight^2\r\n  //uniform float fC; //fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\r\n  //uniform float fCSur; //fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\r\n  uniform vec4 v4SphereComp; //The camera\'s current height, CameraHeight^2,fC,fCSur\r\n  uniform vec2 nearFar;\r\n\r\n  //Camera HDR\r\n#ifdef HAZE\r\n  const float fExposure \x3d 1.5;\r\n#else\r\n  const float fExposure \x3d 2.0;\r\n#endif\r\n\r\n#ifdef HAZE\r\n  //Depth texture\r\n  uniform sampler2D tDepth;\r\n#endif\r\n\r\n  //Testing variables\r\n  uniform float showTest;\r\n\r\n  //Varyings\r\n  varying vec3 v3EyeDir;\r\n  varying vec3 v3WorldRay;\r\n  varying vec2 vtc;\r\n\r\n  //Loop constants for integral approximation\r\n  const float fSamples \x3d 5.0;\r\n  const int maxSamples \x3d 5;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmospherePrecomputation"\x3e\x3c![CDATA[\r\n    float fInnerRadius \x3d v4Radii[0];   // The inner (planetary) radius\r\n    float fInnerRadius2 \x3d v4Radii[1];  // fInnerRadius^2\r\n    float fOuterRadius \x3d v4Radii[2];   // The outer (atmosphere) radius\r\n    float fOuterRadius2 \x3d v4Radii[3];  // fOuterRadius^2\r\n\r\n    float fCameraHeight \x3d v4SphereComp[0];\r\n    float fCameraHeight2 \x3d v4SphereComp[1];\r\n    float fC \x3d v4SphereComp[2];\r\n    float fCSur \x3d v4SphereComp[3];\r\n\r\n#ifdef PLANAR\r\n    vec3 cameraPosition \x3d vec3(0.0,0.0,fCameraHeight);\r\n#else\r\n    vec3 cameraPosition \x3d v3CameraPos;\r\n#endif\r\n\r\n    //Debug variables\r\n    vec3 test \x3d vec3(0.0,0.0,0.0);\r\n\r\n    //Obtain ray from Camera\r\n    vec3 worldSpaceRay \x3d normalize(v3WorldRay);\r\n\r\n    //Compute Atmosphere intersection; i.e. ray/sphere intersection\r\n    float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\r\n    float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\r\n\r\n    //idealized sphere intersection to discard early some pixels\r\n    float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereDiscardPixels"\x3e\x3c![CDATA[\r\n      bool continueComputation \x3d true;\r\n#ifdef HAZE\r\n      // only use red channel from depth texture.\r\n      // see \'Issues\' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\r\n      float depthSample \x3d texture2D(tDepth, vtc).r;\r\n\r\n      float zNear \x3d nearFar[0];\r\n      float zFar \x3d nearFar[1];\r\n\r\n      // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\r\n      float zNorm \x3d 2.0 * depthSample - 1.0;\r\n      float linDepth \x3d 2.0 * zNear * zFar /\r\n        (zFar + zNear - zNorm * (zFar - zNear));\r\n\r\n      float nearSurfaceT;\r\n      if (detSur\x3e0.0){\r\n        nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n      }\r\n\r\n      float rayEndT;\r\n\r\n      // find intersections with ground, but only between the near and far\r\n      // clipping planes.\r\n      if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\r\n        vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\r\n        cameraSpaceRay /\x3d cameraSpaceRay.z;\r\n        cameraSpaceRay *\x3d linDepth;\r\n#ifndef PLANAR\r\n        if((fCameraHeight-fInnerRadius)\x3e8000000.0 \x26\x26 detSur\x3e0.0){\r\n          rayEndT \x3d nearSurfaceT;\r\n        } else  if ((fCameraHeight-fInnerRadius)\x3e2000000.0 \x26\x26 detSur\x3e0.0){\r\n          rayEndT \x3d mix(length(cameraSpaceRay),nearSurfaceT,((fCameraHeight-fInnerRadius)-2000000.0)/6000000.0);\r\n        } else {\r\n          rayEndT \x3d length(cameraSpaceRay);\r\n        }\r\n#else\r\n        rayEndT \x3d length(cameraSpaceRay);\r\n#endif\r\n      } else {\r\n        continueComputation \x3d false;\r\n      }\r\n#ifdef PLANAR\r\n      if (16500.0+ fInnerRadius \x3c fCameraHeight){\r\n        continueComputation \x3d false;\r\n      }\r\n#endif\r\n#else\r\n      if (detSur\x3e0.0){\r\n        float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n        if (nearSurfaceT \x3e 0.0){\r\n          continueComputation \x3d false;\r\n        }\r\n      }\r\n#endif\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereUnpackAddUniforms"\x3e\x3c![CDATA[\r\n        float fScale \x3d v4AtmosParams1.x;\r\n        vec2 v2ScaleDepth \x3d vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\r\n        vec2 v2ScaleOverScaleDepth \x3d vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\r\n        vec2 v2OneOverScaleDepth \x3d vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\r\n\r\n#ifndef HAZE\r\n        float g \x3d v4AtmosParams2.x;\r\n        float g2 \x3d v4AtmosParams3.x;\r\n        float fMiePhaseCoefficients \x3d v4AtmosParams3.y;\r\n        float fLowerAlphaBlendBound \x3d v4AtmosParams3.z;\r\n        float fOneOverOuterRadiusMinusAlphaBlendBound \x3d v4AtmosParams3.w;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeRayAndLoopSetup"\x3e\x3c![CDATA[\r\n        float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\r\n#ifdef HAZE\r\n        float nearT \x3d abs(rayStartT);\r\n        float farT \x3d abs(rayEndT);\r\n#else\r\n        float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\r\n\r\n#endif\r\n\r\n        float fDistance;//calculate its scattering offset\r\n        // Calculate the ray\'s starting position\r\n        if (rayStartT \x3c 0.0)\r\n        { //ray starts from camera to far\r\n          rayStartT \x3d 0.0;\r\n#ifndef HAZE\r\n          fDistance \x3d fScale*(fInnerRadius - fCameraHeight);\r\n#endif\r\n        }\r\n#ifndef HAZE\r\n        else\r\n        {//outside atmosphere\r\n          fDistance \x3d -1.0;\r\n        }\r\n#endif\r\n\r\n        // Initialize the scattering loop variables\r\n        vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n\r\n#ifdef HAZE\r\n        vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n\r\n        float fEndLength \x3d length(v3End);\r\n        float fLocalCameraHeight \x3d length(v3Start);\r\n\r\n        //computed for the original end point to get consistent light angles after possible inversions\r\n        float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\r\n\r\n        if (nearT \x3e farT)\r\n        {\r\n          if (fLocalCameraHeight \x3c fEndLength)\r\n          {\r\n            //Switch positive slopes for flipped rays\r\n            v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n            v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n            worldSpaceRay *\x3d -1.0;\r\n            fEndLength \x3d length(v3End);\r\n            fLocalCameraHeight \x3d length(v3Start);\r\n          }\r\n          else if (fLocalCameraHeight \x3d\x3d fEndLength)\r\n          {// create minuscule fake slope for integration if the slope is zero\r\n            fLocalCameraHeight +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\r\n            //slope for the camera function\r\n          }\r\n        }\r\n\r\n        //Calculate its scattering offset\r\n        // Assumes camera constrains of WSV 3.8\r\n        float fCameraDepth;\r\n        float fCameraDepthBlue;\r\n        if (fLocalCameraHeight \x3e fOuterRadius)\r\n        {\r\n          fDistance \x3d fInnerRadius - fOuterRadius;\r\n        } else\r\n        {//outside atmosphere\r\n          fDistance \x3d fEndLength - fLocalCameraHeight;\r\n        }\r\n\r\n#endif\r\n        vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\r\n\r\n        float fRayLength \x3d rayEndT - rayStartT;\r\n        float fSampleLength \x3d fRayLength / fSamples;\r\n        float fScaledLength \x3d fSampleLength * fScale;\r\n        vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\r\n        vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\r\n\r\n#ifdef HAZE\r\n        float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / fEndLength;\r\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\r\n\r\n        float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\r\n        vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\r\n#else\r\n        float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\r\n        float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\r\n\r\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\r\n#endif\r\n\r\n        //Loop variables\r\n        vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeSampleContribution"\x3e\x3c![CDATA[\r\n          float fHeight \x3d length(v3SamplePoint);\r\n          vec2 v2Depth \x3d exp(v2ScaleOverScaleDepth * (fInnerRadius - fHeight));\r\n#ifdef HAZE\r\n          vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\r\n#else\r\n          float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\r\n          float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\r\n          float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\r\n          vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\r\n#endif\r\n          v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\r\n          v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\r\n\r\n          v3FrontColor +\x3d v3Attenuate * v2Depth.x;\r\n          v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\r\n\r\n          v3SamplePoint +\x3d v3SampleRay;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeHDRColors"\x3e\x3c![CDATA[\r\n        //Phase computation\r\n        //clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\r\n        float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\r\n        float fOnePlusCos2 \x3d fCos*fCos + 1.0;\r\n#ifdef HAZE\r\n        // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\r\n        vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\r\n\r\n        //Scaled Length is only applied afterwards to save multiplications\r\n        vec3 v3Color \x3d colorCoefficients *v3FrontColor;\r\n        vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\r\n#else\r\n        vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\r\n        float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\r\n\r\n        // Calculate the attenuation factor for the ground\r\n        vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\r\n        vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputePixelColor"\x3e\x3c![CDATA[\r\n\r\n\r\n        //HDR to LDR conversion\r\n        vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\r\n        vec3 ldrRed \x3d expTM(v3Color,fExposure);\r\n\r\n        //mix reddish and blueish atmosphere\r\n        vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\r\n#ifdef HAZE\r\n        LDR *\x3d (1.0-fCameraAngle);\r\n        vec3 hsv \x3d rgb2hsv(LDR);\r\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost haze saturation by 50%\r\n        LDR \x3d hsv2rgb(hsv);\r\n        vec3 finalColor \x3d LDR;\r\n        // when rendering we specify the blend functions such that\r\n        // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\r\n#else\r\n        //reinhard tonemapper for looking upwards\r\n        vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\r\n        LDR +\x3d angleMultiplier*ldrReinhard;\r\n\r\n        //height dependent parameter to smooth out reddish atmosphere\r\n        float side \x3d (rayEndT+rayStartT)*0.5;\r\n        float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\r\n        float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\r\n\r\n        vec3 finalColor \x3d LDR*h2;\r\n        vec3 hsv \x3d rgb2hsv(finalColor);\r\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost sky saturation by 50%\r\n        finalColor \x3d hsv2rgb(hsv);\r\n#endif\r\n#ifdef PLANAR\r\n#ifndef HAZE\r\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,7000.0,30000.0);\r\n        alpha \x3d alpha / (30000.0-7000.0);\r\n        gl_FragColor \x3d vec4(finalColor, 1.0-alpha);\r\n#else\r\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,0.0,16500.0);\r\n        alpha \x3d alpha / (16500.0-0.0);\r\n        gl_FragColor \x3d vec4(finalColor, 1.0-alpha);\r\n#endif\r\n#else\r\n#ifndef HAZE\r\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,7000.0,30000.0);\r\n        alpha \x3d alpha / (30000.0-7000.0);\r\n        float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\r\n        gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\r\n#else\r\n        gl_FragColor \x3d vec4(finalColor, 1.0);\r\n#endif\r\n#endif\r\n\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--Fragment Shader for Atmosphere--\x3e\r\n\x3csnippet name\x3d"fsRealisticAtmosphere"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n$atmosphereUniformsConstantsVaryings\r\n\r\n$atmosphereScaleFunction\r\n\r\n  //Conversion implementation found in util.xml\r\n$rgba2float\r\n\r\n\r\n$toneMapperConstants\r\n$exponentialToneMapper\r\n#ifndef HAZE\r\n$reinhardToneMapper\r\n#endif\r\n\r\n$HSVColorSpace\r\n\r\n  void main()\r\n  {\r\n\r\n    $atmospherePrecomputation\r\n\r\n    //Inside Atmosphere\r\n    if (det \x3e\x3d 0.0){\r\n\r\n      $atmosphereDiscardPixels\r\n\r\n      if(continueComputation){\r\n\r\n        $atmosphereUnpackAddUniforms\r\n\r\n        $atmosphereComputeRayAndLoopSetup\r\n\r\n        // Now loop through the sample rays\r\n        for(int i\x3d0; i\x3cmaxSamples; i++)\r\n        {\r\n          $atmosphereComputeSampleContribution\r\n        }\r\n\r\n        $atmosphereComputeHDRColors\r\n\r\n        $atmosphereComputePixelColor\r\n\r\n        //Debug variable overlay\r\n        if(showTest\x3e0.0){\r\n          gl_FragColor \x3d vec4(test,1.0);\r\n        }\r\n\r\n      } else {//Not on surface\r\n        gl_FragColor \x3d vec4(0.0);\r\n      }\r\n    } else {//Outside Atmosphere\r\n      gl_FragColor \x3d vec4(0.0);\r\n    }\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/offscreen.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4(position.xy, 0.0, 1.0);\r\n    vtc \x3d $uv0.xy * 0.5 + 0.5;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  varying vec2 vtc;\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    gl_FragColor \x3d texColor;\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/environment/materials/StarMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderStar"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform vec4 viewport;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec4 $color;\r\n  attribute float $size;\r\n\r\n\tvarying vec4 vcolor;\r\n\tvarying float vsize;\r\n\r\n\t$alignToPixelCenter\r\n\r\n\tvoid main(void) {\r\n\t\tvec4 posProj \x3d proj * view * model*vec4($position*1.0e25,1.0);//move infinitely far away\r\n\t\tgl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\r\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n\t\tvcolor \x3d $color/1.2;\r\n\t\tvsize \x3d size*5.0;\r\n\t\tgl_PointSize \x3d vsize;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderStar"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec4 vcolor;\r\n\tvarying float vsize;\r\n\r\n\tvoid main() {\r\n\t\tfloat cap \x3d 0.7;\r\n\t\tfloat scale \x3d 1.0/cap;\r\n\t\tfloat helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\r\n\t\tfloat alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\r\n\t\tfloat intensity \x3d alpha*alpha*alpha;\r\n\t\tif (vsize \x3c 3.0)\r\n\t\t\tintensity *\x3d 0.5;\r\n\t\tgl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\r\n\t\tgl_FragColor.xyz *\x3d vcolor.xyz;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderSimple"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tattribute vec3 $position;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderSimple"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec4 color;\r\n\r\n\tvoid main() {\r\n\t\tgl_FragColor \x3d color;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/HUDMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderHUD"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  uniform float pixelRatio;\r\n  uniform vec2 screenOffset;\r\n  uniform vec2 anchorPos;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n  varying vec3 debugBorderCoords;\r\n#endif\r\n\r\n  attribute vec2 $uv0;\r\n  attribute vec4 $color;\r\n  attribute vec2 $size;\r\n  attribute vec4 $auxpos2;\r\n\r\n  varying vec4 vcolor;\r\n\r\n  varying vec2 vtc;\r\n  varying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  varying float voccluded;\r\n#endif\r\n\r\n  $vvUniforms\r\n\r\n  $alignToPixelCenter\r\n  $alignToPixelOrigin\r\n  $projectPositionHUD\r\n  $vvFunctions\r\n\r\n  void main(void) {\r\n    ProjectHUDAux projectAux;\r\n    vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n    vec2 inputSize;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n    inputSize \x3d screenSizePerspectiveScaleVec2($size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\r\n\r\n    vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleFloat(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n\r\n#else\r\n\r\n    inputSize \x3d $size;\r\n\r\n    vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n    // only use width (.xx) for proportional scaling\r\n    // (if no width was defined in vv, width\r\n    //  will be a copy of height vv)\r\n    inputSize *\x3d vvGetScale($auxpos2).xx;\r\n#endif\r\n\r\n    vec2 combinedSize \x3d inputSize * pixelRatio;\r\n    vec4 quadOffset \x3d vec4(0);\r\n\r\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\r\n    bool visible \x3d testVisibilityHUD(posProj);\r\n#endif\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  voccluded \x3d visible ? 0.0 : 1.0;\r\n#endif\r\n\r\n#ifdef OCCL_TEST\r\n    if (visible) {\r\n#endif\r\n      // UV goes from 0 to 1.99999, where the integer part is used\r\n      // for the normalized vertex coordinates, and the fractional\r\n      // part is used for texture sampling\r\n      vec2 uv01 \x3d floor($uv0);\r\n      vec2 uv \x3d $uv0 - uv01;\r\n\r\n      // Displace icon based on anchor position (normalized for size) and\r\n      // absolute screen offset. anchorPos is [-0.5, 0.5]\r\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n\r\n      // SDF primitives might be scaled so that the SDF texture resolution does\r\n      // not match the resolution of the canvas, but we still want to render\r\n      // outline-only (\'cross\' and \'x\') primitives cleanly. Aligning to a screen\r\n      // pixel border at the geometry center achieves this, since SDF textures\r\n      // always have power of 2 dimensions.\r\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\r\n#else\r\n      posProj +\x3d quadOffset;\r\n\r\n      // Aligning vertex positions to the nearest (using \'floor\') screen pixel\r\n      // border renders textures with pixel-perfect results. If the texture\r\n      // resolution does not match the canvas resolution then aligning is\r\n      // redundant.\r\n      if (inputSize.x \x3d\x3d $size.x) {\r\n        posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\r\n      }\r\n#endif\r\n\r\n      gl_Position \x3d posProj;\r\n\r\n      vtc \x3d uv;\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n      debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\r\n#endif\r\n\r\n      vsize \x3d inputSize;\r\n#ifdef OCCL_TEST\r\n    } else {\r\n      vtc \x3d vec2(.0);\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n      debugBorderCoords \x3d vec3(0);\r\n#endif\r\n\r\n    }\r\n#endif\r\n\r\n    gl_Position \x3d posProj;\r\n\r\n#ifdef VV_COLOR\r\n    vcolor \x3d vvGetColor($auxpos2, vvColorValues, vvColorColors);\r\n#else\r\n    vcolor \x3d $color / 255.0;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDBaseVariables"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  #extension GL_OES_standard_derivatives : require\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec4 overrideColor;\r\n  uniform vec4 outlineColor;\r\n  uniform float outlineSize;\r\n\r\n  varying vec4 vcolor;\r\n\r\n  varying vec2 vtc;\r\n  varying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  varying float voccluded;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n  varying vec3 debugBorderCoords;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDBaseMain"\x3e\x3c![CDATA[\r\n  vec4 premultiply(vec4 v) {\r\n    return vec4(v.rgb * v.a, v.a);\r\n  }\r\n\r\n  void main() {\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n    vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n    vec4 fillPixelColor \x3d overrideColor * vcolor;\r\n\r\n    // Attempt to sample texel centers to avoid thin cross outline\r\n    // disappearing with large symbol sizes.\r\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\r\n    const float txSize \x3d 128.0;\r\n    vec2 scaleFactor \x3d ((vsize - txSize) / txSize);\r\n    vec2 samplePos \x3d vtc + vec2(1.0, -1.0) * (1.0 / txSize) * scaleFactor;\r\n\r\n    // Distance in [-0.5, 0.5]\r\n    float d \x3d dot(texture2D(tex, samplePos), vec4(1.0/16777216.0, 1.0/65535.0, 1.0/256.0, 1.0)) - 0.5;\r\n\r\n    // Work around loss of precision for \'d \x3d 0.0\'.\r\n    // \'0\' gets normalised to 0.5 * 256 \x3d 128 before float packing, but can only\r\n    // be stored in the texture as 128 / 255 \x3d 0.502.\r\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603110\r\n    const float diff \x3d (128.0/255.0 - 0.5);\r\n\r\n    // adjust all values, not just those close to 0, to avoid discontinuities in\r\n    // the outlines of other shapes e.g. circles\r\n    d \x3d d - diff;\r\n\r\n    // Distance in output units\r\n    float dist \x3d d * vsize.x;\r\n\r\n    fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n    if (outlineSize \x3e 0.25) {\r\n      vec4 outlinePixelColor \x3d outlineColor;\r\n      float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\r\n      outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\r\n\r\n      // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\r\n      float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n      vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\r\n        vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n\r\n      gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n    }\r\n    else {\r\n      gl_FragColor \x3d premultiply(fillPixelColor);\r\n    }\r\n\r\n    // visualize SDF:\r\n    // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\r\n#else\r\n\r\n    // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\r\n    // fragment color. Input textures should already be pre-multiplied and so\r\n    // don\'t require adjustment, but the override and vertex colors must be\r\n    // modulated by their alpha values.\r\n\r\n    gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiply(overrideColor * vcolor);\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n     float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\r\n     gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\r\n#endif\r\n\r\n    if (gl_FragColor.a \x3c 0.1) {\r\n      discard;\r\n    }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUD"\x3e\x3c![CDATA[\r\n$fragmentShaderHUDBaseVariables\r\n$fragmentShaderHUDBaseMain\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDHighlight"\x3e\x3c![CDATA[\r\n$fragmentShaderHUDBaseVariables\r\n\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n$fragmentShaderHUDBaseMain\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n    // Instead of deciding on a per-pixel basis if the highlight is occluded,\r\n    // do it for all highlight pixel based on the centroid occlusion. This\r\n    // is a temporary solution for:\r\n    // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\r\n    if (voccluded \x3d\x3d 1.0) {\r\n      gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n    } else {\r\n      gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n    }\r\n#else\r\n    $highlightWrite\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"vertexShaderOcclusionTestPixel"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  $alignToPixelCenter\r\n  $projectPositionHUD\r\n\r\n  void main(void) {\r\n    vec4 posProjCenter;\r\n\r\n    // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\r\n    // are removed before the VBO is recompacted. If this is the case, then we just project outside\r\n    // of clip space.\r\n    if (dot($position, $position) \x3e 0.0) {\r\n      // Render single point to center of the pixel to avoid subpixel filtering to affect\r\n      // the marker color\r\n      ProjectHUDAux projectAux;\r\n      vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n    }\r\n    else {\r\n      // Project out of clip space\r\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    }\r\n\r\n    gl_Position \x3d posProjCenter;\r\n    gl_PointSize \x3d 1.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderTexOnly"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n\t\tvtc \x3d $uv0;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderTexOnly"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform vec4 color;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tgl_FragColor \x3d texColor * color;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/ssao.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\t\x3csnippet name\x3d"createFsSSAOSrc"\x3e\x3c![CDATA[\r\n\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D rnm;\r\n\tuniform sampler2D normalMap;\r\n\tuniform sampler2D depthMap;\r\n\tuniform float\t\tssaoAtt;\r\n\tuniform vec2\t\trnmScale;\r\n\tuniform float\t\tradius;\r\n\tuniform vec2\t\tnearFar;\r\n\tuniform vec3\t\tpSphere[64];\r\n\r\n\tvarying vec2\t\tuv;\r\n\r\n\tconst\tfloat\t\tstrength \x3d .07;\r\n\tconst\tfloat\t\tfalloff \x3d .000002;\r\n\r\n\t$rgba2float\r\n\tvoid main(void) {\r\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\t\tfloat currentPixelDepth \x3d rgba2float(texture2D(depthMap, uv));\r\n\t\tvec3 ep \x3d vec3(uv.xy, currentPixelDepth);\r\n\t\tvec3 norm \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, uv).xyz;\r\n\t\tfloat bl \x3d .0;\r\n\t\tfloat f \x3d mix(nearFar.x, nearFar.y, currentPixelDepth) / nearFar.x;\r\n\t\tfloat radD \x3d radius / f;\r\n\t\tradD \x3d min(radD, .5);\r\n\t\tfloat depthDifference;\r\n\t\tvec3 ray;\r\n\r\n\t\tfor(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i) {\r\n\t\t\tray \x3d radD*reflect(pSphere[i], fres);\r\n\t\t\tvec2 tc \x3d ep.xy + sign(dot(ray, norm) ) * ray.xy;\r\n\t\t\tif (tc.x \x3e\x3d .0 \x26\x26 tc.y \x3e\x3d .0 \x26\x26 tc.x \x3c\x3d 1.0 \x26\x26 tc.y \x3c\x3d 1.0) {\r\n\t\t\t\tfloat occluderDepth \x3d rgba2float(texture2D(depthMap, tc));\r\n\t\t\t\tvec3 occluderNormal \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, tc).xyz;\r\n\t\t\t\tdepthDifference \x3d currentPixelDepth - occluderDepth;\r\n\t\t\t\tbl +\x3d step(falloff, depthDifference) * (1.0 - dot(occluderNormal, norm)) * (1.0 - smoothstep(falloff, strength, depthDifference));\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfloat ao \x3d 1.0 + bl * (-1.38 / float(NUM_TAP_SAMPLES)) * ssaoAtt;\r\n\t\tgl_FragColor.a \x3d ao;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"getDepthLinear"\x3e\x3c![CDATA[\r\n\tfloat getDepthLinear(vec2 ssC) {\r\n\t\treturn -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"createFsSSAOSrcObscurance"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform mat4 projMatrixInv;\r\n\r\n\tuniform sampler2D normalMap;\r\n\tuniform sampler2D depthMap;\r\n\r\n\tuniform float     intensity;\r\n\r\n\tuniform float projScale;\r\n\tuniform float     radius;\r\n\tuniform vec2      nearFar;\r\n\r\n\tuniform vec4      projInfo;\r\n\r\n\tuniform vec2\t  screenDimensions;\r\n\r\n\t//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\r\n\tuniform vec3\t\tpSphere[NUM_TAP_SAMPLES]; //tap position\r\n\tuniform vec2\t\trnmScale;\r\n\tuniform sampler2D rnm; //noise texture\r\n\r\n\t//set z scaling, used to prevent division in ortho mode\r\n\tuniform vec2 zScale;\r\n\r\n\tvarying vec2  uv;\r\n\tvarying vec4  camPos;\r\n\r\n\t$rgba2float\r\n\t$getDepthLinear\r\n\r\n\t/** Returns a unit vector and a screen-space radius for the tap on a unit disk (the caller should scale by the actual disk radius) */\r\n\t/*uniform float numSpiralTurns;\r\n\tvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\r\n\t\t// Radius relative to ssR\r\n\t\tfloat alpha \x3d (float(sampleNumber) + 0.5) * (1.0 / float(NUM_TAP_SAMPLES));\r\n\t\tfloat angle \x3d alpha * (numSpiralTurns * 6.28) + spinAngle;\r\n\r\n\t\tssR \x3d alpha;\r\n\t\treturn vec2(cos(angle), sin(angle));\r\n\t}*/\r\n\r\n\r\n\tfloat fallOffFunction(float vv, float vn, float bias) {\r\n\t  float radius2 \x3d radius * radius;\r\n\r\n\t\t// A: From the HPG12 paper\r\n\t\t// Note large epsilon to avoid overdarkening within cracks\r\n\t\t// return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\r\n\r\n\t\t// B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\r\n\t\tfloat f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\r\n\r\n\t\t// C: Medium contrast (which looks better at high radii), no division.  Note that the\r\n\t\t// contribution still falls off with radius^2, but we\'ve adjusted the rate in a way that is\r\n\t\t// more computationally efficient and happens to be aesthetically pleasing.\r\n\t\t// return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\r\n\r\n\t\t// D: Low contrast, no division operation\r\n\t\t// return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\r\n\t}\r\n\r\n\r\n\t/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\r\n\tfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\r\n\t\tvec3 v \x3d Q - C;\r\n\t\tfloat vv \x3d dot(v, v);\r\n\t\tfloat vn \x3d dot(normalize(v), n_C);\r\n\t\treturn fallOffFunction(vv, vn, 0.1);\r\n\t}\r\n\r\n\r\n\t/** Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\r\n\t\tpixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\r\n\t\tis at (0.5, 0.5) [but that need not be the location at which the sample tap\r\n\t\twas placed!]\r\n\r\n\t\tCosts 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\r\n\t  */\r\n\tvec3 reconstructCSPosition(vec2 S, float z) {\r\n\t\treturn vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\r\n\t}\r\n\r\n\tvoid main(void)\r\n\t{\r\n\r\n\t\t//Hash function used in the HPG12 AlchemyAO paper\r\n\t\t//Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\r\n\t\t//ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\r\n\t\t//float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\r\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\r\n\t   float currentPixelDepth \x3d getDepthLinear(uv);\r\n\r\n\t   if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\r\n\t\tgl_FragColor \x3d vec4(0);\r\n\t\treturn;\r\n\t   }\r\n\r\n\t   vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\r\n\r\n\t   // get the normal of current fragment\r\n\t   vec4 norm4 \x3d texture2D(normalMap, uv);\r\n\t   vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\r\n\t   bool isTerrain \x3d norm4.w\x3c0.5;\r\n\r\n\t   float sum \x3d .0;\r\n\r\n\t   vec4 occluderFragment;\r\n\t   vec3 ray;\r\n\r\n\t   vec3 tapPixelPos;\r\n\r\n\t   // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\r\n\t   // bug or deviation from CE somewhere else?\r\n\t   float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\r\n\r\n\t   for(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i)\r\n\t   {\r\n\t\t  // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\r\n\t\t  //float ssR;\r\n\t\t  //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\r\n\t\t  // get the depth of the occluder fragment\r\n\t\t  //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\r\n\r\n\t\t  vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\r\n\t\t  vec2 offset \x3d vec2(-unitOffset*radius*ps);\r\n\r\n\r\n\t\t  //don\'t use current or very nearby samples\r\n\t\t  if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\r\n\r\n\r\n\t\t  vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\r\n\t\t  if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\r\n\t\t  vec2 tcTap \x3d tc/screenDimensions;\r\n\t\t  float occluderFragmentDepth \x3d getDepthLinear(tcTap);\r\n\r\n\t\t  if (isTerrain) {\r\n\t\t  \tbool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\r\n\t\t  \tif (isTerrainTap)\r\n\t\t  \t\tcontinue;\r\n\t\t  }\r\n\r\n\t\t  tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\r\n\r\n\t\t  sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\r\n\t   }\r\n\r\n\t   // output the result\r\n\r\n\t\tfloat A \x3d max(1.0-sum*intensity/float(NUM_TAP_SAMPLES),0.0);\r\n\r\n\t\t// Anti-tone map to reduce contrast and drag dark region farther\r\n\t\t// (x^0.2 + 1.2 * x^4)/2.2\r\n\t\tA \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\r\n\r\n\r\n\t   //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\r\n\t   //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\r\n\t   //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\r\n\t   gl_FragColor \x3d vec4(A);\r\n\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsBlurEdgeAware"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D normalMap;\r\n\tuniform sampler2D depthMap;\r\n\tuniform sampler2D tex;\r\n\r\n\r\n\tuniform vec2 blurSize;\r\n\r\n\r\n\tuniform float g_BlurFalloff;\r\n\tuniform float projScale;\r\n\r\n\r\n\tvarying vec2 uv;\r\n\r\n\tuniform vec2\t\tnearFar;\r\n\r\n\t//set z scaling, used to prevent division in ortho mode\r\n\tuniform vec2 zScale;\r\n\r\n\t$rgba2float\r\n\t$getDepthLinear\r\n\r\n\tfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness)\r\n\t{\r\n\t\tfloat c \x3d texture2D(tex, uv).r;\r\n\t\tfloat d \x3d getDepthLinear(uv);\r\n\r\n\t\tfloat ddiff \x3d d - center_d;\r\n\r\n\t\tfloat w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\r\n\r\n\t\tw_total +\x3d w;\r\n\r\n\t\treturn w*c;\r\n\t}\r\n\r\n\tvoid main(void)\r\n\t{\r\n\r\n\t\tfloat b \x3d 0.0;\r\n\t\tfloat w_total \x3d 0.0;\r\n\r\n\t\tfloat center_d \x3d  getDepthLinear(uv);\r\n\r\n\t\tfloat sharpness \x3d -0.05*projScale/(center_d*zScale.x+zScale.y);\r\n\t\tfor (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r)\r\n\t\t{\r\n\t\t\tfloat rf \x3d float(r);\r\n\t\t\tvec2 uvOffset \x3d uv + rf*blurSize;\r\n\t\t\tb +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\r\n\t\t}\r\n\r\n\t\tgl_FragColor \x3d vec4(b/w_total);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\t\x3csnippet name\x3d"fsBlurSrc0"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform float blurSize;\r\n\tvarying vec2 uv;\r\n\r\n\tvoid main() {\r\n\t\tint rad \x3d RADIUS - 1;\r\n\r\n\t\tvec4 sum \x3d vec4(0.0);\r\n\t\tfor (int k \x3d -RADIUS; k \x3c\x3d RADIUS; ++k) { \t\t// NOTE for-variable-init must be a const expression\r\n\t\t\tfloat fi \x3d float(k);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsBlurSrc1"\x3e\x3c![CDATA[\r\n\t\t}\r\n\r\n\t\tgl_FragColor \x3d sum / float(RADIUS * RADIUS);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsBlurH"\x3e\x3c![CDATA[\r\n\t$fsBlurSrc0\r\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x + fi * blurSize, uv.y)) * (float(rad) - abs(fi) + 1.0);\r\n\t$fsBlurSrc1\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsBlurV"\x3e\x3c![CDATA[\r\n\t$fsBlurSrc0\r\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x, uv.y + fi * blurSize)) * (float(rad) - abs(fi) + 1.0);\r\n\t$fsBlurSrc1\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/highlight.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nSmartly downsamples a texture, halfing its resolution. This allows for a square\r\nscreen region to check if none, any or all pixels were set.\r\n\r\nThe red channel is always ceiled after interpolating the 4 merged pixels.\r\nThis allows to evaluate:\r\nany(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\r\nnone(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\r\n\r\nThe green and blue channels are set to floor(max(green, blue)).\r\nThis allows to evaluate:\r\nall(pixels.green || pixels.blue) as green \x3d\x3d 1.0\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\r\n\x3csnippet name\x3d"vsConservativeDownsample"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n\r\n  void main()\r\n  {\r\n    gl_Position \x3d vec4(vec2(1.0) - $position * 2.0, .0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsConservativeDownsample"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec2 invFramebufferDim;\r\n\r\n  void main()\r\n  {\r\n    vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\r\n    vec4 value \x3d texture2D(tex, coord);\r\n    float mx \x3d floor(max(value.g, value.b));\r\n    gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nGaussian blur with linear sampling. Supports different number of samples, but\r\nonly 5 samples have proper weights. Uses linear texture interpolation to reduce\r\nthe number of samples taken.\r\n\r\nDefines:\r\nGRID_OPTIMIZATION (set or !set)\r\nGAUSSIAN_SAMPLES (3,5,7)\r\n\r\nThis technique requires linear filtering on source texture\r\nhttp://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\x3csnippet name\x3d"vsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    uniform sampler2D coverageTex;\r\n    varying vec3 blurCoordinate;\r\n  #else\r\n    uniform vec2 blurSize;\r\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    gl_Position \x3d vec4($position, 0.0, 1.0);\r\n\r\n    #ifdef GRID_OPTIMIZATION\r\n      // sample the coverage texture at the block center\r\n      // and if no coverage detected, create degenerate triangle\r\n      vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n      if (cov.r \x3d\x3d 0.0) {\r\n        gl_Position \x3d vec4(0,0,0,0);\r\n      }\r\n\r\n      // create texture coordinate for blur center\r\n      // encode information about fully inside block in z coordinate\r\n      blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\r\n    #else\r\n      vec2 uv \x3d $position.xy * .5 + vec2(.5);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n        blurCoordinates[7] \x3d uv + blurSize * 7.1;\r\n        blurCoordinates[8] \x3d uv - blurSize * 7.1;\r\n      #endif\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    uniform vec2 blurSize;\r\n    varying vec3 blurCoordinate;\r\n  #else\r\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    #ifdef GRID_OPTIMIZATION\r\n      vec2 uv \x3d blurCoordinate.xy;\r\n      vec4 center \x3d texture2D(tex, uv);\r\n\r\n      // do not blur if no pixel or all pixels in neighborhood are set\r\n      if (blurCoordinate.z \x3d\x3d 1.0) {\r\n        gl_FragColor \x3d center;\r\n      }\r\n      else {\r\n        vec4 sum \x3d vec4(0.0);\r\n\r\n        #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.154164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\r\n        #endif\r\n\r\n        gl_FragColor \x3d sum;\r\n      }\r\n    #else\r\n      vec4 sum \x3d vec4(0.0);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\r\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\r\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\r\n        sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\r\n        sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\r\n      #endif\r\n\r\n      gl_FragColor \x3d sum;\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nMerging blurred outlines with source image, advanced version\r\n\r\nDefines:\r\nGRID_OPTIMIZATION (set or !set)\r\nGRID_DEBUG (set or !set)\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\x3csnippet name\x3d"vsHighlightApply"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 uv;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    attribute vec2 $uv0;\r\n    uniform sampler2D coverageTex;\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    #ifdef GRID_OPTIMIZATION\r\n      #ifdef GRID_DEBUG\r\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n        // if no highlight pixel set in this block,\r\n        // or all pixels set, hide block\r\n        if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\r\n          gl_Position \x3d vec4(0,0,0,0);\r\n          return;\r\n        }\r\n        gl_Position \x3d vec4($position, .0, 1.0);\r\n        uv \x3d $uv0;\r\n        return;\r\n      #else\r\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n        // if no highlight pixel set in this block, hide block\r\n        if (cov.r \x3d\x3d 0.0) {\r\n          gl_Position \x3d vec4(0,0,0,0);\r\n          return;\r\n        }\r\n      #endif\r\n    #endif\r\n\r\n    gl_Position \x3d vec4($position, .0, 1.0);\r\n    uv \x3d $position.xy * .5 + vec2(.5);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightApply"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform sampler2D origin;\r\n\r\n  uniform vec4 color;\r\n  uniform float outlineSize;\r\n  uniform float blurSize;\r\n  uniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\r\n\r\n  varying vec2 uv;\r\n\r\n  void main()\r\n  {\r\n    #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\r\n      gl_FragColor \x3d vec4(uv, 0, 1.0);\r\n    #else\r\n      // Read the highlight intensity from the blurred highlight image\r\n      vec4 blurredHighlightValue \x3d texture2D(tex, uv);\r\n      float highlightIntensity \x3d blurredHighlightValue.a;\r\n\r\n      // Discard all pixels which are not affected by highlight\r\n      if (highlightIntensity \x3d\x3d 0.0) {\r\n        discard;\r\n      }\r\n\r\n      vec4 origin_color \x3d texture2D(origin, uv);\r\n\r\n      float outlineIntensity;\r\n      float fillIntensity;\r\n\r\n      // if occluded\r\n      if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\r\n        outlineIntensity \x3d color.w * opacities[1];\r\n        fillIntensity \x3d color.w * opacities[3];\r\n      }\r\n      // if unoccluded\r\n      else {\r\n        outlineIntensity \x3d color.w * opacities[0];\r\n        fillIntensity \x3d color.w * opacities[2];\r\n      }\r\n\r\n      float inner \x3d 1.0 - outlineSize / 9.0;\r\n      float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\r\n\r\n      float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\r\n      //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\r\n      float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\r\n      float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\r\n\r\n      // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n      // I.e., color should not be premultiplied with alpha\r\n      gl_FragColor \x3d vec4(color.xyz, intensity);\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/util.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"alignToPixelCenter"\x3e\x3c![CDATA[\r\n  vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\r\n    // From clip space to (0 : 1), bias towards right pixel edge\r\n    vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n    // Size of a pixel in range (0 : 1)\r\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n    // Round to nearest pixel center\r\n    vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\r\n\r\n    // Convert back to clip space\r\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n    return vec4(result, clipCoord.zw);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"alignToPixelOrigin"\x3e\x3c![CDATA[\r\n  vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\r\n    // From clip space to (0 : 1),\r\n    vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n    // Size of a pixel in range (0 : 1)\r\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n    // Round to nearest pixel border, (0 : 1)\r\n    vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\r\n\r\n    // Convert back to clip space\r\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n    return vec4(result, clipCoord.zw);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"float2rgba"\x3e\x3c![CDATA[\r\n\tvec4 float2rgba(const in float v) {\r\n\t\tvec4 enc \x3d vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\r\n\t\tenc \x3d fract(enc);\r\n\t\tenc -\x3d enc.yzww * vec4(1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);\r\n\t\treturn enc;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"rgba2float"\x3e\x3c![CDATA[\r\n\tfloat rgba2float(vec4 rgba) {\r\n\t\treturn dot(rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"calcFragDepth"\x3e\x3c![CDATA[\r\n\t#extension GL_OES_standard_derivatives : enable\r\n\r\n\tfloat calcFragDepth(const in float depth) {\r\n\t\t//calc polygon offset\r\n\t\tconst float SLOPE_SCALE \x3d 2.0;\r\n\t\tconst float BIAS \x3d 2.0 * .000015259;\t\t// 1 / (2^16 - 1)\r\n\t\tfloat m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\r\n\t\tfloat result \x3d depth + SLOPE_SCALE * m + BIAS;\r\n\t\treturn clamp(result, .0, .999999);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"evalShadow"\x3e\x3c![CDATA[\r\n\t$rgba2float\r\n\r\n\t// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\r\n\t// once IE11 is fine with it, const should probably be re-introduced\r\n\tfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\r\n\t\t//choose correct cascade\r\n\t\tint i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\r\n\r\n\t\tif (i \x3e\x3d num) return .0;\r\n\r\n\t\tmat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\r\n\r\n\t\tvec4 lv \x3d mat * vec4(vpos, 1.0);\r\n\t\tlv.xy /\x3d lv.w;\r\n\r\n\t\t//vertex completely outside? -\x3e no shadow\r\n\t\tvec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\r\n\t\tif (lvpos.z \x3e\x3d 1.0) return .0;\r\n\t\tif (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) return .0;\r\n\r\n\t\t//calc coord in cascade texture\r\n\t\tvec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\r\n\r\n\t\tfloat texSize \x3d .5 / halfPxSz;\r\n\r\n\t\t//filter, offset by half pixels\r\n\t\tvec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\r\n\r\n\t\tfloat s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\t\tfloat s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\t\tfloat s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\t\tfloat s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\r\n\t\treturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3c!--\r\n\tScene Lighting Definitions:\r\n\t\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\n\tdefines:\r\n\t\t- SH_ORDER: 1|2|3\r\n\tinput:\r\n\t\t- normal: vec3\r\n\t\t- albedo: vec3\r\n\t  - shadow: float\r\n\t\t- ssao: float\r\n\treturn:\r\n\t  - color: vec3\r\n--\x3e\r\n\x3csnippet name\x3d"sceneLightingDefinitions"\x3e\x3c![CDATA[\r\n\t$viewingMode\r\n\r\n\t// main light\r\n\t/////////////////////////////////////////\r\n\tuniform vec3 lightingMainDirection;\r\n\tuniform vec3 lightingMainIntensity;\r\n\r\n\t// ambient lighting\r\n\t/////////////////////////////////////////\r\n\t#ifndef SH_ORDER\r\n\t\t#define SH_ORDER 2\r\n\t#endif\r\n\r\n\t#if SH_ORDER \x3d\x3d 0\r\n\t\tuniform vec3 lightingAmbientSH0;\r\n\t#elif SH_ORDER \x3d\x3d 1\r\n\t\tuniform vec4 lightingAmbientSH_R;\r\n\t\tuniform vec4 lightingAmbientSH_G;\r\n\t\tuniform vec4 lightingAmbientSH_B;\r\n\t#elif SH_ORDER \x3d\x3d 2\r\n\t\tuniform vec3 lightingAmbientSH0;\r\n\t\tuniform vec4 lightingAmbientSH_R1;\r\n\t\tuniform vec4 lightingAmbientSH_G1;\r\n\t\tuniform vec4 lightingAmbientSH_B1;\r\n\t\tuniform vec4 lightingAmbientSH_R2;\r\n\t\tuniform vec4 lightingAmbientSH_G2;\r\n\t\tuniform vec4 lightingAmbientSH_B2;\r\n\t#endif\r\n\r\n\t// special tweaking\r\n\t//////////////////////////////////////////\r\n\t\tuniform float lightingFixedFactor;\r\n\t\tuniform float lightingGlobalFactor;\r\n\r\n\t\tuniform float ambientBoostFactor;\r\n\r\n\t// evaluation\r\n\t//////////////////////////////////////////\r\n\r\n\tvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\r\n\t\t// evaluate the main light\r\n\t\tfloat dotVal \x3d mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\r\n\t\tvec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\r\n\r\n\t\t// evaluate the sh ambient light\r\n\t\t#if SH_ORDER \x3d\x3d 0\r\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\t\t#elif SH_ORDER \x3d\x3d 1\r\n\t\t\tvec4 sh0 \x3d vec4(\r\n\t\t\t\t0.282095,\r\n\t\t\t\t0.488603 * normal.x,\r\n\t\t\t\t0.488603 * normal.z,\r\n\t\t\t\t0.488603 * normal.y\r\n\t\t\t);\r\n\t\t\tvec3 ambientLight \x3d vec3(\r\n\t\t\t\tdot(lightingAmbientSH_R, sh0),\r\n\t\t\t\tdot(lightingAmbientSH_G, sh0),\r\n\t\t\t\tdot(lightingAmbientSH_B, sh0)\r\n\t\t\t);\r\n\t\t#elif SH_ORDER \x3d\x3d 2\r\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\r\n\t\t\tvec4 sh1 \x3d vec4(\r\n\t\t\t\t0.488603 * normal.x,\r\n\t\t\t\t0.488603 * normal.z,\r\n\t\t\t\t0.488603 * normal.y,\r\n\t\t\t\t1.092548 * normal.x * normal.y\r\n\t\t\t);\r\n\t\t\tvec4 sh2 \x3d vec4(\r\n\t\t\t\t1.092548 * normal.y * normal.z,\r\n\t\t\t\t0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n\t\t\t\t1.092548 * normal.x * normal.z,\r\n\t\t\t\t0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n\t\t\t);\r\n\t\t\tambientLight +\x3d vec3(\r\n\t\t\t\tdot(lightingAmbientSH_R1, sh1),\r\n\t\t\t\tdot(lightingAmbientSH_G1, sh1),\r\n\t\t\t\tdot(lightingAmbientSH_B1, sh1)\r\n\t\t\t);\r\n\t\t\tambientLight +\x3d vec3(\r\n\t\t\t\tdot(lightingAmbientSH_R2, sh2),\r\n\t\t\t\tdot(lightingAmbientSH_G2, sh2),\r\n\t\t\t\tdot(lightingAmbientSH_B2, sh2)\r\n\t\t\t);\r\n\t\t#endif\r\n\t\tambientLight *\x3d (1.0 - ssao);\r\n\r\n\t\t// inverse gamma correction on the albedo color\r\n\t\tfloat gamma \x3d 2.1;\r\n\t\tvec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\r\n\r\n\t\t// physically correct BRDF normalizes by PI\r\n\t\tconst float PI \x3d 3.14159;\r\n\t\tvec3 totalLight \x3d mainLight + ambientLight + additionalLight;\r\n\t\ttotalLight \x3d min(totalLight, vec3(PI, PI, PI));\r\n\t\tvec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\r\n\r\n\t\t// apply gamma correction to the computed color\r\n\t\toutColor \x3d pow(outColor, vec3(1.0/gamma));\r\n\r\n\t\treturn outColor;\r\n\t}\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"sceneLightingAdditionalLightGlobal"\x3e\x3c![CDATA[\r\n\t// heuristic lighting model originally used in the terrain shading\r\n\t// now used to generated additional ambient light\r\n\t#ifdef VIEWING_MODE_GLOBAL\r\n\t\tfloat vndl \x3d -dot(normalize(vpos + localOrigin), lightingMainDirection);\r\n\t#else\r\n\t\tfloat vndl \x3d -dot(vec3(0,0,1), lightingMainDirection);\r\n\t#endif\r\n\tfloat additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n\tvec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"normal2envTC"\x3e\x3c![CDATA[\r\n\tvec2 normal2envTC(vec3 normal) {\r\n\t\tfloat v \x3d .5 + .5 * asin(normal.y) * 0.63661977;\r\n\t\tfloat u \x3d .5 - .5 * atan(normal.z, normal.x) * 0.31830988;\r\n\t\treturn vec2(u, v);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderShowDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tattribute vec2 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d proj * vec4($position.x, $position.y, .0, 1.0);\r\n\t\tvtc \x3d $uv0;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fragmentShaderShowDepth"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D depthTex;\r\n\tvarying vec2 vtc;\r\n\t$rgba2float\r\n\tvoid main() {\r\n\t//\tgl_FragColor \x3d vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\r\n\t\tgl_FragColor \x3d vec4(rgba2float(texture2D(depthTex, vtc)));\r\n\t//\tgl_FragColor \x3d texture2D(depthTex, vtc);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsUVQuad"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $position;\r\n\tvarying vec2 uv;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d vec4($position.x, $position.y, .0, 1.0);\r\n\t\tuv \x3d $position * .5 + vec2(.5);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"toScreenCoords"\x3e\x3c![CDATA[\r\n\tvec4 toScreenCoords(vec3 vertex) {\r\n\t\tvec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\r\n\t\tvClipSpace.xy *\x3d screenSize;\r\n\t\treturn vClipSpace/abs(vClipSpace.w);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vvUniforms"\x3e\x3c![CDATA[\r\n#if defined(VV_SIZE)\r\n\t#define VV_CUSTOM_MODEL_MATRIX\r\n#endif\r\n\r\n#if defined(VV_SIZE)\r\n\tuniform vec3 vvSizeMinSize;\r\n\tuniform vec3 vvSizeMaxSize;\r\n\tuniform vec3 vvSizeOffset;\r\n\tuniform vec3 vvSizeFactor;\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tuniform vec3 vvSizeValue;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\tuniform mat3 vvSymbolRotation;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\tuniform vec3 vvSymbolAnchor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n\t#define VV_COLOR_N 8\r\n\tuniform float vvColorValues[VV_COLOR_N];\r\n\tuniform vec4 vvColorColors[VV_COLOR_N];\r\n#endif\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vvFunctions"\x3e\x3c![CDATA[\r\n// Evaluation of size\r\n#if defined(VV_SIZE)\r\n\tvec3 vvGetScale(vec4 featureAttribute) {\r\n\t\treturn clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n\t}\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tvec3 vvGetScale(vec4 featureAttribute) {\r\n\t\treturn vvSizeValue;\r\n\t}\r\n#endif\r\n\r\n// Applying the model matrix\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\tvec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\r\n\t\treturn vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\r\n\t}\r\n\r\n\tvec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\r\n\t\t// Normal transform is the inverse transpose of model transform\r\n\t\treturn vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\r\n\t}\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n\tvec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n\t\tfloat value \x3d featureAttribute.y;\r\n\t\tif (value \x3c\x3d values[0]) {\r\n\t\t\treturn colors[0];\r\n\t\t}\r\n\r\n\t\tfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n\t\t\tif (values[i] \x3e\x3d value) {\r\n\t\t\t\tfloat f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n\t\t\t\treturn mix(colors[i-1], colors[i], f);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn colors[VV_COLOR_N - 1];\r\n\t}\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"rgb2hsv"\x3e\x3c![CDATA[\r\nvec3 rgb2hsv(vec3 c)\r\n{\r\n\tvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n\tvec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n\tvec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n\tfloat d \x3d q.x - min(q.w, q.y);\r\n\tfloat e \x3d 1.0e-10;\r\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"hsv2rgb"\x3e\x3c![CDATA[\r\nvec3 hsv2rgb(vec3 c)\r\n{\r\n\tvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n\tvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"colorMixMode"\x3e\x3c![CDATA[\r\n$rgb2hsv\r\n$hsv2rgb\r\n\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"highlightWrite"\x3e\x3c![CDATA[\r\n  // the following uniforms are common to all highlight shaders:\r\n  // uniform sampler2D depthTex\r\n  // uniform vec4 highlightViewportPixelSz\r\n  float sceneDepth \x3d texture2D(depthTex, (gl_FragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\r\n  if (gl_FragCoord.z \x3e sceneDepth + 5e-6) {\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"screenSizePerspective"\x3e\x3c![CDATA[\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n// These could be functions, but I wanted to make sure that they are inlined. Additionally,\r\n// as macros, applying the scale works also for different types (float, vec2, etc).\r\n// Note that the implementation here should be kept in sync with the corresponding\r\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\r\n\r\n// Transform the input minimum size (factor.z) so that, when comparing to it, we are\r\n// excluding the \'padding\' size (factor.w).\r\n#define screenSizePerspectiveMinSize(/* float */ size, /* vec4 */ factor) (factor.z * (1.0 + 2.0 * factor.w  / size))\r\n\r\n#define screenSizePerspectiveFactor(/* float */ absCosAngle) (absCosAngle * absCosAngle * absCosAngle)\r\n\r\n#define screenSizePerspectiveScaleFactor(/* float */ absCosAngle, /* float */ distanceToCamera, /* vec4 */ params) vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveFactor(absCosAngle), params.z, params.w)\r\n\r\n// Factor is computed from screenSizePerspectiveScaleFactor\r\n#define applyScreenSizePerspectiveScaleFactorFloat(/* float */ size, /* vec4 */ factor) max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor))\r\n#define screenSizePerspectiveScaleFloat(/* float */ size, /* float */ absCosAngle, /* float */ distanceToCamera, /* vec4 */ params) applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params))\r\n\r\n#define applyScreenSizePerspectiveScaleFactorVec2(/* vec2 */ size, /* vec4 */ factor) mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y)\r\n#define screenSizePerspectiveScaleVec2(/* vec2 */ size, /* float */ absCosAngle, /* float */ distanceToCamera, /* vec4 */ params) applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params))\r\n\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"computeNormal"\x3e\x3c![CDATA[\r\n\t#ifdef GROUND_NORMAL_SHADING\r\n\t\t#ifdef VIEWING_MODE_GLOBAL\r\n\t\t\tvec3 normal \x3d normalize(vpos + localOrigin);\r\n\t\t#else\r\n\t\t\tvec3 normal \x3d vec3(0,0,1);\r\n\t\t#endif\r\n\t#else\r\n\t\t\t// compute normal\r\n\t\t#ifndef DOUBLESIDED\r\n\t\t\t\tvec3 normal \x3d vnormal;\r\n\t\t#else\r\n\t\t\t\tvec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n\t\t#endif\r\n\t\tnormal \x3d normalize(normal);\r\n\t#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/hud.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"commonAttributesAndUniformsHUD"\x3e\x3c![CDATA[\r\n  attribute vec3 $position;\r\n  attribute vec3 $normal;\r\n  attribute vec4 $auxpos1;\r\n\r\n  uniform mat4 proj;\r\n\r\n  uniform mat4 view;\r\n  uniform mat4 viewNormal;\r\n\r\n  uniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n\r\n  uniform vec4 viewport;\r\n\r\n  uniform vec3 camPos;\r\n\r\n  uniform float polygonOffset;\r\n  uniform float cameraGroundRelative;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n  // [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\r\n  uniform vec4 verticalOffset;\r\n\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  // [ divisor, offset, minPixelSize, paddingPixels ]\r\n  uniform vec4 screenSizePerspectiveAlignment;\r\n\r\n#endif\r\n\r\n  uniform sampler2D hudVisibilityTexture;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"projectPositionHUD"\x3e\x3c![CDATA[\r\n  $screenSizePerspective\r\n\r\n  // Corresponds to cos(10 deg), used to compare against dot product of two vectors\r\n  const float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\r\n\r\n  struct ProjectHUDAux {\r\n    vec3 posModel;\r\n    vec3 posView;\r\n    vec3 vnormal;\r\n\r\n    float distanceToCamera;\r\n    float absCosAngle;\r\n  };\r\n\r\n\r\n  /**\r\n   * Apply the simulated polygon offset for HUD objects that improves\r\n   * issues with Z-fighting.\r\n   *\r\n   * @param posView {vec3} (inout) the position in view space. Will be modified in place.\r\n   * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\r\n   * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\r\n   *   and the view direction.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Attributes:\r\n   *     - auxpos1: contains centerOffset and pointGroundDistance\r\n   *\r\n   *   Uniforms:\r\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n   *         reduced flickering.\r\n   *     - viewport: the viewport [x, y, width, height]\r\n   */\r\n  float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\r\n    float pointGroundSign \x3d sign(pointGroundDistance);\r\n\r\n    if (pointGroundSign \x3d\x3d 0.0) {\r\n      pointGroundSign \x3d 1.0;\r\n    }\r\n\r\n    // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\r\n    // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\r\n    float groundRelative \x3d cameraGroundRelative * pointGroundSign;\r\n\r\n    // view angle dependent part of polygon offset emulation\r\n    // we take the absolute value because the sign that is dropped is\r\n    // instead introduced using the ground-relative position of the symbol and the camera\r\n    if (polygonOffset \x3e .0) {\r\n      float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\r\n\r\n      float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\r\n      float factor \x3d (1.0 - tanAlpha / viewport[2]);\r\n\r\n      // same side of the terrain\r\n      if (groundRelative \x3e 0.0) {\r\n        posView *\x3d factor;\r\n      }\r\n      // opposite sides of the terrain\r\n      else {\r\n        posView /\x3d factor;\r\n      }\r\n    }\r\n\r\n    return groundRelative;\r\n  }\r\n\r\n  /**\r\n   * Project the 3d position of a HUD object from world space to clip space. In addition\r\n   * to standard model view projection, it also emulates a polygon offset to\r\n   * help with points above/below ground and icon flickering. The resulting location\r\n   * is the anchor of the HUD object, i.e. the position that is used also for testing\r\n   * visibility of the HUD object. Note that the returned projected position is not\r\n   * aligned to a pixel center or border, it is up to the caller to align if necessary.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Attributes:\r\n   *     - position: contains the point world position\r\n   *     - normal: contains the world normal pointing up at the point\r\n   *     - auxpos1: contains centerOffset and pointGroundDistance\r\n   *\r\n   *   Uniforms:\r\n   *     - model: the object -\x3e world transformation matrix\r\n   *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\r\n   *     - view: the world -\x3e view transformation matrix\r\n   *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\r\n   *     - proj: the view -\x3e clip projection matrix\r\n   *     - verticalOffset: a vec4 containing:\r\n   *         - the screen height of the vertical offset\r\n   *         - the screen height of the vertical offset as a fraction of camera distance.\r\n   *         - the minimum world size vertical offset.\r\n   *         - the maximum world size vertical offset.\r\n   *       This will do a screen sized offset of the point along its normal (used for line callouts)\r\n   *     - screenSizePerspectiveAlignment: a vec3 containing\r\n   *         - the view distance dependent divisor\r\n   *         - the view distance dependent offset\r\n   *         - the minimum pixel size\r\n   *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\r\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n   *         reduced flickering.\r\n   *     - camPos: the position of the camera in world space\r\n   *     - viewport: the viewport [x, y, width, height]\r\n   */\r\n  vec4 projectPositionHUD(out ProjectHUDAux aux) {\r\n    // centerOffset is in view space and is used to implement world size offsetting\r\n    // of labels with respect to objects. It also pulls the label towards the viewer\r\n    // so that the label is visible in front of the object.\r\n    vec3 centerOffset \x3d $auxpos1.xyz;\r\n\r\n    // The pointGroundDistance is the distance of the geometry to the ground and is\r\n    // negative if the point is below the ground, or positive if the point is above\r\n    // ground.\r\n    float pointGroundDistance \x3d $auxpos1.w;\r\n\r\n    aux.posModel \x3d (model * vec4($position, 1.0)).xyz;\r\n    aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\r\n    aux.vnormal \x3d (modelNormal * vec4($normal, 1.0)).xyz;\r\n\r\n    // Screen sized offset in world space, used for example for line callouts\r\n    // Note: keep this implementation in sync with the CPU implementation, see\r\n    //   - MaterialUtil.verticalOffsetAtDistance\r\n    //   - HUDMaterial.applyVerticalOffsetTransformation\r\n\r\n    aux.distanceToCamera \x3d length(aux.posView);\r\n\r\n    vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\r\n    float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\r\n\r\n    aux.absCosAngle \x3d abs(cosAngle);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\r\n    vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\r\n#else\r\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\r\n    vec3 modelOffset \x3d aux.vnormal * worldOffset;\r\n\r\n    aux.posModel +\x3d modelOffset;\r\n\r\n    vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n    aux.posView +\x3d viewOffset;\r\n\r\n    // Since we elevate the object, we need to take that into account\r\n    // in the distance to ground\r\n    pointGroundDistance +\x3d worldOffset;\r\n\r\n#endif\r\n\r\n    float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\r\n\r\n#ifndef CENTER_OFFSET_UNITS_SCREEN\r\n    // Apply x/y in view space, but z in screen space (i.e. along posView direction)\r\n    aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0);\r\n\r\n    // Same material all have same z !\x3d 0.0 condition so should not lead to\r\n    // branch fragmentation and will save a normalization if it\'s not needed\r\n    if (centerOffset.z !\x3d 0.0) {\r\n      aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\r\n    }\r\n#endif\r\n\r\n    vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\r\n\r\n#ifdef CENTER_OFFSET_UNITS_SCREEN\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\r\n#else\r\n    float centerOffsetY \x3d centerOffset.y;\r\n#endif\r\n\r\n    posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * 2.0 / viewport.zw * posProj.w;\r\n\r\n#endif\r\n\r\n    // constant part of polygon offset emulation\r\n    posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\r\n\r\n    return posProj;\r\n  }\r\n\r\n  /**\r\n   * Test for visibility of a HUD object.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Uniforms:\r\n   *     - hudVisibilityTexture: the texture that contains the visibility information\r\n   *     - markerColor: the special marker color that is used to write visibility information\r\n   *     - viewport: the viewport\r\n   */\r\n  bool testVisibilityHUD(vec4 posProj) {\r\n    // For occlusion testing, use the nearest pixel center to avoid\r\n    // subpixel filtering messing up the color we use to test for\r\n    vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n    return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/BillboardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBillboard"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n\tattribute vec3 $position;\r\n\tattribute vec3 $normal;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tconst float size \x3d 1.05;\r\n\r\n\tvoid main(void) {\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0);\r\n\t\tvec2 uv \x3d $uv0 - uv01;\r\n\t\tvec3 zDir \x3d normalize(-pos);\r\n\t\tvec3 xDir \x3d normalize(cross(vec3(.0, 1.0, .0), zDir));\r\n\t\tvec3 yDir \x3d cross(zDir, xDir);\r\n\t\tpos +\x3d xDir * (uv01.x - .5) * size;\r\n\t\tpos +\x3d yDir * (uv01.y - .5) * size;\r\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n\t\tgl_Position \x3d pos4;\r\n\t\tvtc \x3d uv;\r\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderBillboard"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec4 lightAmbient;\r\n\tuniform vec4 lightDiffuse;\r\n\tuniform vec3 lightDirection;\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .15) discard;\r\n\t\tgl_FragColor \x3d texColor;\r\n\t\tgl_FragColor.rgb *\x3d lightAmbient.rgb * lightAmbient.w + lightDiffuse.rgb * lightDiffuse.w * dot(lightDirection, vnormal);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBillboardDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform vec2 nearFar;\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying float depth;\r\n\tconst float size \x3d 1.05;\r\n\r\n\tvoid main(void) {\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0);\r\n\t\tvec2 uv \x3d $uv0 - uv01;\r\n\t\tpos.x +\x3d (uv01.x - .5) * size;\r\n\t\tpos.y +\x3d (uv01.y - .5) * size;\r\n\t\tvec4 eye \x3d vec4(pos, 1.0);\r\n\t\tgl_Position \x3d proj * eye;\r\n\t\tdepth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n\t\tvtc \x3d uv;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/ColorMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderColorMaterial"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec4 $color;\r\n\r\n\tvarying vec4 vColor;\r\n\r\n\tvoid main(void) {\r\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255;\r\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderColorMaterial"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec4 eColor;\r\n\tvarying vec4 vColor;\r\n\r\n\tvoid main() {\r\n\t\tgl_FragColor \x3d vColor * eColor;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/LineCalloutMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderLineCallout"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  attribute vec2 $uv0;\r\n\r\n  uniform float lineSize;\r\n  uniform vec2 pixelToNDC;\r\n  uniform float borderSize;\r\n  uniform vec2 screenOffset;\r\n\r\n  varying vec4 coverageSampling;\r\n  varying vec2 lineSizes;\r\n\r\n  $alignToPixelOrigin\r\n  $alignToPixelCenter\r\n\r\n  $projectPositionHUD\r\n\r\n  void main(void) {\r\n    ProjectHUDAux projectAux;\r\n    vec4 endPoint \x3d projectPositionHUD(projectAux);\r\n\r\n#ifdef OCCL_TEST\r\n    if (!testVisibilityHUD(endPoint)) {\r\n      gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\r\n    }\r\n    else {\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(screenOffset, perspectiveFactor);\r\n#else\r\n      vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\r\n      // used to get the correct depth value\r\n      vec3 posView \x3d (view * model * vec4($position, 1.0)).xyz;\r\n      applyHUDViewDependentPolygonOffset($auxpos1.w, projectAux.absCosAngle, posView);\r\n\r\n      vec4 startPoint \x3d proj * vec4(posView, 1);\r\n\r\n      // Apply screen offset to both start and end point\r\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\r\n\r\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\r\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\r\n\r\n      // Align start and end to pixel origin\r\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\r\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n#ifdef DEPTH_HUD_ALIGN_START\r\n      endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\r\n#else\r\n      startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\r\n#endif\r\n\r\n#endif\r\n\r\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, $uv0.y);\r\n\r\n      // The direction of the line in screen space\r\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\r\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\r\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\r\n\r\n#else\r\n\r\n      float lineSizeScaled \x3d lineSize;\r\n      float borderSizeScaled \x3d borderSize;\r\n\r\n#endif\r\n\r\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\r\n\r\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\r\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\r\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\r\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\r\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\r\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\r\n\r\n      // Sub-pixel offset if we need to grow sub-pixels to the left\r\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\r\n\r\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\r\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\r\n\r\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\r\n      float padding \x3d 1.0 + borderSizeScaled;\r\n      vec2 ndcOffset \x3d (pixelOffset - padding + $uv0 * (lineSizeScaled + padding + padding)) * pixelToNDC;\r\n\r\n      // Offset x/y from the center of the line in screen space\r\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\r\n\r\n      // Compute a coverage varying which we can use in the fragment shader to determine\r\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\r\n      // This works by computing two coordinates that can be linearly interpolated and then\r\n      // subtracted to find out how far away from the line edge we are.\r\n      float edgeDirection \x3d ($uv0.x * 2.0 - 1.0);\r\n\r\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\r\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\r\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\r\n\r\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\r\n\r\n      coverageSampling \x3d vec4(\r\n        // Edge coordinate\r\n        outerEdgeCoverageSampler,\r\n\r\n        // Border edge coordinate\r\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\r\n\r\n        // Line offset\r\n        halfPixelSize - 0.5,\r\n\r\n        // Border offset\r\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\r\n      );\r\n\r\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\r\n\r\n      gl_Position \x3d projectedPosition;\r\n\r\n#ifdef OCCL_TEST\r\n    }\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet\x3e\x3c![CDATA[\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderLineCallout"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform vec4 color;\r\n  uniform vec4 borderColor;\r\n\r\n  varying vec4 coverageSampling;\r\n  varying vec2 lineSizes;\r\n\r\n  void main() {\r\n    // Mix between line and border coverage offsets depending on whether we need\r\n    // a border (based on the sidedness).\r\n    vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\r\n\r\n    // Mix between border and line color based on the line coverage (conceptually the line\r\n    // blends on top of the border background).\r\n    //\r\n    // Anti-alias by blending final result using the full (including optional border) coverage\r\n    // and the color alpha\r\n    float borderAlpha \x3d color.a * borderColor.a * coverage.y;\r\n    float colorAlpha \x3d color.a * coverage.x;\r\n\r\n    float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n    if (finalAlpha \x3c 0.01) {\r\n      discard;\r\n    }\r\n\r\n#else\r\n\r\n    // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\r\n    // need to divide by finalAlpha). We avoid the division here by setting the\r\n    // appropriate blending function in the material.\r\n    vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\r\n\r\n    gl_FragColor \x3d vec4(finalRgb, finalAlpha);\r\n\r\n#endif\r\n\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/LeafCardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderLeafCard"\x3e\r\n\t\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n\r\n\tuniform vec3 localOrigin;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec4 $normal;\r\n\tattribute vec4 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tvarying float ambientLeaf;\r\n\r\n\tuniform float trafoScale;\r\n\tvarying vec3 vpos;\r\n\r\n\tvec2 rotate(vec2 pos, float angle) {\r\n\t\tfloat c \x3d cos(angle);\r\n\t\tfloat s \x3d sin(angle);\r\n\t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\r\n\t}\r\n\r\n\tvoid main(void) {\r\n\r\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0.xy);\r\n\t\tvec2 uv \x3d $uv0.xy - uv01;\r\n\r\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\r\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\r\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\r\n\r\n\t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w *trafoScale;\r\n\t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w *trafoScale;;\r\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n\t\tgl_Position \x3d pos4;\r\n\t\tvtc \x3d uv;\r\n\t\tambientLeaf \x3d normal.w;\r\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal.xyz, 1.0)).xyz);\r\n\t}\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderLeafCard"\x3e\r\n\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec3 camPos;\r\n\r\n\tuniform vec3 diffuse;\r\n\r\n\tuniform vec3 localOrigin;\r\n\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tvarying float ambientLeaf;\r\n\r\n\tvarying vec3 vpos;\r\n\r\n\t$sceneLightingDefinitions\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\r\n\t\tvec3 normal \x3d normalize(vnormal);\r\n\t\tvec3 albedo \x3d diffuse * ambientLeaf * texColor.rgb;\r\n\r\n\t\tfloat ssao \x3d 1.0;\r\n\r\n\t\t$sceneLightingAdditionalLightGlobal\r\n\r\n\t\tvec3 color \x3d evaluateSceneLighting(normal, albedo, 1.0, 1.0 - ssao, additionalLight);\r\n\r\n\t\tgl_FragColor \x3d vec4(color, texColor.a);\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"vertexShaderLeafCardDepth"\x3e\x3c![CDATA[\r\n    $vsprecisionf\r\n\r\n   \tuniform mat4 proj;\r\n   \tuniform mat4 view;\r\n   \tuniform mat4 model;\r\n   \tuniform vec2 nearFar;\r\n\r\n   \tattribute vec3 $position;\r\n   \tattribute vec4 $uv0;\r\n\r\n   \tuniform float trafoScale;\r\n\r\n   \tvarying vec2 vtc;\r\n   \tvarying float depth;\r\n\r\n   \tvec2 rotate(vec2 pos, float angle) {\r\n   \t\tfloat c \x3d cos(angle);\r\n   \t\tfloat s \x3d sin(angle);\r\n   \t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\r\n   \t}\r\n\r\n   \tvoid main(void) {\r\n   \t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n   \t\tvec2 uv01 \x3d floor($uv0.xy);\r\n   \t\tvec2 uv \x3d $uv0.xy - uv01;\r\n\r\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\r\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\r\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\r\n\r\n   \t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w*trafoScale;\r\n   \t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w*trafoScale;\r\n   \t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n   \t\tgl_Position \x3d pos4;\r\n   \t\tvtc \x3d uv;\r\n\r\n   \t\tdepth \x3d (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n\r\n   \t}\r\n ]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/Material.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"calculateVerticalOffset"\x3e\x3c![CDATA[\r\n  $viewingMode\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  // [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\r\n  uniform vec4 verticalOffset;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  uniform vec4 screenSizePerspectiveAlignment;\r\n\r\n  $screenSizePerspective\r\n\r\n#endif\r\n\r\n  vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\r\n    float viewDistance \x3d length((view * vec4(worldPos, 1)).xyz);\r\n    float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n    vec3 worldNormal \x3d normalize(worldPos + localOrigin);\r\n#else\r\n    vec3 worldNormal \x3d vec3(0, 0, 1);\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\r\n\r\n    float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\r\n#else\r\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n    // Screen sized offset in world space, used for example for line callouts\r\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\r\n\r\n    return worldNormal * worldOffset;\r\n  }\r\n#endif\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongSrc"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n\r\n\tuniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n    attribute mat4 model;\r\n    attribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n#endif\r\n#ifdef INSTANCEDCOLOR\r\n\tattribute vec4 instanceColor;\r\n#endif\r\n\tattribute vec3 $position;\r\n\tattribute vec3 $normal;\r\n\tvarying vec3 vpos;\r\n\tvarying vec3 vnormal;\r\n\r\n#ifdef VERTEXCOLORS\r\n\tattribute vec4 $color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  attribute vec4 $symbolColor;\r\n#endif\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n$vvUniforms\r\n\r\n#if defined(VERTEXCOLORS)\r\n\tvarying vec4 vcolor;\r\n#endif\r\n\r\n#if defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\r\n\tuniform vec4 externalColor;\r\n\tvarying vec4 vcolorExt;\r\n#endif\r\n\r\n#if defined(SYMBOLVERTEXCOLORS)\r\n\tvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n\t$vvFunctions\r\n\r\n\t$colorMixMode\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n\t\tvpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\t\tvnormal \x3d normalize((modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\t\tvec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\t\tvec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef VERTEXCOLORS\r\n\t\tvcolor \x3d $color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n#if defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\r\n\t\tvcolorExt \x3d externalColor;\r\n#endif\r\n#ifdef INSTANCEDCOLOR\r\n\t\tvcolorExt *\x3d instanceColor;\r\n#endif\r\n#ifdef VV_COLOR\r\n\t\tvcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\r\n#endif\r\n#ifdef SYMBOLVERTEXCOLORS\r\n    int symbolColorMixMode;\r\n    vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n    colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongSrc"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n\tuniform vec3 camPos;\r\n\tuniform vec3 localOrigin;\r\n\r\n\t$sceneLightingDefinitions\r\n\r\n\t// material parameters\r\n\t//////////////////////////////////////////\r\n\tuniform vec3 ambient;\r\n\tuniform vec3 diffuse;\r\n\tuniform vec3 specular;\r\n\tuniform float shininess;\r\n\tuniform float opacity;\r\n\tuniform float layerOpacity;\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n\tvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\n  uniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\tuniform sampler2D depthTex;\r\n\tuniform int shadowMapNum;\r\n\tuniform vec4 shadowMapDistance;\r\n\tuniform mat4 shadowMapMatrix[4];\r\n\tuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\n\tuniform sampler2D ssaoTex;\r\n\tuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\n\r\n\tvarying vec3 vpos;\r\n\tvarying vec3 vnormal;\r\n#if defined(VERTEXCOLORS)\r\n\tvarying vec4 vcolor;\r\n#endif\r\n#if defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\r\n\tvarying vec4 vcolorExt;\r\n#else\r\n\tuniform vec4 externalColor;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\t$evalShadow\r\n#endif\r\n\r\n\t$colorMixMode\r\n\r\n\tvoid main() {\r\n\t\tvec3 viewDir \x3d normalize(vpos - camPos);\r\n\r\n\t\t$computeNormal\r\n\r\n\t\tvec3 reflDir \x3d normalize(reflect(viewDir, normal));\r\n\r\n\t\t// compute ssao\r\n\t\t#ifdef RECEIVE_SSAO\r\n\t\t\t\tfloat ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n\t\t\t\tssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n\t\t#else\r\n\t\t\t\tfloat ssao \x3d 1.0;\r\n\t\t#endif\r\n\r\n\t\t// At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n\t\t// This also defines "additionalAmbientScale" which might be used as a shadow fallback further down\r\n\t\t$sceneLightingAdditionalLightGlobal\r\n\r\n\t\t// compute shadowing\r\n\t\tfloat shadow \x3d 0.0;\r\n\t\t#ifdef RECEIVE_SHADOWS\r\n\t\t\tshadow \x3d evalShadow(vpos, 1.0 / gl_FragCoord.w, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n\t\t#elif defined(VIEWING_MODE_GLOBAL)\r\n\t\t\t// at global scale (and in global scenes) we fall back to this approximation\r\n\t\t\t// to shadow objects on the dark side of the earth\r\n\t\t\tshadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n\t\t#endif\r\n\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"externalColorMix"\x3e\x3c![CDATA[\r\n\tvec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n\t#if defined(VERTEXCOLORS) \x26\x26 (defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS))\r\n\t\t\t// Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n\t#elif defined(VERTEXCOLORS)\r\n\t\t\t// Internal colors: varying vcolor + uniform ambient/diffuse, external colors: uniform externalColor\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, externalColor.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, externalColor.a, int(colorMixMode));\r\n\t#elif defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\r\n\t\t\t// Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n\t#else\r\n\t\t\t// Internal colors: uniform ambient/diffuse, external colors: uniform externalColor\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, externalColor.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, externalColor.a, int(colorMixMode));\r\n\t#endif\r\n\talbedo_+\x3d 0.25 * specular; // don\'t completely ignore specular for now\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhong"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\t$vsPhongSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhong"\x3e\x3c![CDATA[\r\n\t\t$fsprecisionf\r\n\r\n\t\t$fsPhongSrc\r\n\r\n\t\tvec4 texColor \x3d vec4(1,1,1,1);\r\n\t\t$externalColorMix\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsPhongSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\r\n\t$fsPhongSrc\r\n\r\n\t\t// read texture color\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\r\n\t\t$externalColorMix\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongAtlasTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec4 $uv0;\r\n\tattribute vec4 $region;\r\n\tvarying vec2 vtc;\r\n\tvarying vec4 regionV;\r\n\t$vsPhongSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0.xy;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t\tregionV \x3d $region/65535.0;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongAtlasTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform vec2 texSize;\r\n\tvarying vec2 vtc;\r\n\tvarying vec4 regionV;\r\n\r\n\tfloat calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n\t\t// from:\r\n\t\t//   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n\t\t//   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n\t\t//   - http://www.linedef.com/virtual-texture-demo.html\r\n\t\tfloat deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n\t\treturn max(0.5 * log2(deltaMaxSqr), 0.0);\r\n\t}\r\n\r\n\t$fsPhongSrc\r\n\r\n\t\tvec2 uv \x3d vtc;\r\n\t\tuv \x3d fract(uv);\r\n\t\t//[umin, vmin, umax, vmax]\r\n\r\n\t\tvec2 atlasScale \x3d regionV.zw - regionV.xy;\r\n\t\tuv \x3d uv.xy * atlasScale + regionV.xy;\r\n\r\n\t\tvec4 texColor;\r\n\t\t#ifdef GL_OES_standard_derivatives\r\n\t\t\t#extension GL_OES_standard_derivatives : enable\r\n\r\n\t\t\t// calculate derivative of continuous texture coordinate\r\n\t\t\t// to avoid mipmapping artifacts caused by manual wrapping in shader\r\n\t\t\tvec2 dUVdx \x3d dFdx(vtc) * atlasScale;\r\n\t\t\tvec2 dUVdy \x3d dFdy(vtc) * atlasScale;\r\n\r\n\t\t\t#ifdef GL_EXT_shader_texture_lod\r\n\t\t\t\t#extension GL_EXT_shader_texture_lod : enable\r\n\r\n\t\t\t\t// workaround for artifacts in Windows 10 using Intel HD Graphics 4000 series\r\n\t\t\t\t// see: https://devtopia.esri.com/Zurich-R-D-Center/arcgis-js-api-canvas3d-issues/issues/768\r\n\t\t\t\tconst float epsilon \x3d 1.0E-32;\r\n\t\t\t\tfloat zeroUVShift \x3d uv.x \x3d\x3d 0.0 \x26\x26 uv.y \x3d\x3d 0.0 ? epsilon : 0.0;\r\n\r\n\t\t\t\ttexColor \x3d texture2DGradEXT(tex, uv + zeroUVShift, dUVdx, dUVdy);\r\n\t\t\t#else\r\n\t\t\t\t// use bias to compensate for difference in automatic vs desired mipmap level\r\n\t\t\t\tvec2 dUVdxAuto \x3d dFdx(uv);\r\n\t\t\t\tvec2 dUVdyAuto \x3d dFdy(uv);\r\n\t\t\t\tfloat mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n\t\t\t\tfloat autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\t\t\t\ttexColor \x3d texture2D(tex, uv, mipMapLevel - autoMipMapLevel);\r\n\t\t\t#endif\r\n\t\t#else\r\n\t\t\ttexColor \x3d texture2D(tex, uv);\r\n\t\t#endif\r\n\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\r\n\t\t$externalColorMix\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n\t]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsPhongTexturedRefl"\x3e\x3c![CDATA[\r\n\t\t$fsprecisionf\r\n\r\n\t\tuniform sampler2D tex;\r\n\t\tuniform sampler2D reflTex;\r\n\t\tuniform float reflectivity;\r\n\t\tvarying vec2 vtc;\r\n\r\n\t\t$normal2envTC\r\n\r\n\t\t$fsPhongSrc\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\t\tvec4 reflColor \x3d texture2D(reflTex, normal2envTC(reflDir));\r\n\r\n\t\t$externalColorMix\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\t\tshadedColor.rgb \x3d mix(shadedColor.rgb, reflColor.rgb, reflectivity);\r\n\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepthSrc"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n\tattribute mat4 model;\r\n  attribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n#endif\r\n\tuniform vec2 nearFar;\r\n\tattribute vec3 $position;\r\n\tvarying float depth;\r\n\r\n\t$vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\t$vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n\t\tvec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\t\tvec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n    vec4 eye \x3d view * vec4(vpos, 1);\r\n\r\n\t\tgl_Position \x3d proj * eye;\r\n\t\tdepth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\t$vsDepthSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepthTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsDepthSrc\r\n#ifndef FLIPV\r\n        vtc \x3d $uv0;\r\n#else\r\n        vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormalSrc"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n\tattribute mat4 model;\r\n\tattribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n#endif\r\n\tuniform mat4 viewNormal;\r\n\tattribute vec3 $position;\r\n\tattribute vec3 $normal;\r\n\tvarying vec3 vnormal;\r\n\r\n\t$vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\t$vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\t\tvnormal \x3d normalize((viewNormal * modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\t\tvec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\t\tvnormal \x3d normalize((viewNormal * modelNormal * vec4($normal, 1.0)).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormal"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\t$vsNormalSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormalTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsNormalSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlightSrc"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n\tattribute mat4 model;\r\n  attribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n#endif\r\n\tattribute vec3 $position;\r\n\r\n\t$vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\t$vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n    vec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlight"\x3e\x3c![CDATA[\r\n\t$vsHighlightSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlightTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsHighlightSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepthSrc"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\tvarying float depth;\r\n\r\n\tvoid main() {\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepth"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\t$calcFragDepth\r\n\t$float2rgba\r\n\t$fsDepthSrc\r\n#ifndef BIAS_SHADOWMAP\r\n\t\tgl_FragColor \x3d float2rgba(depth);\r\n#else\r\n\t\tgl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepthTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\t$calcFragDepth\r\n\t$float2rgba\r\n\r\n\t$fsDepthSrc\r\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\r\n#ifndef BIAS_SHADOWMAP\r\n\t\tgl_FragColor \x3d float2rgba(depth);\r\n#else\r\n\t\tgl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsNormal"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec3 vnormal;\r\n\tvoid main() {\r\n\t\tvec3 normal \x3d normalize(vnormal);\r\n\t\tif (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsNormalTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec3 vnormal;\r\n\tvarying vec2 vtc;\r\n\tuniform sampler2D tex;\r\n\tvoid main() {\r\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\r\n\t\tvec3 normal \x3d normalize(vnormal);\r\n\t\tif (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n#ifndef ALPHA_ZERO\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlight"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n\tvoid main() {\r\n\t\t$highlightWrite\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec2 vtc;\r\n\tuniform sampler2D tex;\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n\tvoid main() {\r\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\r\n\r\n\t\t$highlightWrite\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/RibbonLineMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonLine"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\r\n\tuniform float extLineWidth;\r\n\tuniform float nearPlane;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\r\n\tattribute vec4 $color;\r\n\tvarying vec4 vColor;\r\n\r\n\tattribute float size;\r\n\r\n#ifndef WALL\r\n\tuniform float miterLimit;\r\n\tattribute vec3 $auxpos1;\r\n\tattribute vec3 $auxpos2;\r\n#endif\r\n\r\n#ifdef SCREENSCALE\r\n\tuniform vec2 screenSize;\r\n\t$toScreenCoords\r\n#define VECTYPE vec2\r\n#define ZEROVEC vec2(0.0, 0.0)\r\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\r\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*$uv0.y \x3e 0.0\r\n\r\n#else //ifdef SCREENSCALE\r\n\r\n#define VECTYPE vec3\r\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\r\n// these macros are only valid for "strip" type lines:\r\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\r\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*$uv0.y \x3c 0.0\r\n\r\n#endif //ifdef SCREENSCALE\r\n\r\n\tfloat interp(float ncp, vec4 a, vec4 b) {\r\n\t\treturn (-ncp - a.z) / (b.z - a.z);\r\n\t}\r\n\r\n#ifdef SCREENSCALE\r\n\r\n  void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\r\n\t\tfloat vnp \x3d nearPlane*0.99;\r\n\r\n\t\t//We have four vertices per point on the line. Start and end vertices\r\n\t\t//are treated differently --\x3e d \x3e 0, d \x3c 0\r\n\t\tfloat d \x3d abs($uv0.y) - 1.1;\r\n\r\n\t\t//current pos behind ncp --\x3e we need to clip\r\n\t\tif(pos.z \x3e -nearPlane) {\r\n\t\t\tif (d \x3c 0.0) {\r\n\t\t\t\t//previous in front of ncp\r\n\t\t\t\tif(prev.z \x3c -nearPlane) {\r\n\t\t\t\t\tpos \x3d mix(prev, pos, interp(vnp, prev, pos));\r\n\t\t\t\t\tnext \x3d pos;\r\n\t\t\t\t} else {\r\n\t\t\t\t  pos \x3d vec4(0, 0, 0, 1);\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t\t//next in front of ncp\r\n\t\t\tif(d \x3e 0.0) {\r\n\t\t\t\tif(next.z \x3c -nearPlane) {\r\n\t\t\t\t\tpos \x3d mix(pos, next, interp(vnp, pos, next));\r\n\t\t\t\t\tprev \x3d pos;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpos \x3d vec4(0, 0, 0, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\telse {\r\n\t\t\t//current position visible\r\n\t\t\t//previous behind ncp\r\n\t\t\tif (prev.z \x3e -nearPlane) {\r\n\t\t\t\tprev \x3d mix(pos, prev, interp(vnp, pos, prev));\r\n\t\t\t}\r\n\t\t\t//next behind ncp\r\n\t\t\tif (next.z \x3e -nearPlane) {\r\n\t\t\t\tnext \x3d mix(next, pos, interp(vnp, next, pos));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpos\x3d proj * pos;\r\n\t\tpos.xy *\x3d screenSize;\r\n\t\tpos /\x3d pos.w;\r\n\r\n\t\tnext \x3d proj * next;\r\n\t\tnext.xy *\x3d screenSize;\r\n\t\tnext /\x3d next.w;\r\n\r\n\t\tprev \x3d proj * prev;\r\n\t\tprev.xy *\x3d screenSize;\r\n\t\tprev /\x3d prev.w;\r\n  }\r\n\r\n#endif // SCREENSCALE\r\n\r\n\tvoid main(void) {\r\n\r\n\tfloat lineWidth \x3d extLineWidth + $size;\r\n\r\n#ifdef SCREENSCALE\r\n\r\n#if 0\r\n\t\tvec4 pos \x3d toScreenCoords($position.xyz);\r\n\t\tvec2 left \x3d (pos - toScreenCoords($auxpos1)).xy;\r\n\t\tvec2 right \x3d (toScreenCoords($auxpos2) - pos).xy;\r\n#else\r\n\t\tvec4 pos  \x3d view * vec4((model * vec4($position.xyz, 1.0)).xyz, 1.0);\r\n\t\tvec4 prev \x3d view * vec4((model * vec4($auxpos1.xyz, 1.0)).xyz, 1.0);\r\n\t\tvec4 next \x3d view * vec4((model * vec4($auxpos2.xyz, 1.0)).xyz, 1.0);\r\n\r\n\t\tclipAndTransform(pos, prev, next);\r\n\r\n\t\tvec2 left \x3d (pos - prev).xy;\r\n\t\tvec2 right \x3d (next - pos).xy;\r\n#endif\r\n\r\n#else // ifdef SCREENSCALE\r\n\t\tvec4 pos \x3d vec4($position, 1.0);\r\n#ifndef WALL\r\n\t\tvec3 left \x3d $position.xyz - $auxpos1;\r\n\t\tvec3 right \x3d $auxpos2 - $position.xyz;\r\n\t\tvec3 up \x3d normalize($position.xyz);\r\n#endif // ifndef WALL\r\n#endif // ifdef SCREENSCALE\r\n\r\n#ifdef WALL\r\n\t\tfloat displacementLen \x3d lineWidth;\r\n\t\tvec3 displacementDir \x3d normalize($position.xyz);//vec3(0.0, 1.0, 0.0);\r\n#else // ifdef WALL\r\n\r\n\t\tfloat leftLen \x3d length(left);\r\n\t\tleft \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\r\n\r\n\t\tfloat rightLen \x3d length(right);\r\n\t\tright \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\r\n\r\n\t\t// determine if vertex is on the "outside or "inside" of the join\r\n\t\tbool isOutside \x3d ISOUTSIDE;\r\n\r\n\t\t// compute miter join position first\r\n\t\tfloat displacementLen \x3d lineWidth;\r\n\t\tVECTYPE displacementDir \x3d normalize(left + right);\r\n\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\r\n\t\tif (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\r\n\t\t\tfloat nDotSeg \x3d dot(displacementDir, left);\r\n\t\t\tdisplacementLen /\x3d length(nDotSeg*left - displacementDir);\r\n\r\n\t\t\t// limit displacement of inner vertices\r\n\t\t\tif (!isOutside)\r\n\t\t\t\tdisplacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\r\n\t\t}\r\n\r\n\t\tif (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\r\n\t\t\t// convert to bevel join if miterLimit is exceeded\r\n\t\t\tif (leftLen \x3c 0.001)\r\n\t\t\t    displacementDir \x3d right;\r\n\t\t\telse if (rightLen \x3c 0.001)\r\n\t\t\t\tdisplacementDir \x3d left;\r\n\t\t\telse\r\n\t\t\t\tdisplacementDir \x3d (abs($uv0.y) - 1.1 \x3c 0.0) ? left : right;\r\n\t\t\tdisplacementDir \x3d normalize(displacementDir);\r\n\t\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\r\n\t\t\tdisplacementLen \x3d lineWidth;\r\n\t\t}\r\n\r\n#endif // ifdef WALL\r\n\r\n#ifdef SCREENSCALE\r\n\t\tpos.xy +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\r\n\t\tpos.xy /\x3d screenSize;\r\n#else\r\n\t\tpos.xyz +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\r\n\t\tpos \x3d proj * view * model * pos;\r\n#endif\r\n\r\n\t\tvtc \x3d $uv0;\r\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255\r\n\t\tgl_Position \x3d pos;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonLine"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n\tuniform vec4 eColor;\r\n\tvarying vec4 vColor;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main() {\r\n\t\tgl_FragColor \x3d eColor * vColor;\r\n\t\t//gl_FragColor.a \x3d 1;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonLineHighlight"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvoid main() {\r\n\t\tgl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/WaterMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderWater"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tattribute vec3 $position;\r\n\tvarying vec3 vpos;\r\n\r\n\tvoid main(void) {\r\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderWater"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec3 color;\r\n\tuniform float scale;\r\n\tuniform float speed;\r\n\r\n\tuniform vec4 lightAmbient;\r\n\tuniform vec4 lightDiffuse;\r\n\tuniform vec4 lightSpecular;\r\n\tuniform vec3 lightDirection;\r\n\r\n\tuniform vec3 camPos;\r\n\r\n\tuniform sampler2D noiseTex;\r\n\tuniform sampler2D reflTex;\r\n\r\n\tuniform sampler2D depthTex;\r\n\tuniform int shadowMapNum;\r\n\tuniform vec4 shadowMapDistance;\r\n\tuniform mat4 shadowMapMatrix[4];\r\n\tuniform float depthHalfPixelSz;\r\n\r\n\tvarying vec3 vpos;\r\n\r\n\t$evalShadow\r\n\r\n\t$normal2envTC\r\n\r\n\tvec2 rotate(vec2 pos, float angle) {\r\n\t\tfloat c \x3d cos(angle);\r\n\t\tfloat s \x3d sin(angle);\r\n\t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\r\n\t}\r\n\r\n\tfloat compDelta(vec2 pos) {\r\n\t\tconst float PI_THIRD \x3d 1.04719755;\r\n\r\n\t\tfloat result \x3d .0;\r\n\t\tfloat s \x3d 1.0;\r\n\t\tfor (int i \x3d 0; i \x3c 6; ++i) {\r\n\t\t\tvec2 tc \x3d pos / (20.0 * s);\r\n\t\t\ttc +\x3d rotate(vec2(1.0 + speed, .0), PI_THIRD * float(i));\r\n\t\t\tresult +\x3d s * texture2D(noiseTex, tc).r;\r\n\t\t\ts *\x3d 1.5;\r\n\t\t}\r\n\t\treturn result * scale * .2;\r\n\t}\r\n\r\n\tvoid main() {\r\n\t\tvec3 viewVec \x3d normalize(camPos - vpos);\r\n\r\n\t\tfloat d0 \x3d compDelta(vpos.xz);\r\n\t\tfloat dx \x3d compDelta(vpos.xz + vec2(.05, .0));\r\n\t\tfloat dz \x3d compDelta(vpos.xz + vec2(.0, .05));\r\n\r\n\t\tvec3 normal \x3d normalize(vec3(d0 - dx, .05, d0 - dz));\r\n\r\n\t\tfloat fresnel \x3d clamp(1.0 - 1.25 * dot(viewVec, normal), .0, 1.0);\r\n\r\n\t\tfloat shadow \x3d 0.0;\r\n\t\tif (halfPxSz \x3e\x3d .0) {\r\n\t\t\tshadow \x3d evalShadow(vpos, 1.0 / gl_FragCoord.w, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n\t\t}\r\n\r\n\t\tvec3 reflDir \x3d reflect(-viewVec, normal);\r\n\t\tif (reflDir.y \x3c .02) reflDir.y \x3d 0.04 - reflDir.y;\r\n\r\n\t\tvec3 reflCol \x3d texture2D(reflTex, normal2envTC(reflDir)).rgb * lightAmbient.rgb*lightSpecular.w;\r\n\t\treflCol *\x3d .5 + max(lightDirection.y, .0) * .5; // ?\t+\r\n\t\tvec3 waterColor \x3d color * (lightAmbient.rgb * lightAmbient.w + (1.0 - shadow) * max(lightDirection.y, .0) * lightDiffuse.rgb * lightDiffuse.w);\r\n\t\tvec3 finalColor \x3d mix(waterColor, reflCol, .15 + .6 * fresnel);\r\n\r\n\t\tvec3 spec \x3d pow(max(dot(reflDir, lightDirection), .001), 80.0) * lightSpecular.rgb * lightSpecular.w * 2.0;\r\n\t\tfinalColor +\x3d (1.0 - shadow) * lightDiffuse.w * spec;\r\n\r\n\t\tgl_FragColor \x3d vec4(finalColor, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/BlendLayers.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBlendLayers"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\r\n\tuniform float scale;\r\n\tuniform vec2 offset;\r\n\r\n\tvarying vec2 uv;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d vec4($position, 1.0);\r\n\t\tuv \x3d $uv0 * scale + offset;;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderBlendLayers"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n\tvarying vec2 uv;\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform float opacity;\r\n\r\n\tvoid main() {\r\n\t\tvec4 color \x3d texture2D(tex, uv);\r\n\r\n    // Note: output in pre-multiplied alpha for correct alpha compositing\r\n\t\tgl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/terrain/TerrainMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrain"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform vec3 origin;\r\n  uniform vec2 texOffset;\r\n  uniform float texScale;\r\n  uniform mat4 viewNormal;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n  varying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n  uniform vec3 lightDirection;\r\n  varying vec3 wpos;\r\n  varying vec3 wview;\r\n  varying vec3 wnormal;\r\n  varying vec3 wlight;\r\n#endif\r\n\r\n#ifdef OVERLAY\r\n  uniform vec2 overlayTexOffset;\r\n  uniform vec2 overlayTexScale;\r\n  varying vec2 vtcOverlay;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n  varying float screenSizeDistanceToCamera;\r\n  varying float screenSizeCosAngle;\r\n\r\n#endif\r\n\r\n  void main(void) {\r\n    vpos \x3d $position;\r\n\r\n#ifdef SPHERICAL\r\n    vnormal \x3d normalize(vpos + origin);\r\n#else\r\n    vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n    wpos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n    wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\r\n    wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\r\n#endif\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n    vuv \x3d $uv0;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n    vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n\r\n    screenSizeDistanceToCamera \x3d length(viewPos);\r\n\r\n    vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\r\n    screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\r\n\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n    vtc \x3d $uv0*texScale + texOffset;\r\n\r\n#ifdef OVERLAY\r\n    vtcOverlay \x3d $uv0*overlayTexScale + overlayTexOffset;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainCommon"\x3e\x3c![CDATA[\r\n  uniform vec3 lightDirection;\r\n  uniform vec3 viewDirection;\r\n  uniform sampler2D depthTex;\r\n  uniform int shadowMapNum;\r\n  uniform vec4 shadowMapDistance;\r\n  uniform mat4 shadowMapMatrix[4];\r\n  uniform float depthHalfPixelSz;\r\n  uniform sampler2D ssaoTex;\r\n  uniform vec4 viewportPixelSz;\r\n  uniform sampler2D tex;\r\n  uniform float opacity;\r\n\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n  varying vec2 vtc;\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n  varying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n  varying vec3 wpos;\r\n  varying vec3 wview;\r\n  varying vec3 wnormal;\r\n  varying vec3 wlight;\r\n#endif\r\n\r\n  $sceneLightingDefinitions\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n  $screenSizePerspective\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n  varying float screenSizeDistanceToCamera;\r\n  varying float screenSizeCosAngle;\r\n#endif\r\n\r\n  const vec3 ambient \x3d vec3(0.2,0.2,0.2);\r\n  const vec3 diffuse \x3d vec3(0.8,0.8,0.8);\r\n  const float diffuseHardness \x3d 2.5;\r\n\r\n#ifdef OVERLAY\r\n  uniform sampler2D overlayTex;\r\n  uniform float overlayOpacity;\r\n  varying vec2 vtcOverlay;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\t$evalShadow\r\n#endif\r\n\r\n  float lum(vec3 c) {\r\n    float max \x3d max(max(c.r, c.g), c.b);\r\n    float min \x3d min(min(c.r, c.g), c.b);\r\n    return (min + max) * 0.5;\r\n  }\r\n\r\n#ifdef ATMOSPHERE\r\n  vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\r\n    vec3 surfaceColor   \x3d vec3(0.0);\r\n    vec3 fuzzySpecColor \x3d vec3(1.0);\r\n    vec3 subColor       \x3d vec3(0.0);\r\n    float rollOff       \x3d 1.0;\r\n\r\n    vec3 Ln \x3d normalize(lightPos);\r\n    vec3 Nn \x3d normalize(normal);\r\n    vec3 Hn \x3d normalize(view + Ln);\r\n\r\n    float ldn \x3d dot(Ln, Nn);\r\n    float diffComp \x3d max(0.0, ldn);\r\n    float vdn \x3d 1.0 - dot(view, Nn);\r\n    float ndv \x3d dot(view, Ln);\r\n\r\n    vec3 diffContrib \x3d surfaceColor * diffComp;\r\n    float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\r\n\r\n    vec3 subContrib \x3d subLamb * subColor;\r\n    vec3 vecColor \x3d vec3(vdn);\r\n\r\n    vec3 diffuseContrib \x3d (subContrib + diffContrib);\r\n    vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\r\n\r\n    return (diffContrib + specularContrib) * rollOff;\r\n  }\r\n#endif\r\n\r\n  void main() {\r\n    vec3 a \x3d ambient;\r\n\r\n    float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n    shadow \x3d evalShadow(vpos, 1.0 / gl_FragCoord.w, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#endif\r\n    float vndl \x3d dot(normalize(vnormal), lightDirection);\r\n    float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\r\n    vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\r\n\r\n    float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n    vec4 texCol \x3d texture2D(tex, vtc);\r\n\r\n#ifdef OVERLAY\r\n    if ((vtcOverlay.x \x3e 0.0) \x26\x26 (vtcOverlay.y \x3e 0.0) \x26\x26 (vtcOverlay.x \x3c 1.0) \x26\x26 (vtcOverlay.y \x3c 1.0)) {\r\n      vec4 overlayTexCol \x3d texture2D(overlayTex, vtcOverlay);\r\n      overlayTexCol *\x3d overlayOpacity;\r\n      texCol \x3d texCol * (1.0 - overlayTexCol.a) + overlayTexCol; // texCol and overlayTexCol have pre-multiplied alpha\r\n    }\r\n#endif\r\n\r\n    vec3 atm \x3d vec3(0.0);\r\n#ifdef ATMOSPHERE\r\n    float ndotl \x3d max(0.0, min(1.0, vndl));\r\n    atm \x3d atmosphere(wlight, wnormal, -viewDirection);\r\n    atm *\x3d max(0.0, min(1.0, (1.0-lum(texCol.rgb)*1.5))); //avoid atmosphere on bright base maps\r\n    atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\r\n#endif\r\n\r\n    vec3 albedo \x3d atm + texCol.rgb;\r\n    vec3 normal \x3d normalize(vnormal);\r\n\r\n    // heuristic shading function used in the old terrain, now used to add ambient lighting\r\n    float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n\t\tvec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n\r\n    gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), texCol.a) * opacity;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n    // This is only used for debug rendering the screenSize perspective\r\n\r\n    float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\r\n\r\n    if (perspectiveScale \x3c\x3d 0.25) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 0, 1), perspectiveScale * 4.0);\r\n    }\r\n    else if (perspectiveScale \x3c\x3d 0.5) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 0, 1, 1), (perspectiveScale - 0.25) * 4.0);\r\n    }\r\n    else if (perspectiveScale \x3e\x3d 0.99) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 1, 0, 1), 0.2);\r\n    }\r\n    else {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), (perspectiveScale - 0.5) * 2.0);\r\n    }\r\n\r\n#endif\r\n\r\n  // closing } is missing here, it\'s in the shaders using this snippet below\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainWireframe"\x3e\x3c![CDATA[\r\n#ifdef GL_OES_standard_derivatives\r\n#extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\n  $fsprecisionf\r\n\r\n  struct WireframeSettings {\r\n    float width;\r\n    float falloff;\r\n    float subdivision;\r\n    vec4 color;\r\n    float wireOpacity;\r\n    float surfaceOpacity;\r\n  };\r\n\r\n  uniform WireframeSettings wireframe;\r\n\r\n    $fsTerrainCommon\r\n\r\n    vec2 dVuv;\r\n    vec2 vuvScaled \x3d vuv * wireframe.subdivision;\r\n    vec2 vuvMod \x3d fract(vuvScaled);\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    dVuv \x3d fwidth(vuvScaled);\r\n#else\r\n    // Something that reasonably works\r\n    dVuv \x3d vec2(0.05);\r\n#endif\r\n\r\n    vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                                  wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\r\n\r\n    float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n#ifdef WIREFRAME\r\n    gl_FragColor \x3d vec4(mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a),\r\n                        mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor));\r\n#endif\r\n\r\n\r\n#ifdef TILE_BORDERS\r\n    dVuv \x3d fwidth(vuv);\r\n    edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                              wireframe.width * dVuv, min(vuv, 1.0 - vuv));\r\n    edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrain"\x3e\x3c![CDATA[\r\n    $fsprecisionf\r\n    $fsTerrainCommon\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainNormal"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform vec3 origin;\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 viewNormal;\r\n  attribute vec3 $position;\r\n  varying vec3 vnormal;\r\n\r\n  void main(void) {\r\n#ifdef SPHERICAL\r\n    vec4 normal \x3d vec4(normalize($position + origin), 1.0);\r\n#else\r\n    vec4 normal \x3d vec4(0.0, 1.0, 0.0, 1.0);\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4($position, 1.0);\r\n    vnormal \x3d normalize((viewNormal * normal).xyz);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainDepthOnly"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n\r\n  attribute vec3 $position;\r\n\r\n  void main() {\r\n    gl_Position \x3d proj * view * vec4($position, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainDepthOnly"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  void main() {\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainHighlight"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform vec2 overlayTexScale;\r\n  uniform vec2 overlayTexOffset;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  varying vec2 vtcOverlay;\r\n\r\n  void main() {\r\n    vtcOverlay \x3d $uv0*overlayTexScale + overlayTexOffset;\r\n\r\n    gl_Position \x3d proj * view * vec4($position, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainHighlight"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D overlayTex;\r\n\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n  varying vec2 vtcOverlay;\r\n\r\n  void main() {\r\n    vec4 texCol \x3d vec4(0,0,0,0);\r\n    if ((vtcOverlay.x \x3e 0.0) \x26\x26 (vtcOverlay.y \x3e 0.0) \x26\x26 (vtcOverlay.x \x3c 1.0) \x26\x26 (vtcOverlay.y \x3c 1.0)) {\r\n      texCol \x3d texture2D(overlayTex, vtcOverlay);\r\n    }\r\n\r\n    if (texCol.a \x3d\x3d 0.0) {\r\n      // Here we have to write black, instead of discarding the fragment in order to overwrite\r\n      // the highlights which might have been written by skirts of other tiles.\r\n      // As a consequence skirts are not visible, but terrain overwrites draped highlights.\r\n      gl_FragColor \x3d vec4(0,0,0,0);\r\n      return;\r\n    }\r\n\r\n    $highlightWrite\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"*now":function(B){B(['dojo/i18n!*preload*esri/views/nls/SceneView*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},"*noref":1}});
define("../core/accessorSupport/watch dojo/_base/lang dojo/_base/kernel dojo/dom dojo/Deferred dojo/when ./View ./BreakpointsOwner ./DOMContainer ./ViewAnimation ./animation/easing ../geometry/HeightModelInfo ../geometry/SpatialReference ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../Camera ../Graphic ../geometry/Point ../geometry/Extent ../geometry/ScreenPoint ../Viewpoint ../core/Scheduler ../core/sniff ../core/watchUtils ../core/promiseUtils ../core/Error ../core/Logger ../core/HandleRegistry ../webscene/Environment ./support/screenshotUtils ./support/WebGLRequirements ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/constraints/SceneViewConstraints ./3d/input/SceneInputManager ./3d/lib/glMatrix ./3d/support/cameraUtils ./3d/support/viewpointUtils ./3d/support/projectionUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Selector ./3d/support/CombinedElevationProvider ./3d/support/HighlightOptions ./3d/support/RenderCoordsHelper ./3d/support/MapCoordsHelper ./3d/support/ResourceController ./3d/support/DisplayQualityProfile ./3d/support/QualitySettings ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/support/debugFlags ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/layers/graphics/Deconflictor ./3d/layers/GraphicsView3D ./3d/navigation/spherical/NavigationSpherical ./3d/navigation/planar/NavigationPlanar ./3d/support/Frustum ./ui/3d/DefaultUI3D".split(" "),function(B,
r,f,a,b,c,t,p,h,l,q,y,z,w,u,C,E,G,n,A,x,I,K,J,N,M,Q,S,P,O,T,U,W,k,ca,V,e,d,g,m,v,D,L,R,Z,ba,ja,aa,ea,ha,ga,ma,fa,Y,wa,oa,ta,F,la){function ua(a,b){return function(){return this._internallyReady?b.apply(this,arguments):this._get(a)}}function ya(a,b){return function(c){if(this._internallyReady)return b.apply(this,arguments);this._initialProps[a]=c;this._set(a,c);Da[a]&&this.notifyChange("initialExtentRequired")}}ea=ea.default;var ra=Q.getLogger("esri.views.SceneView"),Aa=V.vec3d,qa=Aa.create();Q=new G(0,
0,0);var da=new C(new G(0,0,0)),Ga={point:Q,retval:null},za={heading:0,tilt:0},Da={camera:["viewpoint"],viewpoint:["extent"],extent:["center","scale"],scale:["zoom"],center:[],zoom:[]},Fa=Object.keys(Da);ha=ha.default;return h.createSubclass([t,p],{declaredClass:"esri.views.SceneView",properties:{animation:{type:l,value:null},basemapTerrain:{readOnly:!0,value:null},elevationProvider:{readOnly:!0,value:null},camera:{copy:function(a,b){a.position.x=b.position.x;a.position.y=b.position.y;a.position.z=
b.position.z;a.position.spatialReference=b.position.spatialReference;a.heading=b.heading;a.tilt=b.tilt},type:C},canvas:{readOnly:!0,value:null},center:{copy:function(a,b){if(!a)return b.clone();a.x=b.x;a.y=b.y;a.z=b.z;a.spatialReference=b.spatialReference;return a},dependsOn:["pointsOfInterest.centerOnContent.location"],type:G},clippingArea:{type:n,dependsOn:["map.clippingArea","map.clippingEnabled","viewingMode"],get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;
var a=this.get("map.clippingEnabled"),b=this.get("map.clippingArea");if(!a||!b)return this._clippingArea=null;if(!(b instanceof n))return ra.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(u.canProject(b.spatialReference,this.spatialReference))b=u.project(b,this.spatialReference);else return ra.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;return this._clippingArea&&b&&this._clippingArea.equals(b)?
this._clippingArea:this._clippingArea=b},set:function(a){this.ready&&"global"===this.viewingMode&&a?ra.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))}},constraints:{type:k,value:null},dataExtent:{dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0,get:function(){function a(a){a&&(a=u.project(a,c))&&(d&&(a=a.intersection(d)),a&&b.push(a))}var b=[],c=this.spatialReference||z.WGS84,d=this.clippingArea;
d&&(d=u.project(d,c));var e=this._get("basemapTerrain");e&&e.spatialReference&&a(new n({xmin:e.extent[0],ymin:e.extent[1],zmin:0,xmax:e.extent[2],ymax:e.extent[3],zmax:0,spatialReference:e.spatialReference}));this.map&&this.map.allLayers.forEach(function(b){a(b.fullExtent)});return 0<b.length?(e=b.reduce(function(a,b){return a.union(b)}),e.hasZ?(e.zmin=Math.min(0,e.zmin),e.zmax=Math.max(0,e.zmax)):(e.zmin=0,e.zmax=0),e):new n({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:c})}},environment:{value:null,
set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);a?a instanceof U?this._set("environment",a):a instanceof P?this.environment.lighting=a.lighting:a.declaredClass?this._set("environment",a):this._set("environment",new U(a)):this._set("environment",new U)}},environmentManager:{},extent:{copy:function(a,b){a.xmin=b.xmin;a.ymin=b.ymin;a.zmin=b.zmin;a.xmax=b.xmax;a.ymax=b.ymax;a.zmax=b.zmax;a.spatialReference=b.spatialReference},type:n},fullOpacity:1,groundExtent:{dependsOn:["basemapTerrain.extent"],
readOnly:!0,get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=a.extent;return new n({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new n({spatialReference:this.spatialReference||z.WGS84})}},initialExtentRequired:{dependsOn:["map.initialViewProperties.viewpoint"],get:function(){if(this.get("map.initialViewProperties.viewpoint"))return!1;for(var a=0;a<Fa.length;a++)if(this._initialProps&&void 0!==this._initialProps[Fa[a]])return!1;
return!0}},interacting:{dependsOn:["navigation.interacting"],get:function(){return!(!this.navigation||!this.navigation.interacting)}},map:{value:null},mapCoordsHelper:{},pointsOfInterest:ha,screenSizePerspectiveEnabled:!0,navigation:{readOnly:!0,value:null},inputManager:{},qualityProfile:{set:function(a){ja.isValidProfile(a)&&(ja.apply(a,this),this._set("qualityProfile",a))}},qualitySettings:{type:aa},ready:{dependsOn:["viewingMode"]},renderCoordsHelper:{},resolution:{dependsOn:["scale","spatialReference"],
readOnly:!0,get:function(){return null!=this.spatialReference?w.getResolutionForScale(this.scale,this.spatialReference):0}},scale:{dependsOn:["pointsOfInterest.centerOnContent.distance"]},spatialReference:{dependsOn:["map.initialViewProperties.spatialReference","defaultsFromMap.isSpatialReferenceDone"]},isHeightModelInfoRequired:!0,type:"3d",ui:{type:la},updating:{},updatingPercentage:0,viewingMode:{dependsOn:["map.initialViewProperties.viewingMode","spatialReference"],get:function(){var a=this.get("map.initialViewProperties.viewingMode"),
b=this.spatialReference;a||(a=!b||b.isWebMercator||b.isWGS84?"global":"local");return a},set:function(a){this._internallyReady?ra.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")}},viewpoint:{copy:function(a,b){a.rotation=b.rotation;a.scale=b.scale;a.targetGeometry=b.targetGeometry;a.camera=b.camera},dependsOn:["camera"],type:x},zoom:{dependsOn:["scale"]},highlightOptions:{type:L}},
getDefaults:function(a){var b=this.inherited(arguments);b.constraints||a.constraints||(this._defaults.constraints=new k,b.constraints=this._defaults.constraints);b.environment||a.environment||(this._defaults.environment=new U,b.environment=this._defaults.environment);b.qualitySettings=new aa;b.qualityProfile=ja.getDefaultProfile();b.highlightOptions=new L;return b},constructor:function(){J.when(this,"ready",this._viewReadyHandler.bind(this));this._internallyReady=!1;this._initialProps={};this._initialDefaultSpatialReference=
this._gotoTask=this._userClippingArea=null;this._initCoordinateSystem();this._frustum=new F;this._clippingArea=this._constraints=this._animationStateWatcher=null;this.inputManager=new ca({view:this});this._defaults={};this._externallySet={};this.resourceController=new ba(this);this.deconflictor=new Y(this);this._evaluateUpdating=this._evaluateUpdating.bind(this);this._layerViewsUpdatingHandles={};this._navigationHandles=new S;this._stageHandles=new S;this._navigationPauseNotifications=!1;this._navigationHandles.add([J.on(this,
"navigation","currentViewChanged",this._navigationCurrentViewChanged.bind(this),null,null,!0),J.on(this,"navigation","currentViewReachedTarget",this._navigationCurrentViewReachedTarget.bind(this),null,null,!0),J.on(this,"navigation","targetViewChanged",function(a){this._navigationPauseNotifications||this._navigationTargetViewChanged(a)}.bind(this),null,null,!0),J.on(this,"navigation","animationStarted",function(a){this._navigationPauseNotifications||this._navigationAnimationStarted(a)}.bind(this),
null,null,!0)]);this.watch("map",function(a){a&&a.load&&a.load()})},initialize:function(){this.environmentManager=new W({view:this});this._updateUpdatingMonitorsHandle=this.allLayerViews.on("change",this._updateUpdatingMonitors.bind(this));this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[],moved:[]});J.whenNot(this,"ready",this._viewUnreadyHandler.bind(this));J.init(this.qualitySettings,"gpuMemoryLimit",function(a){this.resourceController&&this.resourceController.setMaxGpuMemory(a)}.bind(this))},
destroy:function(){B.dispatchTarget(this);this.environmentManager.destroy();this._disposeGraphicsView();this._updateUpdatingMonitorsHandle.remove();this._updateUpdatingMonitorsHandle=null;this._navigationHandles.remove();this._navigationHandles=null;this._stageHandles.remove();this.inputManager&&(this.inputManager.destroy(),this.inputManager=null)},destroyLayerViews:function(){for(var a in this._layerViewsUpdatingHandles)this._layerViewsUpdatingHandles[a].remove();this._layerViewsUpdatingHandles=
{};this._disposeSurface();this.inherited(arguments);this._stage&&(this._stage.dispose(),this._stage=null,this._stageHandles.remove());this._setCanvas(null);this.deconflictor.destroy();this.deconflictor=null;this.resourceController.destroy();this.resourceController=null},on:function(a,b,c){var d=this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)},toMap:function(a,b,c){if(!this._internallyReady)return ra.error("#toMap()","Scene view cannot be used before it is ready"),
null;a=this._normalizePointArgs(a,b,void 0,c);b=this._stage.pick([a.point.x,this.height-a.point.y]).getMinResult();return this._computeMapPointFromIntersectionResult(b,a.retval)},toScreen:function(a,b,c,d){if(!this._internallyReady)return ra.error("#toScreen()","Scene view cannot be used before it is ready"),null;a=this._normalizePointArgs(a,b,c,d);g.pointToVector(a.point,qa,this.renderSpatialReference);return this.engineToScreen(qa,a.retval)},pixelSizeAt:function(a,b,c){if(!this._internallyReady)return ra.error("#pixelSizeAt()",
"Scene view cannot be used before it is ready"),null;if("esri.geometry.ScreenPoint"===a.declaredClass){if(!this._stage.pick([a.x,this.height-a.y]).getMinResult().getIntersectionPoint(qa))return 0}else a=this._normalizePointArgs(a,b,c,void 0),g.pointToVector(a.point,qa,this.renderSpatialReference);return this.navigation.currentCamera.computePixelSizeAt(qa)},hitTest:function(a,b){if(!this._internallyReady)return ra.error("#hitTest()","Scene view cannot be used before it is ready"),null;a=this._normalizePointArgs(a,
b,void 0,void 0);var d=[a.point.x,this.height-a.point.y],e=this._stage.pick(d,null,!0);a=e.getMinResult();var f=this._computeMapPointFromIntersectionResult(a),g;switch(a.targetType){case "None":g=null;break;case "StageObject":g=this._getGraphicFromStageObject(a.target,a.triangleNr);break;case "StagePoint":g=this._getGraphicFromStagePoint(a.target)}return c(g).otherwise(function(){return null}).then(function(a){var b=[];(a||f)&&b.push({mapPoint:f,graphic:a});a={screenPoint:d,results:b};ga.SCENEVIEW_HITTEST_RETURN_SELECTOR&&
(a.selector=e);return a})},goTo:function(a,b){if(this._internallyReady)return b=r.mixin({animate:!0},b),a=d.create(this,a,b),this._gotoTask={},b.animate?this._gotoAnimated(a,b):this._gotoImmediate(a,b);ra.error("#goTo()","Scene view cannot be used before it is ready")},animateTo:function(a,b){f.deprecated(this.declaredClass+".animateTo is deprecated. Use .goTo instead.","","4.0");return this.goTo(a,b)},takeScreenshot:function(a){if(this._internallyReady){a=O.adjustScreenshotSettings(a,this);var c=
new b;this._stage.requestScreenCapture(a,function(a){I.schedule(function(){c.resolve(a)})});return c.promise}ra.error("#takeScreenshot()","Scene view cannot be used before it is ready")},engineToScreen:function(a,b){var c=Aa.create();this._stage.getCamera().projectPoint(a,c);a=c[0];var d=this.height-c[1],c=c[2];return b?(b.x=a,b.y=d,b.z=c,b):new A({x:a,y:d,z:c})},getDefaultSpatialReference:function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||
this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null},validate:function(){var a=T.check();K("safari")&&9>K("safari")&&(a=new M("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:K("safari")}));return a?(ra.warn("#validate()",a.message),N.reject(a)):N.resolve()},isSpatialReferenceSupported:function(a,b){var c=a.isGeographic,d=a.isWebMercator,e=a.isWGS84,f="local"===
this.viewingMode,g=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(g){if(f&&c||!f&&!d&&!e)return!1}else if(c&&!e)return!1;if(b)if(fa.isTiledLayer(b)){if(g?c=fa.getTiledLayerInfo(b,a,this.viewingMode):(c=fa.getTiledLayerInfo(b,a,"global"),null==c.tileInfo&&(c=fa.getTiledLayerInfo(b,a,"local"))),null==c.tileInfo)return!1}else if((e||d)&&!f)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),g||this.ready||(this.viewingMode=
"global"),!1;return!0},has:function(a){return this._stage.has(a)},flushDisplayModifications:function(){this._stage.processDirty()},getFrustum:function(){this._frustum.dirty&&this._frustum.update(this.navigation.currentCamera);return this._frustum},getDrawingOrder:function(a){return this.allLayerViews.findIndex(function(b){return b.layer&&b.layer.uid===a})},getViewForGraphic:function(a){return a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):this._graphicsView},whenViewForGraphic:function(a){return a.layer?
this.whenLayerView(a.layer):N.resolve(this._graphicsView)},renderSpatialReference:null,_graphicsView:null,_surfaceReadyWatchHandle:null,_stageHandles:null,_navigationHandles:null,_gotoImmediate:function(a,b){var c=this._gotoTask;return a.then(function(a){c===this._gotoTask&&(this.viewpoint=a)}.bind(this))},_gotoAnimated:function(a,b){!this.animation||"running"!==this.animation.state&&"waiting-for-target"!==this.animation.state?this.animation=new l({target:a}):this.animation.target=a;var c=this.animation;
c.state="waiting-for-target";a.then(function(f){if(c.target===a&&this.animation===c){c.target=f;c.state="running";f=d.toCamera(this,f);if(!f)throw ra.error("#goTo()","Invalid target specified for animateTo"),new M("goto:invalid-camera","Invalid camera in conversion from viewpoint");this._cameraAlmostEquals(this.camera,f)?c.finish():(f=e.externalToInternal(this,f),f.almostEquals(this.navigation.currentCamera,5E-4/this.renderCoordsHelper.unitInMeters)?c.finish():(this._navigationPauseNotifications=
!0,this._setInternalCamera(f,this._animateOptions(b)),c.state===l.State.STOPPED&&c.stop(),this._navigationPauseNotifications=!1))}}.bind(this)).otherwise(function(){c.target===a&&this.animation===c&&(this.animation=null,c.finish())});return c},_animateOptions:function(a){var b={animate:!0};a&&null!=a.speedFactor&&(b.speedFactor=a.speedFactor);a&&null!=a.duration&&(b.duration=a.duration/1E3);a&&null!=a.minDuration&&(b.minDuration=a.minDuration/1E3);a&&null!=a.maxDuration&&(b.maxDuration=a.maxDuration/
1E3);a&&null!=a.easing&&(b.easing="string"===typeof a.easing?q.named[a.easing]:a.easing);return b},_trackCanvasSize:function(){this.on("resize",function(a){if(this.canvas){this.canvas.width=a.width;this.canvas.height=a.height;var b=this._stage.getCamera();b.width=a.width;b.height=a.height;this._stage.setCamera(b);this.navigation&&(this.navigation.windowSize=[a.width,a.height])}}.bind(this));this.canvas.width=this.width;this.canvas.height=this.height},_computeMapPointFromIntersectionResult:function(a,
b){if(a.getIntersectionPoint(qa)){b=this._computeMapPointFromVec3d(qa,b);var c=this._get("basemapTerrain");"terrain"===a.intersector&&c&&(a=c.getElevation(b),null!==a&&(b.z=a));return b}return null},_computeMapPointFromVec3d:function(a,b){var c=this.spatialReference||z.WGS84;g.vectorToVector(a,this.renderSpatialReference,a,c)||(c=z.WGS84,g.vectorToVector(a,this.renderSpatialReference,a,c));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=c):b=new G(a,c);return b},_getGraphicFromStageObject:function(a,
b){var c=a.getMetadata();if(null!=c&&null!=c.layerUid){if(c.layerUid===this._graphicsView.mockLayerId)return this._graphicsView.getGraphicsFromStageObject(a,b);if(c=this.map.findLayerByUid(c.layerUid))return this.whenLayerView(c).then(function(c){if(c&&null!=c.getGraphicsFromStageObject&&!c.suspended)return c.getGraphicsFromStageObject(a,b)})}return null},_getGraphicFromStagePoint:function(a){var b=this._computeMapPointFromVec3d(a.point),b=new E(b);a=a.metadata.layerUid;null!=a&&(b.layer=this.map.findLayerByUid(a));
return b},_viewingModeToManifold:function(a){return{local:"planar",global:"spherical"}[a]},_initBasemapTerrain:function(a){this._disposeBasemapTerrain();this._set("basemapTerrain",new ma(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new D({view:this}));this.elevationProvider.register("ground",this.basemapTerrain);this.navigation.elevationProvider=this.basemapTerrain},_initGlobe:function(a){this._initCoordinateSystem();this._initNavigation(a);this._stage.setViewParams({backgroundColor:[0,
0,0,0],maxFarNearRatio:0,frustumCullingEnabled:!1});this._initBasemapTerrain(a);this._navigationCurrentViewChanged({camera:this.navigation.currentCamera})},_initCoordinateSystem:function(){if(this.spatialReference){var a=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(a)||(this.mapCoordsHelper=new Z(this.map,a));var b=this.renderCoordsHelper?this.renderCoordsHelper.unitInMeters:1,c="global"===this.viewingMode,a=c?g.SphericalRenderSpatialReference:a;a!==this.renderSpatialReference&&
(this.renderSpatialReference=a,this.renderCoordsHelper=new (c?R.Spherical:R.Planar)(a),this._stage&&this._stage.setIntersectTolerance(v.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters),this._constraints&&this._constraints.scale(b/this.renderCoordsHelper.unitInMeters))}else this.renderSpatialReference=this.renderCoordsHelper=this.mapCoordsHelper=null},_paddingEqualsArray:function(a){var b=this.padding;return b?b.top===a[0]&&b.right===a[1]&&b.bottom===a[2]&&b.left===a[3]:!0},_navigationCurrentViewChanged:function(a){this._frustum.dirty=
!0;a=a.camera;var b=a.padding,c=this._get("basemapTerrain"),d=c.spatialReference;d&&(d=this.renderCoordsHelper.fromRenderCoords(a.eye,d),c=c.getElevation(d)||0,a.aboveGround=d.z>=c);this._paddingEqualsArray(b)||(c=this._padding,b={top:b[0],right:b[1],bottom:b[2],left:b[3]},this._internallyReady?(this._padding=b,this.notifyChange("padding",c,b)):this.padding=b);this._stage.setCamera(a);this.notifyChange("extent");b=this.camera;a=e.internalToExternal(this,a,da);b&&this._cameraAlmostEquals(b,a)||this.notifyChange("camera")},
_cameraAlmostEquals:function(a,b){return 1E-5>Math.abs(a.tilt-b.tilt)&&1E-5>Math.abs(a.heading-b.heading)&&1E-5>Math.abs(a.fov-b.fov)&&a.position.equals(b.position)},_navigationAnimationStarted:function(a){a=d.fromInternalCamera(this,this.navigation.targetCamera);this.animation?this.animation.target=a:this.animation=new l({target:a})},_navigationTargetViewChanged:function(a){if(this.animation&&"waiting-for-target"!==this.animation.state){a=a.camera;var b=this.spatialReference||z.WGS84,c=e.internalToExternal(this,
a);a=new x({camera:c,targetGeometry:g.vectorToPoint(a.center,b,this.renderSpatialReference),scale:e.computeScale(this,a),rotation:d.headingToRotation(c.heading)});this.animation.target=a}},_navigationCurrentViewReachedTarget:function(a){if(a.interruptedAnimation||a.finishedAnimation)this._gotoTask=null;if(this.animation&&(a.interruptedAnimation||a.finishedAnimation)){this._animationStateWatcher&&(this._animationStateWatcher.remove(),this._animationStateWatcher=null);var b=this.animation;this.animation=
null;a.finishedAnimation?b.finish():b.stop();this.notifyChange("animation")}},_setInternalCamera:function(a,b){a&&(this.navigation.setCamera(a,b),this._externallySet.camera=!0);return!!a},_setCamera:function(a,b){return this._setInternalCamera(e.externalToInternal(this,a),b)},_evaluateUpdating:function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.updating&&(c=!0,d=d.updatingPercentage,null!=d&&(++b,a+=d))});this._graphicsView&&this._graphicsView.updating&&(c=!0);c!==this.updating&&
(this.updating=c);a=0!==b?a/b:c?100:0;this.updatingPercentage!==a&&(this.updatingPercentage=a)},_updateUpdatingMonitors:function(a){for(var b=0;b<a.removed.length;b++){var c=a.removed[b],d=this._layerViewsUpdatingHandles[c.uid];d&&(delete this._layerViewsUpdatingHandles[c.uid],c.destroyed||d.remove())}for(b=0;b<a.added.length;b++)c=a.added[b],c.destroyed||(d=c.watch(["updating","updatingPercentage"],this._evaluateUpdating),this._layerViewsUpdatingHandles[c.uid]=d);this._evaluateUpdating()},_spatialReferenceSetter:function(a){this.inherited(arguments);
this._initCoordinateSystem()},_setInitialView:function(a){if(a&&!this._externallySet.camera){var b=null;a instanceof x&&!a.camera&&a.targetGeometry instanceof n&&(b=d.rotationToHeading(a.rotation),a=a.targetGeometry);if(a instanceof x)this.viewpoint=a;else if(a instanceof C)this.camera=a;else{var c=this._getDesiredHeadingTilt();null!=b&&(c.heading=b);d.create(this,{target:a,heading:c.heading,tilt:c.tilt}).then(function(a){this.navigation._dataExtentChanged();this.viewpoint=a}.bind(this))}}},_pickRay:function(a,
b,c,d,e,f,g){return this._stage?this._stage.pickRay(a,b,c,d,e,f,g):null},_pickRayWithBeginPoint:function(a,b,c,d,e){return this._stage?this._stage.pickRayWithBeginPoint(a,b,c,d,e):null},_removeHandles:function(a){for(var b=0;b<a.length;b++){var c=a[b];this[c]&&(this[c].remove(),this[c]=null)}},_setCanvas:function(a){a!==this._get("canvas")&&this._set("canvas",a)},_disposeSurface:function(){this._removeHandles(["_stageFrameTask","_updateDrawingOrderHandle","onViewExtentUpdateHandle","_mapLayersChangeHandle"]);
this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this.pointsOfInterest=null);this._disposeBasemapTerrain();this._setNavigation(null);this.environmentManager&&this.environmentManager.disposeRendering()},_disposeBasemapTerrain:function(){var a=this._get("basemapTerrain");a&&(a.destroy(),this._set("basemapTerrain",null))},_disposeNavigation:function(){var a=this._get("navigation");a&&(a.destroy(),a.elevationProvider=null,this._set("navigation",null))},_setNavigation:function(a){this._get("navigation")!==
a&&(this._disposeNavigation(),a&&(a.windowSize=[this.width,this.height],a.userConstraints=this.constraints),this._set("navigation",a))},_initNavigation:function(a){a=a||this.viewingMode;var b={view:this};"global"===a?this._setNavigation(new oa(b)):this._setNavigation(new ta(b))},_initSurface:function(){var b={};b.deactivatedWebGLExtensions=this.deactivatedWebGLExtensions;b.viewingMode=this.viewingMode;this.renderCanvas&&(b.canvas=this.renderCanvas);this._stage=new m(this.viewingMode,a.byId(this.surface),
b);this._stage.selectionState=!1;this._stageHandles.add(J.init(this.qualitySettings,"antialiasingEnabled",function(){this._stage.setRenderParams({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})}.bind(this)));this._stageHandles.add(J.watch(this,this.highlightOptions.keys().map(function(a){return"highlightOptions."+a}),function(){this._stage.setRenderParams({defaultHighlightOptions:L.toEngineOptions(this.highlightOptions)})}.bind(this)));this._stageHandles.add(J.init(this,"highlightOptions",
function(){this._stage.setRenderParams({defaultHighlightOptions:L.toEngineOptions(this.highlightOptions)})}.bind(this)));this.renderCoordsHelper&&this._stage.setIntersectTolerance(v.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._setCanvas(this._stage.getCanvas());this._stageFrameTask=I.addFrameTask(this._stage.getFrameTask());this._trackCanvasSize();this._initGlobe(this.viewingMode);this.pointsOfInterest=new ha({view:this});J.init(this.pointsOfInterest.centerOnContent,"location",function(){this.notifyChange("center")}.bind(this),
!0);J.init(this.pointsOfInterest.centerOnContent,["distance","location"],function(){this.notifyChange("scale")}.bind(this),!0);this.pointsOfInterest.events.on("camera-parameters-changed",function(){this.notifyChange("scale")}.bind(this));this.sharedSymbolResources=new ea({stage:this._stage,viewingMode:this.viewingMode,resourceController:this.resourceController,pointsOfInterest:this.pointsOfInterest})},_initGraphicsView:function(){this._surfaceReadyWatchHandle=J.whenTrueOnce(this,"basemapTerrain.ready",
function(){this._graphicsView=new wa({view:this,graphics:this.graphics});this._surfaceReadyWatchHandle=null;this._layerViewsUpdatingHandles[this._graphicsView.mockLayerId]=J.init(this._graphicsView,"updating",this._evaluateUpdating)}.bind(this))},_disposeGraphicsView:function(){this._surfaceReadyWatchHandle&&(this._surfaceReadyWatchHandle.remove(),this._surfaceReadyWatchHandle=null);if(this._graphicsView){var a=this._graphicsView.mockLayerId;this._layerViewsUpdatingHandles[a].remove();delete this._layerViewsUpdatingHandles[a];
this._graphicsView.destroy();this._graphicsView=null}},_normalizePointArgs:function(a,b,c,d,e){e=e||Ga;var f=e.point;f.spatialReference=void 0;"object"===typeof a?(f.x=a.x,f.y=a.y,f.z=a.z,a.spatialReference&&(f.spatialReference=a.spatialReference),e.retval=b):(f.x=a,f.y=b,"number"!==typeof c&&void 0!==c?(f.z=void 0,e.retval=c):(f.z=c,e.retval=d));f.spatialReference||(f.spatialReference=this.spatialReference||z.WGS84);return e},_separateInitialProperties:function(){var a={},b={},c={},d=function(a){if(a=
Da[a])for(var b=0;b<a.length;b++)c[a[b]]=!0,d(a[b])},e;for(e in this._initialProps){var f=this._initialProps[e];Da[e]?(d(e),a[e]=f):b[e]=f}for(e in c)delete a[e];return{view:a,other:b}},_viewReadyHandler:function(a,b){if(!b){"global"===this.viewingMode&&(this._clippingArea=null);this._internallyReady=!0;this._initSurface();this._initGraphicsView();a=this._separateInitialProperties();for(var c in a.other)this.set(c,a.other[c]);for(c in a.view)this.set(c,a.view[c]);c=this.get("map.initialViewProperties.viewpoint");
a=this.get("initialExtent");c?this._setInitialView(c):a&&a.spatialReference.equals(this.spatialReference)?this._setInitialView(a):"local"===this.viewingMode&&J.whenOnce(this.basemapTerrain,"ready",function(){this._setInitialView(this.groundExtent)}.bind(this));!this._externallySet.environment&&(c=this.get("map.initialViewProperties.environment"))&&(this.environment=c);this._initialProps={};this.notifyChange("initialExtentRequired");this._updateDrawingOrderHandle=this.allLayerViews.on("change",this._updateDrawingOrder.bind(this));
this._updateDrawingOrder({added:this.allLayerViews.toArray(),removed:[],moved:[]});this.environmentManager.updateReadyChange(!0)}},_viewUnreadyHandler:function(a,b){b&&(this._initialDefaultSpatialReference=null,this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this._internallyReady=!1,this._disposeSurface(),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this._stage&&(this._stage.dispose(),this._stage=null,this._stageHandles.remove()),
this._setCanvas(null))},_getDesiredHeadingTilt:function(){if(this._externallySet.camera){var a=this.camera;za.heading=a.heading;za.tilt=a.tilt}else za.heading=0,za.tilt=.5;return za},_cameraSetter:ya("camera",function(a){this._setCamera(a,{animate:!1})||ra.error("#camera\x3d","Invalid camera",a)}),_cameraGetter:ua("camera",function(a){return e.internalToExternal(this,this.navigation.currentCamera,a)}),_externalExtent:function(){this._cachedExtentDirty&&(e.toExtent(this,null,null,this._cachedExtent,
da),this._cachedExtentDirty=!1);return this._cachedExtent},_extentGetter:ua("extent",function(a){return e.toExtent(this,null,null,a,da)}),_extentSetter:ya("extent",function(a){var b=e.fromExtent(this,a,this._getDesiredHeadingTilt(),da);b?this.camera=b:this._isIncompatibleSpatialReference(a.spatialReference)?ra.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+a.spatialReference.wkid+", view: "+this.spatialReference.wkid+")",a):ra.error("#extent\x3d","Invalid extent",a)}),
_heightModelInfoGetter:function(){var a=this.getDefaultHeightModelInfo();return null!=a?y.deriveUnitFromSR(a,this.spatialReference):null},_isIncompatibleSpatialReference:function(a){return a&&!a.equals(this.spatialReference)&&!u.canProject(a,this.spatialReference)},_scaleGetter:ua("scale",function(){if(null!=this.navigation){var a=this.pointsOfInterest.centerOnContent;return e.distanceToScale(this,a.distance,a.location.latitude)}return 0}),_scaleSetter:ya("scale",function(a){var b=this._getDesiredHeadingTilt(),
c=this.pointsOfInterest.centerOnContent;c.forceUpdate();var d=c.renderLocation;a=e.scaleToDistance(this,a,c.location.latitude);b=e.eyeHeadingTiltForCenterPointAtDistance(this,b.heading,b.tilt,d,a);this._externallySet.camera=!0;this.navigation.setCameraFromEyeCenterAndUp(b.eye,b.center,b.up,{animate:!1});c.forceUpdate()}),_zoomGetter:ua("zoom",function(){return e.scaleToZoom(this,this.scale)}),_zoomSetter:ya("zoom",function(a){this.scale=e.zoomToScale(this,a)}),_centerGetter:ua("center",function(a){return this.pointsOfInterest.centerOnContent.location}),
_centerSetter:ya("center",function(a){if(this._isIncompatibleSpatialReference(a&&a.spatialReference))ra.error("#center\x3d","Center has an incompatible spatial reference (center: "+a.spatialReference.wkid+", view: "+this.spatialReference.wkid+")",a);else{var b=this.pointsOfInterest.centerOnContent;b.forceUpdate();var c=this._getDesiredHeadingTilt();(c=e.eyeHeadingTiltForCenterPointAtDistance(this,c.heading,c.tilt,a,b.distance))||ra.error("#center\x3d","Invalid center",a);this._externallySet.camera=
!0;this.navigation.setCameraFromEyeCenterAndUp(c.eye,c.center,c.up,{animate:!1});b.forceUpdate()}}),_viewpointGetter:ua("viewpoint",function(){return d.fromCamera(this,this.camera)}),_viewpointSetter:ya("viewpoint",function(a){var b=d.toCamera(this,a);b?this._setCamera(b,{animate:!1}):ra.error("#viewpoint\x3d","Invalid viewpoint",a)}),_screenCenterGetter:function(){var a=this.padding;return new A((this.size[0]-(a.left+a.right))/2+a.left,(this.size[1]-(a.top+a.bottom))/2+a.top)},_updateDrawingOrder:function(){var a=
this.allLayerViews.length-1;this.allLayerViews.forEach(function(b,c){null!=b.drawingOrder&&(b.drawingOrder=a-c)},this)},_paddingSetter:ya("padding",function(a){this._set("padding",{top:a&&a.top||0,right:a&&a.right||0,bottom:a&&a.bottom||0,left:a&&a.left||0});this.navigation&&(this.navigation.padding=this._get("padding"))}),_constraintsSetter:ya("constraints",function(a){this._set("constraints",a);a===this._defaults.constraints&&(this._defaults.constraints=null,a.scale(1/this.renderCoordsHelper.unitInMeters));
this.navigation.userConstraints=a}),_animationSetter:function(a){a!==this._get("animation")&&(this._internallyReady?(this._animationStateWatcher&&(this._animationStateWatcher.remove(),this._animationStateWatcher=null),this._set("animation",a),a&&(this._animationStateWatcher=a.watch("state",function(a){if(a===l.State.FINISHED||a===l.State.STOPPED)this.animation=null,a===l.State.FINISHED?this.navigation.setCurrentToTarget():this.navigation.setCamera(this.navigation.currentCamera,{animate:!1})}.bind(this)))):
ra.error("#animation\x3d","Scene view cannot be used before it is ready"))},_mapSetter:function(a){a!==this._get("map")&&(this.navigation&&this.navigation._dataExtentChanged(),this._mapLayersChangeHandle&&this._mapLayersChangeHandle.remove(),a&&(this._mapLayersChangeHandle=a.allLayers.on("change",this.notifyChange.bind(this,"dataExtent"))),delete this._externallySet.camera,this.inherited(arguments))}})});